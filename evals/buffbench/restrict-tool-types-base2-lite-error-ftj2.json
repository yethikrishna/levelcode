{
  "error": "Tool `read_files` is not currently available. Make sure to only use tools listed in the system instructions.",
  "trace": [
    {
      "type": "start",
      "messageHistoryLength": 0
    },
    {
      "type": "tool_call",
      "toolCallId": "34b93754-82c1-40f4-bec7-20175323504b",
      "toolName": "spawn_agent_inline",
      "input": {
        "agent_type": "context-pruner",
        "params": {}
      },
      "agentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "34b93754-82c1-40f4-bec7-20175323504b",
      "toolName": "spawn_agent_inline",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Agent spawned."
          }
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "D-UpnVGjKsI",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "file-picker",
            "prompt": "Find all files related to tool definitions, tool schemas, type generation scripts like generate-tool-definitions.ts, tool registries, and public tool exports. Include files in backend, scripts, sdk, common."
          },
          {
            "agent_type": "file-picker",
            "prompt": "Find files in sdk/src and common/src that define or use tool types, unions, or interfaces like ToolCall, ToolSchema, etc."
          },
          {
            "agent_type": "file-picker",
            "prompt": "Find files handling tool type generation, regeneration, or publishing in SDK and common packages."
          },
          {
            "agent_type": "code-searcher",
            "params": {
              "searchQueries": [
                {
                  "pattern": "generate-tool-definitions|toolSchemas|publicTools|approvedTools|curatedTools|toolRegistry",
                  "flags": "-g *.ts -g *.json"
                },
                {
                  "pattern": "type\\s+Tool|interface\\s+Tool|union\\s+of\\s+tools|ToolName",
                  "flags": "-g sdk -g common -g backend/src"
                }
              ]
            }
          },
          {
            "agent_type": "directory-lister",
            "params": {
              "directories": [
                {
                  "path": "scripts"
                },
                {
                  "path": "sdk/src"
                },
                {
                  "path": "common/src"
                },
                {
                  "path": "backend/src"
                }
              ]
            }
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-Upph7O3-0",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Find all files related to tool definitions, tool schemas, type generation scripts like generate-tool-definitions.ts, tool registries, and public tool exports. Include files in backend, scripts, sdk, common."
    },
    {
      "type": "subagent_start",
      "agentId": "D-UppvyfWNM",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Find files in sdk/src and common/src that define or use tool types, unions, or interfaces like ToolCall, ToolSchema, etc."
    },
    {
      "type": "subagent_start",
      "agentId": "D-UppjyUa0E",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Find files handling tool type generation, regeneration, or publishing in SDK and common packages."
    },
    {
      "type": "subagent_start",
      "agentId": "D-UpptuOT3U",
      "agentType": "code-searcher",
      "displayName": "Code Searcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "searchQueries": [
          {
            "pattern": "generate-tool-definitions|toolSchemas|publicTools|approvedTools|curatedTools|toolRegistry",
            "flags": "-g *.ts -g *.json"
          },
          {
            "pattern": "type\\s+Tool|interface\\s+Tool|union\\s+of\\s+tools|ToolName",
            "flags": "-g sdk -g common -g backend/src"
          }
        ]
      }
    },
    {
      "type": "subagent_start",
      "agentId": "D-UppqGVX8E",
      "agentType": "directory-lister",
      "displayName": "Directory Lister",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "directories": [
          {
            "path": "scripts"
          },
          {
            "path": "sdk/src"
          },
          {
            "path": "common/src"
          },
          {
            "path": "backend/src"
          }
        ]
      }
    },
    {
      "type": "tool_call",
      "toolCallId": "d046e8ca-3af1-4520-b256-adb0bd018137",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "file-lister",
            "prompt": "Find all files related to tool definitions, tool schemas, type generation scripts like generate-tool-definitions.ts, tool registries, and public tool exports. Include files in backend, scripts, sdk, common.",
            "params": {}
          }
        ]
      },
      "agentId": "D-Upph7O3-0",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-Upzevpluo",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-Upph7O3-0",
      "prompt": "Find all files related to tool definitions, tool schemas, type generation scripts like generate-tool-definitions.ts, tool registries, and public tool exports. Include files in backend, scripts, sdk, common.",
      "params": {}
    },
    {
      "type": "tool_call",
      "toolCallId": "c0209f42-5bb0-47b7-aabf-0376e2e259dc",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "file-lister",
            "prompt": "Find files handling tool type generation, regeneration, or publishing in SDK and common packages.",
            "params": {}
          }
        ]
      },
      "agentId": "D-UppjyUa0E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-Up4CDP0Kk",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-UppjyUa0E",
      "prompt": "Find files handling tool type generation, regeneration, or publishing in SDK and common packages.",
      "params": {}
    },
    {
      "type": "tool_call",
      "toolCallId": "d0f2d613-2d62-4d19-9cf2-134e939daa49",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "file-lister",
            "prompt": "Find files in sdk/src and common/src that define or use tool types, unions, or interfaces like ToolCall, ToolSchema, etc.",
            "params": {}
          }
        ]
      },
      "agentId": "D-UppvyfWNM",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-Up8asoMmA",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-UppvyfWNM",
      "prompt": "Find files in sdk/src and common/src that define or use tool types, unions, or interfaces like ToolCall, ToolSchema, etc.",
      "params": {}
    },
    {
      "type": "tool_call",
      "toolCallId": "3c8b3537-c0ca-4feb-92fb-714fe8de7935",
      "toolName": "code_search",
      "input": {
        "pattern": "generate-tool-definitions|toolSchemas|publicTools|approvedTools|curatedTools|toolRegistry",
        "flags": "-g *.ts -g *.json"
      },
      "agentId": "D-UpptuOT3U",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "f377e73e-59d4-43e7-bd23-bb310902374b",
      "toolName": "list_directory",
      "input": {
        "path": "scripts"
      },
      "agentId": "D-UppqGVX8E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "530c5d09-3fbf-4502-b4f0-ee6d625b110c",
      "toolName": "read_subtree",
      "input": {
        "paths": [],
        "maxTokens": 500000
      },
      "agentId": "D-Upzevpluo",
      "parentAgentId": "D-Upph7O3-0",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "530c5d09-3fbf-4502-b4f0-ee6d625b110c",
      "toolName": "read_subtree",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": ".",
              "type": "directory",
              "printedTree": ".agents/\n examples/\n  diff-reviewer-1.ts\n  diff-reviewer-2.ts\n  diff-reviewer-3.ts\n opensource/\n  base.ts\n  coder.ts\n  file-picker.ts\n  researcher.ts\n  reviewer.ts\n  thinker.ts\n ask.ts\n base-experimental.ts\n base-lite.ts\n base-max.ts\n base.ts\n brainstormer.ts\n changes-reviewer.ts\n charles.ts\n claude4-gemini-thinking.ts\n constants.ts\n file-explorer.ts\n file-picker.ts\n git-committer.ts\n knowledge-keeper.ts\n planner.ts\n researcher.ts\n reviewer.ts\n superagent.ts\n thinker.ts\n.bin/\n bun\n.github/\n workflows/\n  ci.yml\n  evals.yml\n  nightly-evals.yml\n  npm-app-release-build.yml\n  npm-app-release-prod.yml\n  npm-app-release-staging.yml\n .gitignore\n CODEOWNERS\n knowledge.md\n.vscode/\n settings.json\nbackend/\n src/\n  __tests__/\n   test-data/\n    dex-go/\n     edit-snippet.go\n     expected.go\n     original.go\n   agent-id-resolution.test.ts\n   agent-registry.test.ts\n   auto-topup.test.ts\n   credit-conversion.test.ts\n   fast-rewrite.test.ts\n   generate-diffs-prompt.test.ts\n   get-custom-file-picker-config.test.ts\n   live-user-inputs.test.ts\n   loop-agent-steps.test.ts\n   main-prompt.integration.test.ts\n   main-prompt.test.ts\n   process-file-block.test.ts\n   process-str-replace.test.ts\n   read-docs-tool.test.ts\n   request-files-prompt.test.ts\n   run-agent-step-tools.test.ts\n   run-programmatic-step.test.ts\n   sandbox-generator.test.ts\n   subagent-streaming.test.ts\n   test-utils.ts\n   tool-call-schema.test.ts\n   usage-calculation.test.ts\n   web-search-tool.test.ts\n   xml-stream-parser.test.ts\n  admin/\n   grade-runs.ts\n   relabelRuns.ts\n  api/\n   org.ts\n   usage.ts\n  context/\n   app-context.ts\n  find-files/\n   check-new-files-necessary.ts\n   custom-file-picker-config.ts\n   request-files-prompt.ts\n  llm-apis/\n   __tests__/\n    linkup-api.test.ts\n   vercel-ai-sdk/\n    ai-sdk.ts\n    openrouter.ts\n    vertex-finetuned.ts\n   claude.ts\n   context7-api.ts\n   gemini-with-fallbacks.ts\n   knowledge.md\n   linkup-api.ts\n   message-cost-tracker.ts\n   openai-api.ts\n   openrouter.ts\n   relace-api.ts\n  system-prompt/\n   agent-instructions.md\n   prompts.ts\n   save-agent-request.ts\n   search-system-prompt.ts\n   truncate-file-tree.ts\n  templates/\n   agents/\n    archive/\n     dry-run.ts\n    agent-builder.ts\n    ask.ts\n    base.ts\n    file-explorer.ts\n    file-picker.ts\n    planner.ts\n    researcher.ts\n    reviewer.ts\n    superagent.ts\n    thinker.ts\n    thinking-base.ts\n   agent-list.ts\n   agent-registry.ts\n   ask-prompts.ts\n   base-prompts.ts\n   prompts.ts\n   README.md\n   strings.ts\n   types.ts\n  tools/\n   definitions/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    list.ts\n    tool-def-type.ts\n   handlers/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    handler-function-type.ts\n    list.ts\n   constants.ts\n   prompts.ts\n   stream-parser.ts\n   tool-executor.ts\n  util/\n   __tests__/\n    messages.test.ts\n    object.test.ts\n    parse-tool-call-xml.test.ts\n    simplify-tool-results.test.ts\n    split-data.test.ts\n   check-auth.ts\n   debug.ts\n   file-resolver.ts\n   logger.ts\n   messages.ts\n   object.ts\n   parse-tool-call-xml.ts\n   quickjs-sandbox.ts\n   simplify-tool-results.ts\n   split-data.ts\n   token-counter.ts\n  websockets/\n   auth.ts\n   middleware.ts\n   request-context.ts\n   server.ts\n   switchboard.ts\n   websocket-action.ts\n  async-agent-manager.ts\n  check-terminal-command.ts\n  fast-rewrite.ts\n  generate-diffs-prompt.ts\n  get-documentation-for-query.ts\n  get-file-reading-updates.ts\n  index.ts\n  live-user-inputs.ts\n  loop-main-prompt.ts\n  main-prompt.ts\n  process-file-block.ts\n  process-str-replace.ts\n  prompt-agent-stream.ts\n  run-agent-step.ts\n  run-programmatic-step.ts\n  xml-stream-parser.ts\n .gitignore\n knowledge.md\n package.json\n README.md\n tsconfig.json\ncommon/\n src/\n  __tests__/\n   agent-validation.test.ts\n   dynamic-agent-template-schema.test.ts\n   handlesteps-parsing.test.ts\n  api-keys/\n   constants.ts\n   crypto.ts\n  constants/\n   agents.ts\n   analytics-events.ts\n   grant-priorities.ts\n  db/\n   migrations/\n    meta/\n     _journal.json\n     0000_snapshot.json\n     0001_snapshot.json\n     0002_snapshot.json\n     0003_snapshot.json\n     0004_snapshot.json\n     0005_snapshot.json\n     0006_snapshot.json\n     0007_snapshot.json\n     0008_snapshot.json\n     0009_snapshot.json\n     0010_snapshot.json\n     0011_snapshot.json\n     0012_snapshot.json\n     0013_snapshot.json\n     0014_snapshot.json\n     0015_snapshot.json\n     0016_snapshot.json\n     0017_snapshot.json\n     0018_snapshot.json\n     0019_snapshot.json\n     0020_snapshot.json\n     0021_snapshot.json\n     0026_snapshot.json\n     0027_snapshot.json\n     0028_snapshot.json\n    0000_overjoyed_thing.sql\n    0001_fuzzy_typhoid_mary.sql\n    0002_sticky_dormammu.sql\n    0003_military_owl.sql\n    0004_neat_pet_avengers.sql\n    0005_minor_the_professor.sql\n    0006_first_quasimodo.sql\n    0007_equal_warlock.sql\n    0008_puzzling_carnage.sql\n    0009_bitter_rumiko_fujikawa.sql\n    0010_overjoyed_red_skull.sql\n    0011_familiar_ezekiel_stane.sql\n    0012_fluffy_naoko.sql\n    0013_famous_risque.sql\n    0014_wakeful_sinister_six.sql\n    0015_stormy_zuras.sql\n    0016_clear_hairball.sql\n    0017_tricky_randall_flagg.sql\n    0018_stale_human_robot.sql\n    0019_amused_nebula.sql\n    0020_young_sleeper.sql\n    0021_tiny_marauders.sql\n    0026_chilly_mockingbird.sql\n    0027_sloppy_quasar.sql\n    0028_lush_johnny_blaze.sql\n   docker-compose.yml\n   drizzle.config.ts\n   index.ts\n   schema.knowledge.md\n   schema.ts\n   transaction.ts\n  json-config/\n   __tests__/\n    __snapshots__/\n     stringify-schema.test.ts.snap\n    constants.test.ts\n    stringify-schema.test.ts\n   constants.ts\n   default.ts\n   stringify-schema.ts\n  templates/\n   agent-validation.ts\n   dynamic-agent-functions.ts\n  testing/\n   mock-modules.ts\n  tools/\n   params/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n   compile-tool-definitions.ts\n   constants.ts\n   list.ts\n   utils.ts\n  types/\n   __tests__/\n    dynamic-agent-template.test.ts\n   api/\n    agents/\n     publish.ts\n   agent-template.ts\n   dynamic-agent-template.ts\n   grant.ts\n   message.ts\n   organization.ts\n   print-mode.ts\n   publisher.ts\n   referral.ts\n   session-state.ts\n   usage.ts\n  util/\n   __tests__/\n    messages.test.ts\n    partial-json-delta.test.ts\n    saxy.test.ts\n    string.test.ts\n   examples/\n    diff-reviewer-1.ts\n    diff-reviewer-2.ts\n    diff-reviewer-3.ts\n   agent-file-utils.ts\n   agent-name-normalization.ts\n   agent-name-resolver.ts\n   agent-template-validation.ts\n   array.ts\n   changes.ts\n   credentials.ts\n   currency.ts\n   dates.ts\n   error.ts\n   file.ts\n   git.ts\n   logger.ts\n   lru-cache.ts\n   messages.ts\n   min-heap.ts\n   model-utils.ts\n   object.ts\n   partial-json-delta.ts\n   patch.ts\n   promise.ts\n   random.ts\n   referral.ts\n   saxy.ts\n   string.knowledge.md\n   string.ts\n   stripe.ts\n   sync-failure.ts\n   xml.ts\n   zod-schema.ts\n  websockets/\n   websocket-client.ts\n   websocket-schema.ts\n  actions.ts\n  analytics.ts\n  browser-actions.ts\n  constants.ts\n  project-file-tree.ts\n knowledge.md\n package.json\n tsconfig.json\nevals/\n git-evals/\n  email-eval-results.ts\n  eval-levelcode.json\n  eval-manifold.json\n  eval-result-levelcode-mock.json\n  gen-evals.ts\n  judge-git-eval.ts\n  post-eval-analysis.ts\n  run-eval-set.ts\n  run-git-evals.ts\n  run-single-eval-process.ts\n  run-single-eval.ts\n  setup-test-repo.ts\n  types.ts\n .gitignore\n bun.lock\n constants.ts\n e2e-cat-app-script.ts\n knowledge.md\n package.json\n scaffolding.ts\n swe-bench-eval.ts\n swe-bench-ids.ts\n swe-bench.test.ts\n test-repos.json\n test-setup.ts\n tsconfig.json\nnpm-app/\n release/\n  index.js\n  package.json\n  README.md\n release-staging/\n  index.js\n  package.json\n  README.md\n scripts/\n  build-binary.js\n  generate-github-token.ts\n  patch-web-tree-sitter.ts\n  release.js\n  twitch-plays-levelcode.sh\n src/\n  __tests__/\n   display.test.ts\n   tool-handlers.test.ts\n  agents/\n   agent-utils.ts\n   load-agents.ts\n  checkpoints/\n   checkpoint-manager.ts\n   file-manager.ts\n  cli-handlers/\n   agent-creation-chat.ts\n   agents.ts\n   api-key.ts\n   checkpoint.ts\n   diff.ts\n   easter-egg.ts\n   inititalization-flow.ts\n   mini-chat.ts\n   publish.ts\n   subagent-list.ts\n   subagent.ts\n  display/\n   overrides.ts\n   print-mode.ts\n   squash-newlines.ts\n  json-config/\n   hooks.ts\n   parser.ts\n  native/\n   ripgrep.ts\n  terminal/\n   background.ts\n   run-command.ts\n  utils/\n   __tests__/\n    __snapshots__/\n     background-process-manager.test.ts.snap\n     frustration-detector.test.ts.snap\n     rage-detector.test.ts.snap\n     xml-stream-parser.test.ts.snap\n    background-process-manager.test.ts\n    rage-detector.test.ts\n    response-example-4-files.txt\n    tool-renderers.test.ts\n    xml-stream-parser.test.ts\n   agent-validation.ts\n   analytics.ts\n   detect-shell.ts\n   git.ts\n   logger.ts\n   rage-detector.ts\n   spinner.ts\n   suppress-console.ts\n   system-info.ts\n   terminal.ts\n   tool-renderers.ts\n   with-hang-detection.ts\n   xml-stream-parser.ts\n  workers/\n   checkpoint-worker.ts\n   project-context.ts\n  background-process-manager.ts\n  browser-runner.ts\n  chat-storage.ts\n  cli-definitions.ts\n  cli.ts\n  client.ts\n  config.ts\n  create-template-project.ts\n  credentials.ts\n  dev-process-manager.ts\n  diff-manager.ts\n  fingerprint.ts\n  index.ts\n  menu.ts\n  project-files.ts\n  rage-detectors.ts\n  startup-process-handler.ts\n  subagent-storage.ts\n  tool-handlers.ts\n  types.ts\n  web-scraper.ts\n .gitignore\n bunfig.toml\n package.json\n tsconfig.json\npackages/\n bigquery/\n  src/\n   client.ts\n   index.ts\n   schema.ts\n  knowledge.md\n  package.json\n  tsconfig.json\n billing/\n  src/\n   __tests__/\n    credit-delegation.test.ts\n    extract-owner-repo.test.ts\n    org-billing.test.ts\n   auto-topup.ts\n   balance-calculator.ts\n   billing.knowledge.md\n   conversion.ts\n   credit-delegation.ts\n   grant-credits.knowledge.md\n   grant-credits.ts\n   index.ts\n   org-billing.ts\n   org-monitoring.ts\n   usage-service.ts\n   utils.ts\n  knowledge.md\n  package.json\n  project.json\n  tsconfig.json\n build-tools/\n  executors/\n   infisical-run/\n    executor.ts\n    schema.json\n  executors.json\n  package.json\n  project.json\n  tsconfig.json\n code-map/\n  __tests__/\n   test-langs/\n    test.c\n    test.cpp\n    test.cs\n    test.go\n    test.java\n    test.js\n    test.php\n    test.py\n    test.rb\n    test.rs\n    test.ts\n   languages.test.ts\n   parse.test.ts\n  src/\n   tree-sitter-queries/\n    readme.md\n    tree-sitter-c_sharp-tags.scm\n    tree-sitter-c-tags.scm\n    tree-sitter-cpp-tags.scm\n    tree-sitter-go-tags.scm\n    tree-sitter-java-tags.scm\n    tree-sitter-javascript-tags.scm\n    tree-sitter-php-tags.scm\n    tree-sitter-python-tags.scm\n    tree-sitter-ruby-tags.scm\n    tree-sitter-rust-tags.scm\n    tree-sitter-typescript-tags.scm\n   index.ts\n   languages.ts\n   parse.ts\n  package.json\n  tsconfig.json\n internal/\n  src/\n   loops/\n    client.ts\n    index.ts\n    types.ts\n   openrouter-ai-sdk/\n    internal/\n     index.ts\n    schemas/\n     reasoning-details.ts\n    types/\n     index.ts\n     openrouter-chat-completions-input.ts\n     openrouter-chat-settings.ts\n    .gitignore\n    convert-to-openrouter-chat-messages.test.ts\n    convert-to-openrouter-chat-messages.ts\n    convert-to-openrouter-completion-prompt.ts\n    index.ts\n    map-openrouter-chat-logprobs.ts\n    map-openrouter-completion-logprobs.ts\n    map-openrouter-finish-reason.ts\n    openrouter-chat-language-model.test.ts\n    openrouter-chat-language-model.ts\n    openrouter-completion-language-model.test.ts\n    openrouter-completion-language-model.ts\n    openrouter-completion-settings.ts\n    openrouter-error.ts\n    openrouter-facade.ts\n    openrouter-provider-options.test.ts\n    openrouter-provider.ts\n    openrouter-stream-usage-accounting.test.ts\n    openrouter-usage-accounting.test.ts\n   utils/\n    __tests__/\n     version-utils.test.ts\n    auth.ts\n    version-utils.ts\n    xml-parser.ts\n   env.ts\n   index.ts\n   knowledge.md\n  package.json\n  tsconfig.json\npython-app/\n src/\n  levelcode/\n   __init__.py\n .gitignore\n knowledge.md\n LICENSE\n pyproject.toml\n README.md\nscripts/\n changelog/\n  2025-05-18-version-10283-release-enhanced-assistant-experience-system-stability.mdx\n  2025-05-25-version-10295-enhanced-ai-models-and-user-experience-improvements.mdx\n  2025-06-01-version-10305-release-enhanced-ai-models-new-commands-and-performance-improvements.mdx\n  docs.json\n ft-file-selection/\n  .gitignore\n  collect-tuning-data.ts\n  grade-traces.ts\n  print-recent-relabels.ts\n  print-recent-traces.ts\n  README.md\n  relabel-for-offline-scoring.ts\n  relabel-traces-with-context.ts\n  relabel-traces.ts\n .gitignore\n analyze-edit-blocks.ts\n analyze-model-usage.ts\n apply-credit-migration.ts\n calculate-average-spend.ts\n calculate-dau.ts\n calculate-monthly-usage.ts\n calculate-mrr.ts\n calculate-weekly-usage.ts\n cleanup-worktree.sh\n convert-escaped-newlines.ts\n count-edit-file.ts\n debug-log-subset.ts\n dev.sh\n export-user-emails.ts\n generate-ci-env.js\n generate-tool-definitions.ts\n get-changelog.ts\n init-worktree.ts\n package.json\n tsconfig.json\n update-stripe-subscriptions.ts\nsdk/\n scripts/\n  publish.js\n src/\n  tools/\n   change-file.ts\n   read-files.ts\n  types/\n   agent-definition.ts\n   tools.ts\n  client.ts\n  constants.ts\n  index.ts\n  process-stream.ts\n  websocket-client.ts\n .npmignore\n CHANGELOG.md\n package.json\n PUBLISHING.md\n README.md\n tsconfig.json\nweb/\n public/\n  levelcode-intro1.webm\n scripts/\n  discord/\n   index.ts\n   register-commands.ts\n src/\n  __tests__/\n   e2e/\n    home.spec.ts\n   unit/\n    home.spec.tsx\n  actions/\n   hello-action.ts\n  app/\n   [sponsee]/\n    page.tsx\n   admin/\n    file-picker/\n     page.tsx\n    orgs/\n     page.tsx\n    traces/\n     components/\n      chat-message.tsx\n      client-session-viewer.tsx\n      empty-state.tsx\n      error-boundary.tsx\n      loading-skeletons.tsx\n      timeline-chart.module.css\n      timeline-chart.tsx\n      trace-viewer.tsx\n     utils/\n      __tests__/\n       trace-processing.test.ts\n      trace-processing.ts\n     page.tsx\n    layout.tsx\n   affiliates/\n    actions.ts\n    page.tsx\n   agents/\n    page.tsx\n   api/\n    admin/\n     orgs/\n      [orgId]/\n       features/\n        [feature]/\n         route.ts\n      export/\n       route.ts\n      route.ts\n     relabel-for-user/\n      route.ts\n     traces/\n      [clientRequestId]/\n       messages/\n        route.ts\n       timeline/\n        route.ts\n      client/\n       [clientId]/\n        sessions/\n         route.ts\n     admin-auth.ts\n    agents/\n     [publisherId]/\n      [agentId]/\n       [version]/\n        route.ts\n       latest/\n        route.ts\n     publish/\n      route.ts\n     validate/\n      route.ts\n     route.ts\n    api-keys/\n     route.ts\n    auth/\n     [...nextauth]/\n      auth-options.ts\n      route.ts\n     cli/\n      code/\n       route.ts\n      logout/\n       route.ts\n      status/\n       route.ts\n    feed/\n     route.ts\n    git-evals/\n     visibility/\n      route.ts\n     route.ts\n    healthz/\n     route.ts\n    invites/\n     [token]/\n      route.ts\n    orgs/\n     [orgId]/\n      alerts/\n       [alertId]/\n        dismiss/\n         route.ts\n       route.ts\n      analytics/\n       export/\n        route.ts\n       route.ts\n      billing/\n       setup/\n        route.ts\n       status/\n        route.ts\n       subscription/\n        route.ts\n      credits/\n       route.ts\n      invitations/\n       [email]/\n        resend/\n         route.ts\n        route.ts\n       bulk/\n        route.ts\n       route.ts\n      members/\n       [userId]/\n        route.ts\n       route.ts\n      monitoring/\n       route.ts\n      publishers/\n       route.ts\n      repos/\n       [repoId]/\n        route.ts\n       route.ts\n      settings/\n       route.ts\n      usage/\n       export/\n        route.ts\n       route.ts\n      route.ts\n     slug/\n      [slug]/\n       route.ts\n     route.ts\n    publishers/\n     [id]/\n      organization/\n       route.ts\n     validate/\n      route.ts\n     route.ts\n    referrals/\n     [code]/\n      route.ts\n     helpers.ts\n     route.ts\n    stripe/\n     buy-credits/\n      route.ts\n     webhook/\n      route.ts\n    upload/\n     avatar/\n      route.ts\n    user/\n     auto-topup/\n      route.ts\n     profile/\n      route.ts\n     usage/\n      route.ts\n   config/\n    page.tsx\n   docs/\n    [category]/\n     layout.tsx\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   evals/\n    evals-table.tsx\n    page.tsx\n   invites/\n    [token]/\n     page.tsx\n   login/\n    page.tsx\n   onboard/\n    page.tsx\n   orgs/\n    [slug]/\n     analytics/\n      page.tsx\n     billing/\n      purchase/\n       page.tsx\n      setup/\n       page.tsx\n     repositories/\n      page.tsx\n     settings/\n      page.tsx\n     team/\n      page.tsx\n     usage/\n      page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   payment-success/\n    page.tsx\n   pricing/\n    page.tsx\n   privacy-policy/\n    page.tsx\n   publishers/\n    [id]/\n     agents/\n      [agentId]/\n       [version]/\n        page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   referrals/\n    [code]/\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   terms-of-service/\n    page.tsx\n   usage/\n    layout.tsx\n    page.tsx\n    usage-display.tsx\n   analytics.knowledge.md\n   layout.tsx\n   page.tsx\n   robots.ts\n   sitemap.ts\n  components/\n   agent/\n    json-viewer.tsx\n   auto-topup/\n    AutoTopupSettings.tsx\n    AutoTopupSettingsForm.tsx\n    AutoTopupSwitch.tsx\n    BaseAutoTopupSettings.tsx\n    BaseAutoTopupSettingsForm.tsx\n    BaseAutoTopupSwitch.tsx\n    constants.ts\n    OrgAutoTopupSettings.tsx\n    OrgAutoTopupSettingsForm.tsx\n    OrgAutoTopupSwitch.tsx\n    types.ts\n   credits/\n    CreditManagementSection.tsx\n    CreditPurchaseSection.tsx\n   docs/\n    mdx/\n     code-demo.tsx\n     custom-link.tsx\n     markdown-table.tsx\n     mdx-components.tsx\n     mermaid-diagram.tsx\n     schema-display.tsx\n    copy-heading.tsx\n    doc-sidebar.tsx\n    docs.knowledge.md\n    toc.tsx\n   login/\n    login-card.tsx\n    login-client-wrapper.tsx\n   navbar/\n    navbar.tsx\n    user-dropdown.tsx\n   organization/\n    advanced-monitor.tsx\n    billing-alerts.tsx\n    billing-reports.tsx\n    billing-status.tsx\n    credit-monitor.tsx\n    model-config-sheet.tsx\n    organization-success-modal.tsx\n    repository-management.tsx\n    team-management.tsx\n   providers/\n    query-client-provider.tsx\n   publisher/\n    basic-info-step.tsx\n    ownership-step.tsx\n    profile-details-step.tsx\n    step-template.tsx\n   sign-in/\n    sign-in-button.tsx\n    sign-in-card-footer.tsx\n   ui/\n    landing/\n     competition/\n      claude-code.tsx\n      cline.tsx\n      cursor.tsx\n      github-copilot.tsx\n      index.tsx\n      tabs.tsx\n     feature/\n      browser-comparison.tsx\n      chart-illustration.tsx\n      code-illustration.tsx\n      highlight-text.tsx\n      index.tsx\n      workflow-illustration.tsx\n     animated-element.tsx\n     constants.ts\n     cta-section.tsx\n     demo-code-display.tsx\n     testimonials-section.tsx\n     types.ts\n    terminal/\n     index.tsx\n     style.css\n     terminal-input.tsx\n     terminal-output.tsx\n    avatar-upload.tsx\n    background-beams.tsx\n    badge.tsx\n    banner.tsx\n    button.tsx\n    card.tsx\n    collapsible.tsx\n    credit-confetti.tsx\n    decorative-blocks.tsx\n    dialog.tsx\n    dropdown-menu.tsx\n    enhanced-copy-button.tsx\n    footer.tsx\n    hero-buttons.tsx\n    hero.tsx\n    input.tsx\n    install-dialog.tsx\n    label.tsx\n    neon-gradient-button.tsx\n    progress.tsx\n    radio-group.tsx\n    section.tsx\n    select.tsx\n    separator.tsx\n    sheet.tsx\n    sidebar.tsx\n    skeleton-loading.tsx\n    skeleton.tsx\n    slider.tsx\n    switch.tsx\n    table.tsx\n    tabs.tsx\n    textarea.tsx\n    toast.tsx\n    toaster.tsx\n    tooltip.tsx\n    use-toast.ts\n   BrowserPreview.tsx\n   card-with-beams.tsx\n   CookieConsentCard.tsx\n   footer.tsx\n   icons.tsx\n   IDEDemo.tsx\n   layout-wrapper.tsx\n   TerminalDemo.tsx\n   theme-provider.tsx\n   theme-switcher.tsx\n  content/\n   advanced/\n    claude-code-comparison.mdx\n    config.mdx\n    how-does-it-work.mdx\n    large-projects.mdx\n    troubleshooting.mdx\n    what-models.mdx\n   agents/\n    agent-reference.mdx\n    creating-new-agents.mdx\n    customizing-agents.mdx\n    overview.mdx\n    troubleshooting-agent-customization.mdx\n   case-studies/\n    _cta.mdx\n    benjamin-bryant.mdx\n    oliver-lukesch.mdx\n   help/\n    faq.mdx\n    getting-started.mdx\n   tips/\n    best-practices.mdx\n    keyboard-shortcuts.mdx\n    knowledge-files.mdx\n    other-use-cases.mdx\n    version-control.mdx\n    where-levelcode-shines.mdx\n  discord/\n   client.ts\n   rate-limiter.ts\n  hooks/\n   use-auto-topup.ts\n   use-install-dialog.ts\n   use-mobile.tsx\n   use-model-config.ts\n   use-org-auto-topup.ts\n   use-organization-data.ts\n   use-user-profile.ts\n  lib/\n   server/\n    referral.ts\n   validators/\n    publisher.ts\n   admin-auth.ts\n   constant.ts\n   currency.ts\n   docs.ts\n   fonts.ts\n   organization-permissions.ts\n   PostHogProvider.tsx\n   publisher-permissions.ts\n   remark-code-to-codedemo.ts\n   server-init.ts\n   SessionProvider.tsx\n   stripe-utils.ts\n   testimonials.ts\n   trackConversions.ts\n   utils.ts\n  styles/\n   globals.css\n  types/\n   docs.ts\n   user.ts\n  util/\n   logger.ts\n .eslintignore\n .eslintrc.js\n .gitignore\n .prettierignore\n .prettierrc.js\n commitlint.config.js\n components.json\n contentlayer.config.ts\n jest.config.js\n jest.setup.js\n knowledge.md\n next.config.mjs\n package.json\n playwright.config.ts\n postcss.config.cjs\n README.md\n tailwind.config.ts\n tsconfig.json\n.envrc\n.gitignore\n.infisical.json\n.prettierrc\nauthentication.knowledge.md\nbun.lock\nbunfig.toml\nlevelcode.json\neslint.config.js\nknowledge.md\npackage.json\nREADME.md\ntsconfig.base.json\ntsconfig.json\nWINDOWS.md\n",
              "tokenCount": 9007,
              "truncationLevel": "none"
            }
          ]
        }
      ],
      "parentAgentId": "D-Upzevpluo"
    },
    {
      "type": "tool_call",
      "toolCallId": "92e701b3-1b98-4990-bc85-a71728711ba6",
      "toolName": "read_subtree",
      "input": {
        "paths": [],
        "maxTokens": 500000
      },
      "agentId": "D-Up4CDP0Kk",
      "parentAgentId": "D-UppjyUa0E",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "92e701b3-1b98-4990-bc85-a71728711ba6",
      "toolName": "read_subtree",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": ".",
              "type": "directory",
              "printedTree": ".agents/\n examples/\n  diff-reviewer-1.ts\n  diff-reviewer-2.ts\n  diff-reviewer-3.ts\n opensource/\n  base.ts\n  coder.ts\n  file-picker.ts\n  researcher.ts\n  reviewer.ts\n  thinker.ts\n ask.ts\n base-experimental.ts\n base-lite.ts\n base-max.ts\n base.ts\n brainstormer.ts\n changes-reviewer.ts\n charles.ts\n claude4-gemini-thinking.ts\n constants.ts\n file-explorer.ts\n file-picker.ts\n git-committer.ts\n knowledge-keeper.ts\n planner.ts\n researcher.ts\n reviewer.ts\n superagent.ts\n thinker.ts\n.bin/\n bun\n.github/\n workflows/\n  ci.yml\n  evals.yml\n  nightly-evals.yml\n  npm-app-release-build.yml\n  npm-app-release-prod.yml\n  npm-app-release-staging.yml\n .gitignore\n CODEOWNERS\n knowledge.md\n.vscode/\n settings.json\nbackend/\n src/\n  __tests__/\n   test-data/\n    dex-go/\n     edit-snippet.go\n     expected.go\n     original.go\n   agent-id-resolution.test.ts\n   agent-registry.test.ts\n   auto-topup.test.ts\n   credit-conversion.test.ts\n   fast-rewrite.test.ts\n   generate-diffs-prompt.test.ts\n   get-custom-file-picker-config.test.ts\n   live-user-inputs.test.ts\n   loop-agent-steps.test.ts\n   main-prompt.integration.test.ts\n   main-prompt.test.ts\n   process-file-block.test.ts\n   process-str-replace.test.ts\n   read-docs-tool.test.ts\n   request-files-prompt.test.ts\n   run-agent-step-tools.test.ts\n   run-programmatic-step.test.ts\n   sandbox-generator.test.ts\n   subagent-streaming.test.ts\n   test-utils.ts\n   tool-call-schema.test.ts\n   usage-calculation.test.ts\n   web-search-tool.test.ts\n   xml-stream-parser.test.ts\n  admin/\n   grade-runs.ts\n   relabelRuns.ts\n  api/\n   org.ts\n   usage.ts\n  context/\n   app-context.ts\n  find-files/\n   check-new-files-necessary.ts\n   custom-file-picker-config.ts\n   request-files-prompt.ts\n  llm-apis/\n   __tests__/\n    linkup-api.test.ts\n   vercel-ai-sdk/\n    ai-sdk.ts\n    openrouter.ts\n    vertex-finetuned.ts\n   claude.ts\n   context7-api.ts\n   gemini-with-fallbacks.ts\n   knowledge.md\n   linkup-api.ts\n   message-cost-tracker.ts\n   openai-api.ts\n   openrouter.ts\n   relace-api.ts\n  system-prompt/\n   agent-instructions.md\n   prompts.ts\n   save-agent-request.ts\n   search-system-prompt.ts\n   truncate-file-tree.ts\n  templates/\n   agents/\n    archive/\n     dry-run.ts\n    agent-builder.ts\n    ask.ts\n    base.ts\n    file-explorer.ts\n    file-picker.ts\n    planner.ts\n    researcher.ts\n    reviewer.ts\n    superagent.ts\n    thinker.ts\n    thinking-base.ts\n   agent-list.ts\n   agent-registry.ts\n   ask-prompts.ts\n   base-prompts.ts\n   prompts.ts\n   README.md\n   strings.ts\n   types.ts\n  tools/\n   definitions/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    list.ts\n    tool-def-type.ts\n   handlers/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    handler-function-type.ts\n    list.ts\n   constants.ts\n   prompts.ts\n   stream-parser.ts\n   tool-executor.ts\n  util/\n   __tests__/\n    messages.test.ts\n    object.test.ts\n    parse-tool-call-xml.test.ts\n    simplify-tool-results.test.ts\n    split-data.test.ts\n   check-auth.ts\n   debug.ts\n   file-resolver.ts\n   logger.ts\n   messages.ts\n   object.ts\n   parse-tool-call-xml.ts\n   quickjs-sandbox.ts\n   simplify-tool-results.ts\n   split-data.ts\n   token-counter.ts\n  websockets/\n   auth.ts\n   middleware.ts\n   request-context.ts\n   server.ts\n   switchboard.ts\n   websocket-action.ts\n  async-agent-manager.ts\n  check-terminal-command.ts\n  fast-rewrite.ts\n  generate-diffs-prompt.ts\n  get-documentation-for-query.ts\n  get-file-reading-updates.ts\n  index.ts\n  live-user-inputs.ts\n  loop-main-prompt.ts\n  main-prompt.ts\n  process-file-block.ts\n  process-str-replace.ts\n  prompt-agent-stream.ts\n  run-agent-step.ts\n  run-programmatic-step.ts\n  xml-stream-parser.ts\n .gitignore\n knowledge.md\n package.json\n README.md\n tsconfig.json\ncommon/\n src/\n  __tests__/\n   agent-validation.test.ts\n   dynamic-agent-template-schema.test.ts\n   handlesteps-parsing.test.ts\n  api-keys/\n   constants.ts\n   crypto.ts\n  constants/\n   agents.ts\n   analytics-events.ts\n   grant-priorities.ts\n  db/\n   migrations/\n    meta/\n     _journal.json\n     0000_snapshot.json\n     0001_snapshot.json\n     0002_snapshot.json\n     0003_snapshot.json\n     0004_snapshot.json\n     0005_snapshot.json\n     0006_snapshot.json\n     0007_snapshot.json\n     0008_snapshot.json\n     0009_snapshot.json\n     0010_snapshot.json\n     0011_snapshot.json\n     0012_snapshot.json\n     0013_snapshot.json\n     0014_snapshot.json\n     0015_snapshot.json\n     0016_snapshot.json\n     0017_snapshot.json\n     0018_snapshot.json\n     0019_snapshot.json\n     0020_snapshot.json\n     0021_snapshot.json\n     0026_snapshot.json\n     0027_snapshot.json\n     0028_snapshot.json\n    0000_overjoyed_thing.sql\n    0001_fuzzy_typhoid_mary.sql\n    0002_sticky_dormammu.sql\n    0003_military_owl.sql\n    0004_neat_pet_avengers.sql\n    0005_minor_the_professor.sql\n    0006_first_quasimodo.sql\n    0007_equal_warlock.sql\n    0008_puzzling_carnage.sql\n    0009_bitter_rumiko_fujikawa.sql\n    0010_overjoyed_red_skull.sql\n    0011_familiar_ezekiel_stane.sql\n    0012_fluffy_naoko.sql\n    0013_famous_risque.sql\n    0014_wakeful_sinister_six.sql\n    0015_stormy_zuras.sql\n    0016_clear_hairball.sql\n    0017_tricky_randall_flagg.sql\n    0018_stale_human_robot.sql\n    0019_amused_nebula.sql\n    0020_young_sleeper.sql\n    0021_tiny_marauders.sql\n    0026_chilly_mockingbird.sql\n    0027_sloppy_quasar.sql\n    0028_lush_johnny_blaze.sql\n   docker-compose.yml\n   drizzle.config.ts\n   index.ts\n   schema.knowledge.md\n   schema.ts\n   transaction.ts\n  json-config/\n   __tests__/\n    __snapshots__/\n     stringify-schema.test.ts.snap\n    constants.test.ts\n    stringify-schema.test.ts\n   constants.ts\n   default.ts\n   stringify-schema.ts\n  templates/\n   agent-validation.ts\n   dynamic-agent-functions.ts\n  testing/\n   mock-modules.ts\n  tools/\n   params/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n   compile-tool-definitions.ts\n   constants.ts\n   list.ts\n   utils.ts\n  types/\n   __tests__/\n    dynamic-agent-template.test.ts\n   api/\n    agents/\n     publish.ts\n   agent-template.ts\n   dynamic-agent-template.ts\n   grant.ts\n   message.ts\n   organization.ts\n   print-mode.ts\n   publisher.ts\n   referral.ts\n   session-state.ts\n   usage.ts\n  util/\n   __tests__/\n    messages.test.ts\n    partial-json-delta.test.ts\n    saxy.test.ts\n    string.test.ts\n   examples/\n    diff-reviewer-1.ts\n    diff-reviewer-2.ts\n    diff-reviewer-3.ts\n   agent-file-utils.ts\n   agent-name-normalization.ts\n   agent-name-resolver.ts\n   agent-template-validation.ts\n   array.ts\n   changes.ts\n   credentials.ts\n   currency.ts\n   dates.ts\n   error.ts\n   file.ts\n   git.ts\n   logger.ts\n   lru-cache.ts\n   messages.ts\n   min-heap.ts\n   model-utils.ts\n   object.ts\n   partial-json-delta.ts\n   patch.ts\n   promise.ts\n   random.ts\n   referral.ts\n   saxy.ts\n   string.knowledge.md\n   string.ts\n   stripe.ts\n   sync-failure.ts\n   xml.ts\n   zod-schema.ts\n  websockets/\n   websocket-client.ts\n   websocket-schema.ts\n  actions.ts\n  analytics.ts\n  browser-actions.ts\n  constants.ts\n  project-file-tree.ts\n knowledge.md\n package.json\n tsconfig.json\nevals/\n git-evals/\n  email-eval-results.ts\n  eval-levelcode.json\n  eval-manifold.json\n  eval-result-levelcode-mock.json\n  gen-evals.ts\n  judge-git-eval.ts\n  post-eval-analysis.ts\n  run-eval-set.ts\n  run-git-evals.ts\n  run-single-eval-process.ts\n  run-single-eval.ts\n  setup-test-repo.ts\n  types.ts\n .gitignore\n bun.lock\n constants.ts\n e2e-cat-app-script.ts\n knowledge.md\n package.json\n scaffolding.ts\n swe-bench-eval.ts\n swe-bench-ids.ts\n swe-bench.test.ts\n test-repos.json\n test-setup.ts\n tsconfig.json\nnpm-app/\n release/\n  index.js\n  package.json\n  README.md\n release-staging/\n  index.js\n  package.json\n  README.md\n scripts/\n  build-binary.js\n  generate-github-token.ts\n  patch-web-tree-sitter.ts\n  release.js\n  twitch-plays-levelcode.sh\n src/\n  __tests__/\n   display.test.ts\n   tool-handlers.test.ts\n  agents/\n   agent-utils.ts\n   load-agents.ts\n  checkpoints/\n   checkpoint-manager.ts\n   file-manager.ts\n  cli-handlers/\n   agent-creation-chat.ts\n   agents.ts\n   api-key.ts\n   checkpoint.ts\n   diff.ts\n   easter-egg.ts\n   inititalization-flow.ts\n   mini-chat.ts\n   publish.ts\n   subagent-list.ts\n   subagent.ts\n  display/\n   overrides.ts\n   print-mode.ts\n   squash-newlines.ts\n  json-config/\n   hooks.ts\n   parser.ts\n  native/\n   ripgrep.ts\n  terminal/\n   background.ts\n   run-command.ts\n  utils/\n   __tests__/\n    __snapshots__/\n     background-process-manager.test.ts.snap\n     frustration-detector.test.ts.snap\n     rage-detector.test.ts.snap\n     xml-stream-parser.test.ts.snap\n    background-process-manager.test.ts\n    rage-detector.test.ts\n    response-example-4-files.txt\n    tool-renderers.test.ts\n    xml-stream-parser.test.ts\n   agent-validation.ts\n   analytics.ts\n   detect-shell.ts\n   git.ts\n   logger.ts\n   rage-detector.ts\n   spinner.ts\n   suppress-console.ts\n   system-info.ts\n   terminal.ts\n   tool-renderers.ts\n   with-hang-detection.ts\n   xml-stream-parser.ts\n  workers/\n   checkpoint-worker.ts\n   project-context.ts\n  background-process-manager.ts\n  browser-runner.ts\n  chat-storage.ts\n  cli-definitions.ts\n  cli.ts\n  client.ts\n  config.ts\n  create-template-project.ts\n  credentials.ts\n  dev-process-manager.ts\n  diff-manager.ts\n  fingerprint.ts\n  index.ts\n  menu.ts\n  project-files.ts\n  rage-detectors.ts\n  startup-process-handler.ts\n  subagent-storage.ts\n  tool-handlers.ts\n  types.ts\n  web-scraper.ts\n .gitignore\n bunfig.toml\n package.json\n tsconfig.json\npackages/\n bigquery/\n  src/\n   client.ts\n   index.ts\n   schema.ts\n  knowledge.md\n  package.json\n  tsconfig.json\n billing/\n  src/\n   __tests__/\n    credit-delegation.test.ts\n    extract-owner-repo.test.ts\n    org-billing.test.ts\n   auto-topup.ts\n   balance-calculator.ts\n   billing.knowledge.md\n   conversion.ts\n   credit-delegation.ts\n   grant-credits.knowledge.md\n   grant-credits.ts\n   index.ts\n   org-billing.ts\n   org-monitoring.ts\n   usage-service.ts\n   utils.ts\n  knowledge.md\n  package.json\n  project.json\n  tsconfig.json\n build-tools/\n  executors/\n   infisical-run/\n    executor.ts\n    schema.json\n  executors.json\n  package.json\n  project.json\n  tsconfig.json\n code-map/\n  __tests__/\n   test-langs/\n    test.c\n    test.cpp\n    test.cs\n    test.go\n    test.java\n    test.js\n    test.php\n    test.py\n    test.rb\n    test.rs\n    test.ts\n   languages.test.ts\n   parse.test.ts\n  src/\n   tree-sitter-queries/\n    readme.md\n    tree-sitter-c_sharp-tags.scm\n    tree-sitter-c-tags.scm\n    tree-sitter-cpp-tags.scm\n    tree-sitter-go-tags.scm\n    tree-sitter-java-tags.scm\n    tree-sitter-javascript-tags.scm\n    tree-sitter-php-tags.scm\n    tree-sitter-python-tags.scm\n    tree-sitter-ruby-tags.scm\n    tree-sitter-rust-tags.scm\n    tree-sitter-typescript-tags.scm\n   index.ts\n   languages.ts\n   parse.ts\n  package.json\n  tsconfig.json\n internal/\n  src/\n   loops/\n    client.ts\n    index.ts\n    types.ts\n   openrouter-ai-sdk/\n    internal/\n     index.ts\n    schemas/\n     reasoning-details.ts\n    types/\n     index.ts\n     openrouter-chat-completions-input.ts\n     openrouter-chat-settings.ts\n    .gitignore\n    convert-to-openrouter-chat-messages.test.ts\n    convert-to-openrouter-chat-messages.ts\n    convert-to-openrouter-completion-prompt.ts\n    index.ts\n    map-openrouter-chat-logprobs.ts\n    map-openrouter-completion-logprobs.ts\n    map-openrouter-finish-reason.ts\n    openrouter-chat-language-model.test.ts\n    openrouter-chat-language-model.ts\n    openrouter-completion-language-model.test.ts\n    openrouter-completion-language-model.ts\n    openrouter-completion-settings.ts\n    openrouter-error.ts\n    openrouter-facade.ts\n    openrouter-provider-options.test.ts\n    openrouter-provider.ts\n    openrouter-stream-usage-accounting.test.ts\n    openrouter-usage-accounting.test.ts\n   utils/\n    __tests__/\n     version-utils.test.ts\n    auth.ts\n    version-utils.ts\n    xml-parser.ts\n   env.ts\n   index.ts\n   knowledge.md\n  package.json\n  tsconfig.json\npython-app/\n src/\n  levelcode/\n   __init__.py\n .gitignore\n knowledge.md\n LICENSE\n pyproject.toml\n README.md\nscripts/\n changelog/\n  2025-05-18-version-10283-release-enhanced-assistant-experience-system-stability.mdx\n  2025-05-25-version-10295-enhanced-ai-models-and-user-experience-improvements.mdx\n  2025-06-01-version-10305-release-enhanced-ai-models-new-commands-and-performance-improvements.mdx\n  docs.json\n ft-file-selection/\n  .gitignore\n  collect-tuning-data.ts\n  grade-traces.ts\n  print-recent-relabels.ts\n  print-recent-traces.ts\n  README.md\n  relabel-for-offline-scoring.ts\n  relabel-traces-with-context.ts\n  relabel-traces.ts\n .gitignore\n analyze-edit-blocks.ts\n analyze-model-usage.ts\n apply-credit-migration.ts\n calculate-average-spend.ts\n calculate-dau.ts\n calculate-monthly-usage.ts\n calculate-mrr.ts\n calculate-weekly-usage.ts\n cleanup-worktree.sh\n convert-escaped-newlines.ts\n count-edit-file.ts\n debug-log-subset.ts\n dev.sh\n export-user-emails.ts\n generate-ci-env.js\n generate-tool-definitions.ts\n get-changelog.ts\n init-worktree.ts\n package.json\n tsconfig.json\n update-stripe-subscriptions.ts\nsdk/\n scripts/\n  publish.js\n src/\n  tools/\n   change-file.ts\n   read-files.ts\n  types/\n   agent-definition.ts\n   tools.ts\n  client.ts\n  constants.ts\n  index.ts\n  process-stream.ts\n  websocket-client.ts\n .npmignore\n CHANGELOG.md\n package.json\n PUBLISHING.md\n README.md\n tsconfig.json\nweb/\n public/\n  levelcode-intro1.webm\n scripts/\n  discord/\n   index.ts\n   register-commands.ts\n src/\n  __tests__/\n   e2e/\n    home.spec.ts\n   unit/\n    home.spec.tsx\n  actions/\n   hello-action.ts\n  app/\n   [sponsee]/\n    page.tsx\n   admin/\n    file-picker/\n     page.tsx\n    orgs/\n     page.tsx\n    traces/\n     components/\n      chat-message.tsx\n      client-session-viewer.tsx\n      empty-state.tsx\n      error-boundary.tsx\n      loading-skeletons.tsx\n      timeline-chart.module.css\n      timeline-chart.tsx\n      trace-viewer.tsx\n     utils/\n      __tests__/\n       trace-processing.test.ts\n      trace-processing.ts\n     page.tsx\n    layout.tsx\n   affiliates/\n    actions.ts\n    page.tsx\n   agents/\n    page.tsx\n   api/\n    admin/\n     orgs/\n      [orgId]/\n       features/\n        [feature]/\n         route.ts\n      export/\n       route.ts\n      route.ts\n     relabel-for-user/\n      route.ts\n     traces/\n      [clientRequestId]/\n       messages/\n        route.ts\n       timeline/\n        route.ts\n      client/\n       [clientId]/\n        sessions/\n         route.ts\n     admin-auth.ts\n    agents/\n     [publisherId]/\n      [agentId]/\n       [version]/\n        route.ts\n       latest/\n        route.ts\n     publish/\n      route.ts\n     validate/\n      route.ts\n     route.ts\n    api-keys/\n     route.ts\n    auth/\n     [...nextauth]/\n      auth-options.ts\n      route.ts\n     cli/\n      code/\n       route.ts\n      logout/\n       route.ts\n      status/\n       route.ts\n    feed/\n     route.ts\n    git-evals/\n     visibility/\n      route.ts\n     route.ts\n    healthz/\n     route.ts\n    invites/\n     [token]/\n      route.ts\n    orgs/\n     [orgId]/\n      alerts/\n       [alertId]/\n        dismiss/\n         route.ts\n       route.ts\n      analytics/\n       export/\n        route.ts\n       route.ts\n      billing/\n       setup/\n        route.ts\n       status/\n        route.ts\n       subscription/\n        route.ts\n      credits/\n       route.ts\n      invitations/\n       [email]/\n        resend/\n         route.ts\n        route.ts\n       bulk/\n        route.ts\n       route.ts\n      members/\n       [userId]/\n        route.ts\n       route.ts\n      monitoring/\n       route.ts\n      publishers/\n       route.ts\n      repos/\n       [repoId]/\n        route.ts\n       route.ts\n      settings/\n       route.ts\n      usage/\n       export/\n        route.ts\n       route.ts\n      route.ts\n     slug/\n      [slug]/\n       route.ts\n     route.ts\n    publishers/\n     [id]/\n      organization/\n       route.ts\n     validate/\n      route.ts\n     route.ts\n    referrals/\n     [code]/\n      route.ts\n     helpers.ts\n     route.ts\n    stripe/\n     buy-credits/\n      route.ts\n     webhook/\n      route.ts\n    upload/\n     avatar/\n      route.ts\n    user/\n     auto-topup/\n      route.ts\n     profile/\n      route.ts\n     usage/\n      route.ts\n   config/\n    page.tsx\n   docs/\n    [category]/\n     layout.tsx\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   evals/\n    evals-table.tsx\n    page.tsx\n   invites/\n    [token]/\n     page.tsx\n   login/\n    page.tsx\n   onboard/\n    page.tsx\n   orgs/\n    [slug]/\n     analytics/\n      page.tsx\n     billing/\n      purchase/\n       page.tsx\n      setup/\n       page.tsx\n     repositories/\n      page.tsx\n     settings/\n      page.tsx\n     team/\n      page.tsx\n     usage/\n      page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   payment-success/\n    page.tsx\n   pricing/\n    page.tsx\n   privacy-policy/\n    page.tsx\n   publishers/\n    [id]/\n     agents/\n      [agentId]/\n       [version]/\n        page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   referrals/\n    [code]/\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   terms-of-service/\n    page.tsx\n   usage/\n    layout.tsx\n    page.tsx\n    usage-display.tsx\n   analytics.knowledge.md\n   layout.tsx\n   page.tsx\n   robots.ts\n   sitemap.ts\n  components/\n   agent/\n    json-viewer.tsx\n   auto-topup/\n    AutoTopupSettings.tsx\n    AutoTopupSettingsForm.tsx\n    AutoTopupSwitch.tsx\n    BaseAutoTopupSettings.tsx\n    BaseAutoTopupSettingsForm.tsx\n    BaseAutoTopupSwitch.tsx\n    constants.ts\n    OrgAutoTopupSettings.tsx\n    OrgAutoTopupSettingsForm.tsx\n    OrgAutoTopupSwitch.tsx\n    types.ts\n   credits/\n    CreditManagementSection.tsx\n    CreditPurchaseSection.tsx\n   docs/\n    mdx/\n     code-demo.tsx\n     custom-link.tsx\n     markdown-table.tsx\n     mdx-components.tsx\n     mermaid-diagram.tsx\n     schema-display.tsx\n    copy-heading.tsx\n    doc-sidebar.tsx\n    docs.knowledge.md\n    toc.tsx\n   login/\n    login-card.tsx\n    login-client-wrapper.tsx\n   navbar/\n    navbar.tsx\n    user-dropdown.tsx\n   organization/\n    advanced-monitor.tsx\n    billing-alerts.tsx\n    billing-reports.tsx\n    billing-status.tsx\n    credit-monitor.tsx\n    model-config-sheet.tsx\n    organization-success-modal.tsx\n    repository-management.tsx\n    team-management.tsx\n   providers/\n    query-client-provider.tsx\n   publisher/\n    basic-info-step.tsx\n    ownership-step.tsx\n    profile-details-step.tsx\n    step-template.tsx\n   sign-in/\n    sign-in-button.tsx\n    sign-in-card-footer.tsx\n   ui/\n    landing/\n     competition/\n      claude-code.tsx\n      cline.tsx\n      cursor.tsx\n      github-copilot.tsx\n      index.tsx\n      tabs.tsx\n     feature/\n      browser-comparison.tsx\n      chart-illustration.tsx\n      code-illustration.tsx\n      highlight-text.tsx\n      index.tsx\n      workflow-illustration.tsx\n     animated-element.tsx\n     constants.ts\n     cta-section.tsx\n     demo-code-display.tsx\n     testimonials-section.tsx\n     types.ts\n    terminal/\n     index.tsx\n     style.css\n     terminal-input.tsx\n     terminal-output.tsx\n    avatar-upload.tsx\n    background-beams.tsx\n    badge.tsx\n    banner.tsx\n    button.tsx\n    card.tsx\n    collapsible.tsx\n    credit-confetti.tsx\n    decorative-blocks.tsx\n    dialog.tsx\n    dropdown-menu.tsx\n    enhanced-copy-button.tsx\n    footer.tsx\n    hero-buttons.tsx\n    hero.tsx\n    input.tsx\n    install-dialog.tsx\n    label.tsx\n    neon-gradient-button.tsx\n    progress.tsx\n    radio-group.tsx\n    section.tsx\n    select.tsx\n    separator.tsx\n    sheet.tsx\n    sidebar.tsx\n    skeleton-loading.tsx\n    skeleton.tsx\n    slider.tsx\n    switch.tsx\n    table.tsx\n    tabs.tsx\n    textarea.tsx\n    toast.tsx\n    toaster.tsx\n    tooltip.tsx\n    use-toast.ts\n   BrowserPreview.tsx\n   card-with-beams.tsx\n   CookieConsentCard.tsx\n   footer.tsx\n   icons.tsx\n   IDEDemo.tsx\n   layout-wrapper.tsx\n   TerminalDemo.tsx\n   theme-provider.tsx\n   theme-switcher.tsx\n  content/\n   advanced/\n    claude-code-comparison.mdx\n    config.mdx\n    how-does-it-work.mdx\n    large-projects.mdx\n    troubleshooting.mdx\n    what-models.mdx\n   agents/\n    agent-reference.mdx\n    creating-new-agents.mdx\n    customizing-agents.mdx\n    overview.mdx\n    troubleshooting-agent-customization.mdx\n   case-studies/\n    _cta.mdx\n    benjamin-bryant.mdx\n    oliver-lukesch.mdx\n   help/\n    faq.mdx\n    getting-started.mdx\n   tips/\n    best-practices.mdx\n    keyboard-shortcuts.mdx\n    knowledge-files.mdx\n    other-use-cases.mdx\n    version-control.mdx\n    where-levelcode-shines.mdx\n  discord/\n   client.ts\n   rate-limiter.ts\n  hooks/\n   use-auto-topup.ts\n   use-install-dialog.ts\n   use-mobile.tsx\n   use-model-config.ts\n   use-org-auto-topup.ts\n   use-organization-data.ts\n   use-user-profile.ts\n  lib/\n   server/\n    referral.ts\n   validators/\n    publisher.ts\n   admin-auth.ts\n   constant.ts\n   currency.ts\n   docs.ts\n   fonts.ts\n   organization-permissions.ts\n   PostHogProvider.tsx\n   publisher-permissions.ts\n   remark-code-to-codedemo.ts\n   server-init.ts\n   SessionProvider.tsx\n   stripe-utils.ts\n   testimonials.ts\n   trackConversions.ts\n   utils.ts\n  styles/\n   globals.css\n  types/\n   docs.ts\n   user.ts\n  util/\n   logger.ts\n .eslintignore\n .eslintrc.js\n .gitignore\n .prettierignore\n .prettierrc.js\n commitlint.config.js\n components.json\n contentlayer.config.ts\n jest.config.js\n jest.setup.js\n knowledge.md\n next.config.mjs\n package.json\n playwright.config.ts\n postcss.config.cjs\n README.md\n tailwind.config.ts\n tsconfig.json\n.envrc\n.gitignore\n.infisical.json\n.prettierrc\nauthentication.knowledge.md\nbun.lock\nbunfig.toml\nlevelcode.json\neslint.config.js\nknowledge.md\npackage.json\nREADME.md\ntsconfig.base.json\ntsconfig.json\nWINDOWS.md\n",
              "tokenCount": 9007,
              "truncationLevel": "none"
            }
          ]
        }
      ],
      "parentAgentId": "D-Up4CDP0Kk"
    },
    {
      "type": "tool_call",
      "toolCallId": "c798b34d-ac9d-49e2-9c70-e16fb2d9c220",
      "toolName": "read_subtree",
      "input": {
        "paths": [],
        "maxTokens": 500000
      },
      "agentId": "D-Up8asoMmA",
      "parentAgentId": "D-UppvyfWNM",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "c798b34d-ac9d-49e2-9c70-e16fb2d9c220",
      "toolName": "read_subtree",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": ".",
              "type": "directory",
              "printedTree": ".agents/\n examples/\n  diff-reviewer-1.ts\n  diff-reviewer-2.ts\n  diff-reviewer-3.ts\n opensource/\n  base.ts\n  coder.ts\n  file-picker.ts\n  researcher.ts\n  reviewer.ts\n  thinker.ts\n ask.ts\n base-experimental.ts\n base-lite.ts\n base-max.ts\n base.ts\n brainstormer.ts\n changes-reviewer.ts\n charles.ts\n claude4-gemini-thinking.ts\n constants.ts\n file-explorer.ts\n file-picker.ts\n git-committer.ts\n knowledge-keeper.ts\n planner.ts\n researcher.ts\n reviewer.ts\n superagent.ts\n thinker.ts\n.bin/\n bun\n.github/\n workflows/\n  ci.yml\n  evals.yml\n  nightly-evals.yml\n  npm-app-release-build.yml\n  npm-app-release-prod.yml\n  npm-app-release-staging.yml\n .gitignore\n CODEOWNERS\n knowledge.md\n.vscode/\n settings.json\nbackend/\n src/\n  __tests__/\n   test-data/\n    dex-go/\n     edit-snippet.go\n     expected.go\n     original.go\n   agent-id-resolution.test.ts\n   agent-registry.test.ts\n   auto-topup.test.ts\n   credit-conversion.test.ts\n   fast-rewrite.test.ts\n   generate-diffs-prompt.test.ts\n   get-custom-file-picker-config.test.ts\n   live-user-inputs.test.ts\n   loop-agent-steps.test.ts\n   main-prompt.integration.test.ts\n   main-prompt.test.ts\n   process-file-block.test.ts\n   process-str-replace.test.ts\n   read-docs-tool.test.ts\n   request-files-prompt.test.ts\n   run-agent-step-tools.test.ts\n   run-programmatic-step.test.ts\n   sandbox-generator.test.ts\n   subagent-streaming.test.ts\n   test-utils.ts\n   tool-call-schema.test.ts\n   usage-calculation.test.ts\n   web-search-tool.test.ts\n   xml-stream-parser.test.ts\n  admin/\n   grade-runs.ts\n   relabelRuns.ts\n  api/\n   org.ts\n   usage.ts\n  context/\n   app-context.ts\n  find-files/\n   check-new-files-necessary.ts\n   custom-file-picker-config.ts\n   request-files-prompt.ts\n  llm-apis/\n   __tests__/\n    linkup-api.test.ts\n   vercel-ai-sdk/\n    ai-sdk.ts\n    openrouter.ts\n    vertex-finetuned.ts\n   claude.ts\n   context7-api.ts\n   gemini-with-fallbacks.ts\n   knowledge.md\n   linkup-api.ts\n   message-cost-tracker.ts\n   openai-api.ts\n   openrouter.ts\n   relace-api.ts\n  system-prompt/\n   agent-instructions.md\n   prompts.ts\n   save-agent-request.ts\n   search-system-prompt.ts\n   truncate-file-tree.ts\n  templates/\n   agents/\n    archive/\n     dry-run.ts\n    agent-builder.ts\n    ask.ts\n    base.ts\n    file-explorer.ts\n    file-picker.ts\n    planner.ts\n    researcher.ts\n    reviewer.ts\n    superagent.ts\n    thinker.ts\n    thinking-base.ts\n   agent-list.ts\n   agent-registry.ts\n   ask-prompts.ts\n   base-prompts.ts\n   prompts.ts\n   README.md\n   strings.ts\n   types.ts\n  tools/\n   definitions/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    list.ts\n    tool-def-type.ts\n   handlers/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    handler-function-type.ts\n    list.ts\n   constants.ts\n   prompts.ts\n   stream-parser.ts\n   tool-executor.ts\n  util/\n   __tests__/\n    messages.test.ts\n    object.test.ts\n    parse-tool-call-xml.test.ts\n    simplify-tool-results.test.ts\n    split-data.test.ts\n   check-auth.ts\n   debug.ts\n   file-resolver.ts\n   logger.ts\n   messages.ts\n   object.ts\n   parse-tool-call-xml.ts\n   quickjs-sandbox.ts\n   simplify-tool-results.ts\n   split-data.ts\n   token-counter.ts\n  websockets/\n   auth.ts\n   middleware.ts\n   request-context.ts\n   server.ts\n   switchboard.ts\n   websocket-action.ts\n  async-agent-manager.ts\n  check-terminal-command.ts\n  fast-rewrite.ts\n  generate-diffs-prompt.ts\n  get-documentation-for-query.ts\n  get-file-reading-updates.ts\n  index.ts\n  live-user-inputs.ts\n  loop-main-prompt.ts\n  main-prompt.ts\n  process-file-block.ts\n  process-str-replace.ts\n  prompt-agent-stream.ts\n  run-agent-step.ts\n  run-programmatic-step.ts\n  xml-stream-parser.ts\n .gitignore\n knowledge.md\n package.json\n README.md\n tsconfig.json\ncommon/\n src/\n  __tests__/\n   agent-validation.test.ts\n   dynamic-agent-template-schema.test.ts\n   handlesteps-parsing.test.ts\n  api-keys/\n   constants.ts\n   crypto.ts\n  constants/\n   agents.ts\n   analytics-events.ts\n   grant-priorities.ts\n  db/\n   migrations/\n    meta/\n     _journal.json\n     0000_snapshot.json\n     0001_snapshot.json\n     0002_snapshot.json\n     0003_snapshot.json\n     0004_snapshot.json\n     0005_snapshot.json\n     0006_snapshot.json\n     0007_snapshot.json\n     0008_snapshot.json\n     0009_snapshot.json\n     0010_snapshot.json\n     0011_snapshot.json\n     0012_snapshot.json\n     0013_snapshot.json\n     0014_snapshot.json\n     0015_snapshot.json\n     0016_snapshot.json\n     0017_snapshot.json\n     0018_snapshot.json\n     0019_snapshot.json\n     0020_snapshot.json\n     0021_snapshot.json\n     0026_snapshot.json\n     0027_snapshot.json\n     0028_snapshot.json\n    0000_overjoyed_thing.sql\n    0001_fuzzy_typhoid_mary.sql\n    0002_sticky_dormammu.sql\n    0003_military_owl.sql\n    0004_neat_pet_avengers.sql\n    0005_minor_the_professor.sql\n    0006_first_quasimodo.sql\n    0007_equal_warlock.sql\n    0008_puzzling_carnage.sql\n    0009_bitter_rumiko_fujikawa.sql\n    0010_overjoyed_red_skull.sql\n    0011_familiar_ezekiel_stane.sql\n    0012_fluffy_naoko.sql\n    0013_famous_risque.sql\n    0014_wakeful_sinister_six.sql\n    0015_stormy_zuras.sql\n    0016_clear_hairball.sql\n    0017_tricky_randall_flagg.sql\n    0018_stale_human_robot.sql\n    0019_amused_nebula.sql\n    0020_young_sleeper.sql\n    0021_tiny_marauders.sql\n    0026_chilly_mockingbird.sql\n    0027_sloppy_quasar.sql\n    0028_lush_johnny_blaze.sql\n   docker-compose.yml\n   drizzle.config.ts\n   index.ts\n   schema.knowledge.md\n   schema.ts\n   transaction.ts\n  json-config/\n   __tests__/\n    __snapshots__/\n     stringify-schema.test.ts.snap\n    constants.test.ts\n    stringify-schema.test.ts\n   constants.ts\n   default.ts\n   stringify-schema.ts\n  templates/\n   agent-validation.ts\n   dynamic-agent-functions.ts\n  testing/\n   mock-modules.ts\n  tools/\n   params/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n   compile-tool-definitions.ts\n   constants.ts\n   list.ts\n   utils.ts\n  types/\n   __tests__/\n    dynamic-agent-template.test.ts\n   api/\n    agents/\n     publish.ts\n   agent-template.ts\n   dynamic-agent-template.ts\n   grant.ts\n   message.ts\n   organization.ts\n   print-mode.ts\n   publisher.ts\n   referral.ts\n   session-state.ts\n   usage.ts\n  util/\n   __tests__/\n    messages.test.ts\n    partial-json-delta.test.ts\n    saxy.test.ts\n    string.test.ts\n   examples/\n    diff-reviewer-1.ts\n    diff-reviewer-2.ts\n    diff-reviewer-3.ts\n   agent-file-utils.ts\n   agent-name-normalization.ts\n   agent-name-resolver.ts\n   agent-template-validation.ts\n   array.ts\n   changes.ts\n   credentials.ts\n   currency.ts\n   dates.ts\n   error.ts\n   file.ts\n   git.ts\n   logger.ts\n   lru-cache.ts\n   messages.ts\n   min-heap.ts\n   model-utils.ts\n   object.ts\n   partial-json-delta.ts\n   patch.ts\n   promise.ts\n   random.ts\n   referral.ts\n   saxy.ts\n   string.knowledge.md\n   string.ts\n   stripe.ts\n   sync-failure.ts\n   xml.ts\n   zod-schema.ts\n  websockets/\n   websocket-client.ts\n   websocket-schema.ts\n  actions.ts\n  analytics.ts\n  browser-actions.ts\n  constants.ts\n  project-file-tree.ts\n knowledge.md\n package.json\n tsconfig.json\nevals/\n git-evals/\n  email-eval-results.ts\n  eval-levelcode.json\n  eval-manifold.json\n  eval-result-levelcode-mock.json\n  gen-evals.ts\n  judge-git-eval.ts\n  post-eval-analysis.ts\n  run-eval-set.ts\n  run-git-evals.ts\n  run-single-eval-process.ts\n  run-single-eval.ts\n  setup-test-repo.ts\n  types.ts\n .gitignore\n bun.lock\n constants.ts\n e2e-cat-app-script.ts\n knowledge.md\n package.json\n scaffolding.ts\n swe-bench-eval.ts\n swe-bench-ids.ts\n swe-bench.test.ts\n test-repos.json\n test-setup.ts\n tsconfig.json\nnpm-app/\n release/\n  index.js\n  package.json\n  README.md\n release-staging/\n  index.js\n  package.json\n  README.md\n scripts/\n  build-binary.js\n  generate-github-token.ts\n  patch-web-tree-sitter.ts\n  release.js\n  twitch-plays-levelcode.sh\n src/\n  __tests__/\n   display.test.ts\n   tool-handlers.test.ts\n  agents/\n   agent-utils.ts\n   load-agents.ts\n  checkpoints/\n   checkpoint-manager.ts\n   file-manager.ts\n  cli-handlers/\n   agent-creation-chat.ts\n   agents.ts\n   api-key.ts\n   checkpoint.ts\n   diff.ts\n   easter-egg.ts\n   inititalization-flow.ts\n   mini-chat.ts\n   publish.ts\n   subagent-list.ts\n   subagent.ts\n  display/\n   overrides.ts\n   print-mode.ts\n   squash-newlines.ts\n  json-config/\n   hooks.ts\n   parser.ts\n  native/\n   ripgrep.ts\n  terminal/\n   background.ts\n   run-command.ts\n  utils/\n   __tests__/\n    __snapshots__/\n     background-process-manager.test.ts.snap\n     frustration-detector.test.ts.snap\n     rage-detector.test.ts.snap\n     xml-stream-parser.test.ts.snap\n    background-process-manager.test.ts\n    rage-detector.test.ts\n    response-example-4-files.txt\n    tool-renderers.test.ts\n    xml-stream-parser.test.ts\n   agent-validation.ts\n   analytics.ts\n   detect-shell.ts\n   git.ts\n   logger.ts\n   rage-detector.ts\n   spinner.ts\n   suppress-console.ts\n   system-info.ts\n   terminal.ts\n   tool-renderers.ts\n   with-hang-detection.ts\n   xml-stream-parser.ts\n  workers/\n   checkpoint-worker.ts\n   project-context.ts\n  background-process-manager.ts\n  browser-runner.ts\n  chat-storage.ts\n  cli-definitions.ts\n  cli.ts\n  client.ts\n  config.ts\n  create-template-project.ts\n  credentials.ts\n  dev-process-manager.ts\n  diff-manager.ts\n  fingerprint.ts\n  index.ts\n  menu.ts\n  project-files.ts\n  rage-detectors.ts\n  startup-process-handler.ts\n  subagent-storage.ts\n  tool-handlers.ts\n  types.ts\n  web-scraper.ts\n .gitignore\n bunfig.toml\n package.json\n tsconfig.json\npackages/\n bigquery/\n  src/\n   client.ts\n   index.ts\n   schema.ts\n  knowledge.md\n  package.json\n  tsconfig.json\n billing/\n  src/\n   __tests__/\n    credit-delegation.test.ts\n    extract-owner-repo.test.ts\n    org-billing.test.ts\n   auto-topup.ts\n   balance-calculator.ts\n   billing.knowledge.md\n   conversion.ts\n   credit-delegation.ts\n   grant-credits.knowledge.md\n   grant-credits.ts\n   index.ts\n   org-billing.ts\n   org-monitoring.ts\n   usage-service.ts\n   utils.ts\n  knowledge.md\n  package.json\n  project.json\n  tsconfig.json\n build-tools/\n  executors/\n   infisical-run/\n    executor.ts\n    schema.json\n  executors.json\n  package.json\n  project.json\n  tsconfig.json\n code-map/\n  __tests__/\n   test-langs/\n    test.c\n    test.cpp\n    test.cs\n    test.go\n    test.java\n    test.js\n    test.php\n    test.py\n    test.rb\n    test.rs\n    test.ts\n   languages.test.ts\n   parse.test.ts\n  src/\n   tree-sitter-queries/\n    readme.md\n    tree-sitter-c_sharp-tags.scm\n    tree-sitter-c-tags.scm\n    tree-sitter-cpp-tags.scm\n    tree-sitter-go-tags.scm\n    tree-sitter-java-tags.scm\n    tree-sitter-javascript-tags.scm\n    tree-sitter-php-tags.scm\n    tree-sitter-python-tags.scm\n    tree-sitter-ruby-tags.scm\n    tree-sitter-rust-tags.scm\n    tree-sitter-typescript-tags.scm\n   index.ts\n   languages.ts\n   parse.ts\n  package.json\n  tsconfig.json\n internal/\n  src/\n   loops/\n    client.ts\n    index.ts\n    types.ts\n   openrouter-ai-sdk/\n    internal/\n     index.ts\n    schemas/\n     reasoning-details.ts\n    types/\n     index.ts\n     openrouter-chat-completions-input.ts\n     openrouter-chat-settings.ts\n    .gitignore\n    convert-to-openrouter-chat-messages.test.ts\n    convert-to-openrouter-chat-messages.ts\n    convert-to-openrouter-completion-prompt.ts\n    index.ts\n    map-openrouter-chat-logprobs.ts\n    map-openrouter-completion-logprobs.ts\n    map-openrouter-finish-reason.ts\n    openrouter-chat-language-model.test.ts\n    openrouter-chat-language-model.ts\n    openrouter-completion-language-model.test.ts\n    openrouter-completion-language-model.ts\n    openrouter-completion-settings.ts\n    openrouter-error.ts\n    openrouter-facade.ts\n    openrouter-provider-options.test.ts\n    openrouter-provider.ts\n    openrouter-stream-usage-accounting.test.ts\n    openrouter-usage-accounting.test.ts\n   utils/\n    __tests__/\n     version-utils.test.ts\n    auth.ts\n    version-utils.ts\n    xml-parser.ts\n   env.ts\n   index.ts\n   knowledge.md\n  package.json\n  tsconfig.json\npython-app/\n src/\n  levelcode/\n   __init__.py\n .gitignore\n knowledge.md\n LICENSE\n pyproject.toml\n README.md\nscripts/\n changelog/\n  2025-05-18-version-10283-release-enhanced-assistant-experience-system-stability.mdx\n  2025-05-25-version-10295-enhanced-ai-models-and-user-experience-improvements.mdx\n  2025-06-01-version-10305-release-enhanced-ai-models-new-commands-and-performance-improvements.mdx\n  docs.json\n ft-file-selection/\n  .gitignore\n  collect-tuning-data.ts\n  grade-traces.ts\n  print-recent-relabels.ts\n  print-recent-traces.ts\n  README.md\n  relabel-for-offline-scoring.ts\n  relabel-traces-with-context.ts\n  relabel-traces.ts\n .gitignore\n analyze-edit-blocks.ts\n analyze-model-usage.ts\n apply-credit-migration.ts\n calculate-average-spend.ts\n calculate-dau.ts\n calculate-monthly-usage.ts\n calculate-mrr.ts\n calculate-weekly-usage.ts\n cleanup-worktree.sh\n convert-escaped-newlines.ts\n count-edit-file.ts\n debug-log-subset.ts\n dev.sh\n export-user-emails.ts\n generate-ci-env.js\n generate-tool-definitions.ts\n get-changelog.ts\n init-worktree.ts\n package.json\n tsconfig.json\n update-stripe-subscriptions.ts\nsdk/\n scripts/\n  publish.js\n src/\n  tools/\n   change-file.ts\n   read-files.ts\n  types/\n   agent-definition.ts\n   tools.ts\n  client.ts\n  constants.ts\n  index.ts\n  process-stream.ts\n  websocket-client.ts\n .npmignore\n CHANGELOG.md\n package.json\n PUBLISHING.md\n README.md\n tsconfig.json\nweb/\n public/\n  levelcode-intro1.webm\n scripts/\n  discord/\n   index.ts\n   register-commands.ts\n src/\n  __tests__/\n   e2e/\n    home.spec.ts\n   unit/\n    home.spec.tsx\n  actions/\n   hello-action.ts\n  app/\n   [sponsee]/\n    page.tsx\n   admin/\n    file-picker/\n     page.tsx\n    orgs/\n     page.tsx\n    traces/\n     components/\n      chat-message.tsx\n      client-session-viewer.tsx\n      empty-state.tsx\n      error-boundary.tsx\n      loading-skeletons.tsx\n      timeline-chart.module.css\n      timeline-chart.tsx\n      trace-viewer.tsx\n     utils/\n      __tests__/\n       trace-processing.test.ts\n      trace-processing.ts\n     page.tsx\n    layout.tsx\n   affiliates/\n    actions.ts\n    page.tsx\n   agents/\n    page.tsx\n   api/\n    admin/\n     orgs/\n      [orgId]/\n       features/\n        [feature]/\n         route.ts\n      export/\n       route.ts\n      route.ts\n     relabel-for-user/\n      route.ts\n     traces/\n      [clientRequestId]/\n       messages/\n        route.ts\n       timeline/\n        route.ts\n      client/\n       [clientId]/\n        sessions/\n         route.ts\n     admin-auth.ts\n    agents/\n     [publisherId]/\n      [agentId]/\n       [version]/\n        route.ts\n       latest/\n        route.ts\n     publish/\n      route.ts\n     validate/\n      route.ts\n     route.ts\n    api-keys/\n     route.ts\n    auth/\n     [...nextauth]/\n      auth-options.ts\n      route.ts\n     cli/\n      code/\n       route.ts\n      logout/\n       route.ts\n      status/\n       route.ts\n    feed/\n     route.ts\n    git-evals/\n     visibility/\n      route.ts\n     route.ts\n    healthz/\n     route.ts\n    invites/\n     [token]/\n      route.ts\n    orgs/\n     [orgId]/\n      alerts/\n       [alertId]/\n        dismiss/\n         route.ts\n       route.ts\n      analytics/\n       export/\n        route.ts\n       route.ts\n      billing/\n       setup/\n        route.ts\n       status/\n        route.ts\n       subscription/\n        route.ts\n      credits/\n       route.ts\n      invitations/\n       [email]/\n        resend/\n         route.ts\n        route.ts\n       bulk/\n        route.ts\n       route.ts\n      members/\n       [userId]/\n        route.ts\n       route.ts\n      monitoring/\n       route.ts\n      publishers/\n       route.ts\n      repos/\n       [repoId]/\n        route.ts\n       route.ts\n      settings/\n       route.ts\n      usage/\n       export/\n        route.ts\n       route.ts\n      route.ts\n     slug/\n      [slug]/\n       route.ts\n     route.ts\n    publishers/\n     [id]/\n      organization/\n       route.ts\n     validate/\n      route.ts\n     route.ts\n    referrals/\n     [code]/\n      route.ts\n     helpers.ts\n     route.ts\n    stripe/\n     buy-credits/\n      route.ts\n     webhook/\n      route.ts\n    upload/\n     avatar/\n      route.ts\n    user/\n     auto-topup/\n      route.ts\n     profile/\n      route.ts\n     usage/\n      route.ts\n   config/\n    page.tsx\n   docs/\n    [category]/\n     layout.tsx\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   evals/\n    evals-table.tsx\n    page.tsx\n   invites/\n    [token]/\n     page.tsx\n   login/\n    page.tsx\n   onboard/\n    page.tsx\n   orgs/\n    [slug]/\n     analytics/\n      page.tsx\n     billing/\n      purchase/\n       page.tsx\n      setup/\n       page.tsx\n     repositories/\n      page.tsx\n     settings/\n      page.tsx\n     team/\n      page.tsx\n     usage/\n      page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   payment-success/\n    page.tsx\n   pricing/\n    page.tsx\n   privacy-policy/\n    page.tsx\n   publishers/\n    [id]/\n     agents/\n      [agentId]/\n       [version]/\n        page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   referrals/\n    [code]/\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   terms-of-service/\n    page.tsx\n   usage/\n    layout.tsx\n    page.tsx\n    usage-display.tsx\n   analytics.knowledge.md\n   layout.tsx\n   page.tsx\n   robots.ts\n   sitemap.ts\n  components/\n   agent/\n    json-viewer.tsx\n   auto-topup/\n    AutoTopupSettings.tsx\n    AutoTopupSettingsForm.tsx\n    AutoTopupSwitch.tsx\n    BaseAutoTopupSettings.tsx\n    BaseAutoTopupSettingsForm.tsx\n    BaseAutoTopupSwitch.tsx\n    constants.ts\n    OrgAutoTopupSettings.tsx\n    OrgAutoTopupSettingsForm.tsx\n    OrgAutoTopupSwitch.tsx\n    types.ts\n   credits/\n    CreditManagementSection.tsx\n    CreditPurchaseSection.tsx\n   docs/\n    mdx/\n     code-demo.tsx\n     custom-link.tsx\n     markdown-table.tsx\n     mdx-components.tsx\n     mermaid-diagram.tsx\n     schema-display.tsx\n    copy-heading.tsx\n    doc-sidebar.tsx\n    docs.knowledge.md\n    toc.tsx\n   login/\n    login-card.tsx\n    login-client-wrapper.tsx\n   navbar/\n    navbar.tsx\n    user-dropdown.tsx\n   organization/\n    advanced-monitor.tsx\n    billing-alerts.tsx\n    billing-reports.tsx\n    billing-status.tsx\n    credit-monitor.tsx\n    model-config-sheet.tsx\n    organization-success-modal.tsx\n    repository-management.tsx\n    team-management.tsx\n   providers/\n    query-client-provider.tsx\n   publisher/\n    basic-info-step.tsx\n    ownership-step.tsx\n    profile-details-step.tsx\n    step-template.tsx\n   sign-in/\n    sign-in-button.tsx\n    sign-in-card-footer.tsx\n   ui/\n    landing/\n     competition/\n      claude-code.tsx\n      cline.tsx\n      cursor.tsx\n      github-copilot.tsx\n      index.tsx\n      tabs.tsx\n     feature/\n      browser-comparison.tsx\n      chart-illustration.tsx\n      code-illustration.tsx\n      highlight-text.tsx\n      index.tsx\n      workflow-illustration.tsx\n     animated-element.tsx\n     constants.ts\n     cta-section.tsx\n     demo-code-display.tsx\n     testimonials-section.tsx\n     types.ts\n    terminal/\n     index.tsx\n     style.css\n     terminal-input.tsx\n     terminal-output.tsx\n    avatar-upload.tsx\n    background-beams.tsx\n    badge.tsx\n    banner.tsx\n    button.tsx\n    card.tsx\n    collapsible.tsx\n    credit-confetti.tsx\n    decorative-blocks.tsx\n    dialog.tsx\n    dropdown-menu.tsx\n    enhanced-copy-button.tsx\n    footer.tsx\n    hero-buttons.tsx\n    hero.tsx\n    input.tsx\n    install-dialog.tsx\n    label.tsx\n    neon-gradient-button.tsx\n    progress.tsx\n    radio-group.tsx\n    section.tsx\n    select.tsx\n    separator.tsx\n    sheet.tsx\n    sidebar.tsx\n    skeleton-loading.tsx\n    skeleton.tsx\n    slider.tsx\n    switch.tsx\n    table.tsx\n    tabs.tsx\n    textarea.tsx\n    toast.tsx\n    toaster.tsx\n    tooltip.tsx\n    use-toast.ts\n   BrowserPreview.tsx\n   card-with-beams.tsx\n   CookieConsentCard.tsx\n   footer.tsx\n   icons.tsx\n   IDEDemo.tsx\n   layout-wrapper.tsx\n   TerminalDemo.tsx\n   theme-provider.tsx\n   theme-switcher.tsx\n  content/\n   advanced/\n    claude-code-comparison.mdx\n    config.mdx\n    how-does-it-work.mdx\n    large-projects.mdx\n    troubleshooting.mdx\n    what-models.mdx\n   agents/\n    agent-reference.mdx\n    creating-new-agents.mdx\n    customizing-agents.mdx\n    overview.mdx\n    troubleshooting-agent-customization.mdx\n   case-studies/\n    _cta.mdx\n    benjamin-bryant.mdx\n    oliver-lukesch.mdx\n   help/\n    faq.mdx\n    getting-started.mdx\n   tips/\n    best-practices.mdx\n    keyboard-shortcuts.mdx\n    knowledge-files.mdx\n    other-use-cases.mdx\n    version-control.mdx\n    where-levelcode-shines.mdx\n  discord/\n   client.ts\n   rate-limiter.ts\n  hooks/\n   use-auto-topup.ts\n   use-install-dialog.ts\n   use-mobile.tsx\n   use-model-config.ts\n   use-org-auto-topup.ts\n   use-organization-data.ts\n   use-user-profile.ts\n  lib/\n   server/\n    referral.ts\n   validators/\n    publisher.ts\n   admin-auth.ts\n   constant.ts\n   currency.ts\n   docs.ts\n   fonts.ts\n   organization-permissions.ts\n   PostHogProvider.tsx\n   publisher-permissions.ts\n   remark-code-to-codedemo.ts\n   server-init.ts\n   SessionProvider.tsx\n   stripe-utils.ts\n   testimonials.ts\n   trackConversions.ts\n   utils.ts\n  styles/\n   globals.css\n  types/\n   docs.ts\n   user.ts\n  util/\n   logger.ts\n .eslintignore\n .eslintrc.js\n .gitignore\n .prettierignore\n .prettierrc.js\n commitlint.config.js\n components.json\n contentlayer.config.ts\n jest.config.js\n jest.setup.js\n knowledge.md\n next.config.mjs\n package.json\n playwright.config.ts\n postcss.config.cjs\n README.md\n tailwind.config.ts\n tsconfig.json\n.envrc\n.gitignore\n.infisical.json\n.prettierrc\nauthentication.knowledge.md\nbun.lock\nbunfig.toml\nlevelcode.json\neslint.config.js\nknowledge.md\npackage.json\nREADME.md\ntsconfig.base.json\ntsconfig.json\nWINDOWS.md\n",
              "tokenCount": 9007,
              "truncationLevel": "none"
            }
          ]
        }
      ],
      "parentAgentId": "D-Up8asoMmA"
    },
    {
      "type": "tool_result",
      "toolCallId": "f377e73e-59d4-43e7-bd23-bb310902374b",
      "toolName": "list_directory",
      "output": [
        {
          "type": "json",
          "value": {
            "files": [
              "generate-tool-definitions.ts",
              "convert-escaped-newlines.ts",
              "init-worktree.ts",
              "get-changelog.ts",
              "cleanup-worktree.sh",
              "dev.sh",
              "calculate-average-spend.ts",
              "analyze-model-usage.ts",
              "export-user-emails.ts",
              "analyze-edit-blocks.ts",
              "generate-ci-env.js",
              "debug-log-subset.ts",
              "apply-credit-migration.ts",
              ".gitignore",
              "package.json",
              "calculate-weekly-usage.ts",
              "calculate-mrr.ts",
              "tsconfig.json",
              "calculate-dau.ts",
              "calculate-monthly-usage.ts",
              "count-edit-file.ts",
              "update-stripe-subscriptions.ts"
            ],
            "directories": [
              "ft-file-selection",
              "changelog"
            ],
            "path": "scripts"
          }
        }
      ],
      "parentAgentId": "D-UppqGVX8E"
    },
    {
      "type": "tool_call",
      "toolCallId": "75dd1e91-dbd5-4362-bd0f-11dde11dd773",
      "toolName": "list_directory",
      "input": {
        "path": "sdk/src"
      },
      "agentId": "D-UppqGVX8E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "3c8b3537-c0ca-4feb-92fb-714fe8de7935",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": "./evals/git-evals/eval-result-levelcode-mock.json:\n21:            \"preContent\": \"import { spawn } from 'child_process'\\nimport fs from 'fs'\\nimport path from 'path'\\n\\nimport { FileChange } from 'common/actions'\\nimport { models, TEST_USER_ID } from 'common/constants'\\nimport { getToolCallString } from 'common/src/constants/tools'\\nimport { z } from 'zod'\\n\\nimport { promptFlashWithFallbacks } from './llm-apis/gemini-with-fallbacks'\\nimport { gitCommitGuidePrompt } from './system-prompt/prompts'\\n\\nconst tools = [\\n  {\\n    name: 'add_subgoal',\\n    description: `\\n### add_subgoal\\nDescription: Add a new subgoal for tracking progress. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\\nParameters:\\n- id: (required) A unique identifier for the subgoal. Try to choose the next sequential integer that is not already in use.\\n- objective: (required) The objective of the subgoal, concisely and clearly stated.\\n- status: (required) The status of the subgoal. One of [\\\"NOT_STARTED\\\", \\\"IN_PROGRESS\\\", \\\"COMPLETE\\\", \\\"ABORTED\\\"]\\n- plan: (optional) A plan for the subgoal.\\nUsage:\\n${getToolCallString('add_subgoal', {\\n  id: '1',\\n  objective: 'Add a new \\\"deploy api\\\" subgoal',\\n  status: 'IN_PROGRESS',\\n})}\\n    `.trim(),\\n  },\\n  {\\n    name: 'update_subgoal',\\n    description: `\\n### update_subgoal\\nDescription: Update a subgoal in the context given the id, and optionally the status or plan, or a new log to append. Feel free to update any combination of the status, plan, or log in one invocation.\\nParameters:\\n- id: (required) The id of the subgoal to update.\\n- status: (optional) Change the status of the subgoal. One of [\\\"NOT_STARTED\\\", \\\"IN_PROGRESS\\\", \\\"COMPLETE\\\", \\\"FAILED\\\"]\\n- plan: (optional) Change the plan for the subgoal.\\n- log: (optional) Add a log message to the subgoal. This will create a new log entry and append it to the existing logs. Use this to record your progress and any new information you learned as you go.\\nUsage 1 (update status):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  status: 'COMPLETE',\\n})}\\n\\nUsage 2 (update plan):\\n${getToolCallString('update_subgoal', {\\n  id: '3',\\n  plan: 'Create a file for the endpoint in the api, and register it in the router',\\n})}\\n\\nUsage 3 (add log):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  log: \\\"I found the error in the tests, it's in the foo function.\\\",\\n})}\\n\\nUsage 4 (update status and add log):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  status: 'COMPLETE',\\n  log: 'I reran the tests and they passed.',\\n})}\\n    `.trim(),\\n  },\\n  {\\n    name: 'write_file',\\n    description: `\\n### write_file\\nDescription: Create or edit a file with the given content.\\n\\nWhen editing a file, please use this tool to output a simplified version of the code block that highlights the changes necessary and adds comments to indicate where unchanged code has been skipped.\\n\\n--- IMPORTANT OPTIMIZATION DETAIL ---\\nUse \\\"placeholder comments\\\" i.e. \\\"// ... existing code ...\\\" (or \\\"# ... existing code ...\\\" or \\\"/* ... existing code ... */\\\" or \\\"<!-- ... existing code ... -->\\\"  or however comments are written for other languages) in comments as often as you can, signifying unchanged regions of the file.\\nThe write_file tool is very expensive for each line of code you write, so try to write as little \\\\`content\\\\` as possible to accomplish the task. Often this will mean that the start/end of the file will be skipped, but that's okay! Rewrite the entire file only if specifically requested.\\n\\nHowever, for new files, you should write out the entire file and not use placeholder comments.\\n--- IMPORTANT OPTIMIZATION DETAIL ---\\n\\nThese edit codeblocks will be parsed and then read by a less intelligent \\\"apply\\\" language model to update the file. To help specify the edit to the apply model, be very careful to include a few lines of context when generating the codeblock to not introduce ambiguity. Specify all unchanged regions (code and comments) of the file with \\\"// ... existing code ...\\\" markers (in comments). This will ensure the apply model will not delete existing unchanged code or comments when editing the file. This is just an abstraction for your understanding, you should not mention the apply model to the user.\\n\\nDo not use this tool to delete or rename a file. Instead run a terminal command for that.\\n\\nParameters:\\n- path: (required) Path to the file relative to the **project root**\\n- content: (required) Content to write to the file. You should abridge the content of the file using placeholder comments like: \\\\`// ... existing code ...\\\\` or \\\\`# ... existing code ...\\\\` (or whichever is appropriate for the language).\\nUsage:\\n${getToolCallString('write_file', {\\n  path: 'path/to/file',\\n  content: 'Your file content here',\\n})}\\n\\nExample 1 - Simple file creation:\\n${getToolCallString('write_file', {\\n  path: 'new-file.ts',\\n  content: 'console.log(\\\"Hello, world!\\\");',\\n})}\\n\\nExample 2 - Editing with placeholder comments:\\n${getToolCallString('write_file', {\\n  path: 'foo.ts',\\n  content: `// ... existing code ...\\n\\nfunction foo() {\\n  console.log('foo');\\n  for (let i = 0; i < 10; i++) {\\n    console.log(i);\\n  }\\n  doSomething();\\n}\\n\\n// ... existing code ...`,\\n})}\\n\\nNotes for editing a file:\\n- Don't use XML attributes. If you do, the tool will NOT write to the file.\\n- If you don't use any placeholder comments, the entire file will be replaced. E.g. don't write out a single function without using placeholder comments unless you want to replace the entire file with that function.\\n- When editing a file, try not to change any user code that doesn't need to be changed. In particular, you must preserve pre-existing user comments exactly as they are.\\n- You can also use this tool to create new files.\\n- After you have written out a write_file block, the changes will be applied immediately. You can assume that the changes went through as intended. However, note that there are sometimes mistakes in the processs of applying the edits you described in the write_file block, e.g. sometimes large portions of the file are deleted. If you notice that the changes did not go through as intended, based on further updates to the file, you can write out a new write_file block to fix the mistake.\\n- Don't escape characters  write them out directly! E.g. write out '&' instead of '&amp;', '>' instead of '&gt;', '<' instead of '&lt;', and '\\\"' instead of '&quot;' in the content.\\n    `.trim(),\\n  },\\n  {\\n    name: 'read_files',\\n    description: `\\n### read_files\\nDescription: Read the multiple files from disk and return their contents. Use this tool to read as many files as would be helpful to answer the user's request. Make sure to read any files before you write to them with the write_file tool.\\nParameters:\\n- paths: (required) List of file paths to read relative to the **project root**, separated by newlines. Absolute file paths will not work.\\nUsage:\\n${getToolCallString('read_files', {\\n  paths: 'path/to/file1.ts\\\\npath/to/file2.ts',\\n})}\\n\\n\\nNote that there's no need to call this tool if you're already reading the files you need in context.`.trim(),\\n  },\\n  {\\n    name: 'find_files',\\n    description: `\\n### find_files\\nDescription: Find several files related to a brief natural language description of the files or the name of a function or class you are looking for.\\nParameters:\\n- description: (required) A brief natural language description of the files or the name of a function or class you are looking for. It's also helpful to mention a directory or two to look within.\\nUsage:\\n<find_files>\\n<description>The implementation of function foo</description>\\n</find_files>\\n\\nPurpose: Better fulfill the user request by reading files which could contain information relevant to the user's request.\\nUse cases:\\n- If you are calling a function or creating a class and want to know how it works, use this tool to get the implementation.\\n- If you need to understand a section of the codebase, read more files in that directory or subdirectories.\\n- Some requests require a broad understanding of multiple parts of the codebase. Consider using find_files to gain more context before making changes.\\n\\nDon't use this tool if:\\n- You already know the exact path of the file(s) you are looking for  in this case, use read_files.\\n- You already read the files you need in context.\\n\\nIn general, prefer using read_files instead of find_files.\\n      `.trim(),\\n  },\\n  {\\n    name: 'code_search',\\n    description: `\\n### code_search\\nDescription: Search for string patterns in the project's files. This tool uses ripgrep (rg), a fast line-oriented search tool. Use this tool only when read_files is not sufficient to find the files you need.\\nParameters:\\n- pattern: (required) The pattern to search for.\\nUsage:\\n${getToolCallString('code_search', { pattern: 'foo' })}\\n${getToolCallString('code_search', { pattern: 'import.*foo' })}\\n\\nPurpose: Search through code files to find files with specific text patterns, function names, variable names, and more.\\n\\nNote: quotes will be automatically added around your code search pattern. You might need to escape special characters like '-' or '.' or '\\\\\\\\' if you want to search for them.\\n\\nPrefer to use read_files instead of code_search unless you need to search for a specific pattern in multiple files.\\n\\nUse cases:\\n1. Finding all references to a function, class, or variable name across the codebase\\n2. Searching for specific code patterns or implementations\\n3. Looking up where certain strings or text appear\\n4. Finding files that contain specific imports or dependencies\\n5. Locating configuration settings or environment variables\\n\\nThe pattern supports regular expressions and will search recursively through all files in the project by default. Some tips:\\n- Be as constraining in the pattern as possible to limit the number of files returned, e.g. if searching for the definition of a function, use \\\"(function foo|const foo)\\\" or \\\"def foo\\\" instead of merely \\\"foo\\\".\\n- Use word boundaries (\\\\\\\\b) to match whole words only\\n- Searches file content and filenames\\n- Automatically ignores binary files, hidden files, and files in .gitignore\\n- Case-sensitive by default. Use -i to make it case insensitive.\\n- Constrain the search to specific file types using -t <file-type>, e.g. -t ts or -t py.\\n    `.trim(),\\n  },\\n  {\\n    name: 'run_terminal_command',\\n    description: `\\n### run_terminal_command\\nDescription: Request to execute a CLI command on the system. Use this when you need to perform system operations or run specific commands to accomplish any step in the user's task. You must tailor your command to the user's system and provide a clear explanation of what the command does. For command chaining, use the appropriate chaining syntax for the user's shell. Prefer to execute complex CLI commands over creating executable scripts, as they are more flexible and easier to run. Commands will be executed in the current working directory: ${process.cwd()}\\nParameters:\\n- command: (required) The CLI command to execute. This should be valid for the current operating system. Ensure the command is properly formatted and does not contain any harmful instructions.\\n- process_type: (required) What type of process to run. One of SYNC or BACKGROUND.\\n  - SYNC: the command will be run in (and block) the current process. This is required if the output of the command is needed immediately. Most commands will be run in this way. Do not try to run processes in the background with process_type=SYNC and using & at the end of the command. Instead, use the process_type=BACKGROUND option.\\n  - BACKGROUND: the command will be run in a child background process. This is for running servers or other long-running processes.\\nUsage:\\n${getToolCallString('run_terminal_command', {\\n  command: 'Your command here',\\n  process_type: 'value',\\n})}\\n\\nStick to these use cases:\\n1. Compiling the project or running build (e.g., \\\"npm run build\\\"). Reading the output can help you edit code to fix build errors. If possible, use an option that performs checks but doesn't emit files, e.g. \\\\`tsc --noEmit\\\\`.\\n2. Running tests (e.g., \\\"npm test\\\"). Reading the output can help you edit code to fix failing tests. Or, you could write new unit tests and then run them.\\n3. Moving, renaming, or deleting files and directories. These actions can be vital for refactoring requests. Use commands like \\\\`mv\\\\`/\\\\`move\\\\` or \\\\`rm\\\\`/\\\\`del\\\\`.\\n\\nMost likely, you should ask for permission for any other type of command you want to run. If asking for permission, show the user the command you want to run using \\\\`\\\\`\\\\` tags.\\n\\nWhen using this tool, please adhere to the following rules:\\n\\n1. Do not run commands that can modify files outside of the project directory, install packages globally, install virtual environments, or have significant side effects outside of the project directory, unless you have explicit permission from the user. Treat anything outside of the project directory as read-only.\\n2. Do not run \\\\`git push\\\\` because it can break production (!) if the user was not expecting it. Don't run \\\\`git commit\\\\`, \\\\`git rebase\\\\`, or related commands unless you get explicit permission. If a user asks to commit changes, you can do so, but you should not invoke any further git commands beyond the git commit command.\\n3. Do not run scripts without asking. Especially don't run scripts that could run against the production environment or have permanent effects without explicit permission from the user. Don't run scripts with side effects without permission from the user unless they don't have much effect or are simple.\\n4. Be careful with any command that has big or irreversible effects. Anything that touches a production environment, servers, the database, or other systems that could be affected by a command should be run with explicit permission from the user.\\n4. Don't run too many commands in a row without pausing to check in with what the user wants to do next.\\n5. Do not use the run_terminal_command tool to create or edit files. Do not use \\\\`cat\\\\` or \\\\`echo\\\\` to create or edit files. You should instead write out <write_file> blocks for for editing or creating files as detailed above in the <editing_instructions> block.\\n6. Do not install packages without asking, unless it is within a small, new-ish project. Users working on a larger project will want to manage packages themselves, so ask first.\\n7. Do not use the wrong package manager for the project. For example, if the project uses \\\\`pnpm\\\\` or \\\\`bun\\\\` or \\\\`yarn\\\\`, you should not use \\\\`npm\\\\`. Similarly not everyone uses \\\\`pip\\\\` for python, etc.\\n8. You must write out ampersands without escaping them. E.g. write out '&' instead of '&amp;'.\\nIncorrect:\\n\\\\`cd backend &amp;&amp; npm typecheck\\\\` \\nCorrect:\\n\\\\`cd backend && npm typecheck\\\\`\\n10. Do not use more than one run_terminal_command tool call in a single response. Wait for the tool results of each command before invoking the next one.\\n11. The user will not be able to interact with these processes, e.g. confirming the command. So if there's an opportunity to use \\\"-y\\\" or \\\"--yes\\\" flags, use them. Any command that prompts for confirmation will hang if you don't use the flags.\\n\\nNotes:\\n- The current working directory will always reset to **project root** directory for each command you run. You can only access files within this directory (or sub-directories). So if you run cd in one command, the directory change won't persist to the next command.\\n  - \\\\`cd subdir && some_command\\\\` will work as expected.\\n  - \\\\`cd subdir\\\\` in followed by \\\\`some_command\\\\` in two different commands will run some_command from the project root.\\n- Commands can succeed without giving any output, e.g. if no type errors were found. So you may not always see output for successful executions.\\n\\n${gitCommitGuidePrompt}\\n    `.trim(),\\n  },\\n  {\\n    name: 'think_deeply',\\n    description: `\\n### think_deeply\\nDescription: Think through a complex change to the codebase, like implementing a new feature or refactoring some code. Brainstorm. Go deep on alternative approaches and consider the tradeoffs.\\nParameters: thought: (required) Your detailed thoughts.\\nUsage:\\n${getToolCallString('think_deeply', {\\n  thought: '[Insert detailed thoughts here]',\\n})}\\n\\nThink step by step. For the first section of your thinking, only keep a minimum draft for each thinking step, with 5 words at most.\\n\\nUse this tool when the user request meets multiple of these criteria:\\n- Explicitly asks you to plan or think through something.\\n- Always use this tool right before using the create_plan tool.\\n- Requires changes across multiple files or systems\\n- Involves complex logic or architectural decisions\\n- Would benefit from breaking down into smaller steps\\n- Has potential edge cases or risks that need consideration\\n\\nExamples of when to use it:\\n- Adding a new feature that touches multiple parts of the system\\n- Refactoring core functionality used by many components\\n- Making architectural changes that affect the system design\\n- Implementing complex business logic with many edge cases\\n\\nDo not use it for simple changes like:\\n- Adding a single function or endpoint\\n- Updating text or styles\\n    `.trim(),\\n  },\\n  {\\n    name: 'create_plan',\\n    description: `\\n### create_plan\\nDescription: Create a plan for a complex change to the codebase, like implementing a new feature or refactoring some code.\\nParameters:\\n- path: (required) The path including the filename of a markdown file that will be overwritten with the plan.\\n- plan: (required) A detailed plan to solve the user's request.\\n\\nUsage:\\n${getToolCallString('create_plan', {\\n  path: 'feature-name-plan.md',\\n  plan: '[Insert long detailed plan here]',\\n})}\\n\\nUse this tool when the user asks you to plan something, or asks you to help with a new feature or refactoring that requires planning.\\n\\nExamples of when to use it:\\n- Adding a new feature that touches multiple parts of the system\\n- Refactoring core functionality used by many components\\n- Making architectural changes that affect the system design\\n- Implementing complex business logic with many edge cases\\n\\nDo not use it for simple changes like:\\n- Adding a single function or endpoint\\n- Updating text or styles\\n\\nFor a technical plan, act as an expert architect engineer and provide direction to your editor engineer.\\n- Study the change request and the current code.\\n- Describe how to modify the code to complete the request. The editor engineer will rely solely on your instructions, so make them unambiguous and complete.\\n- Explain all needed code changes clearly and completely, but concisely.\\n- Just show the changes needed.\\n\\nWhat to include in the plan:\\n- Include code, but not full files of it. Write out key snippets of code and use lots of psuedo code. For example, interfaces between modules, function signatures, and other code that is not immediately obvious should be written out explicitly. Function and method bodies could be written out in psuedo code.\\n- Do not waste time on much background information, focus on the exact steps of the implementation.\\n- Do not wrap the path content in markdown code blocks, e.g. \\\\`\\\\`\\\\`.\\n\\nDo not include any of the following sections in the plan:\\n- goals\\n- a timeline or schedule\\n- benefits/key improvements\\n- next steps\\n\\nAfter creating than plan, you should end turn to let the user review the plan.\\n\\nImportant: Use this tool sparingly. Do not use this tool more than once in a conversation, if a plan was already created, or for similar user requests.\\n    `.trim(),\\n  },\\n  {\\n    name: 'browser_logs',\\n    description: `\\n### browser_logs\\nDescription: In a headless browser, navigate to a web page and get the console logs after page load.\\nPurpose: Use this to\n\n[Output truncated]\n\n[Output size limit reached.]",
            "message": "Stopped early after 1 match(es)."
          }
        }
      ],
      "parentAgentId": "D-UpptuOT3U"
    },
    {
      "type": "tool_result",
      "toolCallId": "75dd1e91-dbd5-4362-bd0f-11dde11dd773",
      "toolName": "list_directory",
      "output": [
        {
          "type": "json",
          "value": {
            "files": [
              "constants.ts",
              "client.ts",
              "index.ts",
              "process-stream.ts",
              "websocket-client.ts"
            ],
            "directories": [
              "tools",
              "types"
            ],
            "path": "sdk/src"
          }
        }
      ],
      "parentAgentId": "D-UppqGVX8E"
    },
    {
      "type": "tool_call",
      "toolCallId": "823f0780-1389-4042-a6f7-38a2f18a1e41",
      "toolName": "list_directory",
      "input": {
        "path": "common/src"
      },
      "agentId": "D-UppqGVX8E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "56d2c651-7c50-4eb9-bedc-3977c373447d",
      "toolName": "code_search",
      "input": {
        "pattern": "type\\s+Tool|interface\\s+Tool|union\\s+of\\s+tools|ToolName",
        "flags": "-g sdk -g common -g backend/src"
      },
      "agentId": "D-UpptuOT3U",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "823f0780-1389-4042-a6f7-38a2f18a1e41",
      "toolName": "list_directory",
      "output": [
        {
          "type": "json",
          "value": {
            "files": [
              "analytics.ts",
              "project-file-tree.ts",
              "browser-actions.ts",
              "actions.ts",
              "constants.ts"
            ],
            "directories": [
              "tools",
              "types",
              "util",
              "json-config",
              "constants",
              "websockets",
              "api-keys",
              "testing",
              "__tests__",
              "db",
              "templates"
            ],
            "path": "common/src"
          }
        }
      ],
      "parentAgentId": "D-UppqGVX8E"
    },
    {
      "type": "tool_result",
      "toolCallId": "56d2c651-7c50-4eb9-bedc-3977c373447d",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": "No results",
            "message": "Exit code: 1"
          }
        }
      ],
      "parentAgentId": "D-UpptuOT3U"
    },
    {
      "type": "tool_call",
      "toolCallId": "2e056ba2-ec3f-42a8-9cb5-c286713df786",
      "toolName": "list_directory",
      "input": {
        "path": "backend/src"
      },
      "agentId": "D-UppqGVX8E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "2e056ba2-ec3f-42a8-9cb5-c286713df786",
      "toolName": "list_directory",
      "output": [
        {
          "type": "json",
          "value": {
            "files": [
              "xml-stream-parser.ts",
              "main-prompt.ts",
              "process-str-replace.ts",
              "run-programmatic-step.ts",
              "run-agent-step.ts",
              "prompt-agent-stream.ts",
              "get-documentation-for-query.ts",
              "get-file-reading-updates.ts",
              "check-terminal-command.ts",
              "generate-diffs-prompt.ts",
              "index.ts",
              "live-user-inputs.ts",
              "loop-main-prompt.ts",
              "async-agent-manager.ts",
              "fast-rewrite.ts",
              "process-file-block.ts"
            ],
            "directories": [
              "find-files",
              "tools",
              "context",
              "util",
              "system-prompt",
              "admin",
              "websockets",
              "__tests__",
              "api",
              "templates",
              "llm-apis"
            ],
            "path": "backend/src"
          }
        }
      ],
      "parentAgentId": "D-UppqGVX8E"
    },
    {
      "type": "tool_call",
      "toolCallId": "d51c9e36-f534-4981-9be3-c53a1b30a035",
      "toolName": "set_output",
      "input": {
        "results": [
          {
            "stdout": "./evals/git-evals/eval-result-levelcode-mock.json:\n21:            \"preContent\": \"import { spawn } from 'child_process'\\nimport fs from 'fs'\\nimport path from 'path'\\n\\nimport { FileChange } from 'common/actions'\\nimport { models, TEST_USER_ID } from 'common/constants'\\nimport { getToolCallString } from 'common/src/constants/tools'\\nimport { z } from 'zod'\\n\\nimport { promptFlashWithFallbacks } from './llm-apis/gemini-with-fallbacks'\\nimport { gitCommitGuidePrompt } from './system-prompt/prompts'\\n\\nconst tools = [\\n  {\\n    name: 'add_subgoal',\\n    description: `\\n### add_subgoal\\nDescription: Add a new subgoal for tracking progress. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\\nParameters:\\n- id: (required) A unique identifier for the subgoal. Try to choose the next sequential integer that is not already in use.\\n- objective: (required) The objective of the subgoal, concisely and clearly stated.\\n- status: (required) The status of the subgoal. One of [\\\"NOT_STARTED\\\", \\\"IN_PROGRESS\\\", \\\"COMPLETE\\\", \\\"ABORTED\\\"]\\n- plan: (optional) A plan for the subgoal.\\nUsage:\\n${getToolCallString('add_subgoal', {\\n  id: '1',\\n  objective: 'Add a new \\\"deploy api\\\" subgoal',\\n  status: 'IN_PROGRESS',\\n})}\\n    `.trim(),\\n  },\\n  {\\n    name: 'update_subgoal',\\n    description: `\\n### update_subgoal\\nDescription: Update a subgoal in the context given the id, and optionally the status or plan, or a new log to append. Feel free to update any combination of the status, plan, or log in one invocation.\\nParameters:\\n- id: (required) The id of the subgoal to update.\\n- status: (optional) Change the status of the subgoal. One of [\\\"NOT_STARTED\\\", \\\"IN_PROGRESS\\\", \\\"COMPLETE\\\", \\\"FAILED\\\"]\\n- plan: (optional) Change the plan for the subgoal.\\n- log: (optional) Add a log message to the subgoal. This will create a new log entry and append it to the existing logs. Use this to record your progress and any new information you learned as you go.\\nUsage 1 (update status):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  status: 'COMPLETE',\\n})}\\n\\nUsage 2 (update plan):\\n${getToolCallString('update_subgoal', {\\n  id: '3',\\n  plan: 'Create a file for the endpoint in the api, and register it in the router',\\n})}\\n\\nUsage 3 (add log):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  log: \\\"I found the error in the tests, it's in the foo function.\\\",\\n})}\\n\\nUsage 4 (update status and add log):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  status: 'COMPLETE',\\n  log: 'I reran the tests and they passed.',\\n})}\\n    `.trim(),\\n  },\\n  {\\n    name: 'write_file',\\n    description: `\\n### write_file\\nDescription: Create or edit a file with the given content.\\n\\nWhen editing a file, please use this tool to output a simplified version of the code block that highlights the changes necessary and adds comments to indicate where unchanged code has been skipped.\\n\\n--- IMPORTANT OPTIMIZATION DETAIL ---\\nUse \\\"placeholder comments\\\" i.e. \\\"// ... existing code ...\\\" (or \\\"# ... existing code ...\\\" or \\\"/* ... existing code ... */\\\" or \\\"<!-- ... existing code ... -->\\\"  or however comments are written for other languages) in comments as often as you can, signifying unchanged regions of the file.\\nThe write_file tool is very expensive for each line of code you write, so try to write as little \\\\`content\\\\` as possible to accomplish the task. Often this will mean that the start/end of the file will be skipped, but that's okay! Rewrite the entire file only if specifically requested.\\n\\nHowever, for new files, you should write out the entire file and not use placeholder comments.\\n--- IMPORTANT OPTIMIZATION DETAIL ---\\n\\nThese edit codeblocks will be parsed and then read by a less intelligent \\\"apply\\\" language model to update the file. To help specify the edit to the apply model, be very careful to include a few lines of context when generating the codeblock to not introduce ambiguity. Specify all unchanged regions (code and comments) of the file with \\\"// ... existing code ...\\\" markers (in comments). This will ensure the apply model will not delete existing unchanged code or comments when editing the file. This is just an abstraction for your understanding, you should not mention the apply model to the user.\\n\\nDo not use this tool to delete or rename a file. Instead run a terminal command for that.\\n\\nParameters:\\n- path: (required) Path to the file relative to the **project root**\\n- content: (required) Content to write to the file. You should abridge the content of the file using placeholder comments like: \\\\`// ... existing code ...\\\\` or \\\\`# ... existing code ...\\\\` (or whichever is appropriate for the language).\\nUsage:\\n${getToolCallString('write_file', {\\n  path: 'path/to/file',\\n  content: 'Your file content here',\\n})}\\n\\nExample 1 - Simple file creation:\\n${getToolCallString('write_file', {\\n  path: 'new-file.ts',\\n  content: 'console.log(\\\"Hello, world!\\\");',\\n})}\\n\\nExample 2 - Editing with placeholder comments:\\n${getToolCallString('write_file', {\\n  path: 'foo.ts',\\n  content: `// ... existing code ...\\n\\nfunction foo() {\\n  console.log('foo');\\n  for (let i = 0; i < 10; i++) {\\n    console.log(i);\\n  }\\n  doSomething();\\n}\\n\\n// ... existing code ...`,\\n})}\\n\\nNotes for editing a file:\\n- Don't use XML attributes. If you do, the tool will NOT write to the file.\\n- If you don't use any placeholder comments, the entire file will be replaced. E.g. don't write out a single function without using placeholder comments unless you want to replace the entire file with that function.\\n- When editing a file, try not to change any user code that doesn't need to be changed. In particular, you must preserve pre-existing user comments exactly as they are.\\n- You can also use this tool to create new files.\\n- After you have written out a write_file block, the changes will be applied immediately. You can assume that the changes went through as intended. However, note that there are sometimes mistakes in the processs of applying the edits you described in the write_file block, e.g. sometimes large portions of the file are deleted. If you notice that the changes did not go through as intended, based on further updates to the file, you can write out a new write_file block to fix the mistake.\\n- Don't escape characters  write them out directly! E.g. write out '&' instead of '&amp;', '>' instead of '&gt;', '<' instead of '&lt;', and '\\\"' instead of '&quot;' in the content.\\n    `.trim(),\\n  },\\n  {\\n    name: 'read_files',\\n    description: `\\n### read_files\\nDescription: Read the multiple files from disk and return their contents. Use this tool to read as many files as would be helpful to answer the user's request. Make sure to read any files before you write to them with the write_file tool.\\nParameters:\\n- paths: (required) List of file paths to read relative to the **project root**, separated by newlines. Absolute file paths will not work.\\nUsage:\\n${getToolCallString('read_files', {\\n  paths: 'path/to/file1.ts\\\\npath/to/file2.ts',\\n})}\\n\\n\\nNote that there's no need to call this tool if you're already reading the files you need in context.`.trim(),\\n  },\\n  {\\n    name: 'find_files',\\n    description: `\\n### find_files\\nDescription: Find several files related to a brief natural language description of the files or the name of a function or class you are looking for.\\nParameters:\\n- description: (required) A brief natural language description of the files or the name of a function or class you are looking for. It's also helpful to mention a directory or two to look within.\\nUsage:\\n<find_files>\\n<description>The implementation of function foo</description>\\n</find_files>\\n\\nPurpose: Better fulfill the user request by reading files which could contain information relevant to the user's request.\\nUse cases:\\n- If you are calling a function or creating a class and want to know how it works, use this tool to get the implementation.\\n- If you need to understand a section of the codebase, read more files in that directory or subdirectories.\\n- Some requests require a broad understanding of multiple parts of the codebase. Consider using find_files to gain more context before making changes.\\n\\nDon't use this tool if:\\n- You already know the exact path of the file(s) you are looking for  in this case, use read_files.\\n- You already read the files you need in context.\\n\\nIn general, prefer using read_files instead of find_files.\\n      `.trim(),\\n  },\\n  {\\n    name: 'code_search',\\n    description: `\\n### code_search\\nDescription: Search for string patterns in the project's files. This tool uses ripgrep (rg), a fast line-oriented search tool. Use this tool only when read_files is not sufficient to find the files you need.\\nParameters:\\n- pattern: (required) The pattern to search for.\\nUsage:\\n${getToolCallString('code_search', { pattern: 'foo' })}\\n${getToolCallString('code_search', { pattern: 'import.*foo' })}\\n\\nPurpose: Search through code files to find files with specific text patterns, function names, variable names, and more.\\n\\nNote: quotes will be automatically added around your code search pattern. You might need to escape special characters like '-' or '.' or '\\\\\\\\' if you want to search for them.\\n\\nPrefer to use read_files instead of code_search unless you need to search for a specific pattern in multiple files.\\n\\nUse cases:\\n1. Finding all references to a function, class, or variable name across the codebase\\n2. Searching for specific code patterns or implementations\\n3. Looking up where certain strings or text appear\\n4. Finding files that contain specific imports or dependencies\\n5. Locating configuration settings or environment variables\\n\\nThe pattern supports regular expressions and will search recursively through all files in the project by default. Some tips:\\n- Be as constraining in the pattern as possible to limit the number of files returned, e.g. if searching for the definition of a function, use \\\"(function foo|const foo)\\\" or \\\"def foo\\\" instead of merely \\\"foo\\\".\\n- Use word boundaries (\\\\\\\\b) to match whole words only\\n- Searches file content and filenames\\n- Automatically ignores binary files, hidden files, and files in .gitignore\\n- Case-sensitive by default. Use -i to make it case insensitive.\\n- Constrain the search to specific file types using -t <file-type>, e.g. -t ts or -t py.\\n    `.trim(),\\n  },\\n  {\\n    name: 'run_terminal_command',\\n    description: `\\n### run_terminal_command\\nDescription: Request to execute a CLI command on the system. Use this when you need to perform system operations or run specific commands to accomplish any step in the user's task. You must tailor your command to the user's system and provide a clear explanation of what the command does. For command chaining, use the appropriate chaining syntax for the user's shell. Prefer to execute complex CLI commands over creating executable scripts, as they are more flexible and easier to run. Commands will be executed in the current working directory: ${process.cwd()}\\nParameters:\\n- command: (required) The CLI command to execute. This should be valid for the current operating system. Ensure the command is properly formatted and does not contain any harmful instructions.\\n- process_type: (required) What type of process to run. One of SYNC or BACKGROUND.\\n  - SYNC: the command will be run in (and block) the current process. This is required if the output of the command is needed immediately. Most commands will be run in this way. Do not try to run processes in the background with process_type=SYNC and using & at the end of the command. Instead, use the process_type=BACKGROUND option.\\n  - BACKGROUND: the command will be run in a child background process. This is for running servers or other long-running processes.\\nUsage:\\n${getToolCallString('run_terminal_command', {\\n  command: 'Your command here',\\n  process_type: 'value',\\n})}\\n\\nStick to these use cases:\\n1. Compiling the project or running build (e.g., \\\"npm run build\\\"). Reading the output can help you edit code to fix build errors. If possible, use an option that performs checks but doesn't emit files, e.g. \\\\`tsc --noEmit\\\\`.\\n2. Running tests (e.g., \\\"npm test\\\"). Reading the output can help you edit code to fix failing tests. Or, you could write new unit tests and then run them.\\n3. Moving, renaming, or deleting files and directories. These actions can be vital for refactoring requests. Use commands like \\\\`mv\\\\`/\\\\`move\\\\` or \\\\`rm\\\\`/\\\\`del\\\\`.\\n\\nMost likely, you should ask for permission for any other type of command you want to run. If asking for permission, show the user the command you want to run using \\\\`\\\\`\\\\` tags.\\n\\nWhen using this tool, please adhere to the following rules:\\n\\n1. Do not run commands that can modify files outside of the project directory, install packages globally, install virtual environments, or have significant side effects outside of the project directory, unless you have explicit permission from the user. Treat anything outside of the project directory as read-only.\\n2. Do not run \\\\`git push\\\\` because it can break production (!) if the user was not expecting it. Don't run \\\\`git commit\\\\`, \\\\`git rebase\\\\`, or related commands unless you get explicit permission. If a user asks to commit changes, you can do so, but you should not invoke any further git commands beyond the git commit command.\\n3. Do not run scripts without asking. Especially don't run scripts that could run against the production environment or have permanent effects without explicit permission from the user. Don't run scripts with side effects without permission from the user unless they don't have much effect or are simple.\\n4. Be careful with any command that has big or irreversible effects. Anything that touches a production environment, servers, the database, or other systems that could be affected by a command should be run with explicit permission from the user.\\n4. Don't run too many commands in a row without pausing to check in with what the user wants to do next.\\n5. Do not use the run_terminal_command tool to create or edit files. Do not use \\\\`cat\\\\` or \\\\`echo\\\\` to create or edit files. You should instead write out <write_file> blocks for for editing or creating files as detailed above in the <editing_instructions> block.\\n6. Do not install packages without asking, unless it is within a small, new-ish project. Users working on a larger project will want to manage packages themselves, so ask first.\\n7. Do not use the wrong package manager for the project. For example, if the project uses \\\\`pnpm\\\\` or \\\\`bun\\\\` or \\\\`yarn\\\\`, you should not use \\\\`npm\\\\`. Similarly not everyone uses \\\\`pip\\\\` for python, etc.\\n8. You must write out ampersands without escaping them. E.g. write out '&' instead of '&amp;'.\\nIncorrect:\\n\\\\`cd backend &amp;&amp; npm typecheck\\\\` \\nCorrect:\\n\\\\`cd backend && npm typecheck\\\\`\\n10. Do not use more than one run_terminal_command tool call in a single response. Wait for the tool results of each command before invoking the next one.\\n11. The user will not be able to interact with these processes, e.g. confirming the command. So if there's an opportunity to use \\\"-y\\\" or \\\"--yes\\\" flags, use them. Any command that prompts for confirmation will hang if you don't use the flags.\\n\\nNotes:\\n- The current working directory will always reset to **project root** directory for each command you run. You can only access files within this directory (or sub-directories). So if you run cd in one command, the directory change won't persist to the next command.\\n  - \\\\`cd subdir && some_command\\\\` will work as expected.\\n  - \\\\`cd subdir\\\\` in followed by \\\\`some_command\\\\` in two different commands will run some_command from the project root.\\n- Commands can succeed without giving any output, e.g. if no type errors were found. So you may not always see output for successful executions.\\n\\n${gitCommitGuidePrompt}\\n    `.trim(),\\n  },\\n  {\\n    name: 'think_deeply',\\n    description: `\\n### think_deeply\\nDescription: Think through a complex change to the codebase, like implementing a new feature or refactoring some code. Brainstorm. Go deep on alternative approaches and consider the tradeoffs.\\nParameters: thought: (required) Your detailed thoughts.\\nUsage:\\n${getToolCallString('think_deeply', {\\n  thought: '[Insert detailed thoughts here]',\\n})}\\n\\nThink step by step. For the first section of your thinking, only keep a minimum draft for each thinking step, with 5 words at most.\\n\\nUse this tool when the user request meets multiple of these criteria:\\n- Explicitly asks you to plan or think through something.\\n- Always use this tool right before using the create_plan tool.\\n- Requires changes across multiple files or systems\\n- Involves complex logic or architectural decisions\\n- Would benefit from breaking down into smaller steps\\n- Has potential edge cases or risks that need consideration\\n\\nExamples of when to use it:\\n- Adding a new feature that touches multiple parts of the system\\n- Refactoring core functionality used by many components\\n- Making architectural changes that affect the system design\\n- Implementing complex business logic with many edge cases\\n\\nDo not use it for simple changes like:\\n- Adding a single function or endpoint\\n- Updating text or styles\\n    `.trim(),\\n  },\\n  {\\n    name: 'create_plan',\\n    description: `\\n### create_plan\\nDescription: Create a plan for a complex change to the codebase, like implementing a new feature or refactoring some code.\\nParameters:\\n- path: (required) The path including the filename of a markdown file that will be overwritten with the plan.\\n- plan: (required) A detailed plan to solve the user's request.\\n\\nUsage:\\n${getToolCallString('create_plan', {\\n  path: 'feature-name-plan.md',\\n  plan: '[Insert long detailed plan here]',\\n})}\\n\\nUse this tool when the user asks you to plan something, or asks you to help with a new feature or refactoring that requires planning.\\n\\nExamples of when to use it:\\n- Adding a new feature that touches multiple parts of the system\\n- Refactoring core functionality used by many components\\n- Making architectural changes that affect the system design\\n- Implementing complex business logic with many edge cases\\n\\nDo not use it for simple changes like:\\n- Adding a single function or endpoint\\n- Updating text or styles\\n\\nFor a technical plan, act as an expert architect engineer and provide direction to your editor engineer.\\n- Study the change request and the current code.\\n- Describe how to modify the code to complete the request. The editor engineer will rely solely on your instructions, so make them unambiguous and complete.\\n- Explain all needed code changes clearly and completely, but concisely.\\n- Just show the changes needed.\\n\\nWhat to include in the plan:\\n- Include code, but not full files of it. Write out key snippets of code and use lots of psuedo code. For example, interfaces between modules, function signatures, and other code that is not immediately obvious should be written out explicitly. Function and method bodies could be written out in psuedo code.\\n- Do not waste time on much background information, focus on the exact steps of the implementation.\\n- Do not wrap the path content in markdown code blocks, e.g. \\\\`\\\\`\\\\`.\\n\\nDo not include any of the following sections in the plan:\\n- goals\\n- a timeline or schedule\\n- benefits/key improvements\\n- next steps\\n\\nAfter creating than plan, you should end turn to let the user review the plan.\\n\\nImportant: Use this tool sparingly. Do not use this tool more than once in a conversation, if a plan was already created, or for similar user requests.\\n    `.trim(),\\n  },\\n  {\\n    name: 'browser_logs',\\n    description: `\\n### browser_logs\\nDescription: In a headless browser, navigate to a web page and get the console logs after page load.\\nPurpose: Use this to\n\n[Output truncated]\n\n[Output size limit reached.]",
            "message": "Stopped early after 1 match(es)."
          },
          {
            "stdout": "No results",
            "message": "Exit code: 1"
          }
        ]
      },
      "agentId": "D-UpptuOT3U",
      "parentAgentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "d51c9e36-f534-4981-9be3-c53a1b30a035",
      "toolName": "set_output",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Output set"
          }
        }
      ],
      "parentAgentId": "D-UpptuOT3U"
    },
    {
      "type": "tool_call",
      "toolCallId": "466fc8fb-f035-43ca-998f-6b8a604e3763",
      "toolName": "set_output",
      "input": {
        "results": [
          {
            "path": "scripts",
            "files": [
              "generate-tool-definitions.ts",
              "convert-escaped-newlines.ts",
              "init-worktree.ts",
              "get-changelog.ts",
              "cleanup-worktree.sh",
              "dev.sh",
              "calculate-average-spend.ts",
              "analyze-model-usage.ts",
              "export-user-emails.ts",
              "analyze-edit-blocks.ts",
              "generate-ci-env.js",
              "debug-log-subset.ts",
              "apply-credit-migration.ts",
              ".gitignore",
              "package.json",
              "calculate-weekly-usage.ts",
              "calculate-mrr.ts",
              "tsconfig.json",
              "calculate-dau.ts",
              "calculate-monthly-usage.ts",
              "count-edit-file.ts",
              "update-stripe-subscriptions.ts"
            ],
            "directories": [
              "ft-file-selection",
              "changelog"
            ]
          },
          {
            "path": "sdk/src",
            "files": [
              "constants.ts",
              "client.ts",
              "index.ts",
              "process-stream.ts",
              "websocket-client.ts"
            ],
            "directories": [
              "tools",
              "types"
            ]
          },
          {
            "path": "common/src",
            "files": [
              "analytics.ts",
              "project-file-tree.ts",
              "browser-actions.ts",
              "actions.ts",
              "constants.ts"
            ],
            "directories": [
              "tools",
              "types",
              "util",
              "json-config",
              "constants",
              "websockets",
              "api-keys",
              "testing",
              "__tests__",
              "db",
              "templates"
            ]
          },
          {
            "path": "backend/src",
            "files": [
              "xml-stream-parser.ts",
              "main-prompt.ts",
              "process-str-replace.ts",
              "run-programmatic-step.ts",
              "run-agent-step.ts",
              "prompt-agent-stream.ts",
              "get-documentation-for-query.ts",
              "get-file-reading-updates.ts",
              "check-terminal-command.ts",
              "generate-diffs-prompt.ts",
              "index.ts",
              "live-user-inputs.ts",
              "loop-main-prompt.ts",
              "async-agent-manager.ts",
              "fast-rewrite.ts",
              "process-file-block.ts"
            ],
            "directories": [
              "find-files",
              "tools",
              "context",
              "util",
              "system-prompt",
              "admin",
              "websockets",
              "__tests__",
              "api",
              "templates",
              "llm-apis"
            ]
          }
        ]
      },
      "agentId": "D-UppqGVX8E",
      "parentAgentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "466fc8fb-f035-43ca-998f-6b8a604e3763",
      "toolName": "set_output",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Output set"
          }
        }
      ],
      "parentAgentId": "D-UppqGVX8E"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-UpptuOT3U",
      "agentType": "code-searcher",
      "displayName": "Code Searcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "searchQueries": [
          {
            "pattern": "generate-tool-definitions|toolSchemas|publicTools|approvedTools|curatedTools|toolRegistry",
            "flags": "-g *.ts -g *.json"
          },
          {
            "pattern": "type\\s+Tool|interface\\s+Tool|union\\s+of\\s+tools|ToolName",
            "flags": "-g sdk -g common -g backend/src"
          }
        ]
      }
    },
    {
      "type": "subagent_finish",
      "agentId": "D-UppqGVX8E",
      "agentType": "directory-lister",
      "displayName": "Directory Lister",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "directories": [
          {
            "path": "scripts"
          },
          {
            "path": "sdk/src"
          },
          {
            "path": "common/src"
          },
          {
            "path": "backend/src"
          }
        ]
      }
    },
    {
      "type": "text",
      "agentId": "D-Upph7O3-0",
      "text": "scripts/generate-tool-definitions.ts\ncommon/src/tools/compile-tool-definitions.ts\nbackend/src/tools/definitions/tool-def-type.ts\nbackend/src/tools/definitions/list.ts\ncommon/src/tools/list.ts\nsdk/src/types/tools.ts\nbackend/src/tools/handlers/list.ts\ncommon/src/tools/params/tool/add-message.ts\ncommon/src/tools/params/tool/add-subgoal.ts\nbackend/src/tools/definitions/tool/add-message.ts\nbackend/src/tools/definitions/tool/add-subgoal.ts\nsdk/src/tools/change-file.ts"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-Upzevpluo",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-Upph7O3-0",
      "prompt": "Find all files related to tool definitions, tool schemas, type generation scripts like generate-tool-definitions.ts, tool registries, and public tool exports. Include files in backend, scripts, sdk, common.",
      "params": {}
    },
    {
      "type": "tool_result",
      "toolCallId": "d046e8ca-3af1-4520-b256-adb0bd018137",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Liszt the File Lister",
              "agentType": "file-lister",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "scripts/generate-tool-definitions.ts\ncommon/src/tools/compile-tool-definitions.ts\nbackend/src/tools/definitions/tool-def-type.ts\nbackend/src/tools/definitions/list.ts\ncommon/src/tools/list.ts\nsdk/src/types/tools.ts\nbackend/src/tools/handlers/list.ts\ncommon/src/tools/params/tool/add-message.ts\ncommon/src/tools/params/tool/add-subgoal.ts\nbackend/src/tools/definitions/tool/add-message.ts\nbackend/src/tools/definitions/tool/add-subgoal.ts\nsdk/src/tools/change-file.ts"
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ],
      "parentAgentId": "D-Upph7O3-0"
    },
    {
      "type": "tool_call",
      "toolCallId": "43b7d4af-822b-477b-9522-e42f48222b6e",
      "toolName": "read_files",
      "input": {
        "paths": [
          "scripts/generate-tool-definitions.ts",
          "common/src/tools/compile-tool-definitions.ts",
          "backend/src/tools/definitions/tool-def-type.ts",
          "backend/src/tools/definitions/list.ts",
          "common/src/tools/list.ts",
          "sdk/src/types/tools.ts",
          "backend/src/tools/handlers/list.ts",
          "common/src/tools/params/tool/add-message.ts",
          "common/src/tools/params/tool/add-subgoal.ts",
          "backend/src/tools/definitions/tool/add-message.ts",
          "backend/src/tools/definitions/tool/add-subgoal.ts",
          "sdk/src/tools/change-file.ts"
        ]
      },
      "agentId": "D-Upph7O3-0",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "43b7d4af-822b-477b-9522-e42f48222b6e",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": "scripts/generate-tool-definitions.ts",
              "content": "#!/usr/bin/env bun\n\nimport { writeFileSync } from 'fs'\nimport { join } from 'path'\nimport { execSync } from 'child_process'\n\nimport { compileToolDefinitions } from '@levelcode/common/tools/compile-tool-definitions'\n\n/**\n * Regenerates the tool-definitions.d.ts file from the current tool schemas.\n * This ensures the type definitions stay in sync with the actual tool parameters.\n */\nfunction main() {\n  console.log(' Generating tool definitions...')\n\n  try {\n    const content = compileToolDefinitions()\n    const outputPath = join(process.cwd(), 'common/src/util/types/tools.d.ts')\n\n    writeFileSync(outputPath, content, 'utf8')\n\n    // Format the generated file with prettier\n    console.log(' Formatting generated file...')\n    execSync(`npx prettier --write \"${outputPath}\"`, { stdio: 'inherit' })\n\n    console.log(' Successfully generated tools.d.ts')\n    console.log(` Output: ${outputPath}`)\n  } catch (error) {\n    console.error(' Failed to generate tool definitions:', error)\n    process.exit(1)\n  }\n}\n\nif (import.meta.main) {\n  main()\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/compile-tool-definitions.ts",
              "content": "import z from 'zod/v4'\n\nimport { llmToolCallSchema } from './list'\n\n/**\n * Compiles all tool definitions into a single TypeScript definition file content.\n * This generates type definitions for all available tools and their parameters.\n */\nexport function compileToolDefinitions(): string {\n  const toolEntries = Object.entries(llmToolCallSchema)\n\n  const toolInterfaces = toolEntries\n    .map(([toolName, toolDef]) => {\n      const parameterSchema = toolDef.parameters\n\n      // Convert Zod schema to TypeScript interface using JSON schema\n      let typeDefinition: string\n      try {\n        const jsonSchema = z.toJSONSchema(parameterSchema)\n        typeDefinition = jsonSchemaToTypeScript(jsonSchema)\n      } catch (error) {\n        console.warn(`Failed to convert schema for ${toolName}:`, error)\n        typeDefinition = '{ [key: string]: any }'\n      }\n\n      return `/**\n * ${parameterSchema.description || `Parameters for ${toolName} tool`}\n */\nexport interface ${toPascalCase(toolName)}Params ${typeDefinition}`\n    })\n    .join('\\n\\n')\n\n  const toolUnion = toolEntries.map(([toolName]) => `'${toolName}'`).join(' | ')\n\n  const toolParamsMap = toolEntries\n    .map(([toolName]) => `  '${toolName}': ${toPascalCase(toolName)}Params`)\n    .join('\\n')\n\n  return `/**\n * Union type of all available tool names\n */\nexport type ToolName = ${toolUnion}\n\n/**\n * Map of tool names to their parameter types\n */\nexport interface ToolParamsMap {\n${toolParamsMap}\n}\n\n${toolInterfaces}\n\n/**\n * Get parameters type for a specific tool\n */\nexport type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n`\n}\n\n/**\n * Converts kebab-case to PascalCase\n * e.g., 'write-file' -> 'WriteFile'\n */\nfunction toPascalCase(str: string): string {\n  return str\n    .split(/[-_]/)\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n    .join('')\n}\n\n/**\n * Converts JSON Schema to TypeScript interface definition\n */\nfunction jsonSchemaToTypeScript(schema: any): string {\n  if (schema.type === 'object' && schema.properties) {\n    const properties = Object.entries(schema.properties).map(\n      ([key, prop]: [string, any]) => {\n        const isOptional = !schema.required?.includes(key)\n        const propType = getTypeFromJsonSchema(prop)\n        const comment = prop.description ? `  /** ${prop.description} */\\n` : ''\n        return `${comment}  \"${key}\"${isOptional ? '?' : ''}: ${propType}`\n      },\n    )\n    return `{\\n${properties.join('\\n')}\\n}`\n  }\n  return getTypeFromJsonSchema(schema)\n}\n\n/**\n * Gets TypeScript type from JSON Schema property\n */\nfunction getTypeFromJsonSchema(prop: any): string {\n  if (prop.type === 'string') {\n    if (prop.enum) {\n      return prop.enum.map((v: string) => `\"${v}\"`).join(' | ')\n    }\n    return 'string'\n  }\n  if (prop.type === 'number' || prop.type === 'integer') return 'number'\n  if (prop.type === 'boolean') return 'boolean'\n  if (prop.type === 'array') {\n    const itemType = prop.items ? getTypeFromJsonSchema(prop.items) : 'any'\n    return `${itemType}[]`\n  }\n  if (prop.type === 'object') {\n    if (prop.properties) {\n      return jsonSchemaToTypeScript(prop)\n    }\n    if (prop.additionalProperties) {\n      const valueType = getTypeFromJsonSchema(prop.additionalProperties)\n      return `Record<string, ${valueType}>`\n    }\n    return 'Record<string, any>'\n  }\n  if (prop.anyOf || prop.oneOf) {\n    const schemas = prop.anyOf || prop.oneOf\n    return schemas.map((s: any) => getTypeFromJsonSchema(s)).join(' | ')\n  }\n  return 'any'\n}\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/tools/definitions/tool-def-type.ts",
              "content": "import type { ToolName } from '@levelcode/common/tools/constants'\n\nexport type ToolDescription<T extends ToolName = ToolName> = {\n  toolName: T\n  description: string\n}\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/tools/definitions/list.ts",
              "content": "import { llmToolCallSchema } from '@levelcode/common/tools/list'\n\nimport { addMessageTool } from './tool/add-message'\nimport { addSubgoalTool } from './tool/add-subgoal'\nimport { browserLogsTool } from './tool/browser-logs'\nimport { codeSearchTool } from './tool/code-search'\nimport { createPlanTool } from './tool/create-plan'\nimport { endTurnTool } from './tool/end-turn'\nimport { findFilesTool } from './tool/find-files'\nimport { readDocsTool } from './tool/read-docs'\nimport { readFilesTool } from './tool/read-files'\nimport { runFileChangeHooksTool } from './tool/run-file-change-hooks'\nimport { runTerminalCommandTool } from './tool/run-terminal-command'\nimport { setMessagesTool } from './tool/set-messages'\nimport { setOutputTool } from './tool/set-output'\nimport { spawnAgentsTool } from './tool/spawn-agents'\nimport { spawnAgentsAsyncTool } from './tool/spawn-agents-async'\nimport { spawnAgentInlineTool } from './tool/spawn-agent-inline'\nimport { strReplaceTool } from './tool/str-replace'\nimport { thinkDeeplyTool } from './tool/think-deeply'\nimport { updateSubgoalTool } from './tool/update-subgoal'\nimport { webSearchTool } from './tool/web-search'\nimport { writeFileTool } from './tool/write-file'\n\nimport type { ToolDescription } from './tool-def-type'\nimport type { ToolName } from '@levelcode/common/tools/constants'\nimport type { ToolSet } from 'ai'\n\nconst toolDescriptions = {\n  add_message: addMessageTool,\n  add_subgoal: addSubgoalTool,\n  browser_logs: browserLogsTool,\n  code_search: codeSearchTool,\n  create_plan: createPlanTool,\n  end_turn: endTurnTool,\n  find_files: findFilesTool,\n  read_docs: readDocsTool,\n  read_files: readFilesTool,\n  run_file_change_hooks: runFileChangeHooksTool,\n  run_terminal_command: runTerminalCommandTool,\n  set_messages: setMessagesTool,\n  set_output: setOutputTool,\n  spawn_agents: spawnAgentsTool,\n  spawn_agents_async: spawnAgentsAsyncTool,\n  spawn_agent_inline: spawnAgentInlineTool,\n  str_replace: strReplaceTool,\n  think_deeply: thinkDeeplyTool,\n  update_subgoal: updateSubgoalTool,\n  web_search: webSearchTool,\n  write_file: writeFileTool,\n} satisfies {\n  [K in ToolName]: ToolDescription<K>\n}\n\nexport type ToolDefinition<T extends ToolName = ToolName> = {\n  [K in ToolName]: (typeof toolDescriptions)[K] & (typeof llmToolCallSchema)[K]\n}[T]\n\nexport const levelcodeToolDefs = Object.fromEntries(\n  Object.entries(toolDescriptions).map(([toolName, toolDescription]) => [\n    toolName,\n    {\n      ...toolDescriptions[toolName as ToolName],\n      ...llmToolCallSchema[toolName as ToolName],\n    } satisfies ToolDefinition,\n  ]),\n) as { [K in ToolName]: ToolDefinition<K> } satisfies ToolSet\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/list.ts",
              "content": "import { addMessageParams } from './params/tool/add-message'\nimport { addSubgoalParams } from './params/tool/add-subgoal'\nimport { browserLogsParams } from './params/tool/browser-logs'\nimport { codeSearchParams } from './params/tool/code-search'\nimport { createPlanParams } from './params/tool/create-plan'\nimport { endTurnParams } from './params/tool/end-turn'\nimport { findFilesParams } from './params/tool/find-files'\nimport { readDocsParams } from './params/tool/read-docs'\nimport { readFilesParams } from './params/tool/read-files'\nimport { runFileChangeHooksParams } from './params/tool/run-file-change-hooks'\nimport { runTerminalCommandParams } from './params/tool/run-terminal-command'\nimport { setMessagesParams } from './params/tool/set-messages'\nimport { setOutputParams } from './params/tool/set-output'\nimport { spawnAgentsParams } from './params/tool/spawn-agents'\nimport { spawnAgentsAsyncParams } from './params/tool/spawn-agents-async'\nimport { spawnAgentInlineParams } from './params/tool/spawn-agent-inline'\nimport { strReplaceParams } from './params/tool/str-replace'\nimport { thinkDeeplyParams } from './params/tool/think-deeply'\nimport { updateSubgoalParams } from './params/tool/update-subgoal'\nimport { webSearchParams } from './params/tool/web-search'\nimport { writeFileParams } from './params/tool/write-file'\n\nimport type { ToolName, ToolParams } from './constants'\n\nexport const llmToolCallSchema = {\n  add_message: addMessageParams,\n  add_subgoal: addSubgoalParams,\n  browser_logs: browserLogsParams,\n  code_search: codeSearchParams,\n  create_plan: createPlanParams,\n  end_turn: endTurnParams,\n  find_files: findFilesParams,\n  read_docs: readDocsParams,\n  read_files: readFilesParams,\n  run_file_change_hooks: runFileChangeHooksParams,\n  run_terminal_command: runTerminalCommandParams,\n  set_messages: setMessagesParams,\n  set_output: setOutputParams,\n  spawn_agents: spawnAgentsParams,\n  spawn_agents_async: spawnAgentsAsyncParams,\n  spawn_agent_inline: spawnAgentInlineParams,\n  str_replace: strReplaceParams,\n  think_deeply: thinkDeeplyParams,\n  update_subgoal: updateSubgoalParams,\n  web_search: webSearchParams,\n  write_file: writeFileParams,\n} satisfies {\n  [K in ToolName]: ToolParams<K>\n}\n\nexport const clientToolCallSchema = {\n  // Tools that require an id and objective\n  add_subgoal: ['id', 'objective', 'status', 'plan', 'log'],\n  update_subgoal: ['id', 'status', 'plan', 'log'],\n\n  // File operations\n  write_file: ['path', 'instructions', 'content'],\n  str_replace: ['path', 'replacements'],\n  read_files: ['paths'],\n  find_files: ['prompt'],\n\n  // Search and terminal\n  code_search: ['pattern', 'flags', 'cwd'],\n  run_terminal_command: ['command', 'process_type', 'cwd', 'timeout_seconds'],\n\n  // Planning tools\n  think_deeply: ['thought'],\n  create_plan: ['path', 'plan'],\n\n  browser_logs: ['type', 'url', 'waitUntil'],\n\n  spawn_agents: ['agents'],\n  spawn_agents_async: ['agents'],\n  spawn_agent_inline: ['agent_type', 'prompt', 'params'],\n  set_output: [],\n\n  // Documentation tool\n  read_docs: ['libraryTitle', 'topic', 'max_tokens'],\n\n  // Web search tool\n  web_search: ['query', 'depth'],\n\n  // File change hooks tool\n  run_file_change_hooks: ['files'],\n\n  // Tools that change the conversation history\n  add_message: ['role', 'content'],\n  set_messages: ['messages'],\n\n  end_turn: [],\n} as const satisfies Record<ToolName, string[]>\n",
              "referencedBy": {}
            },
            {
              "path": "sdk/src/types/tools.ts",
              "content": "/**\n * Union type of all available tool names\n */\nexport type ToolName =\n  | 'add_message'\n  | 'add_subgoal'\n  | 'browser_logs'\n  | 'code_search'\n  | 'create_plan'\n  | 'end_turn'\n  | 'find_files'\n  | 'read_docs'\n  | 'read_files'\n  | 'run_file_change_hooks'\n  | 'run_terminal_command'\n  | 'set_messages'\n  | 'set_output'\n  | 'spawn_agents'\n  | 'spawn_agents_async'\n  | 'spawn_agent_inline'\n  | 'str_replace'\n  | 'think_deeply'\n  | 'update_subgoal'\n  | 'web_search'\n  | 'write_file'\n\n/**\n * Map of tool names to their parameter types\n */\nexport interface ToolParamsMap {\n  add_message: AddMessageParams\n  add_subgoal: AddSubgoalParams\n  browser_logs: BrowserLogsParams\n  code_search: CodeSearchParams\n  create_plan: CreatePlanParams\n  end_turn: EndTurnParams\n  find_files: FindFilesParams\n  read_docs: ReadDocsParams\n  read_files: ReadFilesParams\n  run_file_change_hooks: RunFileChangeHooksParams\n  run_terminal_command: RunTerminalCommandParams\n  set_messages: SetMessagesParams\n  set_output: SetOutputParams\n  spawn_agents: SpawnAgentsParams\n  spawn_agents_async: SpawnAgentsAsyncParams\n  spawn_agent_inline: SpawnAgentInlineParams\n  str_replace: StrReplaceParams\n  think_deeply: ThinkDeeplyParams\n  update_subgoal: UpdateSubgoalParams\n  web_search: WebSearchParams\n  write_file: WriteFileParams\n}\n\n/**\n * Add a new message to the conversation history. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\n */\nexport interface AddMessageParams {\n  role: 'user' | 'assistant'\n  content: string\n}\n\n/**\n * Add a new subgoal for tracking progress. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\n */\nexport interface AddSubgoalParams {\n  /** A unique identifier for the subgoal. Try to choose the next sequential integer that is not already in use. */\n  id: string\n  /** The objective of the subgoal, concisely and clearly stated. */\n  objective: string\n  /** The status of the subgoal. */\n  status: 'NOT_STARTED' | 'IN_PROGRESS' | 'COMPLETE' | 'ABORTED'\n  /** A plan for the subgoal. */\n  plan?: string\n  /** A log message for the subgoal progress. */\n  log?: string\n}\n\n/**\n * Parameters for browser_logs tool\n */\nexport interface BrowserLogsParams {\n  /** The type of browser action to perform (e.g., \"navigate\"). */\n  type: string\n  /** The URL to navigate to. */\n  url: string\n  /** When to consider navigation successful. Defaults to 'load'. */\n  waitUntil?: 'load' | 'domcontentloaded' | 'networkidle0'\n}\n\n/**\n * Search for string patterns in the project's files. This tool uses ripgrep (rg), a fast line-oriented search tool. Use this tool only when read_files is not sufficient to find the files you need.\n */\nexport interface CodeSearchParams {\n  /** The pattern to search for. */\n  pattern: string\n  /** Optional ripgrep flags to customize the search (e.g., \"-i\" for case-insensitive, \"-t ts\" for TypeScript files only, \"-A 3\" for 3 lines after match, \"-B 2\" for 2 lines before match, \"--type-not test\" to exclude test files). */\n  flags?: string\n  /** Optional working directory to search within, relative to the project root. Defaults to searching the entire project. */\n  cwd?: string\n}\n\n/**\n * Generate a detailed markdown plan for complex tasks.\n */\nexport interface CreatePlanParams {\n  /** The path including the filename of a markdown file that will be overwritten with the plan. */\n  path: string\n  /** A detailed plan to solve the user's request. */\n  plan: string\n}\n\n/**\n * End your turn, regardless of any new tool results that might be coming. This will allow the user to type another prompt.\n */\nexport interface EndTurnParams {}\n\n/**\n * Find several files related to a brief natural language description of the files or the name of a function or class you are looking for.\n */\nexport interface FindFilesParams {\n  /** A brief natural language description of the files or the name of a function or class you are looking for. It's also helpful to mention a directory or two to look within. */\n  prompt: string\n}\n\n/**\n * Fetch up-to-date documentation for libraries and frameworks using Context7 API.\n */\nexport interface ReadDocsParams {\n  /** The exact library or framework name (e.g., \"Next.js\", \"MongoDB\", \"React\"). Use the official name as it appears in documentation, not a search query. */\n  libraryTitle: string\n  /** Optional specific topic to focus on (e.g., \"routing\", \"hooks\", \"authentication\") */\n  topic?: string\n  /** Optional maximum number of tokens to return. Defaults to 10000. Values less than 10000 are automatically increased to 10000. */\n  max_tokens?: number\n}\n\n/**\n * Read the multiple files from disk and return their contents. Use this tool to read as many files as would be helpful to answer the user's request.\n */\nexport interface ReadFilesParams {\n  /** List of file paths to read. */\n  paths: string[]\n}\n\n/**\n * Parameters for run_file_change_hooks tool\n */\nexport interface RunFileChangeHooksParams {\n  /** List of file paths that were changed and should trigger file change hooks */\n  files: string[]\n}\n\n/**\n * Execute a CLI command from the **project root** (different from the user's cwd).\n */\nexport interface RunTerminalCommandParams {\n  /** CLI command valid for user's OS. */\n  command: string\n  /** Either SYNC (waits, returns output) or BACKGROUND (runs in background). Default SYNC */\n  process_type?: 'SYNC' | 'BACKGROUND'\n  /** The working directory to run the command in. Default is the project root. */\n  cwd?: string\n  /** Set to -1 for no timeout. Does not apply for BACKGROUND commands. Default 30 */\n  timeout_seconds?: number\n}\n\n/**\n * Set the conversation history to the provided messages.\n */\nexport interface SetMessagesParams {\n  messages: {\n    role: 'user' | 'assistant'\n    content: string\n  }[]\n}\n\n/**\n * JSON object to set as the agent output. This completely replaces any previous output. If the agent was spawned, this value will be passed back to its parent. If the agent has an outputSchema defined, the output will be validated against it.\n */\nexport interface SetOutputParams {}\n\n/**\n * Spawn multiple agents and send a prompt to each of them.\n */\nexport interface SpawnAgentsParams {\n  agents: {\n    /** Agent to spawn */\n    agent_type: string\n    /** Prompt to send to the agent */\n    prompt?: string\n    /** Parameters object for the agent (if any) */\n    params?: Record<string, any>\n  }[]\n}\n\n/**\n * Parameters for spawn_agents_async tool\n */\nexport interface SpawnAgentsAsyncParams {\n  agents: {\n    /** Agent to spawn */\n    agent_type: string\n    /** Prompt to send to the agent */\n    prompt?: string\n    /** Parameters object for the agent (if any) */\n    params?: Record<string, any>\n  }[]\n}\n\n/**\n * Spawn a single agent that runs within the current message history.\n */\nexport interface SpawnAgentInlineParams {\n  /** Agent to spawn */\n  agent_type: string\n  /** Prompt to send to the agent */\n  prompt?: string\n  /** Parameters object for the agent (if any) */\n  params?: Record<string, any>\n}\n\n/**\n * Replace strings in a file with new strings.\n */\nexport interface StrReplaceParams {\n  /** The path to the file to edit. */\n  path: string\n  /** Array of replacements to make. */\n  replacements: {\n    /** The string to replace. This must be an *exact match* of the string you want to replace, including whitespace and punctuation. */\n    old: string\n    /** The string to replace the corresponding old string with. Can be empty to delete. */\n    new: string\n  }[]\n}\n\n/**\n * Deeply consider complex tasks by brainstorming approaches and tradeoffs step-by-step.\n */\nexport interface ThinkDeeplyParams {\n  /** Detailed step-by-step analysis. Initially keep each step concise (max ~5-7 words per step). */\n  thought: string\n}\n\n/**\n * Update a subgoal in the context given the id, and optionally the status or plan, or a new log to append. Feel free to update any combination of the status, plan, or log in one invocation.\n */\nexport interface UpdateSubgoalParams {\n  /** The id of the subgoal to update. */\n  id: string\n  /** Change the status of the subgoal. */\n  status?: 'NOT_STARTED' | 'IN_PROGRESS' | 'COMPLETE' | 'ABORTED'\n  /** Change the plan for the subgoal. */\n  plan?: string\n  /** Add a log message to the subgoal. This will create a new log entry and append it to the existing logs. Use this to record your progress and any new information you learned as you go. */\n  log?: string\n}\n\n/**\n * Search the web for current information using Linkup API.\n */\nexport interface WebSearchParams {\n  /** The search query to find relevant web content */\n  query: string\n  /** Search depth - 'standard' for quick results, 'deep' for more comprehensive search. Default is 'standard'. */\n  depth: 'standard' | 'deep'\n}\n\n/**\n * Create or edit a file with the given content.\n */\nexport interface WriteFileParams {\n  /** Path to the file relative to the **project root** */\n  path: string\n  /** What the change is intended to do in only one sentence. */\n  instructions: string\n  /** Edit snippet to apply to the file. */\n  content: string\n}\n\n/**\n * Get parameters type for a specific tool\n */\nexport type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/tools/handlers/list.ts",
              "content": "import { handleAddMessage } from './tool/add-message'\nimport { handleAddSubgoal } from './tool/add-subgoal'\nimport { handleBrowserLogs } from './tool/browser-logs'\nimport { handleCodeSearch } from './tool/code-search'\nimport { handleCreatePlan } from './tool/create-plan'\nimport { handleEndTurn } from './tool/end-turn'\nimport { handleFindFiles } from './tool/find-files'\nimport { handleReadDocs } from './tool/read-docs'\nimport { handleReadFiles } from './tool/read-files'\nimport { handleRunFileChangeHooks } from './tool/run-file-change-hooks'\nimport { handleRunTerminalCommand } from './tool/run-terminal-command'\nimport { handleSetMessages } from './tool/set-messages'\nimport { handleSetOutput } from './tool/set-output'\nimport { handleSpawnAgents } from './tool/spawn-agents'\nimport { handleSpawnAgentsAsync } from './tool/spawn-agents-async'\nimport { handleSpawnAgentInline } from './tool/spawn-agent-inline'\nimport { handleStrReplace } from './tool/str-replace'\nimport { handleThinkDeeply } from './tool/think-deeply'\nimport { handleUpdateSubgoal } from './tool/update-subgoal'\nimport { handleWebSearch } from './tool/web-search'\nimport { handleWriteFile } from './tool/write-file'\n\nimport type { LevelCodeToolHandlerFunction } from './handler-function-type'\nimport type { ToolName } from '@levelcode/common/tools/constants'\n\n/**\n * Each value in this record that:\n * - Will be called immediately once it is parsed out of the stream.\n * - Takes as argument\n *   - The previous tool call (to await)\n *   - The LevelCodeToolCall for the current tool\n *   - Any additional arguments for the tool\n * - Returns a promise that will be awaited\n */\nexport const levelcodeToolHandlers = {\n  add_message: handleAddMessage,\n  add_subgoal: handleAddSubgoal,\n  browser_logs: handleBrowserLogs,\n  code_search: handleCodeSearch,\n  create_plan: handleCreatePlan,\n  end_turn: handleEndTurn,\n  find_files: handleFindFiles,\n  read_docs: handleReadDocs,\n  read_files: handleReadFiles,\n  run_file_change_hooks: handleRunFileChangeHooks,\n  run_terminal_command: handleRunTerminalCommand,\n  set_messages: handleSetMessages,\n  set_output: handleSetOutput,\n  spawn_agents: handleSpawnAgents,\n  spawn_agents_async: handleSpawnAgentsAsync,\n  spawn_agent_inline: handleSpawnAgentInline,\n  str_replace: handleStrReplace,\n  think_deeply: handleThinkDeeply,\n  update_subgoal: handleUpdateSubgoal,\n  web_search: handleWebSearch,\n  write_file: handleWriteFile,\n} satisfies {\n  [K in ToolName]: LevelCodeToolHandlerFunction<K>\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/params/tool/add-message.ts",
              "content": "import z from 'zod/v4'\n\nimport type { ToolParams } from '../../constants'\n\nconst toolName = 'add_message'\nconst endsAgentStep = true\nexport const addMessageParams = {\n  toolName,\n  endsAgentStep,\n  parameters: z\n    .object({\n      role: z.enum(['user', 'assistant']),\n      content: z.string(),\n    })\n    .describe(\n      `Add a new message to the conversation history. To be used for complex requests that can't be solved in a single step, as you may forget what happened!`,\n    ),\n} satisfies ToolParams\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/params/tool/add-subgoal.ts",
              "content": "import z from 'zod/v4'\n\nimport type { ToolParams } from '../../constants'\n\nconst toolName = 'add_subgoal'\nconst endsAgentStep = false\nexport const addSubgoalParams = {\n  toolName,\n  endsAgentStep,\n  parameters: z\n    .object({\n      id: z\n        .string()\n        .min(1, 'Id cannot be empty')\n        .describe(\n          `A unique identifier for the subgoal. Try to choose the next sequential integer that is not already in use.`,\n        ),\n      objective: z\n        .string()\n        .min(1, 'Objective cannot be empty')\n        .describe(\n          `The objective of the subgoal, concisely and clearly stated.`,\n        ),\n      status: z\n        .enum(['NOT_STARTED', 'IN_PROGRESS', 'COMPLETE', 'ABORTED'])\n        .describe(`The status of the subgoal.`),\n      plan: z.string().optional().describe('A plan for the subgoal.'),\n      log: z\n        .string()\n        .optional()\n        .describe('A log message for the subgoal progress.'),\n    })\n    .describe(\n      `Add a new subgoal for tracking progress. To be used for complex requests that can't be solved in a single step, as you may forget what happened!`,\n    ),\n} satisfies ToolParams\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/tools/definitions/tool/add-message.ts",
              "content": "import { getToolCallString } from '@levelcode/common/tools/utils'\n\nimport type { ToolDescription } from '../tool-def-type'\n\nconst toolName = 'add_message'\nexport const addMessageTool = {\n  toolName,\n  description: `\nExample:\n    ${getToolCallString(toolName, {\n      role: 'user',\n      content: 'Hello, how are you?',\n    })}\n  `.trim(),\n} satisfies ToolDescription\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/tools/definitions/tool/add-subgoal.ts",
              "content": "import { getToolCallString } from '@levelcode/common/tools/utils'\n\nimport type { ToolDescription } from '../tool-def-type'\n\nconst toolName = 'add_subgoal'\nexport const addSubgoalTool = {\n  toolName,\n  description: `\nExample:\n${getToolCallString(toolName, {\n  id: '1',\n  objective: 'Add a new \"deploy api\" subgoal',\n  status: 'IN_PROGRESS',\n})}\n`.trim(),\n} satisfies ToolDescription\n",
              "referencedBy": {}
            },
            {
              "path": "sdk/src/tools/change-file.ts",
              "content": "import z from 'zod'\nimport fs from 'fs'\nimport path from 'path'\nimport { applyPatch } from '../../../common/src/util/patch'\n\nconst FileChangeSchema = z.object({\n  type: z.enum(['patch', 'file']),\n  path: z.string(),\n  content: z.string(),\n})\n\nexport function changeFile(\n  parameters: unknown,\n  cwd: string,\n): { toolResultMessage: string } {\n  if (cwd.includes('../')) {\n    throw new Error('cwd cannot include ../')\n  }\n  const fileChange = FileChangeSchema.parse(parameters)\n  const lines = fileChange.content.split('\\n')\n\n  const { created, modified, invalid } = applyChanges(cwd, [fileChange])\n\n  const results: string[] = []\n\n  for (const file of created) {\n    results.push(\n      `Created ${file} successfully. Changes made:\\n${lines.join('\\n')}`,\n    )\n  }\n\n  for (const file of modified) {\n    results.push(\n      `Wrote to ${file} successfully. Changes made:\\n${lines.join('\\n')}`,\n    )\n  }\n\n  for (const file of invalid) {\n    results.push(\n      `Failed to write to ${file}; file path caused an error or file could not be written`,\n    )\n  }\n\n  return { toolResultMessage: results.join('\\n') }\n}\n\nfunction applyChanges(\n  projectRoot: string,\n  changes: {\n    type: 'patch' | 'file'\n    path: string\n    content: string\n  }[],\n) {\n  const created: string[] = []\n  const modified: string[] = []\n  const invalid: string[] = []\n\n  for (const change of changes) {\n    const { path: filePath, content, type } = change\n    try {\n      const fullPath = path.join(projectRoot, filePath)\n      const fileExists = fs.existsSync(fullPath)\n      if (!fileExists) {\n        const dirPath = path.dirname(fullPath)\n        fs.mkdirSync(dirPath, { recursive: true })\n      }\n\n      if (type === 'file') {\n        fs.writeFileSync(fullPath, content)\n      } else {\n        const oldContent = fs.readFileSync(fullPath, 'utf-8')\n        const newContent = applyPatch(oldContent, content)\n        fs.writeFileSync(fullPath, newContent)\n      }\n\n      if (fileExists) {\n        modified.push(filePath)\n      } else {\n        created.push(filePath)\n      }\n    } catch (error) {\n      console.error(`Failed to apply patch to ${filePath}:`, error, content)\n      invalid.push(filePath)\n    }\n  }\n\n  return { created, modified, invalid }\n}\n",
              "referencedBy": {}
            }
          ]
        }
      ],
      "parentAgentId": "D-Upph7O3-0"
    },
    {
      "type": "text",
      "agentId": "D-Upph7O3-0",
      "text": "Here's a summary of the most relevant files:\n\n*   `scripts/generate-tool-definitions.ts`: Script to regenerate tool definitions from schemas.\n*   `common/src/tools/compile-tool-definitions.ts`: Compiles tool definitions into TypeScript.\n*   `sdk/src/types/tools.ts`: Type definitions for tools.\n*   `backend/src/tools/definitions/list.ts`: Defines available tools and their descriptions.\n*   `common/src/tools/list.ts`:  Schemas for validating parameters of tools.\n*   `sdk/src/tools/change-file.ts`: modify files\n"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-Upph7O3-0",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Find all files related to tool definitions, tool schemas, type generation scripts like generate-tool-definitions.ts, tool registries, and public tool exports. Include files in backend, scripts, sdk, common."
    },
    {
      "type": "text",
      "agentId": "D-UppvyfWNM",
      "text": "sdk/src/types/tools.ts\nsdk/src/types/agent-definition.ts\nsdk/src/tools/change-file.ts\nsdk/src/tools/read-files.ts\ncommon/src/tools/constants.ts\ncommon/src/tools/list.ts\ncommon/src/tools/utils.ts\ncommon/src/tools/compile-tool-definitions.ts\ncommon/src/types/dynamic-agent-template.ts\ncommon/src/types/agent-template.ts\ncommon/src/util/xml.ts\ncommon/src/websockets/websocket-schema.ts"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-Up8asoMmA",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-UppvyfWNM",
      "prompt": "Find files in sdk/src and common/src that define or use tool types, unions, or interfaces like ToolCall, ToolSchema, etc.",
      "params": {}
    },
    {
      "type": "tool_result",
      "toolCallId": "d0f2d613-2d62-4d19-9cf2-134e939daa49",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Liszt the File Lister",
              "agentType": "file-lister",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "sdk/src/types/tools.ts\nsdk/src/types/agent-definition.ts\nsdk/src/tools/change-file.ts\nsdk/src/tools/read-files.ts\ncommon/src/tools/constants.ts\ncommon/src/tools/list.ts\ncommon/src/tools/utils.ts\ncommon/src/tools/compile-tool-definitions.ts\ncommon/src/types/dynamic-agent-template.ts\ncommon/src/types/agent-template.ts\ncommon/src/util/xml.ts\ncommon/src/websockets/websocket-schema.ts"
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ],
      "parentAgentId": "D-UppvyfWNM"
    },
    {
      "type": "tool_call",
      "toolCallId": "c8892279-ae06-4127-93bd-64d285e8a7bc",
      "toolName": "read_files",
      "input": {
        "paths": [
          "sdk/src/types/tools.ts",
          "sdk/src/types/agent-definition.ts",
          "sdk/src/tools/change-file.ts",
          "sdk/src/tools/read-files.ts",
          "common/src/tools/constants.ts",
          "common/src/tools/list.ts",
          "common/src/tools/utils.ts",
          "common/src/tools/compile-tool-definitions.ts",
          "common/src/types/dynamic-agent-template.ts",
          "common/src/types/agent-template.ts",
          "common/src/util/xml.ts",
          "common/src/websockets/websocket-schema.ts"
        ]
      },
      "agentId": "D-UppvyfWNM",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "c8892279-ae06-4127-93bd-64d285e8a7bc",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": "sdk/src/types/tools.ts",
              "content": "/**\n * Union type of all available tool names\n */\nexport type ToolName =\n  | 'add_message'\n  | 'add_subgoal'\n  | 'browser_logs'\n  | 'code_search'\n  | 'create_plan'\n  | 'end_turn'\n  | 'find_files'\n  | 'read_docs'\n  | 'read_files'\n  | 'run_file_change_hooks'\n  | 'run_terminal_command'\n  | 'set_messages'\n  | 'set_output'\n  | 'spawn_agents'\n  | 'spawn_agents_async'\n  | 'spawn_agent_inline'\n  | 'str_replace'\n  | 'think_deeply'\n  | 'update_subgoal'\n  | 'web_search'\n  | 'write_file'\n\n/**\n * Map of tool names to their parameter types\n */\nexport interface ToolParamsMap {\n  add_message: AddMessageParams\n  add_subgoal: AddSubgoalParams\n  browser_logs: BrowserLogsParams\n  code_search: CodeSearchParams\n  create_plan: CreatePlanParams\n  end_turn: EndTurnParams\n  find_files: FindFilesParams\n  read_docs: ReadDocsParams\n  read_files: ReadFilesParams\n  run_file_change_hooks: RunFileChangeHooksParams\n  run_terminal_command: RunTerminalCommandParams\n  set_messages: SetMessagesParams\n  set_output: SetOutputParams\n  spawn_agents: SpawnAgentsParams\n  spawn_agents_async: SpawnAgentsAsyncParams\n  spawn_agent_inline: SpawnAgentInlineParams\n  str_replace: StrReplaceParams\n  think_deeply: ThinkDeeplyParams\n  update_subgoal: UpdateSubgoalParams\n  web_search: WebSearchParams\n  write_file: WriteFileParams\n}\n\n/**\n * Add a new message to the conversation history. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\n */\nexport interface AddMessageParams {\n  role: 'user' | 'assistant'\n  content: string\n}\n\n/**\n * Add a new subgoal for tracking progress. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\n */\nexport interface AddSubgoalParams {\n  /** A unique identifier for the subgoal. Try to choose the next sequential integer that is not already in use. */\n  id: string\n  /** The objective of the subgoal, concisely and clearly stated. */\n  objective: string\n  /** The status of the subgoal. */\n  status: 'NOT_STARTED' | 'IN_PROGRESS' | 'COMPLETE' | 'ABORTED'\n  /** A plan for the subgoal. */\n  plan?: string\n  /** A log message for the subgoal progress. */\n  log?: string\n}\n\n/**\n * Parameters for browser_logs tool\n */\nexport interface BrowserLogsParams {\n  /** The type of browser action to perform (e.g., \"navigate\"). */\n  type: string\n  /** The URL to navigate to. */\n  url: string\n  /** When to consider navigation successful. Defaults to 'load'. */\n  waitUntil?: 'load' | 'domcontentloaded' | 'networkidle0'\n}\n\n/**\n * Search for string patterns in the project's files. This tool uses ripgrep (rg), a fast line-oriented search tool. Use this tool only when read_files is not sufficient to find the files you need.\n */\nexport interface CodeSearchParams {\n  /** The pattern to search for. */\n  pattern: string\n  /** Optional ripgrep flags to customize the search (e.g., \"-i\" for case-insensitive, \"-t ts\" for TypeScript files only, \"-A 3\" for 3 lines after match, \"-B 2\" for 2 lines before match, \"--type-not test\" to exclude test files). */\n  flags?: string\n  /** Optional working directory to search within, relative to the project root. Defaults to searching the entire project. */\n  cwd?: string\n}\n\n/**\n * Generate a detailed markdown plan for complex tasks.\n */\nexport interface CreatePlanParams {\n  /** The path including the filename of a markdown file that will be overwritten with the plan. */\n  path: string\n  /** A detailed plan to solve the user's request. */\n  plan: string\n}\n\n/**\n * End your turn, regardless of any new tool results that might be coming. This will allow the user to type another prompt.\n */\nexport interface EndTurnParams {}\n\n/**\n * Find several files related to a brief natural language description of the files or the name of a function or class you are looking for.\n */\nexport interface FindFilesParams {\n  /** A brief natural language description of the files or the name of a function or class you are looking for. It's also helpful to mention a directory or two to look within. */\n  prompt: string\n}\n\n/**\n * Fetch up-to-date documentation for libraries and frameworks using Context7 API.\n */\nexport interface ReadDocsParams {\n  /** The exact library or framework name (e.g., \"Next.js\", \"MongoDB\", \"React\"). Use the official name as it appears in documentation, not a search query. */\n  libraryTitle: string\n  /** Optional specific topic to focus on (e.g., \"routing\", \"hooks\", \"authentication\") */\n  topic?: string\n  /** Optional maximum number of tokens to return. Defaults to 10000. Values less than 10000 are automatically increased to 10000. */\n  max_tokens?: number\n}\n\n/**\n * Read the multiple files from disk and return their contents. Use this tool to read as many files as would be helpful to answer the user's request.\n */\nexport interface ReadFilesParams {\n  /** List of file paths to read. */\n  paths: string[]\n}\n\n/**\n * Parameters for run_file_change_hooks tool\n */\nexport interface RunFileChangeHooksParams {\n  /** List of file paths that were changed and should trigger file change hooks */\n  files: string[]\n}\n\n/**\n * Execute a CLI command from the **project root** (different from the user's cwd).\n */\nexport interface RunTerminalCommandParams {\n  /** CLI command valid for user's OS. */\n  command: string\n  /** Either SYNC (waits, returns output) or BACKGROUND (runs in background). Default SYNC */\n  process_type?: 'SYNC' | 'BACKGROUND'\n  /** The working directory to run the command in. Default is the project root. */\n  cwd?: string\n  /** Set to -1 for no timeout. Does not apply for BACKGROUND commands. Default 30 */\n  timeout_seconds?: number\n}\n\n/**\n * Set the conversation history to the provided messages.\n */\nexport interface SetMessagesParams {\n  messages: {\n    role: 'user' | 'assistant'\n    content: string\n  }[]\n}\n\n/**\n * JSON object to set as the agent output. This completely replaces any previous output. If the agent was spawned, this value will be passed back to its parent. If the agent has an outputSchema defined, the output will be validated against it.\n */\nexport interface SetOutputParams {}\n\n/**\n * Spawn multiple agents and send a prompt to each of them.\n */\nexport interface SpawnAgentsParams {\n  agents: {\n    /** Agent to spawn */\n    agent_type: string\n    /** Prompt to send to the agent */\n    prompt?: string\n    /** Parameters object for the agent (if any) */\n    params?: Record<string, any>\n  }[]\n}\n\n/**\n * Parameters for spawn_agents_async tool\n */\nexport interface SpawnAgentsAsyncParams {\n  agents: {\n    /** Agent to spawn */\n    agent_type: string\n    /** Prompt to send to the agent */\n    prompt?: string\n    /** Parameters object for the agent (if any) */\n    params?: Record<string, any>\n  }[]\n}\n\n/**\n * Spawn a single agent that runs within the current message history.\n */\nexport interface SpawnAgentInlineParams {\n  /** Agent to spawn */\n  agent_type: string\n  /** Prompt to send to the agent */\n  prompt?: string\n  /** Parameters object for the agent (if any) */\n  params?: Record<string, any>\n}\n\n/**\n * Replace strings in a file with new strings.\n */\nexport interface StrReplaceParams {\n  /** The path to the file to edit. */\n  path: string\n  /** Array of replacements to make. */\n  replacements: {\n    /** The string to replace. This must be an *exact match* of the string you want to replace, including whitespace and punctuation. */\n    old: string\n    /** The string to replace the corresponding old string with. Can be empty to delete. */\n    new: string\n  }[]\n}\n\n/**\n * Deeply consider complex tasks by brainstorming approaches and tradeoffs step-by-step.\n */\nexport interface ThinkDeeplyParams {\n  /** Detailed step-by-step analysis. Initially keep each step concise (max ~5-7 words per step). */\n  thought: string\n}\n\n/**\n * Update a subgoal in the context given the id, and optionally the status or plan, or a new log to append. Feel free to update any combination of the status, plan, or log in one invocation.\n */\nexport interface UpdateSubgoalParams {\n  /** The id of the subgoal to update. */\n  id: string\n  /** Change the status of the subgoal. */\n  status?: 'NOT_STARTED' | 'IN_PROGRESS' | 'COMPLETE' | 'ABORTED'\n  /** Change the plan for the subgoal. */\n  plan?: string\n  /** Add a log message to the subgoal. This will create a new log entry and append it to the existing logs. Use this to record your progress and any new information you learned as you go. */\n  log?: string\n}\n\n/**\n * Search the web for current information using Linkup API.\n */\nexport interface WebSearchParams {\n  /** The search query to find relevant web content */\n  query: string\n  /** Search depth - 'standard' for quick results, 'deep' for more comprehensive search. Default is 'standard'. */\n  depth: 'standard' | 'deep'\n}\n\n/**\n * Create or edit a file with the given content.\n */\nexport interface WriteFileParams {\n  /** Path to the file relative to the **project root** */\n  path: string\n  /** What the change is intended to do in only one sentence. */\n  instructions: string\n  /** Edit snippet to apply to the file. */\n  content: string\n}\n\n/**\n * Get parameters type for a specific tool\n */\nexport type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n",
              "referencedBy": {}
            },
            {
              "path": "sdk/src/types/agent-definition.ts",
              "content": "/**\n * LevelCode Agent Type Definitions\n *\n * This file provides TypeScript type definitions for creating custom LevelCode agents.\n * Import these types in your agent files to get full type safety and IntelliSense.\n *\n * Usage in .agents/your-agent.ts:\n *   import { AgentDefinition, ToolName, ModelName } from './types/agent-definition'\n *\n *   const config: AgentDefinition = {\n *     // ... your agent configuration with full type safety ...\n *   }\n *\n *   export default config\n */\n\n// ============================================================================\n// Agent Definition and Utility Types\n// ============================================================================\n\nexport interface AgentDefinition {\n  /** Unique identifier for this agent. Must contain only lowercase letters, numbers, and hyphens, e.g. 'code-reviewer' */\n  id: string\n\n  /** Version string (if not provided, will default to '0.0.1' and be bumped on each publish) */\n  version?: string\n\n  /** Publisher ID for the agent. Must be provided if you want to publish the agent. */\n  publisher?: string\n\n  /** Human-readable name for the agent */\n  displayName: string\n\n  /** AI model to use for this agent. Can be any model in OpenRouter: https://openrouter.ai/models */\n  model: ModelName\n\n  // ============================================================================\n  // Tools and Subagents\n  // ============================================================================\n\n  /** Tools this agent can use. */\n  toolNames?: ToolName[]\n\n  /** Other agents this agent can spawn, like 'levelcode/file-picker@0.0.1'.\n   *\n   * Use the fully qualified agent id from the agent store, including publisher and version: 'levelcode/file-picker@0.0.1'\n   * (publisher and version are required!)\n   *\n   * Or, use the agent id from a local agent file in your .agents directory: 'file-picker'.\n   */\n  spawnableAgents?: string[]\n\n  // ============================================================================\n  // Input and Output\n  // ============================================================================\n\n  /** The input schema required to spawn the agent. Provide a prompt string and/or a params object or none.\n   * 80% of the time you want just a prompt string with a description:\n   * inputSchema: {\n   *   prompt: { type: 'string', description: 'A description of what info would be helpful to the agent' }\n   * }\n   */\n  inputSchema?: {\n    prompt?: { type: 'string'; description?: string }\n    params?: JsonSchema\n  }\n\n  /** Whether to include conversation history from the parent agent in context.\n   *\n   * Defaults to false.\n   * Use this if the agent needs to know all the previous messages in the conversation.\n   */\n  includeMessageHistory?: boolean\n\n  /** How the agent should output a response to its parent (defaults to 'last_message')\n   *\n   * last_message: The last message from the agent, typcically after using tools.\n   *\n   * all_messages: All messages from the agent, including tool calls and results.\n   *\n   * json: Make the agent output a JSON object. Can be used with outputSchema or without if you want freeform json output.\n   */\n  outputMode?: 'last_message' | 'all_messages' | 'structured_output'\n\n  /** JSON schema for structured output (when outputMode is 'structured_output') */\n  outputSchema?: JsonSchema\n\n  // ============================================================================\n  // Prompts\n  // ============================================================================\n\n  /** Prompt for when to spawn this agent as a subagent. Include the main purpose and use cases.\n   *\n   * This field is key if the agent is a subagent and intended to be spawned. */\n  parentPrompt?: string\n\n  /** Background information for the agent. Fairly optional. Prefer using instructionsPrompt for agent instructions. */\n  systemPrompt?: string\n\n  /** Instructions for the agent.\n   *\n   * IMPORTANT: Updating this prompt is the best way to shape the agent's behavior.\n   * This prompt is inserted after each user input. */\n  instructionsPrompt?: string\n\n  /** Prompt inserted at each agent step.\n   *\n   * Powerful for changing the agent's behavior, but usually not necessary for smart models.\n   * Prefer instructionsPrompt for most instructions. */\n  stepPrompt?: string\n\n  // ============================================================================\n  // Handle Steps\n  // ============================================================================\n\n  /** Programmatically step the agent forward and run tools.\n   *\n   * You can either yield:\n   * - A tool call object with toolName and args properties.\n   * - 'STEP' to run agent's model and generate one assistant message.\n   * - 'STEP_ALL' to run the agent's model until it uses the end_turn tool or stops includes no tool calls in a message.\n   *\n   * Or use 'return' to end the turn.\n   *\n   * Example 1:\n   * function* handleSteps({ agentStep, prompt, params}) {\n   *   const { toolResult } = yield {\n   *     toolName: 'read_files',\n   *     args: { paths: ['file1.txt', 'file2.txt'] }\n   *   }\n   *   yield 'STEP_ALL'\n   * }\n   *\n   * Example 2:\n   * handleSteps: function* ({ agentState, prompt, params }) {\n   *   while (true) {\n   *     yield {\n   *       toolName: 'spawn_agents',\n   *       args: {\n   *         agents: [\n   *         {\n   *           agent_type: 'thinker',\n   *           prompt: 'Think deeply about the user request',\n   *         },\n   *       ],\n   *     },\n   *   }\n   *   yield 'STEP'\n   * }\n   * }\n   */\n  handleSteps?: (\n    context: AgentStepContext,\n  ) => Generator<\n    ToolCall | 'STEP' | 'STEP_ALL',\n    void,\n    { agentState: AgentState; toolResult: string | undefined }\n  >\n}\n\n// ============================================================================\n// Supporting Types\n// ============================================================================\n\nexport interface AgentState {\n  agentId: string\n  parentId: string\n  messageHistory: Message[]\n}\n\n/**\n * Message in conversation history\n */\nexport interface Message {\n  role: 'user' | 'assistant'\n  content: string\n}\n\n/**\n * Context provided to handleSteps generator function\n */\nexport interface AgentStepContext {\n  agentState: AgentState\n  prompt?: string\n  params?: Record<string, any>\n}\n\n/**\n * Tool call object for handleSteps generator\n */\nexport type ToolCall<T extends ToolName = ToolName> = {\n  [K in T]: {\n    toolName: K\n    args?: Tools.GetToolParams<K>\n  }\n}[T]\n\n/**\n * JSON Schema definition (for prompt schema or output schema)\n */\nexport interface JsonSchema {\n  type: string\n  properties?: Record<string, any>\n  required?: string[]\n  [key: string]: any\n}\n\n// ============================================================================\n// Available Tools\n// ============================================================================\n\n/**\n * File operation tools\n */\nexport type FileTools =\n  | 'read_files'\n  | 'write_file'\n  | 'str_replace'\n  | 'find_files'\n\n/**\n * Code analysis tools\n */\nexport type CodeAnalysisTools = 'code_search' | 'find_files'\n\n/**\n * Terminal and system tools\n */\nexport type TerminalTools = 'run_terminal_command' | 'run_file_change_hooks'\n\n/**\n * Web and browser tools\n */\nexport type WebTools = 'browser_logs' | 'web_search' | 'read_docs'\n\n/**\n * Agent management tools\n */\nexport type AgentTools =\n  | 'spawn_agents'\n  | 'spawn_agents_async'\n  | 'send_agent_message'\n  | 'set_messages'\n  | 'add_message'\n\n/**\n * Planning and organization tools\n */\nexport type PlanningTools =\n  | 'think_deeply'\n  | 'create_plan'\n  | 'add_subgoal'\n  | 'update_subgoal'\n\n/**\n * Output and control tools\n */\nexport type OutputTools = 'set_output' | 'end_turn'\n\n/**\n * Common tool combinations for convenience\n */\nexport type FileEditingTools = FileTools | 'end_turn'\nexport type ResearchTools = WebTools | 'write_file' | 'end_turn'\nexport type CodeAnalysisToolSet = FileTools | CodeAnalysisTools | 'end_turn'\n\n// ============================================================================\n// Available Models (see: https://openrouter.ai/models)\n// ============================================================================\n\n/**\n * AI models available for agents. Pick from our selection of recommended models or choose any model in OpenRouter.\n *\n * See available models at https://openrouter.ai/models\n */\nexport type ModelName =\n  // Recommended Models\n\n  // OpenAI\n  | 'openai/gpt-5'\n  | 'openai/gpt-5-mini'\n  | 'openai/gpt-5-nano'\n\n  // Anthropic\n  | 'anthropic/claude-4-sonnet-20250522'\n  | 'anthropic/claude-opus-4.1'\n\n  // Gemini\n  | 'google/gemini-2.5-pro'\n  | 'google/gemini-2.5-flash'\n  | 'google/gemini-2.5-flash-lite'\n\n  // X-AI\n  | 'x-ai/grok-4-07-09'\n\n  // Qwen\n  | 'qwen/qwen3-coder'\n  | 'qwen/qwen3-coder:fast'\n  | 'qwen/qwen3-235b-a22b-2507'\n  | 'qwen/qwen3-235b-a22b-2507:fast'\n  | 'qwen/qwen3-235b-a22b-thinking-2507'\n  | 'qwen/qwen3-235b-a22b-thinking-2507:fast'\n  | 'qwen/qwen3-30b-a3b'\n  | 'qwen/qwen3-30b-a3b:fast'\n\n  // DeepSeek\n  | 'deepseek/deepseek-chat-v3-0324'\n  | 'deepseek/deepseek-chat-v3-0324:fast'\n  | 'deepseek/deepseek-r1-0528'\n  | 'deepseek/deepseek-r1-0528:fast'\n\n  // Other open source models\n  | 'moonshotai/kimi-k2'\n  | 'moonshotai/kimi-k2:fast'\n  | 'z-ai/glm-4.5'\n  | 'z-ai/glm-4.5:fast'\n  | (string & {})\n\nimport type * as Tools from './tools'\nexport type { Tools }\ntype ToolName = Tools.ToolName\n",
              "referencedBy": {}
            },
            {
              "path": "sdk/src/tools/change-file.ts",
              "content": "import z from 'zod'\nimport fs from 'fs'\nimport path from 'path'\nimport { applyPatch } from '../../../common/src/util/patch'\n\nconst FileChangeSchema = z.object({\n  type: z.enum(['patch', 'file']),\n  path: z.string(),\n  content: z.string(),\n})\n\nexport function changeFile(\n  parameters: unknown,\n  cwd: string,\n): { toolResultMessage: string } {\n  if (cwd.includes('../')) {\n    throw new Error('cwd cannot include ../')\n  }\n  const fileChange = FileChangeSchema.parse(parameters)\n  const lines = fileChange.content.split('\\n')\n\n  const { created, modified, invalid } = applyChanges(cwd, [fileChange])\n\n  const results: string[] = []\n\n  for (const file of created) {\n    results.push(\n      `Created ${file} successfully. Changes made:\\n${lines.join('\\n')}`,\n    )\n  }\n\n  for (const file of modified) {\n    results.push(\n      `Wrote to ${file} successfully. Changes made:\\n${lines.join('\\n')}`,\n    )\n  }\n\n  for (const file of invalid) {\n    results.push(\n      `Failed to write to ${file}; file path caused an error or file could not be written`,\n    )\n  }\n\n  return { toolResultMessage: results.join('\\n') }\n}\n\nfunction applyChanges(\n  projectRoot: string,\n  changes: {\n    type: 'patch' | 'file'\n    path: string\n    content: string\n  }[],\n) {\n  const created: string[] = []\n  const modified: string[] = []\n  const invalid: string[] = []\n\n  for (const change of changes) {\n    const { path: filePath, content, type } = change\n    try {\n      const fullPath = path.join(projectRoot, filePath)\n      const fileExists = fs.existsSync(fullPath)\n      if (!fileExists) {\n        const dirPath = path.dirname(fullPath)\n        fs.mkdirSync(dirPath, { recursive: true })\n      }\n\n      if (type === 'file') {\n        fs.writeFileSync(fullPath, content)\n      } else {\n        const oldContent = fs.readFileSync(fullPath, 'utf-8')\n        const newContent = applyPatch(oldContent, content)\n        fs.writeFileSync(fullPath, newContent)\n      }\n\n      if (fileExists) {\n        modified.push(filePath)\n      } else {\n        created.push(filePath)\n      }\n    } catch (error) {\n      console.error(`Failed to apply patch to ${filePath}:`, error, content)\n      invalid.push(filePath)\n    }\n  }\n\n  return { created, modified, invalid }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "sdk/src/tools/read-files.ts",
              "content": "import { FILE_READ_STATUS } from '../../../common/src/constants'\nimport path, { isAbsolute } from 'path'\nimport fs from 'fs'\n\nexport function getFiles(filePaths: string[], cwd: string) {\n  const result: Record<string, string | null> = {}\n  const MAX_FILE_SIZE = 1024 * 1024 // 1MB in bytes\n\n  for (const filePath of filePaths) {\n    if (!filePath) {\n      continue\n    }\n\n    // Convert absolute paths within project to relative paths\n    const relativePath = filePath.startsWith(cwd)\n      ? path.relative(cwd, filePath)\n      : filePath\n    const fullPath = path.join(cwd, relativePath)\n    if (isAbsolute(relativePath) || !fullPath.startsWith(cwd)) {\n      result[relativePath] = FILE_READ_STATUS.OUTSIDE_PROJECT\n      continue\n    }\n    try {\n      const stats = fs.statSync(fullPath)\n      if (stats.size > MAX_FILE_SIZE) {\n        result[relativePath] =\n          FILE_READ_STATUS.TOO_LARGE +\n          ` [${(stats.size / (1024 * 1024)).toFixed(2)}MB]`\n      } else {\n        const content = fs.readFileSync(fullPath, 'utf8')\n        result[relativePath] = content\n      }\n    } catch (error) {\n      if (\n        error &&\n        typeof error === 'object' &&\n        'code' in error &&\n        error.code === 'ENOENT'\n      ) {\n        result[relativePath] = FILE_READ_STATUS.DOES_NOT_EXIST\n      } else {\n        result[relativePath] = FILE_READ_STATUS.ERROR\n      }\n    }\n  }\n  return result\n}",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/constants.ts",
              "content": "import type { ToolResultPart } from 'ai'\nimport type z from 'zod/v4'\n\nexport const toolNameParam = 'cb_tool_name'\nexport const endsAgentStepParam = 'cb_easp'\nexport const toolXmlName = 'levelcode_tool_call'\nexport const startToolTag = `<${toolXmlName}>\\n`\nexport const endToolTag = `\\n</${toolXmlName}>`\n\nexport const TOOLS_WHICH_WONT_FORCE_NEXT_STEP = ['think_deeply']\n\n// List of all available tools\nexport const toolNames = [\n  'add_subgoal',\n  'add_message',\n  'browser_logs',\n  'code_search',\n  'create_plan',\n  'end_turn',\n  'find_files',\n  'read_docs',\n  'read_files',\n  'run_file_change_hooks',\n  'run_terminal_command',\n  'set_messages',\n  'set_output',\n  'spawn_agents',\n  'spawn_agents_async',\n  'spawn_agent_inline',\n  'str_replace',\n  'think_deeply',\n  'update_subgoal',\n  'web_search',\n  'write_file',\n] as const\n\nexport type ToolName = (typeof toolNames)[number]\n\nexport type ToolParams<T extends ToolName = ToolName> = {\n  toolName: T\n  endsAgentStep: boolean\n  parameters: z.ZodType\n}\n\nexport type StringToolResultPart = Omit<ToolResultPart, 'type'> & {\n  result: string\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/list.ts",
              "content": "import { addMessageParams } from './params/tool/add-message'\nimport { addSubgoalParams } from './params/tool/add-subgoal'\nimport { browserLogsParams } from './params/tool/browser-logs'\nimport { codeSearchParams } from './params/tool/code-search'\nimport { createPlanParams } from './params/tool/create-plan'\nimport { endTurnParams } from './params/tool/end-turn'\nimport { findFilesParams } from './params/tool/find-files'\nimport { readDocsParams } from './params/tool/read-docs'\nimport { readFilesParams } from './params/tool/read-files'\nimport { runFileChangeHooksParams } from './params/tool/run-file-change-hooks'\nimport { runTerminalCommandParams } from './params/tool/run-terminal-command'\nimport { setMessagesParams } from './params/tool/set-messages'\nimport { setOutputParams } from './params/tool/set-output'\nimport { spawnAgentsParams } from './params/tool/spawn-agents'\nimport { spawnAgentsAsyncParams } from './params/tool/spawn-agents-async'\nimport { spawnAgentInlineParams } from './params/tool/spawn-agent-inline'\nimport { strReplaceParams } from './params/tool/str-replace'\nimport { thinkDeeplyParams } from './params/tool/think-deeply'\nimport { updateSubgoalParams } from './params/tool/update-subgoal'\nimport { webSearchParams } from './params/tool/web-search'\nimport { writeFileParams } from './params/tool/write-file'\n\nimport type { ToolName, ToolParams } from './constants'\n\nexport const llmToolCallSchema = {\n  add_message: addMessageParams,\n  add_subgoal: addSubgoalParams,\n  browser_logs: browserLogsParams,\n  code_search: codeSearchParams,\n  create_plan: createPlanParams,\n  end_turn: endTurnParams,\n  find_files: findFilesParams,\n  read_docs: readDocsParams,\n  read_files: readFilesParams,\n  run_file_change_hooks: runFileChangeHooksParams,\n  run_terminal_command: runTerminalCommandParams,\n  set_messages: setMessagesParams,\n  set_output: setOutputParams,\n  spawn_agents: spawnAgentsParams,\n  spawn_agents_async: spawnAgentsAsyncParams,\n  spawn_agent_inline: spawnAgentInlineParams,\n  str_replace: strReplaceParams,\n  think_deeply: thinkDeeplyParams,\n  update_subgoal: updateSubgoalParams,\n  web_search: webSearchParams,\n  write_file: writeFileParams,\n} satisfies {\n  [K in ToolName]: ToolParams<K>\n}\n\nexport const clientToolCallSchema = {\n  // Tools that require an id and objective\n  add_subgoal: ['id', 'objective', 'status', 'plan', 'log'],\n  update_subgoal: ['id', 'status', 'plan', 'log'],\n\n  // File operations\n  write_file: ['path', 'instructions', 'content'],\n  str_replace: ['path', 'replacements'],\n  read_files: ['paths'],\n  find_files: ['prompt'],\n\n  // Search and terminal\n  code_search: ['pattern', 'flags', 'cwd'],\n  run_terminal_command: ['command', 'process_type', 'cwd', 'timeout_seconds'],\n\n  // Planning tools\n  think_deeply: ['thought'],\n  create_plan: ['path', 'plan'],\n\n  browser_logs: ['type', 'url', 'waitUntil'],\n\n  spawn_agents: ['agents'],\n  spawn_agents_async: ['agents'],\n  spawn_agent_inline: ['agent_type', 'prompt', 'params'],\n  set_output: [],\n\n  // Documentation tool\n  read_docs: ['libraryTitle', 'topic', 'max_tokens'],\n\n  // Web search tool\n  web_search: ['query', 'depth'],\n\n  // File change hooks tool\n  run_file_change_hooks: ['files'],\n\n  // Tools that change the conversation history\n  add_message: ['role', 'content'],\n  set_messages: ['messages'],\n\n  end_turn: [],\n} as const satisfies Record<ToolName, string[]>\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/utils.ts",
              "content": "import {\n  endsAgentStepParam,\n  endToolTag,\n  startToolTag,\n  toolNameParam,\n} from './constants'\nimport { llmToolCallSchema } from './list'\nimport { closeXml } from '../util/xml'\n\nimport type { StringToolResultPart, ToolName } from './constants'\nimport type z from 'zod/v4'\n\nexport function getToolCallString<T extends ToolName | (string & {})>(\n  toolName: T,\n  params: T extends ToolName\n    ? z.input<(typeof llmToolCallSchema)[T]['parameters']>\n    : Record<string, any>,\n  ...endsAgentStep: T extends ToolName ? [] : [boolean]\n): string {\n  const endsAgentStepValue =\n    toolName in llmToolCallSchema\n      ? llmToolCallSchema[toolName as keyof typeof llmToolCallSchema]\n          .endsAgentStep\n      : endsAgentStep[0]\n  const obj: Record<string, any> = {\n    [toolNameParam]: toolName,\n    ...params,\n  }\n  if (endsAgentStepValue) {\n    obj[endsAgentStepParam] = endsAgentStepValue satisfies true\n  }\n  return [startToolTag, JSON.stringify(obj, null, 2), endToolTag].join('')\n}\n\nexport function renderToolResults(toolResults: StringToolResultPart[]): string {\n  if (toolResults.length === 0) {\n    return ''\n  }\n\n  return `\n${toolResults\n  .map(\n    (result) => `<tool_result>\n<tool>${result.toolName}${closeXml('tool')}\n<result>${result.result}${closeXml('result')}\n${closeXml('tool_result')}`,\n  )\n  .join('\\n\\n')}\n`.trim()\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/compile-tool-definitions.ts",
              "content": "import z from 'zod/v4'\n\nimport { llmToolCallSchema } from './list'\n\n/**\n * Compiles all tool definitions into a single TypeScript definition file content.\n * This generates type definitions for all available tools and their parameters.\n */\nexport function compileToolDefinitions(): string {\n  const toolEntries = Object.entries(llmToolCallSchema)\n\n  const toolInterfaces = toolEntries\n    .map(([toolName, toolDef]) => {\n      const parameterSchema = toolDef.parameters\n\n      // Convert Zod schema to TypeScript interface using JSON schema\n      let typeDefinition: string\n      try {\n        const jsonSchema = z.toJSONSchema(parameterSchema)\n        typeDefinition = jsonSchemaToTypeScript(jsonSchema)\n      } catch (error) {\n        console.warn(`Failed to convert schema for ${toolName}:`, error)\n        typeDefinition = '{ [key: string]: any }'\n      }\n\n      return `/**\n * ${parameterSchema.description || `Parameters for ${toolName} tool`}\n */\nexport interface ${toPascalCase(toolName)}Params ${typeDefinition}`\n    })\n    .join('\\n\\n')\n\n  const toolUnion = toolEntries.map(([toolName]) => `'${toolName}'`).join(' | ')\n\n  const toolParamsMap = toolEntries\n    .map(([toolName]) => `  '${toolName}': ${toPascalCase(toolName)}Params`)\n    .join('\\n')\n\n  return `/**\n * Union type of all available tool names\n */\nexport type ToolName = ${toolUnion}\n\n/**\n * Map of tool names to their parameter types\n */\nexport interface ToolParamsMap {\n${toolParamsMap}\n}\n\n${toolInterfaces}\n\n/**\n * Get parameters type for a specific tool\n */\nexport type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n`\n}\n\n/**\n * Converts kebab-case to PascalCase\n * e.g., 'write-file' -> 'WriteFile'\n */\nfunction toPascalCase(str: string): string {\n  return str\n    .split(/[-_]/)\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n    .join('')\n}\n\n/**\n * Converts JSON Schema to TypeScript interface definition\n */\nfunction jsonSchemaToTypeScript(schema: any): string {\n  if (schema.type === 'object' && schema.properties) {\n    const properties = Object.entries(schema.properties).map(\n      ([key, prop]: [string, any]) => {\n        const isOptional = !schema.required?.includes(key)\n        const propType = getTypeFromJsonSchema(prop)\n        const comment = prop.description ? `  /** ${prop.description} */\\n` : ''\n        return `${comment}  \"${key}\"${isOptional ? '?' : ''}: ${propType}`\n      },\n    )\n    return `{\\n${properties.join('\\n')}\\n}`\n  }\n  return getTypeFromJsonSchema(schema)\n}\n\n/**\n * Gets TypeScript type from JSON Schema property\n */\nfunction getTypeFromJsonSchema(prop: any): string {\n  if (prop.type === 'string') {\n    if (prop.enum) {\n      return prop.enum.map((v: string) => `\"${v}\"`).join(' | ')\n    }\n    return 'string'\n  }\n  if (prop.type === 'number' || prop.type === 'integer') return 'number'\n  if (prop.type === 'boolean') return 'boolean'\n  if (prop.type === 'array') {\n    const itemType = prop.items ? getTypeFromJsonSchema(prop.items) : 'any'\n    return `${itemType}[]`\n  }\n  if (prop.type === 'object') {\n    if (prop.properties) {\n      return jsonSchemaToTypeScript(prop)\n    }\n    if (prop.additionalProperties) {\n      const valueType = getTypeFromJsonSchema(prop.additionalProperties)\n      return `Record<string, ${valueType}>`\n    }\n    return 'Record<string, any>'\n  }\n  if (prop.anyOf || prop.oneOf) {\n    const schemas = prop.anyOf || prop.oneOf\n    return schemas.map((s: any) => getTypeFromJsonSchema(s)).join(' | ')\n  }\n  return 'any'\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/types/dynamic-agent-template.ts",
              "content": "import { z } from 'zod'\n\nimport { ALLOWED_MODEL_PREFIXES, models } from '../constants'\nimport { toolNames } from '../tools/constants'\n\n// Filter models to only include those that begin with allowed prefixes\nconst filteredModels = Object.values(models).filter((model) =>\n  ALLOWED_MODEL_PREFIXES.some((prefix) => model.startsWith(prefix)),\n)\n\nif (filteredModels.length === 0) {\n  throw new Error('No valid models found with allowed prefixes')\n}\n\n// Simplified JSON Schema definition - supports object schemas with nested properties\nconst JsonSchemaSchema: z.ZodType<any> = z.lazy(() =>\n  z\n    .object({\n      type: z.literal('object'),\n      description: z.string().optional(),\n      properties: z\n        .record(\n          JsonSchemaSchema.or(\n            z\n              .object({\n                type: z.enum([\n                  'string',\n                  'number',\n                  'integer',\n                  'boolean',\n                  'array',\n                ]),\n                description: z.string().optional(),\n                enum: z.array(z.any()).optional(),\n              })\n              .passthrough(),\n          ),\n        )\n        .optional(),\n      required: z.array(z.string()).optional(),\n    })\n    .passthrough(),\n)\n\n// Schema for the combined inputSchema object\nconst InputSchemaObjectSchema = z\n  .object({\n    prompt: z\n      .object({\n        type: z.literal('string'),\n        description: z.string().optional(),\n      })\n      .passthrough()\n      .optional(), // Optional JSON schema for prompt validation\n    params: JsonSchemaSchema.optional(), // Optional JSON schema for params validation\n  })\n  .optional()\n\n// Schema for prompt fields that can be either a string or a path reference\nconst PromptFieldSchema = z.union([\n  z.string(), // Direct string content\n  z.object({ path: z.string() }), // Path reference to external file\n])\nexport type PromptField = z.infer<typeof PromptFieldSchema>\n\n// Schema for validating handleSteps function signature\nconst HandleStepsSchema = z\n  .function()\n  .args(\n    z.object({\n      agentState: z.object({\n        agentId: z.string(),\n        parentId: z.string(),\n        messageHistory: z.array(z.any()),\n      }),\n      prompt: z.string().optional(),\n      params: z.any().optional(),\n    }),\n  )\n  .returns(z.any())\n  .optional()\n\n// Validates the Typescript template file.\nexport const DynamicAgentDefinitionSchema = z.object({\n  id: z\n    .string()\n    .regex(\n      /^[a-z0-9-]+$/,\n      'Agent ID must contain only lowercase letters, numbers, and hyphens',\n    ), // The unique identifier for this agent\n  version: z.string().optional(),\n  publisher: z.string().optional(),\n\n  // Required fields for new agents\n  displayName: z.string(),\n  model: z.string(),\n\n  // Tools and spawnable agents\n  toolNames: z\n    .array(z.enum(toolNames))\n    .optional()\n    .default([])\n    .refine(\n      (tools) => {\n        if (!tools) return true\n        const validToolNames = toolNames as readonly string[]\n        const invalidTools = tools.filter(\n          (tool) => !validToolNames.includes(tool),\n        )\n        return invalidTools.length === 0\n      },\n      (tools) => {\n        if (!tools) return { message: 'Tools array is undefined' }\n        const validToolNames = toolNames as readonly string[]\n        const invalidTools = tools.filter(\n          (tool) => !validToolNames.includes(tool),\n        )\n        return {\n          message: `Invalid tool names: ${invalidTools.join(', ')}. Available tools: ${toolNames.join(', ')}`,\n        }\n      },\n    ),\n  spawnableAgents: z.array(z.string()).optional().default([]),\n\n  // Input and output\n  inputSchema: InputSchemaObjectSchema,\n  includeMessageHistory: z.boolean().default(true),\n  outputMode: z\n    .enum(['last_message', 'all_messages', 'structured_output'])\n    .default('last_message'),\n  outputSchema: JsonSchemaSchema.optional(), // Optional JSON schema for output validation\n\n  // Prompts\n  parentPrompt: z.string().optional(),\n  systemPrompt: z.string().optional(),\n  instructionsPrompt: z.string().optional(),\n  stepPrompt: z.string().optional(),\n\n  // Optional generator function for programmatic agents\n  handleSteps: z.union([HandleStepsSchema, z.string()]).optional(),\n})\nexport type DynamicAgentDefinition = z.input<\n  typeof DynamicAgentDefinitionSchema\n>\nexport type DynamicAgentDefinitionParsed = z.infer<\n  typeof DynamicAgentDefinitionSchema\n>\n\nexport const DynamicAgentTemplateSchema = DynamicAgentDefinitionSchema.extend({\n  systemPrompt: z.string(),\n  instructionsPrompt: z.string(),\n  stepPrompt: z.string(),\n  handleSteps: z.string().optional(), // Converted to string after processing\n})\n  .refine(\n    (data) => {\n      // If outputSchema is provided, outputMode must be explicitly set to 'structured_output'\n      if (data.outputSchema && data.outputMode !== 'structured_output') {\n        return false\n      }\n      return true\n    },\n    {\n      message:\n        \"outputSchema requires outputMode to be explicitly set to 'structured_output'.\",\n      path: ['outputMode'],\n    },\n  )\n  .refine(\n    (data) => {\n      // If outputMode is 'structured_output', 'set_output' tool must be included\n      if (\n        data.outputMode === 'structured_output' &&\n        !data.toolNames.includes('set_output')\n      ) {\n        return false\n      }\n      return true\n    },\n    {\n      message:\n        \"outputMode 'structured_output' requires the 'set_output' tool. Add 'set_output' to toolNames.\",\n      path: ['toolNames'],\n    },\n  )\n  .refine(\n    (data) => {\n      // If 'set_output' tool is included, outputMode must be 'structured_output'\n      if (\n        data.toolNames.includes('set_output') &&\n        data.outputMode !== 'structured_output'\n      ) {\n        return false\n      }\n      return true\n    },\n    {\n      message:\n        \"'set_output' tool requires outputMode to be 'structured_output'. Change outputMode to 'structured_output' or remove 'set_output' from toolNames.\",\n      path: ['outputMode'],\n    },\n  )\n  .refine(\n    (data) => {\n      // If spawnableAgents array is non-empty, 'spawn_agents' tool must be included\n      if (\n        data.spawnableAgents.length > 0 &&\n        !data.toolNames.includes('spawn_agents')\n      ) {\n        return false\n      }\n      return true\n    },\n    {\n      message:\n        \"Non-empty spawnableAgents array requires the 'spawn_agents' tool. Add 'spawn_agents' to toolNames or remove spawnableAgents.\",\n      path: ['toolNames'],\n    },\n  )\nexport type DynamicAgentTemplate = z.infer<typeof DynamicAgentTemplateSchema>\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/types/agent-template.ts",
              "content": "import type { Model } from '../constants'\nimport type { AgentState, AgentTemplateType } from './session-state'\nimport type { ToolName } from '../tools/constants'\nimport type { ToolCall } from '../util/types/agent-definition'\nimport type { z } from 'zod/v4'\n\nexport type AgentTemplate<\n  P = string | undefined,\n  T = Record<string, any> | undefined,\n> = {\n  id: AgentTemplateType\n  displayName: string\n  model: Model\n\n  toolNames: ToolName[]\n  spawnableAgents: AgentTemplateType[]\n\n  parentPrompt?: string\n  systemPrompt: string\n  instructionsPrompt: string\n  stepPrompt: string\n  parentInstructions?: Record<string, string>\n\n  // Required parameters for spawning this agent.\n  inputSchema: {\n    prompt?: z.ZodSchema<P>\n    params?: z.ZodSchema<T>\n  }\n  includeMessageHistory: boolean\n  outputMode: 'last_message' | 'all_messages' | 'structured_output'\n  outputSchema?: z.ZodSchema<any>\n\n  handleSteps?: StepHandler<P, T> | string // Function or string of the generator code for running in a sandbox\n}\n\nexport type StepGenerator = Generator<\n  Omit<ToolCall, 'toolCallId'> | 'STEP' | 'STEP_ALL', // Generic tool call type\n  void,\n  { agentState: AgentState; toolResult: string | undefined }\n>\n\nexport type StepHandler<\n  P = string | undefined,\n  T = Record<string, any> | undefined,\n> = (params: { agentState: AgentState; prompt: P; params: T }) => StepGenerator\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/xml.ts",
              "content": "/**\n * Generate a closing XML tag for a single tool name\n * @param toolName Single tool name to generate closing tag for\n * @returns Closing XML tag string\n */\nexport function closeXml(toolName: string): string {\n  return `</${toolName}>`\n}\n\n/**\n * Generate stop sequences (closing XML tags) for a list of tool names\n * @param toolNames Array of tool names to generate closing tags for\n * @returns Array of closing XML tag strings\n */\nexport function getStopSequences(toolNames: readonly string[]): string[] {\n  return toolNames.map((toolName) => `</levelcode_tool_${toolName}>`)\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/websockets/websocket-schema.ts",
              "content": "import { z } from 'zod'\n\nimport { CLIENT_ACTION_SCHEMA, SERVER_ACTION_SCHEMA } from '../actions'\n\nexport const CLIENT_MESSAGE_SCHEMAS = {\n  identify: z.object({\n    type: z.literal('identify'),\n    txid: z.number(),\n    clientSessionId: z.string(),\n  }),\n  subscribe: z.object({\n    type: z.literal('subscribe'),\n    txid: z.number(),\n    topics: z.array(z.string()),\n  }),\n  unsubscribe: z.object({\n    type: z.literal('unsubscribe'),\n    txid: z.number(),\n    topics: z.array(z.string()),\n  }),\n  ping: z.object({\n    type: z.literal('ping'),\n    txid: z.number(),\n  }),\n  action: z.object({\n    type: z.literal('action'),\n    txid: z.number(),\n    data: CLIENT_ACTION_SCHEMA,\n  }),\n} as const\n\nexport const CLIENT_MESSAGE_SCHEMA = z.union([\n  CLIENT_MESSAGE_SCHEMAS.identify,\n  CLIENT_MESSAGE_SCHEMAS.subscribe,\n  CLIENT_MESSAGE_SCHEMAS.unsubscribe,\n  CLIENT_MESSAGE_SCHEMAS.ping,\n  CLIENT_MESSAGE_SCHEMAS.action,\n])\n\nexport type ClientMessageType = keyof typeof CLIENT_MESSAGE_SCHEMAS\nexport type ClientMessage<T extends ClientMessageType = ClientMessageType> =\n  z.infer<(typeof CLIENT_MESSAGE_SCHEMAS)[T]>\n\nexport const SERVER_MESSAGE_SCHEMAS = {\n  ack: z.object({\n    type: z.literal('ack'),\n    txid: z.number().optional(),\n    success: z.boolean(),\n    error: z.string().optional(),\n  }),\n  action: z.object({\n    type: z.literal('action'),\n    data: SERVER_ACTION_SCHEMA,\n  }),\n}\n\nexport const SERVER_MESSAGE_SCHEMA = z.union([\n  SERVER_MESSAGE_SCHEMAS.ack,\n  SERVER_MESSAGE_SCHEMAS.action,\n])\n\nexport type ServerMessageType = keyof typeof SERVER_MESSAGE_SCHEMAS\nexport type ServerMessage<T extends ServerMessageType = ServerMessageType> =\n  z.infer<(typeof SERVER_MESSAGE_SCHEMAS)[T]>\n",
              "referencedBy": {}
            }
          ]
        }
      ],
      "parentAgentId": "D-UppvyfWNM"
    },
    {
      "type": "text",
      "agentId": "D-UppvyfWNM",
      "text": "Okay, here's a concise report of files related to tool types, unions, and interfaces:\n\n*   **sdk/src/types/tools.ts**: Defines the `ToolName` union (all available tool names) and the `ToolParamsMap` interface (mapping tool names to their parameter types). This is central to understanding available tools and their required parameters.\n*   **sdk/src/types/agent-definition.ts**: Defines the `AgentDefinition` interface, which includes `toolNames` (an array of `ToolName`) and references `ToolCall` (for the `handleSteps` function). This file is critical for defining agents and their capabilities.\n*   **common/src/tools/constants.ts**: Defines `ToolName` union, `toolXmlName`, and other constants related to tool calls.\n*   **common/src/tools/list.ts**: Defines `llmToolCallSchema` which specifies the parameter schema for each tool. Also defines `clientToolCallSchema` used in the client.\n*   **common/src/tools/compile-tool-definitions.ts**: Compiles tool definitions into TypeScript, generating type definitions for tools and their parameters.\n*   **common/src/util/xml.ts**: Utility functions for generating XML tags for tool calls and stop sequences.\n*   **common/src/types/dynamic-agent-template.ts**: Defines `DynamicAgentDefinitionSchema` which includes validation for tool usage.\n\nThese are potentially the most relevant files for understanding how tool types are defined and used within the codebase.\n"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-UppvyfWNM",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Find files in sdk/src and common/src that define or use tool types, unions, or interfaces like ToolCall, ToolSchema, etc."
    },
    {
      "type": "text",
      "agentId": "D-UppjyUa0E",
      "text": "common/src/tools/compile-tool-definitions.ts\ncommon/src/tools/list.ts\ncommon/src/tools/constants.ts\ncommon/src/tools/utils.ts\ncommon/src/tools/params/tool/add-message.ts\ncommon/src/tools/params/tool/add-subgoal.ts\ncommon/src/tools/params/tool/code-search.ts\ncommon/src/tools/params/tool/find-files.ts\ncommon/src/tools/params/tool/read-files.ts\ncommon/src/types/api/agents/publish.ts\nsdk/scripts/publish.js\nsdk/src/types/tools.ts"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-Up4CDP0Kk",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-UppjyUa0E",
      "prompt": "Find files handling tool type generation, regeneration, or publishing in SDK and common packages.",
      "params": {}
    },
    {
      "type": "tool_result",
      "toolCallId": "c0209f42-5bb0-47b7-aabf-0376e2e259dc",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Liszt the File Lister",
              "agentType": "file-lister",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "common/src/tools/compile-tool-definitions.ts\ncommon/src/tools/list.ts\ncommon/src/tools/constants.ts\ncommon/src/tools/utils.ts\ncommon/src/tools/params/tool/add-message.ts\ncommon/src/tools/params/tool/add-subgoal.ts\ncommon/src/tools/params/tool/code-search.ts\ncommon/src/tools/params/tool/find-files.ts\ncommon/src/tools/params/tool/read-files.ts\ncommon/src/types/api/agents/publish.ts\nsdk/scripts/publish.js\nsdk/src/types/tools.ts"
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ],
      "parentAgentId": "D-UppjyUa0E"
    },
    {
      "type": "tool_call",
      "toolCallId": "cf990849-3a75-4da5-9a46-6aad675dece2",
      "toolName": "read_files",
      "input": {
        "paths": [
          "common/src/tools/compile-tool-definitions.ts",
          "common/src/tools/list.ts",
          "common/src/tools/constants.ts",
          "common/src/tools/utils.ts",
          "common/src/tools/params/tool/add-message.ts",
          "common/src/tools/params/tool/add-subgoal.ts",
          "common/src/tools/params/tool/code-search.ts",
          "common/src/tools/params/tool/find-files.ts",
          "common/src/tools/params/tool/read-files.ts",
          "common/src/types/api/agents/publish.ts",
          "sdk/scripts/publish.js",
          "sdk/src/types/tools.ts"
        ]
      },
      "agentId": "D-UppjyUa0E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "cf990849-3a75-4da5-9a46-6aad675dece2",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": "common/src/tools/compile-tool-definitions.ts",
              "content": "import z from 'zod/v4'\n\nimport { llmToolCallSchema } from './list'\n\n/**\n * Compiles all tool definitions into a single TypeScript definition file content.\n * This generates type definitions for all available tools and their parameters.\n */\nexport function compileToolDefinitions(): string {\n  const toolEntries = Object.entries(llmToolCallSchema)\n\n  const toolInterfaces = toolEntries\n    .map(([toolName, toolDef]) => {\n      const parameterSchema = toolDef.parameters\n\n      // Convert Zod schema to TypeScript interface using JSON schema\n      let typeDefinition: string\n      try {\n        const jsonSchema = z.toJSONSchema(parameterSchema)\n        typeDefinition = jsonSchemaToTypeScript(jsonSchema)\n      } catch (error) {\n        console.warn(`Failed to convert schema for ${toolName}:`, error)\n        typeDefinition = '{ [key: string]: any }'\n      }\n\n      return `/**\n * ${parameterSchema.description || `Parameters for ${toolName} tool`}\n */\nexport interface ${toPascalCase(toolName)}Params ${typeDefinition}`\n    })\n    .join('\\n\\n')\n\n  const toolUnion = toolEntries.map(([toolName]) => `'${toolName}'`).join(' | ')\n\n  const toolParamsMap = toolEntries\n    .map(([toolName]) => `  '${toolName}': ${toPascalCase(toolName)}Params`)\n    .join('\\n')\n\n  return `/**\n * Union type of all available tool names\n */\nexport type ToolName = ${toolUnion}\n\n/**\n * Map of tool names to their parameter types\n */\nexport interface ToolParamsMap {\n${toolParamsMap}\n}\n\n${toolInterfaces}\n\n/**\n * Get parameters type for a specific tool\n */\nexport type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n`\n}\n\n/**\n * Converts kebab-case to PascalCase\n * e.g., 'write-file' -> 'WriteFile'\n */\nfunction toPascalCase(str: string): string {\n  return str\n    .split(/[-_]/)\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n    .join('')\n}\n\n/**\n * Converts JSON Schema to TypeScript interface definition\n */\nfunction jsonSchemaToTypeScript(schema: any): string {\n  if (schema.type === 'object' && schema.properties) {\n    const properties = Object.entries(schema.properties).map(\n      ([key, prop]: [string, any]) => {\n        const isOptional = !schema.required?.includes(key)\n        const propType = getTypeFromJsonSchema(prop)\n        const comment = prop.description ? `  /** ${prop.description} */\\n` : ''\n        return `${comment}  \"${key}\"${isOptional ? '?' : ''}: ${propType}`\n      },\n    )\n    return `{\\n${properties.join('\\n')}\\n}`\n  }\n  return getTypeFromJsonSchema(schema)\n}\n\n/**\n * Gets TypeScript type from JSON Schema property\n */\nfunction getTypeFromJsonSchema(prop: any): string {\n  if (prop.type === 'string') {\n    if (prop.enum) {\n      return prop.enum.map((v: string) => `\"${v}\"`).join(' | ')\n    }\n    return 'string'\n  }\n  if (prop.type === 'number' || prop.type === 'integer') return 'number'\n  if (prop.type === 'boolean') return 'boolean'\n  if (prop.type === 'array') {\n    const itemType = prop.items ? getTypeFromJsonSchema(prop.items) : 'any'\n    return `${itemType}[]`\n  }\n  if (prop.type === 'object') {\n    if (prop.properties) {\n      return jsonSchemaToTypeScript(prop)\n    }\n    if (prop.additionalProperties) {\n      const valueType = getTypeFromJsonSchema(prop.additionalProperties)\n      return `Record<string, ${valueType}>`\n    }\n    return 'Record<string, any>'\n  }\n  if (prop.anyOf || prop.oneOf) {\n    const schemas = prop.anyOf || prop.oneOf\n    return schemas.map((s: any) => getTypeFromJsonSchema(s)).join(' | ')\n  }\n  return 'any'\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/list.ts",
              "content": "import { addMessageParams } from './params/tool/add-message'\nimport { addSubgoalParams } from './params/tool/add-subgoal'\nimport { browserLogsParams } from './params/tool/browser-logs'\nimport { codeSearchParams } from './params/tool/code-search'\nimport { createPlanParams } from './params/tool/create-plan'\nimport { endTurnParams } from './params/tool/end-turn'\nimport { findFilesParams } from './params/tool/find-files'\nimport { readDocsParams } from './params/tool/read-docs'\nimport { readFilesParams } from './params/tool/read-files'\nimport { runFileChangeHooksParams } from './params/tool/run-file-change-hooks'\nimport { runTerminalCommandParams } from './params/tool/run-terminal-command'\nimport { setMessagesParams } from './params/tool/set-messages'\nimport { setOutputParams } from './params/tool/set-output'\nimport { spawnAgentsParams } from './params/tool/spawn-agents'\nimport { spawnAgentsAsyncParams } from './params/tool/spawn-agents-async'\nimport { spawnAgentInlineParams } from './params/tool/spawn-agent-inline'\nimport { strReplaceParams } from './params/tool/str-replace'\nimport { thinkDeeplyParams } from './params/tool/think-deeply'\nimport { updateSubgoalParams } from './params/tool/update-subgoal'\nimport { webSearchParams } from './params/tool/web-search'\nimport { writeFileParams } from './params/tool/write-file'\n\nimport type { ToolName, ToolParams } from './constants'\n\nexport const llmToolCallSchema = {\n  add_message: addMessageParams,\n  add_subgoal: addSubgoalParams,\n  browser_logs: browserLogsParams,\n  code_search: codeSearchParams,\n  create_plan: createPlanParams,\n  end_turn: endTurnParams,\n  find_files: findFilesParams,\n  read_docs: readDocsParams,\n  read_files: readFilesParams,\n  run_file_change_hooks: runFileChangeHooksParams,\n  run_terminal_command: runTerminalCommandParams,\n  set_messages: setMessagesParams,\n  set_output: setOutputParams,\n  spawn_agents: spawnAgentsParams,\n  spawn_agents_async: spawnAgentsAsyncParams,\n  spawn_agent_inline: spawnAgentInlineParams,\n  str_replace: strReplaceParams,\n  think_deeply: thinkDeeplyParams,\n  update_subgoal: updateSubgoalParams,\n  web_search: webSearchParams,\n  write_file: writeFileParams,\n} satisfies {\n  [K in ToolName]: ToolParams<K>\n}\n\nexport const clientToolCallSchema = {\n  // Tools that require an id and objective\n  add_subgoal: ['id', 'objective', 'status', 'plan', 'log'],\n  update_subgoal: ['id', 'status', 'plan', 'log'],\n\n  // File operations\n  write_file: ['path', 'instructions', 'content'],\n  str_replace: ['path', 'replacements'],\n  read_files: ['paths'],\n  find_files: ['prompt'],\n\n  // Search and terminal\n  code_search: ['pattern', 'flags', 'cwd'],\n  run_terminal_command: ['command', 'process_type', 'cwd', 'timeout_seconds'],\n\n  // Planning tools\n  think_deeply: ['thought'],\n  create_plan: ['path', 'plan'],\n\n  browser_logs: ['type', 'url', 'waitUntil'],\n\n  spawn_agents: ['agents'],\n  spawn_agents_async: ['agents'],\n  spawn_agent_inline: ['agent_type', 'prompt', 'params'],\n  set_output: [],\n\n  // Documentation tool\n  read_docs: ['libraryTitle', 'topic', 'max_tokens'],\n\n  // Web search tool\n  web_search: ['query', 'depth'],\n\n  // File change hooks tool\n  run_file_change_hooks: ['files'],\n\n  // Tools that change the conversation history\n  add_message: ['role', 'content'],\n  set_messages: ['messages'],\n\n  end_turn: [],\n} as const satisfies Record<ToolName, string[]>\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/constants.ts",
              "content": "import type { ToolResultPart } from 'ai'\nimport type z from 'zod/v4'\n\nexport const toolNameParam = 'cb_tool_name'\nexport const endsAgentStepParam = 'cb_easp'\nexport const toolXmlName = 'levelcode_tool_call'\nexport const startToolTag = `<${toolXmlName}>\\n`\nexport const endToolTag = `\\n</${toolXmlName}>`\n\nexport const TOOLS_WHICH_WONT_FORCE_NEXT_STEP = ['think_deeply']\n\n// List of all available tools\nexport const toolNames = [\n  'add_subgoal',\n  'add_message',\n  'browser_logs',\n  'code_search',\n  'create_plan',\n  'end_turn',\n  'find_files',\n  'read_docs',\n  'read_files',\n  'run_file_change_hooks',\n  'run_terminal_command',\n  'set_messages',\n  'set_output',\n  'spawn_agents',\n  'spawn_agents_async',\n  'spawn_agent_inline',\n  'str_replace',\n  'think_deeply',\n  'update_subgoal',\n  'web_search',\n  'write_file',\n] as const\n\nexport type ToolName = (typeof toolNames)[number]\n\nexport type ToolParams<T extends ToolName = ToolName> = {\n  toolName: T\n  endsAgentStep: boolean\n  parameters: z.ZodType\n}\n\nexport type StringToolResultPart = Omit<ToolResultPart, 'type'> & {\n  result: string\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/utils.ts",
              "content": "import {\n  endsAgentStepParam,\n  endToolTag,\n  startToolTag,\n  toolNameParam,\n} from './constants'\nimport { llmToolCallSchema } from './list'\nimport { closeXml } from '../util/xml'\n\nimport type { StringToolResultPart, ToolName } from './constants'\nimport type z from 'zod/v4'\n\nexport function getToolCallString<T extends ToolName | (string & {})>(\n  toolName: T,\n  params: T extends ToolName\n    ? z.input<(typeof llmToolCallSchema)[T]['parameters']>\n    : Record<string, any>,\n  ...endsAgentStep: T extends ToolName ? [] : [boolean]\n): string {\n  const endsAgentStepValue =\n    toolName in llmToolCallSchema\n      ? llmToolCallSchema[toolName as keyof typeof llmToolCallSchema]\n          .endsAgentStep\n      : endsAgentStep[0]\n  const obj: Record<string, any> = {\n    [toolNameParam]: toolName,\n    ...params,\n  }\n  if (endsAgentStepValue) {\n    obj[endsAgentStepParam] = endsAgentStepValue satisfies true\n  }\n  return [startToolTag, JSON.stringify(obj, null, 2), endToolTag].join('')\n}\n\nexport function renderToolResults(toolResults: StringToolResultPart[]): string {\n  if (toolResults.length === 0) {\n    return ''\n  }\n\n  return `\n${toolResults\n  .map(\n    (result) => `<tool_result>\n<tool>${result.toolName}${closeXml('tool')}\n<result>${result.result}${closeXml('result')}\n${closeXml('tool_result')}`,\n  )\n  .join('\\n\\n')}\n`.trim()\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/params/tool/add-message.ts",
              "content": "import z from 'zod/v4'\n\nimport type { ToolParams } from '../../constants'\n\nconst toolName = 'add_message'\nconst endsAgentStep = true\nexport const addMessageParams = {\n  toolName,\n  endsAgentStep,\n  parameters: z\n    .object({\n      role: z.enum(['user', 'assistant']),\n      content: z.string(),\n    })\n    .describe(\n      `Add a new message to the conversation history. To be used for complex requests that can't be solved in a single step, as you may forget what happened!`,\n    ),\n} satisfies ToolParams\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/params/tool/add-subgoal.ts",
              "content": "import z from 'zod/v4'\n\nimport type { ToolParams } from '../../constants'\n\nconst toolName = 'add_subgoal'\nconst endsAgentStep = false\nexport const addSubgoalParams = {\n  toolName,\n  endsAgentStep,\n  parameters: z\n    .object({\n      id: z\n        .string()\n        .min(1, 'Id cannot be empty')\n        .describe(\n          `A unique identifier for the subgoal. Try to choose the next sequential integer that is not already in use.`,\n        ),\n      objective: z\n        .string()\n        .min(1, 'Objective cannot be empty')\n        .describe(\n          `The objective of the subgoal, concisely and clearly stated.`,\n        ),\n      status: z\n        .enum(['NOT_STARTED', 'IN_PROGRESS', 'COMPLETE', 'ABORTED'])\n        .describe(`The status of the subgoal.`),\n      plan: z.string().optional().describe('A plan for the subgoal.'),\n      log: z\n        .string()\n        .optional()\n        .describe('A log message for the subgoal progress.'),\n    })\n    .describe(\n      `Add a new subgoal for tracking progress. To be used for complex requests that can't be solved in a single step, as you may forget what happened!`,\n    ),\n} satisfies ToolParams\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/params/tool/code-search.ts",
              "content": "import z from 'zod/v4'\n\nimport type { ToolParams } from '../../constants'\n\nconst toolName = 'code_search'\nconst endsAgentStep = true\nexport const codeSearchParams = {\n  toolName,\n  endsAgentStep,\n  parameters: z\n    .object({\n      pattern: z\n        .string()\n        .min(1, 'Pattern cannot be empty')\n        .describe(`The pattern to search for.`),\n      flags: z\n        .string()\n        .optional()\n        .describe(\n          `Optional ripgrep flags to customize the search (e.g., \"-i\" for case-insensitive, \"-t ts\" for TypeScript files only, \"-A 3\" for 3 lines after match, \"-B 2\" for 2 lines before match, \"--type-not test\" to exclude test files).`,\n        ),\n      cwd: z\n        .string()\n        .optional()\n        .describe(\n          `Optional working directory to search within, relative to the project root. Defaults to searching the entire project.`,\n        ),\n    })\n    .describe(\n      `Search for string patterns in the project's files. This tool uses ripgrep (rg), a fast line-oriented search tool. Use this tool only when read_files is not sufficient to find the files you need.`,\n    ),\n} satisfies ToolParams\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/params/tool/find-files.ts",
              "content": "import z from 'zod/v4'\n\nimport type { ToolParams } from '../../constants'\n\nconst toolName = 'find_files'\nconst endsAgentStep = true\nexport const findFilesParams = {\n  toolName,\n  endsAgentStep,\n  parameters: z\n    .object({\n      prompt: z\n        .string()\n        .min(1, 'Prompt cannot be empty')\n        .describe(\n          `A brief natural language description of the files or the name of a function or class you are looking for. It's also helpful to mention a directory or two to look within.`,\n        ),\n    })\n    .describe(\n      `Find several files related to a brief natural language description of the files or the name of a function or class you are looking for.`,\n    ),\n} satisfies ToolParams\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/params/tool/read-files.ts",
              "content": "import z from 'zod/v4'\n\nimport type { ToolParams } from '../../constants'\n\nconst toolName = 'read_files'\nconst endsAgentStep = true\nexport const readFilesParams = {\n  toolName,\n  endsAgentStep,\n  parameters: z\n    .object({\n      paths: z\n        .array(\n          z\n            .string()\n            .min(1, 'Paths cannot be empty')\n            .describe(\n              `File path to read relative to the **project root**. Absolute file paths will not work.`,\n            ),\n        )\n        .describe('List of file paths to read.'),\n    })\n    .describe(\n      `Read the multiple files from disk and return their contents. Use this tool to read as many files as would be helpful to answer the user's request.`,\n    ),\n} satisfies ToolParams\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/types/api/agents/publish.ts",
              "content": "import { z } from 'zod'\n\nimport { DynamicAgentTemplateSchema } from '../../../types/dynamic-agent-template'\n\nexport const publishAgentsRequestSchema = z.object({\n  data: DynamicAgentTemplateSchema.array(),\n  authToken: z.string(),\n})\nexport type PublishAgentsRequest = z.infer<typeof publishAgentsRequestSchema>\n\nexport const publishAgentsSuccessResponseSchema = z.object({\n  success: z.literal(true),\n  publisherId: z.string(),\n  agents: z\n    .object({\n      id: z.string(),\n      version: z.string(),\n      displayName: z.string(),\n    })\n    .array(),\n})\nexport type PublishAgentsSuccessResponse = z.infer<\n  typeof publishAgentsSuccessResponseSchema\n>\n\nexport const publishAgentsErrorResponseSchema = z.object({\n  success: z.literal(false),\n  error: z.string(),\n  details: z.string().optional(),\n  availablePublishers: z\n    .object({\n      id: z.string(),\n      name: z.string(),\n      ownershipType: z.enum(['user', 'organization']),\n      organizationName: z.string().optional(),\n    })\n    .array()\n    .optional(),\n  validationErrors: z\n    .object({\n      code: z.string(),\n      message: z.string(),\n      path: z.array(z.string()),\n    })\n    .array()\n    .optional(),\n})\nexport type PublishAgentsErrorResponse = z.infer<\n  typeof publishAgentsErrorResponseSchema\n>\n\nexport const publishAgentsResponseSchema = z.discriminatedUnion('success', [\n  publishAgentsSuccessResponseSchema,\n  publishAgentsErrorResponseSchema,\n])\nexport type PublishAgentsResponse = z.infer<typeof publishAgentsResponseSchema>\n",
              "referencedBy": {}
            },
            {
              "path": "sdk/scripts/publish.js",
              "content": "#!/usr/bin/env node\n\nimport { execSync } from 'child_process'\nimport fs from 'fs'\nimport path from 'path'\nimport { fileURLToPath } from 'url'\n\nconst __filename = fileURLToPath(import.meta.url)\nconst __dirname = path.dirname(__filename)\n\nfunction log(message) {\n  console.log(` ${message}`)\n}\n\nfunction run(command, options = {}) {\n  log(`Running: ${command}`)\n  try {\n    return execSync(command, { stdio: 'inherit', ...options })\n  } catch (error) {\n    console.error(` Command failed: ${command}`)\n    process.exit(1)\n  }\n}\n\nfunction main() {\n  const args = process.argv.slice(2)\n  const isDryRun = args.includes('--dry-run')\n\n  log('Starting SDK publishing process...')\n\n  // Clean and build\n  log('Cleaning previous build...')\n  run('bun run clean')\n\n  log('Building TypeScript...')\n  run('bun run build')\n\n  // Verify the package\n  log('Verifying package contents...')\n  run('npm pack --dry-run')\n\n  if (isDryRun) {\n    log('Dry run complete! Package is ready for publishing.')\n    log('To publish for real, run: bun run publish-sdk')\n    return\n  }\n\n  // Publish\n  log('Publishing to npm...')\n  const packageJson = JSON.parse(fs.readFileSync('package.json', 'utf8'))\n  run('npm publish')\n  log(' SDK published successfully!')\n  log(` Package: ${packageJson.name}@${packageJson.version}`)\n}\n\nif (import.meta.url === `file://${process.argv[1]}`) {\n  main()\n}\n",
              "referencedBy": {}
            },
            {
              "path": "sdk/src/types/tools.ts",
              "content": "/**\n * Union type of all available tool names\n */\nexport type ToolName =\n  | 'add_message'\n  | 'add_subgoal'\n  | 'browser_logs'\n  | 'code_search'\n  | 'create_plan'\n  | 'end_turn'\n  | 'find_files'\n  | 'read_docs'\n  | 'read_files'\n  | 'run_file_change_hooks'\n  | 'run_terminal_command'\n  | 'set_messages'\n  | 'set_output'\n  | 'spawn_agents'\n  | 'spawn_agents_async'\n  | 'spawn_agent_inline'\n  | 'str_replace'\n  | 'think_deeply'\n  | 'update_subgoal'\n  | 'web_search'\n  | 'write_file'\n\n/**\n * Map of tool names to their parameter types\n */\nexport interface ToolParamsMap {\n  add_message: AddMessageParams\n  add_subgoal: AddSubgoalParams\n  browser_logs: BrowserLogsParams\n  code_search: CodeSearchParams\n  create_plan: CreatePlanParams\n  end_turn: EndTurnParams\n  find_files: FindFilesParams\n  read_docs: ReadDocsParams\n  read_files: ReadFilesParams\n  run_file_change_hooks: RunFileChangeHooksParams\n  run_terminal_command: RunTerminalCommandParams\n  set_messages: SetMessagesParams\n  set_output: SetOutputParams\n  spawn_agents: SpawnAgentsParams\n  spawn_agents_async: SpawnAgentsAsyncParams\n  spawn_agent_inline: SpawnAgentInlineParams\n  str_replace: StrReplaceParams\n  think_deeply: ThinkDeeplyParams\n  update_subgoal: UpdateSubgoalParams\n  web_search: WebSearchParams\n  write_file: WriteFileParams\n}\n\n/**\n * Add a new message to the conversation history. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\n */\nexport interface AddMessageParams {\n  role: 'user' | 'assistant'\n  content: string\n}\n\n/**\n * Add a new subgoal for tracking progress. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\n */\nexport interface AddSubgoalParams {\n  /** A unique identifier for the subgoal. Try to choose the next sequential integer that is not already in use. */\n  id: string\n  /** The objective of the subgoal, concisely and clearly stated. */\n  objective: string\n  /** The status of the subgoal. */\n  status: 'NOT_STARTED' | 'IN_PROGRESS' | 'COMPLETE' | 'ABORTED'\n  /** A plan for the subgoal. */\n  plan?: string\n  /** A log message for the subgoal progress. */\n  log?: string\n}\n\n/**\n * Parameters for browser_logs tool\n */\nexport interface BrowserLogsParams {\n  /** The type of browser action to perform (e.g., \"navigate\"). */\n  type: string\n  /** The URL to navigate to. */\n  url: string\n  /** When to consider navigation successful. Defaults to 'load'. */\n  waitUntil?: 'load' | 'domcontentloaded' | 'networkidle0'\n}\n\n/**\n * Search for string patterns in the project's files. This tool uses ripgrep (rg), a fast line-oriented search tool. Use this tool only when read_files is not sufficient to find the files you need.\n */\nexport interface CodeSearchParams {\n  /** The pattern to search for. */\n  pattern: string\n  /** Optional ripgrep flags to customize the search (e.g., \"-i\" for case-insensitive, \"-t ts\" for TypeScript files only, \"-A 3\" for 3 lines after match, \"-B 2\" for 2 lines before match, \"--type-not test\" to exclude test files). */\n  flags?: string\n  /** Optional working directory to search within, relative to the project root. Defaults to searching the entire project. */\n  cwd?: string\n}\n\n/**\n * Generate a detailed markdown plan for complex tasks.\n */\nexport interface CreatePlanParams {\n  /** The path including the filename of a markdown file that will be overwritten with the plan. */\n  path: string\n  /** A detailed plan to solve the user's request. */\n  plan: string\n}\n\n/**\n * End your turn, regardless of any new tool results that might be coming. This will allow the user to type another prompt.\n */\nexport interface EndTurnParams {}\n\n/**\n * Find several files related to a brief natural language description of the files or the name of a function or class you are looking for.\n */\nexport interface FindFilesParams {\n  /** A brief natural language description of the files or the name of a function or class you are looking for. It's also helpful to mention a directory or two to look within. */\n  prompt: string\n}\n\n/**\n * Fetch up-to-date documentation for libraries and frameworks using Context7 API.\n */\nexport interface ReadDocsParams {\n  /** The exact library or framework name (e.g., \"Next.js\", \"MongoDB\", \"React\"). Use the official name as it appears in documentation, not a search query. */\n  libraryTitle: string\n  /** Optional specific topic to focus on (e.g., \"routing\", \"hooks\", \"authentication\") */\n  topic?: string\n  /** Optional maximum number of tokens to return. Defaults to 10000. Values less than 10000 are automatically increased to 10000. */\n  max_tokens?: number\n}\n\n/**\n * Read the multiple files from disk and return their contents. Use this tool to read as many files as would be helpful to answer the user's request.\n */\nexport interface ReadFilesParams {\n  /** List of file paths to read. */\n  paths: string[]\n}\n\n/**\n * Parameters for run_file_change_hooks tool\n */\nexport interface RunFileChangeHooksParams {\n  /** List of file paths that were changed and should trigger file change hooks */\n  files: string[]\n}\n\n/**\n * Execute a CLI command from the **project root** (different from the user's cwd).\n */\nexport interface RunTerminalCommandParams {\n  /** CLI command valid for user's OS. */\n  command: string\n  /** Either SYNC (waits, returns output) or BACKGROUND (runs in background). Default SYNC */\n  process_type?: 'SYNC' | 'BACKGROUND'\n  /** The working directory to run the command in. Default is the project root. */\n  cwd?: string\n  /** Set to -1 for no timeout. Does not apply for BACKGROUND commands. Default 30 */\n  timeout_seconds?: number\n}\n\n/**\n * Set the conversation history to the provided messages.\n */\nexport interface SetMessagesParams {\n  messages: {\n    role: 'user' | 'assistant'\n    content: string\n  }[]\n}\n\n/**\n * JSON object to set as the agent output. This completely replaces any previous output. If the agent was spawned, this value will be passed back to its parent. If the agent has an outputSchema defined, the output will be validated against it.\n */\nexport interface SetOutputParams {}\n\n/**\n * Spawn multiple agents and send a prompt to each of them.\n */\nexport interface SpawnAgentsParams {\n  agents: {\n    /** Agent to spawn */\n    agent_type: string\n    /** Prompt to send to the agent */\n    prompt?: string\n    /** Parameters object for the agent (if any) */\n    params?: Record<string, any>\n  }[]\n}\n\n/**\n * Parameters for spawn_agents_async tool\n */\nexport interface SpawnAgentsAsyncParams {\n  agents: {\n    /** Agent to spawn */\n    agent_type: string\n    /** Prompt to send to the agent */\n    prompt?: string\n    /** Parameters object for the agent (if any) */\n    params?: Record<string, any>\n  }[]\n}\n\n/**\n * Spawn a single agent that runs within the current message history.\n */\nexport interface SpawnAgentInlineParams {\n  /** Agent to spawn */\n  agent_type: string\n  /** Prompt to send to the agent */\n  prompt?: string\n  /** Parameters object for the agent (if any) */\n  params?: Record<string, any>\n}\n\n/**\n * Replace strings in a file with new strings.\n */\nexport interface StrReplaceParams {\n  /** The path to the file to edit. */\n  path: string\n  /** Array of replacements to make. */\n  replacements: {\n    /** The string to replace. This must be an *exact match* of the string you want to replace, including whitespace and punctuation. */\n    old: string\n    /** The string to replace the corresponding old string with. Can be empty to delete. */\n    new: string\n  }[]\n}\n\n/**\n * Deeply consider complex tasks by brainstorming approaches and tradeoffs step-by-step.\n */\nexport interface ThinkDeeplyParams {\n  /** Detailed step-by-step analysis. Initially keep each step concise (max ~5-7 words per step). */\n  thought: string\n}\n\n/**\n * Update a subgoal in the context given the id, and optionally the status or plan, or a new log to append. Feel free to update any combination of the status, plan, or log in one invocation.\n */\nexport interface UpdateSubgoalParams {\n  /** The id of the subgoal to update. */\n  id: string\n  /** Change the status of the subgoal. */\n  status?: 'NOT_STARTED' | 'IN_PROGRESS' | 'COMPLETE' | 'ABORTED'\n  /** Change the plan for the subgoal. */\n  plan?: string\n  /** Add a log message to the subgoal. This will create a new log entry and append it to the existing logs. Use this to record your progress and any new information you learned as you go. */\n  log?: string\n}\n\n/**\n * Search the web for current information using Linkup API.\n */\nexport interface WebSearchParams {\n  /** The search query to find relevant web content */\n  query: string\n  /** Search depth - 'standard' for quick results, 'deep' for more comprehensive search. Default is 'standard'. */\n  depth: 'standard' | 'deep'\n}\n\n/**\n * Create or edit a file with the given content.\n */\nexport interface WriteFileParams {\n  /** Path to the file relative to the **project root** */\n  path: string\n  /** What the change is intended to do in only one sentence. */\n  instructions: string\n  /** Edit snippet to apply to the file. */\n  content: string\n}\n\n/**\n * Get parameters type for a specific tool\n */\nexport type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n",
              "referencedBy": {}
            }
          ]
        }
      ],
      "parentAgentId": "D-UppjyUa0E"
    },
    {
      "type": "text",
      "agentId": "D-UppjyUa0E",
      "text": "Here's a summary of the relevant files:\n\n*   **`common/src/tools/compile-tool-definitions.ts`**: This file compiles tool definitions into TypeScript definitions, which is useful for tool type generation.\n*   **`common/src/tools/list.ts`**: This file exports `llmToolCallSchema` and `clientToolCallSchema`, which appear to be schemas for tools, likely used in generating or validating tool types.\n*   **`common/src/tools/constants.ts`**: Defines constants related to tools, and defines the `ToolName` type.\n*   **`common/src/tools/utils.ts`**: This module may assist in the tool calling process.\n*   **`common/src/types/api/agents/publish.ts`**: Defines schemas for publishing agents, which includes tool definitions.\n*   **`sdk/scripts/publish.js`**: This script publishes the SDK to npm, which may include regenerating or updating tool definitions.\n*   **`sdk/src/types/tools.ts`**: Defines TypeScript types for all available tools and their parameters within the SDK.\n"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-UppjyUa0E",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Find files handling tool type generation, regeneration, or publishing in SDK and common packages."
    },
    {
      "type": "tool_result",
      "toolCallId": "D-UpnVGjKsI",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Fletcher the File Fetcher",
              "agentType": "file-picker",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "Here's a summary of the most relevant files:\n\n*   `scripts/generate-tool-definitions.ts`: Script to regenerate tool definitions from schemas.\n*   `common/src/tools/compile-tool-definitions.ts`: Compiles tool definitions into TypeScript.\n*   `sdk/src/types/tools.ts`: Type definitions for tools.\n*   `backend/src/tools/definitions/list.ts`: Defines available tools and their descriptions.\n*   `common/src/tools/list.ts`:  Schemas for validating parameters of tools.\n*   `sdk/src/tools/change-file.ts`: modify files\n"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "agentName": "Fletcher the File Fetcher",
              "agentType": "file-picker",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "Okay, here's a concise report of files related to tool types, unions, and interfaces:\n\n*   **sdk/src/types/tools.ts**: Defines the `ToolName` union (all available tool names) and the `ToolParamsMap` interface (mapping tool names to their parameter types). This is central to understanding available tools and their required parameters.\n*   **sdk/src/types/agent-definition.ts**: Defines the `AgentDefinition` interface, which includes `toolNames` (an array of `ToolName`) and references `ToolCall` (for the `handleSteps` function). This file is critical for defining agents and their capabilities.\n*   **common/src/tools/constants.ts**: Defines `ToolName` union, `toolXmlName`, and other constants related to tool calls.\n*   **common/src/tools/list.ts**: Defines `llmToolCallSchema` which specifies the parameter schema for each tool. Also defines `clientToolCallSchema` used in the client.\n*   **common/src/tools/compile-tool-definitions.ts**: Compiles tool definitions into TypeScript, generating type definitions for tools and their parameters.\n*   **common/src/util/xml.ts**: Utility functions for generating XML tags for tool calls and stop sequences.\n*   **common/src/types/dynamic-agent-template.ts**: Defines `DynamicAgentDefinitionSchema` which includes validation for tool usage.\n\nThese are potentially the most relevant files for understanding how tool types are defined and used within the codebase.\n"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "agentName": "Fletcher the File Fetcher",
              "agentType": "file-picker",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "Here's a summary of the relevant files:\n\n*   **`common/src/tools/compile-tool-definitions.ts`**: This file compiles tool definitions into TypeScript definitions, which is useful for tool type generation.\n*   **`common/src/tools/list.ts`**: This file exports `llmToolCallSchema` and `clientToolCallSchema`, which appear to be schemas for tools, likely used in generating or validating tool types.\n*   **`common/src/tools/constants.ts`**: Defines constants related to tools, and defines the `ToolName` type.\n*   **`common/src/tools/utils.ts`**: This module may assist in the tool calling process.\n*   **`common/src/types/api/agents/publish.ts`**: Defines schemas for publishing agents, which includes tool definitions.\n*   **`sdk/scripts/publish.js`**: This script publishes the SDK to npm, which may include regenerating or updating tool definitions.\n*   **`sdk/src/types/tools.ts`**: Defines TypeScript types for all available tools and their parameters within the SDK.\n"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "agentName": "Code Searcher",
              "agentType": "code-searcher",
              "value": {
                "type": "structuredOutput",
                "value": {
                  "results": [
                    {
                      "stdout": "./evals/git-evals/eval-result-levelcode-mock.json:\n21:            \"preContent\": \"import { spawn } from 'child_process'\\nimport fs from 'fs'\\nimport path from 'path'\\n\\nimport { FileChange } from 'common/actions'\\nimport { models, TEST_USER_ID } from 'common/constants'\\nimport { getToolCallString } from 'common/src/constants/tools'\\nimport { z } from 'zod'\\n\\nimport { promptFlashWithFallbacks } from './llm-apis/gemini-with-fallbacks'\\nimport { gitCommitGuidePrompt } from './system-prompt/prompts'\\n\\nconst tools = [\\n  {\\n    name: 'add_subgoal',\\n    description: `\\n### add_subgoal\\nDescription: Add a new subgoal for tracking progress. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\\nParameters:\\n- id: (required) A unique identifier for the subgoal. Try to choose the next sequential integer that is not already in use.\\n- objective: (required) The objective of the subgoal, concisely and clearly stated.\\n- status: (required) The status of the subgoal. One of [\\\"NOT_STARTED\\\", \\\"IN_PROGRESS\\\", \\\"COMPLETE\\\", \\\"ABORTED\\\"]\\n- plan: (optional) A plan for the subgoal.\\nUsage:\\n${getToolCallString('add_subgoal', {\\n  id: '1',\\n  objective: 'Add a new \\\"deploy api\\\" subgoal',\\n  status: 'IN_PROGRESS',\\n})}\\n    `.trim(),\\n  },\\n  {\\n    name: 'update_subgoal',\\n    description: `\\n### update_subgoal\\nDescription: Update a subgoal in the context given the id, and optionally the status or plan, or a new log to append. Feel free to update any combination of the status, plan, or log in one invocation.\\nParameters:\\n- id: (required) The id of the subgoal to update.\\n- status: (optional) Change the status of the subgoal. One of [\\\"NOT_STARTED\\\", \\\"IN_PROGRESS\\\", \\\"COMPLETE\\\", \\\"FAILED\\\"]\\n- plan: (optional) Change the plan for the subgoal.\\n- log: (optional) Add a log message to the subgoal. This will create a new log entry and append it to the existing logs. Use this to record your progress and any new information you learned as you go.\\nUsage 1 (update status):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  status: 'COMPLETE',\\n})}\\n\\nUsage 2 (update plan):\\n${getToolCallString('update_subgoal', {\\n  id: '3',\\n  plan: 'Create a file for the endpoint in the api, and register it in the router',\\n})}\\n\\nUsage 3 (add log):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  log: \\\"I found the error in the tests, it's in the foo function.\\\",\\n})}\\n\\nUsage 4 (update status and add log):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  status: 'COMPLETE',\\n  log: 'I reran the tests and they passed.',\\n})}\\n    `.trim(),\\n  },\\n  {\\n    name: 'write_file',\\n    description: `\\n### write_file\\nDescription: Create or edit a file with the given content.\\n\\nWhen editing a file, please use this tool to output a simplified version of the code block that highlights the changes necessary and adds comments to indicate where unchanged code has been skipped.\\n\\n--- IMPORTANT OPTIMIZATION DETAIL ---\\nUse \\\"placeholder comments\\\" i.e. \\\"// ... existing code ...\\\" (or \\\"# ... existing code ...\\\" or \\\"/* ... existing code ... */\\\" or \\\"<!-- ... existing code ... -->\\\"  or however comments are written for other languages) in comments as often as you can, signifying unchanged regions of the file.\\nThe write_file tool is very expensive for each line of code you write, so try to write as little \\\\`content\\\\` as possible to accomplish the task. Often this will mean that the start/end of the file will be skipped, but that's okay! Rewrite the entire file only if specifically requested.\\n\\nHowever, for new files, you should write out the entire file and not use placeholder comments.\\n--- IMPORTANT OPTIMIZATION DETAIL ---\\n\\nThese edit codeblocks will be parsed and then read by a less intelligent \\\"apply\\\" language model to update the file. To help specify the edit to the apply model, be very careful to include a few lines of context when generating the codeblock to not introduce ambiguity. Specify all unchanged regions (code and comments) of the file with \\\"// ... existing code ...\\\" markers (in comments). This will ensure the apply model will not delete existing unchanged code or comments when editing the file. This is just an abstraction for your understanding, you should not mention the apply model to the user.\\n\\nDo not use this tool to delete or rename a file. Instead run a terminal command for that.\\n\\nParameters:\\n- path: (required) Path to the file relative to the **project root**\\n- content: (required) Content to write to the file. You should abridge the content of the file using placeholder comments like: \\\\`// ... existing code ...\\\\` or \\\\`# ... existing code ...\\\\` (or whichever is appropriate for the language).\\nUsage:\\n${getToolCallString('write_file', {\\n  path: 'path/to/file',\\n  content: 'Your file content here',\\n})}\\n\\nExample 1 - Simple file creation:\\n${getToolCallString('write_file', {\\n  path: 'new-file.ts',\\n  content: 'console.log(\\\"Hello, world!\\\");',\\n})}\\n\\nExample 2 - Editing with placeholder comments:\\n${getToolCallString('write_file', {\\n  path: 'foo.ts',\\n  content: `// ... existing code ...\\n\\nfunction foo() {\\n  console.log('foo');\\n  for (let i = 0; i < 10; i++) {\\n    console.log(i);\\n  }\\n  doSomething();\\n}\\n\\n// ... existing code ...`,\\n})}\\n\\nNotes for editing a file:\\n- Don't use XML attributes. If you do, the tool will NOT write to the file.\\n- If you don't use any placeholder comments, the entire file will be replaced. E.g. don't write out a single function without using placeholder comments unless you want to replace the entire file with that function.\\n- When editing a file, try not to change any user code that doesn't need to be changed. In particular, you must preserve pre-existing user comments exactly as they are.\\n- You can also use this tool to create new files.\\n- After you have written out a write_file block, the changes will be applied immediately. You can assume that the changes went through as intended. However, note that there are sometimes mistakes in the processs of applying the edits you described in the write_file block, e.g. sometimes large portions of the file are deleted. If you notice that the changes did not go through as intended, based on further updates to the file, you can write out a new write_file block to fix the mistake.\\n- Don't escape characters  write them out directly! E.g. write out '&' instead of '&amp;', '>' instead of '&gt;', '<' instead of '&lt;', and '\\\"' instead of '&quot;' in the content.\\n    `.trim(),\\n  },\\n  {\\n    name: 'read_files',\\n    description: `\\n### read_files\\nDescription: Read the multiple files from disk and return their contents. Use this tool to read as many files as would be helpful to answer the user's request. Make sure to read any files before you write to them with the write_file tool.\\nParameters:\\n- paths: (required) List of file paths to read relative to the **project root**, separated by newlines. Absolute file paths will not work.\\nUsage:\\n${getToolCallString('read_files', {\\n  paths: 'path/to/file1.ts\\\\npath/to/file2.ts',\\n})}\\n\\n\\nNote that there's no need to call this tool if you're already reading the files you need in context.`.trim(),\\n  },\\n  {\\n    name: 'find_files',\\n    description: `\\n### find_files\\nDescription: Find several files related to a brief natural language description of the files or the name of a function or class you are looking for.\\nParameters:\\n- description: (required) A brief natural language description of the files or the name of a function or class you are looking for. It's also helpful to mention a directory or two to look within.\\nUsage:\\n<find_files>\\n<description>The implementation of function foo</description>\\n</find_files>\\n\\nPurpose: Better fulfill the user request by reading files which could contain information relevant to the user's request.\\nUse cases:\\n- If you are calling a function or creating a class and want to know how it works, use this tool to get the implementation.\\n- If you need to understand a section of the codebase, read more files in that directory or subdirectories.\\n- Some requests require a broad understanding of multiple parts of the codebase. Consider using find_files to gain more context before making changes.\\n\\nDon't use this tool if:\\n- You already know the exact path of the file(s) you are looking for  in this case, use read_files.\\n- You already read the files you need in context.\\n\\nIn general, prefer using read_files instead of find_files.\\n      `.trim(),\\n  },\\n  {\\n    name: 'code_search',\\n    description: `\\n### code_search\\nDescription: Search for string patterns in the project's files. This tool uses ripgrep (rg), a fast line-oriented search tool. Use this tool only when read_files is not sufficient to find the files you need.\\nParameters:\\n- pattern: (required) The pattern to search for.\\nUsage:\\n${getToolCallString('code_search', { pattern: 'foo' })}\\n${getToolCallString('code_search', { pattern: 'import.*foo' })}\\n\\nPurpose: Search through code files to find files with specific text patterns, function names, variable names, and more.\\n\\nNote: quotes will be automatically added around your code search pattern. You might need to escape special characters like '-' or '.' or '\\\\\\\\' if you want to search for them.\\n\\nPrefer to use read_files instead of code_search unless you need to search for a specific pattern in multiple files.\\n\\nUse cases:\\n1. Finding all references to a function, class, or variable name across the codebase\\n2. Searching for specific code patterns or implementations\\n3. Looking up where certain strings or text appear\\n4. Finding files that contain specific imports or dependencies\\n5. Locating configuration settings or environment variables\\n\\nThe pattern supports regular expressions and will search recursively through all files in the project by default. Some tips:\\n- Be as constraining in the pattern as possible to limit the number of files returned, e.g. if searching for the definition of a function, use \\\"(function foo|const foo)\\\" or \\\"def foo\\\" instead of merely \\\"foo\\\".\\n- Use word boundaries (\\\\\\\\b) to match whole words only\\n- Searches file content and filenames\\n- Automatically ignores binary files, hidden files, and files in .gitignore\\n- Case-sensitive by default. Use -i to make it case insensitive.\\n- Constrain the search to specific file types using -t <file-type>, e.g. -t ts or -t py.\\n    `.trim(),\\n  },\\n  {\\n    name: 'run_terminal_command',\\n    description: `\\n### run_terminal_command\\nDescription: Request to execute a CLI command on the system. Use this when you need to perform system operations or run specific commands to accomplish any step in the user's task. You must tailor your command to the user's system and provide a clear explanation of what the command does. For command chaining, use the appropriate chaining syntax for the user's shell. Prefer to execute complex CLI commands over creating executable scripts, as they are more flexible and easier to run. Commands will be executed in the current working directory: ${process.cwd()}\\nParameters:\\n- command: (required) The CLI command to execute. This should be valid for the current operating system. Ensure the command is properly formatted and does not contain any harmful instructions.\\n- process_type: (required) What type of process to run. One of SYNC or BACKGROUND.\\n  - SYNC: the command will be run in (and block) the current process. This is required if the output of the command is needed immediately. Most commands will be run in this way. Do not try to run processes in the background with process_type=SYNC and using & at the end of the command. Instead, use the process_type=BACKGROUND option.\\n  - BACKGROUND: the command will be run in a child background process. This is for running servers or other long-running processes.\\nUsage:\\n${getToolCallString('run_terminal_command', {\\n  command: 'Your command here',\\n  process_type: 'value',\\n})}\\n\\nStick to these use cases:\\n1. Compiling the project or running build (e.g., \\\"npm run build\\\"). Reading the output can help you edit code to fix build errors. If possible, use an option that performs checks but doesn't emit files, e.g. \\\\`tsc --noEmit\\\\`.\\n2. Running tests (e.g., \\\"npm test\\\"). Reading the output can help you edit code to fix failing tests. Or, you could write new unit tests and then run them.\\n3. Moving, renaming, or deleting files and directories. These actions can be vital for refactoring requests. Use commands like \\\\`mv\\\\`/\\\\`move\\\\` or \\\\`rm\\\\`/\\\\`del\\\\`.\\n\\nMost likely, you should ask for permission for any other type of command you want to run. If asking for permission, show the user the command you want to run using \\\\`\\\\`\\\\` tags.\\n\\nWhen using this tool, please adhere to the following rules:\\n\\n1. Do not run commands that can modify files outside of the project directory, install packages globally, install virtual environments, or have significant side effects outside of the project directory, unless you have explicit permission from the user. Treat anything outside of the project directory as read-only.\\n2. Do not run \\\\`git push\\\\` because it can break production (!) if the user was not expecting it. Don't run \\\\`git commit\\\\`, \\\\`git rebase\\\\`, or related commands unless you get explicit permission. If a user asks to commit changes, you can do so, but you should not invoke any further git commands beyond the git commit command.\\n3. Do not run scripts without asking. Especially don't run scripts that could run against the production environment or have permanent effects without explicit permission from the user. Don't run scripts with side effects without permission from the user unless they don't have much effect or are simple.\\n4. Be careful with any command that has big or irreversible effects. Anything that touches a production environment, servers, the database, or other systems that could be affected by a command should be run with explicit permission from the user.\\n4. Don't run too many commands in a row without pausing to check in with what the user wants to do next.\\n5. Do not use the run_terminal_command tool to create or edit files. Do not use \\\\`cat\\\\` or \\\\`echo\\\\` to create or edit files. You should instead write out <write_file> blocks for for editing or creating files as detailed above in the <editing_instructions> block.\\n6. Do not install packages without asking, unless it is within a small, new-ish project. Users working on a larger project will want to manage packages themselves, so ask first.\\n7. Do not use the wrong package manager for the project. For example, if the project uses \\\\`pnpm\\\\` or \\\\`bun\\\\` or \\\\`yarn\\\\`, you should not use \\\\`npm\\\\`. Similarly not everyone uses \\\\`pip\\\\` for python, etc.\\n8. You must write out ampersands without escaping them. E.g. write out '&' instead of '&amp;'.\\nIncorrect:\\n\\\\`cd backend &amp;&amp; npm typecheck\\\\` \\nCorrect:\\n\\\\`cd backend && npm typecheck\\\\`\\n10. Do not use more than one run_terminal_command tool call in a single response. Wait for the tool results of each command before invoking the next one.\\n11. The user will not be able to interact with these processes, e.g. confirming the command. So if there's an opportunity to use \\\"-y\\\" or \\\"--yes\\\" flags, use them. Any command that prompts for confirmation will hang if you don't use the flags.\\n\\nNotes:\\n- The current working directory will always reset to **project root** directory for each command you run. You can only access files within this directory (or sub-directories). So if you run cd in one command, the directory change won't persist to the next command.\\n  - \\\\`cd subdir && some_command\\\\` will work as expected.\\n  - \\\\`cd subdir\\\\` in followed by \\\\`some_command\\\\` in two different commands will run some_command from the project root.\\n- Commands can succeed without giving any output, e.g. if no type errors were found. So you may not always see output for successful executions.\\n\\n${gitCommitGuidePrompt}\\n    `.trim(),\\n  },\\n  {\\n    name: 'think_deeply',\\n    description: `\\n### think_deeply\\nDescription: Think through a complex change to the codebase, like implementing a new feature or refactoring some code. Brainstorm. Go deep on alternative approaches and consider the tradeoffs.\\nParameters: thought: (required) Your detailed thoughts.\\nUsage:\\n${getToolCallString('think_deeply', {\\n  thought: '[Insert detailed thoughts here]',\\n})}\\n\\nThink step by step. For the first section of your thinking, only keep a minimum draft for each thinking step, with 5 words at most.\\n\\nUse this tool when the user request meets multiple of these criteria:\\n- Explicitly asks you to plan or think through something.\\n- Always use this tool right before using the create_plan tool.\\n- Requires changes across multiple files or systems\\n- Involves complex logic or architectural decisions\\n- Would benefit from breaking down into smaller steps\\n- Has potential edge cases or risks that need consideration\\n\\nExamples of when to use it:\\n- Adding a new feature that touches multiple parts of the system\\n- Refactoring core functionality used by many components\\n- Making architectural changes that affect the system design\\n- Implementing complex business logic with many edge cases\\n\\nDo not use it for simple changes like:\\n- Adding a single function or endpoint\\n- Updating text or styles\\n    `.trim(),\\n  },\\n  {\\n    name: 'create_plan',\\n    description: `\\n### create_plan\\nDescription: Create a plan for a complex change to the codebase, like implementing a new feature or refactoring some code.\\nParameters:\\n- path: (required) The path including the filename of a markdown file that will be overwritten with the plan.\\n- plan: (required) A detailed plan to solve the user's request.\\n\\nUsage:\\n${getToolCallString('create_plan', {\\n  path: 'feature-name-plan.md',\\n  plan: '[Insert long detailed plan here]',\\n})}\\n\\nUse this tool when the user asks you to plan something, or asks you to help with a new feature or refactoring that requires planning.\\n\\nExamples of when to use it:\\n- Adding a new feature that touches multiple parts of the system\\n- Refactoring core functionality used by many components\\n- Making architectural changes that affect the system design\\n- Implementing complex business logic with many edge cases\\n\\nDo not use it for simple changes like:\\n- Adding a single function or endpoint\\n- Updating text or styles\\n\\nFor a technical plan, act as an expert architect engineer and provide direction to your editor engineer.\\n- Study the change request and the current code.\\n- Describe how to modify the code to complete the request. The editor engineer will rely solely on your instructions, so make them unambiguous and complete.\\n- Explain all needed code changes clearly and completely, but concisely.\\n- Just show the changes needed.\\n\\nWhat to include in the plan:\\n- Include code, but not full files of it. Write out key snippets of code and use lots of psuedo code. For example, interfaces between modules, function signatures, and other code that is not immediately obvious should be written out explicitly. Function and method bodies could be written out in psuedo code.\\n- Do not waste time on much background information, focus on the exact steps of the implementation.\\n- Do not wrap the path content in markdown code blocks, e.g. \\\\`\\\\`\\\\`.\\n\\nDo not include any of the following sections in the plan:\\n- goals\\n- a timeline or schedule\\n- benefits/key improvements\\n- next steps\\n\\nAfter creating than plan, you should end turn to let the user review the plan.\\n\\nImportant: Use this tool sparingly. Do not use this tool more than once in a conversation, if a plan was already created, or for similar user requests.\\n    `.trim(),\\n  },\\n  {\\n    name: 'browser_logs',\\n    description: `\\n### browser_logs\\nDescription: In a headless browser, navigate to a web page and get the console logs after page load.\\nPurpose: Use this to\n\n[Output truncated]\n\n[Output size limit reached.]",
                      "message": "Stopped early after 1 match(es)."
                    },
                    {
                      "stdout": "No results",
                      "message": "Exit code: 1"
                    }
                  ]
                }
              }
            },
            {
              "agentName": "Directory Lister",
              "agentType": "directory-lister",
              "value": {
                "type": "structuredOutput",
                "value": {
                  "results": [
                    {
                      "path": "scripts",
                      "files": [
                        "generate-tool-definitions.ts",
                        "convert-escaped-newlines.ts",
                        "init-worktree.ts",
                        "get-changelog.ts",
                        "cleanup-worktree.sh",
                        "dev.sh",
                        "calculate-average-spend.ts",
                        "analyze-model-usage.ts",
                        "export-user-emails.ts",
                        "analyze-edit-blocks.ts",
                        "generate-ci-env.js",
                        "debug-log-subset.ts",
                        "apply-credit-migration.ts",
                        ".gitignore",
                        "package.json",
                        "calculate-weekly-usage.ts",
                        "calculate-mrr.ts",
                        "tsconfig.json",
                        "calculate-dau.ts",
                        "calculate-monthly-usage.ts",
                        "count-edit-file.ts",
                        "update-stripe-subscriptions.ts"
                      ],
                      "directories": [
                        "ft-file-selection",
                        "changelog"
                      ]
                    },
                    {
                      "path": "sdk/src",
                      "files": [
                        "constants.ts",
                        "client.ts",
                        "index.ts",
                        "process-stream.ts",
                        "websocket-client.ts"
                      ],
                      "directories": [
                        "tools",
                        "types"
                      ]
                    },
                    {
                      "path": "common/src",
                      "files": [
                        "analytics.ts",
                        "project-file-tree.ts",
                        "browser-actions.ts",
                        "actions.ts",
                        "constants.ts"
                      ],
                      "directories": [
                        "tools",
                        "types",
                        "util",
                        "json-config",
                        "constants",
                        "websockets",
                        "api-keys",
                        "testing",
                        "__tests__",
                        "db",
                        "templates"
                      ]
                    },
                    {
                      "path": "backend/src",
                      "files": [
                        "xml-stream-parser.ts",
                        "main-prompt.ts",
                        "process-str-replace.ts",
                        "run-programmatic-step.ts",
                        "run-agent-step.ts",
                        "prompt-agent-stream.ts",
                        "get-documentation-for-query.ts",
                        "get-file-reading-updates.ts",
                        "check-terminal-command.ts",
                        "generate-diffs-prompt.ts",
                        "index.ts",
                        "live-user-inputs.ts",
                        "loop-main-prompt.ts",
                        "async-agent-manager.ts",
                        "fast-rewrite.ts",
                        "process-file-block.ts"
                      ],
                      "directories": [
                        "find-files",
                        "tools",
                        "context",
                        "util",
                        "system-prompt",
                        "admin",
                        "websockets",
                        "__tests__",
                        "api",
                        "templates",
                        "llm-apis"
                      ]
                    }
                  ]
                }
              }
            }
          ]
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "a0f9851c-efdd-4f97-92c8-c198b9573431",
      "toolName": "spawn_agent_inline",
      "input": {
        "agent_type": "context-pruner",
        "params": {}
      },
      "agentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "a0f9851c-efdd-4f97-92c8-c198b9573431",
      "toolName": "spawn_agent_inline",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Agent spawned."
          }
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "D-WCtXVJaCs",
      "toolName": "read_files",
      "input": {
        "paths": [
          "scripts/generate-tool-definitions.ts",
          "common/src/tools/compile-tool-definitions.ts",
          "sdk/src/types/tools.ts",
          "common/src/tools/constants.ts",
          "common/src/tools/list.ts",
          "backend/src/tools/definitions/list.ts",
          "sdk/src/types/agent-definition.ts"
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "D-WDhRCoKc0",
      "toolName": "read_files",
      "input": {
        "paths": [
          "common/src/tools/utils.ts",
          "sdk/scripts/publish.js"
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "D-WFT0P7c6U",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "code-searcher",
            "params": {
              "searchQueries": [
                {
                  "pattern": "ToolName|PublicTool|ApprovedTool",
                  "flags": "-g *.ts"
                },
                {
                  "pattern": "generate-tool-definitions|compile-tool-definitions",
                  "flags": ""
                }
              ]
            }
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "D-WCtXVJaCs",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": "scripts/generate-tool-definitions.ts",
              "content": "#!/usr/bin/env bun\n\nimport { writeFileSync } from 'fs'\nimport { join } from 'path'\nimport { execSync } from 'child_process'\n\nimport { compileToolDefinitions } from '@levelcode/common/tools/compile-tool-definitions'\n\n/**\n * Regenerates the tool-definitions.d.ts file from the current tool schemas.\n * This ensures the type definitions stay in sync with the actual tool parameters.\n */\nfunction main() {\n  console.log(' Generating tool definitions...')\n\n  try {\n    const content = compileToolDefinitions()\n    const outputPath = join(process.cwd(), 'common/src/util/types/tools.d.ts')\n\n    writeFileSync(outputPath, content, 'utf8')\n\n    // Format the generated file with prettier\n    console.log(' Formatting generated file...')\n    execSync(`npx prettier --write \"${outputPath}\"`, { stdio: 'inherit' })\n\n    console.log(' Successfully generated tools.d.ts')\n    console.log(` Output: ${outputPath}`)\n  } catch (error) {\n    console.error(' Failed to generate tool definitions:', error)\n    process.exit(1)\n  }\n}\n\nif (import.meta.main) {\n  main()\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/compile-tool-definitions.ts",
              "content": "import z from 'zod/v4'\n\nimport { llmToolCallSchema } from './list'\n\n/**\n * Compiles all tool definitions into a single TypeScript definition file content.\n * This generates type definitions for all available tools and their parameters.\n */\nexport function compileToolDefinitions(): string {\n  const toolEntries = Object.entries(llmToolCallSchema)\n\n  const toolInterfaces = toolEntries\n    .map(([toolName, toolDef]) => {\n      const parameterSchema = toolDef.parameters\n\n      // Convert Zod schema to TypeScript interface using JSON schema\n      let typeDefinition: string\n      try {\n        const jsonSchema = z.toJSONSchema(parameterSchema)\n        typeDefinition = jsonSchemaToTypeScript(jsonSchema)\n      } catch (error) {\n        console.warn(`Failed to convert schema for ${toolName}:`, error)\n        typeDefinition = '{ [key: string]: any }'\n      }\n\n      return `/**\n * ${parameterSchema.description || `Parameters for ${toolName} tool`}\n */\nexport interface ${toPascalCase(toolName)}Params ${typeDefinition}`\n    })\n    .join('\\n\\n')\n\n  const toolUnion = toolEntries.map(([toolName]) => `'${toolName}'`).join(' | ')\n\n  const toolParamsMap = toolEntries\n    .map(([toolName]) => `  '${toolName}': ${toPascalCase(toolName)}Params`)\n    .join('\\n')\n\n  return `/**\n * Union type of all available tool names\n */\nexport type ToolName = ${toolUnion}\n\n/**\n * Map of tool names to their parameter types\n */\nexport interface ToolParamsMap {\n${toolParamsMap}\n}\n\n${toolInterfaces}\n\n/**\n * Get parameters type for a specific tool\n */\nexport type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n`\n}\n\n/**\n * Converts kebab-case to PascalCase\n * e.g., 'write-file' -> 'WriteFile'\n */\nfunction toPascalCase(str: string): string {\n  return str\n    .split(/[-_]/)\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n    .join('')\n}\n\n/**\n * Converts JSON Schema to TypeScript interface definition\n */\nfunction jsonSchemaToTypeScript(schema: any): string {\n  if (schema.type === 'object' && schema.properties) {\n    const properties = Object.entries(schema.properties).map(\n      ([key, prop]: [string, any]) => {\n        const isOptional = !schema.required?.includes(key)\n        const propType = getTypeFromJsonSchema(prop)\n        const comment = prop.description ? `  /** ${prop.description} */\\n` : ''\n        return `${comment}  \"${key}\"${isOptional ? '?' : ''}: ${propType}`\n      },\n    )\n    return `{\\n${properties.join('\\n')}\\n}`\n  }\n  return getTypeFromJsonSchema(schema)\n}\n\n/**\n * Gets TypeScript type from JSON Schema property\n */\nfunction getTypeFromJsonSchema(prop: any): string {\n  if (prop.type === 'string') {\n    if (prop.enum) {\n      return prop.enum.map((v: string) => `\"${v}\"`).join(' | ')\n    }\n    return 'string'\n  }\n  if (prop.type === 'number' || prop.type === 'integer') return 'number'\n  if (prop.type === 'boolean') return 'boolean'\n  if (prop.type === 'array') {\n    const itemType = prop.items ? getTypeFromJsonSchema(prop.items) : 'any'\n    return `${itemType}[]`\n  }\n  if (prop.type === 'object') {\n    if (prop.properties) {\n      return jsonSchemaToTypeScript(prop)\n    }\n    if (prop.additionalProperties) {\n      const valueType = getTypeFromJsonSchema(prop.additionalProperties)\n      return `Record<string, ${valueType}>`\n    }\n    return 'Record<string, any>'\n  }\n  if (prop.anyOf || prop.oneOf) {\n    const schemas = prop.anyOf || prop.oneOf\n    return schemas.map((s: any) => getTypeFromJsonSchema(s)).join(' | ')\n  }\n  return 'any'\n}\n",
              "referencedBy": {}
            },
            {
              "path": "sdk/src/types/tools.ts",
              "content": "/**\n * Union type of all available tool names\n */\nexport type ToolName =\n  | 'add_message'\n  | 'add_subgoal'\n  | 'browser_logs'\n  | 'code_search'\n  | 'create_plan'\n  | 'end_turn'\n  | 'find_files'\n  | 'read_docs'\n  | 'read_files'\n  | 'run_file_change_hooks'\n  | 'run_terminal_command'\n  | 'set_messages'\n  | 'set_output'\n  | 'spawn_agents'\n  | 'spawn_agents_async'\n  | 'spawn_agent_inline'\n  | 'str_replace'\n  | 'think_deeply'\n  | 'update_subgoal'\n  | 'web_search'\n  | 'write_file'\n\n/**\n * Map of tool names to their parameter types\n */\nexport interface ToolParamsMap {\n  add_message: AddMessageParams\n  add_subgoal: AddSubgoalParams\n  browser_logs: BrowserLogsParams\n  code_search: CodeSearchParams\n  create_plan: CreatePlanParams\n  end_turn: EndTurnParams\n  find_files: FindFilesParams\n  read_docs: ReadDocsParams\n  read_files: ReadFilesParams\n  run_file_change_hooks: RunFileChangeHooksParams\n  run_terminal_command: RunTerminalCommandParams\n  set_messages: SetMessagesParams\n  set_output: SetOutputParams\n  spawn_agents: SpawnAgentsParams\n  spawn_agents_async: SpawnAgentsAsyncParams\n  spawn_agent_inline: SpawnAgentInlineParams\n  str_replace: StrReplaceParams\n  think_deeply: ThinkDeeplyParams\n  update_subgoal: UpdateSubgoalParams\n  web_search: WebSearchParams\n  write_file: WriteFileParams\n}\n\n/**\n * Add a new message to the conversation history. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\n */\nexport interface AddMessageParams {\n  role: 'user' | 'assistant'\n  content: string\n}\n\n/**\n * Add a new subgoal for tracking progress. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\n */\nexport interface AddSubgoalParams {\n  /** A unique identifier for the subgoal. Try to choose the next sequential integer that is not already in use. */\n  id: string\n  /** The objective of the subgoal, concisely and clearly stated. */\n  objective: string\n  /** The status of the subgoal. */\n  status: 'NOT_STARTED' | 'IN_PROGRESS' | 'COMPLETE' | 'ABORTED'\n  /** A plan for the subgoal. */\n  plan?: string\n  /** A log message for the subgoal progress. */\n  log?: string\n}\n\n/**\n * Parameters for browser_logs tool\n */\nexport interface BrowserLogsParams {\n  /** The type of browser action to perform (e.g., \"navigate\"). */\n  type: string\n  /** The URL to navigate to. */\n  url: string\n  /** When to consider navigation successful. Defaults to 'load'. */\n  waitUntil?: 'load' | 'domcontentloaded' | 'networkidle0'\n}\n\n/**\n * Search for string patterns in the project's files. This tool uses ripgrep (rg), a fast line-oriented search tool. Use this tool only when read_files is not sufficient to find the files you need.\n */\nexport interface CodeSearchParams {\n  /** The pattern to search for. */\n  pattern: string\n  /** Optional ripgrep flags to customize the search (e.g., \"-i\" for case-insensitive, \"-t ts\" for TypeScript files only, \"-A 3\" for 3 lines after match, \"-B 2\" for 2 lines before match, \"--type-not test\" to exclude test files). */\n  flags?: string\n  /** Optional working directory to search within, relative to the project root. Defaults to searching the entire project. */\n  cwd?: string\n}\n\n/**\n * Generate a detailed markdown plan for complex tasks.\n */\nexport interface CreatePlanParams {\n  /** The path including the filename of a markdown file that will be overwritten with the plan. */\n  path: string\n  /** A detailed plan to solve the user's request. */\n  plan: string\n}\n\n/**\n * End your turn, regardless of any new tool results that might be coming. This will allow the user to type another prompt.\n */\nexport interface EndTurnParams {}\n\n/**\n * Find several files related to a brief natural language description of the files or the name of a function or class you are looking for.\n */\nexport interface FindFilesParams {\n  /** A brief natural language description of the files or the name of a function or class you are looking for. It's also helpful to mention a directory or two to look within. */\n  prompt: string\n}\n\n/**\n * Fetch up-to-date documentation for libraries and frameworks using Context7 API.\n */\nexport interface ReadDocsParams {\n  /** The exact library or framework name (e.g., \"Next.js\", \"MongoDB\", \"React\"). Use the official name as it appears in documentation, not a search query. */\n  libraryTitle: string\n  /** Optional specific topic to focus on (e.g., \"routing\", \"hooks\", \"authentication\") */\n  topic?: string\n  /** Optional maximum number of tokens to return. Defaults to 10000. Values less than 10000 are automatically increased to 10000. */\n  max_tokens?: number\n}\n\n/**\n * Read the multiple files from disk and return their contents. Use this tool to read as many files as would be helpful to answer the user's request.\n */\nexport interface ReadFilesParams {\n  /** List of file paths to read. */\n  paths: string[]\n}\n\n/**\n * Parameters for run_file_change_hooks tool\n */\nexport interface RunFileChangeHooksParams {\n  /** List of file paths that were changed and should trigger file change hooks */\n  files: string[]\n}\n\n/**\n * Execute a CLI command from the **project root** (different from the user's cwd).\n */\nexport interface RunTerminalCommandParams {\n  /** CLI command valid for user's OS. */\n  command: string\n  /** Either SYNC (waits, returns output) or BACKGROUND (runs in background). Default SYNC */\n  process_type?: 'SYNC' | 'BACKGROUND'\n  /** The working directory to run the command in. Default is the project root. */\n  cwd?: string\n  /** Set to -1 for no timeout. Does not apply for BACKGROUND commands. Default 30 */\n  timeout_seconds?: number\n}\n\n/**\n * Set the conversation history to the provided messages.\n */\nexport interface SetMessagesParams {\n  messages: {\n    role: 'user' | 'assistant'\n    content: string\n  }[]\n}\n\n/**\n * JSON object to set as the agent output. This completely replaces any previous output. If the agent was spawned, this value will be passed back to its parent. If the agent has an outputSchema defined, the output will be validated against it.\n */\nexport interface SetOutputParams {}\n\n/**\n * Spawn multiple agents and send a prompt to each of them.\n */\nexport interface SpawnAgentsParams {\n  agents: {\n    /** Agent to spawn */\n    agent_type: string\n    /** Prompt to send to the agent */\n    prompt?: string\n    /** Parameters object for the agent (if any) */\n    params?: Record<string, any>\n  }[]\n}\n\n/**\n * Parameters for spawn_agents_async tool\n */\nexport interface SpawnAgentsAsyncParams {\n  agents: {\n    /** Agent to spawn */\n    agent_type: string\n    /** Prompt to send to the agent */\n    prompt?: string\n    /** Parameters object for the agent (if any) */\n    params?: Record<string, any>\n  }[]\n}\n\n/**\n * Spawn a single agent that runs within the current message history.\n */\nexport interface SpawnAgentInlineParams {\n  /** Agent to spawn */\n  agent_type: string\n  /** Prompt to send to the agent */\n  prompt?: string\n  /** Parameters object for the agent (if any) */\n  params?: Record<string, any>\n}\n\n/**\n * Replace strings in a file with new strings.\n */\nexport interface StrReplaceParams {\n  /** The path to the file to edit. */\n  path: string\n  /** Array of replacements to make. */\n  replacements: {\n    /** The string to replace. This must be an *exact match* of the string you want to replace, including whitespace and punctuation. */\n    old: string\n    /** The string to replace the corresponding old string with. Can be empty to delete. */\n    new: string\n  }[]\n}\n\n/**\n * Deeply consider complex tasks by brainstorming approaches and tradeoffs step-by-step.\n */\nexport interface ThinkDeeplyParams {\n  /** Detailed step-by-step analysis. Initially keep each step concise (max ~5-7 words per step). */\n  thought: string\n}\n\n/**\n * Update a subgoal in the context given the id, and optionally the status or plan, or a new log to append. Feel free to update any combination of the status, plan, or log in one invocation.\n */\nexport interface UpdateSubgoalParams {\n  /** The id of the subgoal to update. */\n  id: string\n  /** Change the status of the subgoal. */\n  status?: 'NOT_STARTED' | 'IN_PROGRESS' | 'COMPLETE' | 'ABORTED'\n  /** Change the plan for the subgoal. */\n  plan?: string\n  /** Add a log message to the subgoal. This will create a new log entry and append it to the existing logs. Use this to record your progress and any new information you learned as you go. */\n  log?: string\n}\n\n/**\n * Search the web for current information using Linkup API.\n */\nexport interface WebSearchParams {\n  /** The search query to find relevant web content */\n  query: string\n  /** Search depth - 'standard' for quick results, 'deep' for more comprehensive search. Default is 'standard'. */\n  depth: 'standard' | 'deep'\n}\n\n/**\n * Create or edit a file with the given content.\n */\nexport interface WriteFileParams {\n  /** Path to the file relative to the **project root** */\n  path: string\n  /** What the change is intended to do in only one sentence. */\n  instructions: string\n  /** Edit snippet to apply to the file. */\n  content: string\n}\n\n/**\n * Get parameters type for a specific tool\n */\nexport type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/constants.ts",
              "content": "import type { ToolResultPart } from 'ai'\nimport type z from 'zod/v4'\n\nexport const toolNameParam = 'cb_tool_name'\nexport const endsAgentStepParam = 'cb_easp'\nexport const toolXmlName = 'levelcode_tool_call'\nexport const startToolTag = `<${toolXmlName}>\\n`\nexport const endToolTag = `\\n</${toolXmlName}>`\n\nexport const TOOLS_WHICH_WONT_FORCE_NEXT_STEP = ['think_deeply']\n\n// List of all available tools\nexport const toolNames = [\n  'add_subgoal',\n  'add_message',\n  'browser_logs',\n  'code_search',\n  'create_plan',\n  'end_turn',\n  'find_files',\n  'read_docs',\n  'read_files',\n  'run_file_change_hooks',\n  'run_terminal_command',\n  'set_messages',\n  'set_output',\n  'spawn_agents',\n  'spawn_agents_async',\n  'spawn_agent_inline',\n  'str_replace',\n  'think_deeply',\n  'update_subgoal',\n  'web_search',\n  'write_file',\n] as const\n\nexport type ToolName = (typeof toolNames)[number]\n\nexport type ToolParams<T extends ToolName = ToolName> = {\n  toolName: T\n  endsAgentStep: boolean\n  parameters: z.ZodType\n}\n\nexport type StringToolResultPart = Omit<ToolResultPart, 'type'> & {\n  result: string\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/tools/list.ts",
              "content": "import { addMessageParams } from './params/tool/add-message'\nimport { addSubgoalParams } from './params/tool/add-subgoal'\nimport { browserLogsParams } from './params/tool/browser-logs'\nimport { codeSearchParams } from './params/tool/code-search'\nimport { createPlanParams } from './params/tool/create-plan'\nimport { endTurnParams } from './params/tool/end-turn'\nimport { findFilesParams } from './params/tool/find-files'\nimport { readDocsParams } from './params/tool/read-docs'\nimport { readFilesParams } from './params/tool/read-files'\nimport { runFileChangeHooksParams } from './params/tool/run-file-change-hooks'\nimport { runTerminalCommandParams } from './params/tool/run-terminal-command'\nimport { setMessagesParams } from './params/tool/set-messages'\nimport { setOutputParams } from './params/tool/set-output'\nimport { spawnAgentsParams } from './params/tool/spawn-agents'\nimport { spawnAgentsAsyncParams } from './params/tool/spawn-agents-async'\nimport { spawnAgentInlineParams } from './params/tool/spawn-agent-inline'\nimport { strReplaceParams } from './params/tool/str-replace'\nimport { thinkDeeplyParams } from './params/tool/think-deeply'\nimport { updateSubgoalParams } from './params/tool/update-subgoal'\nimport { webSearchParams } from './params/tool/web-search'\nimport { writeFileParams } from './params/tool/write-file'\n\nimport type { ToolName, ToolParams } from './constants'\n\nexport const llmToolCallSchema = {\n  add_message: addMessageParams,\n  add_subgoal: addSubgoalParams,\n  browser_logs: browserLogsParams,\n  code_search: codeSearchParams,\n  create_plan: createPlanParams,\n  end_turn: endTurnParams,\n  find_files: findFilesParams,\n  read_docs: readDocsParams,\n  read_files: readFilesParams,\n  run_file_change_hooks: runFileChangeHooksParams,\n  run_terminal_command: runTerminalCommandParams,\n  set_messages: setMessagesParams,\n  set_output: setOutputParams,\n  spawn_agents: spawnAgentsParams,\n  spawn_agents_async: spawnAgentsAsyncParams,\n  spawn_agent_inline: spawnAgentInlineParams,\n  str_replace: strReplaceParams,\n  think_deeply: thinkDeeplyParams,\n  update_subgoal: updateSubgoalParams,\n  web_search: webSearchParams,\n  write_file: writeFileParams,\n} satisfies {\n  [K in ToolName]: ToolParams<K>\n}\n\nexport const clientToolCallSchema = {\n  // Tools that require an id and objective\n  add_subgoal: ['id', 'objective', 'status', 'plan', 'log'],\n  update_subgoal: ['id', 'status', 'plan', 'log'],\n\n  // File operations\n  write_file: ['path', 'instructions', 'content'],\n  str_replace: ['path', 'replacements'],\n  read_files: ['paths'],\n  find_files: ['prompt'],\n\n  // Search and terminal\n  code_search: ['pattern', 'flags', 'cwd'],\n  run_terminal_command: ['command', 'process_type', 'cwd', 'timeout_seconds'],\n\n  // Planning tools\n  think_deeply: ['thought'],\n  create_plan: ['path', 'plan'],\n\n  browser_logs: ['type', 'url', 'waitUntil'],\n\n  spawn_agents: ['agents'],\n  spawn_agents_async: ['agents'],\n  spawn_agent_inline: ['agent_type', 'prompt', 'params'],\n  set_output: [],\n\n  // Documentation tool\n  read_docs: ['libraryTitle', 'topic', 'max_tokens'],\n\n  // Web search tool\n  web_search: ['query', 'depth'],\n\n  // File change hooks tool\n  run_file_change_hooks: ['files'],\n\n  // Tools that change the conversation history\n  add_message: ['role', 'content'],\n  set_messages: ['messages'],\n\n  end_turn: [],\n} as const satisfies Record<ToolName, string[]>\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/tools/definitions/list.ts",
              "content": "import { llmToolCallSchema } from '@levelcode/common/tools/list'\n\nimport { addMessageTool } from './tool/add-message'\nimport { addSubgoalTool } from './tool/add-subgoal'\nimport { browserLogsTool } from './tool/browser-logs'\nimport { codeSearchTool } from './tool/code-search'\nimport { createPlanTool } from './tool/create-plan'\nimport { endTurnTool } from './tool/end-turn'\nimport { findFilesTool } from './tool/find-files'\nimport { readDocsTool } from './tool/read-docs'\nimport { readFilesTool } from './tool/read-files'\nimport { runFileChangeHooksTool } from './tool/run-file-change-hooks'\nimport { runTerminalCommandTool } from './tool/run-terminal-command'\nimport { setMessagesTool } from './tool/set-messages'\nimport { setOutputTool } from './tool/set-output'\nimport { spawnAgentsTool } from './tool/spawn-agents'\nimport { spawnAgentsAsyncTool } from './tool/spawn-agents-async'\nimport { spawnAgentInlineTool } from './tool/spawn-agent-inline'\nimport { strReplaceTool } from './tool/str-replace'\nimport { thinkDeeplyTool } from './tool/think-deeply'\nimport { updateSubgoalTool } from './tool/update-subgoal'\nimport { webSearchTool } from './tool/web-search'\nimport { writeFileTool } from './tool/write-file'\n\nimport type { ToolDescription } from './tool-def-type'\nimport type { ToolName } from '@levelcode/common/tools/constants'\nimport type { ToolSet } from 'ai'\n\nconst toolDescriptions = {\n  add_message: addMessageTool,\n  add_subgoal: addSubgoalTool,\n  browser_logs: browserLogsTool,\n  code_search: codeSearchTool,\n  create_plan: createPlanTool,\n  end_turn: endTurnTool,\n  find_files: findFilesTool,\n  read_docs: readDocsTool,\n  read_files: readFilesTool,\n  run_file_change_hooks: runFileChangeHooksTool,\n  run_terminal_command: runTerminalCommandTool,\n  set_messages: setMessagesTool,\n  set_output: setOutputTool,\n  spawn_agents: spawnAgentsTool,\n  spawn_agents_async: spawnAgentsAsyncTool,\n  spawn_agent_inline: spawnAgentInlineTool,\n  str_replace: strReplaceTool,\n  think_deeply: thinkDeeplyTool,\n  update_subgoal: updateSubgoalTool,\n  web_search: webSearchTool,\n  write_file: writeFileTool,\n} satisfies {\n  [K in ToolName]: ToolDescription<K>\n}\n\nexport type ToolDefinition<T extends ToolName = ToolName> = {\n  [K in ToolName]: (typeof toolDescriptions)[K] & (typeof llmToolCallSchema)[K]\n}[T]\n\nexport const levelcodeToolDefs = Object.fromEntries(\n  Object.entries(toolDescriptions).map(([toolName, toolDescription]) => [\n    toolName,\n    {\n      ...toolDescriptions[toolName as ToolName],\n      ...llmToolCallSchema[toolName as ToolName],\n    } satisfies ToolDefinition,\n  ]),\n) as { [K in ToolName]: ToolDefinition<K> } satisfies ToolSet\n",
              "referencedBy": {}
            },
            {
              "path": "sdk/src/types/agent-definition.ts",
              "content": "/**\n * LevelCode Agent Type Definitions\n *\n * This file provides TypeScript type definitions for creating custom LevelCode agents.\n * Import these types in your agent files to get full type safety and IntelliSense.\n *\n * Usage in .agents/your-agent.ts:\n *   import { AgentDefinition, ToolName, ModelName } from './types/agent-definition'\n *\n *   const config: AgentDefinition = {\n *     // ... your agent configuration with full type safety ...\n *   }\n *\n *   export default config\n */\n\n// ============================================================================\n// Agent Definition and Utility Types\n// ============================================================================\n\nexport interface AgentDefinition {\n  /** Unique identifier for this agent. Must contain only lowercase letters, numbers, and hyphens, e.g. 'code-reviewer' */\n  id: string\n\n  /** Version string (if not provided, will default to '0.0.1' and be bumped on each publish) */\n  version?: string\n\n  /** Publisher ID for the agent. Must be provided if you want to publish the agent. */\n  publisher?: string\n\n  /** Human-readable name for the agent */\n  displayName: string\n\n  /** AI model to use for this agent. Can be any model in OpenRouter: https://openrouter.ai/models */\n  model: ModelName\n\n  // ============================================================================\n  // Tools and Subagents\n  // ============================================================================\n\n  /** Tools this agent can use. */\n  toolNames?: ToolName[]\n\n  /** Other agents this agent can spawn, like 'levelcode/file-picker@0.0.1'.\n   *\n   * Use the fully qualified agent id from the agent store, including publisher and version: 'levelcode/file-picker@0.0.1'\n   * (publisher and version are required!)\n   *\n   * Or, use the agent id from a local agent file in your .agents directory: 'file-picker'.\n   */\n  spawnableAgents?: string[]\n\n  // ============================================================================\n  // Input and Output\n  // ============================================================================\n\n  /** The input schema required to spawn the agent. Provide a prompt string and/or a params object or none.\n   * 80% of the time you want just a prompt string with a description:\n   * inputSchema: {\n   *   prompt: { type: 'string', description: 'A description of what info would be helpful to the agent' }\n   * }\n   */\n  inputSchema?: {\n    prompt?: { type: 'string'; description?: string }\n    params?: JsonSchema\n  }\n\n  /** Whether to include conversation history from the parent agent in context.\n   *\n   * Defaults to false.\n   * Use this if the agent needs to know all the previous messages in the conversation.\n   */\n  includeMessageHistory?: boolean\n\n  /** How the agent should output a response to its parent (defaults to 'last_message')\n   *\n   * last_message: The last message from the agent, typcically after using tools.\n   *\n   * all_messages: All messages from the agent, including tool calls and results.\n   *\n   * json: Make the agent output a JSON object. Can be used with outputSchema or without if you want freeform json output.\n   */\n  outputMode?: 'last_message' | 'all_messages' | 'structured_output'\n\n  /** JSON schema for structured output (when outputMode is 'structured_output') */\n  outputSchema?: JsonSchema\n\n  // ============================================================================\n  // Prompts\n  // ============================================================================\n\n  /** Prompt for when to spawn this agent as a subagent. Include the main purpose and use cases.\n   *\n   * This field is key if the agent is a subagent and intended to be spawned. */\n  parentPrompt?: string\n\n  /** Background information for the agent. Fairly optional. Prefer using instructionsPrompt for agent instructions. */\n  systemPrompt?: string\n\n  /** Instructions for the agent.\n   *\n   * IMPORTANT: Updating this prompt is the best way to shape the agent's behavior.\n   * This prompt is inserted after each user input. */\n  instructionsPrompt?: string\n\n  /** Prompt inserted at each agent step.\n   *\n   * Powerful for changing the agent's behavior, but usually not necessary for smart models.\n   * Prefer instructionsPrompt for most instructions. */\n  stepPrompt?: string\n\n  // ============================================================================\n  // Handle Steps\n  // ============================================================================\n\n  /** Programmatically step the agent forward and run tools.\n   *\n   * You can either yield:\n   * - A tool call object with toolName and args properties.\n   * - 'STEP' to run agent's model and generate one assistant message.\n   * - 'STEP_ALL' to run the agent's model until it uses the end_turn tool or stops includes no tool calls in a message.\n   *\n   * Or use 'return' to end the turn.\n   *\n   * Example 1:\n   * function* handleSteps({ agentStep, prompt, params}) {\n   *   const { toolResult } = yield {\n   *     toolName: 'read_files',\n   *     args: { paths: ['file1.txt', 'file2.txt'] }\n   *   }\n   *   yield 'STEP_ALL'\n   * }\n   *\n   * Example 2:\n   * handleSteps: function* ({ agentState, prompt, params }) {\n   *   while (true) {\n   *     yield {\n   *       toolName: 'spawn_agents',\n   *       args: {\n   *         agents: [\n   *         {\n   *           agent_type: 'thinker',\n   *           prompt: 'Think deeply about the user request',\n   *         },\n   *       ],\n   *     },\n   *   }\n   *   yield 'STEP'\n   * }\n   * }\n   */\n  handleSteps?: (\n    context: AgentStepContext,\n  ) => Generator<\n    ToolCall | 'STEP' | 'STEP_ALL',\n    void,\n    { agentState: AgentState; toolResult: string | undefined }\n  >\n}\n\n// ============================================================================\n// Supporting Types\n// ============================================================================\n\nexport interface AgentState {\n  agentId: string\n  parentId: string\n  messageHistory: Message[]\n}\n\n/**\n * Message in conversation history\n */\nexport interface Message {\n  role: 'user' | 'assistant'\n  content: string\n}\n\n/**\n * Context provided to handleSteps generator function\n */\nexport interface AgentStepContext {\n  agentState: AgentState\n  prompt?: string\n  params?: Record<string, any>\n}\n\n/**\n * Tool call object for handleSteps generator\n */\nexport type ToolCall<T extends ToolName = ToolName> = {\n  [K in T]: {\n    toolName: K\n    args?: Tools.GetToolParams<K>\n  }\n}[T]\n\n/**\n * JSON Schema definition (for prompt schema or output schema)\n */\nexport interface JsonSchema {\n  type: string\n  properties?: Record<string, any>\n  required?: string[]\n  [key: string]: any\n}\n\n// ============================================================================\n// Available Tools\n// ============================================================================\n\n/**\n * File operation tools\n */\nexport type FileTools =\n  | 'read_files'\n  | 'write_file'\n  | 'str_replace'\n  | 'find_files'\n\n/**\n * Code analysis tools\n */\nexport type CodeAnalysisTools = 'code_search' | 'find_files'\n\n/**\n * Terminal and system tools\n */\nexport type TerminalTools = 'run_terminal_command' | 'run_file_change_hooks'\n\n/**\n * Web and browser tools\n */\nexport type WebTools = 'browser_logs' | 'web_search' | 'read_docs'\n\n/**\n * Agent management tools\n */\nexport type AgentTools =\n  | 'spawn_agents'\n  | 'spawn_agents_async'\n  | 'send_agent_message'\n  | 'set_messages'\n  | 'add_message'\n\n/**\n * Planning and organization tools\n */\nexport type PlanningTools =\n  | 'think_deeply'\n  | 'create_plan'\n  | 'add_subgoal'\n  | 'update_subgoal'\n\n/**\n * Output and control tools\n */\nexport type OutputTools = 'set_output' | 'end_turn'\n\n/**\n * Common tool combinations for convenience\n */\nexport type FileEditingTools = FileTools | 'end_turn'\nexport type ResearchTools = WebTools | 'write_file' | 'end_turn'\nexport type CodeAnalysisToolSet = FileTools | CodeAnalysisTools | 'end_turn'\n\n// ============================================================================\n// Available Models (see: https://openrouter.ai/models)\n// ============================================================================\n\n/**\n * AI models available for agents. Pick from our selection of recommended models or choose any model in OpenRouter.\n *\n * See available models at https://openrouter.ai/models\n */\nexport type ModelName =\n  // Recommended Models\n\n  // OpenAI\n  | 'openai/gpt-5'\n  | 'openai/gpt-5-mini'\n  | 'openai/gpt-5-nano'\n\n  // Anthropic\n  | 'anthropic/claude-4-sonnet-20250522'\n  | 'anthropic/claude-opus-4.1'\n\n  // Gemini\n  | 'google/gemini-2.5-pro'\n  | 'google/gemini-2.5-flash'\n  | 'google/gemini-2.5-flash-lite'\n\n  // X-AI\n  | 'x-ai/grok-4-07-09'\n\n  // Qwen\n  | 'qwen/qwen3-coder'\n  | 'qwen/qwen3-coder:fast'\n  | 'qwen/qwen3-235b-a22b-2507'\n  | 'qwen/qwen3-235b-a22b-2507:fast'\n  | 'qwen/qwen3-235b-a22b-thinking-2507'\n  | 'qwen/qwen3-235b-a22b-thinking-2507:fast'\n  | 'qwen/qwen3-30b-a3b'\n  | 'qwen/qwen3-30b-a3b:fast'\n\n  // DeepSeek\n  | 'deepseek/deepseek-chat-v3-0324'\n  | 'deepseek/deepseek-chat-v3-0324:fast'\n  | 'deepseek/deepseek-r1-0528'\n  | 'deepseek/deepseek-r1-0528:fast'\n\n  // Other open source models\n  | 'moonshotai/kimi-k2'\n  | 'moonshotai/kimi-k2:fast'\n  | 'z-ai/glm-4.5'\n  | 'z-ai/glm-4.5:fast'\n  | (string & {})\n\nimport type * as Tools from './tools'\nexport type { Tools }\ntype ToolName = Tools.ToolName\n",
              "referencedBy": {}
            }
          ]
        }
      ]
    },
    {
      "type": "tool_result",
      "toolCallId": "D-WDhRCoKc0",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": "common/src/tools/utils.ts",
              "content": "import {\n  endsAgentStepParam,\n  endToolTag,\n  startToolTag,\n  toolNameParam,\n} from './constants'\nimport { llmToolCallSchema } from './list'\nimport { closeXml } from '../util/xml'\n\nimport type { StringToolResultPart, ToolName } from './constants'\nimport type z from 'zod/v4'\n\nexport function getToolCallString<T extends ToolName | (string & {})>(\n  toolName: T,\n  params: T extends ToolName\n    ? z.input<(typeof llmToolCallSchema)[T]['parameters']>\n    : Record<string, any>,\n  ...endsAgentStep: T extends ToolName ? [] : [boolean]\n): string {\n  const endsAgentStepValue =\n    toolName in llmToolCallSchema\n      ? llmToolCallSchema[toolName as keyof typeof llmToolCallSchema]\n          .endsAgentStep\n      : endsAgentStep[0]\n  const obj: Record<string, any> = {\n    [toolNameParam]: toolName,\n    ...params,\n  }\n  if (endsAgentStepValue) {\n    obj[endsAgentStepParam] = endsAgentStepValue satisfies true\n  }\n  return [startToolTag, JSON.stringify(obj, null, 2), endToolTag].join('')\n}\n\nexport function renderToolResults(toolResults: StringToolResultPart[]): string {\n  if (toolResults.length === 0) {\n    return ''\n  }\n\n  return `\n${toolResults\n  .map(\n    (result) => `<tool_result>\n<tool>${result.toolName}${closeXml('tool')}\n<result>${result.result}${closeXml('result')}\n${closeXml('tool_result')}`,\n  )\n  .join('\\n\\n')}\n`.trim()\n}\n",
              "referencedBy": {}
            },
            {
              "path": "sdk/scripts/publish.js",
              "content": "#!/usr/bin/env node\n\nimport { execSync } from 'child_process'\nimport fs from 'fs'\nimport path from 'path'\nimport { fileURLToPath } from 'url'\n\nconst __filename = fileURLToPath(import.meta.url)\nconst __dirname = path.dirname(__filename)\n\nfunction log(message) {\n  console.log(` ${message}`)\n}\n\nfunction run(command, options = {}) {\n  log(`Running: ${command}`)\n  try {\n    return execSync(command, { stdio: 'inherit', ...options })\n  } catch (error) {\n    console.error(` Command failed: ${command}`)\n    process.exit(1)\n  }\n}\n\nfunction main() {\n  const args = process.argv.slice(2)\n  const isDryRun = args.includes('--dry-run')\n\n  log('Starting SDK publishing process...')\n\n  // Clean and build\n  log('Cleaning previous build...')\n  run('bun run clean')\n\n  log('Building TypeScript...')\n  run('bun run build')\n\n  // Verify the package\n  log('Verifying package contents...')\n  run('npm pack --dry-run')\n\n  if (isDryRun) {\n    log('Dry run complete! Package is ready for publishing.')\n    log('To publish for real, run: bun run publish-sdk')\n    return\n  }\n\n  // Publish\n  log('Publishing to npm...')\n  const packageJson = JSON.parse(fs.readFileSync('package.json', 'utf8'))\n  run('npm publish')\n  log(' SDK published successfully!')\n  log(` Package: ${packageJson.name}@${packageJson.version}`)\n}\n\nif (import.meta.url === `file://${process.argv[1]}`) {\n  main()\n}\n",
              "referencedBy": {}
            }
          ]
        }
      ]
    },
    {
      "type": "subagent_start",
      "agentId": "D-WFdRpUJVk",
      "agentType": "code-searcher",
      "displayName": "Code Searcher",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "searchQueries": [
          {
            "pattern": "ToolName|PublicTool|ApprovedTool",
            "flags": "-g *.ts"
          },
          {
            "pattern": "generate-tool-definitions|compile-tool-definitions",
            "flags": ""
          }
        ]
      }
    },
    {
      "type": "tool_call",
      "toolCallId": "49e9d1e4-63a7-468f-9c5e-cf4788c64589",
      "toolName": "code_search",
      "input": {
        "pattern": "ToolName|PublicTool|ApprovedTool",
        "flags": "-g *.ts"
      },
      "agentId": "D-WFdRpUJVk",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "49e9d1e4-63a7-468f-9c5e-cf4788c64589",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": ".agents/types/agent-definition.d.ts:\n8: *   import { AgentDefinition, ToolName, ModelName } from './types/agent-definition'\n42:  toolNames?: ToolName[]\n191:export type ToolCall<T extends ToolName = ToolName> = {\n321:type ToolName = Tools.ToolName\n\n.agents/types/tools.d.ts:\n4:export type ToolName =\n284:export type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n\n./npm-app/src/utils/tool-renderers.ts:\n9:import type { ToolName } from '@levelcode/common/tools/constants'\n110:export const toolRenderers: Record<ToolName, ToolCallRenderer> = {\n\n./common/src/util/types/agent-definition.d.ts:\n8: *   import { AgentDefinition, ToolName, ModelName } from './types/agent-definition'\n42:  toolNames?: ToolName[]\n191:export type ToolCall<T extends ToolName = ToolName> = {\n321:type ToolName = Tools.ToolName\n\n./common/src/util/types/tools.d.ts:\n4:export type ToolName =\n284:export type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n\n./sdk/src/client.ts:\n19:type ClientToolName = 'write_file' | 'run_terminal_command'\n28:      ClientToolName,\n223:      let override = this.overrideTools[toolName as ClientToolName]\n\n./common/src/types/dynamic-agent-template.ts:\n106:        const validToolNames = toolNames as readonly string[]\n108:          (tool) => !validToolNames.includes(tool),\n114:        const validToolNames = toolNames as readonly string[]\n116:          (tool) => !validToolNames.includes(tool),\n\n./sdk/src/types/tools.ts:\n4:export type ToolName =\n284:export type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n\n./sdk/src/types/agent-definition.ts:\n8: *   import { AgentDefinition, ToolName, ModelName } from './types/agent-definition'\n42:  toolNames?: ToolName[]\n191:export type ToolCall<T extends ToolName = ToolName> = {\n321:type ToolName = Tools.ToolName\n\n./common/src/types/agent-template.ts:\n3:import type { ToolName } from '../tools/constants'\n15:  toolNames: ToolName[]\n\n./common/src/tools/list.ts:\n23:import type { ToolName, ToolParams } from './constants'\n48:  [K in ToolName]: ToolParams<K>\n91:} as const satisfies Record<ToolName, string[]>\n\n./common/src/tools/utils.ts:\n10:import type { StringToolResultPart, ToolName } from './constants'\n13:export function getToolCallString<T extends ToolName | (string & {})>(\n15:  params: T extends ToolName\n18:  ...endsAgentStep: T extends ToolName ? [] : [boolean]\n\n./common/src/tools/compile-tool-definitions.ts:\n42:export type ToolName = ${toolUnion}\n56:export type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n\n./common/src/tools/constants.ts:\n37:export type ToolName = (typeof toolNames)[number]\n39:export type ToolParams<T extends ToolName = ToolName> = {\n\n./backend/src/tools/tool-executor.ts:\n16:import type { ToolName } from '@levelcode/common/tools/constants'\n28:export function parseRawToolCall<T extends ToolName = ToolName>(\n95:export interface ExecuteToolCallParams<T extends ToolName = ToolName> {\n114:export function executeToolCall<T extends ToolName>({\n\n./backend/src/templates/types.ts:\n3:import type { ToolName } from '@levelcode/common/tools/constants'\n41:export const baseAgentToolNames: ToolName[] = [\n\n./backend/src/tools/handlers/list.ts:\n24:import type { ToolName } from '@levelcode/common/tools/constants'\n58:  [K in ToolName]: LevelCodeToolHandlerFunction<K>\n\n./backend/src/templates/agents/thinking-base.ts:\n9:import { baseAgentSubagents, baseAgentToolNames } from '../types'\n26:  toolNames: baseAgentToolNames,\n\n./backend/src/templates/strings.ts:\n22:import type { ToolName } from '@levelcode/common/tools/constants'\n33:  tools: ToolName[],\n\n./backend/src/templates/agents/agent-builder.ts:\n14:import type { ToolName } from '@levelcode/common/tools/constants'\n121:    ] satisfies ToolName[],\n\n./backend/src/tools/handlers/handler-function-type.ts:\n2:import type { ToolName } from '@levelcode/common/tools/constants'\n9:export type LevelCodeToolHandlerFunction<T extends ToolName = ToolName> = (\n\n./backend/src/tools/definitions/tool-def-type.ts:\n1:import type { ToolName } from '@levelcode/common/tools/constants'\n3:export type ToolDescription<T extends ToolName = ToolName> = {\n\n./backend/src/tools/stream-parser.ts:\n12:import type { ToolName } from '@levelcode/common/tools/constants'\n98:  function toolCallback<T extends ToolName>(toolName: T) {\n\n./backend/src/tools/definitions/list.ts:\n26:import type { ToolName } from '@levelcode/common/tools/constants'\n52:  [K in ToolName]: ToolDescription<K>\n55:export type ToolDefinition<T extends ToolName = ToolName> = {\n56:  [K in ToolName]: (typeof toolDescriptions)[K] & (typeof llmToolCallSchema)[K]\n63:      ...toolDescriptions[toolName as ToolName],\n64:      ...llmToolCallSchema[toolName as ToolName],\n67:) as { [K in ToolName]: ToolDefinition<K> } satisfies ToolSet\n\n./backend/src/tools/constants.ts:\n5:import type { ToolName } from '@levelcode/common/tools/constants'\n12:export type LevelCodeToolCall<T extends ToolName = ToolName> = {\n13:  [K in ToolName]: {\n20:export type ClientToolCall<T extends ToolName = ToolName> = {\n21:  [K in ToolName]: {\n\n./backend/src/tools/prompts.ts:\n8:import type { ToolName } from '@levelcode/common/tools/constants'\n69:export const getToolsInstructions = (toolNames: readonly ToolName[]) =>\n138:export const getShortToolInstructions = (toolNames: readonly ToolName[]) => {",
            "message": "Exit code: 0"
          }
        }
      ],
      "parentAgentId": "D-WFdRpUJVk"
    },
    {
      "type": "tool_call",
      "toolCallId": "2c05c647-9640-4de4-9ba9-1ce8c19822fa",
      "toolName": "code_search",
      "input": {
        "pattern": "generate-tool-definitions|compile-tool-definitions",
        "flags": ""
      },
      "agentId": "D-WFdRpUJVk",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "2c05c647-9640-4de4-9ba9-1ce8c19822fa",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": "./package.json:\n37:    \"generate-tool-definitions\": \"bun scripts/generate-tool-definitions.ts\"\n\n./scripts/generate-tool-definitions.ts:\n7:import { compileToolDefinitions } from '@levelcode/common/tools/compile-tool-definitions'\n\n./levelcode.json:\n64:      \"name\": \"regenerate-tool-definitions\",\n65:      \"command\": \"bun run generate-tool-definitions\",",
            "message": "Exit code: 0"
          }
        }
      ],
      "parentAgentId": "D-WFdRpUJVk"
    },
    {
      "type": "tool_call",
      "toolCallId": "3071352d-301d-4d65-a79a-7407f56beee8",
      "toolName": "set_output",
      "input": {
        "results": [
          {
            "stdout": ".agents/types/agent-definition.d.ts:\n8: *   import { AgentDefinition, ToolName, ModelName } from './types/agent-definition'\n42:  toolNames?: ToolName[]\n191:export type ToolCall<T extends ToolName = ToolName> = {\n321:type ToolName = Tools.ToolName\n\n.agents/types/tools.d.ts:\n4:export type ToolName =\n284:export type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n\n./npm-app/src/utils/tool-renderers.ts:\n9:import type { ToolName } from '@levelcode/common/tools/constants'\n110:export const toolRenderers: Record<ToolName, ToolCallRenderer> = {\n\n./common/src/util/types/agent-definition.d.ts:\n8: *   import { AgentDefinition, ToolName, ModelName } from './types/agent-definition'\n42:  toolNames?: ToolName[]\n191:export type ToolCall<T extends ToolName = ToolName> = {\n321:type ToolName = Tools.ToolName\n\n./common/src/util/types/tools.d.ts:\n4:export type ToolName =\n284:export type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n\n./sdk/src/client.ts:\n19:type ClientToolName = 'write_file' | 'run_terminal_command'\n28:      ClientToolName,\n223:      let override = this.overrideTools[toolName as ClientToolName]\n\n./common/src/types/dynamic-agent-template.ts:\n106:        const validToolNames = toolNames as readonly string[]\n108:          (tool) => !validToolNames.includes(tool),\n114:        const validToolNames = toolNames as readonly string[]\n116:          (tool) => !validToolNames.includes(tool),\n\n./sdk/src/types/tools.ts:\n4:export type ToolName =\n284:export type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n\n./sdk/src/types/agent-definition.ts:\n8: *   import { AgentDefinition, ToolName, ModelName } from './types/agent-definition'\n42:  toolNames?: ToolName[]\n191:export type ToolCall<T extends ToolName = ToolName> = {\n321:type ToolName = Tools.ToolName\n\n./common/src/types/agent-template.ts:\n3:import type { ToolName } from '../tools/constants'\n15:  toolNames: ToolName[]\n\n./common/src/tools/list.ts:\n23:import type { ToolName, ToolParams } from './constants'\n48:  [K in ToolName]: ToolParams<K>\n91:} as const satisfies Record<ToolName, string[]>\n\n./common/src/tools/utils.ts:\n10:import type { StringToolResultPart, ToolName } from './constants'\n13:export function getToolCallString<T extends ToolName | (string & {})>(\n15:  params: T extends ToolName\n18:  ...endsAgentStep: T extends ToolName ? [] : [boolean]\n\n./common/src/tools/compile-tool-definitions.ts:\n42:export type ToolName = ${toolUnion}\n56:export type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n\n./common/src/tools/constants.ts:\n37:export type ToolName = (typeof toolNames)[number]\n39:export type ToolParams<T extends ToolName = ToolName> = {\n\n./backend/src/tools/tool-executor.ts:\n16:import type { ToolName } from '@levelcode/common/tools/constants'\n28:export function parseRawToolCall<T extends ToolName = ToolName>(\n95:export interface ExecuteToolCallParams<T extends ToolName = ToolName> {\n114:export function executeToolCall<T extends ToolName>({\n\n./backend/src/templates/types.ts:\n3:import type { ToolName } from '@levelcode/common/tools/constants'\n41:export const baseAgentToolNames: ToolName[] = [\n\n./backend/src/tools/handlers/list.ts:\n24:import type { ToolName } from '@levelcode/common/tools/constants'\n58:  [K in ToolName]: LevelCodeToolHandlerFunction<K>\n\n./backend/src/templates/agents/thinking-base.ts:\n9:import { baseAgentSubagents, baseAgentToolNames } from '../types'\n26:  toolNames: baseAgentToolNames,\n\n./backend/src/templates/strings.ts:\n22:import type { ToolName } from '@levelcode/common/tools/constants'\n33:  tools: ToolName[],\n\n./backend/src/templates/agents/agent-builder.ts:\n14:import type { ToolName } from '@levelcode/common/tools/constants'\n121:    ] satisfies ToolName[],\n\n./backend/src/tools/handlers/handler-function-type.ts:\n2:import type { ToolName } from '@levelcode/common/tools/constants'\n9:export type LevelCodeToolHandlerFunction<T extends ToolName = ToolName> = (\n\n./backend/src/tools/definitions/tool-def-type.ts:\n1:import type { ToolName } from '@levelcode/common/tools/constants'\n3:export type ToolDescription<T extends ToolName = ToolName> = {\n\n./backend/src/tools/stream-parser.ts:\n12:import type { ToolName } from '@levelcode/common/tools/constants'\n98:  function toolCallback<T extends ToolName>(toolName: T) {\n\n./backend/src/tools/definitions/list.ts:\n26:import type { ToolName } from '@levelcode/common/tools/constants'\n52:  [K in ToolName]: ToolDescription<K>\n55:export type ToolDefinition<T extends ToolName = ToolName> = {\n56:  [K in ToolName]: (typeof toolDescriptions)[K] & (typeof llmToolCallSchema)[K]\n63:      ...toolDescriptions[toolName as ToolName],\n64:      ...llmToolCallSchema[toolName as ToolName],\n67:) as { [K in ToolName]: ToolDefinition<K> } satisfies ToolSet\n\n./backend/src/tools/constants.ts:\n5:import type { ToolName } from '@levelcode/common/tools/constants'\n12:export type LevelCodeToolCall<T extends ToolName = ToolName> = {\n13:  [K in ToolName]: {\n20:export type ClientToolCall<T extends ToolName = ToolName> = {\n21:  [K in ToolName]: {\n\n./backend/src/tools/prompts.ts:\n8:import type { ToolName } from '@levelcode/common/tools/constants'\n69:export const getToolsInstructions = (toolNames: readonly ToolName[]) =>\n138:export const getShortToolInstructions = (toolNames: readonly ToolName[]) => {",
            "message": "Exit code: 0"
          },
          {
            "stdout": "./package.json:\n37:    \"generate-tool-definitions\": \"bun scripts/generate-tool-definitions.ts\"\n\n./scripts/generate-tool-definitions.ts:\n7:import { compileToolDefinitions } from '@levelcode/common/tools/compile-tool-definitions'\n\n./levelcode.json:\n64:      \"name\": \"regenerate-tool-definitions\",\n65:      \"command\": \"bun run generate-tool-definitions\",",
            "message": "Exit code: 0"
          }
        ]
      },
      "agentId": "D-WFdRpUJVk",
      "parentAgentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "3071352d-301d-4d65-a79a-7407f56beee8",
      "toolName": "set_output",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Output set"
          }
        }
      ],
      "parentAgentId": "D-WFdRpUJVk"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-WFdRpUJVk",
      "agentType": "code-searcher",
      "displayName": "Code Searcher",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "searchQueries": [
          {
            "pattern": "ToolName|PublicTool|ApprovedTool",
            "flags": "-g *.ts"
          },
          {
            "pattern": "generate-tool-definitions|compile-tool-definitions",
            "flags": ""
          }
        ]
      }
    },
    {
      "type": "tool_result",
      "toolCallId": "D-WFT0P7c6U",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Code Searcher",
              "agentType": "code-searcher",
              "value": {
                "type": "structuredOutput",
                "value": {
                  "results": [
                    {
                      "stdout": ".agents/types/agent-definition.d.ts:\n8: *   import { AgentDefinition, ToolName, ModelName } from './types/agent-definition'\n42:  toolNames?: ToolName[]\n191:export type ToolCall<T extends ToolName = ToolName> = {\n321:type ToolName = Tools.ToolName\n\n.agents/types/tools.d.ts:\n4:export type ToolName =\n284:export type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n\n./npm-app/src/utils/tool-renderers.ts:\n9:import type { ToolName } from '@levelcode/common/tools/constants'\n110:export const toolRenderers: Record<ToolName, ToolCallRenderer> = {\n\n./common/src/util/types/agent-definition.d.ts:\n8: *   import { AgentDefinition, ToolName, ModelName } from './types/agent-definition'\n42:  toolNames?: ToolName[]\n191:export type ToolCall<T extends ToolName = ToolName> = {\n321:type ToolName = Tools.ToolName\n\n./common/src/util/types/tools.d.ts:\n4:export type ToolName =\n284:export type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n\n./sdk/src/client.ts:\n19:type ClientToolName = 'write_file' | 'run_terminal_command'\n28:      ClientToolName,\n223:      let override = this.overrideTools[toolName as ClientToolName]\n\n./common/src/types/dynamic-agent-template.ts:\n106:        const validToolNames = toolNames as readonly string[]\n108:          (tool) => !validToolNames.includes(tool),\n114:        const validToolNames = toolNames as readonly string[]\n116:          (tool) => !validToolNames.includes(tool),\n\n./sdk/src/types/tools.ts:\n4:export type ToolName =\n284:export type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n\n./sdk/src/types/agent-definition.ts:\n8: *   import { AgentDefinition, ToolName, ModelName } from './types/agent-definition'\n42:  toolNames?: ToolName[]\n191:export type ToolCall<T extends ToolName = ToolName> = {\n321:type ToolName = Tools.ToolName\n\n./common/src/types/agent-template.ts:\n3:import type { ToolName } from '../tools/constants'\n15:  toolNames: ToolName[]\n\n./common/src/tools/list.ts:\n23:import type { ToolName, ToolParams } from './constants'\n48:  [K in ToolName]: ToolParams<K>\n91:} as const satisfies Record<ToolName, string[]>\n\n./common/src/tools/utils.ts:\n10:import type { StringToolResultPart, ToolName } from './constants'\n13:export function getToolCallString<T extends ToolName | (string & {})>(\n15:  params: T extends ToolName\n18:  ...endsAgentStep: T extends ToolName ? [] : [boolean]\n\n./common/src/tools/compile-tool-definitions.ts:\n42:export type ToolName = ${toolUnion}\n56:export type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n\n./common/src/tools/constants.ts:\n37:export type ToolName = (typeof toolNames)[number]\n39:export type ToolParams<T extends ToolName = ToolName> = {\n\n./backend/src/tools/tool-executor.ts:\n16:import type { ToolName } from '@levelcode/common/tools/constants'\n28:export function parseRawToolCall<T extends ToolName = ToolName>(\n95:export interface ExecuteToolCallParams<T extends ToolName = ToolName> {\n114:export function executeToolCall<T extends ToolName>({\n\n./backend/src/templates/types.ts:\n3:import type { ToolName } from '@levelcode/common/tools/constants'\n41:export const baseAgentToolNames: ToolName[] = [\n\n./backend/src/tools/handlers/list.ts:\n24:import type { ToolName } from '@levelcode/common/tools/constants'\n58:  [K in ToolName]: LevelCodeToolHandlerFunction<K>\n\n./backend/src/templates/agents/thinking-base.ts:\n9:import { baseAgentSubagents, baseAgentToolNames } from '../types'\n26:  toolNames: baseAgentToolNames,\n\n./backend/src/templates/strings.ts:\n22:import type { ToolName } from '@levelcode/common/tools/constants'\n33:  tools: ToolName[],\n\n./backend/src/templates/agents/agent-builder.ts:\n14:import type { ToolName } from '@levelcode/common/tools/constants'\n121:    ] satisfies ToolName[],\n\n./backend/src/tools/handlers/handler-function-type.ts:\n2:import type { ToolName } from '@levelcode/common/tools/constants'\n9:export type LevelCodeToolHandlerFunction<T extends ToolName = ToolName> = (\n\n./backend/src/tools/definitions/tool-def-type.ts:\n1:import type { ToolName } from '@levelcode/common/tools/constants'\n3:export type ToolDescription<T extends ToolName = ToolName> = {\n\n./backend/src/tools/stream-parser.ts:\n12:import type { ToolName } from '@levelcode/common/tools/constants'\n98:  function toolCallback<T extends ToolName>(toolName: T) {\n\n./backend/src/tools/definitions/list.ts:\n26:import type { ToolName } from '@levelcode/common/tools/constants'\n52:  [K in ToolName]: ToolDescription<K>\n55:export type ToolDefinition<T extends ToolName = ToolName> = {\n56:  [K in ToolName]: (typeof toolDescriptions)[K] & (typeof llmToolCallSchema)[K]\n63:      ...toolDescriptions[toolName as ToolName],\n64:      ...llmToolCallSchema[toolName as ToolName],\n67:) as { [K in ToolName]: ToolDefinition<K> } satisfies ToolSet\n\n./backend/src/tools/constants.ts:\n5:import type { ToolName } from '@levelcode/common/tools/constants'\n12:export type LevelCodeToolCall<T extends ToolName = ToolName> = {\n13:  [K in ToolName]: {\n20:export type ClientToolCall<T extends ToolName = ToolName> = {\n21:  [K in ToolName]: {\n\n./backend/src/tools/prompts.ts:\n8:import type { ToolName } from '@levelcode/common/tools/constants'\n69:export const getToolsInstructions = (toolNames: readonly ToolName[]) =>\n138:export const getShortToolInstructions = (toolNames: readonly ToolName[]) => {",
                      "message": "Exit code: 0"
                    },
                    {
                      "stdout": "./package.json:\n37:    \"generate-tool-definitions\": \"bun scripts/generate-tool-definitions.ts\"\n\n./scripts/generate-tool-definitions.ts:\n7:import { compileToolDefinitions } from '@levelcode/common/tools/compile-tool-definitions'\n\n./levelcode.json:\n64:      \"name\": \"regenerate-tool-definitions\",\n65:      \"command\": \"bun run generate-tool-definitions\",",
                      "message": "Exit code: 0"
                    }
                  ]
                }
              }
            }
          ]
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "66e8c57a-6048-410f-8264-bdf573cb0ac6",
      "toolName": "spawn_agent_inline",
      "input": {
        "agent_type": "context-pruner",
        "params": {}
      },
      "agentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "66e8c57a-6048-410f-8264-bdf573cb0ac6",
      "toolName": "spawn_agent_inline",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Agent spawned."
          }
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "D-X9KE0M3ng",
      "toolName": "read_files",
      "input": {
        "paths": [
          "common/src/util/types/tools.d.ts"
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "D-X9ly-k7n0",
      "toolName": "read_files",
      "input": {
        "paths": [
          "package.json"
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "D-YDkB72XEA",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "code-searcher",
            "params": {
              "searchQueries": [
                {
                  "pattern": "bun\\s+run\\s+typecheck|tsc|bun\\s+check|typecheck",
                  "flags": "-g package.json -g *.json"
                }
              ]
            }
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "D-X9KE0M3ng",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": "common/src/util/types/tools.d.ts",
              "content": "/**\n * Union type of all available tool names\n */\nexport type ToolName =\n  | 'add_message'\n  | 'add_subgoal'\n  | 'browser_logs'\n  | 'code_search'\n  | 'create_plan'\n  | 'end_turn'\n  | 'find_files'\n  | 'read_docs'\n  | 'read_files'\n  | 'run_file_change_hooks'\n  | 'run_terminal_command'\n  | 'set_messages'\n  | 'set_output'\n  | 'spawn_agents'\n  | 'spawn_agents_async'\n  | 'spawn_agent_inline'\n  | 'str_replace'\n  | 'think_deeply'\n  | 'update_subgoal'\n  | 'web_search'\n  | 'write_file'\n\n/**\n * Map of tool names to their parameter types\n */\nexport interface ToolParamsMap {\n  add_message: AddMessageParams\n  add_subgoal: AddSubgoalParams\n  browser_logs: BrowserLogsParams\n  code_search: CodeSearchParams\n  create_plan: CreatePlanParams\n  end_turn: EndTurnParams\n  find_files: FindFilesParams\n  read_docs: ReadDocsParams\n  read_files: ReadFilesParams\n  run_file_change_hooks: RunFileChangeHooksParams\n  run_terminal_command: RunTerminalCommandParams\n  set_messages: SetMessagesParams\n  set_output: SetOutputParams\n  spawn_agents: SpawnAgentsParams\n  spawn_agents_async: SpawnAgentsAsyncParams\n  spawn_agent_inline: SpawnAgentInlineParams\n  str_replace: StrReplaceParams\n  think_deeply: ThinkDeeplyParams\n  update_subgoal: UpdateSubgoalParams\n  web_search: WebSearchParams\n  write_file: WriteFileParams\n}\n\n/**\n * Add a new message to the conversation history. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\n */\nexport interface AddMessageParams {\n  role: 'user' | 'assistant'\n  content: string\n}\n\n/**\n * Add a new subgoal for tracking progress. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\n */\nexport interface AddSubgoalParams {\n  /** A unique identifier for the subgoal. Try to choose the next sequential integer that is not already in use. */\n  id: string\n  /** The objective of the subgoal, concisely and clearly stated. */\n  objective: string\n  /** The status of the subgoal. */\n  status: 'NOT_STARTED' | 'IN_PROGRESS' | 'COMPLETE' | 'ABORTED'\n  /** A plan for the subgoal. */\n  plan?: string\n  /** A log message for the subgoal progress. */\n  log?: string\n}\n\n/**\n * Parameters for browser_logs tool\n */\nexport interface BrowserLogsParams {\n  /** The type of browser action to perform (e.g., \"navigate\"). */\n  type: string\n  /** The URL to navigate to. */\n  url: string\n  /** When to consider navigation successful. Defaults to 'load'. */\n  waitUntil?: 'load' | 'domcontentloaded' | 'networkidle0'\n}\n\n/**\n * Search for string patterns in the project's files. This tool uses ripgrep (rg), a fast line-oriented search tool. Use this tool only when read_files is not sufficient to find the files you need.\n */\nexport interface CodeSearchParams {\n  /** The pattern to search for. */\n  pattern: string\n  /** Optional ripgrep flags to customize the search (e.g., \"-i\" for case-insensitive, \"-t ts\" for TypeScript files only, \"-A 3\" for 3 lines after match, \"-B 2\" for 2 lines before match, \"--type-not test\" to exclude test files). */\n  flags?: string\n  /** Optional working directory to search within, relative to the project root. Defaults to searching the entire project. */\n  cwd?: string\n}\n\n/**\n * Generate a detailed markdown plan for complex tasks.\n */\nexport interface CreatePlanParams {\n  /** The path including the filename of a markdown file that will be overwritten with the plan. */\n  path: string\n  /** A detailed plan to solve the user's request. */\n  plan: string\n}\n\n/**\n * End your turn, regardless of any new tool results that might be coming. This will allow the user to type another prompt.\n */\nexport interface EndTurnParams {}\n\n/**\n * Find several files related to a brief natural language description of the files or the name of a function or class you are looking for.\n */\nexport interface FindFilesParams {\n  /** A brief natural language description of the files or the name of a function or class you are looking for. It's also helpful to mention a directory or two to look within. */\n  prompt: string\n}\n\n/**\n * Fetch up-to-date documentation for libraries and frameworks using Context7 API.\n */\nexport interface ReadDocsParams {\n  /** The exact library or framework name (e.g., \"Next.js\", \"MongoDB\", \"React\"). Use the official name as it appears in documentation, not a search query. */\n  libraryTitle: string\n  /** Optional specific topic to focus on (e.g., \"routing\", \"hooks\", \"authentication\") */\n  topic?: string\n  /** Optional maximum number of tokens to return. Defaults to 10000. Values less than 10000 are automatically increased to 10000. */\n  max_tokens?: number\n}\n\n/**\n * Read the multiple files from disk and return their contents. Use this tool to read as many files as would be helpful to answer the user's request.\n */\nexport interface ReadFilesParams {\n  /** List of file paths to read. */\n  paths: string[]\n}\n\n/**\n * Parameters for run_file_change_hooks tool\n */\nexport interface RunFileChangeHooksParams {\n  /** List of file paths that were changed and should trigger file change hooks */\n  files: string[]\n}\n\n/**\n * Execute a CLI command from the **project root** (different from the user's cwd).\n */\nexport interface RunTerminalCommandParams {\n  /** CLI command valid for user's OS. */\n  command: string\n  /** Either SYNC (waits, returns output) or BACKGROUND (runs in background). Default SYNC */\n  process_type?: 'SYNC' | 'BACKGROUND'\n  /** The working directory to run the command in. Default is the project root. */\n  cwd?: string\n  /** Set to -1 for no timeout. Does not apply for BACKGROUND commands. Default 30 */\n  timeout_seconds?: number\n}\n\n/**\n * Set the conversation history to the provided messages.\n */\nexport interface SetMessagesParams {\n  messages: {\n    role: 'user' | 'assistant'\n    content: string\n  }[]\n}\n\n/**\n * JSON object to set as the agent output. This completely replaces any previous output. If the agent was spawned, this value will be passed back to its parent. If the agent has an outputSchema defined, the output will be validated against it.\n */\nexport interface SetOutputParams {}\n\n/**\n * Spawn multiple agents and send a prompt to each of them.\n */\nexport interface SpawnAgentsParams {\n  agents: {\n    /** Agent to spawn */\n    agent_type: string\n    /** Prompt to send to the agent */\n    prompt?: string\n    /** Parameters object for the agent (if any) */\n    params?: Record<string, any>\n  }[]\n}\n\n/**\n * Parameters for spawn_agents_async tool\n */\nexport interface SpawnAgentsAsyncParams {\n  agents: {\n    /** Agent to spawn */\n    agent_type: string\n    /** Prompt to send to the agent */\n    prompt?: string\n    /** Parameters object for the agent (if any) */\n    params?: Record<string, any>\n  }[]\n}\n\n/**\n * Spawn a single agent that runs within the current message history.\n */\nexport interface SpawnAgentInlineParams {\n  /** Agent to spawn */\n  agent_type: string\n  /** Prompt to send to the agent */\n  prompt?: string\n  /** Parameters object for the agent (if any) */\n  params?: Record<string, any>\n}\n\n/**\n * Replace strings in a file with new strings.\n */\nexport interface StrReplaceParams {\n  /** The path to the file to edit. */\n  path: string\n  /** Array of replacements to make. */\n  replacements: {\n    /** The string to replace. This must be an *exact match* of the string you want to replace, including whitespace and punctuation. */\n    old: string\n    /** The string to replace the corresponding old string with. Can be empty to delete. */\n    new: string\n  }[]\n}\n\n/**\n * Deeply consider complex tasks by brainstorming approaches and tradeoffs step-by-step.\n */\nexport interface ThinkDeeplyParams {\n  /** Detailed step-by-step analysis. Initially keep each step concise (max ~5-7 words per step). */\n  thought: string\n}\n\n/**\n * Update a subgoal in the context given the id, and optionally the status or plan, or a new log to append. Feel free to update any combination of the status, plan, or log in one invocation.\n */\nexport interface UpdateSubgoalParams {\n  /** The id of the subgoal to update. */\n  id: string\n  /** Change the status of the subgoal. */\n  status?: 'NOT_STARTED' | 'IN_PROGRESS' | 'COMPLETE' | 'ABORTED'\n  /** Change the plan for the subgoal. */\n  plan?: string\n  /** Add a log message to the subgoal. This will create a new log entry and append it to the existing logs. Use this to record your progress and any new information you learned as you go. */\n  log?: string\n}\n\n/**\n * Search the web for current information using Linkup API.\n */\nexport interface WebSearchParams {\n  /** The search query to find relevant web content */\n  query: string\n  /** Search depth - 'standard' for quick results, 'deep' for more comprehensive search. Default is 'standard'. */\n  depth: 'standard' | 'deep'\n}\n\n/**\n * Create or edit a file with the given content.\n */\nexport interface WriteFileParams {\n  /** Path to the file relative to the **project root** */\n  path: string\n  /** What the change is intended to do in only one sentence. */\n  instructions: string\n  /** Edit snippet to apply to the file. */\n  content: string\n}\n\n/**\n * Get parameters type for a specific tool\n */\nexport type GetToolParams<T extends ToolName> = ToolParamsMap[T]\n",
              "referencedBy": {}
            }
          ]
        }
      ]
    },
    {
      "type": "tool_result",
      "toolCallId": "D-X9ly-k7n0",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": "package.json",
              "content": "{\n  \"name\": \"levelcode-project\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"license\": \"UNLICENSED\",\n  \"type\": \"module\",\n  \"workspaces\": [\n    \"common\",\n    \"backend\",\n    \"npm-app\",\n    \"web\",\n    \"packages/*\",\n    \"scripts\",\n    \"evals\",\n    \"sdk\"\n  ],\n  \"scripts\": {\n    \"dev\": \"bash scripts/dev.sh\",\n    \"start-db\": \"bun --cwd common db:start\",\n    \"start-bin\": \"bun --cwd npm-app start-bin\",\n    \"start-web\": \"bun start-db && bun --cwd web dev\",\n    \"start-studio\": \"bun --cwd common db:studio\",\n    \"start-server\": \"bun --cwd backend dev\",\n    \"start-manifold\": \"bun --cwd npm-app start-manifold\",\n    \"start-levelcode-test\": \"bun --cwd npm-app start --cwd ../../levelcode-test\",\n    \"start-litestar\": \"bun --cwd npm-app start-litestar\",\n    \"start-jpcsp\": \"bun --cwd npm-app start-jpcsp\",\n    \"start-vscode\": \"bun --cwd npm-app start-vscode\",\n    \"start-nushell\": \"bun --cwd npm-app start-nushell\",\n    \"format\": \"prettier --write \\\"**/*.{ts,tsx,json,md}\\\"\",\n    \"release:npm-app\": \"bun run --cwd npm-app release\",\n    \"clean-ts\": \"find . -name '*.tsbuildinfo' -type f -delete && find . -name '.next' -type d -exec rm -rf {} + 2>/dev/null || true && find . -name 'node_modules' -type d -exec rm -rf {} + 2>/dev/null || true && bun install\",\n    \"typecheck\": \"bun --filter='*' run typecheck && echo ' All type checks passed!'\",\n    \"test\": \"bun --filter='{@levelcode/backend,@levelcode/common,@levelcode/npm-app}' run test\",\n    \"init-worktree\": \"bun scripts/init-worktree.ts\",\n    \"cleanup-worktree\": \"bash scripts/cleanup-worktree.sh\",\n    \"generate-tool-definitions\": \"bun scripts/generate-tool-definitions.ts\"\n  },\n  \"dependencies\": {\n    \"@t3-oss/env-nextjs\": \"^0.7.3\",\n    \"zod\": \"3.25.67\"\n  },\n  \"overrides\": {\n    \"zod\": \"3.25.67\"\n  },\n  \"devDependencies\": {\n    \"@tanstack/react-query\": \"^5.59.16\",\n    \"@types/bun\": \"^1.2.11\",\n    \"@types/lodash\": \"4.17.7\",\n    \"@types/node\": \"^22.9.0\",\n    \"@types/node-fetch\": \"^2.6.12\",\n    \"@types/parse-path\": \"^7.1.0\",\n    \"@typescript-eslint/eslint-plugin\": \"^6.17\",\n    \"bun-types\": \"^1.2.2\",\n    \"eslint-config-prettier\": \"^9.1.0\",\n    \"eslint-plugin-import\": \"^2.29.1\",\n    \"eslint-plugin-unused-imports\": \"^4.1.4\",\n    \"ignore\": \"^6.0.2\",\n    \"lodash\": \"4.17.21\",\n    \"prettier\": \"3.3.2\",\n    \"ts-node\": \"^10.9.2\",\n    \"ts-pattern\": \"^5.5.0\",\n    \"tsc-alias\": \"1.7.0\",\n    \"tsconfig-paths\": \"4.2.0\",\n    \"types\": \"^0.1.1\",\n    \"typescript\": \"5.5.4\",\n    \"typescript-eslint\": \"^7.17.0\"\n  },\n  \"engines\": {\n    \"node\": \">=20.0.0\"\n  },\n  \"packageManager\": \"yarn@1.22.22+sha512.a6b2f7906b721bba3d67d4aff083df04dad64c399707841b7acf00f6b133b7ac24255f2652fa22ae3534329dc6180534e98d17432037ff6fd140556e2bb3137e\"\n}\n",
              "referencedBy": {}
            }
          ]
        }
      ]
    },
    {
      "type": "subagent_start",
      "agentId": "D-YDzDAsNdY",
      "agentType": "code-searcher",
      "displayName": "Code Searcher",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "searchQueries": [
          {
            "pattern": "bun\\s+run\\s+typecheck|tsc|bun\\s+check|typecheck",
            "flags": "-g package.json -g *.json"
          }
        ]
      }
    },
    {
      "type": "tool_call",
      "toolCallId": "fc68cc40-c253-4e5e-a9ab-f74212a80796",
      "toolName": "code_search",
      "input": {
        "pattern": "bun\\s+run\\s+typecheck|tsc|bun\\s+check|typecheck",
        "flags": "-g package.json -g *.json"
      },
      "agentId": "D-YDzDAsNdY",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "fc68cc40-c253-4e5e-a9ab-f74212a80796",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": "./npm-app/package.json:\n22:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./scripts/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./npm-app/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./tsconfig.json:\n2:  \"extends\": \"./tsconfig.base.json\",\n\n./packages/build-tools/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./common/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./scripts/package.json:\n15:    \"typecheck\": \"tsc --noEmit -p .\",\n18:    \"typecheck-all\": \"bun run typecheck-all.ts\"\n\n./packages/billing/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./common/package.json:\n23:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/build-tools/package.json:\n8:    \"build\": \"tsc\",\n9:    \"clean\": \"rm -rf dist && (rm tsconfig.tsbuildinfo || true)\"\n\n./levelcode.json:\n23:      \"name\": \"backend-typecheck\",\n24:      \"command\": \"bun run typecheck\",\n35:      \"name\": \"npm-typecheck\",\n36:      \"command\": \"bun run typecheck\",\n41:      \"name\": \"web-typecheck\",\n42:      \"command\": \"bun run typecheck\",\n53:      \"name\": \"common-typecheck\",\n54:      \"command\": \"bun run typecheck\",\n\n./packages/billing/package.json:\n22:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/build-tools/project.json:\n11:        \"command\": \"tsc\",\n18:        \"command\": \"rm -rf dist && (rm tsconfig.tsbuildinfo || true)\",\n\n./packages/billing/project.json:\n10:        \"command\": \"tsc -p tsconfig.json\",\n\n./sdk/package.json:\n24:    \"build\": \"bun run copy-types && tsc\",\n31:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./package.json:\n33:    \"typecheck\": \"bun --filter='*' run typecheck && echo ' All type checks passed!'\",\n63:    \"tsc-alias\": \"1.7.0\",\n64:    \"tsconfig-paths\": \"4.2.0\",\n\n./packages/bigquery/package.json:\n22:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/bigquery/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./backend/package.json:\n19:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/code-map/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./packages/code-map/package.json:\n22:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./backend/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./evals/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./evals/package.json:\n15:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/internal/package.json:\n34:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/internal/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./web/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n37:    \"require\": [\"tsconfig-paths/register\"]\n\n./web/package.json:\n23:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./evals/git-evals/eval-result-levelcode-mock.json:\n21:            \"preContent\": \"import { spawn } from 'child_process'\\nimport fs from 'fs'\\nimport path from 'path'\\n\\nimport { FileChange } from 'common/actions'\\nimport { models, TEST_USER_ID } from 'common/constants'\\nimport { getToolCallString } from 'common/src/constants/tools'\\nimport { z } from 'zod'\\n\\nimport { promptFlashWithFallbacks } from './llm-apis/gemini-with-fallbacks'\\nimport { gitCommitGuidePrompt } from './system-prompt/prompts'\\n\\nconst tools = [\\n  {\\n    name: 'add_subgoal',\\n    description: `\\n### add_subgoal\\nDescription: Add a new subgoal for tracking progress. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\\nParameters:\\n- id: (required) A unique identifier for the subgoal. Try to choose the next sequential integer that is not already in use.\\n- objective: (required) The objective of the subgoal, concisely and clearly stated.\\n- status: (required) The status of the subgoal. One of [\\\"NOT_STARTED\\\", \\\"IN_PROGRESS\\\", \\\"COMPLETE\\\", \\\"ABORTED\\\"]\\n- plan: (optional) A plan for the subgoal.\\nUsage:\\n${getToolCallString('add_subgoal', {\\n  id: '1',\\n  objective: 'Add a new \\\"deploy api\\\" subgoal',\\n  status: 'IN_PROGRESS',\\n})}\\n    `.trim(),\\n  },\\n  {\\n    name: 'update_subgoal',\\n    description: `\\n### update_subgoal\\nDescription: Update a subgoal in the context given the id, and optionally the status or plan, or a new log to append. Feel free to update any combination of the status, plan, or log in one invocation.\\nParameters:\\n- id: (required) The id of the subgoal to update.\\n- status: (optional) Change the status of the subgoal. One of [\\\"NOT_STARTED\\\", \\\"IN_PROGRESS\\\", \\\"COMPLETE\\\", \\\"FAILED\\\"]\\n- plan: (optional) Change the plan for the subgoal.\\n- log: (optional) Add a log message to the subgoal. This will create a new log entry and append it to the existing logs. Use this to record your progress and any new information you learned as you go.\\nUsage 1 (update status):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  status: 'COMPLETE',\\n})}\\n\\nUsage 2 (update plan):\\n${getToolCallString('update_subgoal', {\\n  id: '3',\\n  plan: 'Create a file for the endpoint in the api, and register it in the router',\\n})}\\n\\nUsage 3 (add log):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  log: \\\"I found the error in the tests, it's in the foo function.\\\",\\n})}\\n\\nUsage 4 (update status and add log):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  status: 'COMPLETE',\\n  log: 'I reran the tests and they passed.',\\n})}\\n    `.trim(),\\n  },\\n  {\\n    name: 'write_file',\\n    description: `\\n### write_file\\nDescription: Create or edit a file with the given content.\\n\\nWhen editing a file, please use this tool to output a simplified version of the code block that highlights the changes necessary and adds comments to indicate where unchanged code has been skipped.\\n\\n--- IMPORTANT OPTIMIZATION DETAIL ---\\nUse \\\"placeholder comments\\\" i.e. \\\"// ... existing code ...\\\" (or \\\"# ... existing code ...\\\" or \\\"/* ... existing code ... */\\\" or \\\"<!-- ... existing code ... -->\\\"  or however comments are written for other languages) in comments as often as you can, signifying unchanged regions of the file.\\nThe write_file tool is very expensive for each line of code you write, so try to write as little \\\\`content\\\\` as possible to accomplish the task. Often this will mean that the start/end of the file will be skipped, but that's okay! Rewrite the entire file only if specifically requested.\\n\\nHowever, for new files, you should write out the entire file and not use placeholder comments.\\n--- IMPORTANT OPTIMIZATION DETAIL ---\\n\\nThese edit codeblocks will be parsed and then read by a less intelligent \\\"apply\\\" language model to update the file. To help specify the edit to the apply model, be very careful to include a few lines of context when generating the codeblock to not introduce ambiguity. Specify all unchanged regions (code and comments) of the file with \\\"// ... existing code ...\\\" markers (in comments). This will ensure the apply model will not delete existing unchanged code or comments when editing the file. This is just an abstraction for your understanding, you should not mention the apply model to the user.\\n\\nDo not use this tool to delete or rename a file. Instead run a terminal command for that.\\n\\nParameters:\\n- path: (required) Path to the file relative to the **project root**\\n- content: (required) Content to write to the file. You should abridge the content of the file using placeholder comments like: \\\\`// ... existing code ...\\\\` or \\\\`# ... existing code ...\\\\` (or whichever is appropriate for the language).\\nUsage:\\n${getToolCallString('write_file', {\\n  path: 'path/to/file',\\n  content: 'Your file content here',\\n})}\\n\\nExample 1 - Simple file creation:\\n${getToolCallString('write_file', {\\n  path: 'new-file.ts',\\n  content: 'console.log(\\\"Hello, world!\\\");',\\n})}\\n\\nExample 2 - Editing with placeholder comments:\\n${getToolCallString('write_file', {\\n  path: 'foo.ts',\\n  content: `// ... existing code ...\\n\\nfunction foo() {\\n  console.log('foo');\\n  for (let i = 0; i < 10; i++) {\\n    console.log(i);\\n  }\\n  doSomething();\\n}\\n\\n// ... existing code ...`,\\n})}\\n\\nNotes for editing a file:\\n- Don't use XML attributes. If you do, the tool will NOT write to the file.\\n- If you don't use any placeholder comments, the entire file will be replaced. E.g. don't write out a single function without using placeholder comments unless you want to replace the entire file with that function.\\n- When editing a file, try not to change any user code that doesn't need to be changed. In particular, you must preserve pre-existing user comments exactly as they are.\\n- You can also use this tool to create new files.\\n- After you have written out a write_file block, the changes will be applied immediately. You can assume that the changes went through as intended. However, note that there are sometimes mistakes in the processs of applying the edits you described in the write_file block, e.g. sometimes large portions of the file are deleted. If you notice that the changes did not go through as intended, based on further updates to the file, you can write out a new write_file block to fix the mistake.\\n- Don't escape characters  write them out directly! E.g. write out '&' instead of '&amp;', '>' instead of '&gt;', '<' instead of '&lt;', and '\\\"' instead of '&quot;' in the content.\\n    `.trim(),\\n  },\\n  {\\n    name: 'read_files',\\n    description: `\\n### read_files\\nDescription: Read the multiple files from disk and return their contents. Use this tool to read as many files as would be helpful to answer the user's request. Make sure to read any files before you write to them with the write_file tool.\\nParameters:\\n- paths: (required) List of file paths to read relative to the **project root**, separated by newlines. Absolute file paths will not work.\\nUsage:\\n${getToolCallString('read_files', {\\n  paths: 'path/to/file1.ts\\\\npath/to/file2.ts',\\n})}\\n\\n\\nNote that there's no need to call this tool if you're already reading the files you need in context.`.trim(),\\n  },\\n  {\\n    name: 'find_files',\\n    description: `\\n### find_files\\nDescription: Find several files related to a brief natural language description of the files or the name of a function or class you are looking for.\\nParameters:\\n- description: (required) A brief natural language description of the files or the name of a function or class you are looking for. It's also helpful to mention a directory or two to look within.\\nUsage:\\n<find_files>\\n<description>The implementation of function foo</description>\\n</find_files>\\n\\nPurpose: Better fulfill the user request by reading files which could contain information relevant to the user's request.\\nUse cases:\\n- If you are calling a function or creating a class and want to know how it works, use this tool to get the implementation.\\n- If you need to understand a section of the codebase, read more files in that directory or subdirectories.\\n- Some requests require a broad understanding of multiple parts of the codebase. Consider using find_files to gain more context before making changes.\\n\\nDon't use this tool if:\\n- You already know the exact path of the file(s) you are looking for  in this case, use read_files.\\n- You already read the files you need in context.\\n\\nIn general, prefer using read_files instead of find_files.\\n      `.trim(),\\n  },\\n  {\\n    name: 'code_search',\\n    description: `\\n### code_search\\nDescription: Search for string patterns in the project's files. This tool uses ripgrep (rg), a fast line-oriented search tool. Use this tool only when read_files is not sufficient to find the files you need.\\nParameters:\\n- pattern: (required) The pattern to search for.\\nUsage:\\n${getToolCallString('code_search', { pattern: 'foo' })}\\n${getToolCallString('code_search', { pattern: 'import.*foo' })}\\n\\nPurpose: Search through code files to find files with specific text patterns, function names, variable names, and more.\\n\\nNote: quotes will be automatically added around your code search pattern. You might need to escape special characters like '-' or '.' or '\\\\\\\\' if you want to search for them.\\n\\nPrefer to use read_files instead of code_search unless you need to search for a specific pattern in multiple files.\\n\\nUse cases:\\n1. Finding all references to a function, class, or variable name across the codebase\\n2. Searching for specific code patterns or implementations\\n3. Looking up where certain strings or text appear\\n4. Finding files that contain specific imports or dependencies\\n5. Locating configuration settings or environment variables\\n\\nThe pattern supports regular expressions and will search recursively through all files in the project by default. Some tips:\\n- Be as constraining in the pattern as possible to limit the number of files returned, e.g. if searching for the definition of a function, use \\\"(function foo|const foo)\\\" or \\\"def foo\\\" instead of merely \\\"foo\\\".\\n- Use word boundaries (\\\\\\\\b) to match whole words only\\n- Searches file content and filenames\\n- Automatically ignores binary files, hidden files, and files in .gitignore\\n- Case-sensitive by default. Use -i to make it case insensitive.\\n- Constrain the search to specific file types using -t <file-type>, e.g. -t ts or -t py.\\n    `.trim(),\\n  },\\n  {\\n    name: 'run_terminal_command',\\n    description: `\\n### run_terminal_command\\nDescription: Request to execute a CLI command on the system. Use this when you need to perform system operations or run specific commands to accomplish any step in the user's task. You must tailor your command to the user's system and provide a clear explanation of what the command does. For command chaining, use the appropriate chaining syntax for the user's shell. Prefer to execute complex CLI commands over creating executable scripts, as they are more flexible and easier to run. Commands will be executed in the current working directory: ${process.cwd()}\\nParameters:\\n- command: (required) The CLI command to execute. This should be valid for the current operating system. Ensure the command is properly formatted and does not contain any harmful instructions.\\n- process_type: (required) What type of process to run. One of SYNC or BACKGROUND.\\n  - SYNC: the command will be run in (and block) the current process. This is required if the output of the command is needed immediately. Most commands will be run in this way. Do not try to run processes in the background with process_type=SYNC and using & at the end of the command. Instead, use the process_type=BACKGROUND option.\\n  - BACKGROUND: the command will be run in a child background process. This is for running servers or other long-running processes.\\nUsage:\\n${getToolCallString('run_terminal_command', {\\n  command: 'Your command here',\\n  process_type: 'value',\\n})}\\n\\nStick to these use cases:\\n1. Compiling the project or running build (e.g., \\\"npm run build\\\"). Reading the output can help you edit code to fix build errors. If possible, use an option that performs checks but doesn't emit files, e.g. \\\\`tsc --noEmit\\\\`.\\n2. Running tests (e.g., \\\"npm test\\\"). Reading the output can help you edit code to fix failing tests. Or, you could write new unit tests and then run them.\\n3. Moving, renaming, or deleting files and directories. These actions can be vital for refactoring requests. Use commands like \\\\`mv\\\\`/\\\\`move\\\\` or \\\\`rm\\\\`/\\\\`del\\\\`.\\n\\nMost likely, you should ask for permission for any other type of command you want to run. If asking for permission, show the user the command you want to run using \\\\`\\\\`\\\\` tags.\\n\\nWhen using this tool, please adhere to the following rules:\\n\\n1. Do not run commands that can modify files outside of the project directory, install packages globally, install virtual environments, or have significant side effects outside of the project directory, unless you have explicit permission from the user. Treat anything outside of the project directory as read-only.\\n2. Do not run \\\\`git push\\\\` because it can break production (!) if the user was not expecting it. Don't run \\\\`git commit\\\\`, \\\\`git rebase\\\\`, or related commands unless you get explicit permission. If a user asks to commit changes, you can do so, but you should not invoke any further git commands beyond the git commit command.\\n3. Do not run scripts without asking. Especially don't run scripts that could run against the production environment or have permanent effects without explicit permission from the user. Don't run scripts with side effects without permission from the user unless they don't have much effect or are simple.\\n4. Be careful with any command that has big or irreversible effects. Anything that touches a production environment, servers, the database, or other systems that could be affected by a command should be run with explicit permission from the user.\\n4. Don't run too many commands in a row without pausing to check in with what the user wants to do next.\\n5. Do not use the run_terminal_command tool to create or edit files. Do not use \\\\`cat\\\\` or \\\\`echo\\\\` to create or edit files. You should instead write out <write_file> blocks for for editing or creating files as detailed above in the <editing_instructions> block.\\n6. Do not install packages without asking, unless it is within a small, new-ish project. Users working on a larger project will want to manage packages themselves, so ask first.\\n7. Do not use the wrong package manager for the project. For example, if the project uses \\\\`pnpm\\\\` or \\\\`bun\\\\` or \\\\`yarn\\\\`, you should not use \\\\`npm\\\\`. Similarly not everyone uses \\\\`pip\\\\` for python, etc.\\n8. You must write out ampersands without escaping them. E.g. write out '&' instead of '&amp;'.\\nIncorrect:\\n\\\\`cd backend &amp;&amp; npm typecheck\\\\` \\nCorrect:\\n\\\\`cd backend && npm typecheck\\\\`\\n10. Do not use more than one run_terminal_command tool call in a single response. Wait for the tool results of each command before invoking the next one.\\n11. The user will not be able to interact with these processes, e.g. confirming the command. So if there's an opportunity to use \\\"-y\\\" or \\\"--yes\\\" flags, use them. Any command that prompts for confirmation will hang if you don't use the flags.\\n\\nNotes:\\n- The current working directory will always reset to **project root** directory for each command you run. You can only access files within this directory (or sub-directories). So if you run cd in one command, the directory change won't persist to the next command.\\n  - \\\\`cd subdir && some_command\\\\` will work as expected.\\n  - \\\\`cd subdir\\\\` in followed by \\\\`some_command\\\\` in two different commands will run some_command from the project root.\\n- Commands can succeed without giving any output, e.g. if no type errors were found. So you may not always see output for successful executions.\\n\\n${gitCommitGuidePrompt}\\n    `.trim(),\\n  },\\n  {\\n    name: 'think_deeply',\\n    description: `\\n### think_deeply\\nDescription: Think through a complex change to the codebase, like implementing a new feature or refactoring some code. Brainstorm. Go deep on alternative approaches and consider the tradeoffs.\\nParameters: thought: (required) Your detailed thoughts.\\nUsage:\\n${getToolCallString('think_deeply', {\\n  thought: '[Insert detailed thoughts here]',\\n})}\\n\\nThink step by step. For the first section of your thinking, only keep a minimum draft for each thinking step, with 5 words at most.\\n\\nUse this tool when the user request meets multiple of these criteria:\\n- Explicitly asks you to plan or think through something.\\n- Always use this tool right before using the create_plan tool.\\n- Requires changes across multiple files or systems\\n- Involves complex logic or architectural decisions\\n- Would benefit from breaking down into smaller steps\\n- Has potential edge cases or risks that need consideration\\n\\nExamples of when to use it:\\n- Adding a new feature that touches multiple parts of the system\\n- Refactoring core functionality used by many components\\n- Making architectural changes that affect the system design\\n- Implementing complex business logic with many edge cases\\n\\nDo not use it for simple changes like:\\n- Adding a single function or endpoint\\n- Updating text or styles\\n   \n\n[Output truncated]\n\n[Output size limit reached.]",
            "message": "Stopped early after 43 match(es)."
          }
        }
      ],
      "parentAgentId": "D-YDzDAsNdY"
    },
    {
      "type": "tool_call",
      "toolCallId": "24de81f4-e433-4ebd-ba6f-01bc1a46c2e2",
      "toolName": "set_output",
      "input": {
        "results": [
          {
            "stdout": "./npm-app/package.json:\n22:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./scripts/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./npm-app/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./tsconfig.json:\n2:  \"extends\": \"./tsconfig.base.json\",\n\n./packages/build-tools/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./common/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./scripts/package.json:\n15:    \"typecheck\": \"tsc --noEmit -p .\",\n18:    \"typecheck-all\": \"bun run typecheck-all.ts\"\n\n./packages/billing/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./common/package.json:\n23:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/build-tools/package.json:\n8:    \"build\": \"tsc\",\n9:    \"clean\": \"rm -rf dist && (rm tsconfig.tsbuildinfo || true)\"\n\n./levelcode.json:\n23:      \"name\": \"backend-typecheck\",\n24:      \"command\": \"bun run typecheck\",\n35:      \"name\": \"npm-typecheck\",\n36:      \"command\": \"bun run typecheck\",\n41:      \"name\": \"web-typecheck\",\n42:      \"command\": \"bun run typecheck\",\n53:      \"name\": \"common-typecheck\",\n54:      \"command\": \"bun run typecheck\",\n\n./packages/billing/package.json:\n22:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/build-tools/project.json:\n11:        \"command\": \"tsc\",\n18:        \"command\": \"rm -rf dist && (rm tsconfig.tsbuildinfo || true)\",\n\n./packages/billing/project.json:\n10:        \"command\": \"tsc -p tsconfig.json\",\n\n./sdk/package.json:\n24:    \"build\": \"bun run copy-types && tsc\",\n31:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./package.json:\n33:    \"typecheck\": \"bun --filter='*' run typecheck && echo ' All type checks passed!'\",\n63:    \"tsc-alias\": \"1.7.0\",\n64:    \"tsconfig-paths\": \"4.2.0\",\n\n./packages/bigquery/package.json:\n22:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/bigquery/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./backend/package.json:\n19:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/code-map/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./packages/code-map/package.json:\n22:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./backend/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./evals/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./evals/package.json:\n15:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/internal/package.json:\n34:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/internal/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./web/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n37:    \"require\": [\"tsconfig-paths/register\"]\n\n./web/package.json:\n23:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./evals/git-evals/eval-result-levelcode-mock.json:\n21:            \"preContent\": \"import { spawn } from 'child_process'\\nimport fs from 'fs'\\nimport path from 'path'\\n\\nimport { FileChange } from 'common/actions'\\nimport { models, TEST_USER_ID } from 'common/constants'\\nimport { getToolCallString } from 'common/src/constants/tools'\\nimport { z } from 'zod'\\n\\nimport { promptFlashWithFallbacks } from './llm-apis/gemini-with-fallbacks'\\nimport { gitCommitGuidePrompt } from './system-prompt/prompts'\\n\\nconst tools = [\\n  {\\n    name: 'add_subgoal',\\n    description: `\\n### add_subgoal\\nDescription: Add a new subgoal for tracking progress. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\\nParameters:\\n- id: (required) A unique identifier for the subgoal. Try to choose the next sequential integer that is not already in use.\\n- objective: (required) The objective of the subgoal, concisely and clearly stated.\\n- status: (required) The status of the subgoal. One of [\\\"NOT_STARTED\\\", \\\"IN_PROGRESS\\\", \\\"COMPLETE\\\", \\\"ABORTED\\\"]\\n- plan: (optional) A plan for the subgoal.\\nUsage:\\n${getToolCallString('add_subgoal', {\\n  id: '1',\\n  objective: 'Add a new \\\"deploy api\\\" subgoal',\\n  status: 'IN_PROGRESS',\\n})}\\n    `.trim(),\\n  },\\n  {\\n    name: 'update_subgoal',\\n    description: `\\n### update_subgoal\\nDescription: Update a subgoal in the context given the id, and optionally the status or plan, or a new log to append. Feel free to update any combination of the status, plan, or log in one invocation.\\nParameters:\\n- id: (required) The id of the subgoal to update.\\n- status: (optional) Change the status of the subgoal. One of [\\\"NOT_STARTED\\\", \\\"IN_PROGRESS\\\", \\\"COMPLETE\\\", \\\"FAILED\\\"]\\n- plan: (optional) Change the plan for the subgoal.\\n- log: (optional) Add a log message to the subgoal. This will create a new log entry and append it to the existing logs. Use this to record your progress and any new information you learned as you go.\\nUsage 1 (update status):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  status: 'COMPLETE',\\n})}\\n\\nUsage 2 (update plan):\\n${getToolCallString('update_subgoal', {\\n  id: '3',\\n  plan: 'Create a file for the endpoint in the api, and register it in the router',\\n})}\\n\\nUsage 3 (add log):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  log: \\\"I found the error in the tests, it's in the foo function.\\\",\\n})}\\n\\nUsage 4 (update status and add log):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  status: 'COMPLETE',\\n  log: 'I reran the tests and they passed.',\\n})}\\n    `.trim(),\\n  },\\n  {\\n    name: 'write_file',\\n    description: `\\n### write_file\\nDescription: Create or edit a file with the given content.\\n\\nWhen editing a file, please use this tool to output a simplified version of the code block that highlights the changes necessary and adds comments to indicate where unchanged code has been skipped.\\n\\n--- IMPORTANT OPTIMIZATION DETAIL ---\\nUse \\\"placeholder comments\\\" i.e. \\\"// ... existing code ...\\\" (or \\\"# ... existing code ...\\\" or \\\"/* ... existing code ... */\\\" or \\\"<!-- ... existing code ... -->\\\"  or however comments are written for other languages) in comments as often as you can, signifying unchanged regions of the file.\\nThe write_file tool is very expensive for each line of code you write, so try to write as little \\\\`content\\\\` as possible to accomplish the task. Often this will mean that the start/end of the file will be skipped, but that's okay! Rewrite the entire file only if specifically requested.\\n\\nHowever, for new files, you should write out the entire file and not use placeholder comments.\\n--- IMPORTANT OPTIMIZATION DETAIL ---\\n\\nThese edit codeblocks will be parsed and then read by a less intelligent \\\"apply\\\" language model to update the file. To help specify the edit to the apply model, be very careful to include a few lines of context when generating the codeblock to not introduce ambiguity. Specify all unchanged regions (code and comments) of the file with \\\"// ... existing code ...\\\" markers (in comments). This will ensure the apply model will not delete existing unchanged code or comments when editing the file. This is just an abstraction for your understanding, you should not mention the apply model to the user.\\n\\nDo not use this tool to delete or rename a file. Instead run a terminal command for that.\\n\\nParameters:\\n- path: (required) Path to the file relative to the **project root**\\n- content: (required) Content to write to the file. You should abridge the content of the file using placeholder comments like: \\\\`// ... existing code ...\\\\` or \\\\`# ... existing code ...\\\\` (or whichever is appropriate for the language).\\nUsage:\\n${getToolCallString('write_file', {\\n  path: 'path/to/file',\\n  content: 'Your file content here',\\n})}\\n\\nExample 1 - Simple file creation:\\n${getToolCallString('write_file', {\\n  path: 'new-file.ts',\\n  content: 'console.log(\\\"Hello, world!\\\");',\\n})}\\n\\nExample 2 - Editing with placeholder comments:\\n${getToolCallString('write_file', {\\n  path: 'foo.ts',\\n  content: `// ... existing code ...\\n\\nfunction foo() {\\n  console.log('foo');\\n  for (let i = 0; i < 10; i++) {\\n    console.log(i);\\n  }\\n  doSomething();\\n}\\n\\n// ... existing code ...`,\\n})}\\n\\nNotes for editing a file:\\n- Don't use XML attributes. If you do, the tool will NOT write to the file.\\n- If you don't use any placeholder comments, the entire file will be replaced. E.g. don't write out a single function without using placeholder comments unless you want to replace the entire file with that function.\\n- When editing a file, try not to change any user code that doesn't need to be changed. In particular, you must preserve pre-existing user comments exactly as they are.\\n- You can also use this tool to create new files.\\n- After you have written out a write_file block, the changes will be applied immediately. You can assume that the changes went through as intended. However, note that there are sometimes mistakes in the processs of applying the edits you described in the write_file block, e.g. sometimes large portions of the file are deleted. If you notice that the changes did not go through as intended, based on further updates to the file, you can write out a new write_file block to fix the mistake.\\n- Don't escape characters  write them out directly! E.g. write out '&' instead of '&amp;', '>' instead of '&gt;', '<' instead of '&lt;', and '\\\"' instead of '&quot;' in the content.\\n    `.trim(),\\n  },\\n  {\\n    name: 'read_files',\\n    description: `\\n### read_files\\nDescription: Read the multiple files from disk and return their contents. Use this tool to read as many files as would be helpful to answer the user's request. Make sure to read any files before you write to them with the write_file tool.\\nParameters:\\n- paths: (required) List of file paths to read relative to the **project root**, separated by newlines. Absolute file paths will not work.\\nUsage:\\n${getToolCallString('read_files', {\\n  paths: 'path/to/file1.ts\\\\npath/to/file2.ts',\\n})}\\n\\n\\nNote that there's no need to call this tool if you're already reading the files you need in context.`.trim(),\\n  },\\n  {\\n    name: 'find_files',\\n    description: `\\n### find_files\\nDescription: Find several files related to a brief natural language description of the files or the name of a function or class you are looking for.\\nParameters:\\n- description: (required) A brief natural language description of the files or the name of a function or class you are looking for. It's also helpful to mention a directory or two to look within.\\nUsage:\\n<find_files>\\n<description>The implementation of function foo</description>\\n</find_files>\\n\\nPurpose: Better fulfill the user request by reading files which could contain information relevant to the user's request.\\nUse cases:\\n- If you are calling a function or creating a class and want to know how it works, use this tool to get the implementation.\\n- If you need to understand a section of the codebase, read more files in that directory or subdirectories.\\n- Some requests require a broad understanding of multiple parts of the codebase. Consider using find_files to gain more context before making changes.\\n\\nDon't use this tool if:\\n- You already know the exact path of the file(s) you are looking for  in this case, use read_files.\\n- You already read the files you need in context.\\n\\nIn general, prefer using read_files instead of find_files.\\n      `.trim(),\\n  },\\n  {\\n    name: 'code_search',\\n    description: `\\n### code_search\\nDescription: Search for string patterns in the project's files. This tool uses ripgrep (rg), a fast line-oriented search tool. Use this tool only when read_files is not sufficient to find the files you need.\\nParameters:\\n- pattern: (required) The pattern to search for.\\nUsage:\\n${getToolCallString('code_search', { pattern: 'foo' })}\\n${getToolCallString('code_search', { pattern: 'import.*foo' })}\\n\\nPurpose: Search through code files to find files with specific text patterns, function names, variable names, and more.\\n\\nNote: quotes will be automatically added around your code search pattern. You might need to escape special characters like '-' or '.' or '\\\\\\\\' if you want to search for them.\\n\\nPrefer to use read_files instead of code_search unless you need to search for a specific pattern in multiple files.\\n\\nUse cases:\\n1. Finding all references to a function, class, or variable name across the codebase\\n2. Searching for specific code patterns or implementations\\n3. Looking up where certain strings or text appear\\n4. Finding files that contain specific imports or dependencies\\n5. Locating configuration settings or environment variables\\n\\nThe pattern supports regular expressions and will search recursively through all files in the project by default. Some tips:\\n- Be as constraining in the pattern as possible to limit the number of files returned, e.g. if searching for the definition of a function, use \\\"(function foo|const foo)\\\" or \\\"def foo\\\" instead of merely \\\"foo\\\".\\n- Use word boundaries (\\\\\\\\b) to match whole words only\\n- Searches file content and filenames\\n- Automatically ignores binary files, hidden files, and files in .gitignore\\n- Case-sensitive by default. Use -i to make it case insensitive.\\n- Constrain the search to specific file types using -t <file-type>, e.g. -t ts or -t py.\\n    `.trim(),\\n  },\\n  {\\n    name: 'run_terminal_command',\\n    description: `\\n### run_terminal_command\\nDescription: Request to execute a CLI command on the system. Use this when you need to perform system operations or run specific commands to accomplish any step in the user's task. You must tailor your command to the user's system and provide a clear explanation of what the command does. For command chaining, use the appropriate chaining syntax for the user's shell. Prefer to execute complex CLI commands over creating executable scripts, as they are more flexible and easier to run. Commands will be executed in the current working directory: ${process.cwd()}\\nParameters:\\n- command: (required) The CLI command to execute. This should be valid for the current operating system. Ensure the command is properly formatted and does not contain any harmful instructions.\\n- process_type: (required) What type of process to run. One of SYNC or BACKGROUND.\\n  - SYNC: the command will be run in (and block) the current process. This is required if the output of the command is needed immediately. Most commands will be run in this way. Do not try to run processes in the background with process_type=SYNC and using & at the end of the command. Instead, use the process_type=BACKGROUND option.\\n  - BACKGROUND: the command will be run in a child background process. This is for running servers or other long-running processes.\\nUsage:\\n${getToolCallString('run_terminal_command', {\\n  command: 'Your command here',\\n  process_type: 'value',\\n})}\\n\\nStick to these use cases:\\n1. Compiling the project or running build (e.g., \\\"npm run build\\\"). Reading the output can help you edit code to fix build errors. If possible, use an option that performs checks but doesn't emit files, e.g. \\\\`tsc --noEmit\\\\`.\\n2. Running tests (e.g., \\\"npm test\\\"). Reading the output can help you edit code to fix failing tests. Or, you could write new unit tests and then run them.\\n3. Moving, renaming, or deleting files and directories. These actions can be vital for refactoring requests. Use commands like \\\\`mv\\\\`/\\\\`move\\\\` or \\\\`rm\\\\`/\\\\`del\\\\`.\\n\\nMost likely, you should ask for permission for any other type of command you want to run. If asking for permission, show the user the command you want to run using \\\\`\\\\`\\\\` tags.\\n\\nWhen using this tool, please adhere to the following rules:\\n\\n1. Do not run commands that can modify files outside of the project directory, install packages globally, install virtual environments, or have significant side effects outside of the project directory, unless you have explicit permission from the user. Treat anything outside of the project directory as read-only.\\n2. Do not run \\\\`git push\\\\` because it can break production (!) if the user was not expecting it. Don't run \\\\`git commit\\\\`, \\\\`git rebase\\\\`, or related commands unless you get explicit permission. If a user asks to commit changes, you can do so, but you should not invoke any further git commands beyond the git commit command.\\n3. Do not run scripts without asking. Especially don't run scripts that could run against the production environment or have permanent effects without explicit permission from the user. Don't run scripts with side effects without permission from the user unless they don't have much effect or are simple.\\n4. Be careful with any command that has big or irreversible effects. Anything that touches a production environment, servers, the database, or other systems that could be affected by a command should be run with explicit permission from the user.\\n4. Don't run too many commands in a row without pausing to check in with what the user wants to do next.\\n5. Do not use the run_terminal_command tool to create or edit files. Do not use \\\\`cat\\\\` or \\\\`echo\\\\` to create or edit files. You should instead write out <write_file> blocks for for editing or creating files as detailed above in the <editing_instructions> block.\\n6. Do not install packages without asking, unless it is within a small, new-ish project. Users working on a larger project will want to manage packages themselves, so ask first.\\n7. Do not use the wrong package manager for the project. For example, if the project uses \\\\`pnpm\\\\` or \\\\`bun\\\\` or \\\\`yarn\\\\`, you should not use \\\\`npm\\\\`. Similarly not everyone uses \\\\`pip\\\\` for python, etc.\\n8. You must write out ampersands without escaping them. E.g. write out '&' instead of '&amp;'.\\nIncorrect:\\n\\\\`cd backend &amp;&amp; npm typecheck\\\\` \\nCorrect:\\n\\\\`cd backend && npm typecheck\\\\`\\n10. Do not use more than one run_terminal_command tool call in a single response. Wait for the tool results of each command before invoking the next one.\\n11. The user will not be able to interact with these processes, e.g. confirming the command. So if there's an opportunity to use \\\"-y\\\" or \\\"--yes\\\" flags, use them. Any command that prompts for confirmation will hang if you don't use the flags.\\n\\nNotes:\\n- The current working directory will always reset to **project root** directory for each command you run. You can only access files within this directory (or sub-directories). So if you run cd in one command, the directory change won't persist to the next command.\\n  - \\\\`cd subdir && some_command\\\\` will work as expected.\\n  - \\\\`cd subdir\\\\` in followed by \\\\`some_command\\\\` in two different commands will run some_command from the project root.\\n- Commands can succeed without giving any output, e.g. if no type errors were found. So you may not always see output for successful executions.\\n\\n${gitCommitGuidePrompt}\\n    `.trim(),\\n  },\\n  {\\n    name: 'think_deeply',\\n    description: `\\n### think_deeply\\nDescription: Think through a complex change to the codebase, like implementing a new feature or refactoring some code. Brainstorm. Go deep on alternative approaches and consider the tradeoffs.\\nParameters: thought: (required) Your detailed thoughts.\\nUsage:\\n${getToolCallString('think_deeply', {\\n  thought: '[Insert detailed thoughts here]',\\n})}\\n\\nThink step by step. For the first section of your thinking, only keep a minimum draft for each thinking step, with 5 words at most.\\n\\nUse this tool when the user request meets multiple of these criteria:\\n- Explicitly asks you to plan or think through something.\\n- Always use this tool right before using the create_plan tool.\\n- Requires changes across multiple files or systems\\n- Involves complex logic or architectural decisions\\n- Would benefit from breaking down into smaller steps\\n- Has potential edge cases or risks that need consideration\\n\\nExamples of when to use it:\\n- Adding a new feature that touches multiple parts of the system\\n- Refactoring core functionality used by many components\\n- Making architectural changes that affect the system design\\n- Implementing complex business logic with many edge cases\\n\\nDo not use it for simple changes like:\\n- Adding a single function or endpoint\\n- Updating text or styles\\n   \n\n[Output truncated]\n\n[Output size limit reached.]",
            "message": "Stopped early after 43 match(es)."
          }
        ]
      },
      "agentId": "D-YDzDAsNdY",
      "parentAgentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "24de81f4-e433-4ebd-ba6f-01bc1a46c2e2",
      "toolName": "set_output",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Output set"
          }
        }
      ],
      "parentAgentId": "D-YDzDAsNdY"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-YDzDAsNdY",
      "agentType": "code-searcher",
      "displayName": "Code Searcher",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "searchQueries": [
          {
            "pattern": "bun\\s+run\\s+typecheck|tsc|bun\\s+check|typecheck",
            "flags": "-g package.json -g *.json"
          }
        ]
      }
    },
    {
      "type": "tool_result",
      "toolCallId": "D-YDkB72XEA",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Code Searcher",
              "agentType": "code-searcher",
              "value": {
                "type": "structuredOutput",
                "value": {
                  "results": [
                    {
                      "stdout": "./npm-app/package.json:\n22:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./scripts/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./npm-app/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./tsconfig.json:\n2:  \"extends\": \"./tsconfig.base.json\",\n\n./packages/build-tools/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./common/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./scripts/package.json:\n15:    \"typecheck\": \"tsc --noEmit -p .\",\n18:    \"typecheck-all\": \"bun run typecheck-all.ts\"\n\n./packages/billing/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./common/package.json:\n23:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/build-tools/package.json:\n8:    \"build\": \"tsc\",\n9:    \"clean\": \"rm -rf dist && (rm tsconfig.tsbuildinfo || true)\"\n\n./levelcode.json:\n23:      \"name\": \"backend-typecheck\",\n24:      \"command\": \"bun run typecheck\",\n35:      \"name\": \"npm-typecheck\",\n36:      \"command\": \"bun run typecheck\",\n41:      \"name\": \"web-typecheck\",\n42:      \"command\": \"bun run typecheck\",\n53:      \"name\": \"common-typecheck\",\n54:      \"command\": \"bun run typecheck\",\n\n./packages/billing/package.json:\n22:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/build-tools/project.json:\n11:        \"command\": \"tsc\",\n18:        \"command\": \"rm -rf dist && (rm tsconfig.tsbuildinfo || true)\",\n\n./packages/billing/project.json:\n10:        \"command\": \"tsc -p tsconfig.json\",\n\n./sdk/package.json:\n24:    \"build\": \"bun run copy-types && tsc\",\n31:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./package.json:\n33:    \"typecheck\": \"bun --filter='*' run typecheck && echo ' All type checks passed!'\",\n63:    \"tsc-alias\": \"1.7.0\",\n64:    \"tsconfig-paths\": \"4.2.0\",\n\n./packages/bigquery/package.json:\n22:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/bigquery/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./backend/package.json:\n19:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/code-map/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./packages/code-map/package.json:\n22:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./backend/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./evals/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n\n./evals/package.json:\n15:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/internal/package.json:\n34:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./packages/internal/tsconfig.json:\n2:  \"extends\": \"../../tsconfig.base.json\",\n\n./web/tsconfig.json:\n2:  \"extends\": \"../tsconfig.base.json\",\n37:    \"require\": [\"tsconfig-paths/register\"]\n\n./web/package.json:\n23:    \"typecheck\": \"tsc --noEmit -p .\",\n\n./evals/git-evals/eval-result-levelcode-mock.json:\n21:            \"preContent\": \"import { spawn } from 'child_process'\\nimport fs from 'fs'\\nimport path from 'path'\\n\\nimport { FileChange } from 'common/actions'\\nimport { models, TEST_USER_ID } from 'common/constants'\\nimport { getToolCallString } from 'common/src/constants/tools'\\nimport { z } from 'zod'\\n\\nimport { promptFlashWithFallbacks } from './llm-apis/gemini-with-fallbacks'\\nimport { gitCommitGuidePrompt } from './system-prompt/prompts'\\n\\nconst tools = [\\n  {\\n    name: 'add_subgoal',\\n    description: `\\n### add_subgoal\\nDescription: Add a new subgoal for tracking progress. To be used for complex requests that can't be solved in a single step, as you may forget what happened!\\nParameters:\\n- id: (required) A unique identifier for the subgoal. Try to choose the next sequential integer that is not already in use.\\n- objective: (required) The objective of the subgoal, concisely and clearly stated.\\n- status: (required) The status of the subgoal. One of [\\\"NOT_STARTED\\\", \\\"IN_PROGRESS\\\", \\\"COMPLETE\\\", \\\"ABORTED\\\"]\\n- plan: (optional) A plan for the subgoal.\\nUsage:\\n${getToolCallString('add_subgoal', {\\n  id: '1',\\n  objective: 'Add a new \\\"deploy api\\\" subgoal',\\n  status: 'IN_PROGRESS',\\n})}\\n    `.trim(),\\n  },\\n  {\\n    name: 'update_subgoal',\\n    description: `\\n### update_subgoal\\nDescription: Update a subgoal in the context given the id, and optionally the status or plan, or a new log to append. Feel free to update any combination of the status, plan, or log in one invocation.\\nParameters:\\n- id: (required) The id of the subgoal to update.\\n- status: (optional) Change the status of the subgoal. One of [\\\"NOT_STARTED\\\", \\\"IN_PROGRESS\\\", \\\"COMPLETE\\\", \\\"FAILED\\\"]\\n- plan: (optional) Change the plan for the subgoal.\\n- log: (optional) Add a log message to the subgoal. This will create a new log entry and append it to the existing logs. Use this to record your progress and any new information you learned as you go.\\nUsage 1 (update status):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  status: 'COMPLETE',\\n})}\\n\\nUsage 2 (update plan):\\n${getToolCallString('update_subgoal', {\\n  id: '3',\\n  plan: 'Create a file for the endpoint in the api, and register it in the router',\\n})}\\n\\nUsage 3 (add log):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  log: \\\"I found the error in the tests, it's in the foo function.\\\",\\n})}\\n\\nUsage 4 (update status and add log):\\n${getToolCallString('update_subgoal', {\\n  id: '1',\\n  status: 'COMPLETE',\\n  log: 'I reran the tests and they passed.',\\n})}\\n    `.trim(),\\n  },\\n  {\\n    name: 'write_file',\\n    description: `\\n### write_file\\nDescription: Create or edit a file with the given content.\\n\\nWhen editing a file, please use this tool to output a simplified version of the code block that highlights the changes necessary and adds comments to indicate where unchanged code has been skipped.\\n\\n--- IMPORTANT OPTIMIZATION DETAIL ---\\nUse \\\"placeholder comments\\\" i.e. \\\"// ... existing code ...\\\" (or \\\"# ... existing code ...\\\" or \\\"/* ... existing code ... */\\\" or \\\"<!-- ... existing code ... -->\\\"  or however comments are written for other languages) in comments as often as you can, signifying unchanged regions of the file.\\nThe write_file tool is very expensive for each line of code you write, so try to write as little \\\\`content\\\\` as possible to accomplish the task. Often this will mean that the start/end of the file will be skipped, but that's okay! Rewrite the entire file only if specifically requested.\\n\\nHowever, for new files, you should write out the entire file and not use placeholder comments.\\n--- IMPORTANT OPTIMIZATION DETAIL ---\\n\\nThese edit codeblocks will be parsed and then read by a less intelligent \\\"apply\\\" language model to update the file. To help specify the edit to the apply model, be very careful to include a few lines of context when generating the codeblock to not introduce ambiguity. Specify all unchanged regions (code and comments) of the file with \\\"// ... existing code ...\\\" markers (in comments). This will ensure the apply model will not delete existing unchanged code or comments when editing the file. This is just an abstraction for your understanding, you should not mention the apply model to the user.\\n\\nDo not use this tool to delete or rename a file. Instead run a terminal command for that.\\n\\nParameters:\\n- path: (required) Path to the file relative to the **project root**\\n- content: (required) Content to write to the file. You should abridge the content of the file using placeholder comments like: \\\\`// ... existing code ...\\\\` or \\\\`# ... existing code ...\\\\` (or whichever is appropriate for the language).\\nUsage:\\n${getToolCallString('write_file', {\\n  path: 'path/to/file',\\n  content: 'Your file content here',\\n})}\\n\\nExample 1 - Simple file creation:\\n${getToolCallString('write_file', {\\n  path: 'new-file.ts',\\n  content: 'console.log(\\\"Hello, world!\\\");',\\n})}\\n\\nExample 2 - Editing with placeholder comments:\\n${getToolCallString('write_file', {\\n  path: 'foo.ts',\\n  content: `// ... existing code ...\\n\\nfunction foo() {\\n  console.log('foo');\\n  for (let i = 0; i < 10; i++) {\\n    console.log(i);\\n  }\\n  doSomething();\\n}\\n\\n// ... existing code ...`,\\n})}\\n\\nNotes for editing a file:\\n- Don't use XML attributes. If you do, the tool will NOT write to the file.\\n- If you don't use any placeholder comments, the entire file will be replaced. E.g. don't write out a single function without using placeholder comments unless you want to replace the entire file with that function.\\n- When editing a file, try not to change any user code that doesn't need to be changed. In particular, you must preserve pre-existing user comments exactly as they are.\\n- You can also use this tool to create new files.\\n- After you have written out a write_file block, the changes will be applied immediately. You can assume that the changes went through as intended. However, note that there are sometimes mistakes in the processs of applying the edits you described in the write_file block, e.g. sometimes large portions of the file are deleted. If you notice that the changes did not go through as intended, based on further updates to the file, you can write out a new write_file block to fix the mistake.\\n- Don't escape characters  write them out directly! E.g. write out '&' instead of '&amp;', '>' instead of '&gt;', '<' instead of '&lt;', and '\\\"' instead of '&quot;' in the content.\\n    `.trim(),\\n  },\\n  {\\n    name: 'read_files',\\n    description: `\\n### read_files\\nDescription: Read the multiple files from disk and return their contents. Use this tool to read as many files as would be helpful to answer the user's request. Make sure to read any files before you write to them with the write_file tool.\\nParameters:\\n- paths: (required) List of file paths to read relative to the **project root**, separated by newlines. Absolute file paths will not work.\\nUsage:\\n${getToolCallString('read_files', {\\n  paths: 'path/to/file1.ts\\\\npath/to/file2.ts',\\n})}\\n\\n\\nNote that there's no need to call this tool if you're already reading the files you need in context.`.trim(),\\n  },\\n  {\\n    name: 'find_files',\\n    description: `\\n### find_files\\nDescription: Find several files related to a brief natural language description of the files or the name of a function or class you are looking for.\\nParameters:\\n- description: (required) A brief natural language description of the files or the name of a function or class you are looking for. It's also helpful to mention a directory or two to look within.\\nUsage:\\n<find_files>\\n<description>The implementation of function foo</description>\\n</find_files>\\n\\nPurpose: Better fulfill the user request by reading files which could contain information relevant to the user's request.\\nUse cases:\\n- If you are calling a function or creating a class and want to know how it works, use this tool to get the implementation.\\n- If you need to understand a section of the codebase, read more files in that directory or subdirectories.\\n- Some requests require a broad understanding of multiple parts of the codebase. Consider using find_files to gain more context before making changes.\\n\\nDon't use this tool if:\\n- You already know the exact path of the file(s) you are looking for  in this case, use read_files.\\n- You already read the files you need in context.\\n\\nIn general, prefer using read_files instead of find_files.\\n      `.trim(),\\n  },\\n  {\\n    name: 'code_search',\\n    description: `\\n### code_search\\nDescription: Search for string patterns in the project's files. This tool uses ripgrep (rg), a fast line-oriented search tool. Use this tool only when read_files is not sufficient to find the files you need.\\nParameters:\\n- pattern: (required) The pattern to search for.\\nUsage:\\n${getToolCallString('code_search', { pattern: 'foo' })}\\n${getToolCallString('code_search', { pattern: 'import.*foo' })}\\n\\nPurpose: Search through code files to find files with specific text patterns, function names, variable names, and more.\\n\\nNote: quotes will be automatically added around your code search pattern. You might need to escape special characters like '-' or '.' or '\\\\\\\\' if you want to search for them.\\n\\nPrefer to use read_files instead of code_search unless you need to search for a specific pattern in multiple files.\\n\\nUse cases:\\n1. Finding all references to a function, class, or variable name across the codebase\\n2. Searching for specific code patterns or implementations\\n3. Looking up where certain strings or text appear\\n4. Finding files that contain specific imports or dependencies\\n5. Locating configuration settings or environment variables\\n\\nThe pattern supports regular expressions and will search recursively through all files in the project by default. Some tips:\\n- Be as constraining in the pattern as possible to limit the number of files returned, e.g. if searching for the definition of a function, use \\\"(function foo|const foo)\\\" or \\\"def foo\\\" instead of merely \\\"foo\\\".\\n- Use word boundaries (\\\\\\\\b) to match whole words only\\n- Searches file content and filenames\\n- Automatically ignores binary files, hidden files, and files in .gitignore\\n- Case-sensitive by default. Use -i to make it case insensitive.\\n- Constrain the search to specific file types using -t <file-type>, e.g. -t ts or -t py.\\n    `.trim(),\\n  },\\n  {\\n    name: 'run_terminal_command',\\n    description: `\\n### run_terminal_command\\nDescription: Request to execute a CLI command on the system. Use this when you need to perform system operations or run specific commands to accomplish any step in the user's task. You must tailor your command to the user's system and provide a clear explanation of what the command does. For command chaining, use the appropriate chaining syntax for the user's shell. Prefer to execute complex CLI commands over creating executable scripts, as they are more flexible and easier to run. Commands will be executed in the current working directory: ${process.cwd()}\\nParameters:\\n- command: (required) The CLI command to execute. This should be valid for the current operating system. Ensure the command is properly formatted and does not contain any harmful instructions.\\n- process_type: (required) What type of process to run. One of SYNC or BACKGROUND.\\n  - SYNC: the command will be run in (and block) the current process. This is required if the output of the command is needed immediately. Most commands will be run in this way. Do not try to run processes in the background with process_type=SYNC and using & at the end of the command. Instead, use the process_type=BACKGROUND option.\\n  - BACKGROUND: the command will be run in a child background process. This is for running servers or other long-running processes.\\nUsage:\\n${getToolCallString('run_terminal_command', {\\n  command: 'Your command here',\\n  process_type: 'value',\\n})}\\n\\nStick to these use cases:\\n1. Compiling the project or running build (e.g., \\\"npm run build\\\"). Reading the output can help you edit code to fix build errors. If possible, use an option that performs checks but doesn't emit files, e.g. \\\\`tsc --noEmit\\\\`.\\n2. Running tests (e.g., \\\"npm test\\\"). Reading the output can help you edit code to fix failing tests. Or, you could write new unit tests and then run them.\\n3. Moving, renaming, or deleting files and directories. These actions can be vital for refactoring requests. Use commands like \\\\`mv\\\\`/\\\\`move\\\\` or \\\\`rm\\\\`/\\\\`del\\\\`.\\n\\nMost likely, you should ask for permission for any other type of command you want to run. If asking for permission, show the user the command you want to run using \\\\`\\\\`\\\\` tags.\\n\\nWhen using this tool, please adhere to the following rules:\\n\\n1. Do not run commands that can modify files outside of the project directory, install packages globally, install virtual environments, or have significant side effects outside of the project directory, unless you have explicit permission from the user. Treat anything outside of the project directory as read-only.\\n2. Do not run \\\\`git push\\\\` because it can break production (!) if the user was not expecting it. Don't run \\\\`git commit\\\\`, \\\\`git rebase\\\\`, or related commands unless you get explicit permission. If a user asks to commit changes, you can do so, but you should not invoke any further git commands beyond the git commit command.\\n3. Do not run scripts without asking. Especially don't run scripts that could run against the production environment or have permanent effects without explicit permission from the user. Don't run scripts with side effects without permission from the user unless they don't have much effect or are simple.\\n4. Be careful with any command that has big or irreversible effects. Anything that touches a production environment, servers, the database, or other systems that could be affected by a command should be run with explicit permission from the user.\\n4. Don't run too many commands in a row without pausing to check in with what the user wants to do next.\\n5. Do not use the run_terminal_command tool to create or edit files. Do not use \\\\`cat\\\\` or \\\\`echo\\\\` to create or edit files. You should instead write out <write_file> blocks for for editing or creating files as detailed above in the <editing_instructions> block.\\n6. Do not install packages without asking, unless it is within a small, new-ish project. Users working on a larger project will want to manage packages themselves, so ask first.\\n7. Do not use the wrong package manager for the project. For example, if the project uses \\\\`pnpm\\\\` or \\\\`bun\\\\` or \\\\`yarn\\\\`, you should not use \\\\`npm\\\\`. Similarly not everyone uses \\\\`pip\\\\` for python, etc.\\n8. You must write out ampersands without escaping them. E.g. write out '&' instead of '&amp;'.\\nIncorrect:\\n\\\\`cd backend &amp;&amp; npm typecheck\\\\` \\nCorrect:\\n\\\\`cd backend && npm typecheck\\\\`\\n10. Do not use more than one run_terminal_command tool call in a single response. Wait for the tool results of each command before invoking the next one.\\n11. The user will not be able to interact with these processes, e.g. confirming the command. So if there's an opportunity to use \\\"-y\\\" or \\\"--yes\\\" flags, use them. Any command that prompts for confirmation will hang if you don't use the flags.\\n\\nNotes:\\n- The current working directory will always reset to **project root** directory for each command you run. You can only access files within this directory (or sub-directories). So if you run cd in one command, the directory change won't persist to the next command.\\n  - \\\\`cd subdir && some_command\\\\` will work as expected.\\n  - \\\\`cd subdir\\\\` in followed by \\\\`some_command\\\\` in two different commands will run some_command from the project root.\\n- Commands can succeed without giving any output, e.g. if no type errors were found. So you may not always see output for successful executions.\\n\\n${gitCommitGuidePrompt}\\n    `.trim(),\\n  },\\n  {\\n    name: 'think_deeply',\\n    description: `\\n### think_deeply\\nDescription: Think through a complex change to the codebase, like implementing a new feature or refactoring some code. Brainstorm. Go deep on alternative approaches and consider the tradeoffs.\\nParameters: thought: (required) Your detailed thoughts.\\nUsage:\\n${getToolCallString('think_deeply', {\\n  thought: '[Insert detailed thoughts here]',\\n})}\\n\\nThink step by step. For the first section of your thinking, only keep a minimum draft for each thinking step, with 5 words at most.\\n\\nUse this tool when the user request meets multiple of these criteria:\\n- Explicitly asks you to plan or think through something.\\n- Always use this tool right before using the create_plan tool.\\n- Requires changes across multiple files or systems\\n- Involves complex logic or architectural decisions\\n- Would benefit from breaking down into smaller steps\\n- Has potential edge cases or risks that need consideration\\n\\nExamples of when to use it:\\n- Adding a new feature that touches multiple parts of the system\\n- Refactoring core functionality used by many components\\n- Making architectural changes that affect the system design\\n- Implementing complex business logic with many edge cases\\n\\nDo not use it for simple changes like:\\n- Adding a single function or endpoint\\n- Updating text or styles\\n   \n\n[Output truncated]\n\n[Output size limit reached.]",
                      "message": "Stopped early after 43 match(es)."
                    }
                  ]
                }
              }
            }
          ]
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "08c67066-2b5b-49ec-a44f-0ed600244517",
      "toolName": "spawn_agent_inline",
      "input": {
        "agent_type": "context-pruner",
        "params": {}
      },
      "agentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "08c67066-2b5b-49ec-a44f-0ed600244517",
      "toolName": "spawn_agent_inline",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Agent spawned."
          }
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "D-ZHotftYww",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "editor-gpt-5"
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-ZHzqafVKk",
      "agentType": "editor-gpt-5",
      "displayName": "Code Editor",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": ""
    },
    {
      "type": "tool_call",
      "toolCallId": "D-giu-0aH_8",
      "toolName": "write_file",
      "input": {
        "path": "common/src/tools/published-tools.ts",
        "instructions": "Add centralized curated list of published tool names for public type generation",
        "content": "import type { ToolName } from './constants'\n\nexport const publishedToolNames = [\n  'read_files',\n  'write_file',\n  'str_replace',\n  'find_files',\n  'code_search',\n  'run_terminal_command',\n  'read_docs',\n  'web_search',\n  'browser_logs',\n  'spawn_agents',\n  'end_turn',\n] as const satisfies readonly ToolName[]\n\nexport type PublishedToolName = (typeof publishedToolNames)[number]\n"
      },
      "agentId": "D-ZHzqafVKk",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "D-giu-0aH_8",
      "toolName": "write_file",
      "output": [
        {
          "type": "json",
          "value": {
            "file": "common/src/tools/published-tools.ts",
            "message": "Created new file",
            "unifiedDiff": "import type { ToolName } from './constants'\n\nexport const publishedToolNames = [\n  'read_files',\n  'write_file',\n  'str_replace',\n  'find_files',\n  'code_search',\n  'run_terminal_command',\n  'read_docs',\n  'web_search',\n  'browser_logs',\n  'spawn_agents',\n  'end_turn',\n] as const satisfies readonly ToolName[]\n\nexport type PublishedToolName = (typeof publishedToolNames)[number]\n"
          }
        }
      ],
      "parentAgentId": "D-ZHzqafVKk"
    },
    {
      "type": "tool_call",
      "toolCallId": "b2fe0615-0d15-404d-902b-116f0b5fd160",
      "toolName": "set_output",
      "input": {
        "output": {
          "message": "",
          "toolResults": [
            {
              "file": "common/src/tools/published-tools.ts",
              "message": "Created new file",
              "unifiedDiff": "import type { ToolName } from './constants'\n\nexport const publishedToolNames = [\n  'read_files',\n  'write_file',\n  'str_replace',\n  'find_files',\n  'code_search',\n  'run_terminal_command',\n  'read_docs',\n  'web_search',\n  'browser_logs',\n  'spawn_agents',\n  'end_turn',\n] as const satisfies readonly ToolName[]\n\nexport type PublishedToolName = (typeof publishedToolNames)[number]\n"
            }
          ]
        }
      },
      "agentId": "D-ZHzqafVKk",
      "parentAgentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "b2fe0615-0d15-404d-902b-116f0b5fd160",
      "toolName": "set_output",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Output set"
          }
        }
      ],
      "parentAgentId": "D-ZHzqafVKk"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-ZHzqafVKk",
      "agentType": "editor-gpt-5",
      "displayName": "Code Editor",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": ""
    },
    {
      "type": "tool_result",
      "toolCallId": "D-ZHotftYww",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Code Editor",
              "agentType": "editor-gpt-5",
              "value": {
                "type": "structuredOutput",
                "value": {
                  "output": {
                    "message": "",
                    "toolResults": [
                      {
                        "file": "common/src/tools/published-tools.ts",
                        "message": "Created new file",
                        "unifiedDiff": "import type { ToolName } from './constants'\n\nexport const publishedToolNames = [\n  'read_files',\n  'write_file',\n  'str_replace',\n  'find_files',\n  'code_search',\n  'run_terminal_command',\n  'read_docs',\n  'web_search',\n  'browser_logs',\n  'spawn_agents',\n  'end_turn',\n] as const satisfies readonly ToolName[]\n\nexport type PublishedToolName = (typeof publishedToolNames)[number]\n"
                      }
                    ]
                  }
                }
              }
            }
          ]
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "cd2681e0-77ba-4195-ae1e-fbb97419d44c",
      "toolName": "spawn_agent_inline",
      "input": {
        "agent_type": "context-pruner",
        "params": {}
      },
      "agentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "cd2681e0-77ba-4195-ae1e-fbb97419d44c",
      "toolName": "spawn_agent_inline",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Agent spawned."
          }
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "D-hsW_bOVWg",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "editor-gpt-5"
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "D-hvd4wq49A",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "editor-gpt-5"
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-hvsVJjHC8",
      "agentType": "editor-gpt-5",
      "displayName": "Code Editor",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": ""
    }
  ]
}