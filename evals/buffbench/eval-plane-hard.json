{
  "repoUrl": "https://github.com/makeplane/plane",
  "generationDate": "2025-12-09T20:45:25.917Z",
  "evalCommits": [
    {
      "id": "implement-intake-triage",
      "sha": "78fbdde1651715fbaafd4060cef916b6323f1699",
      "parentSha": "dbc5a6348db8d6c4f01cd28470f60c08d781d608",
      "spec": "Implement a dedicated intake triage state throughout the system and integrate it into intake issue creation and update flows, with UI support.\n\nBackend (Django API):\n1) State model and managers\n- In apps/api/plane/db/models/state.py, define group constants on State including TRIAGE (\"triage\") and add GROUP_CHOICES to include it.\n- Add three managers: State.objects as default manager that excludes triage states; State.all_state_objects as an unfiltered manager; State.triage_objects that returns only triage states.\n\n2) Issue manager filtering\n- In apps/api/plane/db/models/issue.py, ensure the default non-archived Issue queryset excludes issues in triage state by group, so triage issues do not appear in normal issue queries.\n\n3) Disallow manual triage state creation\n- In state serializers (both API and app versions): apps/api/plane/api/serializers/state.py and apps/api/plane/app/serializers/state.py, add validation that rejects create/update when group == State.TRIAGE.\n\n4) Intake status transition validation and update\n- In intake serializers (API and app versions): apps/api/plane/api/serializers/intake.py and apps/api/plane/app/serializers/intake.py, add:\n  - validate: when status is being set to accepted (1) and the related issue is in TRIAGE group, ensure a default state exists in the project; else raise a ValidationError.\n  - update: when status transitions to accepted (1) and the related issue is currently in TRIAGE, move Issue.state to the project's default state.\n\n5) Issue serializers adjustments for triage use cases\n- In apps/api/plane/app/serializers/issue.py:\n  - Change state_id field queryset to use State.all_state_objects so triage states can be set by system flows.\n  - Add a context flag allow_triage_state: when true, state validation should check State.triage_objects; when false, use default State.objects.\n  - Add validation ensuring provided state_id belongs to the project.\n\n6) Intake endpoints set triage state on create and rely on serializer transitions\n- In backend intake creation endpoints (apps/api/plane/api/views/intake.py, apps/api/plane/app/views/intake/base.py) and space/public intake creation (apps/api/plane/space/views/intake.py):\n  - Fetch State.triage_objects for the project; if missing, create a triage state named \"Intake Triage\" with color #4E5355, sequence 65000, default=False.\n  - Create new intake Issues with state set to this triage state.\n  - For intake patch/update flows, validate and save the issue and intake serializers separately; defer state transitions to the serializer update method; log activities accordingly.\n\n7) Project default state seeding includes triage\n- When creating projects, seed a triage state for the project along with other default states: apps/api/plane/api/views/project.py and apps/api/plane/app/views/project/base.py should include an \"Intake Triage\" state with group triage and the specified color/sequence.\n\n8) New endpoint to retrieve intake triage state\n- Add a GET endpoint in apps/api/plane/app/views/state/base.py (IntakeStateEndpoint) that returns the project's triage state or 404 if not found.\n- Wire up the route in apps/api/plane/app/urls/state.py at /api/workspaces/<slug>/projects/<project_id>/intake-state/ and export the view in apps/api/plane/app/views/__init__.py.\n\n9) Logging configuration\n- Add a logger named \"plane.migrations\" to apps/api/plane/settings/local.py and apps/api/plane/settings/production.py with console handler to log migration progress.\n\n10) Data migration to normalize triage state and backfill issues\n- Create migration apps/api/plane/db/migrations/0112_* that:\n  - Normalizes any existing triage states (group triage, name/color/sequence/default set as specified).\n  - Creates a triage state for any project that lacks one (unique name fallback if a conflicting \"Triage\" exists in a different group).\n  - Updates Issues for pending/snoozed intake statuses (issue_intake.status in [-2, 0]) to use the project’s triage state via a subquery.\n  - Logs progress via plane.migrations.\n\n11) Tasks and utilities consistency\n- Update any task/query code that filters states by name to use group triage consistently (e.g., apps/api/plane/bgtasks/dummy_data_task.py should exclude group == State.TRIAGE when sampling states).\n\nFrontend (Web):\n1) Types\n- Add new intake types in packages/types/src/intake/state.ts defining TIntakeStateGroups = \"triage\" and IIntakeState; export via packages/types/src/intake/index.ts and packages/types/src/index.ts.\n\n2) Icons\n- Add IntakeStateGroupIcon and TriageGroupIcon components under packages/propel/src/icons/state and export them; include intake state color mapping in helper.\n\n3) Services and fetch keys\n- Add PROJECT_INTAKE_STATE fetch key in apps/web/core/constants/fetch-keys.ts.\n- In apps/web/core/services/project/project-state.service.ts, add getIntakeState(workspaceSlug, projectId) that calls the new backend endpoint.\n\n4) State store\n- In apps/web/core/store/state.store.ts, introduce intakeStateMap and fetchedIntakeMap.\n- Add selectors: getIntakeStateById, getProjectIntakeState, getProjectIntakeStateIds (returns the single triage state ID if fetched).\n- Add fetchProjectIntakeState that uses the service to populate intakeStateMap and fetchedIntakeMap.\n\n5) Project wrapper preload\n- In apps/web/core/layouts/auth-layout/project-wrapper.tsx, add a useSWR call to fetchProjectIntakeState keyed by PROJECT_INTAKE_STATE alongside the normal states preload.\n\n6) Intake state dropdown component\n- Create intake state dropdown components at apps/web/core/components/dropdowns/intake-state/base.tsx and apps/web/core/components/dropdowns/intake-state/dropdown.tsx that:\n  - Render the current intake state using IntakeStateGroupIcon.\n  - On open, fetch the project intake state if not already loaded.\n  - Expose onChange(val) and support disabled/read-only rendering; in inbox context, do not directly update the issue state (no-op handler).\n\n7) Integrate intake dropdown in Inbox\n- In apps/web/core/components/inbox/content/issue-properties.tsx and apps/web/core/components/inbox/modals/create-modal/issue-properties.tsx, replace the generic StateDropdown with IntakeStateDropdown for intake issues.\n- Remove the \"state\" section from the inbox filter UI (apps/web/core/components/inbox/inbox-filter/filters/filter-selection.tsx) to avoid filtering by non-triage states in intake.\n\n8) Intake creation error propagation\n- In apps/web/core/store/inbox/project-inbox.store.ts, propagate errors thrown during intake issue creation by rethrowing in the catch block so the UI can handle failures.\n\nCross-cutting:\n- In any intake-related issue create/update flows, pass context { allow_triage_state: true } to issue serializers so triage states are allowed for system flows.\n- Ensure activity logs include intake ID and current instance snapshots consistently where applicable.\n- Use the triage state group constant and managers consistently instead of name-based checks, and keep triage states out of general state listings and issue queries.",
      "prompt": "Add a dedicated triage state for intake workflows and integrate it end-to-end. On the backend, introduce a triage state group and managers, prevent manual triage state creation, create intake issues in triage (creating the state if missing), and on acceptance move linked issues to the project’s default state. Provide an endpoint to fetch the project’s intake triage state and seed it during project creation. Include a migration to normalize/create triage states and move pending/snoozed intake issues into triage. On the frontend, add an intake state dropdown that fetches the project’s triage state and displays it in the inbox properties and intake create modal, and preload it in the project wrapper. Update types and icons for the triage group. Exclude triage from normal lists/filters and surface intake creation errors to the UI.",
      "supplementalFiles": [
        "apps/web/core/components/dropdowns/state/dropdown.tsx",
        "packages/propel/src/icons/state/state-group-icon.tsx",
        "packages/types/src/state.ts",
        "packages/constants/src/state.ts"
      ],
      "fileDiffs": [
        {
          "path": "apps/api/plane/api/serializers/intake.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/serializers/intake.py\n===================================================================\n--- apps/api/plane/api/serializers/intake.py\tdbc5a63 (parent)\n+++ apps/api/plane/api/serializers/intake.py\t78fbdde (commit)\n@@ -102,9 +102,57 @@\n             \"created_at\",\n             \"updated_at\",\n         ]\n \n+    def validate(self, attrs):\n+        \"\"\"\n+        Validate that if status is being changed to accepted (1),\n+        the project has a default state to transition to.\n+        \"\"\"\n+        from plane.db.models import State\n \n+        # Check if status is being updated to accepted\n+        if attrs.get(\"status\") == 1:\n+            intake_issue = self.instance\n+            issue = intake_issue.issue\n+\n+            # Check if issue is in TRIAGE state\n+            if issue.state and issue.state.group == State.TRIAGE:\n+                # Verify default state exists before allowing the update\n+                default_state = State.objects.filter(\n+                    workspace=intake_issue.workspace, project=intake_issue.project, default=True\n+                ).first()\n+\n+                if not default_state:\n+                    raise serializers.ValidationError(\n+                        {\"status\": \"Cannot accept intake issue: No default state found for the project\"}\n+                    )\n+\n+        return attrs\n+\n+    def update(self, instance, validated_data):\n+        \"\"\"\n+        Update intake issue and transition associated issue state if accepted.\n+        \"\"\"\n+        from plane.db.models import State\n+\n+        # Update the intake issue with validated data\n+        instance = super().update(instance, validated_data)\n+\n+        # If status is accepted (1), update the associated issue state from TRIAGE to default\n+        if validated_data.get(\"status\") == 1:\n+            issue = instance.issue\n+            if issue.state and issue.state.group == State.TRIAGE:\n+                # Get the default project state\n+                default_state = State.objects.filter(\n+                    workspace=instance.workspace, project=instance.project, default=True\n+                ).first()\n+                if default_state:\n+                    issue.state = default_state\n+                    issue.save()\n+        return instance\n+\n+\n class IssueDataSerializer(serializers.Serializer):\n     \"\"\"\n     Serializer for nested work item data in intake request payloads.\n \n"
        },
        {
          "path": "apps/api/plane/api/serializers/state.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/serializers/state.py\n===================================================================\n--- apps/api/plane/api/serializers/state.py\tdbc5a63 (parent)\n+++ apps/api/plane/api/serializers/state.py\t78fbdde (commit)\n@@ -1,7 +1,8 @@\n # Module imports\n from .base import BaseSerializer\n from plane.db.models import State\n+from rest_framework import serializers\n \n \n class StateSerializer(BaseSerializer):\n     \"\"\"\n@@ -14,8 +15,11 @@\n     def validate(self, data):\n         # If the default is being provided then make all other states default False\n         if data.get(\"default\", False):\n             State.objects.filter(project_id=self.context.get(\"project_id\")).update(default=False)\n+\n+        if data.get(\"group\", None) == State.TRIAGE:\n+            raise serializers.ValidationError(\"Cannot create triage state\")\n         return data\n \n     class Meta:\n         model = State\n"
        },
        {
          "path": "apps/api/plane/api/views/intake.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/intake.py\n===================================================================\n--- apps/api/plane/api/views/intake.py\tdbc5a63 (parent)\n+++ apps/api/plane/api/views/intake.py\t78fbdde (commit)\n@@ -164,15 +164,30 @@\n             \"none\",\n         ]:\n             return Response({\"error\": \"Invalid priority\"}, status=status.HTTP_400_BAD_REQUEST)\n \n+        # get the triage state\n+        triage_state = State.triage_objects.filter(project_id=project_id, workspace__slug=slug).first()\n+\n+        if not triage_state:\n+            triage_state = State.objects.create(\n+                name=\"Intake Triage\",\n+                group=State.TRIAGE,\n+                project_id=project_id,\n+                workspace_id=project.workspace_id,\n+                color=\"#4E5355\",\n+                sequence=65000,\n+                default=False,\n+            )\n+\n         # create an issue\n         issue = Issue.objects.create(\n             name=request.data.get(\"issue\", {}).get(\"name\"),\n             description=request.data.get(\"issue\", {}).get(\"description\", {}),\n             description_html=request.data.get(\"issue\", {}).get(\"description_html\", \"<p></p>\"),\n             priority=request.data.get(\"issue\", {}).get(\"priority\", \"none\"),\n             project_id=project_id,\n+            state_id=triage_state.id,\n         )\n \n         # create an intake issue\n         intake_issue = IntakeIssue.objects.create(\n@@ -319,9 +334,12 @@\n             )\n \n         # Get issue data\n         issue_data = request.data.pop(\"issue\", False)\n+        issue_serializer = None\n+        intake_serializer = None\n \n+        # Validate issue data if provided\n         if bool(issue_data):\n             issue = Issue.objects.annotate(\n                 label_ids=Coalesce(\n                     ArrayAgg(\n@@ -343,8 +361,9 @@\n                     ),\n                     Value([], output_field=ArrayField(UUIDField())),\n                 ),\n             ).get(pk=issue_id, workspace__slug=slug, project_id=project_id)\n+\n             # Only allow guests to edit name and description\n             if project_member.role <= 5:\n                 issue_data = {\n                     \"name\": issue_data.get(\"name\", issue.name),\n@@ -353,73 +372,57 @@\n                 }\n \n             issue_serializer = IssueSerializer(issue, data=issue_data, partial=True)\n \n-            if issue_serializer.is_valid():\n-                current_instance = issue\n-                # Log all the updates\n-                requested_data = json.dumps(issue_data, cls=DjangoJSONEncoder)\n-                if issue is not None:\n-                    issue_activity.delay(\n-                        type=\"issue.activity.updated\",\n-                        requested_data=requested_data,\n-                        actor_id=str(request.user.id),\n-                        issue_id=str(issue_id),\n-                        project_id=str(project_id),\n-                        current_instance=json.dumps(\n-                            IssueSerializer(current_instance).data,\n-                            cls=DjangoJSONEncoder,\n-                        ),\n-                        epoch=int(timezone.now().timestamp()),\n-                        intake=(intake_issue.id),\n-                    )\n-                issue_serializer.save()\n-            else:\n+            if not issue_serializer.is_valid():\n                 return Response(issue_serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n \n         # Only project admins and members can edit intake issue attributes\n         if project_member.role > 15:\n-            serializer = IntakeIssueUpdateSerializer(intake_issue, data=request.data, partial=True)\n-            current_instance = json.dumps(IntakeIssueSerializer(intake_issue).data, cls=DjangoJSONEncoder)\n+            intake_serializer = IntakeIssueUpdateSerializer(intake_issue, data=request.data, partial=True)\n \n-            if serializer.is_valid():\n-                serializer.save()\n-                # Update the issue state if the issue is rejected or marked as duplicate\n-                if serializer.data[\"status\"] in [-1, 2]:\n-                    issue = Issue.objects.get(pk=issue_id, workspace__slug=slug, project_id=project_id)\n-                    state = State.objects.filter(group=\"cancelled\", workspace__slug=slug, project_id=project_id).first()\n-                    if state is not None:\n-                        issue.state = state\n-                        issue.save()\n+            if not intake_serializer.is_valid():\n+                return Response(intake_serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n \n-                # Update the issue state if it is accepted\n-                if serializer.data[\"status\"] in [1]:\n-                    issue = Issue.objects.get(pk=issue_id, workspace__slug=slug, project_id=project_id)\n+        # Both serializers are valid, now save them\n+        if issue_serializer:\n+            current_instance = issue\n+            # Log all the updates\n+            requested_data = json.dumps(issue_data, cls=DjangoJSONEncoder)\n+            issue_activity.delay(\n+                type=\"issue.activity.updated\",\n+                requested_data=requested_data,\n+                actor_id=str(request.user.id),\n+                issue_id=str(issue_id),\n+                project_id=str(project_id),\n+                current_instance=json.dumps(\n+                    IssueSerializer(current_instance).data,\n+                    cls=DjangoJSONEncoder,\n+                ),\n+                epoch=int(timezone.now().timestamp()),\n+                intake=str(intake_issue.id),\n+            )\n+            issue_serializer.save()\n \n-                    # Update the issue state only if it is in triage state\n-                    if issue.state.is_triage:\n-                        # Move to default state\n-                        state = State.objects.filter(workspace__slug=slug, project_id=project_id, default=True).first()\n-                        if state is not None:\n-                            issue.state = state\n-                            issue.save()\n+        # Save intake issue (state transition happens in serializer's update method)\n+        if intake_serializer:\n+            current_instance = json.dumps(IntakeIssueSerializer(intake_issue).data, cls=DjangoJSONEncoder)\n+            intake_serializer.save()\n \n-                # create a activity for status change\n-                issue_activity.delay(\n-                    type=\"intake.activity.created\",\n-                    requested_data=json.dumps(request.data, cls=DjangoJSONEncoder),\n-                    actor_id=str(request.user.id),\n-                    issue_id=str(issue_id),\n-                    project_id=str(project_id),\n-                    current_instance=current_instance,\n-                    epoch=int(timezone.now().timestamp()),\n-                    notification=False,\n-                    origin=base_host(request=request, is_app=True),\n-                    intake=str(intake_issue.id),\n-                )\n-                serializer = IntakeIssueSerializer(intake_issue)\n-                return Response(serializer.data, status=status.HTTP_200_OK)\n-            return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n+            # create a activity for status change\n+            issue_activity.delay(\n+                type=\"intake.activity.created\",\n+                requested_data=json.dumps(request.data, cls=DjangoJSONEncoder),\n+                actor_id=str(request.user.id),\n+                issue_id=str(issue_id),\n+                project_id=str(project_id),\n+                current_instance=current_instance,\n+                epoch=int(timezone.now().timestamp()),\n+                notification=False,\n+                origin=base_host(request=request, is_app=True),\n+                intake=str(intake_issue.id),\n+            )\n+            return Response(IntakeIssueSerializer(intake_issue).data, status=status.HTTP_200_OK)\n         else:\n             return Response(IntakeIssueSerializer(intake_issue).data, status=status.HTTP_200_OK)\n \n     @intake_docs(\n"
        },
        {
          "path": "apps/api/plane/api/views/project.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/project.py\n===================================================================\n--- apps/api/plane/api/views/project.py\tdbc5a63 (parent)\n+++ apps/api/plane/api/views/project.py\t78fbdde (commit)\n@@ -264,8 +264,14 @@\n                         \"color\": \"#9AA4BC\",\n                         \"sequence\": 55000,\n                         \"group\": \"cancelled\",\n                     },\n+                    {\n+                        \"name\": \"Intake Triage\",\n+                        \"color\": \"#4E5355\",\n+                        \"sequence\": 65000,\n+                        \"group\": State.TRIAGE,\n+                    },\n                 ]\n \n                 State.objects.bulk_create(\n                     [\n"
        },
        {
          "path": "apps/api/plane/app/serializers/intake.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/serializers/intake.py\n===================================================================\n--- apps/api/plane/app/serializers/intake.py\tdbc5a63 (parent)\n+++ apps/api/plane/app/serializers/intake.py\t78fbdde (commit)\n@@ -35,8 +35,56 @@\n             \"created_by\",\n         ]\n         read_only_fields = [\"project\", \"workspace\"]\n \n+    def validate(self, attrs):\n+        \"\"\"\n+        Validate that if status is being changed to accepted (1),\n+        the project has a default state to transition to.\n+        \"\"\"\n+        from plane.db.models import State\n+\n+        # Check if status is being updated to accepted\n+        if attrs.get(\"status\") == 1:\n+            intake_issue = self.instance\n+            issue = intake_issue.issue\n+\n+            # Check if issue is in TRIAGE state\n+            if issue.state and issue.state.group == State.TRIAGE:\n+                # Verify default state exists before allowing the update\n+                default_state = State.objects.filter(\n+                    workspace=intake_issue.workspace, project=intake_issue.project, default=True\n+                ).first()\n+\n+                if not default_state:\n+                    raise serializers.ValidationError(\n+                        {\"status\": \"Cannot accept intake issue: No default state found for the project\"}\n+                    )\n+\n+        return attrs\n+\n+    def update(self, instance, validated_data):\n+        from plane.db.models import State\n+\n+        # Update the intake issue\n+        instance = super().update(instance, validated_data)\n+\n+        # If status is accepted (1), transition the issue state from TRIAGE to default\n+        if validated_data.get(\"status\") == 1:\n+            issue = instance.issue\n+            if issue.state and issue.state.group == State.TRIAGE:\n+                # Get the default project state\n+                default_state = State.objects.filter(\n+                    workspace=instance.workspace,\n+                    project=instance.project,\n+                    default=True\n+                ).first()\n+                if default_state:\n+                    issue.state = default_state\n+                    issue.save()\n+\n+        return instance\n+\n     def to_representation(self, instance):\n         # Pass the annotated fields to the Issue instance if they exist\n         if hasattr(instance, \"label_ids\"):\n             instance.issue.label_ids = instance.label_ids\n"
        },
        {
          "path": "apps/api/plane/app/serializers/issue.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/serializers/issue.py\n===================================================================\n--- apps/api/plane/app/serializers/issue.py\tdbc5a63 (parent)\n+++ apps/api/plane/app/serializers/issue.py\t78fbdde (commit)\n@@ -77,9 +77,9 @@\n ## Find a better approach to save manytomany?\n class IssueCreateSerializer(BaseSerializer):\n     # ids\n     state_id = serializers.PrimaryKeyRelatedField(\n-        source=\"state\", queryset=State.objects.all(), required=False, allow_null=True\n+        source=\"state\", queryset=State.all_state_objects.all(), required=False, allow_null=True\n     )\n     parent_id = serializers.PrimaryKeyRelatedField(\n         source=\"parent\", queryset=Issue.objects.all(), required=False, allow_null=True\n     )\n@@ -116,8 +116,11 @@\n         data[\"label_ids\"] = label_ids if label_ids else []\n         return data\n \n     def validate(self, attrs):\n+        allow_triage = self.context.get(\"allow_triage_state\", False)\n+        state_manager = State.triage_objects if allow_triage else State.objects\n+\n         if (\n             attrs.get(\"start_date\", None) is not None\n             and attrs.get(\"target_date\", None) is not None\n             and attrs.get(\"start_date\", None) > attrs.get(\"target_date\", None)\n@@ -159,9 +162,9 @@\n \n         # Check state is from the project only else raise validation error\n         if (\n             attrs.get(\"state\")\n-            and not State.objects.filter(\n+            and not state_manager.filter(\n                 project_id=self.context.get(\"project_id\"),\n                 pk=attrs.get(\"state\").id,\n             ).exists()\n         ):\n@@ -794,9 +797,17 @@\n             \"archived_at\",\n         ]\n         read_only_fields = fields\n \n+    def validate(self, data):\n+        if (\n+            data.get(\"state_id\")\n+            and not State.objects.filter(project_id=self.context.get(\"project_id\"), pk=data.get(\"state_id\")).exists()\n+        ):\n+            raise serializers.ValidationError(\"State is not valid please pass a valid state_id\")\n+        return data\n \n+\n class IssueListDetailSerializer(serializers.Serializer):\n     def __init__(self, *args, **kwargs):\n         # Extract expand parameter and store it as instance variable\n         self.expand = kwargs.pop(\"expand\", []) or []\n"
        },
        {
          "path": "apps/api/plane/app/serializers/state.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/serializers/state.py\n===================================================================\n--- apps/api/plane/app/serializers/state.py\tdbc5a63 (parent)\n+++ apps/api/plane/app/serializers/state.py\t78fbdde (commit)\n@@ -23,9 +23,15 @@\n             \"order\",\n         ]\n         read_only_fields = [\"workspace\", \"project\"]\n \n+    def validate(self, attrs):\n \n+        if attrs.get(\"group\") == State.TRIAGE:\n+            raise serializers.ValidationError(\"Cannot create triage state\")\n+        return attrs\n+\n+\n class StateLiteSerializer(BaseSerializer):\n     class Meta:\n         model = State\n         fields = [\"id\", \"name\", \"color\", \"group\"]\n"
        },
        {
          "path": "apps/api/plane/app/urls/state.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/urls/state.py\n===================================================================\n--- apps/api/plane/app/urls/state.py\tdbc5a63 (parent)\n+++ apps/api/plane/app/urls/state.py\t78fbdde (commit)\n@@ -1,8 +1,8 @@\n from django.urls import path\n \n \n-from plane.app.views import StateViewSet\n+from plane.app.views import StateViewSet, IntakeStateEndpoint\n \n \n urlpatterns = [\n     path(\n@@ -15,8 +15,13 @@\n         StateViewSet.as_view({\"get\": \"retrieve\", \"patch\": \"partial_update\", \"delete\": \"destroy\"}),\n         name=\"project-state\",\n     ),\n     path(\n+        \"workspaces/<str:slug>/projects/<uuid:project_id>/intake-state/\",\n+        IntakeStateEndpoint.as_view(),\n+        name=\"intake-state\",\n+    ),\n+    path(\n         \"workspaces/<str:slug>/projects/<uuid:project_id>/states/<uuid:pk>/mark-default/\",\n         StateViewSet.as_view({\"post\": \"mark_as_default\"}),\n         name=\"project-state\",\n     ),\n"
        },
        {
          "path": "apps/api/plane/app/views/__init__.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/__init__.py\n===================================================================\n--- apps/api/plane/app/views/__init__.py\tdbc5a63 (parent)\n+++ apps/api/plane/app/views/__init__.py\t78fbdde (commit)\n@@ -79,9 +79,9 @@\n from .workspace.cycle import WorkspaceCyclesEndpoint\n from .workspace.quick_link import QuickLinkViewSet\n from .workspace.sticky import WorkspaceStickyViewSet\n \n-from .state.base import StateViewSet\n+from .state.base import StateViewSet, IntakeStateEndpoint\n from .view.base import (\n     WorkspaceViewViewSet,\n     WorkspaceViewIssuesViewSet,\n     IssueViewViewSet,\n"
        },
        {
          "path": "apps/api/plane/app/views/intake/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/intake/base.py\n===================================================================\n--- apps/api/plane/app/views/intake/base.py\tdbc5a63 (parent)\n+++ apps/api/plane/app/views/intake/base.py\t78fbdde (commit)\n@@ -227,16 +227,32 @@\n             \"none\",\n         ]:\n             return Response({\"error\": \"Invalid priority\"}, status=status.HTTP_400_BAD_REQUEST)\n \n-        # create an issue\n         project = Project.objects.get(pk=project_id)\n+\n+        # get the triage state\n+        triage_state = State.triage_objects.filter(project_id=project_id, workspace__slug=slug).first()\n+        if not triage_state:\n+            triage_state = State.objects.create(\n+                name=\"Intake Triage\",\n+                group=State.TRIAGE,\n+                project_id=project_id,\n+                workspace_id=project.workspace_id,\n+                color=\"#4E5355\",\n+                sequence=65000,\n+                default=False,\n+            )\n+        request.data[\"issue\"][\"state_id\"] = triage_state.id\n+\n+        # create an issue\n         serializer = IssueCreateSerializer(\n             data=request.data.get(\"issue\"),\n             context={\n                 \"project_id\": project_id,\n                 \"workspace_id\": project.workspace_id,\n                 \"default_assignee_id\": project.default_assignee_id,\n+                \"allow_triage_state\": True,\n             },\n         )\n         if serializer.is_valid():\n             serializer.save()\n@@ -343,8 +359,14 @@\n             )\n \n         # Get issue data\n         issue_data = request.data.pop(\"issue\", False)\n+        issue_serializer = None\n+        issue = None\n+        issue_current_instance = None\n+        issue_requested_data = None\n+\n+        # Validate issue data if provided\n         if bool(issue_data):\n             issue = Issue.objects.annotate(\n                 label_ids=Coalesce(\n                     ArrayAgg(\n@@ -370,121 +392,97 @@\n                     \"description_html\": issue_data.get(\"description_html\", issue.description_html),\n                     \"description\": issue_data.get(\"description\", issue.description),\n                 }\n \n-            current_instance = json.dumps(IssueDetailSerializer(issue).data, cls=DjangoJSONEncoder)\n+            issue_current_instance = json.dumps(IssueDetailSerializer(issue).data, cls=DjangoJSONEncoder)\n+            issue_requested_data = json.dumps(issue_data, cls=DjangoJSONEncoder)\n \n             issue_serializer = IssueCreateSerializer(\n-                issue, data=issue_data, partial=True, context={\"project_id\": project_id}\n+                issue, data=issue_data, partial=True, context={\"project_id\": project_id, \"allow_triage_state\": True}\n             )\n \n-            if issue_serializer.is_valid():\n-                # Log all the updates\n-                requested_data = json.dumps(issue_data, cls=DjangoJSONEncoder)\n-                if issue is not None:\n-                    issue_activity.delay(\n-                        type=\"issue.activity.updated\",\n-                        requested_data=requested_data,\n-                        actor_id=str(request.user.id),\n-                        issue_id=str(issue.id),\n-                        project_id=str(project_id),\n-                        current_instance=current_instance,\n-                        epoch=int(timezone.now().timestamp()),\n-                        notification=True,\n-                        origin=base_host(request=request, is_app=True),\n-                        intake=str(intake_issue.id),\n-                    )\n-                    # updated issue description version\n-                    issue_description_version_task.delay(\n-                        updated_issue=current_instance,\n-                        issue_id=str(pk),\n-                        user_id=request.user.id,\n-                    )\n-                issue_serializer.save()\n-            else:\n+            if not issue_serializer.is_valid():\n                 return Response(issue_serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n \n-        # Only project admins can edit intake issue attributes\n+        # Validate intake issue data if user has permission\n+        intake_serializer = None\n+        intake_current_instance = None\n+\n         if (project_member and project_member.role > ROLE.MEMBER.value) or is_workspace_admin:\n-            serializer = IntakeIssueSerializer(intake_issue, data=request.data, partial=True)\n-            current_instance = json.dumps(IntakeIssueSerializer(intake_issue).data, cls=DjangoJSONEncoder)\n-            if serializer.is_valid():\n-                serializer.save()\n-                # Update the issue state if the issue is rejected or marked as duplicate\n-                if serializer.data[\"status\"] in [-1, 2]:\n-                    issue = Issue.objects.get(\n-                        pk=intake_issue.issue_id,\n-                        workspace__slug=slug,\n-                        project_id=project_id,\n-                    )\n-                    state = State.objects.filter(group=\"cancelled\", workspace__slug=slug, project_id=project_id).first()\n-                    if state is not None:\n-                        issue.state = state\n-                        issue.save()\n+            intake_current_instance = json.dumps(IntakeIssueSerializer(intake_issue).data, cls=DjangoJSONEncoder)\n+            intake_serializer = IntakeIssueSerializer(intake_issue, data=request.data, partial=True)\n \n-                # Update the issue state if it is accepted\n-                if serializer.data[\"status\"] in [1]:\n-                    issue = Issue.objects.get(\n-                        pk=intake_issue.issue_id,\n-                        workspace__slug=slug,\n-                        project_id=project_id,\n-                    )\n+            if not intake_serializer.is_valid():\n+                return Response(intake_serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n \n-                    # Update the issue state only if it is in triage state\n-                    if issue.state.is_triage:\n-                        # Move to default state\n-                        state = State.objects.filter(workspace__slug=slug, project_id=project_id, default=True).first()\n-                        if state is not None:\n-                            issue.state = state\n-                            issue.save()\n-                # create a activity for status change\n+        # Both serializers are valid, now save them\n+        if issue_serializer:\n+            issue_serializer.save()\n+            # Log all the updates\n+            if issue is not None:\n                 issue_activity.delay(\n-                    type=\"intake.activity.created\",\n-                    requested_data=json.dumps(request.data, cls=DjangoJSONEncoder),\n+                    type=\"issue.activity.updated\",\n+                    requested_data=issue_requested_data,\n                     actor_id=str(request.user.id),\n-                    issue_id=str(pk),\n+                    issue_id=str(issue.id),\n                     project_id=str(project_id),\n-                    current_instance=current_instance,\n+                    current_instance=issue_current_instance,\n                     epoch=int(timezone.now().timestamp()),\n-                    notification=False,\n+                    notification=True,\n                     origin=base_host(request=request, is_app=True),\n-                    intake=(intake_issue.id),\n+                    intake=str(intake_issue.id),\n                 )\n+                # updated issue description version\n+                issue_description_version_task.delay(\n+                    updated_issue=issue_current_instance,\n+                    issue_id=str(pk),\n+                    user_id=request.user.id,\n+                )\n \n-                intake_issue = (\n-                    IntakeIssue.objects.select_related(\"issue\")\n-                    .prefetch_related(\"issue__labels\", \"issue__assignees\")\n-                    .annotate(\n-                        label_ids=Coalesce(\n-                            ArrayAgg(\n-                                \"issue__labels__id\",\n-                                distinct=True,\n-                                filter=Q(\n-                                    ~Q(issue__labels__id__isnull=True) & Q(issue__label_issue__deleted_at__isnull=True)\n-                                ),\n-                            ),\n-                            Value([], output_field=ArrayField(UUIDField())),\n+        if intake_serializer:\n+            intake_serializer.save()\n+            # create a activity for status change\n+            issue_activity.delay(\n+                type=\"intake.activity.created\",\n+                requested_data=json.dumps(request.data, cls=DjangoJSONEncoder),\n+                actor_id=str(request.user.id),\n+                issue_id=str(pk),\n+                project_id=str(project_id),\n+                current_instance=intake_current_instance,\n+                epoch=int(timezone.now().timestamp()),\n+                notification=False,\n+                origin=base_host(request=request, is_app=True),\n+                intake=str(intake_issue.id),\n+            )\n+\n+        # Fetch and return the updated intake issue\n+        intake_issue = (\n+            IntakeIssue.objects.select_related(\"issue\")\n+            .prefetch_related(\"issue__labels\", \"issue__assignees\")\n+            .annotate(\n+                label_ids=Coalesce(\n+                    ArrayAgg(\n+                        \"issue__labels__id\",\n+                        distinct=True,\n+                        filter=Q(~Q(issue__labels__id__isnull=True) & Q(issue__label_issue__deleted_at__isnull=True)),\n+                    ),\n+                    Value([], output_field=ArrayField(UUIDField())),\n+                ),\n+                assignee_ids=Coalesce(\n+                    ArrayAgg(\n+                        \"issue__assignees__id\",\n+                        distinct=True,\n+                        filter=Q(\n+                            ~Q(issue__assignees__id__isnull=True) & Q(issue__issue_assignee__deleted_at__isnull=True)\n                         ),\n-                        assignee_ids=Coalesce(\n-                            ArrayAgg(\n-                                \"issue__assignees__id\",\n-                                distinct=True,\n-                                filter=Q(\n-                                    ~Q(issue__assignees__id__isnull=True)\n-                                    & Q(issue__issue_assignee__deleted_at__isnull=True)\n-                                ),\n-                            ),\n-                            Value([], output_field=ArrayField(UUIDField())),\n-                        ),\n-                    )\n-                    .get(intake_id=intake_id.id, issue_id=pk, project_id=project_id)\n-                )\n-                serializer = IntakeIssueDetailSerializer(intake_issue).data\n-                return Response(serializer, status=status.HTTP_200_OK)\n-            return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n-        else:\n-            serializer = IntakeIssueDetailSerializer(intake_issue).data\n-            return Response(serializer, status=status.HTTP_200_OK)\n+                    ),\n+                    Value([], output_field=ArrayField(UUIDField())),\n+                ),\n+            )\n+            .get(intake_id=intake_id.id, issue_id=pk, project_id=project_id)\n+        )\n+        serializer = IntakeIssueDetailSerializer(intake_issue).data\n+        return Response(serializer, status=status.HTTP_200_OK)\n \n     @allow_permission(allowed_roles=[ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST], creator=True, model=Issue)\n     def retrieve(self, request, slug, project_id, pk):\n         intake_id = Intake.objects.filter(workspace__slug=slug, project_id=project_id).first()\n"
        },
        {
          "path": "apps/api/plane/app/views/project/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/project/base.py\n===================================================================\n--- apps/api/plane/app/views/project/base.py\tdbc5a63 (parent)\n+++ apps/api/plane/app/views/project/base.py\t78fbdde (commit)\n@@ -296,8 +296,14 @@\n                     \"color\": \"#9AA4BC\",\n                     \"sequence\": 55000,\n                     \"group\": \"cancelled\",\n                 },\n+                {\n+                    \"name\": \"Intake Triage\",\n+                    \"color\": \"#4E5355\",\n+                    \"sequence\": 65000,\n+                    \"group\": State.TRIAGE,\n+                },\n             ]\n \n             State.objects.bulk_create(\n                 [\n"
        },
        {
          "path": "apps/api/plane/app/views/state/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/state/base.py\n===================================================================\n--- apps/api/plane/app/views/state/base.py\tdbc5a63 (parent)\n+++ apps/api/plane/app/views/state/base.py\t78fbdde (commit)\n@@ -9,9 +9,9 @@\n from rest_framework.response import Response\n from rest_framework import status\n \n # Module imports\n-from .. import BaseViewSet\n+from .. import BaseViewSet, BaseAPIView\n from plane.app.serializers import StateSerializer\n from plane.app.permissions import ROLE, allow_permission\n from plane.db.models import State, Issue\n from plane.utils.cache import invalidate_cache\n@@ -126,4 +126,17 @@\n             )\n \n         state.delete()\n         return Response(status=status.HTTP_204_NO_CONTENT)\n+\n+\n+class IntakeStateEndpoint(BaseAPIView):\n+    @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n+    def get(self, request, slug, project_id):\n+        state = State.triage_objects.filter(workspace__slug=slug, project_id=project_id).first()\n+        if not state:\n+            return Response(\n+                {\"error\": \"Intake triage state not found\"},\n+                status=status.HTTP_404_NOT_FOUND,\n+            )\n+\n+        return Response(StateSerializer(state).data, status=status.HTTP_200_OK)\n"
        },
        {
          "path": "apps/api/plane/bgtasks/dummy_data_task.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/bgtasks/dummy_data_task.py\n===================================================================\n--- apps/api/plane/bgtasks/dummy_data_task.py\tdbc5a63 (parent)\n+++ apps/api/plane/bgtasks/dummy_data_task.py\t78fbdde (commit)\n@@ -263,9 +263,9 @@\n     fake = Faker()\n     Faker.seed(0)\n \n     states = (\n-        State.objects.filter(workspace=workspace, project=project).exclude(group=\"Triage\").values_list(\"id\", flat=True)\n+        State.objects.filter(workspace=workspace, project=project).exclude(group=State.TRIAGE).values_list(\"id\", flat=True)\n     )\n     creators = ProjectMember.objects.filter(workspace=workspace, project=project).values_list(\"member_id\", flat=True)\n \n     issues = []\n"
        },
        {
          "path": "apps/api/plane/db/migrations/0112_auto_20251124_0603.py",
          "status": "added",
          "diff": "Index: apps/api/plane/db/migrations/0112_auto_20251124_0603.py\n===================================================================\n--- apps/api/plane/db/migrations/0112_auto_20251124_0603.py\tdbc5a63 (parent)\n+++ apps/api/plane/db/migrations/0112_auto_20251124_0603.py\t78fbdde (commit)\n@@ -0,0 +1,92 @@\n+# Generated by Django 4.2.25 on 2025-11-24 06:03\n+\n+from django.db import migrations, transaction\n+from django.db.models import OuterRef, Subquery\n+\n+import logging\n+logger = logging.getLogger(\"plane.migrations\")\n+\n+BATCH_SIZE = 4000\n+\n+\n+def create_triage_state(apps, _schema_editor):\n+    Project = apps.get_model(\"db\", \"Project\")\n+    State = apps.get_model(\"db\", \"State\")\n+    Issue = apps.get_model(\"db\", \"Issue\")\n+\n+\n+    # 1) Bulk-update existing triage states\n+    triage_qs = State.objects.filter(group=\"triage\")\n+    projects_with_triage_state = list(triage_qs.values_list(\"project_id\", flat=True))\n+    triage_qs.update(\n+        name=\"Triage\",\n+        color=\"#4E5355\",\n+        sequence=65000,\n+        default=False,\n+    )\n+    logger.info(f\"Updated {triage_qs.count()} triage states.\")\n+\n+    # 2) Projects that already have a 'Triage' name but not in triage group\n+    projects_to_update_qs = (\n+        State.objects.exclude(group=\"triage\")\n+        .filter(name=\"Triage\")\n+        .values_list(\"project_id\", flat=True)\n+    )\n+    projects_to_update = set(projects_to_update_qs)\n+    logger.info(f\"Projects to update: {len(projects_to_update)}\")\n+\n+    # 3) Create missing triage states in chunks to avoid memory spike\n+    states_to_create = []\n+    project_iter = Project.objects.all().values_list(\"id\", \"workspace_id\").iterator()\n+    for proj_id, workspace_id in project_iter:\n+        if proj_id in projects_with_triage_state:\n+            continue\n+        if proj_id in projects_to_update:\n+            name = f\"Triage-{str(proj_id)[:5]}\"\n+        else:\n+            name = \"Triage\"\n+        states_to_create.append(\n+            State(\n+                name=name,\n+                group=\"triage\",\n+                project_id=proj_id,\n+                workspace_id=workspace_id,\n+                color=\"#4E5355\",\n+                sequence=65000,\n+                default=False,\n+            )\n+        )\n+        if len(states_to_create) >= BATCH_SIZE:\n+            State.objects.bulk_create(states_to_create, batch_size=BATCH_SIZE)\n+            states_to_create = []\n+\n+    if states_to_create:\n+        State.objects.bulk_create(states_to_create, batch_size=BATCH_SIZE)\n+\n+    # 4) Update issues: use deterministic subquery and only update issues that will get a triage state.\n+    with transaction.atomic():\n+        triage_state_subquery = (\n+            State.objects.filter(\n+                group=\"triage\",\n+                project_id=OuterRef(\"project_id\"),\n+                workspace_id=OuterRef(\"workspace_id\"),\n+            )\n+            .values(\"id\")[:1]\n+        )\n+\n+        updated_count = Issue._default_manager.filter(\n+            issue_intake__status__in=[-2, 0],\n+        ).update(state_id=Subquery(triage_state_subquery))\n+        logger.info(f\"Updated {updated_count} issues.\")\n+\n+\n+class Migration(migrations.Migration):\n+\n+    dependencies = [\n+        ('db', '0111_notification_notif_receiver_status_idx_and_more'),\n+    ]\n+\n+    operations = [\n+        migrations.RunPython(create_triage_state, \n+        reverse_code=migrations.RunPython.noop),\n+    ]\n"
        },
        {
          "path": "apps/api/plane/db/models/issue.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/db/models/issue.py\n===================================================================\n--- apps/api/plane/db/models/issue.py\tdbc5a63 (parent)\n+++ apps/api/plane/db/models/issue.py\t78fbdde (commit)\n@@ -18,8 +18,9 @@\n from .project import ProjectBaseModel\n from plane.utils.uuid import convert_uuid_to_integer\n from .description import Description\n from plane.db.mixins import ChangeTrackerMixin\n+from .state import State\n \n \n def get_default_properties():\n     return {\n@@ -96,8 +97,9 @@\n                 | models.Q(issue_intake__isnull=True)\n             )\n             .filter(deleted_at__isnull=True)\n             .filter(state__is_triage=False)\n+            .exclude(state__group=State.TRIAGE)\n             .exclude(archived_at__isnull=False)\n             .exclude(project__archived_at__isnull=False)\n             .exclude(is_draft=True)\n         )\n"
        },
        {
          "path": "apps/api/plane/db/models/state.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/db/models/state.py\n===================================================================\n--- apps/api/plane/db/models/state.py\tdbc5a63 (parent)\n+++ apps/api/plane/db/models/state.py\t78fbdde (commit)\n@@ -6,9 +6,38 @@\n # Module imports\n from .project import ProjectBaseModel\n \n \n+class StateManager(models.Manager):\n+    \"\"\"Default manager - excludes triage states\"\"\"\n+\n+    def get_queryset(self):\n+        return super().get_queryset().exclude(group=State.TRIAGE)\n+\n+\n+class TriageStateManager(models.Manager):\n+    \"\"\"Manager for triage states only\"\"\"\n+\n+    def get_queryset(self):\n+        return super().get_queryset().filter(group=State.TRIAGE)\n+\n+\n class State(ProjectBaseModel):\n+    BACKLOG = \"backlog\"\n+    UNSTARTED = \"unstarted\"\n+    STARTED = \"started\"\n+    COMPLETED = \"completed\"\n+    CANCELLED = \"cancelled\"\n+    TRIAGE = \"triage\"\n+\n+    GROUP_CHOICES = (\n+        (BACKLOG, \"Backlog\"),\n+        (UNSTARTED, \"Unstarted\"),\n+        (STARTED, \"Started\"),\n+        (COMPLETED, \"Completed\"),\n+        (CANCELLED, \"Cancelled\"),\n+        (TRIAGE, \"Triage\"),\n+    )\n     name = models.CharField(max_length=255, verbose_name=\"State Name\")\n     description = models.TextField(verbose_name=\"State Description\", blank=True)\n     color = models.CharField(max_length=255, verbose_name=\"State Color\")\n     slug = models.SlugField(max_length=100, blank=True)\n@@ -29,8 +58,12 @@\n     default = models.BooleanField(default=False)\n     external_source = models.CharField(max_length=255, null=True, blank=True)\n     external_id = models.CharField(max_length=255, blank=True, null=True)\n \n+    objects = StateManager()\n+    all_state_objects = models.Manager()\n+    triage_objects = TriageStateManager()\n+\n     def __str__(self):\n         \"\"\"Return name of the state\"\"\"\n         return f\"{self.name} <{self.project.name}>\"\n \n"
        },
        {
          "path": "apps/api/plane/settings/local.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/settings/local.py\n===================================================================\n--- apps/api/plane/settings/local.py\tdbc5a63 (parent)\n+++ apps/api/plane/settings/local.py\t78fbdde (commit)\n@@ -75,6 +75,11 @@\n             \"level\": \"INFO\",\n             \"handlers\": [\"console\"],\n             \"propagate\": False,\n         },\n+        \"plane.migrations\": {\n+            \"level\": \"INFO\",\n+            \"handlers\": [\"console\"],\n+            \"propagate\": False,\n+        },\n     },\n }\n"
        },
        {
          "path": "apps/api/plane/settings/production.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/settings/production.py\n===================================================================\n--- apps/api/plane/settings/production.py\tdbc5a63 (parent)\n+++ apps/api/plane/settings/production.py\t78fbdde (commit)\n@@ -85,6 +85,11 @@\n             \"level\": \"INFO\",\n             \"handlers\": [\"console\"],\n             \"propagate\": False,\n         },\n+        \"plane.migrations\": {\n+            \"level\": \"DEBUG\" if DEBUG else \"INFO\",\n+            \"handlers\": [\"console\"],\n+            \"propagate\": False,\n+        },\n     },\n }\n"
        },
        {
          "path": "apps/api/plane/space/views/intake.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/space/views/intake.py\n===================================================================\n--- apps/api/plane/space/views/intake.py\tdbc5a63 (parent)\n+++ apps/api/plane/space/views/intake.py\t78fbdde (commit)\n@@ -11,9 +11,9 @@\n from rest_framework.response import Response\n \n # Module imports\n from .base import BaseViewSet\n-from plane.db.models import IntakeIssue, Issue, IssueLink, FileAsset, DeployBoard\n+from plane.db.models import IntakeIssue, Issue, IssueLink, FileAsset, DeployBoard, State\n from plane.app.serializers import (\n     IssueSerializer,\n     IntakeIssueSerializer,\n     IssueCreateSerializer,\n@@ -120,15 +120,32 @@\n             \"none\",\n         ]:\n             return Response({\"error\": \"Invalid priority\"}, status=status.HTTP_400_BAD_REQUEST)\n \n+        # get the triage state\n+        triage_state = State.triage_objects.filter(\n+            project_id=project_deploy_board.project_id, workspace_id=project_deploy_board.workspace_id\n+        ).first()\n+\n+        if not triage_state:\n+            triage_state = State.objects.create(\n+                name=\"Intake Triage\",\n+                group=State.TRIAGE,\n+                project_id=project_deploy_board.project_id,\n+                workspace_id=project_deploy_board.workspace_id,\n+                color=\"#4E5355\",\n+                sequence=65000,\n+                default=False,\n+            )\n+\n         # create an issue\n         issue = Issue.objects.create(\n             name=request.data.get(\"issue\", {}).get(\"name\"),\n             description=request.data.get(\"issue\", {}).get(\"description\", {}),\n             description_html=request.data.get(\"issue\", {}).get(\"description_html\", \"<p></p>\"),\n             priority=request.data.get(\"issue\", {}).get(\"priority\", \"low\"),\n             project_id=project_deploy_board.project_id,\n+            state_id=triage_state.id,\n         )\n \n         # Create an Issue Activity\n         issue_activity.delay(\n@@ -190,9 +207,9 @@\n         issue_serializer = IssueCreateSerializer(\n             issue,\n             data=issue_data,\n             partial=True,\n-            context={\"project_id\": project_deploy_board.project_id},\n+            context={\"project_id\": project_deploy_board.project_id, \"allow_triage_state\": True},\n         )\n \n         if issue_serializer.is_valid():\n             current_instance = issue\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/intake-state/base.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/dropdowns/intake-state/base.tsx\n===================================================================\n--- apps/web/core/components/dropdowns/intake-state/base.tsx\tdbc5a63 (parent)\n+++ apps/web/core/components/dropdowns/intake-state/base.tsx\t78fbdde (commit)\n@@ -0,0 +1,256 @@\n+\"use client\";\n+\n+import type { ReactNode } from \"react\";\n+import { useRef, useState } from \"react\";\n+import { observer } from \"mobx-react\";\n+import { usePopper } from \"react-popper\";\n+import { Search } from \"lucide-react\";\n+import { Combobox } from \"@headlessui/react\";\n+// plane imports\n+import { useTranslation } from \"@plane/i18n\";\n+import { IntakeStateGroupIcon, ChevronDownIcon } from \"@plane/propel/icons\";\n+import type { IIntakeState } from \"@plane/types\";\n+import { ComboDropDown, Spinner } from \"@plane/ui\";\n+import { cn } from \"@plane/utils\";\n+// components\n+import { DropdownButton } from \"@/components/dropdowns/buttons\";\n+import { BUTTON_VARIANTS_WITH_TEXT } from \"@/components/dropdowns/constants\";\n+import type { TDropdownProps } from \"@/components/dropdowns/types\";\n+// hooks\n+import { useDropdown } from \"@/hooks/use-dropdown\";\n+// plane web imports\n+import { StateOption } from \"@/plane-web/components/workflow\";\n+\n+export type TWorkItemStateDropdownBaseProps = TDropdownProps & {\n+  alwaysAllowStateChange?: boolean;\n+  button?: ReactNode;\n+  dropdownArrow?: boolean;\n+  dropdownArrowClassName?: string;\n+  filterAvailableStateIds?: boolean;\n+  getStateById: (stateId: string | null | undefined) => IIntakeState | undefined;\n+  iconSize?: string;\n+  isForWorkItemCreation?: boolean;\n+  isInitializing?: boolean;\n+  onChange: (val: string) => void;\n+  onClose?: () => void;\n+  onDropdownOpen?: () => void;\n+  projectId: string | undefined;\n+  renderByDefault?: boolean;\n+  showDefaultState?: boolean;\n+  stateIds: string[];\n+  value: string | undefined | null;\n+};\n+\n+export const WorkItemStateDropdownBase: React.FC<TWorkItemStateDropdownBaseProps> = observer((props) => {\n+  const {\n+    button,\n+    buttonClassName,\n+    buttonContainerClassName,\n+    buttonVariant,\n+    className = \"\",\n+    disabled = false,\n+    dropdownArrow = false,\n+    dropdownArrowClassName = \"\",\n+    getStateById,\n+    hideIcon = false,\n+    iconSize = \"size-4\",\n+    isInitializing = false,\n+    onChange,\n+    onClose,\n+    onDropdownOpen,\n+    placement,\n+    renderByDefault = true,\n+    showDefaultState = true,\n+    showTooltip = false,\n+    stateIds,\n+    tabIndex,\n+    value,\n+  } = props;\n+  // refs\n+  const dropdownRef = useRef<HTMLDivElement | null>(null);\n+  const inputRef = useRef<HTMLInputElement | null>(null);\n+  // popper-js refs\n+  const [referenceElement, setReferenceElement] = useState<HTMLButtonElement | null>(null);\n+  const [popperElement, setPopperElement] = useState<HTMLDivElement | null>(null);\n+  // states\n+  const [query, setQuery] = useState(\"\");\n+  const [isOpen, setIsOpen] = useState(false);\n+  // store hooks\n+  const { t } = useTranslation();\n+  const statesList = stateIds.map((stateId) => getStateById(stateId)).filter((state) => !!state);\n+  const defaultState = statesList?.find((state) => state?.default) || statesList[0];\n+  const stateValue = !!value ? value : showDefaultState ? defaultState?.id : undefined;\n+  // popper-js init\n+  const { styles, attributes } = usePopper(referenceElement, popperElement, {\n+    placement: placement ?? \"bottom-start\",\n+    modifiers: [\n+      {\n+        name: \"preventOverflow\",\n+        options: {\n+          padding: 12,\n+        },\n+      },\n+    ],\n+  });\n+  // dropdown init\n+  const { handleClose, handleKeyDown, handleOnClick, searchInputKeyDown } = useDropdown({\n+    dropdownRef,\n+    inputRef,\n+    isOpen,\n+    onClose,\n+    onOpen: onDropdownOpen,\n+    query,\n+    setIsOpen,\n+    setQuery,\n+  });\n+\n+  // derived values\n+  const options = statesList?.map((state) => ({\n+    value: state?.id,\n+    query: `${state?.name}`,\n+    content: (\n+      <div className=\"flex items-center gap-2\">\n+        <IntakeStateGroupIcon\n+          stateGroup={state?.group ?? \"triage\"}\n+          color={state?.color}\n+          className={cn(\"flex-shrink-0\", iconSize)}\n+        />\n+        <span className=\"flex-grow truncate text-left\">{state?.name}</span>\n+      </div>\n+    ),\n+  }));\n+\n+  const filteredOptions =\n+    query === \"\" ? options : options?.filter((o) => o.query.toLowerCase().includes(query.toLowerCase()));\n+\n+  const selectedState = stateValue ? getStateById(stateValue) : undefined;\n+\n+  const dropdownOnChange = (val: string) => {\n+    onChange(val);\n+    handleClose();\n+  };\n+\n+  const comboButton = (\n+    <>\n+      {button ? (\n+        <button\n+          ref={setReferenceElement}\n+          type=\"button\"\n+          className={cn(\"clickable block h-full w-full outline-none\", buttonContainerClassName)}\n+          onClick={handleOnClick}\n+          disabled={disabled}\n+          tabIndex={tabIndex}\n+        >\n+          {button}\n+        </button>\n+      ) : (\n+        <button\n+          tabIndex={tabIndex}\n+          ref={setReferenceElement}\n+          type=\"button\"\n+          className={cn(\n+            \"clickable block h-full max-w-full outline-none\",\n+            {\n+              \"cursor-not-allowed text-custom-text-200\": disabled,\n+              \"cursor-pointer\": !disabled,\n+            },\n+            buttonContainerClassName\n+          )}\n+          onClick={handleOnClick}\n+          disabled={disabled}\n+        >\n+          <DropdownButton\n+            className={buttonClassName}\n+            isActive={isOpen}\n+            tooltipHeading={t(\"state\")}\n+            tooltipContent={selectedState?.name ?? t(\"state\")}\n+            showTooltip={showTooltip}\n+            variant={buttonVariant}\n+            renderToolTipByDefault={renderByDefault}\n+          >\n+            {isInitializing ? (\n+              <Spinner className=\"h-3.5 w-3.5\" />\n+            ) : (\n+              <>\n+                {!hideIcon && (\n+                  <IntakeStateGroupIcon\n+                    stateGroup={selectedState?.group ?? \"triage\"}\n+                    color={selectedState?.color ?? \"rgba(var(--color-text-300))\"}\n+                    className={cn(\"flex-shrink-0\", iconSize)}\n+                  />\n+                )}\n+                {BUTTON_VARIANTS_WITH_TEXT.includes(buttonVariant) && (\n+                  <span className=\"flex-grow truncate text-left\">{selectedState?.name ?? t(\"state\")}</span>\n+                )}\n+                {dropdownArrow && (\n+                  <ChevronDownIcon\n+                    className={cn(\"h-2.5 w-2.5 flex-shrink-0\", dropdownArrowClassName)}\n+                    aria-hidden=\"true\"\n+                  />\n+                )}\n+              </>\n+            )}\n+          </DropdownButton>\n+        </button>\n+      )}\n+    </>\n+  );\n+\n+  return (\n+    <ComboDropDown\n+      as=\"div\"\n+      ref={dropdownRef}\n+      className={cn(\"h-full\", className)}\n+      value={stateValue}\n+      onChange={dropdownOnChange}\n+      disabled={disabled}\n+      onKeyDown={handleKeyDown}\n+      button={comboButton}\n+      renderByDefault={renderByDefault}\n+    >\n+      {isOpen && (\n+        <Combobox.Options className=\"fixed z-10\" static>\n+          <div\n+            className=\"my-1 w-48 rounded border-[0.5px] border-custom-border-300 bg-custom-background-100 px-2 py-2.5 text-xs shadow-custom-shadow-rg focus:outline-none\"\n+            ref={setPopperElement}\n+            style={styles.popper}\n+            {...attributes.popper}\n+          >\n+            <div className=\"flex items-center gap-1.5 rounded border border-custom-border-100 bg-custom-background-90 px-2\">\n+              <Search className=\"h-3.5 w-3.5 text-custom-text-400\" strokeWidth={1.5} />\n+              <Combobox.Input\n+                as=\"input\"\n+                ref={inputRef}\n+                className=\"w-full bg-transparent py-1 text-xs text-custom-text-200 placeholder:text-custom-text-400 focus:outline-none\"\n+                value={query}\n+                onChange={(e) => setQuery(e.target.value)}\n+                placeholder={t(\"common.search.label\")}\n+                displayValue={(assigned: any) => assigned?.name}\n+                onKeyDown={searchInputKeyDown}\n+              />\n+            </div>\n+            <div className=\"mt-2 max-h-48 space-y-1 overflow-y-scroll\">\n+              {filteredOptions ? (\n+                filteredOptions.length > 0 ? (\n+                  filteredOptions.map((option) => (\n+                    <StateOption\n+                      {...props}\n+                      key={option.value}\n+                      option={option}\n+                      selectedValue={value}\n+                      className=\"flex w-full cursor-pointer select-none items-center justify-between gap-2 truncate rounded px-1 py-1.5\"\n+                    />\n+                  ))\n+                ) : (\n+                  <p className=\"px-1.5 py-1 italic text-custom-text-400\">{t(\"no_matching_results\")}</p>\n+                )\n+              ) : (\n+                <p className=\"px-1.5 py-1 italic text-custom-text-400\">{t(\"loading\")}</p>\n+              )}\n+            </div>\n+          </div>\n+        </Combobox.Options>\n+      )}\n+    </ComboDropDown>\n+  );\n+});\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/intake-state/dropdown.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/dropdowns/intake-state/dropdown.tsx\n===================================================================\n--- apps/web/core/components/dropdowns/intake-state/dropdown.tsx\tdbc5a63 (parent)\n+++ apps/web/core/components/dropdowns/intake-state/dropdown.tsx\t78fbdde (commit)\n@@ -0,0 +1,48 @@\n+\"use client\";\n+\n+import { useState } from \"react\";\n+import { observer } from \"mobx-react\";\n+import { useParams } from \"next/navigation\";\n+// hooks\n+import { useProjectState } from \"@/hooks/store/use-project-state\";\n+// local imports\n+import type { TWorkItemStateDropdownBaseProps } from \"./base\";\n+import { WorkItemStateDropdownBase } from \"./base\";\n+\n+type TWorkItemStateDropdownProps = Omit<\n+  TWorkItemStateDropdownBaseProps,\n+  \"stateIds\" | \"getStateById\" | \"onDropdownOpen\" | \"isInitializing\"\n+> & {\n+  stateIds?: string[];\n+};\n+\n+export const IntakeStateDropdown: React.FC<TWorkItemStateDropdownProps> = observer((props) => {\n+  const { projectId, stateIds: propsStateIds } = props;\n+  // router params\n+  const { workspaceSlug } = useParams();\n+  // states\n+  const [stateLoader, setStateLoader] = useState(false);\n+  // store hooks\n+  const { fetchProjectIntakeState, getProjectIntakeStateIds, getIntakeStateById } = useProjectState();\n+  // derived values\n+  const stateIds = propsStateIds ?? getProjectIntakeStateIds(projectId);\n+\n+  // fetch states if not provided\n+  const onDropdownOpen = async () => {\n+    if ((stateIds === undefined || stateIds.length === 0) && workspaceSlug && projectId) {\n+      setStateLoader(true);\n+      await fetchProjectIntakeState(workspaceSlug.toString(), projectId);\n+      setStateLoader(false);\n+    }\n+  };\n+\n+  return (\n+    <WorkItemStateDropdownBase\n+      {...props}\n+      getStateById={getIntakeStateById}\n+      isInitializing={stateLoader}\n+      stateIds={stateIds ?? []}\n+      onDropdownOpen={onDropdownOpen}\n+    />\n+  );\n+});\n"
        },
        {
          "path": "apps/web/core/components/inbox/content/issue-properties.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/inbox/content/issue-properties.tsx\n===================================================================\n--- apps/web/core/components/inbox/content/issue-properties.tsx\tdbc5a63 (parent)\n+++ apps/web/core/components/inbox/content/issue-properties.tsx\t78fbdde (commit)\n@@ -13,11 +13,11 @@\n import { ControlLink } from \"@plane/ui\";\n import { getDate, renderFormattedPayloadDate, generateWorkItemLink } from \"@plane/utils\";\n // components\n import { DateDropdown } from \"@/components/dropdowns/date\";\n+import { IntakeStateDropdown } from \"@/components/dropdowns/intake-state/dropdown\";\n import { MemberDropdown } from \"@/components/dropdowns/member/dropdown\";\n import { PriorityDropdown } from \"@/components/dropdowns/priority\";\n-import { StateDropdown } from \"@/components/dropdowns/state/dropdown\";\n import type { TIssueOperations } from \"@/components/issues/issue-detail\";\n import { IssueLabel } from \"@/components/issues/issue-detail/label\";\n // hooks\n import { useProject } from \"@/hooks/store/use-project\";\n@@ -56,20 +56,18 @@\n       <div className=\"w-full overflow-y-auto\">\n         <h5 className=\"text-sm font-medium my-4\">Properties</h5>\n         <div className={`divide-y-2 divide-custom-border-200 ${!isEditable ? \"opacity-60\" : \"\"}`}>\n           <div className=\"flex flex-col gap-3\">\n-            {/* State */}\n+            {/* Intake State */}\n             <div className=\"flex h-8 items-center gap-2\">\n               <div className=\"flex w-2/5 flex-shrink-0 items-center gap-1 text-sm text-custom-text-300\">\n                 <StatePropertyIcon className=\"h-4 w-4 flex-shrink-0\" />\n                 <span>State</span>\n               </div>\n               {issue?.state_id && (\n-                <StateDropdown\n+                <IntakeStateDropdown\n                   value={issue?.state_id}\n-                  onChange={(val) =>\n-                    issue?.id && issueOperations.update(workspaceSlug, projectId, issue?.id, { state_id: val })\n-                  }\n+                  onChange={() => {}}\n                   projectId={projectId?.toString() ?? \"\"}\n                   disabled={!isEditable}\n                   buttonVariant=\"transparent-with-text\"\n                   className=\"w-3/5 flex-grow group\"\n"
        },
        {
          "path": "apps/web/core/components/inbox/inbox-filter/filters/filter-selection.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/inbox/inbox-filter/filters/filter-selection.tsx\n===================================================================\n--- apps/web/core/components/inbox/inbox-filter/filters/filter-selection.tsx\tdbc5a63 (parent)\n+++ apps/web/core/components/inbox/inbox-filter/filters/filter-selection.tsx\t78fbdde (commit)\n@@ -52,12 +52,8 @@\n         {/* status */}\n         <div className=\"py-2\">\n           <FilterStatus searchQuery={filtersSearchQuery} />\n         </div>\n-        {/* state */}\n-        <div className=\"py-2\">\n-          <FilterState states={projectStates} searchQuery={filtersSearchQuery} />\n-        </div>\n         {/* Priority */}\n         <div className=\"py-2\">\n           <FilterPriority searchQuery={filtersSearchQuery} />\n         </div>\n"
        },
        {
          "path": "apps/web/core/components/inbox/modals/create-modal/issue-properties.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/inbox/modals/create-modal/issue-properties.tsx\n===================================================================\n--- apps/web/core/components/inbox/modals/create-modal/issue-properties.tsx\tdbc5a63 (parent)\n+++ apps/web/core/components/inbox/modals/create-modal/issue-properties.tsx\t78fbdde (commit)\n@@ -9,12 +9,12 @@\n // components\n import { CycleDropdown } from \"@/components/dropdowns/cycle\";\n import { DateDropdown } from \"@/components/dropdowns/date\";\n import { EstimateDropdown } from \"@/components/dropdowns/estimate\";\n+import { IntakeStateDropdown } from \"@/components/dropdowns/intake-state/dropdown\";\n import { MemberDropdown } from \"@/components/dropdowns/member/dropdown\";\n import { ModuleDropdown } from \"@/components/dropdowns/module/dropdown\";\n import { PriorityDropdown } from \"@/components/dropdowns/priority\";\n-import { StateDropdown } from \"@/components/dropdowns/state/dropdown\";\n import { ParentIssuesListModal } from \"@/components/issues/parent-issues-list-modal\";\n import { IssueLabelSelect } from \"@/components/issues/select\";\n // helpers\n // hooks\n@@ -49,11 +49,11 @@\n   maxDate?.setDate(maxDate.getDate());\n \n   return (\n     <div className=\"relative flex flex-wrap gap-2 items-center\">\n-      {/* state */}\n+      {/* intake state */}\n       <div className=\"h-7\">\n-        <StateDropdown\n+        <IntakeStateDropdown\n           value={data?.state_id}\n           onChange={(stateId) => handleData(\"state_id\", stateId)}\n           projectId={projectId}\n           buttonVariant=\"border-with-text\"\n"
        },
        {
          "path": "apps/web/core/constants/fetch-keys.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/constants/fetch-keys.ts\n===================================================================\n--- apps/web/core/constants/fetch-keys.ts\tdbc5a63 (parent)\n+++ apps/web/core/constants/fetch-keys.ts\t78fbdde (commit)\n@@ -162,8 +162,11 @@\n \n export const PROJECT_STATES = (workspaceSlug: string, projectId: string) =>\n   `PROJECT_STATES_${projectId.toString().toUpperCase()}`;\n \n+export const PROJECT_INTAKE_STATE = (workspaceSlug: string, projectId: string) =>\n+  `PROJECT_INTAKE_STATE_${projectId.toString().toUpperCase()}`;\n+\n export const PROJECT_ESTIMATES = (workspaceSlug: string, projectId: string) =>\n   `PROJECT_ESTIMATES_${projectId.toString().toUpperCase()}`;\n \n export const PROJECT_ALL_CYCLES = (workspaceSlug: string, projectId: string) =>\n"
        },
        {
          "path": "apps/web/core/layouts/auth-layout/project-wrapper.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/layouts/auth-layout/project-wrapper.tsx\n===================================================================\n--- apps/web/core/layouts/auth-layout/project-wrapper.tsx\tdbc5a63 (parent)\n+++ apps/web/core/layouts/auth-layout/project-wrapper.tsx\t78fbdde (commit)\n@@ -20,8 +20,9 @@\n   PROJECT_ESTIMATES,\n   PROJECT_ALL_CYCLES,\n   PROJECT_MODULES,\n   PROJECT_VIEWS,\n+  PROJECT_INTAKE_STATE,\n } from \"@/constants/fetch-keys\";\n import { captureClick } from \"@/helpers/event-tracker.helper\";\n // hooks\n import { useProjectEstimates } from \"@/hooks/store/estimates\";\n@@ -57,10 +58,10 @@\n   const { fetchViews } = useProjectView();\n   const {\n     project: { fetchProjectMembers, fetchProjectMemberPreferences },\n   } = useMember();\n+  const { fetchProjectStates, fetchProjectIntakeState } = useProjectState();\n   const { data: currentUserData } = useUser();\n-  const { fetchProjectStates } = useProjectState();\n   const { fetchProjectLabels } = useLabel();\n   const { getProjectEstimates } = useProjectEstimates();\n \n   // derived values\n@@ -111,8 +112,14 @@\n     workspaceSlug && projectId ? PROJECT_STATES(workspaceSlug, projectId) : null,\n     workspaceSlug && projectId ? () => fetchProjectStates(workspaceSlug, projectId) : null,\n     { revalidateIfStale: false, revalidateOnFocus: false }\n   );\n+  // fetching project intake state\n+  useSWR(\n+    workspaceSlug && projectId ? PROJECT_INTAKE_STATE(workspaceSlug, projectId) : null,\n+    workspaceSlug && projectId ? () => fetchProjectIntakeState(workspaceSlug, projectId) : null,\n+    { revalidateIfStale: false, revalidateOnFocus: false }\n+  );\n   // fetching project estimates\n   useSWR(\n     workspaceSlug && projectId ? PROJECT_ESTIMATES(workspaceSlug, projectId) : null,\n     workspaceSlug && projectId ? () => getProjectEstimates(workspaceSlug, projectId) : null,\n"
        },
        {
          "path": "apps/web/core/services/project/project-state.service.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/services/project/project-state.service.ts\n===================================================================\n--- apps/web/core/services/project/project-state.service.ts\tdbc5a63 (parent)\n+++ apps/web/core/services/project/project-state.service.ts\t78fbdde (commit)\n@@ -1,7 +1,7 @@\n // services\n import { API_BASE_URL } from \"@plane/constants\";\n-import type { IState } from \"@plane/types\";\n+import type { IIntakeState, IState } from \"@plane/types\";\n import { APIService } from \"@/services/api.service\";\n // helpers\n // types\n \n@@ -33,8 +33,16 @@\n         throw error?.response?.data;\n       });\n   }\n \n+  async getIntakeState(workspaceSlug: string, projectId: string): Promise<IIntakeState> {\n+    return this.get(`/api/workspaces/${workspaceSlug}/projects/${projectId}/intake-state/`)\n+      .then((response) => response?.data)\n+      .catch((error) => {\n+        throw error?.response?.data;\n+      });\n+  }\n+\n   async getState(workspaceSlug: string, projectId: string, stateId: string): Promise<any> {\n     return this.get(`/api/workspaces/${workspaceSlug}/projects/${projectId}/states/${stateId}/`)\n       .then((response) => response?.data)\n       .catch((error) => {\n"
        },
        {
          "path": "apps/web/core/store/inbox/project-inbox.store.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/store/inbox/project-inbox.store.ts\n===================================================================\n--- apps/web/core/store/inbox/project-inbox.store.ts\tdbc5a63 (parent)\n+++ apps/web/core/store/inbox/project-inbox.store.ts\t78fbdde (commit)\n@@ -468,10 +468,11 @@\n             (this.inboxIssuePaginationInfo?.total_results || 0) + 1\n           );\n         });\n       return inboxIssueResponse;\n-    } catch {\n+    } catch (error) {\n       console.error(\"Error creating the intake issue\");\n+      throw error;\n     }\n   };\n \n   /**\n"
        },
        {
          "path": "apps/web/core/store/state.store.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/store/state.store.ts\n===================================================================\n--- apps/web/core/store/state.store.ts\tdbc5a63 (parent)\n+++ apps/web/core/store/state.store.ts\t78fbdde (commit)\n@@ -2,9 +2,9 @@\n import { action, computed, makeObservable, observable, runInAction } from \"mobx\";\n import { computedFn } from \"mobx-utils\";\n // plane imports\n import { STATE_GROUPS } from \"@plane/constants\";\n-import type { IState } from \"@plane/types\";\n+import type { IIntakeState, IState } from \"@plane/types\";\n // helpers\n import { sortStates } from \"@plane/utils\";\n // plane web\n import { ProjectStateService } from \"@/plane-web/services/project/project-state.service\";\n@@ -12,21 +12,27 @@\n \n export interface IStateStore {\n   //Loaders\n   fetchedMap: Record<string, boolean>;\n+  fetchedIntakeMap: Record<string, boolean>;\n   // observables\n   stateMap: Record<string, IState>;\n+  intakeStateMap: Record<string, IIntakeState>;\n   // computed\n   workspaceStates: IState[] | undefined;\n   projectStates: IState[] | undefined;\n   groupedProjectStates: Record<string, IState[]> | undefined;\n   // computed actions\n   getStateById: (stateId: string | null | undefined) => IState | undefined;\n+  getIntakeStateById: (intakeStateId: string | null | undefined) => IIntakeState | undefined;\n   getProjectStates: (projectId: string | null | undefined) => IState[] | undefined;\n+  getProjectIntakeState: (projectId: string | null | undefined) => IIntakeState | undefined;\n   getProjectStateIds: (projectId: string | null | undefined) => string[] | undefined;\n+  getProjectIntakeStateIds: (projectId: string | null | undefined) => string[] | undefined;\n   getProjectDefaultStateId: (projectId: string | null | undefined) => string | undefined;\n   // fetch actions\n   fetchProjectStates: (workspaceSlug: string, projectId: string) => Promise<IState[]>;\n+  fetchProjectIntakeState: (workspaceSlug: string, projectId: string) => Promise<IIntakeState>;\n   fetchWorkspaceStates: (workspaceSlug: string) => Promise<IState[]>;\n   // crud actions\n   createState: (workspaceSlug: string, projectId: string, data: Partial<IState>) => Promise<IState>;\n   updateState: (\n@@ -48,24 +54,29 @@\n }\n \n export class StateStore implements IStateStore {\n   stateMap: Record<string, IState> = {};\n+  intakeStateMap: Record<string, IIntakeState> = {};\n   //loaders\n   fetchedMap: Record<string, boolean> = {};\n+  fetchedIntakeMap: Record<string, boolean> = {};\n   rootStore: RootStore;\n   router;\n   stateService: ProjectStateService;\n \n   constructor(_rootStore: RootStore) {\n     makeObservable(this, {\n       // observables\n       stateMap: observable,\n+      intakeStateMap: observable,\n       fetchedMap: observable,\n+      fetchedIntakeMap: observable,\n       // computed\n       projectStates: computed,\n       groupedProjectStates: computed,\n       // fetch action\n       fetchProjectStates: action,\n+      fetchProjectIntakeState: action,\n       // CRUD actions\n       createState: action,\n       updateState: action,\n       deleteState: action,\n@@ -127,8 +138,17 @@\n     return this.stateMap[stateId] ?? undefined;\n   });\n \n   /**\n+   * @description returns intake state details using intake state id\n+   * @param intakeStateId\n+   */\n+  getIntakeStateById = computedFn((intakeStateId: string | null | undefined) => {\n+    if (!this.intakeStateMap || !intakeStateId) return;\n+    return this.intakeStateMap[intakeStateId] ?? undefined;\n+  });\n+\n+  /**\n    * Returns the stateMap belongs to a project by projectId\n    * @param projectId\n    * @returns IState[]\n    */\n@@ -138,8 +158,18 @@\n     return sortStates(Object.values(this.stateMap).filter((state) => state.project_id === projectId));\n   });\n \n   /**\n+   * Returns the intake state for a project by projectId\n+   * @param projectId\n+   * @returns IIntakeState | undefined\n+   */\n+  getProjectIntakeState = computedFn((projectId: string | null | undefined) => {\n+    if (!projectId || !this.fetchedIntakeMap[projectId]) return;\n+    return Object.values(this.intakeStateMap).find((state) => state.project_id === projectId);\n+  });\n+\n+  /**\n    * Returns the state ids for a project by projectId\n    * @param projectId\n    * @returns string[]\n    */\n@@ -151,8 +181,20 @@\n     return projectStates?.map((state) => state.id) ?? [];\n   });\n \n   /**\n+   * Returns the intake state ids for a project by projectId\n+   * @param projectId\n+   * @returns string[]\n+   */\n+  getProjectIntakeStateIds = computedFn((projectId: string | null | undefined) => {\n+    const workspaceSlug = this.router.workspaceSlug;\n+    if (!workspaceSlug || !projectId || !this.fetchedIntakeMap[projectId]) return undefined;\n+    const projectIntakeState = this.getProjectIntakeState(projectId);\n+    return projectIntakeState?.id ? [projectIntakeState.id] : [];\n+  });\n+\n+  /**\n    * Returns the default state id for a project\n    * @param projectId\n    * @returns string | undefined\n    */\n@@ -178,8 +220,23 @@\n     return statesResponse;\n   };\n \n   /**\n+   * fetches the intakeStateMap of a project\n+   * @param workspaceSlug\n+   * @param projectId\n+   * @returns\n+   */\n+  fetchProjectIntakeState = async (workspaceSlug: string, projectId: string) => {\n+    const intakeStateResponse = await this.stateService.getIntakeState(workspaceSlug, projectId);\n+    runInAction(() => {\n+      set(this.intakeStateMap, [intakeStateResponse.id], intakeStateResponse);\n+      set(this.fetchedIntakeMap, projectId, true);\n+    });\n+    return intakeStateResponse;\n+  };\n+\n+  /**\n    * fetches the stateMap of all the states in workspace\n    * @param workspaceSlug\n    * @returns\n    */\n"
        },
        {
          "path": "packages/propel/src/icons/state/helper.tsx",
          "status": "modified",
          "diff": "Index: packages/propel/src/icons/state/helper.tsx\n===================================================================\n--- packages/propel/src/icons/state/helper.tsx\tdbc5a63 (parent)\n+++ packages/propel/src/icons/state/helper.tsx\t78fbdde (commit)\n@@ -1,5 +1,6 @@\n import { EIconSize } from \"@plane/constants\";\n+import type { TIntakeStateGroups } from \"@plane/types\";\n \n export interface IStateGroupIcon {\n   className?: string;\n   color?: string;\n@@ -7,8 +8,16 @@\n   size?: EIconSize;\n   percentage?: number;\n }\n \n+export interface IIntakeStateGroupIcon {\n+  className?: string;\n+  color?: string;\n+  stateGroup: TIntakeStateGroups;\n+  size?: EIconSize;\n+  percentage?: number;\n+}\n+\n export type TStateGroups = \"backlog\" | \"unstarted\" | \"started\" | \"completed\" | \"cancelled\";\n \n export const STATE_GROUP_COLORS: {\n   [key in TStateGroups]: string;\n@@ -19,8 +28,10 @@\n   completed: \"#46A758\",\n   cancelled: \"#9AA4BC\",\n };\n \n+export const INTAKE_STATE_GROUP_COLORS: { [key in TIntakeStateGroups]: string } = { triage: \"#4E5355\" };\n+\n export const STATE_GROUP_SIZES: {\n   [key in EIconSize]: string;\n } = {\n   [EIconSize.XS]: \"10px\",\n"
        },
        {
          "path": "packages/propel/src/icons/state/index.ts",
          "status": "modified",
          "diff": "Index: packages/propel/src/icons/state/index.ts\n===================================================================\n--- packages/propel/src/icons/state/index.ts\tdbc5a63 (parent)\n+++ packages/propel/src/icons/state/index.ts\t78fbdde (commit)\n@@ -3,4 +3,5 @@\n export * from \"./completed-group-icon\";\n export * from \"./started-group-icon\";\n export * from \"./state-group-icon\";\n export * from \"./unstarted-group-icon\";\n+export * from \"./intake-state-group-icon\";\n"
        },
        {
          "path": "packages/propel/src/icons/state/intake-state-group-icon.tsx",
          "status": "added",
          "diff": "Index: packages/propel/src/icons/state/intake-state-group-icon.tsx\n===================================================================\n--- packages/propel/src/icons/state/intake-state-group-icon.tsx\tdbc5a63 (parent)\n+++ packages/propel/src/icons/state/intake-state-group-icon.tsx\t78fbdde (commit)\n@@ -0,0 +1,26 @@\n+import * as React from \"react\";\n+\n+import { EIconSize } from \"@plane/constants\";\n+import type { IIntakeStateGroupIcon } from \"./helper\";\n+import { INTAKE_STATE_GROUP_COLORS, STATE_GROUP_SIZES } from \"./helper\";\n+import { TriageGroupIcon } from \"./triage-group-icon\";\n+\n+const iconComponents = { triage: TriageGroupIcon };\n+\n+export const IntakeStateGroupIcon: React.FC<IIntakeStateGroupIcon> = ({\n+  className = \"\",\n+  color,\n+  stateGroup,\n+  size = EIconSize.SM,\n+}) => {\n+  const IntakeStateIconComponent = iconComponents[stateGroup] || TriageGroupIcon;\n+\n+  return (\n+    <IntakeStateIconComponent\n+      height={STATE_GROUP_SIZES[size]}\n+      width={STATE_GROUP_SIZES[size]}\n+      color={color ?? INTAKE_STATE_GROUP_COLORS[stateGroup]}\n+      className={`flex-shrink-0 ${className}`}\n+    />\n+  );\n+};\n"
        },
        {
          "path": "packages/propel/src/icons/state/triage-group-icon.tsx",
          "status": "added",
          "diff": "Index: packages/propel/src/icons/state/triage-group-icon.tsx\n===================================================================\n--- packages/propel/src/icons/state/triage-group-icon.tsx\tdbc5a63 (parent)\n+++ packages/propel/src/icons/state/triage-group-icon.tsx\t78fbdde (commit)\n@@ -0,0 +1,42 @@\n+import * as React from \"react\";\n+\n+import type { ISvgIcons } from \"../type\";\n+\n+export const TriageGroupIcon: React.FC<ISvgIcons> = ({ width = \"20\", height = \"20\", className, color = \"#4E5355\" }) => {\n+  // SVG parameters\n+  const viewBoxSize = 16;\n+  return (\n+    <svg\n+      height={height}\n+      width={width}\n+      viewBox={`0 0 ${viewBoxSize} ${viewBoxSize}`}\n+      className={className}\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+      fill=\"none\"\n+    >\n+      <g clip-path=\"url(#clip0_3870_37)\">\n+        <path\n+          d=\"M0.75 8C0.75 3.99594 3.99594 0.75 8 0.75C8.32217 0.75 8.58333 1.01117 8.58333 1.33333C8.58333 1.6555 8.32217 1.91667 8 1.91667C4.64027 1.91667 1.91667 4.64027 1.91667 8C1.91667 11.3597 4.64027 14.0833 8 14.0833C8.32217 14.0833 8.58333 14.3445 8.58333 14.6667C8.58333 14.9888 8.32217 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8Z\"\n+          fill={color}\n+        />\n+        <path\n+          d=\"M10.9855 13.9615L11.078 14.1465C11.1916 14.3737 11.1001 14.6515 10.8663 14.7508C10.6324 14.8501 10.3689 14.7229 10.2845 14.4831L10.1195 14.0143C10.0505 13.8183 10.154 13.6046 10.3453 13.5234C10.5366 13.4423 10.7621 13.5162 10.8553 13.7019L10.9855 13.9615ZM12.6866 13.0286C12.8599 13.2144 12.8506 13.5069 12.6541 13.6681C12.4576 13.8292 12.1691 13.7815 12.0205 13.5754L11.7298 13.1724C11.6082 13.0038 11.6472 12.7694 11.8079 12.6375C11.9685 12.5057 12.2058 12.5131 12.3476 12.665L12.6866 13.0286ZM13.9148 11.5026C14.1333 11.632 14.2067 11.9149 14.0638 12.1249C13.921 12.3348 13.6308 12.3704 13.4302 12.2147L13.0373 11.9097C12.8731 11.7823 12.8444 11.5465 12.9614 11.3748C13.0783 11.203 13.3082 11.1431 13.487 11.2491L13.9148 11.5026ZM14.6627 9.69141C14.9089 9.75393 15.0592 10.0048 14.9813 10.2466C14.9034 10.4883 14.635 10.6044 14.3985 10.5116L13.9362 10.3302C13.7427 10.2542 13.6486 10.036 13.7122 9.83814C13.7759 9.64027 13.9795 9.51796 14.181 9.56911L14.6627 9.69141ZM14.8689 7.74357C15.1228 7.73414 15.3378 7.93242 15.3313 8.18638C15.3248 8.44044 15.0999 8.62755 14.8468 8.60509L14.3518 8.56118C14.1448 8.54281 13.9931 8.36009 13.9986 8.15234C14.004 7.94452 14.165 7.76971 14.3728 7.762L14.8689 7.74357ZM14.5173 5.8165C14.7582 5.73553 15.0206 5.86505 15.0861 6.11063C15.1515 6.35609 14.9886 6.59895 14.7395 6.64882L14.252 6.74642C14.0484 6.78719 13.8514 6.65476 13.798 6.45402C13.7446 6.2532 13.8497 6.0402 14.0467 5.97425L14.3221 5.88209L14.5173 5.8165ZM13.6369 4.06668C13.8452 3.92123 14.1334 3.97157 14.2654 4.1887C14.3974 4.40584 14.3096 4.68491 14.0846 4.80306L13.6448 5.03401C13.4608 5.13061 13.2344 5.0591 13.1264 4.88152C13.0185 4.70392 13.0592 4.46992 13.2296 4.35097L13.6369 4.06668ZM12.2981 2.63637C12.457 2.43806 12.7476 2.40502 12.9357 2.57589C13.1237 2.74673 13.1182 3.03909 12.9358 3.21591L12.5786 3.56218C12.4294 3.70686 12.1919 3.70215 12.0383 3.56213C11.8847 3.42214 11.8577 3.18617 11.9876 3.02398L12.2981 2.63637ZM10.6103 1.64162C10.7068 1.4066 10.9763 1.29298 11.2048 1.404C11.4332 1.51499 11.5105 1.79695 11.3855 2.01805L11.1409 2.45067C11.0386 2.63174 10.8092 2.69437 10.6221 2.60353C10.435 2.51273 10.3425 2.29386 10.4215 2.10151L10.6103 1.64162Z\"\n+          fill={color}\n+        />\n+        <path\n+          d=\"M10.5833 8C10.5832 8.32217 10.3215 8.58345 9.99935 8.58333C9.67737 8.58307 9.41664 8.32199 9.41667 8V7.4082L6.41276 10.4121C6.18495 10.6399 5.81504 10.6406 5.58724 10.4128C5.35943 10.185 5.35943 9.81505 5.58724 9.58724L7.00195 8.17318C7.49071 7.68442 8.05115 7.12332 8.59115 6.58333H8C7.67783 6.58333 7.41667 6.32217 7.41667 6C7.41667 5.67783 7.67783 5.41667 8 5.41667H10C10.3222 5.41667 10.5833 5.67783 10.5833 6V8Z\"\n+          fill={color}\n+        />\n+        <path\n+          d=\"M5.41667 8C5.41679 7.67783 5.67848 7.41655 6.00065 7.41667C6.32263 7.41693 6.58336 7.67801 6.58333 8V8.5918L9.58724 5.58789C9.81504 5.36009 10.185 5.35943 10.4128 5.58724C10.6406 5.81505 10.6406 6.18495 10.4128 6.41276L8.99805 7.82682C8.50929 8.31558 7.94884 8.87668 7.40885 9.41667H8C8.32217 9.41667 8.58333 9.67783 8.58333 10C8.58333 10.3222 8.32217 10.5833 8 10.5833H6C5.67783 10.5833 5.41667 10.3222 5.41667 10V8Z\"\n+          fill={color}\n+        />\n+      </g>\n+      <defs>\n+        <clipPath id=\"clip0_3870_37\">\n+          <rect width=\"16\" height=\"16\" fill=\"white\" />\n+        </clipPath>\n+      </defs>\n+    </svg>\n+  );\n+};\n"
        },
        {
          "path": "packages/types/src/index.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/index.ts\n===================================================================\n--- packages/types/src/index.ts\tdbc5a63 (parent)\n+++ packages/types/src/index.ts\t78fbdde (commit)\n@@ -31,8 +31,9 @@\n export * from \"./pragmatic\";\n export * from \"./project\";\n export * from \"./publish\";\n export * from \"./reaction\";\n+export * from \"./intake\";\n export * from \"./rich-filters\";\n export * from \"./search\";\n export * from \"./state\";\n export * from \"./stickies\";\n"
        },
        {
          "path": "packages/types/src/intake/index.ts",
          "status": "added",
          "diff": "Index: packages/types/src/intake/index.ts\n===================================================================\n--- packages/types/src/intake/index.ts\tdbc5a63 (parent)\n+++ packages/types/src/intake/index.ts\t78fbdde (commit)\n@@ -0,0 +1,1 @@\n+export * from \"./state\";\n"
        },
        {
          "path": "packages/types/src/intake/state.ts",
          "status": "added",
          "diff": "Index: packages/types/src/intake/state.ts\n===================================================================\n--- packages/types/src/intake/state.ts\tdbc5a63 (parent)\n+++ packages/types/src/intake/state.ts\t78fbdde (commit)\n@@ -0,0 +1,13 @@\n+export type TIntakeStateGroups = \"triage\";\n+\n+export interface IIntakeState {\n+  readonly id: string;\n+  color: string;\n+  default: boolean;\n+  description: string;\n+  group: TIntakeStateGroups;\n+  name: string;\n+  project_id: string;\n+  sequence: number;\n+  workspace_id: string;\n+}\n"
        }
      ]
    },
    {
      "id": "fix-markdown-copy",
      "sha": "d462546055e96efc56b81f44fbd0d0b1398802ae",
      "parentSha": "f510020daacef8e5d0ad80b589ad78d285527115",
      "spec": "Implement Markdown copy conversion with custom components support across editors.\n\n1) Add getEditorMetaData callback to editor core types and wire it through\n- In packages/editor/src/core/types/editor.ts:\n  - Add a required prop to IEditorProps: getEditorMetaData: (htmlContent: string) => TCustomComponentsMetaData (type from @plane/utils).\n- In packages/editor/src/core/types/hook.ts:\n  - Ensure hook prop types include getEditorMetaData wherever editor props are propagated.\n- In packages/editor/src/core/components/editors/* (document, collaborative, wrapper):\n  - Accept getEditorMetaData in props and forward it into editor setup.\n- In packages/editor/src/core/hooks/use-editor.ts and use-collaborative-editor.ts:\n  - Accept getEditorMetaData and pass it down to CoreEditorExtensions/UtilityExtension.\n\n2) Update core extensions to accept and use getEditorMetaData\n- In packages/editor/src/core/extensions/extensions.ts:\n  - Accept getEditorMetaData in arguments and pass to UtilityExtension.\n- In packages/editor/src/core/extensions/utility.ts:\n  - Use CORE_EXTENSIONS.UTILITY as the extension name (import as value).\n  - Accept getEditorMetaData and forward it to the MarkdownClipboardPlugin.\n\n3) Replace clipboard serialization with a DOM copy-to-Markdown handler\n- In packages/editor/src/core/plugins/markdown-clipboard.ts:\n  - Change plugin to accept { editor, getEditorMetaData }.\n  - Implement a handleDOMEvents.copy handler that:\n    - Prevents default and clears clipboard data.\n    - Reads editor HTML and builds metaData via getEditorMetaData(editorHTML).\n    - Serializes the current selection to HTML and converts it to Markdown using convertHTMLToMarkdown({ description_html, metaData }) from @plane/utils.\n    - Writes text/plain (Markdown) and text/html (HTML fragment) to the clipboard.\n\n4) Provide HTML-to-Markdown conversion in @plane/utils\n- Under packages/utils/src/editor/ create:\n  - markdown-parser/types.ts: TCustomComponentsMetaData with file_assets [{id,name,url}] and user_mentions [{id,display_name,url}].\n  - markdown-parser/common.ts: small helpers (e.g., createTextNode).\n  - markdown-parser/marks-handler.ts: handlers for inline marks (em/italic/underline) producing Markdown.\n  - markdown-parser/custom-components-handler.ts: handlers for image-component, img, and mention-component that output proper Markdown using metaData.\n  - markdown-parser/root.ts: export convertHTMLToMarkdown({ description_html, metaData, name? }) that:\n    - Optionally prefixes an H1 when name is provided.\n    - Uses unified with rehype-parse, a plugin to flatten task items and insert a space after checkboxes, rehype-remark with custom handlers, remark-gfm, and remark-stringify.\n  - editor/common.ts and editor/index.ts to expose editor helpers and the parser.\n- Update packages/utils/package.json to include unified, rehype-parse, rehype-remark, remark-gfm, remark-stringify and relevant @types.\n\n5) Implement metadata hooks for apps/web and apps/space\n- apps/web/core/hooks/use-parse-editor-content.ts:\n  - Change signature to useParseEditorContent({ projectId?: string; workspaceSlug: string }).\n  - Add getEditorMetaData(htmlContent) that parses <image-component> and <mention-component>, resolves image URLs via getEditorAssetSrc({ assetId, projectId, workspaceSlug }) and mention display_name via getUserDetails, building profile URLs under the workspace.\n  - Ensure existing HTML/Markdown replacement helpers still work and use parseAdditionalEditorContent.\n- apps/space/core/hooks/use-parse-editor-content.ts (new):\n  - Expose useParseEditorContent({ anchor }) returning getEditorMetaData(htmlContent) that resolves image-component URLs via getEditorAssetSrc(anchor, src) and mention display_name via getMemberById, building profile URLs without workspace slug.\n\n6) Pass getEditorMetaData to all app editors\n- apps/web/core/components/editor/* (document, lite-text, rich-text, sticky-editor):\n  - Compute getEditorMetaData via useParseEditorContent({ projectId, workspaceSlug }).\n  - Add getEditorMetaData to prop types and pass to editor instances.\n- apps/space/core/components/editor/* (lite-text-editor.tsx, rich-text-editor.tsx):\n  - Compute getEditorMetaData via useParseEditorContent({ anchor }) and pass along.\n\n7) Adjust page editor components and export modal\n- apps/web/core/components/pages/editor/header/root.tsx and page-root.tsx: make projectId optional.\n- apps/web/core/components/pages/editor/editor-body.tsx: accept optional projectId, initialize and pass getEditorMetaData.\n- apps/web/core/components/pages/modals/export-page-modal.tsx: initialize useParseEditorContent with { projectId, workspaceSlug } from route params.\n\n8) Imports and constants\n- Ensure imports of CORE_EXTENSIONS are as values where needed and reference CORE_EXTENSIONS.UTILITY for extension name.\n- Ensure utils editor exports come from packages/utils/src/editor/index.ts.\n\nAcceptance criteria\n- Copying in any editor places Markdown in text/plain and the HTML fragment in text/html on the clipboard.\n- Mentions are converted to links with display names; image-component/img become Markdown image links using resolved URLs.\n- Task list items render as GFM with a space after checkbox inputs.\n- All editors compile with the new getEditorMetaData prop and the utils package compiles with new dependencies.",
      "prompt": "Enable Markdown copy across editors that preserves Plane-specific content. Add a callback that extracts metadata about images and mentions from the current editor content, wire it from app hooks into the core editor, and update the clipboard behavior to convert the selected HTML into Markdown using a new conversion utility. Ensure mentions, images, and task items are represented correctly in the Markdown output. Update web and space editors to provide this callback, and make minor prop/type adjustments so page editors and export flows continue working.",
      "supplementalFiles": [
        "packages/editor/src/core/constants/extension.ts",
        "packages/utils/src/file.ts",
        "apps/space/helpers/editor.helper.ts"
      ],
      "fileDiffs": [
        {
          "path": "apps/space/core/components/editor/lite-text-editor.tsx",
          "status": "modified",
          "diff": "Index: apps/space/core/components/editor/lite-text-editor.tsx\n===================================================================\n--- apps/space/core/components/editor/lite-text-editor.tsx\tf510020 (parent)\n+++ apps/space/core/components/editor/lite-text-editor.tsx\td462546 (commit)\n@@ -5,16 +5,19 @@\n import type { MakeOptional } from \"@plane/types\";\n import { cn, isCommentEmpty } from \"@plane/utils\";\n // helpers\n import { getEditorFileHandlers } from \"@/helpers/editor.helper\";\n+// hooks\n+import { useParseEditorContent } from \"@/hooks/use-parse-editor-content\";\n+// plane web imports\n import { useEditorFlagging } from \"@/plane-web/hooks/use-editor-flagging\";\n // local imports\n import { EditorMentionsRoot } from \"./embeds/mentions\";\n import { IssueCommentToolbar } from \"./toolbar\";\n \n type LiteTextEditorWrapperProps = MakeOptional<\n   Omit<ILiteTextEditorProps, \"fileHandler\" | \"mentionHandler\" | \"extendedEditorProps\">,\n-  \"disabledExtensions\" | \"flaggedExtensions\"\n+  \"disabledExtensions\" | \"flaggedExtensions\" | \"getEditorMetaData\"\n > & {\n   anchor: string;\n   isSubmitting?: boolean;\n   showSubmitButton?: boolean;\n@@ -46,8 +49,12 @@\n   // derived values\n   const isEmpty = isCommentEmpty(props.initialValue);\n   const editorRef = isMutableRefObject<EditorRefApi>(ref) ? ref.current : null;\n   const { liteText: liteTextEditorExtensions } = useEditorFlagging(anchor);\n+  // parse content\n+  const { getEditorMetaData } = useParseEditorContent({\n+    anchor,\n+  });\n \n   return (\n     <div className=\"border border-custom-border-200 rounded p-3 space-y-3\">\n       <LiteTextEditorWithRef\n@@ -59,8 +66,9 @@\n           anchor,\n           uploadFile: editable ? props.uploadFile : async () => \"\",\n           workspaceId,\n         })}\n+        getEditorMetaData={getEditorMetaData}\n         mentionHandler={{\n           renderComponent: (props) => <EditorMentionsRoot {...props} />,\n         }}\n         extendedEditorProps={{}}\n"
        },
        {
          "path": "apps/space/core/components/editor/rich-text-editor.tsx",
          "status": "modified",
          "diff": "Index: apps/space/core/components/editor/rich-text-editor.tsx\n===================================================================\n--- apps/space/core/components/editor/rich-text-editor.tsx\tf510020 (parent)\n+++ apps/space/core/components/editor/rich-text-editor.tsx\td462546 (commit)\n@@ -1,21 +1,22 @@\n-import React, { forwardRef } from \"react\";\n+import { forwardRef } from \"react\";\n // plane imports\n import { RichTextEditorWithRef } from \"@plane/editor\";\n import type { EditorRefApi, IRichTextEditorProps, TFileHandler } from \"@plane/editor\";\n import type { MakeOptional } from \"@plane/types\";\n // helpers\n import { getEditorFileHandlers } from \"@/helpers/editor.helper\";\n // hooks\n import { useMember } from \"@/hooks/store/use-member\";\n+import { useParseEditorContent } from \"@/hooks/use-parse-editor-content\";\n // plane web imports\n import { useEditorFlagging } from \"@/plane-web/hooks/use-editor-flagging\";\n // local imports\n import { EditorMentionsRoot } from \"./embeds/mentions\";\n \n type RichTextEditorWrapperProps = MakeOptional<\n   Omit<IRichTextEditorProps, \"editable\" | \"fileHandler\" | \"mentionHandler\" | \"extendedEditorProps\">,\n-  \"disabledExtensions\" | \"flaggedExtensions\"\n+  \"disabledExtensions\" | \"flaggedExtensions\" | \"getEditorMetaData\"\n > & {\n   anchor: string;\n   workspaceId: string;\n } & (\n@@ -36,9 +37,15 @@\n     workspaceId,\n     disabledExtensions: additionalDisabledExtensions = [],\n     ...rest\n   } = props;\n+  // store hooks\n   const { getMemberById } = useMember();\n+  // parse content\n+  const { getEditorMetaData } = useParseEditorContent({\n+    anchor,\n+  });\n+  // editor flaggings\n   const { richText: richTextEditorExtensions } = useEditorFlagging(anchor);\n \n   return (\n     <RichTextEditorWithRef\n@@ -55,8 +62,9 @@\n         anchor,\n         uploadFile: editable ? props.uploadFile : async () => \"\",\n         workspaceId,\n       })}\n+      getEditorMetaData={getEditorMetaData}\n       flaggedExtensions={richTextEditorExtensions.flagged}\n       extendedEditorProps={{}}\n       {...rest}\n       containerClassName={containerClassName}\n"
        },
        {
          "path": "apps/space/core/hooks/use-parse-editor-content.ts",
          "status": "added",
          "diff": "Index: apps/space/core/hooks/use-parse-editor-content.ts\n===================================================================\n--- apps/space/core/hooks/use-parse-editor-content.ts\tf510020 (parent)\n+++ apps/space/core/hooks/use-parse-editor-content.ts\td462546 (commit)\n@@ -0,0 +1,69 @@\n+import { useCallback } from \"react\";\n+// helpers\n+import type { TCustomComponentsMetaData } from \"@plane/utils\";\n+// helpers\n+import { getEditorAssetSrc } from \"@/helpers/editor.helper\";\n+// hooks\n+import { useMember } from \"@/hooks/store/use-member\";\n+\n+type TArgs = {\n+  anchor: string;\n+};\n+\n+export const useParseEditorContent = (args: TArgs) => {\n+  const { anchor } = args;\n+  // store hooks\n+  const { getMemberById } = useMember();\n+\n+  const getEditorMetaData = useCallback(\n+    (htmlContent: string): TCustomComponentsMetaData => {\n+      const parser = new DOMParser();\n+      const doc = parser.parseFromString(htmlContent, \"text/html\");\n+      const imageMetaData: TCustomComponentsMetaData[\"file_assets\"] = [];\n+      // process image components\n+      const imageComponents = doc.querySelectorAll(\"image-component\");\n+      imageComponents.forEach((element) => {\n+        const src = element.getAttribute(\"src\");\n+        if (src) {\n+          const assetSrc = src.startsWith(\"http\") ? src : getEditorAssetSrc(anchor, src);\n+          if (assetSrc) {\n+            imageMetaData.push({\n+              id: src,\n+              name: src,\n+              url: assetSrc,\n+            });\n+          }\n+        }\n+      });\n+      // process user mentions\n+      const userMentions: TCustomComponentsMetaData[\"user_mentions\"] = [];\n+      const mentionComponents = doc.querySelectorAll(\"mention-component\");\n+      mentionComponents.forEach((element) => {\n+        const id = element.getAttribute(\"entity_identifier\");\n+        if (id) {\n+          const userDetails = getMemberById(id);\n+          const originUrl = typeof window !== \"undefined\" && (window.location.origin ?? \"\");\n+          const path = `profile/${id}`;\n+          const url = `${originUrl}/${path}`;\n+          if (userDetails) {\n+            userMentions.push({\n+              id,\n+              display_name: userDetails.member__display_name,\n+              url,\n+            });\n+          }\n+        }\n+      });\n+\n+      return {\n+        file_assets: imageMetaData,\n+        user_mentions: userMentions,\n+      };\n+    },\n+    [anchor, getMemberById]\n+  );\n+\n+  return {\n+    getEditorMetaData,\n+  };\n+};\n"
        },
        {
          "path": "apps/web/core/components/editor/document/editor.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/editor/document/editor.tsx\n===================================================================\n--- apps/web/core/components/editor/document/editor.tsx\tf510020 (parent)\n+++ apps/web/core/components/editor/document/editor.tsx\td462546 (commit)\n@@ -6,16 +6,17 @@\n import { cn } from \"@plane/utils\";\n // hooks\n import { useEditorConfig, useEditorMention } from \"@/hooks/editor\";\n import { useMember } from \"@/hooks/store/use-member\";\n+import { useParseEditorContent } from \"@/hooks/use-parse-editor-content\";\n // plane web hooks\n import { useEditorFlagging } from \"@/plane-web/hooks/use-editor-flagging\";\n // local imports\n import { EditorMentionsRoot } from \"../embeds/mentions\";\n \n type DocumentEditorWrapperProps = MakeOptional<\n   Omit<IDocumentEditorProps, \"fileHandler\" | \"mentionHandler\" | \"user\" | \"extendedEditorProps\">,\n-  \"disabledExtensions\" | \"editable\" | \"flaggedExtensions\"\n+  \"disabledExtensions\" | \"editable\" | \"flaggedExtensions\" | \"getEditorMetaData\"\n > & {\n   extendedEditorProps?: Partial<IEditorPropsExtended>;\n   workspaceSlug: string;\n   workspaceId: string;\n@@ -43,8 +44,13 @@\n     ...rest\n   } = props;\n   // store hooks\n   const { getUserDetails } = useMember();\n+  // parse content\n+  const { getEditorMetaData } = useParseEditorContent({\n+    projectId,\n+    workspaceSlug,\n+  });\n   // editor flaggings\n   const { document: documentEditorExtensions } = useEditorFlagging({\n     workspaceSlug: workspaceSlug?.toString() ?? \"\",\n   });\n@@ -67,8 +73,9 @@\n         uploadFile: editable ? props.uploadFile : async () => \"\",\n         workspaceId,\n         workspaceSlug,\n       })}\n+      getEditorMetaData={getEditorMetaData}\n       mentionHandler={{\n         searchCallback: async (query) => {\n           const res = await fetchMentions(query);\n           if (!res) throw new Error(\"Failed in fetching mentions\");\n"
        },
        {
          "path": "apps/web/core/components/editor/lite-text/editor.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/editor/lite-text/editor.tsx\n===================================================================\n--- apps/web/core/components/editor/lite-text/editor.tsx\tf510020 (parent)\n+++ apps/web/core/components/editor/lite-text/editor.tsx\td462546 (commit)\n@@ -12,8 +12,9 @@\n import { IssueCommentToolbar } from \"@/components/editor/lite-text/toolbar\";\n // hooks\n import { useEditorConfig, useEditorMention } from \"@/hooks/editor\";\n import { useMember } from \"@/hooks/store/use-member\";\n+import { useParseEditorContent } from \"@/hooks/use-parse-editor-content\";\n // plane web hooks\n import { useEditorFlagging } from \"@/plane-web/hooks/use-editor-flagging\";\n // plane web service\n import { WorkspaceService } from \"@/plane-web/services\";\n@@ -21,9 +22,9 @@\n const workspaceService = new WorkspaceService();\n \n type LiteTextEditorWrapperProps = MakeOptional<\n   Omit<ILiteTextEditorProps, \"fileHandler\" | \"mentionHandler\" | \"extendedEditorProps\">,\n-  \"disabledExtensions\" | \"flaggedExtensions\"\n+  \"disabledExtensions\" | \"flaggedExtensions\" | \"getEditorMetaData\"\n > & {\n   workspaceSlug: string;\n   workspaceId: string;\n   projectId?: string;\n@@ -79,8 +80,13 @@\n     workspaceSlug: workspaceSlug?.toString() ?? \"\",\n   });\n   // store hooks\n   const { getUserDetails } = useMember();\n+  // parse content\n+  const { getEditorMetaData } = useParseEditorContent({\n+    projectId,\n+    workspaceSlug,\n+  });\n   // use editor mention\n   const { fetchMentions } = useEditorMention({\n     searchEntity: async (payload) =>\n       await workspaceService.searchEntity(workspaceSlug, {\n@@ -123,8 +129,9 @@\n               uploadFile: editable ? props.uploadFile : async () => \"\",\n               workspaceId,\n               workspaceSlug,\n             })}\n+            getEditorMetaData={getEditorMetaData}\n             handleEditorReady={(ready) => {\n               if (ready) {\n                 setEditorRef(isMutableRefObject<EditorRefApi>(ref) ? ref.current : null);\n               }\n"
        },
        {
          "path": "apps/web/core/components/editor/rich-text/editor.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/editor/rich-text/editor.tsx\n===================================================================\n--- apps/web/core/components/editor/rich-text/editor.tsx\tf510020 (parent)\n+++ apps/web/core/components/editor/rich-text/editor.tsx\td462546 (commit)\n@@ -1,5 +1,5 @@\n-import React, { forwardRef } from \"react\";\n+import { forwardRef } from \"react\";\n // plane imports\n import { RichTextEditorWithRef } from \"@plane/editor\";\n import type { EditorRefApi, IRichTextEditorProps, TFileHandler } from \"@plane/editor\";\n import type { MakeOptional, TSearchEntityRequestPayload, TSearchResponse } from \"@plane/types\";\n@@ -8,14 +8,15 @@\n import { EditorMentionsRoot } from \"@/components/editor/embeds/mentions\";\n // hooks\n import { useEditorConfig, useEditorMention } from \"@/hooks/editor\";\n import { useMember } from \"@/hooks/store/use-member\";\n+import { useParseEditorContent } from \"@/hooks/use-parse-editor-content\";\n // plane web hooks\n import { useEditorFlagging } from \"@/plane-web/hooks/use-editor-flagging\";\n \n type RichTextEditorWrapperProps = MakeOptional<\n   Omit<IRichTextEditorProps, \"fileHandler\" | \"mentionHandler\" | \"extendedEditorProps\">,\n-  \"disabledExtensions\" | \"editable\" | \"flaggedExtensions\"\n+  \"disabledExtensions\" | \"editable\" | \"flaggedExtensions\" | \"getEditorMetaData\"\n > & {\n   workspaceSlug: string;\n   workspaceId: string;\n   projectId?: string;\n@@ -52,8 +53,13 @@\n     searchEntity: editable ? async (payload) => await props.searchMentionCallback(payload) : async () => ({}),\n   });\n   // editor config\n   const { getEditorFileHandlers } = useEditorConfig();\n+  // parse content\n+  const { getEditorMetaData } = useParseEditorContent({\n+    projectId,\n+    workspaceSlug,\n+  });\n \n   return (\n     <RichTextEditorWithRef\n       ref={ref}\n@@ -65,8 +71,9 @@\n         uploadFile: editable ? props.uploadFile : async () => \"\",\n         workspaceId,\n         workspaceSlug,\n       })}\n+      getEditorMetaData={getEditorMetaData}\n       mentionHandler={{\n         searchCallback: async (query) => {\n           const res = await fetchMentions(query);\n           if (!res) throw new Error(\"Failed in fetching mentions\");\n"
        },
        {
          "path": "apps/web/core/components/editor/sticky-editor/editor.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/editor/sticky-editor/editor.tsx\n===================================================================\n--- apps/web/core/components/editor/sticky-editor/editor.tsx\tf510020 (parent)\n+++ apps/web/core/components/editor/sticky-editor/editor.tsx\td462546 (commit)\n@@ -9,16 +9,17 @@\n // helpers\n import { cn } from \"@plane/utils\";\n // hooks\n import { useEditorConfig } from \"@/hooks/editor\";\n+import { useParseEditorContent } from \"@/hooks/use-parse-editor-content\";\n // plane web hooks\n import { useEditorFlagging } from \"@/plane-web/hooks/use-editor-flagging\";\n import { StickyEditorToolbar } from \"./toolbar\";\n \n interface StickyEditorWrapperProps\n   extends Omit<\n     Omit<ILiteTextEditorProps, \"extendedEditorProps\">,\n-    \"disabledExtensions\" | \"editable\" | \"flaggedExtensions\" | \"fileHandler\" | \"mentionHandler\"\n+    \"disabledExtensions\" | \"editable\" | \"flaggedExtensions\" | \"fileHandler\" | \"mentionHandler\" | \"getEditorMetaData\"\n   > {\n   workspaceSlug: string;\n   workspaceId: string;\n   projectId?: string;\n@@ -54,15 +55,21 @@\n   // editor flaggings\n   const { liteText: liteTextEditorExtensions } = useEditorFlagging({\n     workspaceSlug: workspaceSlug?.toString() ?? \"\",\n   });\n+  // parse content\n+  const { getEditorMetaData } = useParseEditorContent({\n+    projectId,\n+    workspaceSlug,\n+  });\n   // editor config\n   const { getEditorFileHandlers } = useEditorConfig();\n   function isMutableRefObject<T>(ref: React.ForwardedRef<T>): ref is React.MutableRefObject<T | null> {\n     return !!ref && typeof ref === \"object\" && \"current\" in ref;\n   }\n   // derived values\n   const editorRef = isMutableRefObject<EditorRefApi>(ref) ? ref.current : null;\n+\n   return (\n     <div\n       className={cn(\"relative border border-custom-border-200 rounded\", parentClassName)}\n       onFocus={() => !showToolbarInitially && setIsFocused(true)}\n@@ -78,8 +85,9 @@\n           uploadFile,\n           workspaceId,\n           workspaceSlug,\n         })}\n+        getEditorMetaData={getEditorMetaData}\n         mentionHandler={{\n           renderComponent: () => <></>,\n         }}\n         extendedEditorProps={{}}\n"
        },
        {
          "path": "apps/web/core/components/pages/editor/editor-body.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/pages/editor/editor-body.tsx\n===================================================================\n--- apps/web/core/components/pages/editor/editor-body.tsx\tf510020 (parent)\n+++ apps/web/core/components/pages/editor/editor-body.tsx\td462546 (commit)\n@@ -23,8 +23,9 @@\n import { useMember } from \"@/hooks/store/use-member\";\n import { useWorkspace } from \"@/hooks/store/use-workspace\";\n import { useUser } from \"@/hooks/store/user\";\n import { usePageFilters } from \"@/hooks/use-page-filters\";\n+import { useParseEditorContent } from \"@/hooks/use-parse-editor-content\";\n // plane web imports\n import { EditorAIMenu } from \"@/plane-web/components/pages\";\n import type { TExtendedEditorExtensionsConfig } from \"@/plane-web/hooks/pages\";\n import type { EPageStoreType } from \"@/plane-web/hooks/store\";\n@@ -56,12 +57,11 @@\n   handlers: TEditorBodyHandlers;\n   isNavigationPaneOpen: boolean;\n   page: TPageInstance;\n   webhookConnectionParams: TWebhookConnectionQueryParams;\n-  projectId: string;\n+  projectId?: string;\n   workspaceSlug: string;\n   storeType: EPageStoreType;\n-\n   extendedEditorProps: TExtendedEditorExtensionsConfig;\n };\n \n export const PageEditorBody: React.FC<Props> = observer((props) => {\n@@ -102,8 +102,13 @@\n   const { document: documentEditorExtensions } = useEditorFlagging({\n     workspaceSlug,\n     storeType,\n   });\n+  // parse content\n+  const { getEditorMetaData } = useParseEditorContent({\n+    projectId,\n+    workspaceSlug,\n+  });\n   // page filters\n   const { fontSize, fontStyle, isFullWidth } = usePageFilters();\n   // translation\n   const { t } = useTranslation();\n@@ -234,8 +239,9 @@\n           handleEditorReady={handleEditorReady}\n           ref={editorForwardRef}\n           containerClassName=\"h-full p-0 pb-64\"\n           displayConfig={displayConfig}\n+          getEditorMetaData={getEditorMetaData}\n           mentionHandler={{\n             searchCallback: async (query) => {\n               const res = await fetchMentions(query);\n               if (!res) throw new Error(\"Failed in fetching mentions\");\n"
        },
        {
          "path": "apps/web/core/components/pages/editor/header/root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/pages/editor/header/root.tsx\n===================================================================\n--- apps/web/core/components/pages/editor/header/root.tsx\tf510020 (parent)\n+++ apps/web/core/components/pages/editor/header/root.tsx\td462546 (commit)\n@@ -10,9 +10,9 @@\n import { PageEditorHeaderLogoPicker } from \"./logo-picker\";\n \n type Props = {\n   page: TPageInstance;\n-  projectId: string;\n+  projectId?: string;\n };\n \n export const PageEditorHeaderRoot: React.FC<Props> = observer((props) => {\n   const { page } = props;\n"
        },
        {
          "path": "apps/web/core/components/pages/editor/page-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/pages/editor/page-root.tsx\n===================================================================\n--- apps/web/core/components/pages/editor/page-root.tsx\tf510020 (parent)\n+++ apps/web/core/components/pages/editor/page-root.tsx\td462546 (commit)\n@@ -36,9 +36,9 @@\n   handlers: TPageRootHandlers;\n   page: TPageInstance;\n   storeType: EPageStoreType;\n   webhookConnectionParams: TWebhookConnectionQueryParams;\n-  projectId: string;\n+  projectId?: string;\n   workspaceSlug: string;\n };\n \n export const PageRoot = observer((props: TPageRootProps) => {\n"
        },
        {
          "path": "apps/web/core/components/pages/modals/export-page-modal.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/pages/modals/export-page-modal.tsx\n===================================================================\n--- apps/web/core/components/pages/modals/export-page-modal.tsx\tf510020 (parent)\n+++ apps/web/core/components/pages/modals/export-page-modal.tsx\td462546 (commit)\n@@ -3,8 +3,9 @@\n import { useState } from \"react\";\n import type { PageProps } from \"@react-pdf/renderer\";\n import { pdf } from \"@react-pdf/renderer\";\n import { Controller, useForm } from \"react-hook-form\";\n+import { useParams } from \"react-router\";\n // plane editor\n import type { EditorRefApi } from \"@plane/editor\";\n // plane ui\n import { Button } from \"@plane/propel/button\";\n@@ -99,15 +100,19 @@\n export const ExportPageModal: React.FC<Props> = (props) => {\n   const { editorRef, isOpen, onClose, pageTitle } = props;\n   // states\n   const [isExporting, setIsExporting] = useState(false);\n+  // params\n+  const { workspaceSlug, projectId } = useParams();\n   // form info\n   const { control, reset, watch } = useForm<TFormValues>({\n     defaultValues,\n   });\n   // parse editor content\n-  const { replaceCustomComponentsFromHTMLContent, replaceCustomComponentsFromMarkdownContent } =\n-    useParseEditorContent();\n+  const { replaceCustomComponentsFromHTMLContent, replaceCustomComponentsFromMarkdownContent } = useParseEditorContent({\n+    projectId,\n+    workspaceSlug: workspaceSlug ?? \"\",\n+  });\n   // derived values\n   const selectedExportFormat = watch(\"export_format\");\n   const selectedPageFormat = watch(\"page_format\");\n   const selectedContentVariety = watch(\"content_variety\");\n"
        },
        {
          "path": "apps/web/core/hooks/use-parse-editor-content.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/hooks/use-parse-editor-content.ts\n===================================================================\n--- apps/web/core/hooks/use-parse-editor-content.ts\tf510020 (parent)\n+++ apps/web/core/hooks/use-parse-editor-content.ts\td462546 (commit)\n@@ -1,18 +1,22 @@\n import { useCallback } from \"react\";\n-import { useParams } from \"next/navigation\";\n // plane types\n import type { TSearchEntities } from \"@plane/types\";\n // helpers\n-import { getBase64Image } from \"@plane/utils\";\n+import { getBase64Image, getEditorAssetSrc } from \"@plane/utils\";\n+import type { TCustomComponentsMetaData } from \"@plane/utils\";\n // hooks\n import { useMember } from \"@/hooks/store/use-member\";\n // plane web hooks\n import { useAdditionalEditorMention } from \"@/plane-web/hooks/use-additional-editor-mention\";\n \n-export const useParseEditorContent = () => {\n-  // params\n-  const { workspaceSlug } = useParams();\n+type TArgs = {\n+  projectId?: string;\n+  workspaceSlug: string;\n+};\n+\n+export const useParseEditorContent = (args: TArgs) => {\n+  const { projectId, workspaceSlug } = args;\n   // store hooks\n   const { getUserDetails } = useMember();\n   // parse additional content\n   const { parseAdditionalEditorContent } = useAdditionalEditorMention({\n@@ -149,9 +153,9 @@\n       // remove null colors from table elements\n       serializedDoc = serializedDoc.replace(/background-color: null/g, \"\").replace(/color: null/g, \"\");\n       return serializedDoc;\n     },\n-    [getUserDetails]\n+    [getUserDetails, parseAdditionalEditorContent]\n   );\n \n   /**\n    * @description function to replace all the custom components from the markdown content\n@@ -159,9 +163,8 @@\n    * @returns {string}\n    */\n   const replaceCustomComponentsFromMarkdownContent = useCallback(\n     (props: { markdownContent: string; noAssets?: boolean }): string => {\n-      const start = performance.now();\n       const { markdownContent, noAssets = false } = props;\n       let parsedMarkdownContent = markdownContent;\n       // replace the matched mention components with [display_name](redirect_url)\n       const mentionRegex =\n@@ -202,16 +205,69 @@\n       }\n       // remove all issue-embed components\n       const issueEmbedRegex = /<issue-embed-component[^>]*>[^]*<\\/issue-embed-component>/g;\n       parsedMarkdownContent = parsedMarkdownContent.replace(issueEmbedRegex, \"\");\n-      const end = performance.now();\n-      console.log(\"Exec time:\", end - start);\n       return parsedMarkdownContent;\n     },\n-    [getUserDetails, workspaceSlug]\n+    [getUserDetails, parseAdditionalEditorContent, workspaceSlug]\n   );\n \n+  const getEditorMetaData = useCallback(\n+    (htmlContent: string): TCustomComponentsMetaData => {\n+      const parser = new DOMParser();\n+      const doc = parser.parseFromString(htmlContent, \"text/html\");\n+      const imageMetaData: TCustomComponentsMetaData[\"file_assets\"] = [];\n+      // process image components\n+      const imageComponents = doc.querySelectorAll(\"image-component\");\n+      imageComponents.forEach((element) => {\n+        const src = element.getAttribute(\"src\");\n+        if (src) {\n+          const assetSrc = src.startsWith(\"http\")\n+            ? src\n+            : getEditorAssetSrc({\n+                assetId: src,\n+                projectId,\n+                workspaceSlug,\n+              });\n+          if (assetSrc) {\n+            imageMetaData.push({\n+              id: src,\n+              name: src,\n+              url: assetSrc,\n+            });\n+          }\n+        }\n+      });\n+      // process user mentions\n+      const userMentions: TCustomComponentsMetaData[\"user_mentions\"] = [];\n+      const mentionComponents = doc.querySelectorAll(\"mention-component\");\n+      mentionComponents.forEach((element) => {\n+        const id = element.getAttribute(\"entity_identifier\");\n+        if (id) {\n+          const userDetails = getUserDetails(id);\n+          const originUrl = typeof window !== \"undefined\" && (window.location.origin ?? \"\");\n+          const path = `${workspaceSlug}/profile/${id}`;\n+          const url = `${originUrl}/${path}`;\n+          if (userDetails) {\n+            userMentions.push({\n+              id,\n+              display_name: userDetails.display_name,\n+              url,\n+            });\n+          }\n+        }\n+      });\n+\n+      return {\n+        file_assets: imageMetaData,\n+        user_mentions: userMentions,\n+      };\n+    },\n+    [getUserDetails, projectId, workspaceSlug]\n+  );\n+\n   return {\n     replaceCustomComponentsFromHTMLContent,\n     replaceCustomComponentsFromMarkdownContent,\n+    getEditorMetaData,\n   };\n };\n"
        },
        {
          "path": "packages/editor/src/core/components/editors/document/collaborative-editor.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/components/editors/document/collaborative-editor.tsx\n===================================================================\n--- packages/editor/src/core/components/editors/document/collaborative-editor.tsx\tf510020 (parent)\n+++ packages/editor/src/core/components/editors/document/collaborative-editor.tsx\td462546 (commit)\n@@ -29,8 +29,9 @@\n     extendedEditorProps,\n     fileHandler,\n     flaggedExtensions,\n     forwardedRef,\n+    getEditorMetaData,\n     handleEditorReady,\n     id,\n     dragDropEnabled = true,\n     isTouchDevice,\n@@ -56,8 +57,9 @@\n     extendedEditorProps,\n     extensions,\n     fileHandler,\n     flaggedExtensions,\n+    getEditorMetaData,\n     forwardedRef,\n     handleEditorReady,\n     id,\n     dragDropEnabled,\n"
        },
        {
          "path": "packages/editor/src/core/components/editors/document/editor.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/components/editors/document/editor.tsx\n===================================================================\n--- packages/editor/src/core/components/editors/document/editor.tsx\tf510020 (parent)\n+++ packages/editor/src/core/components/editors/document/editor.tsx\td462546 (commit)\n@@ -29,11 +29,12 @@\n     extendedEditorProps,\n     fileHandler,\n     flaggedExtensions,\n     forwardedRef,\n+    getEditorMetaData,\n+    handleEditorReady,\n     id,\n     isTouchDevice,\n-    handleEditorReady,\n     mentionHandler,\n     onChange,\n     user,\n     value,\n@@ -71,8 +72,9 @@\n     extensions,\n     fileHandler,\n     flaggedExtensions,\n     forwardedRef,\n+    getEditorMetaData,\n     handleEditorReady,\n     id,\n     initialValue: value,\n     mentionHandler,\n"
        },
        {
          "path": "packages/editor/src/core/components/editors/editor-wrapper.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/components/editors/editor-wrapper.tsx\n===================================================================\n--- packages/editor/src/core/components/editors/editor-wrapper.tsx\tf510020 (parent)\n+++ packages/editor/src/core/components/editors/editor-wrapper.tsx\td462546 (commit)\n@@ -26,8 +26,9 @@\n     editorClassName = \"\",\n     editorProps,\n     extendedEditorProps,\n     extensions,\n+    getEditorMetaData,\n     id,\n     initialValue,\n     isTouchDevice,\n     fileHandler,\n@@ -54,8 +55,9 @@\n     extensions,\n     fileHandler,\n     flaggedExtensions,\n     forwardedRef,\n+    getEditorMetaData,\n     id,\n     isTouchDevice,\n     initialValue,\n     mentionHandler,\n"
        },
        {
          "path": "packages/editor/src/core/extensions/extensions.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/extensions.ts\n===================================================================\n--- packages/editor/src/core/extensions/extensions.ts\tf510020 (parent)\n+++ packages/editor/src/core/extensions/extensions.ts\td462546 (commit)\n@@ -42,8 +42,9 @@\n   IEditorProps,\n   | \"disabledExtensions\"\n   | \"flaggedExtensions\"\n   | \"fileHandler\"\n+  | \"getEditorMetaData\"\n   | \"isTouchDevice\"\n   | \"mentionHandler\"\n   | \"placeholder\"\n   | \"tabIndex\"\n@@ -59,8 +60,9 @@\n     disabledExtensions,\n     enableHistory,\n     fileHandler,\n     flaggedExtensions,\n+    getEditorMetaData,\n     isTouchDevice = false,\n     mentionHandler,\n     placeholder,\n     tabIndex,\n@@ -113,8 +115,9 @@\n     CustomCalloutExtension,\n     UtilityExtension({\n       disabledExtensions,\n       fileHandler,\n+      getEditorMetaData,\n       isEditable: editable,\n       isTouchDevice,\n     }),\n     ...CoreEditorAdditionalExtensions({\n"
        },
        {
          "path": "packages/editor/src/core/extensions/utility.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/utility.ts\n===================================================================\n--- packages/editor/src/core/extensions/utility.ts\tf510020 (parent)\n+++ packages/editor/src/core/extensions/utility.ts\td462546 (commit)\n@@ -1,8 +1,8 @@\n import { Extension } from \"@tiptap/core\";\n import codemark from \"prosemirror-codemark\";\n // helpers\n-import type { CORE_EXTENSIONS } from \"@/constants/extension\";\n+import { CORE_EXTENSIONS } from \"@/constants/extension\";\n import { restorePublicImages } from \"@/helpers/image-helpers\";\n // plugins\n import type { TAdditionalActiveDropbarExtensions } from \"@/plane-editor/types/utils\";\n import { DropHandlerPlugin } from \"@/plugins/drop\";\n@@ -49,20 +49,20 @@\n   activeDropbarExtensions: TActiveDropbarExtensions[];\n   isTouchDevice: boolean;\n };\n \n-type Props = Pick<IEditorProps, \"disabledExtensions\"> & {\n+type Props = Pick<IEditorProps, \"disabledExtensions\" | \"getEditorMetaData\"> & {\n   fileHandler: TFileHandler;\n   isEditable: boolean;\n   isTouchDevice: boolean;\n };\n \n export const UtilityExtension = (props: Props) => {\n-  const { disabledExtensions, fileHandler, isEditable, isTouchDevice } = props;\n+  const { disabledExtensions, fileHandler, getEditorMetaData, isEditable, isTouchDevice } = props;\n   const { restore } = fileHandler;\n \n   return Extension.create<Record<string, unknown>, UtilityExtensionStorage>({\n-    name: \"utility\",\n+    name: CORE_EXTENSIONS.UTILITY,\n     priority: 1000,\n \n     addProseMirrorPlugins() {\n       return [\n@@ -71,9 +71,12 @@\n           isEditable,\n           fileHandler,\n         }),\n         ...codemark({ markType: this.editor.schema.marks.code }),\n-        MarkdownClipboardPlugin(this.editor),\n+        MarkdownClipboardPlugin({\n+          editor: this.editor,\n+          getEditorMetaData,\n+        }),\n         DropHandlerPlugin({\n           disabledExtensions,\n           editor: this.editor,\n         }),\n"
        },
        {
          "path": "packages/editor/src/core/hooks/use-collaborative-editor.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/hooks/use-collaborative-editor.ts\n===================================================================\n--- packages/editor/src/core/hooks/use-collaborative-editor.ts\tf510020 (parent)\n+++ packages/editor/src/core/hooks/use-collaborative-editor.ts\td462546 (commit)\n@@ -23,8 +23,9 @@\n     extendedEditorProps,\n     extensions = [],\n     fileHandler,\n     flaggedExtensions,\n+    getEditorMetaData,\n     forwardedRef,\n     handleEditorReady,\n     id,\n     dragDropEnabled = true,\n@@ -108,8 +109,9 @@\n     ],\n     fileHandler,\n     flaggedExtensions,\n     forwardedRef,\n+    getEditorMetaData,\n     handleEditorReady,\n     isTouchDevice,\n     mentionHandler,\n     onAssetChange,\n"
        },
        {
          "path": "packages/editor/src/core/hooks/use-editor.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/hooks/use-editor.ts\n===================================================================\n--- packages/editor/src/core/hooks/use-editor.ts\tf510020 (parent)\n+++ packages/editor/src/core/hooks/use-editor.ts\td462546 (commit)\n@@ -28,8 +28,9 @@\n     extensions = [],\n     fileHandler,\n     flaggedExtensions,\n     forwardedRef,\n+    getEditorMetaData,\n     handleEditorReady,\n     id = \"\",\n     initialValue,\n     isTouchDevice,\n@@ -64,8 +65,9 @@\n           enableHistory,\n           extendedEditorProps,\n           fileHandler,\n           flaggedExtensions,\n+          getEditorMetaData,\n           isTouchDevice,\n           mentionHandler,\n           placeholder,\n           tabIndex,\n"
        },
        {
          "path": "packages/editor/src/core/plugins/markdown-clipboard.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/plugins/markdown-clipboard.ts\n===================================================================\n--- packages/editor/src/core/plugins/markdown-clipboard.ts\tf510020 (parent)\n+++ packages/editor/src/core/plugins/markdown-clipboard.ts\td462546 (commit)\n@@ -1,81 +1,44 @@\n import type { Editor } from \"@tiptap/core\";\n-import type { Fragment } from \"@tiptap/pm/model\";\n-import { Node } from \"@tiptap/pm/model\";\n import { Plugin, PluginKey } from \"@tiptap/pm/state\";\n-// constants\n-import { CORE_EXTENSIONS } from \"@/constants/extension\";\n+// plane imports\n+import { convertHTMLToMarkdown } from \"@plane/utils\";\n+import type { TCustomComponentsMetaData } from \"@plane/utils\";\n \n-export const MarkdownClipboardPlugin = (editor: Editor): Plugin =>\n-  new Plugin({\n-    key: new PluginKey(\"markdownClipboard\"),\n-    props: {\n-      clipboardTextSerializer: (slice) => {\n-        const markdownSerializer = editor.storage.markdown.serializer;\n-        const isTableRow = slice.content.firstChild?.type?.name === CORE_EXTENSIONS.TABLE_ROW;\n-        const nodeSelect = slice.openStart === 0 && slice.openEnd === 0;\n+type TArgs = {\n+  editor: Editor;\n+  getEditorMetaData: (htmlContent: string) => TCustomComponentsMetaData;\n+};\n \n-        if (nodeSelect) {\n-          return markdownSerializer.serialize(slice.content);\n-        }\n+export const MarkdownClipboardPlugin = (args: TArgs): Plugin => {\n+  const { editor, getEditorMetaData } = args;\n \n-        const processTableContent = (tableNode: Node | Fragment) => {\n-          let result = \"\";\n-          tableNode.content?.forEach?.((tableRowNode: Node | Fragment) => {\n-            tableRowNode.content?.forEach?.((cell: Node) => {\n-              const cellContent = cell.content ? markdownSerializer.serialize(cell.content) : \"\";\n-              result += cellContent + \"\\n\";\n+  return new Plugin({\n+    key: new PluginKey(\"markdownClipboard\"),\n+    props: {\n+      handleDOMEvents: {\n+        copy: (view, event) => {\n+          try {\n+            event.preventDefault();\n+            event.clipboardData?.clearData();\n+            // editor meta data\n+            const editorHTML = editor.getHTML();\n+            const metaData = getEditorMetaData(editorHTML);\n+            // meta data from selection\n+            const clipboardHTML = view.serializeForClipboard(view.state.selection.content()).dom.innerHTML;\n+            // convert to markdown\n+            const markdown = convertHTMLToMarkdown({\n+              description_html: clipboardHTML,\n+              metaData,\n             });\n-          });\n-          return result;\n-        };\n-\n-        if (isTableRow) {\n-          const rowsCount = slice.content?.childCount || 0;\n-          const cellsCount = slice.content?.firstChild?.content?.childCount || 0;\n-          if (rowsCount === 1 || cellsCount === 1) {\n-            return processTableContent(slice.content);\n-          } else {\n-            return markdownSerializer.serialize(slice.content);\n+            event.clipboardData?.setData(\"text/plain\", markdown);\n+            event.clipboardData?.setData(\"text/html\", clipboardHTML);\n+            return true;\n+          } catch (error) {\n+            console.error(\"Failed to copy markdown content to clipboard:\", error);\n+            return false;\n           }\n-        }\n-\n-        const traverseToParentOfLeaf = (node: Node | null, parent: Fragment | Node, depth: number): Node | Fragment => {\n-          let currentNode = node;\n-          let currentParent = parent;\n-          let currentDepth = depth;\n-\n-          while (currentNode && currentDepth > 1 && currentNode.content?.firstChild) {\n-            if (currentNode.content?.childCount > 1) {\n-              if (currentNode.content.firstChild?.type?.name === CORE_EXTENSIONS.LIST_ITEM) {\n-                return currentParent;\n-              } else {\n-                return currentNode.content;\n-              }\n-            }\n-\n-            currentParent = currentNode;\n-            currentNode = currentNode.content?.firstChild || null;\n-            currentDepth--;\n-          }\n-\n-          return currentParent;\n-        };\n-\n-        if (slice.content.childCount > 1) {\n-          return markdownSerializer.serialize(slice.content);\n-        } else {\n-          const targetNode = traverseToParentOfLeaf(slice.content.firstChild, slice.content, slice.openStart);\n-\n-          let currentNode = targetNode;\n-          while (currentNode && currentNode.content && currentNode.childCount === 1 && currentNode.firstChild) {\n-            currentNode = currentNode.firstChild;\n-          }\n-          if (currentNode instanceof Node && currentNode.isText) {\n-            return currentNode.text;\n-          }\n-\n-          return markdownSerializer.serialize(targetNode);\n-        }\n+        },\n       },\n     },\n   });\n+};\n"
        },
        {
          "path": "packages/editor/src/core/types/editor.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/types/editor.ts\n===================================================================\n--- packages/editor/src/core/types/editor.ts\tf510020 (parent)\n+++ packages/editor/src/core/types/editor.ts\td462546 (commit)\n@@ -2,8 +2,10 @@\n import type { MarkType, NodeType } from \"@tiptap/pm/model\";\n import type { Selection } from \"@tiptap/pm/state\";\n import type { EditorProps, EditorView } from \"@tiptap/pm/view\";\n import type { NodeViewProps as TNodeViewProps } from \"@tiptap/react\";\n+// plane imports\n+import type { TCustomComponentsMetaData } from \"@plane/utils\";\n // extension types\n import type { TTextAlign } from \"@/extensions\";\n // plane editor imports\n import type {\n@@ -18,9 +20,8 @@\n   TDisplayConfig,\n   TDocumentEventEmitter,\n   TDocumentEventsServer,\n   TEditorAsset,\n-  TEmbedConfig,\n   TExtensions,\n   TFileHandler,\n   TMentionHandler,\n   TRealtimeConfig,\n@@ -150,8 +151,9 @@\n   extensions?: Extensions;\n   flaggedExtensions: TExtensions[];\n   fileHandler: TFileHandler;\n   forwardedRef?: React.MutableRefObject<EditorRefApi | null>;\n+  getEditorMetaData: (htmlContent: string) => TCustomComponentsMetaData;\n   handleEditorReady?: (value: boolean) => void;\n   id: string;\n   initialValue: string;\n   isTouchDevice?: boolean;\n"
        },
        {
          "path": "packages/editor/src/core/types/hook.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/types/hook.ts\n===================================================================\n--- packages/editor/src/core/types/hook.ts\tf510020 (parent)\n+++ packages/editor/src/core/types/hook.ts\td462546 (commit)\n@@ -10,8 +10,9 @@\n   | \"editorProps\"\n   | \"extendedEditorProps\"\n   | \"extensions\"\n   | \"flaggedExtensions\"\n+  | \"getEditorMetaData\"\n   | \"handleEditorReady\"\n   | \"isTouchDevice\"\n   | \"onEditorFocus\"\n >;\n"
        },
        {
          "path": "packages/utils/package.json",
          "status": "modified",
          "diff": "Index: packages/utils/package.json\n===================================================================\n--- packages/utils/package.json\tf510020 (parent)\n+++ packages/utils/package.json\td462546 (commit)\n@@ -27,18 +27,28 @@\n     \"@plane/types\": \"workspace:*\",\n     \"clsx\": \"^2.1.1\",\n     \"date-fns\": \"^4.1.0\",\n     \"dompurify\": \"3.2.7\",\n+    \"hast\": \"^1.0.0\",\n+    \"hast-util-to-mdast\": \"^10.1.2\",\n     \"lodash-es\": \"catalog:\",\n     \"lucide-react\": \"catalog:\",\n+    \"mdast\": \"^3.0.0\",\n     \"react\": \"catalog:\",\n+    \"rehype-parse\": \"^9.0.1\",\n+    \"rehype-remark\": \"^10.0.1\",\n+    \"remark-gfm\": \"^4.0.1\",\n+    \"remark-stringify\": \"^11.0.0\",\n     \"tailwind-merge\": \"^2.5.5\",\n+    \"unified\": \"^11.0.5\",\n     \"uuid\": \"catalog:\"\n   },\n   \"devDependencies\": {\n     \"@plane/eslint-config\": \"workspace:*\",\n     \"@plane/typescript-config\": \"workspace:*\",\n+    \"@types/hast\": \"^3.0.4\",\n     \"@types/lodash-es\": \"catalog:\",\n+    \"@types/mdast\": \"^4.0.4\",\n     \"@types/node\": \"catalog:\",\n     \"@types/react\": \"catalog:\",\n     \"tsdown\": \"catalog:\",\n     \"typescript\": \"catalog:\"\n"
        },
        {
          "path": "packages/utils/src/editor/common.ts",
          "status": "renamed",
          "oldPath": "packages/utils/src/editor.ts",
          "diff": "===================================================================\n--- packages/utils/src/editor.ts\tf510020 (parent)\n+++ packages/utils/src/editor/common.ts\td462546 (commit)\n@@ -1,6 +1,6 @@\n // local imports\n-import { getFileURL } from \"./file\";\n+import { getFileURL } from \"../file\";\n \n type TEditorSrcArgs = {\n   assetId: string;\n   projectId?: string;\n"
        },
        {
          "path": "packages/utils/src/editor/index.ts",
          "status": "added",
          "diff": "Index: packages/utils/src/editor/index.ts\n===================================================================\n--- packages/utils/src/editor/index.ts\tf510020 (parent)\n+++ packages/utils/src/editor/index.ts\td462546 (commit)\n@@ -0,0 +1,2 @@\n+export * from \"./common\";\n+export * from \"./markdown-parser\";\n"
        },
        {
          "path": "packages/utils/src/editor/markdown-parser/common.ts",
          "status": "added",
          "diff": "Index: packages/utils/src/editor/markdown-parser/common.ts\n===================================================================\n--- packages/utils/src/editor/markdown-parser/common.ts\tf510020 (parent)\n+++ packages/utils/src/editor/markdown-parser/common.ts\td462546 (commit)\n@@ -0,0 +1,6 @@\n+import type { Text as MDASTText } from \"mdast\";\n+\n+export const createTextNode = (value: string): MDASTText => ({\n+  type: \"text\",\n+  value,\n+});\n"
        },
        {
          "path": "packages/utils/src/editor/markdown-parser/custom-components-handler.ts",
          "status": "added",
          "diff": "Index: packages/utils/src/editor/markdown-parser/custom-components-handler.ts\n===================================================================\n--- packages/utils/src/editor/markdown-parser/custom-components-handler.ts\tf510020 (parent)\n+++ packages/utils/src/editor/markdown-parser/custom-components-handler.ts\td462546 (commit)\n@@ -0,0 +1,41 @@\n+import type { Handle } from \"hast-util-to-mdast\";\n+// local imports\n+import { createTextNode } from \"./common\";\n+import type { TCustomComponentsMetaData } from \"./types\";\n+\n+type TArgs = {\n+  metaData: TCustomComponentsMetaData;\n+};\n+\n+export const parseCustomComponents = (args: TArgs): Record<string, Handle> => {\n+  const { metaData } = args;\n+\n+  const getFileAssetDetails = (id: string) => metaData.file_assets.find((asset) => asset.id === id);\n+\n+  return {\n+    \"image-component\": (_state, node) => {\n+      const properties = node.properties || {};\n+      const src = String(properties.src);\n+      const fileAssetDetails = getFileAssetDetails(src);\n+      if (!src || !fileAssetDetails) return createTextNode(\"\");\n+      return createTextNode(`![${fileAssetDetails.name}](${fileAssetDetails.url})`);\n+    },\n+    img: (_state, node) => {\n+      const properties = node.properties || {};\n+      const src = String(properties.src);\n+      const alt = String(properties.alt);\n+      if (!src || !alt) return createTextNode(\"\");\n+      return createTextNode(`![${alt || \"Image\"}](${src})`);\n+    },\n+    \"mention-component\": (_state, node) => {\n+      const properties = node.properties || {};\n+      const userId = String(properties.entity_identifier);\n+      const userDetails = metaData.user_mentions.find((user) => user.id === userId);\n+      if (!userDetails) return createTextNode(\"\");\n+      return createTextNode(`[@${userDetails.display_name || \"Unknown user\"}](${userDetails.url || \"\"}) `);\n+    },\n+    ...parseExtendedCustomComponents({ metaData }),\n+  };\n+};\n+\n+export const parseExtendedCustomComponents = (_args: TArgs): Record<string, Handle> => ({});\n"
        },
        {
          "path": "packages/utils/src/editor/markdown-parser/index.ts",
          "status": "added",
          "diff": "Index: packages/utils/src/editor/markdown-parser/index.ts\n===================================================================\n--- packages/utils/src/editor/markdown-parser/index.ts\tf510020 (parent)\n+++ packages/utils/src/editor/markdown-parser/index.ts\td462546 (commit)\n@@ -0,0 +1,2 @@\n+export * from \"./types\";\n+export * from \"./root\";\n"
        },
        {
          "path": "packages/utils/src/editor/markdown-parser/marks-handler.ts",
          "status": "added",
          "diff": "Index: packages/utils/src/editor/markdown-parser/marks-handler.ts\n===================================================================\n--- packages/utils/src/editor/markdown-parser/marks-handler.ts\tf510020 (parent)\n+++ packages/utils/src/editor/markdown-parser/marks-handler.ts\td462546 (commit)\n@@ -0,0 +1,42 @@\n+import type { Handle } from \"hast-util-to-mdast\";\n+import type { PhrasingContent, Text as MDASTText } from \"mdast\";\n+// local imports\n+import { createTextNode } from \"./common\";\n+\n+const processMarkElement = (state: Parameters<Handle>[0], node: Parameters<Handle>[1], wrapper: string): MDASTText => {\n+  if (node.children && node.children.length > 0) {\n+    // Process all children and collect their text content\n+    const processedChildren: PhrasingContent[] = [];\n+\n+    for (const child of node.children) {\n+      if (child.type === \"text\") {\n+        // Direct text child - keep as is\n+        processedChildren.push(child as MDASTText);\n+      } else if (child.type === \"element\") {\n+        // Element child - recursively process it\n+        const processed = state.one(child, node);\n+        if (processed) {\n+          if (Array.isArray(processed)) {\n+            processedChildren.push(...(processed as PhrasingContent[]));\n+          } else {\n+            processedChildren.push(processed as PhrasingContent);\n+          }\n+        }\n+      }\n+    }\n+\n+    // Concatenate all text content and wrap with the specified wrapper\n+    const combinedText = processedChildren.map((child) => (child.type === \"text\" ? child.value : \"\")).join(\"\");\n+\n+    return createTextNode(`${wrapper}${combinedText}${wrapper}`);\n+  }\n+\n+  // Empty element - return empty text\n+  return createTextNode(\"\");\n+};\n+\n+export const parseMarks: Record<string, Handle> = {\n+  u: (state, node) => processMarkElement(state, node, \"\"),\n+  i: (state, node) => processMarkElement(state, node, \"_\"),\n+  em: (state, node) => processMarkElement(state, node, \"_\"),\n+};\n"
        },
        {
          "path": "packages/utils/src/editor/markdown-parser/root.ts",
          "status": "added",
          "diff": "Index: packages/utils/src/editor/markdown-parser/root.ts\n===================================================================\n--- packages/utils/src/editor/markdown-parser/root.ts\tf510020 (parent)\n+++ packages/utils/src/editor/markdown-parser/root.ts\td462546 (commit)\n@@ -0,0 +1,143 @@\n+// - Parses TipTap/ProseMirror HTML fragments\n+// - Removes <u> tags (Markdown has no underline)\n+// - Adds a space after checkbox inputs for correct GFM task list rendering\n+// - Converts to Markdown using rehype→remark, GFM, and remark-stringify\n+\n+import type { Element as HASTElement, ElementContent, Parent as HASTParent } from \"hast\";\n+import rehypeParse from \"rehype-parse\";\n+import rehypeRemark from \"rehype-remark\";\n+import remarkGfm from \"remark-gfm\";\n+import remarkStringify from \"remark-stringify\";\n+import { unified } from \"unified\";\n+// local imports\n+import { parseCustomComponents } from \"./custom-components-handler\";\n+import { parseMarks } from \"./marks-handler\";\n+import type { TCustomComponentsMetaData } from \"./types\";\n+\n+// Rehype plugin to handle TipTap task lists and convert them to GFM-compatible format\n+// TipTap structure: <li data-type=\"taskItem\"><label><input><span></span></label><div><p>text</p></div></li>\n+// We need: <li><input> text (with space after checkbox for proper GFM rendering)\n+function addSpacesToCheckboxes() {\n+  return (tree: HASTParent) => {\n+    const helper = (node: HASTParent): void => {\n+      if (!Array.isArray(node.children) || node.children.length === 0) return;\n+\n+      for (let i = 0; i < node.children.length; i++) {\n+        const child = node.children[i];\n+\n+        // Check if this is a task list item\n+        if (\n+          child &&\n+          child.type === \"element\" &&\n+          child.tagName === \"li\" &&\n+          child.properties &&\n+          child.properties[\"data-type\"] === \"taskItem\"\n+        ) {\n+          const liElement = child as HASTElement;\n+\n+          // Find the label and div elements\n+          const label = liElement.children?.find(\n+            (c) => c.type === \"element\" && (c as HASTElement).tagName === \"label\"\n+          ) as HASTElement | undefined;\n+\n+          const contentDiv = liElement.children?.find(\n+            (c) => c.type === \"element\" && (c as HASTElement).tagName === \"div\"\n+          ) as HASTElement | undefined;\n+\n+          if (label && contentDiv) {\n+            // Find the checkbox input\n+            const checkbox = label.children?.find(\n+              (c) =>\n+                c.type === \"element\" &&\n+                (c as HASTElement).tagName === \"input\" &&\n+                (c as HASTElement).properties?.type === \"checkbox\"\n+            ) as HASTElement | undefined;\n+\n+            if (checkbox) {\n+              // Extract text content from the div, unwrapping any paragraph tags\n+              const textContent: ElementContent[] = [];\n+              if (contentDiv.children) {\n+                for (const child of contentDiv.children) {\n+                  if (child.type === \"element\" && (child as HASTElement).tagName === \"p\") {\n+                    // Unwrap paragraph - add its children directly\n+                    const pElement = child as HASTElement;\n+                    if (pElement.children) {\n+                      textContent.push(...pElement.children);\n+                    }\n+                  } else {\n+                    // Keep other elements as-is\n+                    textContent.push(child);\n+                  }\n+                }\n+              }\n+\n+              // Flatten the structure: move checkbox and content to be direct children of li\n+              liElement.children = [\n+                checkbox,\n+                { type: \"text\", value: \" \" }, // Add space after checkbox\n+                ...textContent,\n+              ];\n+            }\n+          }\n+        } else if (child && child.type === \"element\") {\n+          helper(child as HASTElement);\n+        }\n+      }\n+    };\n+\n+    helper(tree);\n+  };\n+}\n+\n+type TArgs = {\n+  description_html: string;\n+  metaData: TCustomComponentsMetaData;\n+  name?: string;\n+};\n+\n+/**\n+ * Sanitizes a string by escaping HTML entities to prevent XSS attacks\n+ * @param str - The string to sanitize\n+ * @returns The sanitized string with escaped HTML entities\n+ */\n+function sanitizeHTML(str: string): string {\n+  return str\n+    .replace(/&/g, \"&amp;\")\n+    .replace(/</g, \"&lt;\")\n+    .replace(/>/g, \"&gt;\")\n+    .replace(/\"/g, \"&quot;\")\n+    .replace(/'/g, \"&#x27;\");\n+}\n+\n+export function convertHTMLToMarkdown(args: TArgs): string {\n+  const { description_html, metaData, name } = args;\n+\n+  let updatedDescriptionHtml = description_html;\n+  if (name) {\n+    const sanitizedName = sanitizeHTML(name);\n+    updatedDescriptionHtml = `<h1>${sanitizedName}</h1>\\n\\n${description_html}`;\n+  }\n+\n+  const result = unified()\n+    .use(rehypeParse, { fragment: true })\n+    .use(addSpacesToCheckboxes)\n+    .use(rehypeRemark, {\n+      handlers: {\n+        ...parseCustomComponents({\n+          metaData,\n+        }),\n+        ...parseMarks,\n+      },\n+    })\n+    .use(remarkGfm)\n+    .use(remarkStringify, {\n+      handlers: {\n+        text: (node: { value: string }): string => node.value,\n+      },\n+    })\n+    .processSync(updatedDescriptionHtml);\n+\n+  const markdown = String(result.value ?? result);\n+\n+  return markdown;\n+}\n"
        },
        {
          "path": "packages/utils/src/editor/markdown-parser/types.ts",
          "status": "added",
          "diff": "Index: packages/utils/src/editor/markdown-parser/types.ts\n===================================================================\n--- packages/utils/src/editor/markdown-parser/types.ts\tf510020 (parent)\n+++ packages/utils/src/editor/markdown-parser/types.ts\td462546 (commit)\n@@ -0,0 +1,16 @@\n+export type TCoreCustomComponentsMetaData = {\n+  file_assets: {\n+    id: string;\n+    name: string;\n+    url: string;\n+  }[];\n+  user_mentions: {\n+    id: string;\n+    display_name: string;\n+    url: string;\n+  }[];\n+};\n+\n+export type TExtendedCustomComponentsMetaData = unknown;\n+\n+export type TCustomComponentsMetaData = TCoreCustomComponentsMetaData & TExtendedCustomComponentsMetaData;\n"
        },
        {
          "path": "pnpm-lock.yaml",
          "status": "modified",
          "diff": "Index: pnpm-lock.yaml\n===================================================================\n--- pnpm-lock.yaml\tf510020 (parent)\n+++ pnpm-lock.yaml\td462546 (commit)\n@@ -169,9 +169,9 @@\n         specifier: 'catalog:'\n         version: 9.1.1(mobx@6.12.0)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n       next-themes:\n         specifier: ^0.2.1\n-        version: 0.2.1(next@14.2.32(@babel/core@7.28.4)(@opentelemetry/api@1.9.0)(babel-plugin-macros@3.1.0)(react-dom@18.3.1(react@18.3.1))(react@18.3.1))(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n+        version: 0.2.1(next@14.2.32(@opentelemetry/api@1.9.0)(babel-plugin-macros@3.1.0)(react-dom@18.3.1(react@18.3.1))(react@18.3.1))(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n       react:\n         specifier: 'catalog:'\n         version: 18.3.1\n       react-dom:\n@@ -429,9 +429,9 @@\n         specifier: 'catalog:'\n         version: 6.0.8(mobx@6.12.0)\n       next-themes:\n         specifier: ^0.2.1\n-        version: 0.2.1(next@14.2.32(@babel/core@7.28.4)(@opentelemetry/api@1.9.0)(babel-plugin-macros@3.1.0)(react-dom@18.3.1(react@18.3.1))(react@18.3.1))(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n+        version: 0.2.1(next@14.2.32(@opentelemetry/api@1.9.0)(babel-plugin-macros@3.1.0)(react-dom@18.3.1(react@18.3.1))(react@18.3.1))(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n       react:\n         specifier: 'catalog:'\n         version: 18.3.1\n       react-dom:\n@@ -604,9 +604,9 @@\n         specifier: 'catalog:'\n         version: 6.0.8(mobx@6.12.0)\n       next-themes:\n         specifier: ^0.2.1\n-        version: 0.2.1(next@14.2.32(@babel/core@7.28.4)(@opentelemetry/api@1.9.0)(babel-plugin-macros@3.1.0)(react-dom@18.3.1(react@18.3.1))(react@18.3.1))(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n+        version: 0.2.1(next@14.2.32(@opentelemetry/api@1.9.0)(babel-plugin-macros@3.1.0)(react-dom@18.3.1(react@18.3.1))(react@18.3.1))(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n       posthog-js:\n         specifier: ^1.255.1\n         version: 1.255.1\n       react:\n@@ -1437,20 +1437,44 @@\n         version: 4.1.0\n       dompurify:\n         specifier: 3.2.7\n         version: 3.2.7\n+      hast:\n+        specifier: ^1.0.0\n+        version: 1.0.0\n+      hast-util-to-mdast:\n+        specifier: ^10.1.2\n+        version: 10.1.2\n       lodash-es:\n         specifier: 'catalog:'\n         version: 4.17.21\n       lucide-react:\n         specifier: 'catalog:'\n         version: 0.469.0(react@18.3.1)\n+      mdast:\n+        specifier: ^3.0.0\n+        version: 3.0.0\n       react:\n         specifier: 'catalog:'\n         version: 18.3.1\n+      rehype-parse:\n+        specifier: ^9.0.1\n+        version: 9.0.1\n+      rehype-remark:\n+        specifier: ^10.0.1\n+        version: 10.0.1\n+      remark-gfm:\n+        specifier: ^4.0.1\n+        version: 4.0.1\n+      remark-stringify:\n+        specifier: ^11.0.0\n+        version: 11.0.0\n       tailwind-merge:\n         specifier: ^2.5.5\n         version: 2.6.0\n+      unified:\n+        specifier: ^11.0.5\n+        version: 11.0.5\n       uuid:\n         specifier: 'catalog:'\n         version: 13.0.0\n     devDependencies:\n@@ -1459,11 +1483,17 @@\n         version: link:../eslint-config\n       '@plane/typescript-config':\n         specifier: workspace:*\n         version: link:../typescript-config\n+      '@types/hast':\n+        specifier: ^3.0.4\n+        version: 3.0.4\n       '@types/lodash-es':\n         specifier: 'catalog:'\n         version: 4.17.12\n+      '@types/mdast':\n+        specifier: ^4.0.4\n+        version: 4.0.4\n       '@types/node':\n         specifier: 'catalog:'\n         version: 22.12.0\n       '@types/react':\n@@ -2126,10 +2156,10 @@\n \n   '@napi-rs/wasm-runtime@0.2.12':\n     resolution: {integrity: sha512-ZVWUcfwY4E/yPitQJl481FjFo3K22D6qF0DuFH6Y/nbnE11GY5uguDxZMGXPQ8WQ0128MXQD7TnfHyK4oWoIJQ==}\n \n-  '@napi-rs/wasm-runtime@1.0.3':\n-    resolution: {integrity: sha512-rZxtMsLwjdXkMUGC3WwsPwLNVqVqnTJT6MNIB6e+5fhMcSCPP0AOsNWuMQ5mdCq6HNjs/ZeWAEchpqeprqBD2Q==}\n+  '@napi-rs/wasm-runtime@1.0.5':\n+    resolution: {integrity: sha512-TBr9Cf9onSAS2LQ2+QHx6XcC6h9+RIzJgbqG3++9TUZSH204AwEy5jg3BTQ0VATsyoGj4ee49tN/y6rvaOOtcg==}\n \n   '@next/env@14.2.32':\n     resolution: {integrity: sha512-n9mQdigI6iZ/DF6pCTwMKeWgF2e8lg7qgt5M7HXMLtyhZYMnf/u905M18sSpPmHL9MKp9JHo56C6jrD2EvWxng==}\n \n@@ -2423,15 +2453,11 @@\n     engines: {node: ^18.19.0 || >=20.6.0}\n     peerDependencies:\n       '@opentelemetry/api': ^1.1.0\n \n-  '@oxc-project/runtime@0.82.3':\n-    resolution: {integrity: sha512-LNh5GlJvYHAnMurO+EyA8jJwN1rki7l3PSHuosDh2I7h00T6/u9rCkUjg/SvPmT1CZzvhuW0y+gf7jcqUy/Usg==}\n-    engines: {node: '>=6.9.0'}\n+  '@oxc-project/types@0.89.0':\n+    resolution: {integrity: sha512-yuo+ECPIW5Q9mSeNmCDC2im33bfKuwW18mwkaHMQh8KakHYDzj4ci/q7wxf2qS3dMlVVCIyrs3kFtH5LmnlYnw==}\n \n-  '@oxc-project/types@0.82.3':\n-    resolution: {integrity: sha512-6nCUxBnGX0c6qfZW5MaF6/fmu5dHJDMiMPaioKHKs5mi5+8/FHQ7WGjgQIz1zxpmceMYfdIXkOaLYE+ejbuOtA==}\n-\n   '@popperjs/core@2.11.8':\n     resolution: {integrity: sha512-P1st0aksCrn9sGZhp8GMYwBnQsbvAWsZAX44oXNNvLHGqAOcoVxmjZiohstwQ7SqKnbR47akdNi+uleWD8+g6A==}\n \n   '@posthog/react@1.4.0':\n@@ -2799,80 +2825,93 @@\n \n   '@remix-run/node-fetch-server@0.9.0':\n     resolution: {integrity: sha512-SoLMv7dbH+njWzXnOY6fI08dFMI5+/dQ+vY3n8RnnbdG7MdJEgiP28Xj/xWlnRnED/aB6SFw56Zop+LbmaaKqA==}\n \n-  '@rolldown/binding-android-arm64@1.0.0-beta.34':\n-    resolution: {integrity: sha512-jf5GNe5jP3Sr1Tih0WKvg2bzvh5T/1TA0fn1u32xSH7ca/p5t+/QRr4VRFCV/na5vjwKEhwWrChsL2AWlY+eoA==}\n+  '@rolldown/binding-android-arm64@1.0.0-beta.38':\n+    resolution: {integrity: sha512-AE3HFQrjWCKLFZD1Vpiy+qsqTRwwoil1oM5WsKPSmfQ5fif/A+ZtOZetF32erZdsR7qyvns6qHEteEsF6g6rsQ==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     cpu: [arm64]\n     os: [android]\n \n-  '@rolldown/binding-darwin-arm64@1.0.0-beta.34':\n-    resolution: {integrity: sha512-2F/TqH4QuJQ34tgWxqBjFL3XV1gMzeQgUO8YRtCPGBSP0GhxtoFzsp7KqmQEothsxztlv+KhhT9Dbg3HHwHViQ==}\n+  '@rolldown/binding-darwin-arm64@1.0.0-beta.38':\n+    resolution: {integrity: sha512-RaoWOKc0rrFsVmKOjQpebMY6c6/I7GR1FBc25v7L/R7NlM0166mUotwGEv7vxu7ruXH4SJcFeVrfADFUUXUmmQ==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     cpu: [arm64]\n     os: [darwin]\n \n-  '@rolldown/binding-darwin-x64@1.0.0-beta.34':\n-    resolution: {integrity: sha512-E1QuFslgLWbHQ8Qli/AqUKdfg0pockQPwRxVbhNQ74SciZEZpzLaujkdmOLSccMlSXDfFCF8RPnMoRAzQ9JV8Q==}\n+  '@rolldown/binding-darwin-x64@1.0.0-beta.38':\n+    resolution: {integrity: sha512-Ymojqc2U35iUc8NFU2XX1WQPfBRRHN6xHcrxAf9WS8BFFBn8pDrH5QPvH1tYs3lDkw6UGGbanr1RGzARqdUp1g==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     cpu: [x64]\n     os: [darwin]\n \n-  '@rolldown/binding-freebsd-x64@1.0.0-beta.34':\n-    resolution: {integrity: sha512-VS8VInNCwnkpI9WeQaWu3kVBq9ty6g7KrHdLxYMzeqz24+w9hg712TcWdqzdY6sn+24lUoMD9jTZrZ/qfVpk0g==}\n+  '@rolldown/binding-freebsd-x64@1.0.0-beta.38':\n+    resolution: {integrity: sha512-0ermTQ//WzSI0nOL3z/LUWMNiE9xeM5cLGxjewPFEexqxV/0uM8/lNp9QageQ8jfc/VO1OURsGw34HYO5PaL8w==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     cpu: [x64]\n     os: [freebsd]\n \n-  '@rolldown/binding-linux-arm-gnueabihf@1.0.0-beta.34':\n-    resolution: {integrity: sha512-4St4emjcnULnxJYb/5ZDrH/kK/j6PcUgc3eAqH5STmTrcF+I9m/X2xvSF2a2bWv1DOQhxBewThu0KkwGHdgu5w==}\n+  '@rolldown/binding-linux-arm-gnueabihf@1.0.0-beta.38':\n+    resolution: {integrity: sha512-GADxzVUTCTp6EWI52831A29Tt7PukFe94nhg/SUsfkI33oTiNQtPxyLIT/3oRegizGuPSZSlrdBurkjDwxyEUQ==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     cpu: [arm]\n     os: [linux]\n \n-  '@rolldown/binding-linux-arm64-gnu@1.0.0-beta.34':\n-    resolution: {integrity: sha512-a737FTqhFUoWfnebS2SnQ2BS50p0JdukdkUBwy2J06j4hZ6Eej0zEB8vTfAqoCjn8BQKkXBy+3Sx0IRkgwz1gA==}\n+  '@rolldown/binding-linux-arm64-gnu@1.0.0-beta.38':\n+    resolution: {integrity: sha512-SKO7Exl5Yem/OSNoA5uLHzyrptUQ8Hg70kHDxuwEaH0+GUg+SQe9/7PWmc4hFKBMrJGdQtii8WZ0uIz9Dofg5Q==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     cpu: [arm64]\n     os: [linux]\n \n-  '@rolldown/binding-linux-arm64-musl@1.0.0-beta.34':\n-    resolution: {integrity: sha512-NH+FeQWKyuw0k+PbXqpFWNfvD8RPvfJk766B/njdaWz4TmiEcSB0Nb6guNw1rBpM1FmltQYb3fFnTumtC6pRfA==}\n+  '@rolldown/binding-linux-arm64-musl@1.0.0-beta.38':\n+    resolution: {integrity: sha512-SOo6+WqhXPBaShLxLT0eCgH17d3Yu1lMAe4mFP0M9Bvr/kfMSOPQXuLxBcbBU9IFM9w3N6qP9xWOHO+oUJvi8Q==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     cpu: [arm64]\n     os: [linux]\n \n-  '@rolldown/binding-linux-x64-gnu@1.0.0-beta.34':\n-    resolution: {integrity: sha512-Q3RSCivp8pNadYK8ke3hLnQk08BkpZX9BmMjgwae2FWzdxhxxUiUzd9By7kneUL0vRQ4uRnhD9VkFQ+Haeqdvw==}\n+  '@rolldown/binding-linux-x64-gnu@1.0.0-beta.38':\n+    resolution: {integrity: sha512-yvsQ3CyrodOX+lcoi+lejZGCOvJZa9xTsNB8OzpMDmHeZq3QzJfpYjXSAS6vie70fOkLVJb77UqYO193Cl8XBQ==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     cpu: [x64]\n     os: [linux]\n \n-  '@rolldown/binding-linux-x64-musl@1.0.0-beta.34':\n-    resolution: {integrity: sha512-wDd/HrNcVoBhWWBUW3evJHoo7GJE/RofssBy3Dsiip05YUBmokQVrYAyrboOY4dzs/lJ7HYeBtWQ9hj8wlyF0A==}\n+  '@rolldown/binding-linux-x64-musl@1.0.0-beta.38':\n+    resolution: {integrity: sha512-84qzKMwUwikfYeOuJ4Kxm/3z15rt0nFGGQArHYIQQNSTiQdxGHxOkqXtzPFqrVfBJUdxBAf+jYzR1pttFJuWyg==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     cpu: [x64]\n     os: [linux]\n \n-  '@rolldown/binding-openharmony-arm64@1.0.0-beta.34':\n-    resolution: {integrity: sha512-dH3FTEV6KTNWpYSgjSXZzeX7vLty9oBYn6R3laEdhwZftQwq030LKL+5wyQdlbX5pnbh4h127hpv3Hl1+sj8dg==}\n+  '@rolldown/binding-openharmony-arm64@1.0.0-beta.38':\n+    resolution: {integrity: sha512-QrNiWlce01DYH0rL8K3yUBu+lNzY+B0DyCbIc2Atan6/S6flxOL0ow5DLQvMamOI/oKhrJ4xG+9MkMb9dDHbLQ==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     cpu: [arm64]\n     os: [openharmony]\n \n-  '@rolldown/binding-wasm32-wasi@1.0.0-beta.34':\n-    resolution: {integrity: sha512-y5BUf+QtO0JsIDKA51FcGwvhJmv89BYjUl8AmN7jqD6k/eU55mH6RJYnxwCsODq5m7KSSTigVb6O7/GqB8wbPw==}\n+  '@rolldown/binding-wasm32-wasi@1.0.0-beta.38':\n+    resolution: {integrity: sha512-fnLtHyjwEsG4/aNV3Uv3Qd1ZbdH+CopwJNoV0RgBqrcQB8V6/Qdikd5JKvnO23kb3QvIpP+dAMGZMv1c2PJMzw==}\n     engines: {node: '>=14.0.0'}\n     cpu: [wasm32]\n \n-  '@rolldown/binding-win32-arm64-msvc@1.0.0-beta.34':\n-    resolution: {integrity: sha512-ga5hFhdTwpaNxEiuxZHWnD3ed0GBAzbgzS5tRHpe0ObptxM1a9Xrq6TVfNQirBLwb5Y7T/FJmJi3pmdLy95ljg==}\n+  '@rolldown/binding-win32-arm64-msvc@1.0.0-beta.38':\n+    resolution: {integrity: sha512-19cTfnGedem+RY+znA9J6ARBOCEFD4YSjnx0p5jiTm9tR6pHafRfFIfKlTXhun+NL0WWM/M0eb2IfPPYUa8+wg==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     cpu: [arm64]\n     os: [win32]\n \n-  '@rolldown/binding-win32-ia32-msvc@1.0.0-beta.34':\n-    resolution: {integrity: sha512-4/MBp9T9eRnZskxWr8EXD/xHvLhdjWaeX/qY9LPRG1JdCGV3DphkLTy5AWwIQ5jhAy2ZNJR5z2fYRlpWU0sIyQ==}\n+  '@rolldown/binding-win32-ia32-msvc@1.0.0-beta.38':\n+    resolution: {integrity: sha512-HcICm4YzFJZV+fI0O0bFLVVlsWvRNo/AB9EfUXvNYbtAxakCnQZ15oq22deFdz6sfi9Y4/SagH2kPU723dhCFA==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     cpu: [ia32]\n     os: [win32]\n \n-  '@rolldown/binding-win32-x64-msvc@1.0.0-beta.34':\n-    resolution: {integrity: sha512-7O5iUBX6HSBKlQU4WykpUoEmb0wQmonb6ziKFr3dJTHud2kzDnWMqk344T0qm3uGv9Ddq6Re/94pInxo1G2d4w==}\n+  '@rolldown/binding-win32-x64-msvc@1.0.0-beta.38':\n+    resolution: {integrity: sha512-4Qx6cgEPXLb0XsCyLoQcUgYBpfL0sjugftob+zhUH0EOk/NVCAIT+h0NJhY+jn7pFpeKxhNMqhvTNx3AesxIAQ==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     cpu: [x64]\n     os: [win32]\n \n-  '@rolldown/pluginutils@1.0.0-beta.34':\n-    resolution: {integrity: sha512-LyAREkZHP5pMom7c24meKmJCdhf2hEyvam2q0unr3or9ydwDL+DJ8chTF6Av/RFPb3rH8UFBdMzO5MxTZW97oA==}\n+  '@rolldown/pluginutils@1.0.0-beta.38':\n+    resolution: {integrity: sha512-N/ICGKleNhA5nc9XXQG/kkKHJ7S55u0x0XUJbbkmdCnFuoRkM1Il12q9q0eX19+M7KKUEPw/daUPIRnxhcxAIw==}\n \n   '@rollup/pluginutils@5.2.0':\n     resolution: {integrity: sha512-qWJ2ZTbmumwiLFomfzTyt5Kng4hwPi9rwCYN4SHb6eaRU1KNO4ccxINHr/VhH4GgPlt1XfSTLX2LBTme8ne4Zw==}\n     engines: {node: '>=14.0.0'}\n@@ -3886,8 +3925,11 @@\n \n   '@types/mdast@3.0.15':\n     resolution: {integrity: sha512-LnwD+mUEfxWMa1QpDraczIn6k0Ee3SMicuYSSzS6ZYl2gKS09EClnJYGd8Du6rfc5r/GZEk5o1mRb8TaTj03sQ==}\n \n+  '@types/mdast@4.0.4':\n+    resolution: {integrity: sha512-kGaNbPh1k7AFzgpud/gMdvIm5xuECykRR+JnWKQno9TAXVa6WIVCGTPvYGekIDL4uwCZQSYbUxNBSb1aUo79oA==}\n+\n   '@types/mdurl@1.0.5':\n     resolution: {integrity: sha512-6L6VymKTzYSrEf4Nev4Xa1LCHKrlTlYCBMTlQKFuddo1CvQcE52I0mwfOJayueUC7MJuXOeHTcIU683lzd0cUA==}\n \n   '@types/mdurl@2.0.0':\n@@ -4585,8 +4627,11 @@\n   case-sensitive-paths-webpack-plugin@2.4.0:\n     resolution: {integrity: sha512-roIFONhcxog0JSSWbvVAh3OocukmSgpqOH6YpMkCvav/ySIV3JKg4Dc8vYtQjYi/UxpNE36r/9v+VqTQqgkYmw==}\n     engines: {node: '>=4'}\n \n+  ccount@2.0.1:\n+    resolution: {integrity: sha512-eyrF0jiFpY+3drT6383f1qhkbGsLSifNAjA61IUjZjmLCWjItY6LB9ft9YhoDgwfmclB2zhu51Lc7+95b8NRAg==}\n+\n   chai@5.3.3:\n     resolution: {integrity: sha512-4zNhdJD/iOjSH0A05ea+Ke6MU5mmpQcbQsSOkgdaUMJ9zTlDTD/GYlwohmIE2u0gaxHYiVHEn1Fw9mZ/ktJWgw==}\n     engines: {node: '>=18'}\n \n@@ -4612,8 +4657,14 @@\n \n   change-case@4.1.2:\n     resolution: {integrity: sha512-bSxY2ws9OtviILG1EiY5K7NNxkqg/JnRnFxLtKQ96JaviiIxi7djMrSd0ECT9AC+lttClmYwKw53BWpOMblo7A==}\n \n+  character-entities-html4@2.1.0:\n+    resolution: {integrity: sha512-1v7fgQRj6hnSwFpq1Eu0ynr/CDEw0rXo2B61qXrLNdHZmPKgb7fqS1a2JwF0rISo9q77jDI8VMEHoApn8qDoZA==}\n+\n+  character-entities-legacy@3.0.0:\n+    resolution: {integrity: sha512-RpPp0asT/6ufRm//AJVwpViZbGM/MkjQFxJccQRHmISF/22NBtsHqAWmL+/pmkPWoIUJdWyeVleTl1wydHATVQ==}\n+\n   character-entities@2.0.2:\n     resolution: {integrity: sha512-shx7oQ0Awen/BRIdkjkvz54PnEEI/EjwXDSIZp86/KKdbafHh1Df/RYGBhn4hbe2+uKC9FnT5UCEdyPz3ai9hQ==}\n \n   check-error@2.1.1:\n@@ -5200,8 +5251,12 @@\n   entities@5.0.0:\n     resolution: {integrity: sha512-BeJFvFRJddxobhvEdm5GqHzRV/X+ACeuw0/BuuxsCh1EUZcAIz8+kYmBp/LrQuloy6K1f3a0M7+IhmZ7QnkISA==}\n     engines: {node: '>=0.12'}\n \n+  entities@6.0.1:\n+    resolution: {integrity: sha512-aN97NXWF6AWBTahfVOIrB/NShkzi5H7F9r1s9mD3cDj4Ko5f2qhhVoYMibXF7GlLveb/D2ioWay8lxI97Ven3g==}\n+    engines: {node: '>=0.12'}\n+\n   err-code@2.0.3:\n     resolution: {integrity: sha512-2bmlRpNKBxT/CRmPOlyISQpNj+qSeYvcym/uT0Jx2bMOlKLtSy1ZmLuVxSEKKyor/N5yhvp/ZiG1oE3DEYMSFA==}\n \n   error-ex@1.3.4:\n@@ -5266,8 +5321,12 @@\n   escape-string-regexp@4.0.0:\n     resolution: {integrity: sha512-TtpcNJ3XAzx3Gq8sWRzJaVajRs0uVxA2YAkdb1jm2YkPz4G6egUFAyA3n5vtEIZefPk5Wa4UXbKuS5fKkJWdgA==}\n     engines: {node: '>=10'}\n \n+  escape-string-regexp@5.0.0:\n+    resolution: {integrity: sha512-/veY75JbMK4j1yjvuUxuVsiS/hr/4iHs9FTT6cgTexxdE0Ly/glccBAkloH/DofkjRbZU3bnoj38mOmhkZ0lHw==}\n+    engines: {node: '>=12'}\n+\n   eslint-config-next@14.2.32:\n     resolution: {integrity: sha512-mP/NmYtDBsKlKIOBnH+CW+pYeyR3wBhE+26DAqQ0/aRtEBeTEjgY2wAFUugUELkTLmrX6PpuMSSTpOhz7j9kdQ==}\n     peerDependencies:\n       eslint: ^7.23.0 || ^8.0.0\n@@ -5768,11 +5827,57 @@\n   hasown@2.0.2:\n     resolution: {integrity: sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==}\n     engines: {node: '>= 0.4'}\n \n+  hast-util-embedded@3.0.0:\n+    resolution: {integrity: sha512-naH8sld4Pe2ep03qqULEtvYr7EjrLK2QHY8KJR6RJkTUjPGObe1vnx585uzem2hGra+s1q08DZZpfgDVYRbaXA==}\n+\n+  hast-util-from-html@2.0.3:\n+    resolution: {integrity: sha512-CUSRHXyKjzHov8yKsQjGOElXy/3EKpyX56ELnkHH34vDVw1N1XSQ1ZcAvTyAPtGqLTuKP/uxM+aLkSPqF/EtMw==}\n+\n+  hast-util-from-parse5@8.0.3:\n+    resolution: {integrity: sha512-3kxEVkEKt0zvcZ3hCRYI8rqrgwtlIOFMWkbclACvjlDw8Li9S2hk/d51OI0nr/gIpdMHNepwgOKqZ/sy0Clpyg==}\n+\n+  hast-util-has-property@3.0.0:\n+    resolution: {integrity: sha512-MNilsvEKLFpV604hwfhVStK0usFY/QmM5zX16bo7EjnAEGofr5YyI37kzopBlZJkHD4t887i+q/C8/tr5Q94cA==}\n+\n+  hast-util-is-body-ok-link@3.0.1:\n+    resolution: {integrity: sha512-0qpnzOBLztXHbHQenVB8uNuxTnm/QBFUOmdOSsEn7GnBtyY07+ENTWVFBAnXd/zEgd9/SUG3lRY7hSIBWRgGpQ==}\n+\n+  hast-util-is-element@3.0.0:\n+    resolution: {integrity: sha512-Val9mnv2IWpLbNPqc/pUem+a7Ipj2aHacCwgNfTiK0vJKl0LF+4Ba4+v1oPHFpf3bLYmreq0/l3Gud9S5OH42g==}\n+\n+  hast-util-minify-whitespace@1.0.1:\n+    resolution: {integrity: sha512-L96fPOVpnclQE0xzdWb/D12VT5FabA7SnZOUMtL1DbXmYiHJMXZvFkIZfiMmTCNJHUeO2K9UYNXoVyfz+QHuOw==}\n+\n+  hast-util-parse-selector@4.0.0:\n+    resolution: {integrity: sha512-wkQCkSYoOGCRKERFWcxMVMOcYE2K1AaNLU8DXS9arxnLOUEWbOXKXiJUNzEpqZ3JOKpnha3jkFrumEjVliDe7A==}\n+\n+  hast-util-phrasing@3.0.1:\n+    resolution: {integrity: sha512-6h60VfI3uBQUxHqTyMymMZnEbNl1XmEGtOxxKYL7stY2o601COo62AWAYBQR9lZbYXYSBoxag8UpPRXK+9fqSQ==}\n+\n+  hast-util-to-html@9.0.5:\n+    resolution: {integrity: sha512-OguPdidb+fbHQSU4Q4ZiLKnzWo8Wwsf5bZfbvu7//a9oTYoqD/fWpe96NuHkoS9h0ccGOTe0C4NGXdtS0iObOw==}\n+\n+  hast-util-to-mdast@10.1.2:\n+    resolution: {integrity: sha512-FiCRI7NmOvM4y+f5w32jPRzcxDIz+PUqDwEqn1A+1q2cdp3B8Gx7aVrXORdOKjMNDQsD1ogOr896+0jJHW1EFQ==}\n+\n+  hast-util-to-text@4.0.2:\n+    resolution: {integrity: sha512-KK6y/BN8lbaq654j7JgBydev7wuNMcID54lkRav1P0CaE1e47P72AWWPiGKXTJU271ooYzcvTAn/Zt0REnvc7A==}\n+\n   hast-util-whitespace@2.0.1:\n     resolution: {integrity: sha512-nAxA0v8+vXSBDt3AnRUNjyRIQ0rD+ntpbAp4LnPkumc5M9yUbSMa4XDU9Q6etY4f1Wp4bNgvc1yjiZtsTTrSng==}\n \n+  hast-util-whitespace@3.0.0:\n+    resolution: {integrity: sha512-88JUN06ipLwsnv+dVn+OIYOvAuvBMy/Qoi6O7mQHxdPXpjy+Cd6xRkWwux7DKO+4sYILtLBRIKgsdpS2gQc7qw==}\n+\n+  hast@1.0.0:\n+    resolution: {integrity: sha512-vFUqlRV5C+xqP76Wwq2SrM0kipnmpxJm7OfvVXpB35Fp+Fn4MV+ozr+JZr5qFvyR1q/U+Foim2x+3P+x9S1PLA==}\n+    deprecated: Renamed to rehype\n+\n+  hastscript@9.0.1:\n+    resolution: {integrity: sha512-g7df9rMFX/SPi34tyGCyUBREQoKkapwdY/T04Qn9TDWfHhAYt4/I0gMVirzK5wEzeUqIjEB+LXC/ypb7Aqno5w==}\n+\n   he@1.2.0:\n     resolution: {integrity: sha512-F/1DnUGPopORZi0ni+CvrCgHQ5FyEAHRLSApuYWMmrbSwoN2Mn/7k+Gl38gJnR7yyDZk6WLXwiGod1JOWNDKGw==}\n     hasBin: true\n \n@@ -5810,8 +5915,11 @@\n     resolution: {integrity: sha512-YXxSlJBZTP7RS3tWnQw74ooKa6L9b9i9QYXY21eUEvhZ3u9XLfv6OnFsQq6RxkhHygsaUMvYsZRV5rU/OVNZxw==}\n     engines: {node: '>=12'}\n     hasBin: true\n \n+  html-void-elements@3.0.0:\n+    resolution: {integrity: sha512-bEqo66MRXsUGxWHV5IP0PUiAWwoEjba4VCzg0LjFJBpchPaTfyfCKTG6bc5F8ucKec3q5y6qOdGyYTSBEvhCrg==}\n+\n   html-webpack-plugin@5.6.4:\n     resolution: {integrity: sha512-V/PZeWsqhfpE27nKeX9EO2sbR+D17A+tLf6qU+ht66jdUsN0QLKJN27Z+1+gHrVMKgndBahes0PU6rRihDgHTw==}\n     engines: {node: '>=10.13.0'}\n     peerDependencies:\n@@ -6264,8 +6372,11 @@\n   logform@2.7.0:\n     resolution: {integrity: sha512-TFYA4jnP7PVbmlBIfhlSe+WKxs9dklXMTEGcBCIvLhE/Tn3H6Gk1norupVW7m5Cnd4bLcr08AytbyV/xj7f/kQ==}\n     engines: {node: '>= 12.0.0'}\n \n+  longest-streak@3.1.0:\n+    resolution: {integrity: sha512-9Ri+o0JYgehTaVBBDoMqIl8GXtbWg711O3srftcHhZ0dqnETqLaoIK0x17fUw9rFSlK/0NlsKe0Ahhyl5pXE2g==}\n+\n   loose-envify@1.4.0:\n     resolution: {integrity: sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==}\n     hasBin: true\n \n@@ -6318,8 +6429,11 @@\n   markdown-it@14.1.0:\n     resolution: {integrity: sha512-a54IwgWPaeBCAAsv13YgmALOF1elABB08FxO9i+r4VFk5Vl4pKokRPeX8u5TCgSsPi6ec1otfLjdOpVcgbpshg==}\n     hasBin: true\n \n+  markdown-table@3.0.4:\n+    resolution: {integrity: sha512-wiYz4+JrLyb/DqW2hkFJxP7Vd7JuTDm77fvbM8VfEQdmSMqcImWeeRbHwZjBjIFki/VaMK2BhFi7oUUZeM5bqw==}\n+\n   masonry-layout@4.2.2:\n     resolution: {integrity: sha512-iGtAlrpHNyxaR19CvKC3npnEcAwszXoyJiI8ARV2ePi7fmYhIud25MHK8Zx4P0LCC4d3TNO9+rFa1KoK1OEOaA==}\n \n   material-colors@1.2.6:\n@@ -6331,17 +6445,57 @@\n \n   mdast-util-definitions@5.1.2:\n     resolution: {integrity: sha512-8SVPMuHqlPME/z3gqVwWY4zVXn8lqKv/pAhC57FuJ40ImXyBpmO5ukh98zB2v7Blql2FiHjHv9LVztSIqjY+MA==}\n \n+  mdast-util-find-and-replace@3.0.2:\n+    resolution: {integrity: sha512-Tmd1Vg/m3Xz43afeNxDIhWRtFZgM2VLyaf4vSTYwudTyeuTneoL3qtWMA5jeLyz/O1vDJmmV4QuScFCA2tBPwg==}\n+\n   mdast-util-from-markdown@1.3.1:\n     resolution: {integrity: sha512-4xTO/M8c82qBcnQc1tgpNtubGUW/Y1tBQ1B0i5CtSoelOLKFYlElIr3bvgREYYO5iRqbMY1YuqZng0GVOI8Qww==}\n \n+  mdast-util-from-markdown@2.0.2:\n+    resolution: {integrity: sha512-uZhTV/8NBuw0WHkPTrCqDOl0zVe1BIng5ZtHoDk49ME1qqcjYmmLmOf0gELgcRMxN4w2iuIeVso5/6QymSrgmA==}\n+\n+  mdast-util-gfm-autolink-literal@2.0.1:\n+    resolution: {integrity: sha512-5HVP2MKaP6L+G6YaxPNjuL0BPrq9orG3TsrZ9YXbA3vDw/ACI4MEsnoDpn6ZNm7GnZgtAcONJyPhOP8tNJQavQ==}\n+\n+  mdast-util-gfm-footnote@2.1.0:\n+    resolution: {integrity: sha512-sqpDWlsHn7Ac9GNZQMeUzPQSMzR6Wv0WKRNvQRg0KqHh02fpTz69Qc1QSseNX29bhz1ROIyNyxExfawVKTm1GQ==}\n+\n+  mdast-util-gfm-strikethrough@2.0.0:\n+    resolution: {integrity: sha512-mKKb915TF+OC5ptj5bJ7WFRPdYtuHv0yTRxK2tJvi+BDqbkiG7h7u/9SI89nRAYcmap2xHQL9D+QG/6wSrTtXg==}\n+\n+  mdast-util-gfm-table@2.0.0:\n+    resolution: {integrity: sha512-78UEvebzz/rJIxLvE7ZtDd/vIQ0RHv+3Mh5DR96p7cS7HsBhYIICDBCu8csTNWNO6tBWfqXPWekRuj2FNOGOZg==}\n+\n+  mdast-util-gfm-task-list-item@2.0.0:\n+    resolution: {integrity: sha512-IrtvNvjxC1o06taBAVJznEnkiHxLFTzgonUdy8hzFVeDun0uTjxxrRGVaNFqkU1wJR3RBPEfsxmU6jDWPofrTQ==}\n+\n+  mdast-util-gfm@3.1.0:\n+    resolution: {integrity: sha512-0ulfdQOM3ysHhCJ1p06l0b0VKlhU0wuQs3thxZQagjcjPrlFRqY215uZGHHJan9GEAXd9MbfPjFJz+qMkVR6zQ==}\n+\n+  mdast-util-phrasing@4.1.0:\n+    resolution: {integrity: sha512-TqICwyvJJpBwvGAMZjj4J2n0X8QWp21b9l0o7eXyVJ25YNWYbJDVIyD1bZXE6WtV6RmKJVYmQAKWa0zWOABz2w==}\n+\n   mdast-util-to-hast@12.3.0:\n     resolution: {integrity: sha512-pits93r8PhnIoU4Vy9bjW39M2jJ6/tdHyja9rrot9uujkN7UTU9SDnE6WNJz/IGyQk3XHX6yNNtrBH6cQzm8Hw==}\n \n+  mdast-util-to-hast@13.2.0:\n+    resolution: {integrity: sha512-QGYKEuUsYT9ykKBCMOEDLsU5JRObWQusAolFMeko/tYPufNkRffBAQjIE+99jbA87xv6FgmjLtwjh9wBWajwAA==}\n+\n+  mdast-util-to-markdown@2.1.2:\n+    resolution: {integrity: sha512-xj68wMTvGXVOKonmog6LwyJKrYXZPvlwabaryTjLh9LuvovB/KAH+kvi8Gjj+7rJjsFi23nkUxRQv1KqSroMqA==}\n+\n   mdast-util-to-string@3.2.0:\n     resolution: {integrity: sha512-V4Zn/ncyN1QNSqSBxTrMOLpjr+IKdHl2v3KVLoWmDPscP4r9GcCi71gjgvUV1SFSKh92AjAG4peFuBl2/YgCJg==}\n \n+  mdast-util-to-string@4.0.0:\n+    resolution: {integrity: sha512-0H44vDimn51F0YwvxSJSm0eCDOJTRlmN0R1yBh4HLj9wiV1Dn0QoXGbvFAWj2hSItVTlCmBF1hqKlIyUBVFLPg==}\n+\n+  mdast@3.0.0:\n+    resolution: {integrity: sha512-xySmf8g4fPKMeC07jXGz971EkLbWAJ83s4US2Tj9lEdnZ142UP5grN73H1Xd3HzrdbU5o9GYYP/y8F9ZSwLE9g==}\n+    deprecated: '`mdast` was renamed to `remark`'\n+\n   mdn-data@2.0.14:\n     resolution: {integrity: sha512-dn6wd0uw5GsdswPFfsgMp5NSB0/aDe6fK94YJV/AJDYXL6HVLWBsxeq7js7Ad+mU2K9LAlwpk6kN2D5mwCPVow==}\n \n   mdurl@2.0.0:\n@@ -6377,68 +6531,152 @@\n \n   micromark-core-commonmark@1.1.0:\n     resolution: {integrity: sha512-BgHO1aRbolh2hcrzL2d1La37V0Aoz73ymF8rAcKnohLy93titmv62E0gP8Hrx9PKcKrqCZ1BbLGbP3bEhoXYlw==}\n \n+  micromark-core-commonmark@2.0.3:\n+    resolution: {integrity: sha512-RDBrHEMSxVFLg6xvnXmb1Ayr2WzLAWjeSATAoxwKYJV94TeNavgoIdA0a9ytzDSVzBy2YKFK+emCPOEibLeCrg==}\n+\n+  micromark-extension-gfm-autolink-literal@2.1.0:\n+    resolution: {integrity: sha512-oOg7knzhicgQ3t4QCjCWgTmfNhvQbDDnJeVu9v81r7NltNCVmhPy1fJRX27pISafdjL+SVc4d3l48Gb6pbRypw==}\n+\n+  micromark-extension-gfm-footnote@2.1.0:\n+    resolution: {integrity: sha512-/yPhxI1ntnDNsiHtzLKYnE3vf9JZ6cAisqVDauhp4CEHxlb4uoOTxOCJ+9s51bIB8U1N1FJ1RXOKTIlD5B/gqw==}\n+\n+  micromark-extension-gfm-strikethrough@2.1.0:\n+    resolution: {integrity: sha512-ADVjpOOkjz1hhkZLlBiYA9cR2Anf8F4HqZUO6e5eDcPQd0Txw5fxLzzxnEkSkfnD0wziSGiv7sYhk/ktvbf1uw==}\n+\n+  micromark-extension-gfm-table@2.1.1:\n+    resolution: {integrity: sha512-t2OU/dXXioARrC6yWfJ4hqB7rct14e8f7m0cbI5hUmDyyIlwv5vEtooptH8INkbLzOatzKuVbQmAYcbWoyz6Dg==}\n+\n+  micromark-extension-gfm-tagfilter@2.0.0:\n+    resolution: {integrity: sha512-xHlTOmuCSotIA8TW1mDIM6X2O1SiX5P9IuDtqGonFhEK0qgRI4yeC6vMxEV2dgyr2TiD+2PQ10o+cOhdVAcwfg==}\n+\n+  micromark-extension-gfm-task-list-item@2.1.0:\n+    resolution: {integrity: sha512-qIBZhqxqI6fjLDYFTBIa4eivDMnP+OZqsNwmQ3xNLE4Cxwc+zfQEfbs6tzAo2Hjq+bh6q5F+Z8/cksrLFYWQQw==}\n+\n+  micromark-extension-gfm@3.0.0:\n+    resolution: {integrity: sha512-vsKArQsicm7t0z2GugkCKtZehqUm31oeGBV/KVSorWSy8ZlNAv7ytjFhvaryUiCUJYqs+NoE6AFhpQvBTM6Q4w==}\n+\n   micromark-factory-destination@1.1.0:\n     resolution: {integrity: sha512-XaNDROBgx9SgSChd69pjiGKbV+nfHGDPVYFs5dOoDd7ZnMAE+Cuu91BCpsY8RT2NP9vo/B8pds2VQNCLiu0zhg==}\n \n+  micromark-factory-destination@2.0.1:\n+    resolution: {integrity: sha512-Xe6rDdJlkmbFRExpTOmRj9N3MaWmbAgdpSrBQvCFqhezUn4AHqJHbaEnfbVYYiexVSs//tqOdY/DxhjdCiJnIA==}\n+\n   micromark-factory-label@1.1.0:\n     resolution: {integrity: sha512-OLtyez4vZo/1NjxGhcpDSbHQ+m0IIGnT8BoPamh+7jVlzLJBH98zzuCoUeMxvM6WsNeh8wx8cKvqLiPHEACn0w==}\n \n+  micromark-factory-label@2.0.1:\n+    resolution: {integrity: sha512-VFMekyQExqIW7xIChcXn4ok29YE3rnuyveW3wZQWWqF4Nv9Wk5rgJ99KzPvHjkmPXF93FXIbBp6YdW3t71/7Vg==}\n+\n   micromark-factory-space@1.1.0:\n     resolution: {integrity: sha512-cRzEj7c0OL4Mw2v6nwzttyOZe8XY/Z8G0rzmWQZTBi/jjwyw/U4uqKtUORXQrR5bAZZnbTI/feRV/R7hc4jQYQ==}\n \n+  micromark-factory-space@2.0.1:\n+    resolution: {integrity: sha512-zRkxjtBxxLd2Sc0d+fbnEunsTj46SWXgXciZmHq0kDYGnck/ZSGj9/wULTV95uoeYiK5hRXP2mJ98Uo4cq/LQg==}\n+\n   micromark-factory-title@1.1.0:\n     resolution: {integrity: sha512-J7n9R3vMmgjDOCY8NPw55jiyaQnH5kBdV2/UXCtZIpnHH3P6nHUKaH7XXEYuWwx/xUJcawa8plLBEjMPU24HzQ==}\n \n+  micromark-factory-title@2.0.1:\n+    resolution: {integrity: sha512-5bZ+3CjhAd9eChYTHsjy6TGxpOFSKgKKJPJxr293jTbfry2KDoWkhBb6TcPVB4NmzaPhMs1Frm9AZH7OD4Cjzw==}\n+\n   micromark-factory-whitespace@1.1.0:\n     resolution: {integrity: sha512-v2WlmiymVSp5oMg+1Q0N1Lxmt6pMhIHD457whWM7/GUlEks1hI9xj5w3zbc4uuMKXGisksZk8DzP2UyGbGqNsQ==}\n \n+  micromark-factory-whitespace@2.0.1:\n+    resolution: {integrity: sha512-Ob0nuZ3PKt/n0hORHyvoD9uZhr+Za8sFoP+OnMcnWK5lngSzALgQYKMr9RJVOWLqQYuyn6ulqGWSXdwf6F80lQ==}\n+\n   micromark-util-character@1.2.0:\n     resolution: {integrity: sha512-lXraTwcX3yH/vMDaFWCQJP1uIszLVebzUa3ZHdrgxr7KEU/9mL4mVgCpGbyhvNLNlauROiNUq7WN5u7ndbY6xg==}\n \n+  micromark-util-character@2.1.1:\n+    resolution: {integrity: sha512-wv8tdUTJ3thSFFFJKtpYKOYiGP2+v96Hvk4Tu8KpCAsTMs6yi+nVmGh1syvSCsaxz45J6Jbw+9DD6g97+NV67Q==}\n+\n   micromark-util-chunked@1.1.0:\n     resolution: {integrity: sha512-Ye01HXpkZPNcV6FiyoW2fGZDUw4Yc7vT0E9Sad83+bEDiCJ1uXu0S3mr8WLpsz3HaG3x2q0HM6CTuPdcZcluFQ==}\n \n+  micromark-util-chunked@2.0.1:\n+    resolution: {integrity: sha512-QUNFEOPELfmvv+4xiNg2sRYeS/P84pTW0TCgP5zc9FpXetHY0ab7SxKyAQCNCc1eK0459uoLI1y5oO5Vc1dbhA==}\n+\n   micromark-util-classify-character@1.1.0:\n     resolution: {integrity: sha512-SL0wLxtKSnklKSUplok1WQFoGhUdWYKggKUiqhX+Swala+BtptGCu5iPRc+xvzJ4PXE/hwM3FNXsfEVgoZsWbw==}\n \n+  micromark-util-classify-character@2.0.1:\n+    resolution: {integrity: sha512-K0kHzM6afW/MbeWYWLjoHQv1sgg2Q9EccHEDzSkxiP/EaagNzCm7T/WMKZ3rjMbvIpvBiZgwR3dKMygtA4mG1Q==}\n+\n   micromark-util-combine-extensions@1.1.0:\n     resolution: {integrity: sha512-Q20sp4mfNf9yEqDL50WwuWZHUrCO4fEyeDCnMGmG5Pr0Cz15Uo7KBs6jq+dq0EgX4DPwwrh9m0X+zPV1ypFvUA==}\n \n+  micromark-util-combine-extensions@2.0.1:\n+    resolution: {integrity: sha512-OnAnH8Ujmy59JcyZw8JSbK9cGpdVY44NKgSM7E9Eh7DiLS2E9RNQf0dONaGDzEG9yjEl5hcqeIsj4hfRkLH/Bg==}\n+\n   micromark-util-decode-numeric-character-reference@1.1.0:\n     resolution: {integrity: sha512-m9V0ExGv0jB1OT21mrWcuf4QhP46pH1KkfWy9ZEezqHKAxkj4mPCy3nIH1rkbdMlChLHX531eOrymlwyZIf2iw==}\n \n+  micromark-util-decode-numeric-character-reference@2.0.2:\n+    resolution: {integrity: sha512-ccUbYk6CwVdkmCQMyr64dXz42EfHGkPQlBj5p7YVGzq8I7CtjXZJrubAYezf7Rp+bjPseiROqe7G6foFd+lEuw==}\n+\n   micromark-util-decode-string@1.1.0:\n     resolution: {integrity: sha512-YphLGCK8gM1tG1bd54azwyrQRjCFcmgj2S2GoJDNnh4vYtnL38JS8M4gpxzOPNyHdNEpheyWXCTnnTDY3N+NVQ==}\n \n+  micromark-util-decode-string@2.0.1:\n+    resolution: {integrity: sha512-nDV/77Fj6eH1ynwscYTOsbK7rR//Uj0bZXBwJZRfaLEJ1iGBR6kIfNmlNqaqJf649EP0F3NWNdeJi03elllNUQ==}\n+\n   micromark-util-encode@1.1.0:\n     resolution: {integrity: sha512-EuEzTWSTAj9PA5GOAs992GzNh2dGQO52UvAbtSOMvXTxv3Criqb6IOzJUBCmEqrrXSblJIJBbFFv6zPxpreiJw==}\n \n+  micromark-util-encode@2.0.1:\n+    resolution: {integrity: sha512-c3cVx2y4KqUnwopcO9b/SCdo2O67LwJJ/UyqGfbigahfegL9myoEFoDYZgkT7f36T0bLrM9hZTAaAyH+PCAXjw==}\n+\n   micromark-util-html-tag-name@1.2.0:\n     resolution: {integrity: sha512-VTQzcuQgFUD7yYztuQFKXT49KghjtETQ+Wv/zUjGSGBioZnkA4P1XXZPT1FHeJA6RwRXSF47yvJ1tsJdoxwO+Q==}\n \n+  micromark-util-html-tag-name@2.0.1:\n+    resolution: {integrity: sha512-2cNEiYDhCWKI+Gs9T0Tiysk136SnR13hhO8yW6BGNyhOC4qYFnwF1nKfD3HFAIXA5c45RrIG1ub11GiXeYd1xA==}\n+\n   micromark-util-normalize-identifier@1.1.0:\n     resolution: {integrity: sha512-N+w5vhqrBihhjdpM8+5Xsxy71QWqGn7HYNUvch71iV2PM7+E3uWGox1Qp90loa1ephtCxG2ftRV/Conitc6P2Q==}\n \n+  micromark-util-normalize-identifier@2.0.1:\n+    resolution: {integrity: sha512-sxPqmo70LyARJs0w2UclACPUUEqltCkJ6PhKdMIDuJ3gSf/Q+/GIe3WKl0Ijb/GyH9lOpUkRAO2wp0GVkLvS9Q==}\n+\n   micromark-util-resolve-all@1.1.0:\n     resolution: {integrity: sha512-b/G6BTMSg+bX+xVCshPTPyAu2tmA0E4X98NSR7eIbeC6ycCqCeE7wjfDIgzEbkzdEVJXRtOG4FbEm/uGbCRouA==}\n \n+  micromark-util-resolve-all@2.0.1:\n+    resolution: {integrity: sha512-VdQyxFWFT2/FGJgwQnJYbe1jjQoNTS4RjglmSjTUlpUMa95Htx9NHeYW4rGDJzbjvCsl9eLjMQwGeElsqmzcHg==}\n+\n   micromark-util-sanitize-uri@1.2.0:\n     resolution: {integrity: sha512-QO4GXv0XZfWey4pYFndLUKEAktKkG5kZTdUNaTAkzbuJxn2tNBOr+QtxR2XpWaMhbImT2dPzyLrPXLlPhph34A==}\n \n+  micromark-util-sanitize-uri@2.0.1:\n+    resolution: {integrity: sha512-9N9IomZ/YuGGZZmQec1MbgxtlgougxTodVwDzzEouPKo3qFWvymFHWcnDi2vzV1ff6kas9ucW+o3yzJK9YB1AQ==}\n+\n   micromark-util-subtokenize@1.1.0:\n     resolution: {integrity: sha512-kUQHyzRoxvZO2PuLzMt2P/dwVsTiivCK8icYTeR+3WgbuPqfHgPPy7nFKbeqRivBvn/3N3GBiNC+JRTMSxEC7A==}\n \n+  micromark-util-subtokenize@2.1.0:\n+    resolution: {integrity: sha512-XQLu552iSctvnEcgXw6+Sx75GflAPNED1qx7eBJ+wydBb2KCbRZe+NwvIEEMM83uml1+2WSXpBAcp9IUCgCYWA==}\n+\n   micromark-util-symbol@1.1.0:\n     resolution: {integrity: sha512-uEjpEYY6KMs1g7QfJ2eX1SQEV+ZT4rUD3UcF6l57acZvLNK7PBZL+ty82Z1qhK1/yXIY4bdx04FKMgR0g4IAag==}\n \n+  micromark-util-symbol@2.0.1:\n+    resolution: {integrity: sha512-vs5t8Apaud9N28kgCrRUdEed4UJ+wWNvicHLPxCa9ENlYuAY31M0ETy5y1vA33YoNPDFTghEbnh6efaE8h4x0Q==}\n+\n   micromark-util-types@1.1.0:\n     resolution: {integrity: sha512-ukRBgie8TIAcacscVHSiddHjO4k/q3pnedmzMQ4iwDcK0FtFCohKOlFbaOL/mPgfnPsL3C1ZyxJa4sbWrBl3jg==}\n \n+  micromark-util-types@2.0.2:\n+    resolution: {integrity: sha512-Yw0ECSpJoViF1qTU4DC6NwtC4aWGt1EkzaQB8KPPyCRR8z9TWeV0HbEFGTO+ZY1wB22zmxnJqhPyTpOVCpeHTA==}\n+\n   micromark@3.2.0:\n     resolution: {integrity: sha512-uD66tJj54JLYq0De10AhWycZWGQNUvDI55xPgk2sQM5kn1JYlhbCMTtEeT27+vAhW2FBQxLlOmS3pmA7/2z4aA==}\n \n+  micromark@4.0.2:\n+    resolution: {integrity: sha512-zpe98Q6kvavpCr1NPVSCMebCKfD7CA2NqZ+rykeNhONIJBpc1tFKt9hucLGwha3jNTNI8lHpctWJWoimVF4PfA==}\n+\n   micromatch@4.0.8:\n     resolution: {integrity: sha512-PXwfBhYu0hBCPw8Dn0E+WDYb7af3dSLVWKi3HGv84IdF4TyFoC0ysxFd0Goxw7nSv4T/PzEJQxsYsEiFCKo2BA==}\n     engines: {node: '>=8.6'}\n \n@@ -6800,8 +7038,11 @@\n \n   parse-svg-path@0.1.2:\n     resolution: {integrity: sha512-JyPSBnkTJ0AI8GGJLfMXvKq42cj5c006fnLz6fXy6zfoVjJizi8BNTpu8on8ziI1cKy9d9DGNuY17Ce7wuejpQ==}\n \n+  parse5@7.3.0:\n+    resolution: {integrity: sha512-IInvU7fabl34qmi9gY8XOVxhYyMyuH2xUNpb2q8/Y+7552KlejkRvqvD19nMoUW/uQGGbqNpA6Tufu5FL5BZgw==}\n+\n   parseurl@1.3.3:\n     resolution: {integrity: sha512-CiyeOxFT/JZyN5m0z9PfXw4SCBJ6Sygz1Dpl0wqjlhDEGGBP1GnsUVEL0p63hoG1fcj3fHynXi9NYO4nWOL+qQ==}\n     engines: {node: '>= 0.8'}\n \n@@ -7147,8 +7388,11 @@\n \n   property-information@6.5.0:\n     resolution: {integrity: sha512-PgTgs/BlvHxOu8QuEN7wi5A0OmXaBcHpmCSTehcs6Uuu9IkDIEo13Hy7n898RHfrQ49vKCoGeWZSaAK01nwVig==}\n \n+  property-information@7.1.0:\n+    resolution: {integrity: sha512-TwEZ+X+yCJmYfL7TPUOcvBZ4QfoT5YenQiJuX//0th53DE6w0xxLEtfK3iyryQFddXuvkIk51EEgrJQ0WJkOmQ==}\n+\n   prosemirror-changeset@2.3.1:\n     resolution: {integrity: sha512-j0kORIBm8ayJNl3zQvD1TTPHJX3g042et6y/KQhZhnPrruO8exkTgG8X+NRpj7kIyMMEx74Xb3DyMIBtO0IKkQ==}\n \n   prosemirror-codemark@0.4.2:\n@@ -7493,18 +7737,36 @@\n   registry-url@3.1.0:\n     resolution: {integrity: sha512-ZbgR5aZEdf4UKZVBPYIgaglBmSF2Hi94s2PcIHhRGFjKYu+chjJdYfHn4rt3hB6eCKLJ8giVIIfgMa1ehDfZKA==}\n     engines: {node: '>=0.10.0'}\n \n+  rehype-minify-whitespace@6.0.2:\n+    resolution: {integrity: sha512-Zk0pyQ06A3Lyxhe9vGtOtzz3Z0+qZ5+7icZ/PL/2x1SHPbKao5oB/g/rlc6BCTajqBb33JcOe71Ye1oFsuYbnw==}\n+\n+  rehype-parse@9.0.1:\n+    resolution: {integrity: sha512-ksCzCD0Fgfh7trPDxr2rSylbwq9iYDkSn8TCDmEJ49ljEUBxDVCzCHv7QNzZOfODanX4+bWQ4WZqLCRWYLfhag==}\n+\n+  rehype-remark@10.0.1:\n+    resolution: {integrity: sha512-EmDndlb5NVwXGfUa4c9GPK+lXeItTilLhE6ADSaQuHr4JUlKw9MidzGzx4HpqZrNCt6vnHmEifXQiiA+CEnjYQ==}\n+\n   relateurl@0.2.7:\n     resolution: {integrity: sha512-G08Dxvm4iDN3MLM0EsP62EDV9IuhXPR6blNz6Utcp7zyV3tr4HVNINt6MpaRWbxoOHT3Q7YN2P+jaHX8vUbgog==}\n     engines: {node: '>= 0.10'}\n \n+  remark-gfm@4.0.1:\n+    resolution: {integrity: sha512-1quofZ2RQ9EWdeN34S79+KExV1764+wCUGop5CPL1WGdD0ocPpu91lzPGbwWMECpEpd42kJGQwzRfyov9j4yNg==}\n+\n   remark-parse@10.0.2:\n     resolution: {integrity: sha512-3ydxgHa/ZQzG8LvC7jTXccARYDcRld3VfcgIIFs7bI6vbRSxJJmzgLEIIoYKyrfhaY+ujuWaf/PJiMZXoiCXgw==}\n \n+  remark-parse@11.0.0:\n+    resolution: {integrity: sha512-FCxlKLNGknS5ba/1lmpYijMUzX2esxW5xQqjWxw2eHFfS2MSdaHVINFmhjo+qN1WhZhNimq0dZATN9pH0IDrpA==}\n+\n   remark-rehype@10.1.0:\n     resolution: {integrity: sha512-EFmR5zppdBp0WQeDVZ/b66CWJipB2q2VLNFMabzDSGR66Z2fQii83G5gTBbgGEnEEA0QRussvrFHxk1HWGJskw==}\n \n+  remark-stringify@11.0.0:\n+    resolution: {integrity: sha512-1OSmLd3awB/t8qdoEOMazZkNsfVTeY4fTsgzcQFdXNq8ToTN4ZGwrMnlda4K6smTFKD+GRV6O48i6Z4iKgPPpw==}\n+\n   renderkid@3.0.0:\n     resolution: {integrity: sha512-q/7VIQA8lmM1hF+jn+sFSPWGlMkSAeNYcPLmDQx2zzuiDfaLrOmumR8iaUKlenFgh0XRPIUeSPlH3A+AW3Z5pg==}\n \n   require-directory@2.1.1:\n@@ -7572,10 +7834,11 @@\n         optional: true\n       vue-tsc:\n         optional: true\n \n-  rolldown@1.0.0-beta.34:\n-    resolution: {integrity: sha512-Wwh7EwalMzzX3Yy3VN58VEajeR2Si8+HDNMf706jPLIqU7CxneRW+dQVfznf5O0TWTnJyu4npelwg2bzTXB1Nw==}\n+  rolldown@1.0.0-beta.38:\n+    resolution: {integrity: sha512-58frPNX55Je1YsyrtPJv9rOSR3G5efUZpRqok94Efsj0EUa8dnqJV3BldShyI7A+bVPleucOtzXHwVpJRcR0kQ==}\n+    engines: {node: ^20.19.0 || >=22.12.0}\n     hasBin: true\n \n   rollup@4.52.4:\n     resolution: {integrity: sha512-CLEVl+MnPAiKh5pl4dEWSyMTpuflgNQiLGhMv8ezD5W/qP8AKvmYpCOKRRNOh7oRKnauBZ4SyeYkMS+1VSyKwQ==}\n@@ -7832,8 +8095,11 @@\n \n   string_decoder@1.3.0:\n     resolution: {integrity: sha512-hkRX8U1WjJFd8LsDJ2yQ/wWWxaopEsABU1XfkM8A+j0+85JAGppt16cr1Whg6KIbb4okU6Mql6BOj+uup/wKeA==}\n \n+  stringify-entities@4.0.4:\n+    resolution: {integrity: sha512-IwfBptatlO+QCJUo19AqvrPNqlVMpW9YEL2LIVY+Rpv2qsjCGxaDLNRgeGsQWJhfItebuJhsGSLjaBbNSQ+ieg==}\n+\n   strip-ansi@6.0.1:\n     resolution: {integrity: sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==}\n     engines: {node: '>=8'}\n \n@@ -8050,8 +8316,11 @@\n \n   trim-lines@3.0.1:\n     resolution: {integrity: sha512-kRj8B+YHZCc9kQYdWfJB2/oUl9rA99qbowYYBtr4ui4mZyAQ2JpvVBd/6U2YloATfqBhBTSMhTpgBHtU0Mf3Rg==}\n \n+  trim-trailing-lines@2.1.0:\n+    resolution: {integrity: sha512-5UR5Biq4VlVOtzqkm2AZlgvSlDJtME46uV0br0gENbwN4l5+mMKT4b9gJKqWtuL2zAIqajGJGuvbCbcAJUZqBg==}\n+\n   triple-beam@1.4.1:\n     resolution: {integrity: sha512-aZbgViZrg1QNcG+LULa7nhZpJTZSLm/mXnHXnbAbjmN5aSa0y7V+wvv6+4WaBtpISJzThKy+PIPxc1Nq1EJ9mg==}\n     engines: {node: '>= 14.0.0'}\n \n@@ -8222,26 +8491,47 @@\n \n   unified@10.1.2:\n     resolution: {integrity: sha512-pUSWAi/RAnVy1Pif2kAoeWNBa3JVrx0MId2LASj8G+7AiHWoKZNTomq6LG326T68U7/e263X6fTdcXIy7XnF7Q==}\n \n+  unified@11.0.5:\n+    resolution: {integrity: sha512-xKvGhPWw3k84Qjh8bI3ZeJjqnyadK+GEFtazSfZv/rKeTkTjOJho6mFqh2SM96iIcZokxiOpg78GazTSg8+KHA==}\n+\n+  unist-util-find-after@5.0.0:\n+    resolution: {integrity: sha512-amQa0Ep2m6hE2g72AugUItjbuM8X8cGQnFoHk0pGfrFeT9GZhzN5SW8nRsiGKK7Aif4CrACPENkA6P/Lw6fHGQ==}\n+\n   unist-util-generated@2.0.1:\n     resolution: {integrity: sha512-qF72kLmPxAw0oN2fwpWIqbXAVyEqUzDHMsbtPvOudIlUzXYFIeQIuxXQCRCFh22B7cixvU0MG7m3MW8FTq/S+A==}\n \n   unist-util-is@5.2.1:\n     resolution: {integrity: sha512-u9njyyfEh43npf1M+yGKDGVPbY/JWEemg5nH05ncKPfi+kBbKBJoTdsogMu33uhytuLlv9y0O7GH7fEdwLdLQw==}\n \n+  unist-util-is@6.0.0:\n+    resolution: {integrity: sha512-2qCTHimwdxLfz+YzdGfkqNlH0tLi9xjTnHddPmJwtIG9MGsdbutfTc4P+haPD7l7Cjxf/WZj+we5qfVPvvxfYw==}\n+\n   unist-util-position@4.0.4:\n     resolution: {integrity: sha512-kUBE91efOWfIVBo8xzh/uZQ7p9ffYRtUbMRZBNFYwf0RK8koUMx6dGUfwylLOKmaT2cs4wSW96QoYUSXAyEtpg==}\n \n+  unist-util-position@5.0.0:\n+    resolution: {integrity: sha512-fucsC7HjXvkB5R3kTCO7kUjRdrS0BJt3M/FPxmHMBOm8JQi2BsHAHFsy27E0EolP8rp0NzXsJ+jNPyDWvOJZPA==}\n+\n   unist-util-stringify-position@3.0.3:\n     resolution: {integrity: sha512-k5GzIBZ/QatR8N5X2y+drfpWG8IDBzdnVj6OInRNWm1oXrzydiaAT2OQiA8DPRRZyAKb9b6I2a6PxYklZD0gKg==}\n \n+  unist-util-stringify-position@4.0.0:\n+    resolution: {integrity: sha512-0ASV06AAoKCDkS2+xw5RXJywruurpbC4JZSm7nr7MOt1ojAzvyyaO+UxZf18j8FCF6kmzCZKcAgN/yu2gm2XgQ==}\n+\n   unist-util-visit-parents@5.1.3:\n     resolution: {integrity: sha512-x6+y8g7wWMyQhL1iZfhIPhDAs7Xwbn9nRosDXl7qoPTSCy0yNxnKc+hWokFifWQIDGi154rdUqKvbCa4+1kLhg==}\n \n+  unist-util-visit-parents@6.0.1:\n+    resolution: {integrity: sha512-L/PqWzfTP9lzzEa6CKs0k2nARxTdZduw3zyh8d2NVBnsyvHjSX4TWse388YrrQKbvI8w20fGjGlhgT96WwKykw==}\n+\n   unist-util-visit@4.1.2:\n     resolution: {integrity: sha512-MSd8OUGISqHdVvfY9TPhyK2VdUrPgxkUtWSuMHF6XAAFuL4LokseigBnZtPnJMu+FbynTkFNnFlyjxpVKujMRg==}\n \n+  unist-util-visit@5.0.0:\n+    resolution: {integrity: sha512-MR04uvD+07cwl/yhVuVWAtw+3GOR/knlL55Nd/wAdblk27GCVt3lqpTivy/tkJcZoNPzTwS1Y+KMojlLDhoTzg==}\n+\n   universalify@2.0.1:\n     resolution: {integrity: sha512-gptHNQghINnc/vTGIk0SOFGFNXw7JVrlRUtConJRlvaw6DuX0wO5Jeko9sWrMBhh+PsYAZ7oXAiOnf/UKogyiw==}\n     engines: {node: '>= 10.0.0'}\n \n@@ -8367,14 +8657,23 @@\n   vary@1.1.2:\n     resolution: {integrity: sha512-BNGbWLfd0eUPabhkXUVm0j8uuvREyTh5ovRa/dyow/BqAbZJyC+5fU+IzQOzmAKzYqYRAISoRhdQr3eIZ/PXqg==}\n     engines: {node: '>= 0.8'}\n \n+  vfile-location@5.0.3:\n+    resolution: {integrity: sha512-5yXvWDEgqeiYiBe1lbxYF7UMAIm/IcopxMHrMQDq3nvKcjPKIhZklUKL+AE7J7uApI4kwe2snsK+eI6UTj9EHg==}\n+\n   vfile-message@3.1.4:\n     resolution: {integrity: sha512-fa0Z6P8HUrQN4BZaX05SIVXic+7kE3b05PWAtPuYP9QLHsLKYR7/AlLW3NtOrpXRLeawpDLMsVkmk5DG0NXgWw==}\n \n+  vfile-message@4.0.3:\n+    resolution: {integrity: sha512-QTHzsGd1EhbZs4AsQ20JX1rC3cOlt/IWJruk893DfLRr57lcnOeMaWG4K0JrRta4mIJZKth2Au3mM3u03/JWKw==}\n+\n   vfile@5.3.7:\n     resolution: {integrity: sha512-r7qlzkgErKjobAmyNIkkSpizsFPYiUPuJb5pNW1RB4JcYVZhs4lIbVqk8XPk033CV/1z8ss5pkax8SuhGpcG8g==}\n \n+  vfile@6.0.3:\n+    resolution: {integrity: sha512-KzIbH/9tXat2u30jf+smMwFCsno4wHVdNmzFyL+T/L3UGqqk6JKfVqOFOZEpZSHADH1k40ab6NUIXZq422ov3Q==}\n+\n   victory-vendor@36.9.2:\n     resolution: {integrity: sha512-PnpQQMuxlwYdocC8fIJqVXvkeViHYzotI+NJrCuav0ZYFoq912ZHBk3mCeuj+5/VpodOjPe1z0Fk2ihgzlXqjQ==}\n \n   vite-compatible-readable-stream@3.6.1:\n@@ -8443,8 +8742,11 @@\n   watchpack@2.4.4:\n     resolution: {integrity: sha512-c5EGNOiyxxV5qmTtAB7rbiXxi1ooX1pQKMLX/MIabJjRA0SJBQOjKF+KSVfHkr9U1cADPon0mRiVe/riyaiDUA==}\n     engines: {node: '>=10.13.0'}\n \n+  web-namespaces@2.0.1:\n+    resolution: {integrity: sha512-bKr1DkiNa2krS7qxNtdrtHAmzuYGFQLiQ13TsorsdT6ULTkPLKuu5+GsFpDlg6JFjUTwX2DyhMPG2be8uPrqsQ==}\n+\n   web-vitals@4.2.4:\n     resolution: {integrity: sha512-r4DIlprAGwJ7YM11VZp4R884m0Vmgr6EAKe3P+kO0PPj3Unqyvv59rczf6UiGcb9Z8QxZVcqKNwv/g0WNdWwsw==}\n \n   webidl-conversions@3.0.1:\n@@ -8641,8 +8943,11 @@\n \n   zod@3.25.76:\n     resolution: {integrity: sha512-gzUt/qt81nXsFGKIFcC3YnfEAx5NkunCfnDlvuBSSFS02bcXu4Lmea0AFIUwbLWxWPx3d9p8S5QoaujKcNQxcQ==}\n \n+  zwitch@2.0.4:\n+    resolution: {integrity: sha512-bXE4cR/kVZhKZX/RjPEflHaKVhUVl85noU3v6b8apfQEc1x4A+zBxjZ4lN8LqGd6WZ3dl98pY4o717VFmoPp+A==}\n+\n snapshots:\n \n   '@adobe/css-tools@4.4.4': {}\n \n@@ -9410,9 +9715,9 @@\n       '@emnapi/runtime': 1.5.0\n       '@tybys/wasm-util': 0.10.1\n     optional: true\n \n-  '@napi-rs/wasm-runtime@1.0.3':\n+  '@napi-rs/wasm-runtime@1.0.5':\n     dependencies:\n       '@emnapi/core': 1.5.0\n       '@emnapi/runtime': 1.5.0\n       '@tybys/wasm-util': 0.10.1\n@@ -9753,12 +10058,10 @@\n     dependencies:\n       '@opentelemetry/api': 1.9.0\n       '@opentelemetry/core': 2.1.0(@opentelemetry/api@1.9.0)\n \n-  '@oxc-project/runtime@0.82.3': {}\n+  '@oxc-project/types@0.89.0': {}\n \n-  '@oxc-project/types@0.82.3': {}\n-\n   '@popperjs/core@2.11.8': {}\n \n   '@posthog/react@1.4.0(@types/react@18.3.11)(posthog-js@1.255.1)(react@18.3.1)':\n     dependencies:\n@@ -10239,53 +10542,53 @@\n   '@remirror/core-constants@3.0.0': {}\n \n   '@remix-run/node-fetch-server@0.9.0': {}\n \n-  '@rolldown/binding-android-arm64@1.0.0-beta.34':\n+  '@rolldown/binding-android-arm64@1.0.0-beta.38':\n     optional: true\n \n-  '@rolldown/binding-darwin-arm64@1.0.0-beta.34':\n+  '@rolldown/binding-darwin-arm64@1.0.0-beta.38':\n     optional: true\n \n-  '@rolldown/binding-darwin-x64@1.0.0-beta.34':\n+  '@rolldown/binding-darwin-x64@1.0.0-beta.38':\n     optional: true\n \n-  '@rolldown/binding-freebsd-x64@1.0.0-beta.34':\n+  '@rolldown/binding-freebsd-x64@1.0.0-beta.38':\n     optional: true\n \n-  '@rolldown/binding-linux-arm-gnueabihf@1.0.0-beta.34':\n+  '@rolldown/binding-linux-arm-gnueabihf@1.0.0-beta.38':\n     optional: true\n \n-  '@rolldown/binding-linux-arm64-gnu@1.0.0-beta.34':\n+  '@rolldown/binding-linux-arm64-gnu@1.0.0-beta.38':\n     optional: true\n \n-  '@rolldown/binding-linux-arm64-musl@1.0.0-beta.34':\n+  '@rolldown/binding-linux-arm64-musl@1.0.0-beta.38':\n     optional: true\n \n-  '@rolldown/binding-linux-x64-gnu@1.0.0-beta.34':\n+  '@rolldown/binding-linux-x64-gnu@1.0.0-beta.38':\n     optional: true\n \n-  '@rolldown/binding-linux-x64-musl@1.0.0-beta.34':\n+  '@rolldown/binding-linux-x64-musl@1.0.0-beta.38':\n     optional: true\n \n-  '@rolldown/binding-openharmony-arm64@1.0.0-beta.34':\n+  '@rolldown/binding-openharmony-arm64@1.0.0-beta.38':\n     optional: true\n \n-  '@rolldown/binding-wasm32-wasi@1.0.0-beta.34':\n+  '@rolldown/binding-wasm32-wasi@1.0.0-beta.38':\n     dependencies:\n-      '@napi-rs/wasm-runtime': 1.0.3\n+      '@napi-rs/wasm-runtime': 1.0.5\n     optional: true\n \n-  '@rolldown/binding-win32-arm64-msvc@1.0.0-beta.34':\n+  '@rolldown/binding-win32-arm64-msvc@1.0.0-beta.38':\n     optional: true\n \n-  '@rolldown/binding-win32-ia32-msvc@1.0.0-beta.34':\n+  '@rolldown/binding-win32-ia32-msvc@1.0.0-beta.38':\n     optional: true\n \n-  '@rolldown/binding-win32-x64-msvc@1.0.0-beta.34':\n+  '@rolldown/binding-win32-x64-msvc@1.0.0-beta.38':\n     optional: true\n \n-  '@rolldown/pluginutils@1.0.0-beta.34': {}\n+  '@rolldown/pluginutils@1.0.0-beta.38': {}\n \n   '@rollup/pluginutils@5.2.0(rollup@4.52.4)':\n     dependencies:\n       '@types/estree': 1.0.8\n@@ -11499,8 +11802,12 @@\n   '@types/mdast@3.0.15':\n     dependencies:\n       '@types/unist': 2.0.11\n \n+  '@types/mdast@4.0.4':\n+    dependencies:\n+      '@types/unist': 3.0.3\n+\n   '@types/mdurl@1.0.5': {}\n \n   '@types/mdurl@2.0.0': {}\n \n@@ -12272,8 +12579,10 @@\n       upper-case-first: 2.0.2\n \n   case-sensitive-paths-webpack-plugin@2.4.0: {}\n \n+  ccount@2.0.1: {}\n+\n   chai@5.3.3:\n     dependencies:\n       assertion-error: 2.0.1\n       check-error: 2.1.1\n@@ -12317,8 +12626,12 @@\n       sentence-case: 3.0.4\n       snake-case: 3.0.4\n       tslib: 2.8.1\n \n+  character-entities-html4@2.1.0: {}\n+\n+  character-entities-legacy@3.0.0: {}\n+\n   character-entities@2.0.2: {}\n \n   check-error@2.1.1: {}\n \n@@ -12846,8 +13159,10 @@\n   entities@4.5.0: {}\n \n   entities@5.0.0: {}\n \n+  entities@6.0.1: {}\n+\n   err-code@2.0.3: {}\n \n   error-ex@1.3.4:\n     dependencies:\n@@ -12998,8 +13313,10 @@\n   escape-string-regexp@1.0.5: {}\n \n   escape-string-regexp@4.0.0: {}\n \n+  escape-string-regexp@5.0.0: {}\n+\n   eslint-config-next@14.2.32(eslint@8.57.1)(typescript@5.8.3):\n     dependencies:\n       '@next/eslint-plugin-next': 14.2.32\n       '@rushstack/eslint-patch': 1.12.0\n@@ -13627,10 +13944,119 @@\n   hasown@2.0.2:\n     dependencies:\n       function-bind: 1.1.2\n \n+  hast-util-embedded@3.0.0:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+      hast-util-is-element: 3.0.0\n+\n+  hast-util-from-html@2.0.3:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+      devlop: 1.1.0\n+      hast-util-from-parse5: 8.0.3\n+      parse5: 7.3.0\n+      vfile: 6.0.3\n+      vfile-message: 4.0.3\n+\n+  hast-util-from-parse5@8.0.3:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+      '@types/unist': 3.0.3\n+      devlop: 1.1.0\n+      hastscript: 9.0.1\n+      property-information: 7.1.0\n+      vfile: 6.0.3\n+      vfile-location: 5.0.3\n+      web-namespaces: 2.0.1\n+\n+  hast-util-has-property@3.0.0:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+\n+  hast-util-is-body-ok-link@3.0.1:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+\n+  hast-util-is-element@3.0.0:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+\n+  hast-util-minify-whitespace@1.0.1:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+      hast-util-embedded: 3.0.0\n+      hast-util-is-element: 3.0.0\n+      hast-util-whitespace: 3.0.0\n+      unist-util-is: 6.0.0\n+\n+  hast-util-parse-selector@4.0.0:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+\n+  hast-util-phrasing@3.0.1:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+      hast-util-embedded: 3.0.0\n+      hast-util-has-property: 3.0.0\n+      hast-util-is-body-ok-link: 3.0.1\n+      hast-util-is-element: 3.0.0\n+\n+  hast-util-to-html@9.0.5:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+      '@types/unist': 3.0.3\n+      ccount: 2.0.1\n+      comma-separated-tokens: 2.0.3\n+      hast-util-whitespace: 3.0.0\n+      html-void-elements: 3.0.0\n+      mdast-util-to-hast: 13.2.0\n+      property-information: 7.1.0\n+      space-separated-tokens: 2.0.2\n+      stringify-entities: 4.0.4\n+      zwitch: 2.0.4\n+\n+  hast-util-to-mdast@10.1.2:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+      '@types/mdast': 4.0.4\n+      '@ungap/structured-clone': 1.3.0\n+      hast-util-phrasing: 3.0.1\n+      hast-util-to-html: 9.0.5\n+      hast-util-to-text: 4.0.2\n+      hast-util-whitespace: 3.0.0\n+      mdast-util-phrasing: 4.1.0\n+      mdast-util-to-hast: 13.2.0\n+      mdast-util-to-string: 4.0.0\n+      rehype-minify-whitespace: 6.0.2\n+      trim-trailing-lines: 2.1.0\n+      unist-util-position: 5.0.0\n+      unist-util-visit: 5.0.0\n+\n+  hast-util-to-text@4.0.2:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+      '@types/unist': 3.0.3\n+      hast-util-is-element: 3.0.0\n+      unist-util-find-after: 5.0.0\n+\n   hast-util-whitespace@2.0.1: {}\n \n+  hast-util-whitespace@3.0.0:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+\n+  hast@1.0.0: {}\n+\n+  hastscript@9.0.1:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+      comma-separated-tokens: 2.0.3\n+      hast-util-parse-selector: 4.0.0\n+      property-information: 7.1.0\n+      space-separated-tokens: 2.0.2\n+\n   he@1.2.0: {}\n \n   header-case@2.0.4:\n     dependencies:\n@@ -13668,8 +14094,10 @@\n       param-case: 3.0.4\n       relateurl: 0.2.7\n       terser: 5.43.1\n \n+  html-void-elements@3.0.0: {}\n+\n   html-webpack-plugin@5.6.4(webpack@5.101.3(@swc/core@1.13.5(@swc/helpers@0.5.17))(esbuild@0.25.0)):\n     dependencies:\n       '@types/html-minifier-terser': 6.1.0\n       html-minifier-terser: 6.1.0\n@@ -14116,8 +14544,10 @@\n       ms: 2.1.3\n       safe-stable-stringify: 2.5.0\n       triple-beam: 1.4.1\n \n+  longest-streak@3.1.0: {}\n+\n   loose-envify@1.4.0:\n     dependencies:\n       js-tokens: 4.0.0\n \n@@ -14171,8 +14601,10 @@\n       mdurl: 2.0.0\n       punycode.js: 2.3.1\n       uc.micro: 2.1.0\n \n+  markdown-table@3.0.4: {}\n+\n   masonry-layout@4.2.2:\n     dependencies:\n       get-size: 2.0.3\n       outlayer: 2.1.1\n@@ -14186,8 +14618,15 @@\n       '@types/mdast': 3.0.15\n       '@types/unist': 2.0.11\n       unist-util-visit: 4.1.2\n \n+  mdast-util-find-and-replace@3.0.2:\n+    dependencies:\n+      '@types/mdast': 4.0.4\n+      escape-string-regexp: 5.0.0\n+      unist-util-is: 6.0.0\n+      unist-util-visit-parents: 6.0.1\n+\n   mdast-util-from-markdown@1.3.1:\n     dependencies:\n       '@types/mdast': 3.0.15\n       '@types/unist': 2.0.11\n@@ -14203,8 +14642,87 @@\n       uvu: 0.5.6\n     transitivePeerDependencies:\n       - supports-color\n \n+  mdast-util-from-markdown@2.0.2:\n+    dependencies:\n+      '@types/mdast': 4.0.4\n+      '@types/unist': 3.0.3\n+      decode-named-character-reference: 1.2.0\n+      devlop: 1.1.0\n+      mdast-util-to-string: 4.0.0\n+      micromark: 4.0.2\n+      micromark-util-decode-numeric-character-reference: 2.0.2\n+      micromark-util-decode-string: 2.0.1\n+      micromark-util-normalize-identifier: 2.0.1\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+      unist-util-stringify-position: 4.0.0\n+    transitivePeerDependencies:\n+      - supports-color\n+\n+  mdast-util-gfm-autolink-literal@2.0.1:\n+    dependencies:\n+      '@types/mdast': 4.0.4\n+      ccount: 2.0.1\n+      devlop: 1.1.0\n+      mdast-util-find-and-replace: 3.0.2\n+      micromark-util-character: 2.1.1\n+\n+  mdast-util-gfm-footnote@2.1.0:\n+    dependencies:\n+      '@types/mdast': 4.0.4\n+      devlop: 1.1.0\n+      mdast-util-from-markdown: 2.0.2\n+      mdast-util-to-markdown: 2.1.2\n+      micromark-util-normalize-identifier: 2.0.1\n+    transitivePeerDependencies:\n+      - supports-color\n+\n+  mdast-util-gfm-strikethrough@2.0.0:\n+    dependencies:\n+      '@types/mdast': 4.0.4\n+      mdast-util-from-markdown: 2.0.2\n+      mdast-util-to-markdown: 2.1.2\n+    transitivePeerDependencies:\n+      - supports-color\n+\n+  mdast-util-gfm-table@2.0.0:\n+    dependencies:\n+      '@types/mdast': 4.0.4\n+      devlop: 1.1.0\n+      markdown-table: 3.0.4\n+      mdast-util-from-markdown: 2.0.2\n+      mdast-util-to-markdown: 2.1.2\n+    transitivePeerDependencies:\n+      - supports-color\n+\n+  mdast-util-gfm-task-list-item@2.0.0:\n+    dependencies:\n+      '@types/mdast': 4.0.4\n+      devlop: 1.1.0\n+      mdast-util-from-markdown: 2.0.2\n+      mdast-util-to-markdown: 2.1.2\n+    transitivePeerDependencies:\n+      - supports-color\n+\n+  mdast-util-gfm@3.1.0:\n+    dependencies:\n+      mdast-util-from-markdown: 2.0.2\n+      mdast-util-gfm-autolink-literal: 2.0.1\n+      mdast-util-gfm-footnote: 2.1.0\n+      mdast-util-gfm-strikethrough: 2.0.0\n+      mdast-util-gfm-table: 2.0.0\n+      mdast-util-gfm-task-list-item: 2.0.0\n+      mdast-util-to-markdown: 2.1.2\n+    transitivePeerDependencies:\n+      - supports-color\n+\n+  mdast-util-phrasing@4.1.0:\n+    dependencies:\n+      '@types/mdast': 4.0.4\n+      unist-util-is: 6.0.0\n+\n   mdast-util-to-hast@12.3.0:\n     dependencies:\n       '@types/hast': 2.3.10\n       '@types/mdast': 3.0.15\n@@ -14214,12 +14732,42 @@\n       unist-util-generated: 2.0.1\n       unist-util-position: 4.0.4\n       unist-util-visit: 4.1.2\n \n+  mdast-util-to-hast@13.2.0:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+      '@types/mdast': 4.0.4\n+      '@ungap/structured-clone': 1.3.0\n+      devlop: 1.1.0\n+      micromark-util-sanitize-uri: 2.0.1\n+      trim-lines: 3.0.1\n+      unist-util-position: 5.0.0\n+      unist-util-visit: 5.0.0\n+      vfile: 6.0.3\n+\n+  mdast-util-to-markdown@2.1.2:\n+    dependencies:\n+      '@types/mdast': 4.0.4\n+      '@types/unist': 3.0.3\n+      longest-streak: 3.1.0\n+      mdast-util-phrasing: 4.1.0\n+      mdast-util-to-string: 4.0.0\n+      micromark-util-classify-character: 2.0.1\n+      micromark-util-decode-string: 2.0.1\n+      unist-util-visit: 5.0.0\n+      zwitch: 2.0.4\n+\n   mdast-util-to-string@3.2.0:\n     dependencies:\n       '@types/mdast': 3.0.15\n \n+  mdast-util-to-string@4.0.0:\n+    dependencies:\n+      '@types/mdast': 4.0.4\n+\n+  mdast@3.0.0: {}\n+\n   mdn-data@2.0.14: {}\n \n   mdurl@2.0.0: {}\n \n@@ -14261,100 +14809,269 @@\n       micromark-util-symbol: 1.1.0\n       micromark-util-types: 1.1.0\n       uvu: 0.5.6\n \n+  micromark-core-commonmark@2.0.3:\n+    dependencies:\n+      decode-named-character-reference: 1.2.0\n+      devlop: 1.1.0\n+      micromark-factory-destination: 2.0.1\n+      micromark-factory-label: 2.0.1\n+      micromark-factory-space: 2.0.1\n+      micromark-factory-title: 2.0.1\n+      micromark-factory-whitespace: 2.0.1\n+      micromark-util-character: 2.1.1\n+      micromark-util-chunked: 2.0.1\n+      micromark-util-classify-character: 2.0.1\n+      micromark-util-html-tag-name: 2.0.1\n+      micromark-util-normalize-identifier: 2.0.1\n+      micromark-util-resolve-all: 2.0.1\n+      micromark-util-subtokenize: 2.1.0\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n+  micromark-extension-gfm-autolink-literal@2.1.0:\n+    dependencies:\n+      micromark-util-character: 2.1.1\n+      micromark-util-sanitize-uri: 2.0.1\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n+  micromark-extension-gfm-footnote@2.1.0:\n+    dependencies:\n+      devlop: 1.1.0\n+      micromark-core-commonmark: 2.0.3\n+      micromark-factory-space: 2.0.1\n+      micromark-util-character: 2.1.1\n+      micromark-util-normalize-identifier: 2.0.1\n+      micromark-util-sanitize-uri: 2.0.1\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n+  micromark-extension-gfm-strikethrough@2.1.0:\n+    dependencies:\n+      devlop: 1.1.0\n+      micromark-util-chunked: 2.0.1\n+      micromark-util-classify-character: 2.0.1\n+      micromark-util-resolve-all: 2.0.1\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n+  micromark-extension-gfm-table@2.1.1:\n+    dependencies:\n+      devlop: 1.1.0\n+      micromark-factory-space: 2.0.1\n+      micromark-util-character: 2.1.1\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n+  micromark-extension-gfm-tagfilter@2.0.0:\n+    dependencies:\n+      micromark-util-types: 2.0.2\n+\n+  micromark-extension-gfm-task-list-item@2.1.0:\n+    dependencies:\n+      devlop: 1.1.0\n+      micromark-factory-space: 2.0.1\n+      micromark-util-character: 2.1.1\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n+  micromark-extension-gfm@3.0.0:\n+    dependencies:\n+      micromark-extension-gfm-autolink-literal: 2.1.0\n+      micromark-extension-gfm-footnote: 2.1.0\n+      micromark-extension-gfm-strikethrough: 2.1.0\n+      micromark-extension-gfm-table: 2.1.1\n+      micromark-extension-gfm-tagfilter: 2.0.0\n+      micromark-extension-gfm-task-list-item: 2.1.0\n+      micromark-util-combine-extensions: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n   micromark-factory-destination@1.1.0:\n     dependencies:\n       micromark-util-character: 1.2.0\n       micromark-util-symbol: 1.1.0\n       micromark-util-types: 1.1.0\n \n+  micromark-factory-destination@2.0.1:\n+    dependencies:\n+      micromark-util-character: 2.1.1\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n   micromark-factory-label@1.1.0:\n     dependencies:\n       micromark-util-character: 1.2.0\n       micromark-util-symbol: 1.1.0\n       micromark-util-types: 1.1.0\n       uvu: 0.5.6\n \n+  micromark-factory-label@2.0.1:\n+    dependencies:\n+      devlop: 1.1.0\n+      micromark-util-character: 2.1.1\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n   micromark-factory-space@1.1.0:\n     dependencies:\n       micromark-util-character: 1.2.0\n       micromark-util-types: 1.1.0\n \n+  micromark-factory-space@2.0.1:\n+    dependencies:\n+      micromark-util-character: 2.1.1\n+      micromark-util-types: 2.0.2\n+\n   micromark-factory-title@1.1.0:\n     dependencies:\n       micromark-factory-space: 1.1.0\n       micromark-util-character: 1.2.0\n       micromark-util-symbol: 1.1.0\n       micromark-util-types: 1.1.0\n \n+  micromark-factory-title@2.0.1:\n+    dependencies:\n+      micromark-factory-space: 2.0.1\n+      micromark-util-character: 2.1.1\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n   micromark-factory-whitespace@1.1.0:\n     dependencies:\n       micromark-factory-space: 1.1.0\n       micromark-util-character: 1.2.0\n       micromark-util-symbol: 1.1.0\n       micromark-util-types: 1.1.0\n \n+  micromark-factory-whitespace@2.0.1:\n+    dependencies:\n+      micromark-factory-space: 2.0.1\n+      micromark-util-character: 2.1.1\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n   micromark-util-character@1.2.0:\n     dependencies:\n       micromark-util-symbol: 1.1.0\n       micromark-util-types: 1.1.0\n \n+  micromark-util-character@2.1.1:\n+    dependencies:\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n   micromark-util-chunked@1.1.0:\n     dependencies:\n       micromark-util-symbol: 1.1.0\n \n+  micromark-util-chunked@2.0.1:\n+    dependencies:\n+      micromark-util-symbol: 2.0.1\n+\n   micromark-util-classify-character@1.1.0:\n     dependencies:\n       micromark-util-character: 1.2.0\n       micromark-util-symbol: 1.1.0\n       micromark-util-types: 1.1.0\n \n+  micromark-util-classify-character@2.0.1:\n+    dependencies:\n+      micromark-util-character: 2.1.1\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n   micromark-util-combine-extensions@1.1.0:\n     dependencies:\n       micromark-util-chunked: 1.1.0\n       micromark-util-types: 1.1.0\n \n+  micromark-util-combine-extensions@2.0.1:\n+    dependencies:\n+      micromark-util-chunked: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n   micromark-util-decode-numeric-character-reference@1.1.0:\n     dependencies:\n       micromark-util-symbol: 1.1.0\n \n+  micromark-util-decode-numeric-character-reference@2.0.2:\n+    dependencies:\n+      micromark-util-symbol: 2.0.1\n+\n   micromark-util-decode-string@1.1.0:\n     dependencies:\n       decode-named-character-reference: 1.2.0\n       micromark-util-character: 1.2.0\n       micromark-util-decode-numeric-character-reference: 1.1.0\n       micromark-util-symbol: 1.1.0\n \n+  micromark-util-decode-string@2.0.1:\n+    dependencies:\n+      decode-named-character-reference: 1.2.0\n+      micromark-util-character: 2.1.1\n+      micromark-util-decode-numeric-character-reference: 2.0.2\n+      micromark-util-symbol: 2.0.1\n+\n   micromark-util-encode@1.1.0: {}\n \n+  micromark-util-encode@2.0.1: {}\n+\n   micromark-util-html-tag-name@1.2.0: {}\n \n+  micromark-util-html-tag-name@2.0.1: {}\n+\n   micromark-util-normalize-identifier@1.1.0:\n     dependencies:\n       micromark-util-symbol: 1.1.0\n \n+  micromark-util-normalize-identifier@2.0.1:\n+    dependencies:\n+      micromark-util-symbol: 2.0.1\n+\n   micromark-util-resolve-all@1.1.0:\n     dependencies:\n       micromark-util-types: 1.1.0\n \n+  micromark-util-resolve-all@2.0.1:\n+    dependencies:\n+      micromark-util-types: 2.0.2\n+\n   micromark-util-sanitize-uri@1.2.0:\n     dependencies:\n       micromark-util-character: 1.2.0\n       micromark-util-encode: 1.1.0\n       micromark-util-symbol: 1.1.0\n \n+  micromark-util-sanitize-uri@2.0.1:\n+    dependencies:\n+      micromark-util-character: 2.1.1\n+      micromark-util-encode: 2.0.1\n+      micromark-util-symbol: 2.0.1\n+\n   micromark-util-subtokenize@1.1.0:\n     dependencies:\n       micromark-util-chunked: 1.1.0\n       micromark-util-symbol: 1.1.0\n       micromark-util-types: 1.1.0\n       uvu: 0.5.6\n \n+  micromark-util-subtokenize@2.1.0:\n+    dependencies:\n+      devlop: 1.1.0\n+      micromark-util-chunked: 2.0.1\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+\n   micromark-util-symbol@1.1.0: {}\n \n+  micromark-util-symbol@2.0.1: {}\n+\n   micromark-util-types@1.1.0: {}\n \n+  micromark-util-types@2.0.2: {}\n+\n   micromark@3.2.0:\n     dependencies:\n       '@types/debug': 4.1.12\n       debug: 4.4.3\n@@ -14375,8 +15092,30 @@\n       uvu: 0.5.6\n     transitivePeerDependencies:\n       - supports-color\n \n+  micromark@4.0.2:\n+    dependencies:\n+      '@types/debug': 4.1.12\n+      debug: 4.4.3\n+      decode-named-character-reference: 1.2.0\n+      devlop: 1.1.0\n+      micromark-core-commonmark: 2.0.3\n+      micromark-factory-space: 2.0.1\n+      micromark-util-character: 2.1.1\n+      micromark-util-chunked: 2.0.1\n+      micromark-util-combine-extensions: 2.0.1\n+      micromark-util-decode-numeric-character-reference: 2.0.2\n+      micromark-util-encode: 2.0.1\n+      micromark-util-normalize-identifier: 2.0.1\n+      micromark-util-resolve-all: 2.0.1\n+      micromark-util-sanitize-uri: 2.0.1\n+      micromark-util-subtokenize: 2.1.0\n+      micromark-util-symbol: 2.0.1\n+      micromark-util-types: 2.0.2\n+    transitivePeerDependencies:\n+      - supports-color\n+\n   micromatch@4.0.8:\n     dependencies:\n       braces: 3.0.3\n       picomatch: 2.3.1\n@@ -14474,9 +15213,9 @@\n   negotiator@0.6.4: {}\n \n   neo-async@2.6.2: {}\n \n-  next-themes@0.2.1(next@14.2.32(@babel/core@7.28.4)(@opentelemetry/api@1.9.0)(babel-plugin-macros@3.1.0)(react-dom@18.3.1(react@18.3.1))(react@18.3.1))(react-dom@18.3.1(react@18.3.1))(react@18.3.1):\n+  next-themes@0.2.1(next@14.2.32(@opentelemetry/api@1.9.0)(babel-plugin-macros@3.1.0)(react-dom@18.3.1(react@18.3.1))(react@18.3.1))(react-dom@18.3.1(react@18.3.1))(react@18.3.1):\n     dependencies:\n       next: 14.2.32(@babel/core@7.28.4)(@opentelemetry/api@1.9.0)(babel-plugin-macros@3.1.0)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n       react: 18.3.1\n       react-dom: 18.3.1(react@18.3.1)\n@@ -14725,8 +15464,12 @@\n       lines-and-columns: 1.2.4\n \n   parse-svg-path@0.1.2: {}\n \n+  parse5@7.3.0:\n+    dependencies:\n+      entities: 6.0.1\n+\n   parseurl@1.3.3: {}\n \n   pascal-case@3.1.2:\n     dependencies:\n@@ -14967,8 +15710,10 @@\n       react-is: 16.13.1\n \n   property-information@6.5.0: {}\n \n+  property-information@7.1.0: {}\n+\n   prosemirror-changeset@2.3.1:\n     dependencies:\n       prosemirror-transform: 1.10.4\n \n@@ -15426,25 +16171,70 @@\n   registry-url@3.1.0:\n     dependencies:\n       rc: 1.2.8\n \n+  rehype-minify-whitespace@6.0.2:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+      hast-util-minify-whitespace: 1.0.1\n+\n+  rehype-parse@9.0.1:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+      hast-util-from-html: 2.0.3\n+      unified: 11.0.5\n+\n+  rehype-remark@10.0.1:\n+    dependencies:\n+      '@types/hast': 3.0.4\n+      '@types/mdast': 4.0.4\n+      hast-util-to-mdast: 10.1.2\n+      unified: 11.0.5\n+      vfile: 6.0.3\n+\n   relateurl@0.2.7: {}\n \n+  remark-gfm@4.0.1:\n+    dependencies:\n+      '@types/mdast': 4.0.4\n+      mdast-util-gfm: 3.1.0\n+      micromark-extension-gfm: 3.0.0\n+      remark-parse: 11.0.0\n+      remark-stringify: 11.0.0\n+      unified: 11.0.5\n+    transitivePeerDependencies:\n+      - supports-color\n+\n   remark-parse@10.0.2:\n     dependencies:\n       '@types/mdast': 3.0.15\n       mdast-util-from-markdown: 1.3.1\n       unified: 10.1.2\n     transitivePeerDependencies:\n       - supports-color\n \n+  remark-parse@11.0.0:\n+    dependencies:\n+      '@types/mdast': 4.0.4\n+      mdast-util-from-markdown: 2.0.2\n+      micromark-util-types: 2.0.2\n+      unified: 11.0.5\n+    transitivePeerDependencies:\n+      - supports-color\n+\n   remark-rehype@10.1.0:\n     dependencies:\n       '@types/hast': 2.3.10\n       '@types/mdast': 3.0.15\n       mdast-util-to-hast: 12.3.0\n       unified: 10.1.2\n \n+  remark-stringify@11.0.0:\n+    dependencies:\n+      '@types/mdast': 4.0.4\n+      mdast-util-to-markdown: 2.1.2\n+      unified: 11.0.5\n+\n   renderkid@3.0.0:\n     dependencies:\n       css-select: 4.3.0\n       dom-converter: 0.2.0\n@@ -15491,9 +16281,9 @@\n   rimraf@3.0.2:\n     dependencies:\n       glob: 11.1.0\n \n-  rolldown-plugin-dts@0.16.11(rolldown@1.0.0-beta.34)(typescript@5.8.3):\n+  rolldown-plugin-dts@0.16.11(rolldown@1.0.0-beta.38)(typescript@5.8.3):\n     dependencies:\n       '@babel/generator': 7.28.3\n       '@babel/parser': 7.28.4\n       '@babel/types': 7.28.4\n@@ -15502,36 +16292,35 @@\n       debug: 4.4.3\n       dts-resolver: 2.1.2\n       get-tsconfig: 4.10.1\n       magic-string: 0.30.19\n-      rolldown: 1.0.0-beta.34\n+      rolldown: 1.0.0-beta.38\n     optionalDependencies:\n       typescript: 5.8.3\n     transitivePeerDependencies:\n       - oxc-resolver\n       - supports-color\n \n-  rolldown@1.0.0-beta.34:\n+  rolldown@1.0.0-beta.38:\n     dependencies:\n-      '@oxc-project/runtime': 0.82.3\n-      '@oxc-project/types': 0.82.3\n-      '@rolldown/pluginutils': 1.0.0-beta.34\n+      '@oxc-project/types': 0.89.0\n+      '@rolldown/pluginutils': 1.0.0-beta.38\n       ansis: 4.2.0\n     optionalDependencies:\n-      '@rolldown/binding-android-arm64': 1.0.0-beta.34\n-      '@rolldown/binding-darwin-arm64': 1.0.0-beta.34\n-      '@rolldown/binding-darwin-x64': 1.0.0-beta.34\n-      '@rolldown/binding-freebsd-x64': 1.0.0-beta.34\n-      '@rolldown/binding-linux-arm-gnueabihf': 1.0.0-beta.34\n-      '@rolldown/binding-linux-arm64-gnu': 1.0.0-beta.34\n-      '@rolldown/binding-linux-arm64-musl': 1.0.0-beta.34\n-      '@rolldown/binding-linux-x64-gnu': 1.0.0-beta.34\n-      '@rolldown/binding-linux-x64-musl': 1.0.0-beta.34\n-      '@rolldown/binding-openharmony-arm64': 1.0.0-beta.34\n-      '@rolldown/binding-wasm32-wasi': 1.0.0-beta.34\n-      '@rolldown/binding-win32-arm64-msvc': 1.0.0-beta.34\n-      '@rolldown/binding-win32-ia32-msvc': 1.0.0-beta.34\n-      '@rolldown/binding-win32-x64-msvc': 1.0.0-beta.34\n+      '@rolldown/binding-android-arm64': 1.0.0-beta.38\n+      '@rolldown/binding-darwin-arm64': 1.0.0-beta.38\n+      '@rolldown/binding-darwin-x64': 1.0.0-beta.38\n+      '@rolldown/binding-freebsd-x64': 1.0.0-beta.38\n+      '@rolldown/binding-linux-arm-gnueabihf': 1.0.0-beta.38\n+      '@rolldown/binding-linux-arm64-gnu': 1.0.0-beta.38\n+      '@rolldown/binding-linux-arm64-musl': 1.0.0-beta.38\n+      '@rolldown/binding-linux-x64-gnu': 1.0.0-beta.38\n+      '@rolldown/binding-linux-x64-musl': 1.0.0-beta.38\n+      '@rolldown/binding-openharmony-arm64': 1.0.0-beta.38\n+      '@rolldown/binding-wasm32-wasi': 1.0.0-beta.38\n+      '@rolldown/binding-win32-arm64-msvc': 1.0.0-beta.38\n+      '@rolldown/binding-win32-ia32-msvc': 1.0.0-beta.38\n+      '@rolldown/binding-win32-x64-msvc': 1.0.0-beta.38\n \n   rollup@4.52.4:\n     dependencies:\n       '@types/estree': 1.0.8\n@@ -15912,8 +16701,13 @@\n   string_decoder@1.3.0:\n     dependencies:\n       safe-buffer: 5.2.1\n \n+  stringify-entities@4.0.4:\n+    dependencies:\n+      character-entities-html4: 2.1.0\n+      character-entities-legacy: 3.0.0\n+\n   strip-ansi@6.0.1:\n     dependencies:\n       ansi-regex: 5.0.1\n \n@@ -16117,8 +16911,10 @@\n   tree-kill@1.2.2: {}\n \n   trim-lines@3.0.1: {}\n \n+  trim-trailing-lines@2.1.0: {}\n+\n   triple-beam@1.4.1: {}\n \n   trough@2.2.0: {}\n \n@@ -16155,10 +16951,10 @@\n       debug: 4.4.3\n       diff: 8.0.2\n       empathic: 2.0.0\n       hookable: 5.5.3\n-      rolldown: 1.0.0-beta.34\n-      rolldown-plugin-dts: 0.16.11(rolldown@1.0.0-beta.34)(typescript@5.8.3)\n+      rolldown: 1.0.0-beta.38\n+      rolldown-plugin-dts: 0.16.11(rolldown@1.0.0-beta.38)(typescript@5.8.3)\n       semver: 7.7.2\n       tinyexec: 1.0.1\n       tinyglobby: 0.2.15\n       tree-kill: 1.2.2\n@@ -16296,33 +17092,71 @@\n       is-plain-obj: 4.1.0\n       trough: 2.2.0\n       vfile: 5.3.7\n \n+  unified@11.0.5:\n+    dependencies:\n+      '@types/unist': 3.0.3\n+      bail: 2.0.2\n+      devlop: 1.1.0\n+      extend: 3.0.2\n+      is-plain-obj: 4.1.0\n+      trough: 2.2.0\n+      vfile: 6.0.3\n+\n+  unist-util-find-after@5.0.0:\n+    dependencies:\n+      '@types/unist': 3.0.3\n+      unist-util-is: 6.0.0\n+\n   unist-util-generated@2.0.1: {}\n \n   unist-util-is@5.2.1:\n     dependencies:\n       '@types/unist': 2.0.11\n \n+  unist-util-is@6.0.0:\n+    dependencies:\n+      '@types/unist': 3.0.3\n+\n   unist-util-position@4.0.4:\n     dependencies:\n       '@types/unist': 2.0.11\n \n+  unist-util-position@5.0.0:\n+    dependencies:\n+      '@types/unist': 3.0.3\n+\n   unist-util-stringify-position@3.0.3:\n     dependencies:\n       '@types/unist': 2.0.11\n \n+  unist-util-stringify-position@4.0.0:\n+    dependencies:\n+      '@types/unist': 3.0.3\n+\n   unist-util-visit-parents@5.1.3:\n     dependencies:\n       '@types/unist': 2.0.11\n       unist-util-is: 5.2.1\n \n+  unist-util-visit-parents@6.0.1:\n+    dependencies:\n+      '@types/unist': 3.0.3\n+      unist-util-is: 6.0.0\n+\n   unist-util-visit@4.1.2:\n     dependencies:\n       '@types/unist': 2.0.11\n       unist-util-is: 5.2.1\n       unist-util-visit-parents: 5.1.3\n \n+  unist-util-visit@5.0.0:\n+    dependencies:\n+      '@types/unist': 3.0.3\n+      unist-util-is: 6.0.0\n+      unist-util-visit-parents: 6.0.1\n+\n   universalify@2.0.1: {}\n \n   unpipe@1.0.0: {}\n \n@@ -16457,20 +17291,35 @@\n   validate-npm-package-name@5.0.1: {}\n \n   vary@1.1.2: {}\n \n+  vfile-location@5.0.3:\n+    dependencies:\n+      '@types/unist': 3.0.3\n+      vfile: 6.0.3\n+\n   vfile-message@3.1.4:\n     dependencies:\n       '@types/unist': 2.0.11\n       unist-util-stringify-position: 3.0.3\n \n+  vfile-message@4.0.3:\n+    dependencies:\n+      '@types/unist': 3.0.3\n+      unist-util-stringify-position: 4.0.0\n+\n   vfile@5.3.7:\n     dependencies:\n       '@types/unist': 2.0.11\n       is-buffer: 2.0.5\n       unist-util-stringify-position: 3.0.3\n       vfile-message: 3.1.4\n \n+  vfile@6.0.3:\n+    dependencies:\n+      '@types/unist': 3.0.3\n+      vfile-message: 4.0.3\n+\n   victory-vendor@36.9.2:\n     dependencies:\n       '@types/d3-array': 3.2.1\n       '@types/d3-ease': 3.0.2\n@@ -16550,8 +17399,10 @@\n     dependencies:\n       glob-to-regexp: 0.4.1\n       graceful-fs: 4.2.11\n \n+  web-namespaces@2.0.1: {}\n+\n   web-vitals@4.2.4: {}\n \n   webidl-conversions@3.0.1: {}\n \n@@ -16769,4 +17620,6 @@\n     dependencies:\n       zod: 3.25.76\n \n   zod@3.25.76: {}\n+\n+  zwitch@2.0.4: {}\n"
        }
      ]
    },
    {
      "id": "fix-project-access",
      "sha": "60220801acf3b0242a52c993d49ab314e5063979",
      "parentSha": "8db95d9ec0872f031fa4cb05ea56aa0f9abb754f",
      "spec": "Implement improved project access handling and UI behavior across backend and frontend.\n\nBackend (Django API)\n1) Enforce correct permission and error handling in ProjectViewSet.retrieve\n- File: apps/api/plane/app/views/project/base.py\n- Behavior: Do not filter by project membership in the initial queryset. Retrieve the project by pk within the given workspace and ensure archived_at is null. If not found, return 404.\n- After retrieving, check if the requesting user is a project member using the prefetched members_list.\n  - If not a member and project.network == ProjectNetwork.SECRET, return 403 with an error message like \"You do not have permission\".\n  - If not a member and project.network is public, return 409 with an error message like \"You are not a member of this project\".\n- Only record recent_visited_task and return the serialized project if the user is allowed to access it.\n- Ensure ProjectNetwork is imported and used for network comparison.\n\n2) Export ProjectNetwork in models init\n- File: apps/api/plane/db/models/__init__.py\n- Add ProjectNetwork to the exported names from .project so it can be imported elsewhere.\n\nFrontend (Web App)\nA) Centralize project access gating and reduce loading flicker\n1) Refactor ProjectAuthWrapper to new behavior\n- File: apps/web/core/layouts/auth-layout/project-wrapper.tsx\n- Make projectId a required prop.\n- Use SWR to fetch project details with a stable key and capture isLoading and error from PROJECT_DETAILS. Do not gate keys by checking workspaceSlug/projectId; rely on key generator to handle state. Keep other SWR calls for labels, members, states, intake state, estimates, cycles, modules (slim + full via Promise.all), and views with revalidateIfStale: false and revalidateOnFocus: false where applicable.\n- Remove usage of the old JoinProject component. Instead, render ProjectAccessRestriction when hasPermissionToCurrentProject is false, passing:\n  - errorStatusCode from the failed PROJECT_DETAILS call (error.status).\n  - isWorkspaceAdmin derived from allowPermissions at workspace level.\n  - handleJoinProject: calls joinProject(workspaceSlug, projectId), then fetchProjectDetails, and manages a local isJoiningProject disabled state.\n  - isJoinButtonDisabled bound to isJoiningProject.\n- During initial load (parent isLoading or project details SWR isLoading without error), render nothing (avoid showing spinners to prevent flicker). Otherwise, render children.\n\n2) Update CE alias wrapper to require projectId\n- File: apps/web/ce/layouts/project-wrapper.tsx\n- Change IProjectAuthWrapper.projectId from optional to required and pass through unchanged to the core wrapper.\n\n3) Remove old JoinProject component\n- File: apps/web/core/components/auth-screens/project/join-project.tsx\n- Delete the component and eliminate its imports/usages in the codebase in favor of ProjectAccessRestriction (see below).\n\n4) Add new ProjectAccessRestriction component\n- File: apps/web/core/components/auth-screens/project/project-access-restriction.tsx\n- Behavior: Render EmptyStateDetailed using i18n strings under project_empty_state.*\n  - If errorStatusCode is 409, or 403 with isWorkspaceAdmin true, show a join CTA calling handleJoinProject (disabled when isJoinButtonDisabled).\n  - If errorStatusCode is 403 and user is not a workspace admin, show a restricted message without CTA.\n  - Otherwise (404 or any other), show an invalid project empty state.\n\n5) Update ProjectService.getProject error propagation\n- File: apps/web/core/services/project/project.service.ts\n- Ensure getProject throws error.response (not error.response.data) in its catch handler so calling code can inspect error.status.\n\nB) Layouts, routes, and rendering behavior improvements\n1) Wrap project detail layout with ProjectAuthWrapper\n- File: apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/layout.tsx\n- Wrap the Outlet with <ProjectAuthWrapper workspaceSlug={workspaceSlug} projectId={projectId}>.\n\n2) Create a dedicated project settings layout with access gating\n- File: apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/layout.tsx (new)\n- Render SettingsMobileNav and ProjectSettingsSidebar, and wrap the Outlet in ProjectAuthWrapper using workspaceSlug and projectId.\n\n3) Simplify settings projects root layout\n- File: apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/layout.tsx\n- Remove sidebars and auth wrapper from this level; return only <Outlet />. The nested [projectId]/layout.tsx handles sidebar and authorization.\n\n4) Update routes to reflect new layout structure and archived projects placement\n- File: apps/web/app/routes/core.ts\n- Move the Archived Projects route group (archives page) outside the project detail route group as a sibling under projects/(detail)/archives/.\n- Restructure project detail children to match the new layout arrangement without the extra wrapping layout that used to exist, keeping route paths the same.\n- Under settings, nest all project settings routes beneath the new [projectId]/layout.tsx so they inherit ProjectAuthWrapper and sidebar.\n\nC) Reduce loading flicker and improve error gating across pages\n1) Issue Details browse page\n- File: apps/web/app/(all)/[workspaceSlug]/(projects)/browse/[workItem]/page.tsx\n- Only show the EmptyState component when error is truthy and the issue loader is not running (error && !issueLoader).\n\n2) Issue layout roots and views\n- Files:\n  - apps/web/core/components/issues/issue-layouts/roots/archived-issue-layout-root.tsx\n  - apps/web/core/components/issues/issue-layouts/roots/cycle-layout-root.tsx\n  - apps/web/core/components/issues/issue-layouts/roots/module-layout-root.tsx\n  - apps/web/core/components/issues/issue-layouts/roots/project-layout-root.tsx\n  - apps/web/core/components/issues/issue-layouts/roots/project-view-layout-root.tsx\n  - apps/web/core/components/issues/issue-layouts/spreadsheet/spreadsheet-view.tsx\n- Remove spinner UIs for initial data fetch. If required ids/filters are not yet available, return an empty fragment. Once filters are ready, render the content.\n\n3) Account settings pages\n- Files:\n  - apps/web/app/(all)/[workspaceSlug]/(settings)/settings/account/page.tsx\n  - apps/web/app/(all)/[workspaceSlug]/(settings)/settings/account/preferences/page.tsx\n- When user data/profile data is missing (initial load), render an empty fragment instead of showing a loading spinner.\n\n4) Workspace settings details\n- File: apps/web/core/components/workspace/settings/workspace-details.tsx\n- Render an empty fragment until currentWorkspace is available (remove spinner to avoid flicker).\n\nD) Project settings empty state asset handling\n- File: apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/page.tsx\n- Import themed assets via Vite (e.g., no-projects-dark.png?url and no-projects-light.png?url) and select via resolvedTheme. Update component to be an observer and adjust <img> usage accordingly.\n\nE) Internationalization additions\n- Files: packages/i18n/src/locales/*/empty-state.ts for all supported locales\n- Add keys under project_empty_state:\n  - no_access: { title, restricted_description, join_description, cta_primary, cta_loading }\n  - invalid_project: { title, description }\n- Provide localized strings per locale for these keys.\n\nAcceptance criteria\n- Backend: Project retrieve API returns 404 when project not found/archived, 403 for secret projects when requester is not a member, and 409 for public projects when requester is not a member. Members receive 200 and recent visited is recorded.\n- Frontend: Access to project detail and project settings is gated by ProjectAuthWrapper. If the user lacks access:\n  - Workspace admin or 409 Conflict shows a join CTA, which triggers join and refreshes access state.\n  - 403 Forbidden for non-admin shows a restricted message without join CTA.\n  - 404 or other errors show an invalid project empty state.\n- Loading states across issue layouts, account settings, and workspace details no longer flicker spinners; components render once data is ready or render nothing while loading.\n- Routes correctly nest settings pages under [projectId]/layout and Archived Projects route group is positioned as specified.\n- i18n keys are available for new empty states and used by ProjectAccessRestriction.\n",
      "prompt": "Improve project access handling and UI experience across the backend and web app.\n\n- Backend: Update the project retrieve endpoint to return accurate HTTP status codes when a user is not a project member. Secret projects should return a forbidden response, public projects should return a conflict indicating the user is not a member, and missing/archived projects should return not found. Ensure the endpoint no longer relies on membership filtering to decide existence and that it records recent visits only for authorized users.\n\n- Web: Centralize project authorization in a wrapper component that gates project detail and project settings pages. The wrapper should load project details, distinguish between forbidden, conflict, and not-found errors, and render an appropriate empty state with a join action when applicable. Avoid showing loading spinners; render nothing until data is ready. Replace the old join project screen with the new access restriction screen and wire up a join action that updates access state. Update routing so project settings pages share a gated layout, and ensure archived projects routes are organized as top-level under the projects section. Add i18n strings to support the new empty states in all locales.\n\nDeliver a working implementation with correct error handling, adjusted layouts/routes, minimal flicker during data loads, and localized messages for the new states.",
      "supplementalFiles": [
        "apps/api/plane/db/models/project.py",
        "apps/web/core/constants/fetch-keys.ts",
        "apps/web/core/hooks/store/use-project.ts",
        "apps/web/core/hooks/store/use-member.ts",
        "apps/web/core/hooks/store/use-label.ts",
        "apps/web/core/hooks/store/estimates/index.ts",
        "apps/web/core/hooks/store/use-cycle.ts",
        "apps/web/core/hooks/store/use-module.ts"
      ],
      "fileDiffs": [
        {
          "path": "apps/api/plane/app/views/project/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/project/base.py\n===================================================================\n--- apps/api/plane/app/views/project/base.py\t8db95d9 (parent)\n+++ apps/api/plane/app/views/project/base.py\t6022080 (commit)\n@@ -1,44 +1,44 @@\n # Python imports\n-import boto3\n-from django.conf import settings\n-from django.utils import timezone\n import json\n \n+import boto3\n+\n # Django imports\n-from django.db.models import Exists, F, OuterRef, Prefetch, Q, Subquery\n+from django.conf import settings\n from django.core.serializers.json import DjangoJSONEncoder\n+from django.db.models import Exists, F, OuterRef, Prefetch, Q, Subquery\n+from django.utils import timezone\n \n # Third Party imports\n-from rest_framework.response import Response\n from rest_framework import status\n from rest_framework.permissions import AllowAny\n+from rest_framework.response import Response\n \n # Module imports\n-from plane.app.views.base import BaseViewSet, BaseAPIView\n+from plane.app.permissions import ROLE, ProjectMemberPermission, allow_permission\n from plane.app.serializers import (\n-    ProjectSerializer,\n-    ProjectListSerializer,\n     DeployBoardSerializer,\n+    ProjectListSerializer,\n+    ProjectSerializer,\n )\n-\n-from plane.app.permissions import ProjectMemberPermission, allow_permission, ROLE\n+from plane.app.views.base import BaseAPIView, BaseViewSet\n+from plane.bgtasks.recent_visited_task import recent_visited_task\n+from plane.bgtasks.webhook_task import model_activity, webhook_activity\n from plane.db.models import (\n-    UserFavorite,\n-    Intake,\n     DeployBoard,\n+    Intake,\n     IssueUserProperty,\n     Project,\n     ProjectIdentifier,\n     ProjectMember,\n+    ProjectNetwork,\n     State,\n     DEFAULT_STATES,\n     Workspace,\n     WorkspaceMember,\n )\n from plane.utils.cache import cache_response\n-from plane.bgtasks.webhook_task import model_activity, webhook_activity\n-from plane.bgtasks.recent_visited_task import recent_visited_task\n from plane.utils.exception_logger import log_exception\n from plane.utils.host import base_host\n \n \n@@ -209,21 +209,27 @@\n         return Response(projects, status=status.HTTP_200_OK)\n \n     @allow_permission(allowed_roles=[ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST], level=\"WORKSPACE\")\n     def retrieve(self, request, slug, pk):\n-        project = (\n-            self.get_queryset()\n-            .filter(\n-                project_projectmember__member=self.request.user,\n-                project_projectmember__is_active=True,\n-            )\n-            .filter(archived_at__isnull=True)\n-            .filter(pk=pk)\n-        ).first()\n+        project = self.get_queryset().filter(archived_at__isnull=True).filter(pk=pk).first()\n \n         if project is None:\n             return Response({\"error\": \"Project does not exist\"}, status=status.HTTP_404_NOT_FOUND)\n \n+        member_ids = [str(project_member.member_id) for project_member in project.members_list]\n+\n+        if str(request.user.id) not in member_ids:\n+            if project.network == ProjectNetwork.SECRET.value:\n+                return Response(\n+                    {\"error\": \"You do not have permission\"},\n+                    status=status.HTTP_403_FORBIDDEN,\n+                )\n+            else:\n+                return Response(\n+                    {\"error\": \"You are not a member of this project\"},\n+                    status=status.HTTP_409_CONFLICT,\n+                )\n+\n         recent_visited_task.delay(\n             slug=slug,\n             project_id=pk,\n             entity_name=\"project\",\n"
        },
        {
          "path": "apps/api/plane/db/models/__init__.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/db/models/__init__.py\n===================================================================\n--- apps/api/plane/db/models/__init__.py\t8db95d9 (parent)\n+++ apps/api/plane/db/models/__init__.py\t6022080 (commit)\n@@ -51,8 +51,9 @@\n     ProjectBaseModel,\n     ProjectIdentifier,\n     ProjectMember,\n     ProjectMemberInvite,\n+    ProjectNetwork,\n     ProjectPublicMember,\n )\n from .session import Session\n from .social_connection import SocialLoginConnection\n"
        },
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(projects)/browse/[workItem]/page.tsx",
          "status": "modified",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(projects)/browse/[workItem]/page.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(projects)/browse/[workItem]/page.tsx\t8db95d9 (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(projects)/browse/[workItem]/page.tsx\t6022080 (commit)\n@@ -81,9 +81,9 @@\n \n   return (\n     <>\n       <PageHead title={pageTitle} />\n-      {error ? (\n+      {error && !issueLoader ? (\n         <EmptyState\n           image={resolvedTheme === \"dark\" ? emptyIssueDark : emptyIssueLight}\n           title={t(\"issue.empty_state.issue_detail.title\")}\n           description={t(\"issue.empty_state.issue_detail.description\")}\n"
        },
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/layout.tsx",
          "status": "modified",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/layout.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/layout.tsx\t8db95d9 (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/layout.tsx\t6022080 (commit)\n@@ -10,8 +10,9 @@\n import { AppSidebarToggleButton } from \"@/components/sidebar/sidebar-toggle-button\";\n // hooks\n import { useAppTheme } from \"@/hooks/store/use-app-theme\";\n import { useProjectNavigationPreferences } from \"@/hooks/use-navigation-preferences\";\n+import { ProjectAuthWrapper } from \"@/plane-web/layouts/project-wrapper\";\n // local imports\n import type { Route } from \"./+types/layout\";\n \n function ProjectLayout({ params }: Route.ComponentProps) {\n@@ -43,9 +44,11 @@\n             </div>\n           </Row>\n         </div>\n       )}\n-      <Outlet />\n+      <ProjectAuthWrapper workspaceSlug={workspaceSlug} projectId={projectId}>\n+        <Outlet />\n+      </ProjectAuthWrapper>\n     </>\n   );\n }\n \n"
        },
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/layout.tsx",
          "status": "deleted",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/layout.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/layout.tsx\t8db95d9 (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/layout.tsx\t6022080 (commit)\n@@ -1,14 +0,0 @@\n-import { Outlet } from \"react-router\";\n-// plane web layouts\n-import { ProjectAuthWrapper } from \"@/plane-web/layouts/project-wrapper\";\n-import type { Route } from \"./+types/layout\";\n-\n-export default function ProjectDetailLayout({ params }: Route.ComponentProps) {\n-  // router\n-  const { workspaceSlug, projectId } = params;\n-  return (\n-    <ProjectAuthWrapper workspaceSlug={workspaceSlug} projectId={projectId}>\n-      <Outlet />\n-    </ProjectAuthWrapper>\n-  );\n-}\n"
        },
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(settings)/settings/account/page.tsx",
          "status": "modified",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(settings)/settings/account/page.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(settings)/settings/account/page.tsx\t8db95d9 (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(settings)/settings/account/page.tsx\t6022080 (commit)\n@@ -1,8 +1,7 @@\n import { observer } from \"mobx-react\";\n import { useTranslation } from \"@plane/i18n\";\n // components\n-import { LogoSpinner } from \"@/components/common/logo-spinner\";\n import { PageHead } from \"@/components/core/page-title\";\n import { ProfileForm } from \"@/components/profile/form\";\n // hooks\n import { useUser } from \"@/hooks/store/user\";\n@@ -11,15 +10,9 @@\n   const { t } = useTranslation();\n   // store hooks\n   const { data: currentUser, userProfile } = useUser();\n \n-  if (!currentUser)\n-    return (\n-      <div className=\"grid h-full w-full place-items-center px-4 sm:px-0\">\n-        <LogoSpinner />\n-      </div>\n-    );\n-\n+  if (!currentUser) return <></>;\n   return (\n     <>\n       <PageHead title={`${t(\"profile.label\")} - ${t(\"general_settings\")}`} />\n       <ProfileForm user={currentUser} profile={userProfile.data} />\n"
        },
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(settings)/settings/account/preferences/page.tsx",
          "status": "modified",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(settings)/settings/account/preferences/page.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(settings)/settings/account/preferences/page.tsx\t8db95d9 (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(settings)/settings/account/preferences/page.tsx\t6022080 (commit)\n@@ -1,9 +1,8 @@\n import { observer } from \"mobx-react\";\n // plane imports\n import { useTranslation } from \"@plane/i18n\";\n // components\n-import { LogoSpinner } from \"@/components/common/logo-spinner\";\n import { PageHead } from \"@/components/core/page-title\";\n import { PreferencesList } from \"@/components/preferences/list\";\n import { LanguageTimezone } from \"@/components/profile/preferences/language-timezone\";\n import { ProfileSettingContentHeader } from \"@/components/profile/profile-setting-content-header\";\n@@ -15,32 +14,25 @@\n   const { t } = useTranslation();\n   // hooks\n   const { data: userProfile } = useUserProfile();\n \n+  if (!userProfile) return <></>;\n   return (\n     <>\n       <PageHead title={`${t(\"profile.label\")} - ${t(\"preferences\")}`} />\n-      {userProfile ? (\n-        <>\n-          <div className=\"flex flex-col gap-4 w-full\">\n-            <div>\n-              <SettingsHeading\n-                title={t(\"account_settings.preferences.heading\")}\n-                description={t(\"account_settings.preferences.description\")}\n-              />\n-              <PreferencesList />\n-            </div>\n-            <div>\n-              <ProfileSettingContentHeader title={t(\"language_and_time\")} />\n-              <LanguageTimezone />\n-            </div>\n-          </div>\n-        </>\n-      ) : (\n-        <div className=\"grid h-full w-full place-items-center px-4 sm:px-0\">\n-          <LogoSpinner />\n+      <div className=\"flex flex-col gap-4 w-full\">\n+        <div>\n+          <SettingsHeading\n+            title={t(\"account_settings.preferences.heading\")}\n+            description={t(\"account_settings.preferences.description\")}\n+          />\n+          <PreferencesList />\n         </div>\n-      )}\n+        <div>\n+          <ProfileSettingContentHeader title={t(\"language_and_time\")} />\n+          <LanguageTimezone />\n+        </div>\n+      </div>\n     </>\n   );\n }\n \n"
        },
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/layout.tsx",
          "status": "added",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/layout.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/layout.tsx\t8db95d9 (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/layout.tsx\t6022080 (commit)\n@@ -0,0 +1,33 @@\n+import { observer } from \"mobx-react\";\n+import { usePathname } from \"next/navigation\";\n+import { Outlet } from \"react-router\";\n+// components\n+import { getProjectActivePath } from \"@/components/settings/helper\";\n+import { SettingsMobileNav } from \"@/components/settings/mobile\";\n+import { ProjectSettingsSidebar } from \"@/components/settings/project/sidebar\";\n+// plane web imports\n+import { ProjectAuthWrapper } from \"@/plane-web/layouts/project-wrapper\";\n+// types\n+import type { Route } from \"./+types/layout\";\n+\n+function ProjectDetailSettingsLayout({ params }: Route.ComponentProps) {\n+  const { workspaceSlug, projectId } = params;\n+  // router\n+  const pathname = usePathname();\n+\n+  return (\n+    <>\n+      <SettingsMobileNav hamburgerContent={ProjectSettingsSidebar} activePath={getProjectActivePath(pathname) || \"\"} />\n+      <div className=\"relative flex h-full w-full\">\n+        <div className=\"hidden md:block\">{projectId && <ProjectSettingsSidebar />}</div>\n+        <ProjectAuthWrapper workspaceSlug={workspaceSlug} projectId={projectId}>\n+          <div className=\"w-full h-full overflow-y-scroll md:pt-page-y\">\n+            <Outlet />\n+          </div>\n+        </ProjectAuthWrapper>\n+      </div>\n+    </>\n+  );\n+}\n+\n+export default observer(ProjectDetailSettingsLayout);\n"
        },
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/page.tsx",
          "status": "modified",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/page.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/page.tsx\t8db95d9 (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/page.tsx\t6022080 (commit)\n@@ -1,7 +1,6 @@\n import { useState } from \"react\";\n import { observer } from \"mobx-react\";\n-import useSWR from \"swr\";\n // plane imports\n import { EUserPermissions, EUserPermissionsLevel } from \"@plane/constants\";\n // components\n import { PageHead } from \"@/components/core/page-title\";\n@@ -23,14 +22,10 @@\n   const [archiveProject, setArchiveProject] = useState<boolean>(false);\n   // router\n   const { workspaceSlug, projectId } = params;\n   // store hooks\n-  const { currentProjectDetails, fetchProjectDetails } = useProject();\n+  const { currentProjectDetails } = useProject();\n   const { allowPermissions } = useUserPermissions();\n-\n-  // api call to fetch project details\n-  // TODO: removed this API if not necessary\n-  const { isLoading } = useSWR(`PROJECT_DETAILS_${projectId}`, () => fetchProjectDetails(workspaceSlug, projectId));\n   // derived values\n   const isAdmin = allowPermissions([EUserPermissions.ADMIN], EUserPermissionsLevel.PROJECT, workspaceSlug, projectId);\n \n   const pageTitle = currentProjectDetails?.name ? `${currentProjectDetails?.name} - General Settings` : undefined;\n@@ -55,9 +50,9 @@\n         </>\n       )}\n \n       <div className={`w-full ${isAdmin ? \"\" : \"opacity-60\"}`}>\n-        {currentProjectDetails && !isLoading ? (\n+        {currentProjectDetails ? (\n           <ProjectDetailsForm\n             project={currentProjectDetails}\n             workspaceSlug={workspaceSlug}\n             projectId={projectId}\n"
        },
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/layout.tsx",
          "status": "modified",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/layout.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/layout.tsx\t8db95d9 (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/layout.tsx\t6022080 (commit)\n@@ -1,22 +1,18 @@\n import { useEffect } from \"react\";\n import { observer } from \"mobx-react\";\n-import { usePathname } from \"next/navigation\";\n import { Outlet } from \"react-router\";\n-// components\n-import { getProjectActivePath } from \"@/components/settings/helper\";\n-import { SettingsMobileNav } from \"@/components/settings/mobile\";\n-import { ProjectSettingsSidebar } from \"@/components/settings/project/sidebar\";\n+// hooks\n import { useProject } from \"@/hooks/store/use-project\";\n import { useAppRouter } from \"@/hooks/use-app-router\";\n-import { ProjectAuthWrapper } from \"@/plane-web/layouts/project-wrapper\";\n+// types\n import type { Route } from \"./+types/layout\";\n \n function ProjectSettingsLayout({ params }: Route.ComponentProps) {\n+  const { workspaceSlug, projectId } = params;\n   // router\n   const router = useAppRouter();\n-  const pathname = usePathname();\n-  const { workspaceSlug, projectId } = params;\n+  // store hooks\n   const { joinedProjectIds } = useProject();\n \n   useEffect(() => {\n     if (projectId) return;\n@@ -24,20 +20,8 @@\n       router.push(`/${workspaceSlug}/settings/projects/${joinedProjectIds[0]}`);\n     }\n   }, [joinedProjectIds, router, workspaceSlug, projectId]);\n \n-  return (\n-    <>\n-      <SettingsMobileNav hamburgerContent={ProjectSettingsSidebar} activePath={getProjectActivePath(pathname) || \"\"} />\n-      <ProjectAuthWrapper workspaceSlug={workspaceSlug} projectId={projectId}>\n-        <div className=\"relative flex h-full w-full\">\n-          <div className=\"hidden md:block\">{projectId && <ProjectSettingsSidebar />}</div>\n-          <div className=\"w-full h-full overflow-y-scroll md:pt-page-y\">\n-            <Outlet />\n-          </div>\n-        </div>\n-      </ProjectAuthWrapper>\n-    </>\n-  );\n+  return <Outlet />;\n }\n \n export default observer(ProjectSettingsLayout);\n"
        },
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/page.tsx",
          "status": "modified",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/page.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/page.tsx\t8db95d9 (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(settings)/settings/projects/page.tsx\t6022080 (commit)\n@@ -1,23 +1,26 @@\n+import { observer } from \"mobx-react\";\n import Link from \"next/link\";\n import { useTheme } from \"next-themes\";\n+// plane imports\n import { PROJECT_TRACKER_ELEMENTS } from \"@plane/constants\";\n import { Button, getButtonStyling } from \"@plane/propel/button\";\n import { cn } from \"@plane/utils\";\n+// assets\n+import ProjectDarkEmptyState from \"@/app/assets/empty-state/project-settings/no-projects-dark.png?url\";\n+import ProjectLightEmptyState from \"@/app/assets/empty-state/project-settings/no-projects-light.png?url\";\n+// hooks\n import { useCommandPalette } from \"@/hooks/store/use-command-palette\";\n \n function ProjectSettingsPage() {\n   // store hooks\n   const { resolvedTheme } = useTheme();\n   const { toggleCreateProjectModal } = useCommandPalette();\n   // derived values\n-  const resolvedPath =\n-    resolvedTheme === \"dark\"\n-      ? \"/empty-state/project-settings/no-projects-dark.png\"\n-      : \"/empty-state/project-settings/no-projects-light.png\";\n+  const resolvedPath = resolvedTheme === \"dark\" ? ProjectDarkEmptyState : ProjectLightEmptyState;\n   return (\n     <div className=\"flex flex-col gap-4 items-center justify-center h-full max-w-[480px] mx-auto\">\n-      <img src={resolvedPath} className=\"w-full h-full object-contain\" alt=\"No projects yet\" />\n+      <img src={resolvedPath} alt=\"No projects yet\" />\n       <div className=\"text-lg font-semibold text-custom-text-350\">No projects yet</div>\n       <div className=\"text-sm text-custom-text-350 text-center\">\n         Projects act as the foundation for goal-driven work. They let you manage your teams, tasks, and everything you\n         need to get things done.\n@@ -37,5 +40,5 @@\n     </div>\n   );\n }\n \n-export default ProjectSettingsPage;\n+export default observer(ProjectSettingsPage);\n"
        },
        {
          "path": "apps/web/app/routes/core.ts",
          "status": "modified",
          "diff": "Index: apps/web/app/routes/core.ts\n===================================================================\n--- apps/web/app/routes/core.ts\t8db95d9 (parent)\n+++ apps/web/app/routes/core.ts\t6022080 (commit)\n@@ -107,11 +107,15 @@\n             \"./(all)/[workspaceSlug]/(projects)/workspace-views/[globalViewId]/page.tsx\"\n           ),\n         ]),\n \n-        // ====================================================================\n-        // PROJECT LEVEL ROUTES\n-        // ====================================================================\n+        // Archived Projects\n+        layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/archives/layout.tsx\", [\n+          route(\n+            \":workspaceSlug/projects/archives\",\n+            \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/archives/page.tsx\"\n+          ),\n+        ]),\n \n         // --------------------------------------------------------------------\n         // PROJECT LEVEL ROUTES\n         // --------------------------------------------------------------------\n@@ -121,139 +125,126 @@\n           route(\":workspaceSlug/projects\", \"./(all)/[workspaceSlug]/(projects)/projects/(list)/page.tsx\"),\n         ]),\n \n         // Project Detail\n-        layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/layout.tsx\", [\n-          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/layout.tsx\", [\n-            // Project Issues List\n-            layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/issues/(list)/layout.tsx\", [\n-              route(\n-                \":workspaceSlug/projects/:projectId/issues\",\n-                \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/issues/(list)/page.tsx\"\n-              ),\n-            ]),\n-            // Issue Detail\n+        layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/layout.tsx\", [\n+          // Project Issues List\n+          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/issues/(list)/layout.tsx\", [\n             route(\n-              \":workspaceSlug/projects/:projectId/issues/:issueId\",\n-              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/issues/(detail)/[issueId]/page.tsx\"\n+              \":workspaceSlug/projects/:projectId/issues\",\n+              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/issues/(list)/page.tsx\"\n             ),\n+          ]),\n+          // Issue Detail\n+          route(\n+            \":workspaceSlug/projects/:projectId/issues/:issueId\",\n+            \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/issues/(detail)/[issueId]/page.tsx\"\n+          ),\n \n-            // Cycle Detail\n-            layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/layout.tsx\", [\n-              route(\n-                \":workspaceSlug/projects/:projectId/cycles/:cycleId\",\n-                \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/[cycleId]/page.tsx\"\n-              ),\n-            ]),\n+          // Cycle Detail\n+          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/layout.tsx\", [\n+            route(\n+              \":workspaceSlug/projects/:projectId/cycles/:cycleId\",\n+              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/[cycleId]/page.tsx\"\n+            ),\n+          ]),\n \n-            // Cycles List\n-            layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(list)/layout.tsx\", [\n-              route(\n-                \":workspaceSlug/projects/:projectId/cycles\",\n-                \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(list)/page.tsx\"\n-              ),\n-            ]),\n+          // Cycles List\n+          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(list)/layout.tsx\", [\n+            route(\n+              \":workspaceSlug/projects/:projectId/cycles\",\n+              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(list)/page.tsx\"\n+            ),\n+          ]),\n \n-            // Module Detail\n-            layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/layout.tsx\", [\n-              route(\n-                \":workspaceSlug/projects/:projectId/modules/:moduleId\",\n-                \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/[moduleId]/page.tsx\"\n-              ),\n-            ]),\n+          // Module Detail\n+          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/layout.tsx\", [\n+            route(\n+              \":workspaceSlug/projects/:projectId/modules/:moduleId\",\n+              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/[moduleId]/page.tsx\"\n+            ),\n+          ]),\n \n-            // Modules List\n-            layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(list)/layout.tsx\", [\n-              route(\n-                \":workspaceSlug/projects/:projectId/modules\",\n-                \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(list)/page.tsx\"\n-              ),\n-            ]),\n-\n-            // View Detail\n-            layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/views/(detail)/layout.tsx\", [\n-              route(\n-                \":workspaceSlug/projects/:projectId/views/:viewId\",\n-                \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/views/(detail)/[viewId]/page.tsx\"\n-              ),\n-            ]),\n-\n-            // Views List\n-            layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/views/(list)/layout.tsx\", [\n-              route(\n-                \":workspaceSlug/projects/:projectId/views\",\n-                \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/views/(list)/page.tsx\"\n-              ),\n-            ]),\n-\n-            // Page Detail\n-            layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/layout.tsx\", [\n-              route(\n-                \":workspaceSlug/projects/:projectId/pages/:pageId\",\n-                \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/[pageId]/page.tsx\"\n-              ),\n-            ]),\n-\n-            // Pages List\n-            layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(list)/layout.tsx\", [\n-              route(\n-                \":workspaceSlug/projects/:projectId/pages\",\n-                \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(list)/page.tsx\"\n-              ),\n-            ]),\n-            // Intake list\n-            layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/intake/layout.tsx\", [\n-              route(\n-                \":workspaceSlug/projects/:projectId/intake\",\n-                \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/intake/page.tsx\"\n-              ),\n-            ]),\n+          // Modules List\n+          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(list)/layout.tsx\", [\n+            route(\n+              \":workspaceSlug/projects/:projectId/modules\",\n+              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(list)/page.tsx\"\n+            ),\n           ]),\n \n-          // Archived Projects\n-          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/archives/layout.tsx\", [\n+          // View Detail\n+          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/views/(detail)/layout.tsx\", [\n             route(\n-              \":workspaceSlug/projects/archives\",\n-              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/archives/page.tsx\"\n+              \":workspaceSlug/projects/:projectId/views/:viewId\",\n+              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/views/(detail)/[viewId]/page.tsx\"\n             ),\n           ]),\n \n-          // Project Archives - Issues, Cycles, Modules\n-          // Project Archives - Issues - List\n-          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/issues/(list)/layout.tsx\", [\n+          // Views List\n+          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/views/(list)/layout.tsx\", [\n             route(\n-              \":workspaceSlug/projects/:projectId/archives/issues\",\n-              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/issues/(list)/page.tsx\"\n+              \":workspaceSlug/projects/:projectId/views\",\n+              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/views/(list)/page.tsx\"\n             ),\n           ]),\n \n-          // Project Archives - Issues - Detail\n-          layout(\n-            \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/issues/(detail)/layout.tsx\",\n-            [\n-              route(\n-                \":workspaceSlug/projects/:projectId/archives/issues/:archivedIssueId\",\n-                \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/issues/(detail)/[archivedIssueId]/page.tsx\"\n-              ),\n-            ]\n-          ),\n-\n-          // Project Archives - Cycles\n-          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/cycles/layout.tsx\", [\n+          // Page Detail\n+          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/layout.tsx\", [\n             route(\n-              \":workspaceSlug/projects/:projectId/archives/cycles\",\n-              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/cycles/page.tsx\"\n+              \":workspaceSlug/projects/:projectId/pages/:pageId\",\n+              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/[pageId]/page.tsx\"\n             ),\n           ]),\n \n-          // Project Archives - Modules\n-          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/modules/layout.tsx\", [\n+          // Pages List\n+          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(list)/layout.tsx\", [\n             route(\n-              \":workspaceSlug/projects/:projectId/archives/modules\",\n-              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/modules/page.tsx\"\n+              \":workspaceSlug/projects/:projectId/pages\",\n+              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(list)/page.tsx\"\n             ),\n           ]),\n+          // Intake list\n+          layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/intake/layout.tsx\", [\n+            route(\n+              \":workspaceSlug/projects/:projectId/intake\",\n+              \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/intake/page.tsx\"\n+            ),\n+          ]),\n         ]),\n+\n+        // Project Archives - Issues, Cycles, Modules\n+        // Project Archives - Issues - List\n+        layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/issues/(list)/layout.tsx\", [\n+          route(\n+            \":workspaceSlug/projects/:projectId/archives/issues\",\n+            \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/issues/(list)/page.tsx\"\n+          ),\n+        ]),\n+\n+        // Project Archives - Issues - Detail\n+        layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/issues/(detail)/layout.tsx\", [\n+          route(\n+            \":workspaceSlug/projects/:projectId/archives/issues/:archivedIssueId\",\n+            \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/issues/(detail)/[archivedIssueId]/page.tsx\"\n+          ),\n+        ]),\n+\n+        // Project Archives - Cycles\n+        layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/cycles/layout.tsx\", [\n+          route(\n+            \":workspaceSlug/projects/:projectId/archives/cycles\",\n+            \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/cycles/page.tsx\"\n+          ),\n+        ]),\n+\n+        // Project Archives - Modules\n+        layout(\"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/modules/layout.tsx\", [\n+          route(\n+            \":workspaceSlug/projects/:projectId/archives/modules\",\n+            \"./(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/archives/modules/page.tsx\"\n+          ),\n+        ]),\n       ]),\n \n       // ====================================================================\n       // SETTINGS SECTION\n@@ -319,46 +310,48 @@\n         // PROJECT SETTINGS\n         // --------------------------------------------------------------------\n \n         layout(\"./(all)/[workspaceSlug]/(settings)/settings/projects/layout.tsx\", [\n-          // CORE Routes\n-          // Project Settings\n+          // No Projects available page\n           route(\":workspaceSlug/settings/projects\", \"./(all)/[workspaceSlug]/(settings)/settings/projects/page.tsx\"),\n-          route(\n-            \":workspaceSlug/settings/projects/:projectId\",\n-            \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/page.tsx\"\n-          ),\n-          // Project Members\n-          route(\n-            \":workspaceSlug/settings/projects/:projectId/members\",\n-            \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/members/page.tsx\"\n-          ),\n-          // Project Features\n-          route(\n-            \":workspaceSlug/settings/projects/:projectId/features\",\n-            \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/features/page.tsx\"\n-          ),\n-          // Project States\n-          route(\n-            \":workspaceSlug/settings/projects/:projectId/states\",\n-            \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/states/page.tsx\"\n-          ),\n-          // Project Labels\n-          route(\n-            \":workspaceSlug/settings/projects/:projectId/labels\",\n-            \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/labels/page.tsx\"\n-          ),\n-          // Project Estimates\n-          route(\n-            \":workspaceSlug/settings/projects/:projectId/estimates\",\n-            \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/estimates/page.tsx\"\n-          ),\n-          // Project Automations\n-          layout(\"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/automations/layout.tsx\", [\n+          layout(\"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/layout.tsx\", [\n+            // Project Settings\n             route(\n-              \":workspaceSlug/settings/projects/:projectId/automations\",\n-              \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/automations/page.tsx\"\n+              \":workspaceSlug/settings/projects/:projectId\",\n+              \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/page.tsx\"\n             ),\n+            // Project Members\n+            route(\n+              \":workspaceSlug/settings/projects/:projectId/members\",\n+              \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/members/page.tsx\"\n+            ),\n+            // Project Features\n+            route(\n+              \":workspaceSlug/settings/projects/:projectId/features\",\n+              \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/features/page.tsx\"\n+            ),\n+            // Project States\n+            route(\n+              \":workspaceSlug/settings/projects/:projectId/states\",\n+              \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/states/page.tsx\"\n+            ),\n+            // Project Labels\n+            route(\n+              \":workspaceSlug/settings/projects/:projectId/labels\",\n+              \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/labels/page.tsx\"\n+            ),\n+            // Project Estimates\n+            route(\n+              \":workspaceSlug/settings/projects/:projectId/estimates\",\n+              \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/estimates/page.tsx\"\n+            ),\n+            // Project Automations\n+            layout(\"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/automations/layout.tsx\", [\n+              route(\n+                \":workspaceSlug/settings/projects/:projectId/automations\",\n+                \"./(all)/[workspaceSlug]/(settings)/settings/projects/[projectId]/automations/page.tsx\"\n+              ),\n+            ]),\n           ]),\n         ]),\n       ]),\n     ]),\n"
        },
        {
          "path": "apps/web/ce/layouts/project-wrapper.tsx",
          "status": "modified",
          "diff": "Index: apps/web/ce/layouts/project-wrapper.tsx\n===================================================================\n--- apps/web/ce/layouts/project-wrapper.tsx\t8db95d9 (parent)\n+++ apps/web/ce/layouts/project-wrapper.tsx\t6022080 (commit)\n@@ -1,12 +1,11 @@\n-import type { FC } from \"react\";\n import { observer } from \"mobx-react\";\n // layouts\n import { ProjectAuthWrapper as CoreProjectAuthWrapper } from \"@/layouts/auth-layout/project-wrapper\";\n \n export type IProjectAuthWrapper = {\n   workspaceSlug: string;\n-  projectId?: string;\n+  projectId: string;\n   children: React.ReactNode;\n };\n \n export const ProjectAuthWrapper = observer(function ProjectAuthWrapper(props: IProjectAuthWrapper) {\n"
        },
        {
          "path": "apps/web/core/components/auth-screens/project/join-project.tsx",
          "status": "deleted",
          "diff": "Index: apps/web/core/components/auth-screens/project/join-project.tsx\n===================================================================\n--- apps/web/core/components/auth-screens/project/join-project.tsx\t8db95d9 (parent)\n+++ apps/web/core/components/auth-screens/project/join-project.tsx\t6022080 (commit)\n@@ -1,67 +0,0 @@\n-import { useState } from \"react\";\n-import { useParams } from \"next/navigation\";\n-import { ClipboardList } from \"lucide-react\";\n-// plane imports\n-import { Button } from \"@plane/propel/button\";\n-// assets\n-import Unauthorized from \"@/app/assets/auth/unauthorized.svg?url\";\n-// hooks\n-import { useProject } from \"@/hooks/store/use-project\";\n-import { useUserPermissions } from \"@/hooks/store/user\";\n-\n-type Props = {\n-  projectId?: string;\n-  isPrivateProject?: boolean;\n-};\n-\n-export function JoinProject(props: Props) {\n-  const { projectId, isPrivateProject = false } = props;\n-  // states\n-  const [isJoiningProject, setIsJoiningProject] = useState(false);\n-  // store hooks\n-  const { joinProject } = useUserPermissions();\n-  const { fetchProjectDetails } = useProject();\n-\n-  const { workspaceSlug } = useParams();\n-\n-  const handleJoin = () => {\n-    if (!workspaceSlug || !projectId) return;\n-\n-    setIsJoiningProject(true);\n-\n-    joinProject(workspaceSlug.toString(), projectId.toString())\n-      .then(() => fetchProjectDetails(workspaceSlug.toString(), projectId.toString()))\n-      .finally(() => setIsJoiningProject(false));\n-  };\n-\n-  return (\n-    <div className=\"flex h-full w-full flex-col items-center justify-center gap-y-5 bg-custom-background-100 text-center\">\n-      <div className=\"h-44 w-72\">\n-        <img src={Unauthorized} className=\"h-[176px] w-[288px] object-contain\" alt=\"JoinProject\" />\n-      </div>\n-      <h1 className=\"text-xl font-medium text-custom-text-100\">\n-        {!isPrivateProject ? `You are not a member of this project yet.` : `You are not a member of this project.`}\n-      </h1>\n-\n-      <div className=\"w-full max-w-md text-base text-custom-text-200\">\n-        <p className=\"mx-auto w-full text-sm md:w-3/4\">\n-          {!isPrivateProject\n-            ? `Click the button below to join it.`\n-            : `This is a private project. \\n We can't tell you more about this project to protect confidentiality.`}\n-        </p>\n-      </div>\n-      {!isPrivateProject && (\n-        <div>\n-          <Button\n-            variant=\"primary\"\n-            prependIcon={<ClipboardList color=\"white\" />}\n-            loading={isJoiningProject}\n-            onClick={handleJoin}\n-          >\n-            {isJoiningProject ? \"Taking you in\" : \"Click to join\"}\n-          </Button>\n-        </div>\n-      )}\n-    </div>\n-  );\n-}\n"
        },
        {
          "path": "apps/web/core/components/auth-screens/project/project-access-restriction.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/auth-screens/project/project-access-restriction.tsx\n===================================================================\n--- apps/web/core/components/auth-screens/project/project-access-restriction.tsx\t8db95d9 (parent)\n+++ apps/web/core/components/auth-screens/project/project-access-restriction.tsx\t6022080 (commit)\n@@ -0,0 +1,70 @@\n+import { observer } from \"mobx-react\";\n+// plane imports\n+import { useTranslation } from \"@plane/i18n\";\n+import { EmptyStateDetailed } from \"@plane/propel/empty-state\";\n+\n+type TProps = {\n+  isWorkspaceAdmin: boolean;\n+  handleJoinProject: () => void;\n+  isJoinButtonDisabled: boolean;\n+  errorStatusCode: number | undefined;\n+};\n+\n+export const ProjectAccessRestriction = observer(function ProjectAccessRestriction(props: TProps) {\n+  const { isWorkspaceAdmin, handleJoinProject, isJoinButtonDisabled, errorStatusCode } = props;\n+  // plane hooks\n+  const { t } = useTranslation();\n+\n+  // Show join project screen if:\n+  // - User lacks project membership (409 Conflict)\n+  // - User lacks permission to access the private project (403 Forbidden) but is a workspace admin (can join any project)\n+  if (errorStatusCode === 409 || (errorStatusCode === 403 && isWorkspaceAdmin))\n+    return (\n+      <div className=\"grid h-full w-full place-items-center bg-custom-background-100\">\n+        <EmptyStateDetailed\n+          title={t(\"project_empty_state.no_access.title\")}\n+          description={t(\"project_empty_state.no_access.join_description\")}\n+          assetKey=\"no-access\"\n+          assetClassName=\"size-40\"\n+          actions={[\n+            {\n+              label: isJoinButtonDisabled\n+                ? t(\"project_empty_state.no_access.cta_loading\")\n+                : t(\"project_empty_state.no_access.cta_primary\"),\n+              onClick: handleJoinProject,\n+              disabled: isJoinButtonDisabled,\n+            },\n+          ]}\n+        />\n+      </div>\n+    );\n+\n+  // Show no access screen if:\n+  // - User lacks permission to access the private project (403 Forbidden)\n+  if (errorStatusCode === 403) {\n+    return (\n+      <div className=\"grid h-full w-full place-items-center bg-custom-background-100\">\n+        <EmptyStateDetailed\n+          title={t(\"project_empty_state.no_access.title\")}\n+          description={t(\"project_empty_state.no_access.restricted_description\")}\n+          assetKey=\"no-access\"\n+          assetClassName=\"size-40\"\n+        />\n+      </div>\n+    );\n+  }\n+\n+  // Show empty state screen if:\n+  // - Project not found (404 Not Found)\n+  // - Any other error status code\n+  return (\n+    <div className=\"grid h-full w-full place-items-center bg-custom-background-100\">\n+      <EmptyStateDetailed\n+        title={t(\"project_empty_state.invalid_project.title\")}\n+        description={t(\"project_empty_state.invalid_project.description\")}\n+        assetKey=\"project\"\n+        assetClassName=\"size-40\"\n+      />\n+    </div>\n+  );\n+});\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-layouts/roots/archived-issue-layout-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-layouts/roots/archived-issue-layout-root.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-layouts/roots/archived-issue-layout-root.tsx\t8db95d9 (parent)\n+++ apps/web/core/components/issues/issue-layouts/roots/archived-issue-layout-root.tsx\t6022080 (commit)\n@@ -5,9 +5,8 @@\n // plane imports\n import { ISSUE_DISPLAY_FILTERS_BY_PAGE } from \"@plane/constants\";\n import { EIssuesStoreType } from \"@plane/types\";\n // components\n-import { LogoSpinner } from \"@/components/common/logo-spinner\";\n import { ProjectLevelWorkItemFiltersHOC } from \"@/components/work-item-filters/filters-hoc/project-level\";\n // hooks\n import { WorkItemFiltersRow } from \"@/components/work-item-filters/filters-row\";\n import { useIssues } from \"@/hooks/store/use-issues\";\n@@ -25,9 +24,9 @@\n   const { issuesFilter } = useIssues(EIssuesStoreType.ARCHIVED);\n   // derived values\n   const workItemFilters = projectId ? issuesFilter?.getIssueFilters(projectId) : undefined;\n \n-  const { isLoading } = useSWR(\n+  useSWR(\n     workspaceSlug && projectId ? `ARCHIVED_ISSUES_${workspaceSlug.toString()}_${projectId.toString()}` : null,\n     async () => {\n       if (workspaceSlug && projectId) {\n         await issuesFilter?.fetchFilters(workspaceSlug.toString(), projectId.toString());\n@@ -35,17 +34,9 @@\n     },\n     { revalidateIfStale: false, revalidateOnFocus: false }\n   );\n \n-  if (!workspaceSlug || !projectId) return <></>;\n-\n-  if (isLoading && !workItemFilters)\n-    return (\n-      <div className=\"h-full w-full flex items-center justify-center\">\n-        <LogoSpinner />\n-      </div>\n-    );\n-\n+  if (!workspaceSlug || !projectId || !workItemFilters) return <></>;\n   return (\n     <IssuesStoreContext.Provider value={EIssuesStoreType.ARCHIVED}>\n       <ProjectLevelWorkItemFiltersHOC\n         entityType={EIssuesStoreType.ARCHIVED}\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-layouts/roots/cycle-layout-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-layouts/roots/cycle-layout-root.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-layouts/roots/cycle-layout-root.tsx\t8db95d9 (parent)\n+++ apps/web/core/components/issues/issue-layouts/roots/cycle-layout-root.tsx\t6022080 (commit)\n@@ -6,9 +6,8 @@\n // plane constants\n import { ISSUE_DISPLAY_FILTERS_BY_PAGE, PROJECT_VIEW_TRACKER_ELEMENTS } from \"@plane/constants\";\n import { EIssuesStoreType, EIssueLayoutTypes } from \"@plane/types\";\n // components\n-import { LogoSpinner } from \"@/components/common/logo-spinner\";\n import { TransferIssues } from \"@/components/cycles/transfer-issues\";\n import { TransferIssuesModal } from \"@/components/cycles/transfer-issues-modal\";\n // hooks\n import { ProjectLevelWorkItemFiltersHOC } from \"@/components/work-item-filters/filters-hoc/project-level\";\n@@ -58,9 +57,9 @@\n   // derived values\n   const workItemFilters = cycleId ? issuesFilter?.getIssueFilters(cycleId) : undefined;\n   const activeLayout = workItemFilters?.displayFilters?.layout;\n \n-  const { isLoading } = useSWR(\n+  useSWR(\n     workspaceSlug && projectId && cycleId ? `CYCLE_ISSUES_${workspaceSlug}_${projectId}_${cycleId}` : null,\n     async () => {\n       if (workspaceSlug && projectId && cycleId) {\n         await issuesFilter?.fetchFilters(workspaceSlug, projectId, cycleId);\n@@ -77,17 +76,9 @@\n     ? cycleDetails.backlog_issues + cycleDetails.unstarted_issues + cycleDetails.started_issues\n     : 0;\n   const canTransferIssues = isProgressSnapshotEmpty && transferableIssuesCount > 0;\n \n-  if (!workspaceSlug || !projectId || !cycleId) return <></>;\n-\n-  if (isLoading && !workItemFilters)\n-    return (\n-      <div className=\"h-full w-full flex items-center justify-center\">\n-        <LogoSpinner />\n-      </div>\n-    );\n-\n+  if (!workspaceSlug || !projectId || !cycleId || !workItemFilters) return <></>;\n   return (\n     <IssuesStoreContext.Provider value={EIssuesStoreType.CYCLE}>\n       <ProjectLevelWorkItemFiltersHOC\n         enableSaveView\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-layouts/roots/module-layout-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-layouts/roots/module-layout-root.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-layouts/roots/module-layout-root.tsx\t8db95d9 (parent)\n+++ apps/web/core/components/issues/issue-layouts/roots/module-layout-root.tsx\t6022080 (commit)\n@@ -5,10 +5,8 @@\n // plane imports\n import { ISSUE_DISPLAY_FILTERS_BY_PAGE, PROJECT_VIEW_TRACKER_ELEMENTS } from \"@plane/constants\";\n import { EIssuesStoreType, EIssueLayoutTypes } from \"@plane/types\";\n import { Row, ERowVariant } from \"@plane/ui\";\n-// components\n-import { LogoSpinner } from \"@/components/common/logo-spinner\";\n // hooks\n import { ProjectLevelWorkItemFiltersHOC } from \"@/components/work-item-filters/filters-hoc/project-level\";\n import { WorkItemFiltersRow } from \"@/components/work-item-filters/filters-row\";\n import { useIssues } from \"@/hooks/store/use-issues\";\n@@ -49,9 +47,9 @@\n   // derived values\n   const workItemFilters = moduleId ? issuesFilter?.getIssueFilters(moduleId) : undefined;\n   const activeLayout = workItemFilters?.displayFilters?.layout || undefined;\n \n-  const { isLoading } = useSWR(\n+  useSWR(\n     workspaceSlug && projectId && moduleId\n       ? `MODULE_ISSUES_${workspaceSlug.toString()}_${projectId.toString()}_${moduleId.toString()}`\n       : null,\n     async () => {\n@@ -61,17 +59,9 @@\n     },\n     { revalidateIfStale: false, revalidateOnFocus: false }\n   );\n \n-  if (!workspaceSlug || !projectId || !moduleId) return <></>;\n-\n-  if (isLoading && !workItemFilters)\n-    return (\n-      <div className=\"h-full w-full flex items-center justify-center\">\n-        <LogoSpinner />\n-      </div>\n-    );\n-\n+  if (!workspaceSlug || !projectId || !moduleId || !workItemFilters) return <></>;\n   return (\n     <IssuesStoreContext.Provider value={EIssuesStoreType.MODULE}>\n       <ProjectLevelWorkItemFiltersHOC\n         enableSaveView\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-layouts/roots/project-layout-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-layouts/roots/project-layout-root.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-layouts/roots/project-layout-root.tsx\t8db95d9 (parent)\n+++ apps/web/core/components/issues/issue-layouts/roots/project-layout-root.tsx\t6022080 (commit)\n@@ -1,14 +1,12 @@\n-import type { FC } from \"react\";\n import { observer } from \"mobx-react\";\n import { useParams } from \"next/navigation\";\n import useSWR from \"swr\";\n // plane constants\n import { ISSUE_DISPLAY_FILTERS_BY_PAGE, PROJECT_VIEW_TRACKER_ELEMENTS } from \"@plane/constants\";\n import { EIssueLayoutTypes, EIssuesStoreType } from \"@plane/types\";\n import { Spinner } from \"@plane/ui\";\n // components\n-import { LogoSpinner } from \"@/components/common/logo-spinner\";\n import { ProjectLevelWorkItemFiltersHOC } from \"@/components/work-item-filters/filters-hoc/project-level\";\n import { WorkItemFiltersRow } from \"@/components/work-item-filters/filters-row\";\n // hooks\n import { useIssues } from \"@/hooks/store/use-issues\";\n@@ -48,9 +46,9 @@\n   // derived values\n   const workItemFilters = projectId ? issuesFilter?.getIssueFilters(projectId) : undefined;\n   const activeLayout = workItemFilters?.displayFilters?.layout;\n \n-  const { isLoading } = useSWR(\n+  useSWR(\n     workspaceSlug && projectId ? `PROJECT_ISSUES_${workspaceSlug}_${projectId}` : null,\n     async () => {\n       if (workspaceSlug && projectId) {\n         await issuesFilter?.fetchFilters(workspaceSlug, projectId);\n@@ -58,17 +56,9 @@\n     },\n     { revalidateIfStale: false, revalidateOnFocus: false }\n   );\n \n-  if (!workspaceSlug || !projectId) return <></>;\n-\n-  if (isLoading && !workItemFilters)\n-    return (\n-      <div className=\"h-full w-full flex items-center justify-center\">\n-        <LogoSpinner />\n-      </div>\n-    );\n-\n+  if (!workspaceSlug || !projectId || !workItemFilters) return <></>;\n   return (\n     <IssuesStoreContext.Provider value={EIssuesStoreType.PROJECT}>\n       <ProjectLevelWorkItemFiltersHOC\n         enableSaveView\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-layouts/roots/project-view-layout-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-layouts/roots/project-view-layout-root.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-layouts/roots/project-view-layout-root.tsx\t8db95d9 (parent)\n+++ apps/web/core/components/issues/issue-layouts/roots/project-view-layout-root.tsx\t6022080 (commit)\n@@ -4,10 +4,8 @@\n import useSWR from \"swr\";\n // plane constants\n import { ISSUE_DISPLAY_FILTERS_BY_PAGE, PROJECT_VIEW_TRACKER_ELEMENTS } from \"@plane/constants\";\n import { EIssuesStoreType, EIssueLayoutTypes } from \"@plane/types\";\n-// components\n-import { LogoSpinner } from \"@/components/common/logo-spinner\";\n // hooks\n import { ProjectLevelWorkItemFiltersHOC } from \"@/components/work-item-filters/filters-hoc/project-level\";\n import { WorkItemFiltersRow } from \"@/components/work-item-filters/filters-row\";\n import { useIssues } from \"@/hooks/store/use-issues\";\n@@ -59,9 +57,9 @@\n         richFilters: projectView.rich_filters,\n       }\n     : undefined;\n \n-  const { isLoading } = useSWR(\n+  useSWR(\n     workspaceSlug && projectId && viewId ? `PROJECT_VIEW_ISSUES_${workspaceSlug}_${projectId}_${viewId}` : null,\n     async () => {\n       if (workspaceSlug && projectId && viewId) {\n         await issuesFilter?.fetchFilters(workspaceSlug, projectId, viewId);\n@@ -77,18 +75,9 @@\n     },\n     [issuesFilter, workspaceSlug, viewId]\n   );\n \n-  if (!workspaceSlug || !projectId || !viewId) return <></>;\n-\n-  if (isLoading && !workItemFilters) {\n-    return (\n-      <div className=\"relative flex h-screen w-full items-center justify-center\">\n-        <LogoSpinner />\n-      </div>\n-    );\n-  }\n-\n+  if (!workspaceSlug || !projectId || !viewId || !workItemFilters) return <></>;\n   return (\n     <IssuesStoreContext.Provider value={EIssuesStoreType.PROJECT_VIEW}>\n       <ProjectLevelWorkItemFiltersHOC\n         enableSaveView\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-layouts/spreadsheet/spreadsheet-view.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-layouts/spreadsheet/spreadsheet-view.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-layouts/spreadsheet/spreadsheet-view.tsx\t8db95d9 (parent)\n+++ apps/web/core/components/issues/issue-layouts/spreadsheet/spreadsheet-view.tsx\t6022080 (commit)\n@@ -5,9 +5,8 @@\n // types\n import type { TIssue, IIssueDisplayFilterOptions, IIssueDisplayProperties } from \"@plane/types\";\n import { EIssueLayoutTypes } from \"@plane/types\";\n // components\n-import { LogoSpinner } from \"@/components/common/logo-spinner\";\n import { MultipleSelectGroup } from \"@/components/core/multiple-select\";\n // hooks\n import { useProject } from \"@/hooks/store/use-project\";\n // plane web components\n@@ -71,15 +70,9 @@\n         if (property === \"modules\" && !currentProjectDetails?.module_view) return false;\n         return true;\n       });\n \n-  if (!issueIds || issueIds.length === 0)\n-    return (\n-      <div className=\"grid h-full w-full place-items-center\">\n-        <LogoSpinner />\n-      </div>\n-    );\n-\n+  if (!issueIds || issueIds.length === 0) return <></>;\n   return (\n     <div className=\"relative flex h-full w-full flex-col overflow-x-hidden whitespace-nowrap rounded-lg bg-custom-background-200 text-custom-text-200\">\n       <div ref={portalRef} className=\"spreadsheet-menu-portal\" />\n       <MultipleSelectGroup\n"
        },
        {
          "path": "apps/web/core/components/workspace/settings/workspace-details.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/workspace/settings/workspace-details.tsx\n===================================================================\n--- apps/web/core/components/workspace/settings/workspace-details.tsx\t8db95d9 (parent)\n+++ apps/web/core/components/workspace/settings/workspace-details.tsx\t6022080 (commit)\n@@ -16,9 +16,8 @@\n import type { IWorkspace } from \"@plane/types\";\n import { CustomSelect, Input } from \"@plane/ui\";\n import { copyUrlToClipboard, getFileURL } from \"@plane/utils\";\n // components\n-import { LogoSpinner } from \"@/components/common/logo-spinner\";\n import { WorkspaceImageUploadModal } from \"@/components/core/modals/workspace-image-upload-modal\";\n // helpers\n import { captureError, captureSuccess } from \"@/helpers/event-tracker.helper\";\n import { useWorkspace } from \"@/hooks/store/use-workspace\";\n@@ -128,15 +127,9 @@\n   }, [currentWorkspace, reset]);\n \n   const isAdmin = allowPermissions([EUserPermissions.ADMIN], EUserPermissionsLevel.WORKSPACE);\n \n-  if (!currentWorkspace)\n-    return (\n-      <div className=\"grid h-full w-full place-items-center px-4 sm:px-0\">\n-        <LogoSpinner />\n-      </div>\n-    );\n-\n+  if (!currentWorkspace) return <></>;\n   return (\n     <>\n       <Controller\n         control={control}\n"
        },
        {
          "path": "apps/web/core/layouts/auth-layout/project-wrapper.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/layouts/auth-layout/project-wrapper.tsx\n===================================================================\n--- apps/web/core/layouts/auth-layout/project-wrapper.tsx\t8db95d9 (parent)\n+++ apps/web/core/layouts/auth-layout/project-wrapper.tsx\t6022080 (commit)\n@@ -1,16 +1,13 @@\n-import type { FC, ReactNode } from \"react\";\n-import { useEffect } from \"react\";\n+import type { ReactNode } from \"react\";\n+import { useEffect, useState } from \"react\";\n import { observer } from \"mobx-react\";\n import useSWR from \"swr\";\n // plane imports\n-import { EUserPermissions, EUserPermissionsLevel, PROJECT_TRACKER_ELEMENTS } from \"@plane/constants\";\n-import { useTranslation } from \"@plane/i18n\";\n-import { EmptyStateDetailed } from \"@plane/propel/empty-state\";\n-import { EProjectNetwork, GANTT_TIMELINE_TYPE } from \"@plane/types\";\n+import { EUserPermissions, EUserPermissionsLevel } from \"@plane/constants\";\n+import { GANTT_TIMELINE_TYPE } from \"@plane/types\";\n // components\n-import { JoinProject } from \"@/components/auth-screens/project/join-project\";\n-import { LogoSpinner } from \"@/components/common/logo-spinner\";\n+import { ProjectAccessRestriction } from \"@/components/auth-screens/project/project-access-restriction\";\n import {\n   PROJECT_DETAILS,\n   PROJECT_ME_INFORMATION,\n   PROJECT_LABELS,\n@@ -22,12 +19,10 @@\n   PROJECT_MODULES,\n   PROJECT_VIEWS,\n   PROJECT_INTAKE_STATE,\n } from \"@/constants/fetch-keys\";\n-import { captureClick } from \"@/helpers/event-tracker.helper\";\n // hooks\n import { useProjectEstimates } from \"@/hooks/store/estimates\";\n-import { useCommandPalette } from \"@/hooks/store/use-command-palette\";\n import { useCycle } from \"@/hooks/store/use-cycle\";\n import { useLabel } from \"@/hooks/store/use-label\";\n import { useMember } from \"@/hooks/store/use-member\";\n import { useModule } from \"@/hooks/store/use-module\";\n@@ -38,21 +33,21 @@\n import { useTimeLineChart } from \"@/hooks/use-timeline-chart\";\n \n interface IProjectAuthWrapper {\n   workspaceSlug: string;\n-  projectId?: string;\n+  projectId: string;\n   children: ReactNode;\n   isLoading?: boolean;\n }\n \n export const ProjectAuthWrapper = observer(function ProjectAuthWrapper(props: IProjectAuthWrapper) {\n   const { workspaceSlug, projectId, children, isLoading: isParentLoading = false } = props;\n-  // plane hooks\n-  const { t } = useTranslation();\n+  // states\n+  const [isJoiningProject, setIsJoiningProject] = useState(false);\n   // store hooks\n-  const { toggleCreateProjectModal } = useCommandPalette();\n-  const { fetchUserProjectInfo, allowPermissions, getProjectRoleByWorkspaceSlugAndProjectId } = useUserPermissions();\n-  const { loader, getProjectById, fetchProjectDetails } = useProject();\n+  const { fetchUserProjectInfo, allowPermissions } = useUserPermissions();\n+  const { fetchProjectDetails } = useProject();\n+  const { joinProject } = useUserPermissions();\n   const { fetchAllCycles } = useCycle();\n   const { fetchModulesSlim, fetchModules } = useModule();\n   const { initGantt } = useTimeLineChart(GANTT_TIMELINE_TYPE.MODULE);\n   const { fetchViews } = useProjectView();\n@@ -62,12 +57,9 @@\n   const { fetchProjectStates, fetchProjectIntakeState } = useProjectState();\n   const { data: currentUserData } = useUser();\n   const { fetchProjectLabels } = useLabel();\n   const { getProjectEstimates } = useProjectEstimates();\n-\n   // derived values\n-  const projectExists = projectId ? getProjectById(projectId) : null;\n-  const projectMemberInfo = getProjectRoleByWorkspaceSlugAndProjectId(workspaceSlug, projectId);\n   const hasPermissionToCurrentProject = allowPermissions(\n     [EUserPermissions.ADMIN, EUserPermissions.MEMBER, EUserPermissions.GUEST],\n     EUserPermissionsLevel.PROJECT,\n     workspaceSlug,\n@@ -81,121 +73,85 @@\n     // eslint-disable-next-line react-hooks/exhaustive-deps\n   }, []);\n \n   // fetching project details\n-  useSWR(\n-    workspaceSlug && projectId ? PROJECT_DETAILS(workspaceSlug, projectId) : null,\n-    workspaceSlug && projectId ? () => fetchProjectDetails(workspaceSlug, projectId) : null\n+  const { isLoading: isProjectDetailsLoading, error: projectDetailsError } = useSWR(\n+    PROJECT_DETAILS(workspaceSlug, projectId),\n+    () => fetchProjectDetails(workspaceSlug, projectId)\n   );\n-\n+  // fetching user project member information\n+  useSWR(PROJECT_ME_INFORMATION(workspaceSlug, projectId), () => fetchUserProjectInfo(workspaceSlug, projectId));\n   // fetching project member preferences\n   useSWR(\n-    workspaceSlug && projectId && currentUserData?.id ? PROJECT_MEMBER_PREFERENCES(workspaceSlug, projectId) : null,\n-    workspaceSlug && projectId && currentUserData?.id\n-      ? () => fetchProjectMemberPreferences(workspaceSlug, projectId, currentUserData.id)\n-      : null,\n+    currentUserData?.id ? PROJECT_MEMBER_PREFERENCES(workspaceSlug, projectId) : null,\n+    currentUserData?.id ? () => fetchProjectMemberPreferences(workspaceSlug, projectId, currentUserData.id) : null,\n     { revalidateIfStale: false, revalidateOnFocus: false }\n   );\n   // fetching project labels\n-  useSWR(\n-    workspaceSlug && projectId ? PROJECT_LABELS(workspaceSlug, projectId) : null,\n-    workspaceSlug && projectId ? () => fetchProjectLabels(workspaceSlug, projectId) : null,\n-    { revalidateIfStale: false, revalidateOnFocus: false }\n-  );\n+  useSWR(PROJECT_LABELS(workspaceSlug, projectId), () => fetchProjectLabels(workspaceSlug, projectId), {\n+    revalidateIfStale: false,\n+    revalidateOnFocus: false,\n+  });\n   // fetching project members\n-  useSWR(\n-    workspaceSlug && projectId ? PROJECT_MEMBERS(workspaceSlug, projectId) : null,\n-    workspaceSlug && projectId ? () => fetchProjectMembers(workspaceSlug, projectId) : null,\n-    { revalidateIfStale: false, revalidateOnFocus: false }\n-  );\n+  useSWR(PROJECT_MEMBERS(workspaceSlug, projectId), () => fetchProjectMembers(workspaceSlug, projectId), {\n+    revalidateIfStale: false,\n+    revalidateOnFocus: false,\n+  });\n   // fetching project states\n-  useSWR(\n-    workspaceSlug && projectId ? PROJECT_STATES(workspaceSlug, projectId) : null,\n-    workspaceSlug && projectId ? () => fetchProjectStates(workspaceSlug, projectId) : null,\n-    { revalidateIfStale: false, revalidateOnFocus: false }\n-  );\n+  useSWR(PROJECT_STATES(workspaceSlug, projectId), () => fetchProjectStates(workspaceSlug, projectId), {\n+    revalidateIfStale: false,\n+    revalidateOnFocus: false,\n+  });\n   // fetching project intake state\n-  useSWR(\n-    workspaceSlug && projectId ? PROJECT_INTAKE_STATE(workspaceSlug, projectId) : null,\n-    workspaceSlug && projectId ? () => fetchProjectIntakeState(workspaceSlug, projectId) : null,\n-    { revalidateIfStale: false, revalidateOnFocus: false }\n-  );\n+  useSWR(PROJECT_INTAKE_STATE(workspaceSlug, projectId), () => fetchProjectIntakeState(workspaceSlug, projectId), {\n+    revalidateIfStale: false,\n+    revalidateOnFocus: false,\n+  });\n   // fetching project estimates\n-  useSWR(\n-    workspaceSlug && projectId ? PROJECT_ESTIMATES(workspaceSlug, projectId) : null,\n-    workspaceSlug && projectId ? () => getProjectEstimates(workspaceSlug, projectId) : null,\n-    { revalidateIfStale: false, revalidateOnFocus: false }\n-  );\n+  useSWR(PROJECT_ESTIMATES(workspaceSlug, projectId), () => getProjectEstimates(workspaceSlug, projectId), {\n+    revalidateIfStale: false,\n+    revalidateOnFocus: false,\n+  });\n   // fetching project cycles\n-  useSWR(\n-    workspaceSlug && projectId ? PROJECT_ALL_CYCLES(workspaceSlug, projectId) : null,\n-    workspaceSlug && projectId ? () => fetchAllCycles(workspaceSlug, projectId) : null,\n-    { revalidateIfStale: false, revalidateOnFocus: false }\n-  );\n+  useSWR(PROJECT_ALL_CYCLES(workspaceSlug, projectId), () => fetchAllCycles(workspaceSlug, projectId), {\n+    revalidateIfStale: false,\n+    revalidateOnFocus: false,\n+  });\n   // fetching project modules\n   useSWR(\n-    workspaceSlug && projectId ? PROJECT_MODULES(workspaceSlug, projectId) : null,\n-    workspaceSlug && projectId\n-      ? async () => {\n-          await fetchModulesSlim(workspaceSlug, projectId);\n-          await fetchModules(workspaceSlug, projectId);\n-        }\n-      : null,\n+    PROJECT_MODULES(workspaceSlug, projectId),\n+    async () => {\n+      await Promise.all([fetchModulesSlim(workspaceSlug, projectId), fetchModules(workspaceSlug, projectId)]);\n+    },\n     { revalidateIfStale: false, revalidateOnFocus: false }\n   );\n   // fetching project views\n-  useSWR(\n-    workspaceSlug && projectId ? PROJECT_VIEWS(workspaceSlug, projectId) : null,\n-    workspaceSlug && projectId ? () => fetchViews(workspaceSlug, projectId) : null,\n-    { revalidateIfStale: false, revalidateOnFocus: false }\n-  );\n+  useSWR(PROJECT_VIEWS(workspaceSlug, projectId), () => fetchViews(workspaceSlug, projectId), {\n+    revalidateIfStale: false,\n+    revalidateOnFocus: false,\n+  });\n \n-  // permissions\n-  const canPerformEmptyStateActions = allowPermissions(\n-    [EUserPermissions.ADMIN, EUserPermissions.MEMBER],\n-    EUserPermissionsLevel.WORKSPACE\n-  );\n+  // handle join project\n+  const handleJoinProject = () => {\n+    setIsJoiningProject(true);\n+    joinProject(workspaceSlug, projectId)\n+      .then(() => fetchProjectDetails(workspaceSlug, projectId))\n+      .finally(() => setIsJoiningProject(false));\n+  };\n \n-  // check if the project member apis is loading\n-  if (isParentLoading || (!projectMemberInfo && projectId && hasPermissionToCurrentProject === null))\n-    return (\n-      <div className=\"grid h-full place-items-center bg-custom-background-100 p-4 rounded-lg border border-custom-border-200\">\n-        <div className=\"flex flex-col items-center gap-3 text-center\">\n-          <LogoSpinner />\n-        </div>\n-      </div>\n-    );\n+  const isProjectLoading = (isParentLoading || isProjectDetailsLoading) && !projectDetailsError;\n \n-  // check if the user don't have permission to access the project\n-  if (\n-    ((projectExists?.network && projectExists?.network !== EProjectNetwork.PRIVATE) || isWorkspaceAdmin) &&\n-    projectId &&\n-    hasPermissionToCurrentProject === false\n-  )\n-    return <JoinProject projectId={projectId} />;\n+  if (isProjectLoading) return null;\n \n-  // check if the project info is not found.\n-  if (loader === \"loaded\" && projectId && !!hasPermissionToCurrentProject === false)\n+  if (!isProjectLoading && hasPermissionToCurrentProject === false) {\n     return (\n-      <div className=\"grid h-full place-items-center bg-custom-background-100\">\n-        <EmptyStateDetailed\n-          title={t(\"workspace_projects.empty_state.general.title\")}\n-          description={t(\"workspace_projects.empty_state.general.description\")}\n-          assetKey=\"project\"\n-          assetClassName=\"size-40\"\n-          actions={[\n-            {\n-              label: t(\"workspace_projects.empty_state.general.primary_button.text\"),\n-              onClick: () => {\n-                toggleCreateProjectModal(true);\n-                captureClick({ elementName: PROJECT_TRACKER_ELEMENTS.EMPTY_STATE_CREATE_PROJECT_BUTTON });\n-              },\n-              disabled: !canPerformEmptyStateActions,\n-              variant: \"primary\",\n-            },\n-          ]}\n-        />\n-      </div>\n+      <ProjectAccessRestriction\n+        errorStatusCode={projectDetailsError?.status}\n+        isWorkspaceAdmin={isWorkspaceAdmin}\n+        handleJoinProject={handleJoinProject}\n+        isJoinButtonDisabled={isJoiningProject}\n+      />\n     );\n+  }\n \n   return <>{children}</>;\n });\n"
        },
        {
          "path": "apps/web/core/services/project/project.service.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/services/project/project.service.ts\n===================================================================\n--- apps/web/core/services/project/project.service.ts\t8db95d9 (parent)\n+++ apps/web/core/services/project/project.service.ts\t6022080 (commit)\n@@ -56,9 +56,9 @@\n   async getProject(workspaceSlug: string, projectId: string): Promise<TProject> {\n     return this.get(`/api/workspaces/${workspaceSlug}/projects/${projectId}/`)\n       .then((response) => response?.data)\n       .catch((error) => {\n-        throw error?.response?.data;\n+        throw error?.response;\n       });\n   }\n \n   async getProjectAnalyticsCount(\n"
        },
        {
          "path": "packages/i18n/src/locales/cs/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/cs/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/cs/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/cs/empty-state.ts\t6022080 (commit)\n@@ -23,8 +23,19 @@\n       cta_primary: \"Zkuste znovu načíst\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Vypadá to, že nemáte přístup k tomuto projektu\",\n+      restricted_description: \"Kontaktujte administrátora a požádejte o přístup, abyste zde mohli pokračovat.\",\n+      join_description: \"Klikněte na tlačítko níže pro připojení k projektu.\",\n+      cta_primary: \"Připojit se k projektu\",\n+      cta_loading: \"Připojování k projektu\",\n+    },\n+    invalid_project: {\n+      title: \"Projekt nebyl nalezen\",\n+      description: \"Projekt, který hledáte, neexistuje.\",\n+    },\n     work_items: {\n       title: \"Začněte s vaší první pracovní položkou.\",\n       description:\n         \"Pracovní položky jsou stavebními kameny vašeho projektu — přiřazujte vlastníky, nastavujte priority a snadno sledujte pokrok.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/de/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/de/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/de/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/de/empty-state.ts\t6022080 (commit)\n@@ -25,8 +25,19 @@\n       cta_primary: \"Versuchen Sie neu zu laden\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Es scheint, als hätten Sie keinen Zugriff auf dieses Projekt\",\n+      restricted_description: \"Kontaktieren Sie den Administrator, um Zugriff anzufordern, damit Sie hier fortfahren können.\",\n+      join_description: \"Klicken Sie unten auf die Schaltfläche, um beizutreten.\",\n+      cta_primary: \"Projekt beitreten\",\n+      cta_loading: \"Projekt wird beigetreten\",\n+    },\n+    invalid_project: {\n+      title: \"Projekt nicht gefunden\",\n+      description: \"Das gesuchte Projekt existiert nicht.\",\n+    },\n     work_items: {\n       title: \"Beginnen Sie mit Ihrem ersten Arbeitselement.\",\n       description:\n         \"Arbeitselemente sind die Bausteine Ihres Projekts — weisen Sie Eigentümer zu, setzen Sie Prioritäten und verfolgen Sie den Fortschritt einfach.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/en/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/en/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/en/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/en/empty-state.ts\t6022080 (commit)\n@@ -23,8 +23,19 @@\n       cta_primary: \"Try reloading\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Seems like you don’t have access to this Project\",\n+      restricted_description: \"Contact admin to request for access and you can continue here.\",\n+      join_description: \"Click the button below to join it.\",\n+      cta_primary: \"Join project\",\n+      cta_loading: \"Joining project\",\n+    },\n+    invalid_project: {\n+      title: \"Project not found\",\n+      description: \"The project you are looking for does not exist.\",\n+    },\n     work_items: {\n       title: \"Start with your first work item.\",\n       description:\n         \"Work items are the building blocks of your project — assign owners, set priorities, and track progress easily.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/es/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/es/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/es/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/es/empty-state.ts\t6022080 (commit)\n@@ -25,8 +25,19 @@\n       cta_primary: \"Intentar recargar\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Parece que no tienes acceso a este proyecto\",\n+      restricted_description: \"Contacta con el administrador para solicitar acceso y podrás continuar aquí.\",\n+      join_description: \"Haz clic en el botón de abajo para unirte.\",\n+      cta_primary: \"Unirse al proyecto\",\n+      cta_loading: \"Uniéndose al proyecto\",\n+    },\n+    invalid_project: {\n+      title: \"Proyecto no encontrado\",\n+      description: \"El proyecto que buscas no existe.\",\n+    },\n     work_items: {\n       title: \"Comienza con tu primer elemento de trabajo.\",\n       description:\n         \"Los elementos de trabajo son los bloques de construcción de tu proyecto — asigna responsables, establece prioridades y realiza un seguimiento del progreso fácilmente.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/fr/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/fr/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/fr/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/fr/empty-state.ts\t6022080 (commit)\n@@ -26,8 +26,19 @@\n       cta_primary: \"Essayer de recharger\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Il semble que vous n’ayez pas accès à ce projet\",\n+      restricted_description: \"Contactez l’administrateur pour demander l’accès afin de pouvoir continuer ici.\",\n+      join_description: \"Cliquez sur le bouton ci-dessous pour rejoindre le projet.\",\n+      cta_primary: \"Rejoindre le projet\",\n+      cta_loading: \"Rejoindre le projet…\",\n+    },\n+    invalid_project: {\n+      title: \"Projet non trouvé\",\n+      description: \"Le projet que vous recherchez n’existe pas.\",\n+    },\n     work_items: {\n       title: \"Commencez avec votre premier élément de travail.\",\n       description:\n         \"Les éléments de travail sont les éléments constitutifs de votre projet — attribuez des propriétaires, définissez des priorités et suivez facilement les progrès.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/id/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/id/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/id/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/id/empty-state.ts\t6022080 (commit)\n@@ -24,8 +24,19 @@\n       cta_primary: \"Coba muat ulang\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Sepertinya Anda tidak memiliki akses ke Proyek ini\",\n+      restricted_description: \"Hubungi admin untuk meminta akses agar Anda dapat melanjutkan di sini.\",\n+      join_description: \"Klik tombol di bawah ini untuk bergabung.\",\n+      cta_primary: \"Bergabung dengan proyek\",\n+      cta_loading: \"Sedang bergabung dengan proyek\",\n+    },\n+    invalid_project: {\n+      title: \"Proyek tidak ditemukan\",\n+      description: \"Proyek yang Anda cari tidak ada.\",\n+    },\n     work_items: {\n       title: \"Mulai dengan item kerja pertama Anda.\",\n       description:\n         \"Item kerja adalah blok bangunan proyek Anda — tetapkan pemilik, atur prioritas, dan lacak kemajuan dengan mudah.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/it/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/it/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/it/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/it/empty-state.ts\t6022080 (commit)\n@@ -26,8 +26,19 @@\n       cta_primary: \"Prova a ricaricare\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Sembra che tu non abbia accesso a questo progetto\",\n+      restricted_description: \"Contatta l'amministratore per richiedere l'accesso e potrai continuare qui.\",\n+      join_description: \"Clicca sul pulsante qui sotto per unirti.\",\n+      cta_primary: \"Unisciti al progetto\",\n+      cta_loading: \"Unione al progetto in corso\",\n+    },\n+    invalid_project: {\n+      title: \"Progetto non trovato\",\n+      description: \"Il progetto che stai cercando non esiste.\",\n+    },\n     work_items: {\n       title: \"Inizia con il tuo primo elemento di lavoro.\",\n       description:\n         \"Gli elementi di lavoro sono i mattoni del tuo progetto — assegna proprietari, imposta priorità e traccia facilmente i progressi.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/ja/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/ja/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/ja/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/ja/empty-state.ts\t6022080 (commit)\n@@ -23,8 +23,19 @@\n       cta_primary: \"再読み込みを試す\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"このプロジェクトへのアクセス権がないようです\",\n+      restricted_description: \"管理者に連絡してアクセス権をリクエストすると、ここで作業を続けられます。\",\n+      join_description: \"下のボタンをクリックして参加してください。\",\n+      cta_primary: \"プロジェクトに参加\",\n+      cta_loading: \"プロジェクトに参加中\",\n+    },\n+    invalid_project: {\n+      title: \"プロジェクトが見つかりません\",\n+      description: \"お探しのプロジェクトは存在しません。\",\n+    },\n     work_items: {\n       title: \"最初の作業項目から始めましょう。\",\n       description:\n         \"作業項目はプロジェクトの構成要素です — 担当者の割り当て、優先度の設定、進捗の追跡が簡単に行えます。\",\n"
        },
        {
          "path": "packages/i18n/src/locales/ko/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/ko/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/ko/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/ko/empty-state.ts\t6022080 (commit)\n@@ -23,8 +23,19 @@\n       cta_primary: \"다시 로드 시도\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"이 프로젝트에 접근할 수 없는 것 같습니다\",\n+      restricted_description: \"관리자에게 접근 권한을 요청하시면 여기서 계속 진행하실 수 있습니다.\",\n+      join_description: \"아래 버튼을 클릭하여 프로젝트에 참여하세요.\",\n+      cta_primary: \"프로젝트 참여\",\n+      cta_loading: \"프로젝트 참여 중\",\n+    },\n+    invalid_project: {\n+      title: \"프로젝트를 찾을 수 없습니다\",\n+      description: \"찾으시는 프로젝트가 존재하지 않습니다.\",\n+    },\n     work_items: {\n       title: \"첫 번째 작업 항목으로 시작하세요.\",\n       description:\n         \"작업 항목은 프로젝트의 구성 요소입니다. 소유자를 할당하고 우선순위를 설정하며 진행 상황을 쉽게 추적할 수 있습니다.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/pl/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/pl/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/pl/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/pl/empty-state.ts\t6022080 (commit)\n@@ -23,8 +23,19 @@\n       cta_primary: \"Spróbuj przeładować\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Wygląda na to, że nie masz dostępu do tego projektu\",\n+      restricted_description: \"Skontaktuj się z administratorem, aby poprosić o dostęp i móc kontynuować tutaj.\",\n+      join_description: \"Kliknij przycisk poniżej, aby dołączyć.\",\n+      cta_primary: \"Dołącz do projektu\",\n+      cta_loading: \"Dołączanie do projektu\",\n+    },\n+    invalid_project: {\n+      title: \"Projekt nie został znaleziony\",\n+      description: \"Projekt, którego szukasz, nie istnieje.\",\n+    },\n     work_items: {\n       title: \"Zacznij od swojego pierwszego elementu roboczego.\",\n       description:\n         \"Elementy robocze są podstawowymi elementami Twojego projektu — przypisuj właścicieli, ustalaj priorytety i łatwo śledź postęp.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/pt-BR/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/pt-BR/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/pt-BR/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/pt-BR/empty-state.ts\t6022080 (commit)\n@@ -25,8 +25,19 @@\n       cta_primary: \"Tentar recarregar\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Parece que você não tem acesso a este projeto\",\n+      restricted_description: \"Entre em contato com o administrador para solicitar acesso e você poderá continuar aqui.\",\n+      join_description: \"Clique no botão abaixo para participar.\",\n+      cta_primary: \"Participar do projeto\",\n+      cta_loading: \"Participando do projeto\",\n+    },\n+    invalid_project: {\n+      title: \"Projeto não encontrado\",\n+      description: \"O projeto que você está procurando não existe.\",\n+    },\n     work_items: {\n       title: \"Comece com seu primeiro item de trabalho.\",\n       description:\n         \"Os itens de trabalho são os blocos de construção do seu projeto — atribua proprietários, defina prioridades e acompanhe o progresso facilmente.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/ro/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/ro/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/ro/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/ro/empty-state.ts\t6022080 (commit)\n@@ -24,8 +24,19 @@\n       cta_primary: \"Încercați reîncărcarea\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Se pare că nu aveți acces la acest proiect\",\n+      restricted_description: \"Contactați administratorul pentru a solicita accesul și veți putea continua aici.\",\n+      join_description: \"Faceți clic pe butonul de mai jos pentru a vă alătura.\",\n+      cta_primary: \"Alăturați-vă proiectului\",\n+      cta_loading: \"Se alătură proiectului\",\n+    },\n+    invalid_project: {\n+      title: \"Proiect negăsit\",\n+      description: \"Proiectul pe care îl căutați nu există.\",\n+    },\n     work_items: {\n       title: \"Începeți cu primul dvs. element de lucru.\",\n       description:\n         \"Elementele de lucru sunt blocurile de construcție ale proiectului dvs. — alocați proprietari, stabiliți priorități și urmăriți progresul cu ușurință.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/ru/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/ru/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/ru/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/ru/empty-state.ts\t6022080 (commit)\n@@ -24,8 +24,19 @@\n       cta_primary: \"Попробовать перезагрузить\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Похоже, у вас нет доступа к этому проекту\",\n+      restricted_description: \"Свяжитесь с администратором, чтобы запросить доступ, и вы сможете продолжить здесь.\",\n+      join_description: \"Нажмите кнопку ниже, чтобы присоединиться.\",\n+      cta_primary: \"Присоединиться к проекту\",\n+      cta_loading: \"Присоединение к проекту\",\n+    },\n+    invalid_project: {\n+      title: \"Проект не найден\",\n+      description: \"Проект, который вы ищете, не существует.\",\n+    },\n     work_items: {\n       title: \"Начните с вашего первого рабочего элемента.\",\n       description:\n         \"Рабочие элементы — это строительные блоки вашего проекта — назначайте ответственных, устанавливайте приоритеты и легко отслеживайте прогресс.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/sk/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/sk/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/sk/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/sk/empty-state.ts\t6022080 (commit)\n@@ -23,8 +23,19 @@\n       cta_primary: \"Skúste znovu načítať\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Zdá sa, že nemáte prístup k tomuto projektu\",\n+      restricted_description: \"Kontaktujte administrátora, aby ste požiadali o prístup, a potom tu môžete pokračovať.\",\n+      join_description: \"Kliknite na tlačidlo nižšie, aby ste sa pripojili.\",\n+      cta_primary: \"Pripojiť sa k projektu\",\n+      cta_loading: \"Pripájanie k projektu\",\n+    },\n+    invalid_project: {\n+      title: \"Projekt nebol nájdený\",\n+      description: \"Projekt, ktorý hľadáte, neexistuje.\",\n+    },\n     work_items: {\n       title: \"Začnite s vašou prvou pracovnou položkou.\",\n       description:\n         \"Pracovné položky sú stavebnými kameňmi vášho projektu — priraďujte vlastníkov, nastavujte priority a jednoducho sledujte pokrok.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/tr-TR/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/tr-TR/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/tr-TR/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/tr-TR/empty-state.ts\t6022080 (commit)\n@@ -23,8 +23,19 @@\n       cta_primary: \"Yeniden yüklemeyi dene\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Görünüşe göre bu projeye erişiminiz yok\",\n+      restricted_description: \"Erişim talep etmek için yöneticiyle iletişime geçin, sonra burada devam edebilirsiniz.\",\n+      join_description: \"Katılmak için aşağıdaki butona tıklayın.\",\n+      cta_primary: \"Projeye katıl\",\n+      cta_loading: \"Projeye katılınıyor\",\n+    },\n+    invalid_project: {\n+      title: \"Proje bulunamadı\",\n+      description: \"Aradığınız proje mevcut değil.\",\n+    },\n     work_items: {\n       title: \"İlk iş öğenizle başlayın.\",\n       description:\n         \"İş öğeleri projenizin yapı taşlarıdır — sahipler atayın, öncelikleri belirleyin ve ilerlemeyi kolayca takip edin.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/ua/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/ua/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/ua/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/ua/empty-state.ts\t6022080 (commit)\n@@ -24,8 +24,19 @@\n       cta_primary: \"Спробуйте перезавантажити\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Схоже, у вас немає доступу до цього проєкту\",\n+      restricted_description: \"Зверніться до адміністратора, щоб запросити доступ, і ви зможете продовжити тут.\",\n+      join_description: \"Натисніть кнопку нижче, щоб приєднатися.\",\n+      cta_primary: \"Приєднатися до проєкту\",\n+      cta_loading: \"Приєднання до проєкту\",\n+    },\n+    invalid_project: {\n+      title: \"Проєкт не знайдено\",\n+      description: \"Проєкт, який ви шукаєте, не існує.\",\n+    },\n     work_items: {\n       title: \"Почніть з вашого першого робочого елемента.\",\n       description:\n         \"Робочі елементи є будівельними блоками вашого проєкту — призначайте власників, встановлюйте пріоритети та легко відстежуйте прогрес.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/vi-VN/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/vi-VN/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/vi-VN/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/vi-VN/empty-state.ts\t6022080 (commit)\n@@ -24,8 +24,19 @@\n       cta_primary: \"Thử tải lại\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"Có vẻ như bạn không có quyền truy cập vào Dự án này\",\n+      restricted_description: \"Liên hệ với quản trị viên để yêu cầu quyền truy cập và bạn có thể tiếp tục tại đây.\",\n+      join_description: \"Nhấn nút bên dưới để tham gia.\",\n+      cta_primary: \"Tham gia dự án\",\n+      cta_loading: \"Đang tham gia dự án\",\n+    },\n+    invalid_project: {\n+      title: \"Không tìm thấy dự án\",\n+      description: \"Dự án bạn đang tìm kiếm không tồn tại.\",\n+    },\n     work_items: {\n       title: \"Bắt đầu với mục công việc đầu tiên của bạn.\",\n       description:\n         \"Các mục công việc là những khối xây dựng của dự án của bạn — chỉ định người sở hữu, đặt mức độ ưu tiên và theo dõi tiến độ dễ dàng.\",\n"
        },
        {
          "path": "packages/i18n/src/locales/zh-CN/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/zh-CN/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/zh-CN/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/zh-CN/empty-state.ts\t6022080 (commit)\n@@ -23,8 +23,19 @@\n       cta_primary: \"尝试重新加载\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"您似乎无权访问该项目\",\n+      restricted_description: \"请联系管理员申请访问权限，通过后您可以在此继续。\",\n+      join_description: \"点击下方按钮加入该项目。\",\n+      cta_primary: \"加入项目\",\n+      cta_loading: \"正在加入项目\",\n+    },\n+    invalid_project: {\n+      title: \"未找到项目\",\n+      description: \"您查找的项目不存在。\",\n+    },\n     work_items: {\n       title: \"从您的第一个工作项开始。\",\n       description: \"工作项是项目的构建块 — 分配负责人、设置优先级并轻松跟踪进度。\",\n       cta_primary: \"创建您的第一个工作项\",\n"
        },
        {
          "path": "packages/i18n/src/locales/zh-TW/empty-state.ts",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/zh-TW/empty-state.ts\n===================================================================\n--- packages/i18n/src/locales/zh-TW/empty-state.ts\t8db95d9 (parent)\n+++ packages/i18n/src/locales/zh-TW/empty-state.ts\t6022080 (commit)\n@@ -23,8 +23,19 @@\n       cta_primary: \"嘗試重新載入\",\n     },\n   },\n   project_empty_state: {\n+    no_access: {\n+      title: \"您似乎無權存取此專案\",\n+      restricted_description: \"請聯絡管理員以申請存取權，核准後即可在此繼續。\",\n+      join_description: \"點擊下方按鈕加入專案。\",\n+      cta_primary: \"加入專案\",\n+      cta_loading: \"正在加入專案\",\n+    },\n+    invalid_project: {\n+      title: \"找不到專案\",\n+      description: \"您所查找的專案不存在。\",\n+    },\n     work_items: {\n       title: \"從您的第一個工作項開始。\",\n       description: \"工作項是專案的建構模組 — 指派負責人、設定優先順序並輕鬆追蹤進度。\",\n       cta_primary: \"建立您的第一個工作項\",\n"
        }
      ]
    },
    {
      "id": "add-unique-ids",
      "sha": "bd0361de92a93ad7d770af8f4d7b0f609a3a7d83",
      "parentSha": "ebab5e209f63674f2a544e3b458df5a11fc107ce",
      "spec": "Implement persistent unique IDs for block-level nodes in the rich-text editor, integrate with collaboration, and pass issue context into the editor menus.\n\nScope and requirements:\n\n1) Backend sanitization\n- Update the Django content sanitizer to allow the data-id attribute on editor HTML content.\n  - File: apps/api/plane/utils/content_validator.py\n  - Add \"data-id\" to the ATTRIBUTES allowlist so that saved content containing data-id on nodes is not stripped.\n\n2) Web app: pass issue sequence context to the editor\n- Update the DescriptionInput API to accept an optional issueSequenceId used as an identifier for the active issue.\n  - File: apps/web/core/components/editor/rich-text/description-input/root.tsx\n  - Add a new optional prop issueSequenceId?: number.\n  - Pass this prop down to the editor wrapper so that the editor can derive a workItemIdentifier for menus.\n- Pass issueSequenceId from places that render the issue description editor:\n  - File: apps/web/core/components/inbox/content/issue-root.tsx\n  - File: apps/web/core/components/issues/issue-detail/main-content.tsx\n  - File: apps/web/core/components/issues/peek-overview/issue-detail.tsx\n  - Provide issue.sequence_id via issueSequenceId when rendering DescriptionInput.\n- Update the rich-text editor wrapper in the web app to accept and forward this context.\n  - File: apps/web/core/components/editor/rich-text/editor.tsx\n  - Extend the wrapper props with issueSequenceId?: number and ensure it is forwarded into the underlying shared editor so menus can access a workItemIdentifier derived from it.\n\n3) Editor package: add UniqueID extension and wire it in\n- Define a new core extension key for unique IDs and enumerate supported block node types.\n  - File: packages/editor/src/core/constants/extension.ts\n  - Add CORE_EXTENSIONS.UNIQUE_ID to the enum.\n  - Add a BLOCK_NODE_TYPES array containing the editor’s built-in block node type names (paragraph, heading, blockquote, code block, hr, list variants, table, image/custom image, callout, work item embed).\n- Allow CE or downstream packages to contribute additional block node types.\n  - File: packages/editor/src/ce/constants/extensions.ts\n  - Export ADDITIONAL_BLOCK_NODE_TYPES as an empty array by default.\n- Implement the UniqueID extension with the following behavior:\n  - Files: packages/editor/src/core/extensions/unique-id/extension.ts, plugin.ts, utils.ts\n  - Global attribute: add an id attribute to configured block node types, rendered as data-id in HTML and parsed from data-id.\n  - On editor create: if editable and not using a collaboration provider (or provider is already synced), scan the document and add IDs to nodes missing them.\n  - ProseMirror plugin behavior:\n    - Append transaction: for document changes (excluding collaboration y-sync transactions), add IDs to new/mutated nodes without an id and resolve duplicate IDs on newly introduced nodes.\n    - Paste/drop handling: strip data-id from pasted/dropped content so new IDs are generated post-insert.\n    - Collaboration: if a Hocuspocus provider is used and not yet synced, defer initial ID creation until the provider emits a synced event; clean up the listener when done or on view destroy.\n  - Use UUID v4 for ID generation by default, with options to override.\n- Register the UniqueID extension in the core editor’s extension list with provider awareness.\n  - File: packages/editor/src/core/extensions/extensions.ts\n  - Accept a provider: HocuspocusProvider | undefined in the arguments passed to CoreEditorExtensions.\n  - Add UniqueID to the returned extensions, configured with the provider.\n- Ensure the editor hook passes the collaboration provider to the extension registry.\n  - File: packages/editor/src/core/hooks/use-editor.ts\n  - Pass provider through to CoreEditorExtensions so UniqueID can react to provider sync state.\n\n4) Editor package: expose workItemIdentifier to menus\n- Extend editor props to accept an optional workItemIdentifier that can be used by menus (e.g., for contextual actions or embeds).\n  - File: packages/editor/src/core/types/editor.ts\n  - Add workItemIdentifier?: string | null to IEditorProps.\n- Plumb workItemIdentifier into the block menu:\n  - File: packages/editor/src/core/components/editors/rich-text/editor.tsx\n  - Accept workItemIdentifier in the editor component props and pass it to the BlockMenu component.\n  - File: packages/editor/src/core/components/menus/block-menu.tsx\n  - Extend the BlockMenu props to accept workItemIdentifier and wire it through its component signature (no behavior change required at this time).\n\nFunctional/observable acceptance criteria:\n- When editing content, each block-level node of the configured types has a stable data-id attribute in the saved HTML; newly created nodes receive an ID automatically.\n- Pasting or dropping content removes old IDs from pasted nodes and regenerates new ones on insert; undo history does not record ID-generation steps.\n- In collaborative sessions (Hocuspocus), IDs are not added until the provider is synced; IDs are not duplicated when peers edit concurrently.\n- The backend no longer strips data-id and persists it as part of the description content.\n- DescriptionInput supports an issueSequenceId prop and the places rendering issue descriptions pass issue.sequence_id into it. The editor exposes this context to the BlockMenu via workItemIdentifier so future features can use it.",
      "prompt": "Add persistent unique IDs to block-level nodes in the rich-text editor and make them collaboration-safe. Ensure the backend sanitizer allows these IDs. Also pass the current issue’s sequence identifier from issue views into the editor so menus can access an issue-specific identifier.\n\nSpecifically:\n- The editor must assign a unique ID to each block node, persist it in HTML as a data-id attribute, and regenerate IDs for pasted/dropped content. Avoid adding these ID operations to undo history.\n- Support collaborative editing: do not create IDs during incoming collaboration transactions, and defer initial ID creation until the collaboration provider has synced.\n- Whitelist data-id on the backend so saved descriptions containing these attributes are not stripped.\n- Add a way for issue views to pass the current issue’s sequence identifier into the DescriptionInput and forward it to the editor menu context.\n\nDo not include code; describe the necessary changes across the relevant files, including editor extension registration, prop additions, and sanitizer updates. Ensure the behavior is testable in both single-user and collaborative sessions.",
      "supplementalFiles": [
        "packages/editor/Readme.md",
        "apps/live/src/hocuspocus.ts",
        "packages/services/src/live.service.ts",
        "apps/api/plane/utils/html_processor.py",
        "apps/api/plane/utils/markdown.py",
        "packages/types/src/issues/issue.ts"
      ],
      "fileDiffs": [
        {
          "path": "apps/api/plane/utils/content_validator.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/utils/content_validator.py\n===================================================================\n--- apps/api/plane/utils/content_validator.py\tebab5e2 (parent)\n+++ apps/api/plane/utils/content_validator.py\tbd0361d (commit)\n@@ -98,8 +98,9 @@\n         \"data-checked\",\n         \"data-background-color\",\n         \"data-text-color\",\n         \"data-name\",\n+        \"data-id\",\n         # callout attributes\n         \"data-icon-name\",\n         \"data-icon-color\",\n         \"data-background\",\n"
        },
        {
          "path": "apps/web/core/components/editor/rich-text/description-input/root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/editor/rich-text/description-input/root.tsx\n===================================================================\n--- apps/web/core/components/editor/rich-text/description-input/root.tsx\tebab5e2 (parent)\n+++ apps/web/core/components/editor/rich-text/description-input/root.tsx\tbd0361d (commit)\n@@ -78,8 +78,12 @@\n   /**\n    * @description Workspace slug, this will be used to get the workspace details\n    */\n   workspaceSlug: string;\n+  /**\n+   * @description Issue sequence id, this will be used to get the issue sequence id\n+   */\n+  issueSequenceId?: number;\n };\n \n /**\n  * @description DescriptionInput component for rich text editor with autosave functionality using debounce\n@@ -99,8 +103,9 @@\n     projectId,\n     setIsSubmitting,\n     swrDescription,\n     workspaceSlug,\n+    issueSequenceId,\n   } = props;\n   // states\n   const [localDescription, setLocalDescription] = useState<TFormData>({\n     id: entityId,\n@@ -194,8 +199,9 @@\n             <RichTextEditor\n               editable={!disabled}\n               ref={editorRef}\n               id={entityId}\n+              issueSequenceId={issueSequenceId}\n               disabledExtensions={disabledExtensions}\n               initialValue={localDescription.description_html ?? \"<p></p>\"}\n               value={swrDescription ?? null}\n               workspaceSlug={workspaceSlug}\n"
        },
        {
          "path": "apps/web/core/components/editor/rich-text/editor.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/editor/rich-text/editor.tsx\n===================================================================\n--- apps/web/core/components/editor/rich-text/editor.tsx\tebab5e2 (parent)\n+++ apps/web/core/components/editor/rich-text/editor.tsx\tbd0361d (commit)\n@@ -18,8 +18,9 @@\n > & {\n   workspaceSlug: string;\n   workspaceId: string;\n   projectId?: string;\n+  issueSequenceId?: number;\n } & (\n     | {\n         editable: false;\n       }\n"
        },
        {
          "path": "apps/web/core/components/inbox/content/issue-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/inbox/content/issue-root.tsx\n===================================================================\n--- apps/web/core/components/inbox/content/issue-root.tsx\tebab5e2 (parent)\n+++ apps/web/core/components/inbox/content/issue-root.tsx\tbd0361d (commit)\n@@ -194,8 +194,9 @@\n         {loader === \"issue-loading\" ? (\n           <DescriptionInputLoader />\n         ) : (\n           <DescriptionInput\n+            issueSequenceId={issue.sequence_id}\n             containerClassName=\"-ml-3 border-none\"\n             disabled={!isEditable}\n             editorRef={editorRef}\n             entityId={issue.id}\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-detail/main-content.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-detail/main-content.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-detail/main-content.tsx\tebab5e2 (parent)\n+++ apps/web/core/components/issues/issue-detail/main-content.tsx\tbd0361d (commit)\n@@ -128,8 +128,9 @@\n           containerClassName=\"-ml-3\"\n         />\n \n         <DescriptionInput\n+          issueSequenceId={issue.sequence_id}\n           containerClassName=\"-ml-3 border-none\"\n           disabled={isArchived || !isEditable}\n           editorRef={editorRef}\n           entityId={issue.id}\n"
        },
        {
          "path": "apps/web/core/components/issues/peek-overview/issue-detail.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/peek-overview/issue-detail.tsx\n===================================================================\n--- apps/web/core/components/issues/peek-overview/issue-detail.tsx\tebab5e2 (parent)\n+++ apps/web/core/components/issues/peek-overview/issue-detail.tsx\tbd0361d (commit)\n@@ -127,8 +127,9 @@\n         containerClassName=\"-ml-3\"\n       />\n \n       <DescriptionInput\n+        issueSequenceId={issue.sequence_id}\n         containerClassName=\"-ml-3 border-none\"\n         disabled={disabled || isArchived}\n         editorRef={editorRef}\n         entityId={issue.id}\n"
        },
        {
          "path": "packages/editor/src/ce/constants/extensions.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/ce/constants/extensions.ts\n===================================================================\n--- packages/editor/src/ce/constants/extensions.ts\tebab5e2 (parent)\n+++ packages/editor/src/ce/constants/extensions.ts\tbd0361d (commit)\n@@ -1,1 +1,3 @@\n export enum ADDITIONAL_EXTENSIONS {}\n+\n+export const ADDITIONAL_BLOCK_NODE_TYPES = [];\n"
        },
        {
          "path": "packages/editor/src/core/components/editors/rich-text/editor.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/components/editors/rich-text/editor.tsx\n===================================================================\n--- packages/editor/src/core/components/editors/rich-text/editor.tsx\tebab5e2 (parent)\n+++ packages/editor/src/core/components/editors/rich-text/editor.tsx\tbd0361d (commit)\n@@ -17,8 +17,9 @@\n     extensions: externalExtensions = [],\n     fileHandler,\n     flaggedExtensions,\n     extendedEditorProps,\n+    workItemIdentifier,\n   } = props;\n \n   const getExtensions = useCallback(() => {\n     const extensions = [\n@@ -42,9 +43,14 @@\n     <EditorWrapper {...props} extensions={getExtensions()}>\n       {(editor) => (\n         <>\n           {editor && bubbleMenuEnabled && <EditorBubbleMenu editor={editor} />}\n-          <BlockMenu editor={editor} flaggedExtensions={flaggedExtensions} disabledExtensions={disabledExtensions} />\n+          <BlockMenu\n+            editor={editor}\n+            flaggedExtensions={flaggedExtensions}\n+            disabledExtensions={disabledExtensions}\n+            workItemIdentifier={workItemIdentifier}\n+          />\n         </>\n       )}\n     </EditorWrapper>\n   );\n"
        },
        {
          "path": "packages/editor/src/core/components/menus/block-menu.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/components/menus/block-menu.tsx\n===================================================================\n--- packages/editor/src/core/components/menus/block-menu.tsx\tebab5e2 (parent)\n+++ packages/editor/src/core/components/menus/block-menu.tsx\tbd0361d (commit)\n@@ -23,8 +23,9 @@\n type Props = {\n   disabledExtensions?: IEditorProps[\"disabledExtensions\"];\n   editor: Editor;\n   flaggedExtensions?: IEditorProps[\"flaggedExtensions\"];\n+  workItemIdentifier?: IEditorProps[\"workItemIdentifier\"];\n };\n export type BlockMenuOption = {\n   icon: LucideIcon;\n   key: string;\n@@ -33,9 +34,9 @@\n   isDisabled?: boolean;\n };\n \n export const BlockMenu = (props: Props) => {\n-  const { editor } = props;\n+  const { editor, workItemIdentifier } = props;\n   const [isOpen, setIsOpen] = useState(false);\n   const [isAnimatedIn, setIsAnimatedIn] = useState(false);\n   const menuRef = useRef<HTMLDivElement | null>(null);\n   const virtualReferenceRef = useRef<{ getBoundingClientRect: () => DOMRect }>({\n"
        },
        {
          "path": "packages/editor/src/core/constants/extension.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/constants/extension.ts\n===================================================================\n--- packages/editor/src/core/constants/extension.ts\tebab5e2 (parent)\n+++ packages/editor/src/core/constants/extension.ts\tbd0361d (commit)\n@@ -41,5 +41,31 @@\n   UNDERLINE = \"underline\",\n   UTILITY = \"utility\",\n   WORK_ITEM_EMBED = \"issue-embed-component\",\n   EMOJI = \"emoji\",\n+  UNIQUE_ID = \"uniqueID\",\n }\n+\n+export const BLOCK_NODE_TYPES = [\n+  // Basic block nodes\n+  CORE_EXTENSIONS.PARAGRAPH,\n+  CORE_EXTENSIONS.HEADING,\n+  CORE_EXTENSIONS.BLOCKQUOTE,\n+  CORE_EXTENSIONS.CODE_BLOCK,\n+  CORE_EXTENSIONS.HORIZONTAL_RULE,\n+\n+  // List nodes\n+  CORE_EXTENSIONS.BULLET_LIST,\n+  CORE_EXTENSIONS.ORDERED_LIST,\n+  CORE_EXTENSIONS.LIST_ITEM,\n+  CORE_EXTENSIONS.TASK_LIST,\n+  CORE_EXTENSIONS.TASK_ITEM,\n+\n+  // Table nodes\n+  CORE_EXTENSIONS.TABLE,\n+\n+  // Media and embed nodes\n+  CORE_EXTENSIONS.IMAGE,\n+  CORE_EXTENSIONS.CUSTOM_IMAGE,\n+  CORE_EXTENSIONS.CALLOUT,\n+  CORE_EXTENSIONS.WORK_ITEM_EMBED,\n+];\n"
        },
        {
          "path": "packages/editor/src/core/extensions/extensions.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/extensions.ts\n===================================================================\n--- packages/editor/src/core/extensions/extensions.ts\tebab5e2 (parent)\n+++ packages/editor/src/core/extensions/extensions.ts\tbd0361d (commit)\n@@ -1,4 +1,5 @@\n+import type { HocuspocusProvider } from \"@hocuspocus/provider\";\n import type { Extensions } from \"@tiptap/core\";\n import { CharacterCount } from \"@tiptap/extension-character-count\";\n import TaskItem from \"@tiptap/extension-task-item\";\n import TaskList from \"@tiptap/extension-task-list\";\n@@ -34,8 +35,9 @@\n import { CustomImageExtension } from \"./custom-image/extension\";\n import { EmojiExtension } from \"./emoji/extension\";\n import { CustomPlaceholderExtension } from \"./placeholder\";\n import { CustomStarterKitExtension } from \"./starter-kit\";\n+import { UniqueID } from \"./unique-id/extension\";\n \n type TArguments = Pick<\n   IEditorProps,\n   | \"disabledExtensions\"\n@@ -48,8 +50,9 @@\n   | \"extendedEditorProps\"\n > & {\n   enableHistory: boolean;\n   editable: boolean;\n+  provider: HocuspocusProvider | undefined;\n };\n \n export const CoreEditorExtensions = (args: TArguments): Extensions => {\n   const {\n@@ -62,8 +65,9 @@\n     placeholder,\n     tabIndex,\n     editable,\n     extendedEditorProps,\n+    provider,\n   } = args;\n \n   const extensions = [\n     CustomStarterKitExtension({\n@@ -118,8 +122,11 @@\n       flaggedExtensions,\n       fileHandler,\n       extendedEditorProps,\n     }),\n+    UniqueID.configure({\n+      provider,\n+    }),\n   ];\n \n   if (!disabledExtensions.includes(\"image\")) {\n     extensions.push(\n"
        },
        {
          "path": "packages/editor/src/core/extensions/unique-id/extension.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/unique-id/extension.ts\n===================================================================\n--- packages/editor/src/core/extensions/unique-id/extension.ts\tebab5e2 (parent)\n+++ packages/editor/src/core/extensions/unique-id/extension.ts\tbd0361d (commit)\n@@ -0,0 +1,136 @@\n+import type { HocuspocusProvider } from \"@hocuspocus/provider\";\n+import { Extension } from \"@tiptap/core\";\n+import type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\n+import type { Transaction } from \"@tiptap/pm/state\";\n+import { v4 as uuidv4 } from \"uuid\";\n+// constants\n+import { CORE_EXTENSIONS, BLOCK_NODE_TYPES } from \"@/constants/extension\";\n+import { ADDITIONAL_BLOCK_NODE_TYPES } from \"@/plane-editor/constants/extensions\";\n+import { createUniqueIDPlugin } from \"./plugin\";\n+import { createIdsForView } from \"./utils\";\n+// plane imports\n+\n+const COMBINED_BLOCK_NODE_TYPES = [...BLOCK_NODE_TYPES, ...ADDITIONAL_BLOCK_NODE_TYPES];\n+export type UniqueIDGenerationContext = {\n+  node: ProseMirrorNode;\n+  pos: number;\n+};\n+export const UniqueIDAttribute = \"id\";\n+export const generateUniqueID = () => uuidv4();\n+\n+export interface UniqueIDOptions {\n+  /**\n+   * The name of the attribute to add the unique ID to.\n+   * @default \"id\"\n+   */\n+  attributeName: string;\n+  /**\n+   * The types of nodes to add unique IDs to.\n+   * @default []\n+   */\n+  types: string[];\n+  /**\n+   * The function that generates the unique ID. By default, a UUID v4 is\n+   * generated. However, you can provide your own function to generate the\n+   * unique ID based on the node type and the position.\n+   */\n+  generateUniqueID: (ctx: UniqueIDGenerationContext) => string;\n+  /**\n+   * Ignore some mutations, for example applied from other users through the collaboration plugin.\n+   *\n+   * @default null\n+   */\n+  filterTransaction: ((transaction: Transaction) => boolean) | null;\n+  /**\n+   * Whether to update the document by adding unique IDs to the nodes. Set this\n+   * property to `false` if the document is in `readonly` mode, is immutable, or\n+   * you don't want it to be modified.\n+   *\n+   * @default true\n+   */\n+  updateDocument: boolean;\n+  /**\n+   * The provider to use for the unique ID generation.\n+   * @default null\n+   */\n+  provider: HocuspocusProvider | undefined;\n+}\n+\n+export const UniqueID = Extension.create<UniqueIDOptions>({\n+  name: CORE_EXTENSIONS.UNIQUE_ID,\n+\n+  // we'll set a very high priority to make sure this runs first\n+  // and is compatible with `appendTransaction` hooks of other extensions\n+  priority: 10000,\n+\n+  addOptions() {\n+    return {\n+      attributeName: \"id\",\n+      types: COMBINED_BLOCK_NODE_TYPES,\n+      generateUniqueID: () => uuidv4(),\n+      filterTransaction: null,\n+      updateDocument: true,\n+      provider: undefined,\n+    };\n+  },\n+\n+  addGlobalAttributes() {\n+    return [\n+      {\n+        types: this.options.types,\n+        attributes: {\n+          [this.options.attributeName]: {\n+            default: null,\n+            parseHTML: (element) => element.getAttribute(`data-${this.options.attributeName}`),\n+            renderHTML: (attributes) => {\n+              if (!attributes[this.options.attributeName]) {\n+                return {};\n+              }\n+\n+              return {\n+                [`data-${this.options.attributeName}`]: attributes[this.options.attributeName],\n+              };\n+            },\n+          },\n+        },\n+      },\n+    ];\n+  },\n+\n+  // check initial content for missing ids\n+  onCreate() {\n+    if (!this.editor.isEditable) {\n+      this.options.updateDocument = false;\n+    }\n+\n+    if (!this.options.updateDocument) {\n+      return;\n+    }\n+\n+    const provider = this.options.provider;\n+\n+    /**\n+     * We need to handle collaboration a bit different here\n+     * because we can't automatically add IDs when the provider is not yet synced\n+     * otherwise we end up with empty paragraphs\n+     */\n+    if (provider) {\n+      // Check if provider is already synced\n+      if (provider.isSynced) {\n+        createIdsForView(this.editor.view, this.options);\n+      }\n+      // If not synced, the listener will be registered in the plugin\n+      // and handled there with proper cleanup\n+    } else {\n+      return createIdsForView(this.editor.view, this.options);\n+    }\n+  },\n+\n+  addProseMirrorPlugins() {\n+    if (!this.options.updateDocument) {\n+      return [];\n+    }\n+\n+    return [createUniqueIDPlugin(this.options)];\n+  },\n+});\n"
        },
        {
          "path": "packages/editor/src/core/extensions/unique-id/plugin.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/unique-id/plugin.ts\n===================================================================\n--- packages/editor/src/core/extensions/unique-id/plugin.ts\tebab5e2 (parent)\n+++ packages/editor/src/core/extensions/unique-id/plugin.ts\tbd0361d (commit)\n@@ -0,0 +1,211 @@\n+import { combineTransactionSteps, findChildrenInRange, findDuplicates, getChangedRanges } from \"@tiptap/core\";\n+import { Fragment, Slice } from \"@tiptap/pm/model\";\n+import type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\n+import { Plugin, PluginKey } from \"@tiptap/pm/state\";\n+import type { Transaction } from \"@tiptap/pm/state\";\n+// types\n+import type { UniqueIDOptions } from \"./extension\";\n+// utils\n+import { createIdsForView } from \"./utils\";\n+\n+export const createUniqueIDPlugin = (options: UniqueIDOptions) => {\n+  let dragSourceElement: Element | null = null;\n+  let transformPasted = false;\n+  let syncHandler: (() => void) | null = null;\n+\n+  return new Plugin({\n+    key: new PluginKey(\"uniqueID\"),\n+    appendTransaction: (transactions, oldState, newState) => {\n+      const hasDocChanges =\n+        transactions.some((transaction) => transaction.docChanged) && !oldState.doc.eq(newState.doc);\n+      const filterTransactions =\n+        options.filterTransaction && transactions.some((tr) => !options.filterTransaction?.(tr));\n+\n+      const isCollabTransaction = transactions.find((tr) => tr.getMeta(\"y-sync$\"));\n+\n+      if (isCollabTransaction) {\n+        return;\n+      }\n+\n+      if (!hasDocChanges || filterTransactions) {\n+        return;\n+      }\n+\n+      const { tr } = newState;\n+\n+      const { types, attributeName, generateUniqueID } = options;\n+      const transform = combineTransactionSteps(oldState.doc, transactions as Transaction[]);\n+\n+      const { mapping } = transform;\n+\n+      // get changed ranges based on the old state\n+      const changes = getChangedRanges(transform);\n+\n+      // Get all IDs from the entire document to check for duplicates globally\n+      const allNodesInDoc: Array<{ node: ProseMirrorNode; pos: number }> = [];\n+      newState.doc.descendants((node, pos) => {\n+        if (types.includes(node.type.name)) {\n+          allNodesInDoc.push({ node, pos });\n+        }\n+      });\n+      const allIds = allNodesInDoc.map(({ node }) => node.attrs[attributeName]).filter((id) => id !== null);\n+      const duplicatedIds = findDuplicates(allIds);\n+\n+      changes.forEach(({ newRange }) => {\n+        const newNodes = findChildrenInRange(newState.doc, newRange, (node) => types.includes(node.type.name));\n+\n+        newNodes.forEach(({ node, pos }) => {\n+          // instead of checking `node.attrs[attributeName]` directly\n+          // we look at the current state of the node within `tr.doc`.\n+          // this helps to prevent adding new ids to the same node\n+          // if the node changed multiple times within one transaction\n+          const id = tr.doc.nodeAt(pos)?.attrs[attributeName];\n+\n+          if (id === null) {\n+            tr.setNodeMarkup(pos, undefined, {\n+              ...node.attrs,\n+              [attributeName]: generateUniqueID({ node, pos }),\n+            });\n+\n+            return;\n+          }\n+\n+          // check if the node doesn't exist in the old state\n+          const { deleted } = mapping.invert().mapResult(pos);\n+\n+          // If this is a new node (didn't exist in old state) and its ID is duplicated in the entire document\n+          const newNode = deleted && duplicatedIds.includes(id);\n+\n+          if (newNode) {\n+            tr.setNodeMarkup(pos, undefined, {\n+              ...node.attrs,\n+              [attributeName]: generateUniqueID({ node, pos }),\n+            });\n+          }\n+        });\n+      });\n+\n+      if (!tr.steps.length) {\n+        return;\n+      }\n+\n+      // `tr.setNodeMarkup` resets the stored marks\n+      // so we'll restore them if they exist\n+      tr.setStoredMarks(newState.tr.storedMarks);\n+\n+      // Don't add ID generation to undo history\n+      tr.setMeta(\"addToHistory\", false);\n+\n+      return tr;\n+    },\n+\n+    // we register a global drag handler to track the current drag source element\n+    view(view) {\n+      const handleDragstart = (event: DragEvent) => {\n+        dragSourceElement = view.dom.parentElement?.contains(event.target as Element) ? view.dom.parentElement : null;\n+      };\n+\n+      window.addEventListener(\"dragstart\", handleDragstart);\n+\n+      // Handle provider sync listener for creating IDs when collaboration provider syncs\n+      const provider = options.provider;\n+      if (provider && !provider.isSynced) {\n+        syncHandler = () => {\n+          createIdsForView(view, options);\n+\n+          // Clean up the listener after it runs\n+          if (provider && syncHandler) {\n+            provider.off(\"synced\", syncHandler);\n+            syncHandler = null;\n+          }\n+        };\n+\n+        provider.on(\"synced\", syncHandler);\n+      }\n+\n+      return {\n+        destroy() {\n+          window.removeEventListener(\"dragstart\", handleDragstart);\n+\n+          // Clean up provider sync listener if it exists\n+          if (provider && syncHandler) {\n+            provider.off(\"synced\", syncHandler);\n+            syncHandler = null;\n+          }\n+        },\n+      };\n+    },\n+\n+    props: {\n+      // `handleDOMEvents` is called before `transformPasted`\n+      // so we can do some checks before\n+      handleDOMEvents: {\n+        // only create new ids for dropped content\n+        // or dropped content while holding `alt`\n+        // or content is dragged from another editor\n+        drop: (view, event) => {\n+          if (dragSourceElement !== view.dom.parentElement || event.dataTransfer?.effectAllowed === \"copy\") {\n+            dragSourceElement = null;\n+            transformPasted = true;\n+          }\n+\n+          return false;\n+        },\n+        // always create new ids on pasted content\n+        paste: () => {\n+          transformPasted = true;\n+\n+          return false;\n+        },\n+      },\n+\n+      // we'll remove ids for every pasted node\n+      // so we can create a new one within `appendTransaction`\n+      transformPasted: (slice) => {\n+        if (!transformPasted) {\n+          return slice;\n+        }\n+\n+        const { types, attributeName } = options;\n+        const removeId = (fragment: Fragment): Fragment => {\n+          const list: ProseMirrorNode[] = [];\n+\n+          fragment.forEach((node) => {\n+            // don't touch text nodes\n+            if (node.isText) {\n+              list.push(node);\n+\n+              return;\n+            }\n+\n+            // check for any other child nodes\n+            if (!types.includes(node.type.name)) {\n+              list.push(node.copy(removeId(node.content)));\n+\n+              return;\n+            }\n+\n+            // remove id\n+            const nodeWithoutId = node.type.create(\n+              {\n+                ...node.attrs,\n+                [attributeName]: null,\n+              },\n+              removeId(node.content),\n+              node.marks\n+            );\n+\n+            list.push(nodeWithoutId);\n+          });\n+\n+          return Fragment.from(list);\n+        };\n+\n+        // reset check\n+        transformPasted = false;\n+\n+        return new Slice(removeId(slice.content), slice.openStart, slice.openEnd);\n+      },\n+    },\n+  });\n+};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/unique-id/utils.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/unique-id/utils.ts\n===================================================================\n--- packages/editor/src/core/extensions/unique-id/utils.ts\tebab5e2 (parent)\n+++ packages/editor/src/core/extensions/unique-id/utils.ts\tbd0361d (commit)\n@@ -0,0 +1,28 @@\n+import { findChildren } from \"@tiptap/core\";\n+import type { EditorView } from \"@tiptap/pm/view\";\n+// types\n+import type { UniqueIDOptions } from \"./extension\";\n+\n+/**\n+ * Utility function to create IDs for nodes that don't have them\n+ */\n+export const createIdsForView = (view: EditorView, options: UniqueIDOptions) => {\n+  const { state } = view;\n+  const { tr, doc } = state;\n+  const { types, attributeName, generateUniqueID } = options;\n+  const nodesWithoutId = findChildren(\n+    doc,\n+    (node) => types.includes(node.type.name) && node.attrs[attributeName] === null\n+  );\n+\n+  nodesWithoutId.forEach(({ node, pos }) => {\n+    tr.setNodeMarkup(pos, undefined, {\n+      ...node.attrs,\n+      [attributeName]: generateUniqueID({ node, pos }),\n+    });\n+  });\n+\n+  tr.setMeta(\"addToHistory\", false);\n+\n+  view.dispatch(tr);\n+};\n"
        },
        {
          "path": "packages/editor/src/core/hooks/use-editor.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/hooks/use-editor.ts\n===================================================================\n--- packages/editor/src/core/hooks/use-editor.ts\tebab5e2 (parent)\n+++ packages/editor/src/core/hooks/use-editor.ts\tbd0361d (commit)\n@@ -38,10 +38,10 @@\n     onChange,\n     onEditorFocus,\n     onTransaction,\n     placeholder,\n-    provider,\n     tabIndex,\n+    provider,\n     value,\n   } = props;\n \n   const editor = useTiptapEditor(\n@@ -68,8 +68,9 @@\n           isTouchDevice,\n           mentionHandler,\n           placeholder,\n           tabIndex,\n+          provider,\n         }),\n         ...extensions,\n       ],\n       content: initialValue,\n"
        },
        {
          "path": "packages/editor/src/core/types/editor.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/types/editor.ts\n===================================================================\n--- packages/editor/src/core/types/editor.ts\tebab5e2 (parent)\n+++ packages/editor/src/core/types/editor.ts\tbd0361d (commit)\n@@ -164,8 +164,9 @@\n   placeholder?: string | ((isFocused: boolean, value: string) => string);\n   tabIndex?: number;\n   value?: string | null;\n   extendedEditorProps: IEditorPropsExtended;\n+  workItemIdentifier?: string | null;\n };\n \n export type ILiteTextEditorProps = IEditorProps;\n \n"
        }
      ]
    },
    {
      "id": "implement-asset-duplication",
      "sha": "83679806fdca211d04c1e2270e40b0da22051e59",
      "parentSha": "d462546055e96efc56b81f44fbd0d0b1398802ae",
      "spec": "Goal: Add an asset duplication feature that allows clients to duplicate an existing uploaded asset to a new asset bound to a workspace/project/entity, and integrate this flow into the web editor so that pasted images from existing assets are duplicated automatically. Implement the following observable behavior and structure.\n\nBackend (Django/DRF):\n- New POST endpoint to duplicate assets\n  - Route: /api/assets/v2/workspaces/{slug}/duplicate-assets/{asset_id}/\n  - Add a view DuplicateAssetEndpoint under apps/api/plane/app/views/asset/v2.py.\n    - Authentication/Authorization: workspace-level; allow member and admin.\n    - Throttling: apply a per-asset throttle class (see below) to limit by asset_id.\n    - Request body:\n      - entity_type: required, must be one of FileAsset.EntityTypeContext values (e.g., ISSUE_ATTACHMENT, ISSUE_DESCRIPTION, COMMENT_DESCRIPTION, PAGE_DESCRIPTION, USER_AVATAR, USER_COVER, WORKSPACE_LOGO, PROJECT_COVER, DRAFT_ISSUE_* etc.).\n      - project_id: optional. If provided, must exist within the workspace.\n      - entity_id: optional. When provided, set appropriate FK field based on entity_type (e.g., issue_id for ISSUE_* types, comment_id for COMMENT_DESCRIPTION, page_id for PAGE_DESCRIPTION, user_id/workspace_id/project_id for the corresponding types).\n    - Behavior:\n      - Validate workspace by slug.\n      - Validate optional project_id is in the workspace when provided.\n      - Locate the original FileAsset by id in the same workspace with is_uploaded=True; if not found, return 404.\n      - Compute a new destination key for the copy, incorporating the workspace id, a generated uuid, and the original asset name (preserve extension), e.g., \"{workspace.id}/{uuid}-{original_name}\".\n      - Create a new FileAsset record with:\n        - attributes: name/type/size copied from original.\n        - asset: new destination key.\n        - size: copied from original.\n        - workspace: current workspace; created_by: current user.\n        - entity_type: from request.\n        - project_id: set if provided.\n        - storage_metadata: copied from original.\n        - set the appropriate entity FK via the entity_type mapping when entity_id is provided.\n      - Use S3Storage.copy_object to copy the object from original.asset to destination key.\n      - Mark the newly created asset as is_uploaded=True (persist).\n      - Response: 200 OK with payload { \"asset_id\": \"<new_uuid>\" }.\n  - Wire the route in apps/api/plane/app/urls/asset.py and expose the view in apps/api/plane/app/views/__init__.py.\n- Throttling configuration\n  - Create AssetRateThrottle (apps/api/plane/throttles/asset.py) extending SimpleRateThrottle with scope \"asset_id\" and cache key derived from view.kwargs[\"asset_id\"] so limits apply per source asset.\n  - Configure DRF settings (apps/api/plane/settings/common.py):\n    - Add DEFAULT_THROTTLE_CLASSES to include AnonRateThrottle.\n    - Add DEFAULT_THROTTLE_RATES entries:\n      - anon: 30/minute\n      - asset_id: 5/minute\n- Storage\n  - Ensure S3Storage (apps/api/plane/settings/storage.py) provides copy_object and existing presign methods; DuplicateAssetEndpoint must use copy_object for in-bucket duplication.\n\nWeb app (editor integration):\n- File service and store\n  - Extend FileService (apps/web/core/services/file.service.ts) with duplicateAsset(workspaceSlug, assetId, { entity_type, entity_id?, project_id? }) making a POST call to the new endpoint and returning { asset_id }.\n  - Extend EditorAssetStore (apps/web/core/store/editor/asset.store.ts) to add duplicateEditorAsset wrapper calling FileService. Expose via the existing hook (useEditorAsset), and import EFileAssetType where needed.\n- Editor file handler interface\n  - Extend the editor TFileHandler type (packages/editor/src/core/types/config.ts) to include duplicate(assetId: string) => Promise<string>.\n  - Update useEditorConfig (apps/web/core/hooks/editor/use-editor-config.ts) so getEditorFileHandlers accepts duplicateFile in args and returns it on the duplicate property of the fileHandler.\n- Pass duplicate handlers from containers\n  - Update callers that instantiate editor file handlers to provide duplicate:\n    - Page details page: pass duplicateEditorAsset (entityType PAGE_DESCRIPTION).\n    - Rich text description editors (issue modal, inbox create, generic description input): pass duplicateEditorAsset with appropriate entityType (ISSUE_DESCRIPTION, DRAFT_ISSUE_DESCRIPTION when applicable) and project/workspace context; propagate asset_id to any relevant onAssetUpload handlers.\n    - Comments (create/edit): expose a duplicateCommentAsset operation that calls duplicateEditorAsset with entityType COMMENT_DESCRIPTION and optional commentId; wire through components.\n    - Sticky editor: provide a no-op duplicateFile implementation where duplication is not applicable.\n    - Space app (sites): provide a duplicate handler that simply resolves to the same assetId (duplication unsupported).\n- Custom Image extension behavior\n  - Types: introduce ECustomImageStatus with states PENDING, UPLOADING, UPLOADED, DUPLICATING, DUPLICATION_FAILED; add STATUS to TCustomImageAttributes default and node attributes.\n  - Extension options: in CustomImageExtension (packages/editor/src/core/extensions/custom-image/extension.tsx) expose duplicateImage on options based on fileHandler.duplicate; initialize inserted images with id and status=PENDING.\n  - Uploader: when starting an upload, set status=UPLOADING; once completed, set status=UPLOADED.\n  - Node view logic: when node attrs indicate status=DUPLICATING and duplicateImage is available with a valid src (existing asset id), trigger duplicateImage(src). On success, update node attrs with the new asset id as src and status=UPLOADED. On failure, set status=DUPLICATION_FAILED and render a retry affordance that sets status back to DUPLICATING on click.\n  - Block rendering: treat DUPLICATING as a loading state—suppress toolbar/resizer and upload status while duplicating; show loader; do not consider the node fully ready until status transitions to UPLOADED or DUPLICATION_FAILED.\n- Paste flow\n  - Add a ProseMirror plugin (packages/editor/src/core/plugins/paste-asset.ts) that intercepts handlePaste:\n    - If clipboard contains text/html and is not already marked as processed, scan the HTML for editor-specific asset components (currently image-component elements).\n    - For any such elements with non-HTTP src values, mutate the HTML by assigning a new UUID id and setting status=\"duplicating\" on the component tag to signal async duplication.\n    - Mark the HTML as processed (e.g., via a data attribute) to avoid recursion and redispatch the paste event with modified HTML (preserving the text/plain payload).\n  - Include this plugin in the editor utility extension stack (packages/editor/src/core/extensions/utility.ts) alongside existing plugins.\n  - Remove any broad transformPastedHTML logic that previously stripped <img> tags; the new plugin governs asset paste handling.\n\nTypes and API surface:\n- Ensure places importing EFileAssetType import it from shared types, and newly typed interfaces reflect duplicate operations (e.g., TCommentsOperations gains duplicateCommentAsset, returning { asset_id }).\n\nUser-visible behavior:\n- Pasting previously uploaded images (from within the app) into an editor should duplicate the underlying asset in the current workspace/project context and update the node once duplication completes.\n- Attempting to duplicate the same source asset rapidly should be limited (per-asset throttle), returning standard 429 responses when exceeded.\n- On duplication failure, the image node shows an error state with a retry action (when editable).\n- Where duplication is not supported (e.g., in the sites/space app), duplication falls back to returning the same asset id without error.",
      "prompt": "Add an end-to-end asset duplication capability. Provide a new authenticated workspace-level API that duplicates an existing uploaded asset to a new asset using the same bucket and returns the new asset id. Apply a per-asset rate limit to prevent rapid repeated duplication of the same source. Then integrate duplication into the web editor so that when a user pastes content containing an image from an existing asset, the editor marks it for duplication, calls the API to duplicate it, and updates the node to point to the new asset. Show a retry option on failure, and hide image tools while duplication is in progress. Expose a generic duplicate(assetId) handler through the editor’s file handler interface, wire it into the various editor containers (issues, comments, pages, sticky notes where applicable), and implement a no-op duplicate in the sites app where duplication is unsupported. Keep existing upload behavior and progress tracking intact.",
      "supplementalFiles": [
        "apps/api/plane/settings/storage.py",
        "apps/api/plane/app/views/base.py",
        "apps/api/plane/api/serializers/asset.py",
        "apps/api/plane/db/models/asset.py",
        "apps/web/core/hooks/store/use-editor-asset.ts",
        "apps/web/core/store/root.store.ts",
        "packages/types/src/file.ts",
        "packages/types/src/enums.ts",
        "packages/editor/src/core/plugins/drop.ts",
        "packages/constants/src/index.ts"
      ],
      "fileDiffs": [
        {
          "path": "apps/api/plane/app/urls/asset.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/urls/asset.py\n===================================================================\n--- apps/api/plane/app/urls/asset.py\td462546 (parent)\n+++ apps/api/plane/app/urls/asset.py\t8367980 (commit)\n@@ -12,8 +12,9 @@\n     AssetRestoreEndpoint,\n     ProjectAssetEndpoint,\n     ProjectBulkAssetEndpoint,\n     AssetCheckEndpoint,\n+    DuplicateAssetEndpoint,\n     WorkspaceAssetDownloadEndpoint,\n     ProjectAssetDownloadEndpoint,\n )\n \n@@ -91,8 +92,13 @@\n         AssetCheckEndpoint.as_view(),\n         name=\"asset-check\",\n     ),\n     path(\n+        \"assets/v2/workspaces/<str:slug>/duplicate-assets/<uuid:asset_id>/\",\n+        DuplicateAssetEndpoint.as_view(),\n+        name=\"duplicate-assets\",\n+    ),\n+    path(\n         \"assets/v2/workspaces/<str:slug>/download/<uuid:asset_id>/\",\n         WorkspaceAssetDownloadEndpoint.as_view(),\n         name=\"workspace-asset-download\",\n     ),\n"
        },
        {
          "path": "apps/api/plane/app/views/__init__.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/__init__.py\n===================================================================\n--- apps/api/plane/app/views/__init__.py\td462546 (parent)\n+++ apps/api/plane/app/views/__init__.py\t8367980 (commit)\n@@ -106,8 +106,9 @@\n     AssetRestoreEndpoint,\n     ProjectAssetEndpoint,\n     ProjectBulkAssetEndpoint,\n     AssetCheckEndpoint,\n+    DuplicateAssetEndpoint,\n     WorkspaceAssetDownloadEndpoint,\n     ProjectAssetDownloadEndpoint,\n )\n from .issue.base import (\n"
        },
        {
          "path": "apps/api/plane/app/views/asset/v2.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/asset/v2.py\n===================================================================\n--- apps/api/plane/app/views/asset/v2.py\td462546 (parent)\n+++ apps/api/plane/app/views/asset/v2.py\t8367980 (commit)\n@@ -18,8 +18,9 @@\n from plane.settings.storage import S3Storage\n from plane.app.permissions import allow_permission, ROLE\n from plane.utils.cache import invalidate_cache_directly\n from plane.bgtasks.storage_metadata_task import get_asset_object_metadata\n+from plane.throttles.asset import AssetRateThrottle\n \n \n class UserAssetsV2Endpoint(BaseAPIView):\n     \"\"\"This endpoint is used to upload user profile images.\"\"\"\n@@ -43,10 +44,12 @@\n                 self.asset_delete(user.avatar_asset_id)\n             # Save the new avatar\n             user.avatar_asset_id = asset_id\n             user.save()\n-            invalidate_cache_directly(path=\"/api/users/me/\", url_params=False, user=True, request=request)\n             invalidate_cache_directly(\n+                path=\"/api/users/me/\", url_params=False, user=True, request=request\n+            )\n+            invalidate_cache_directly(\n                 path=\"/api/users/me/settings/\",\n                 url_params=False,\n                 user=True,\n                 request=request,\n@@ -61,10 +64,12 @@\n                 self.asset_delete(user.cover_image_asset_id)\n             # Save the new cover image\n             user.cover_image_asset_id = asset_id\n             user.save()\n-            invalidate_cache_directly(path=\"/api/users/me/\", url_params=False, user=True, request=request)\n             invalidate_cache_directly(\n+                path=\"/api/users/me/\", url_params=False, user=True, request=request\n+            )\n+            invalidate_cache_directly(\n                 path=\"/api/users/me/settings/\",\n                 url_params=False,\n                 user=True,\n                 request=request,\n@@ -77,10 +82,12 @@\n         if entity_type == FileAsset.EntityTypeContext.USER_AVATAR:\n             user = User.objects.get(id=asset.user_id)\n             user.avatar_asset_id = None\n             user.save()\n-            invalidate_cache_directly(path=\"/api/users/me/\", url_params=False, user=True, request=request)\n             invalidate_cache_directly(\n+                path=\"/api/users/me/\", url_params=False, user=True, request=request\n+            )\n+            invalidate_cache_directly(\n                 path=\"/api/users/me/settings/\",\n                 url_params=False,\n                 user=True,\n                 request=request,\n@@ -90,10 +97,12 @@\n         if entity_type == FileAsset.EntityTypeContext.USER_COVER:\n             user = User.objects.get(id=asset.user_id)\n             user.cover_image_asset_id = None\n             user.save()\n-            invalidate_cache_directly(path=\"/api/users/me/\", url_params=False, user=True, request=request)\n             invalidate_cache_directly(\n+                path=\"/api/users/me/\", url_params=False, user=True, request=request\n+            )\n+            invalidate_cache_directly(\n                 path=\"/api/users/me/settings/\",\n                 url_params=False,\n                 user=True,\n                 request=request,\n@@ -150,9 +159,11 @@\n \n         # Get the presigned URL\n         storage = S3Storage(request=request)\n         # Generate a presigned URL to share an S3 object\n-        presigned_url = storage.generate_presigned_post(object_name=asset_key, file_type=type, file_size=size_limit)\n+        presigned_url = storage.generate_presigned_post(\n+            object_name=asset_key, file_type=type, file_size=size_limit\n+        )\n         # Return the presigned URL\n         return Response(\n             {\n                 \"upload_data\": presigned_url,\n@@ -187,9 +198,11 @@\n         asset = FileAsset.objects.get(id=asset_id, user_id=request.user.id)\n         asset.is_deleted = True\n         asset.deleted_at = timezone.now()\n         # get the entity and save the asset id for the request field\n-        self.entity_asset_delete(entity_type=asset.entity_type, asset=asset, request=request)\n+        self.entity_asset_delete(\n+            entity_type=asset.entity_type, asset=asset, request=request\n+        )\n         asset.save(update_fields=[\"is_deleted\", \"deleted_at\"])\n         return Response(status=status.HTTP_204_NO_CONTENT)\n \n \n@@ -251,16 +264,20 @@\n             # Save the new logo\n             workspace.logo = \"\"\n             workspace.logo_asset_id = asset_id\n             workspace.save()\n-            invalidate_cache_directly(path=\"/api/workspaces/\", url_params=False, user=False, request=request)\n             invalidate_cache_directly(\n+                path=\"/api/workspaces/\", url_params=False, user=False, request=request\n+            )\n+            invalidate_cache_directly(\n                 path=\"/api/users/me/workspaces/\",\n                 url_params=False,\n                 user=True,\n                 request=request,\n             )\n-            invalidate_cache_directly(path=\"/api/instances/\", url_params=False, user=False, request=request)\n+            invalidate_cache_directly(\n+                path=\"/api/instances/\", url_params=False, user=False, request=request\n+            )\n             return\n \n         # Project Cover\n         elif entity_type == FileAsset.EntityTypeContext.PROJECT_COVER:\n@@ -285,16 +302,20 @@\n             if workspace is None:\n                 return\n             workspace.logo_asset_id = None\n             workspace.save()\n-            invalidate_cache_directly(path=\"/api/workspaces/\", url_params=False, user=False, request=request)\n             invalidate_cache_directly(\n+                path=\"/api/workspaces/\", url_params=False, user=False, request=request\n+            )\n+            invalidate_cache_directly(\n                 path=\"/api/users/me/workspaces/\",\n                 url_params=False,\n                 user=True,\n                 request=request,\n             )\n-            invalidate_cache_directly(path=\"/api/instances/\", url_params=False, user=False, request=request)\n+            invalidate_cache_directly(\n+                path=\"/api/instances/\", url_params=False, user=False, request=request\n+            )\n             return\n         # Project Cover\n         elif entity_type == FileAsset.EntityTypeContext.PROJECT_COVER:\n             project = Project.objects.filter(id=asset.project_id).first()\n@@ -353,15 +374,19 @@\n             size=size_limit,\n             workspace=workspace,\n             created_by=request.user,\n             entity_type=entity_type,\n-            **self.get_entity_id_field(entity_type=entity_type, entity_id=entity_identifier),\n+            **self.get_entity_id_field(\n+                entity_type=entity_type, entity_id=entity_identifier\n+            ),\n         )\n \n         # Get the presigned URL\n         storage = S3Storage(request=request)\n         # Generate a presigned URL to share an S3 object\n-        presigned_url = storage.generate_presigned_post(object_name=asset_key, file_type=type, file_size=size_limit)\n+        presigned_url = storage.generate_presigned_post(\n+            object_name=asset_key, file_type=type, file_size=size_limit\n+        )\n         # Return the presigned URL\n         return Response(\n             {\n                 \"upload_data\": presigned_url,\n@@ -396,9 +421,11 @@\n         asset = FileAsset.objects.get(id=asset_id, workspace__slug=slug)\n         asset.is_deleted = True\n         asset.deleted_at = timezone.now()\n         # get the entity and save the asset id for the request field\n-        self.entity_asset_delete(entity_type=asset.entity_type, asset=asset, request=request)\n+        self.entity_asset_delete(\n+            entity_type=asset.entity_type, asset=asset, request=request\n+        )\n         asset.save(update_fields=[\"is_deleted\", \"deleted_at\"])\n         return Response(status=status.HTTP_204_NO_CONTENT)\n \n     def get(self, request, slug, asset_id):\n@@ -559,9 +586,11 @@\n \n         # Get the presigned URL\n         storage = S3Storage(request=request)\n         # Generate a presigned URL to share an S3 object\n-        presigned_url = storage.generate_presigned_post(object_name=asset_key, file_type=type, file_size=size_limit)\n+        presigned_url = storage.generate_presigned_post(\n+            object_name=asset_key, file_type=type, file_size=size_limit\n+        )\n         # Return the presigned URL\n         return Response(\n             {\n                 \"upload_data\": presigned_url,\n@@ -589,9 +618,11 @@\n \n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n     def delete(self, request, slug, project_id, pk):\n         # Get the asset\n-        asset = FileAsset.objects.get(id=pk, workspace__slug=slug, project_id=project_id)\n+        asset = FileAsset.objects.get(\n+            id=pk, workspace__slug=slug, project_id=project_id\n+        )\n         # Check deleted assets\n         asset.is_deleted = True\n         asset.deleted_at = timezone.now()\n         # Save the asset\n@@ -600,9 +631,11 @@\n \n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n     def get(self, request, slug, project_id, pk):\n         # get the asset id\n-        asset = FileAsset.objects.get(workspace__slug=slug, project_id=project_id, pk=pk)\n+        asset = FileAsset.objects.get(\n+            workspace__slug=slug, project_id=project_id, pk=pk\n+        )\n \n         # Check if the asset is uploaded\n         if not asset.is_uploaded:\n             return Response(\n@@ -633,9 +666,11 @@\n         asset_ids = request.data.get(\"asset_ids\", [])\n \n         # Check if the asset ids are provided\n         if not asset_ids:\n-            return Response({\"error\": \"No asset ids provided.\"}, status=status.HTTP_400_BAD_REQUEST)\n+            return Response(\n+                {\"error\": \"No asset ids provided.\"}, status=status.HTTP_400_BAD_REQUEST\n+            )\n \n         # get the asset id\n         assets = FileAsset.objects.filter(id__in=asset_ids, workspace__slug=slug)\n \n@@ -687,12 +722,112 @@\n     \"\"\"Endpoint to check if an asset exists.\"\"\"\n \n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST], level=\"WORKSPACE\")\n     def get(self, request, slug, asset_id):\n-        asset = FileAsset.all_objects.filter(id=asset_id, workspace__slug=slug, deleted_at__isnull=True).exists()\n+        asset = FileAsset.all_objects.filter(\n+            id=asset_id, workspace__slug=slug, deleted_at__isnull=True\n+        ).exists()\n         return Response({\"exists\": asset}, status=status.HTTP_200_OK)\n \n \n+class DuplicateAssetEndpoint(BaseAPIView):\n+\n+    throttle_classes = [AssetRateThrottle]\n+\n+    def get_entity_id_field(self, entity_type, entity_id):\n+        # Workspace Logo\n+        if entity_type == FileAsset.EntityTypeContext.WORKSPACE_LOGO:\n+            return {\"workspace_id\": entity_id}\n+\n+        # Project Cover\n+        if entity_type == FileAsset.EntityTypeContext.PROJECT_COVER:\n+            return {\"project_id\": entity_id}\n+\n+        # User Avatar and Cover\n+        if entity_type in [\n+            FileAsset.EntityTypeContext.USER_AVATAR,\n+            FileAsset.EntityTypeContext.USER_COVER,\n+        ]:\n+            return {\"user_id\": entity_id}\n+\n+        # Issue Attachment and Description\n+        if entity_type in [\n+            FileAsset.EntityTypeContext.ISSUE_ATTACHMENT,\n+            FileAsset.EntityTypeContext.ISSUE_DESCRIPTION,\n+        ]:\n+            return {\"issue_id\": entity_id}\n+\n+        # Page Description\n+        if entity_type == FileAsset.EntityTypeContext.PAGE_DESCRIPTION:\n+            return {\"page_id\": entity_id}\n+\n+        # Comment Description\n+        if entity_type == FileAsset.EntityTypeContext.COMMENT_DESCRIPTION:\n+            return {\"comment_id\": entity_id}\n+\n+        return {}\n+\n+    @allow_permission([ROLE.ADMIN, ROLE.MEMBER], level=\"WORKSPACE\")\n+    def post(self, request, slug, asset_id):\n+        project_id = request.data.get(\"project_id\", None)\n+        entity_id = request.data.get(\"entity_id\", None)\n+        entity_type = request.data.get(\"entity_type\", None)\n+\n+\n+        if (\n+            not entity_type\n+            or entity_type not in FileAsset.EntityTypeContext.values\n+        ):\n+            return Response(\n+                {\"error\": \"Invalid entity type or entity id\"},\n+                status=status.HTTP_400_BAD_REQUEST,\n+            )\n+\n+        workspace = Workspace.objects.get(slug=slug)\n+        if project_id:\n+            # check if project exists in the workspace\n+            if not Project.objects.filter(id=project_id, workspace=workspace).exists():\n+                return Response(\n+                    {\"error\": \"Project not found\"}, status=status.HTTP_404_NOT_FOUND\n+                )\n+\n+        storage = S3Storage(request=request)\n+        original_asset = FileAsset.objects.filter(\n+            workspace=workspace, id=asset_id, is_uploaded=True\n+        ).first()\n+\n+        if not original_asset:\n+            return Response(\n+                {\"error\": \"Asset not found\"}, status=status.HTTP_404_NOT_FOUND\n+            )\n+\n+        destination_key = (\n+            f\"{workspace.id}/{uuid.uuid4().hex}-{original_asset.attributes.get('name')}\"\n+        )\n+        duplicated_asset = FileAsset.objects.create(\n+            attributes={\n+                \"name\": original_asset.attributes.get(\"name\"),\n+                \"type\": original_asset.attributes.get(\"type\"),\n+                \"size\": original_asset.attributes.get(\"size\"),\n+            },\n+            asset=destination_key,\n+            size=original_asset.size,\n+            workspace=workspace,\n+            created_by_id=request.user.id,\n+            entity_type=entity_type,\n+            project_id=project_id if project_id else None,\n+            storage_metadata=original_asset.storage_metadata,\n+            **self.get_entity_id_field(entity_type=entity_type, entity_id=entity_id),\n+        )\n+        storage.copy_object(original_asset.asset, destination_key)\n+        # Update the is_uploaded field for all newly created assets\n+        FileAsset.objects.filter(id=duplicated_asset.id).update(is_uploaded=True)\n+\n+        return Response(\n+            {\"asset_id\": str(duplicated_asset.id)}, status=status.HTTP_200_OK\n+        )\n+\n+\n class WorkspaceAssetDownloadEndpoint(BaseAPIView):\n     \"\"\"Endpoint to generate a download link for an asset with content-disposition=attachment.\"\"\"\n \n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST], level=\"WORKSPACE\")\n"
        },
        {
          "path": "apps/api/plane/settings/common.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/settings/common.py\n===================================================================\n--- apps/api/plane/settings/common.py\td462546 (parent)\n+++ apps/api/plane/settings/common.py\t8367980 (commit)\n@@ -68,9 +68,16 @@\n ]\n \n # Rest Framework settings\n REST_FRAMEWORK = {\n-    \"DEFAULT_AUTHENTICATION_CLASSES\": (\"rest_framework.authentication.SessionAuthentication\",),\n+    \"DEFAULT_AUTHENTICATION_CLASSES\": (\n+        \"rest_framework.authentication.SessionAuthentication\",\n+    ),\n+    \"DEFAULT_THROTTLE_CLASSES\": (\"rest_framework.throttling.AnonRateThrottle\",),\n+    \"DEFAULT_THROTTLE_RATES\": {\n+        \"anon\": \"30/minute\",\n+        \"asset_id\": \"5/minute\",\n+    },\n     \"DEFAULT_PERMISSION_CLASSES\": (\"rest_framework.permissions.IsAuthenticated\",),\n     \"DEFAULT_RENDERER_CLASSES\": (\"rest_framework.renderers.JSONRenderer\",),\n     \"DEFAULT_FILTER_BACKENDS\": (\"django_filters.rest_framework.DjangoFilterBackend\",),\n     \"EXCEPTION_HANDLER\": \"plane.authentication.adapter.exception.auth_exception_handler\",\n"
        },
        {
          "path": "apps/api/plane/throttles/asset.py",
          "status": "added",
          "diff": "Index: apps/api/plane/throttles/asset.py\n===================================================================\n--- apps/api/plane/throttles/asset.py\td462546 (parent)\n+++ apps/api/plane/throttles/asset.py\t8367980 (commit)\n@@ -0,0 +1,11 @@\n+from rest_framework.throttling import SimpleRateThrottle\n+\n+\n+class AssetRateThrottle(SimpleRateThrottle):\n+    scope = \"asset_id\"\n+\n+    def get_cache_key(self, request, view):\n+        asset_id = view.kwargs.get(\"asset_id\")\n+        if not asset_id:\n+            return None\n+        return f\"throttle_asset_{asset_id}\"\n"
        },
        {
          "path": "apps/space/helpers/editor.helper.ts",
          "status": "modified",
          "diff": "Index: apps/space/helpers/editor.helper.ts\n===================================================================\n--- apps/space/helpers/editor.helper.ts\td462546 (parent)\n+++ apps/space/helpers/editor.helper.ts\t8367980 (commit)\n@@ -57,8 +57,12 @@\n       } else {\n         await sitesFileService.restoreNewAsset(anchor, src);\n       }\n     },\n+    duplicate: async (assetId: string) =>\n+      // Duplication is not supported for sites/space app\n+      // Return the same assetId as a fallback\n+      assetId,\n     validation: {\n       maxFileSize: MAX_FILE_SIZE,\n     },\n   };\n"
        },
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/[pageId]/page.tsx",
          "status": "modified",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/[pageId]/page.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/[pageId]/page.tsx\td462546 (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/[pageId]/page.tsx\t8367980 (commit)\n@@ -45,9 +45,9 @@\n     pageId,\n     storeType,\n   });\n   const { getWorkspaceBySlug } = useWorkspace();\n-  const { uploadEditorAsset } = useEditorAsset();\n+  const { uploadEditorAsset, duplicateEditorAsset } = useEditorAsset();\n   // derived values\n   const workspaceId = workspaceSlug ? (getWorkspaceBySlug(workspaceSlug)?.id ?? \"\") : \"\";\n   const { canCurrentUserAccessPage, id, name, updateDescription } = page ?? {};\n   // entity search handler\n@@ -114,13 +114,23 @@\n             workspaceSlug,\n           });\n           return asset_id;\n         },\n+        duplicateFile: async (assetId: string) => {\n+          const { asset_id } = await duplicateEditorAsset({\n+            assetId,\n+            entityId: id,\n+            entityType: EFileAssetType.PAGE_DESCRIPTION,\n+            projectId,\n+            workspaceSlug,\n+          });\n+          return asset_id;\n+        },\n         workspaceId,\n         workspaceSlug,\n       }),\n     }),\n-    [getEditorFileHandlers, id, uploadEditorAsset, projectId, workspaceId, workspaceSlug]\n+    [getEditorFileHandlers, projectId, workspaceId, workspaceSlug, uploadEditorAsset, id, duplicateEditorAsset]\n   );\n \n   const webhookConnectionParams: TWebhookConnectionQueryParams = useMemo(\n     () => ({\n"
        },
        {
          "path": "apps/web/core/components/comments/card/edit-form.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/comments/card/edit-form.tsx\n===================================================================\n--- apps/web/core/components/comments/card/edit-form.tsx\td462546 (parent)\n+++ apps/web/core/components/comments/card/edit-form.tsx\t8367980 (commit)\n@@ -93,8 +93,12 @@\n           uploadFile={async (blockId, file) => {\n             const { asset_id } = await activityOperations.uploadCommentAsset(blockId, file, comment.id);\n             return asset_id;\n           }}\n+          duplicateFile={async (assetId: string) => {\n+            const { asset_id } = await activityOperations.duplicateCommentAsset(assetId, comment.id);\n+            return asset_id;\n+          }}\n           projectId={projectId}\n           parentClassName=\"p-2\"\n           displayConfig={{\n             fontSize: \"small-font\",\n"
        },
        {
          "path": "apps/web/core/components/comments/comment-create.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/comments/comment-create.tsx\n===================================================================\n--- apps/web/core/components/comments/comment-create.tsx\td462546 (parent)\n+++ apps/web/core/components/comments/comment-create.tsx\t8367980 (commit)\n@@ -132,8 +132,13 @@\n                   const { asset_id } = await activityOperations.uploadCommentAsset(blockId, file);\n                   setUploadedAssetIds((prev) => [...prev, asset_id]);\n                   return asset_id;\n                 }}\n+                duplicateFile={async (assetId: string) => {\n+                  const { asset_id } = await activityOperations.duplicateCommentAsset(assetId);\n+                  setUploadedAssetIds((prev) => [...prev, asset_id]);\n+                  return asset_id;\n+                }}\n                 showToolbarInitially={showToolbarInitially}\n                 parentClassName=\"p-2\"\n                 displayConfig={{\n                   fontSize: \"small-font\",\n"
        },
        {
          "path": "apps/web/core/components/editor/document/editor.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/editor/document/editor.tsx\n===================================================================\n--- apps/web/core/components/editor/document/editor.tsx\td462546 (parent)\n+++ apps/web/core/components/editor/document/editor.tsx\t8367980 (commit)\n@@ -28,8 +28,9 @@\n     | {\n         editable: true;\n         searchMentionCallback: (payload: TSearchEntityRequestPayload) => Promise<TSearchResponse>;\n         uploadFile: TFileHandler[\"upload\"];\n+        duplicateFile: TFileHandler[\"duplicate\"];\n       }\n   );\n \n export const DocumentEditor = forwardRef<EditorRefApi, DocumentEditorWrapperProps>((props, ref) => {\n@@ -70,8 +71,9 @@\n       flaggedExtensions={documentEditorExtensions.flagged}\n       fileHandler={getEditorFileHandlers({\n         projectId,\n         uploadFile: editable ? props.uploadFile : async () => \"\",\n+        duplicateFile: editable ? props.duplicateFile : async () => \"\",\n         workspaceId,\n         workspaceSlug,\n       })}\n       getEditorMetaData={getEditorMetaData}\n"
        },
        {
          "path": "apps/web/core/components/editor/lite-text/editor.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/editor/lite-text/editor.tsx\n===================================================================\n--- apps/web/core/components/editor/lite-text/editor.tsx\td462546 (parent)\n+++ apps/web/core/components/editor/lite-text/editor.tsx\t8367980 (commit)\n@@ -44,8 +44,9 @@\n       }\n     | {\n         editable: true;\n         uploadFile: TFileHandler[\"upload\"];\n+        duplicateFile: TFileHandler[\"duplicate\"];\n       }\n   );\n \n export const LiteTextEditor = React.forwardRef<EditorRefApi, LiteTextEditorWrapperProps>((props, ref) => {\n@@ -126,8 +127,9 @@\n             flaggedExtensions={liteTextEditorExtensions.flagged}\n             fileHandler={getEditorFileHandlers({\n               projectId,\n               uploadFile: editable ? props.uploadFile : async () => \"\",\n+              duplicateFile: editable ? props.duplicateFile : async () => \"\",\n               workspaceId,\n               workspaceSlug,\n             })}\n             getEditorMetaData={getEditorMetaData}\n"
        },
        {
          "path": "apps/web/core/components/editor/rich-text/description-input/root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/editor/rich-text/description-input/root.tsx\n===================================================================\n--- apps/web/core/components/editor/rich-text/description-input/root.tsx\td462546 (parent)\n+++ apps/web/core/components/editor/rich-text/description-input/root.tsx\t8367980 (commit)\n@@ -114,9 +114,9 @@\n   // ref to track if there are unsaved changes\n   const hasUnsavedChanges = useRef(false);\n   // store hooks\n   const { getWorkspaceBySlug } = useWorkspace();\n-  const { uploadEditorAsset } = useEditorAsset();\n+  const { uploadEditorAsset, duplicateEditorAsset } = useEditorAsset();\n   // derived values\n   const workspaceDetails = getWorkspaceBySlug(workspaceSlug);\n   // translation\n   const { t } = useTranslation();\n@@ -239,8 +239,21 @@\n                   console.log(\"Error in uploading asset:\", error);\n                   throw new Error(\"Asset upload failed. Please try again later.\");\n                 }\n               }}\n+              duplicateFile={async (assetId: string) => {\n+                try {\n+                  const { asset_id } = await duplicateEditorAsset({\n+                    assetId,\n+                    entityType: fileAssetType,\n+                    projectId,\n+                    workspaceSlug,\n+                  });\n+                  return asset_id;\n+                } catch {\n+                  throw new Error(\"Asset duplication failed. Please try again later.\");\n+                }\n+              }}\n             />\n           )}\n         />\n       ) : (\n"
        },
        {
          "path": "apps/web/core/components/editor/rich-text/editor.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/editor/rich-text/editor.tsx\n===================================================================\n--- apps/web/core/components/editor/rich-text/editor.tsx\td462546 (parent)\n+++ apps/web/core/components/editor/rich-text/editor.tsx\t8367980 (commit)\n@@ -28,8 +28,9 @@\n     | {\n         editable: true;\n         searchMentionCallback: (payload: TSearchEntityRequestPayload) => Promise<TSearchResponse>;\n         uploadFile: TFileHandler[\"upload\"];\n+        duplicateFile: TFileHandler[\"duplicate\"];\n       }\n   );\n \n export const RichTextEditor = forwardRef<EditorRefApi, RichTextEditorWrapperProps>((props, ref) => {\n@@ -68,8 +69,9 @@\n       flaggedExtensions={richTextEditorExtensions.flagged}\n       fileHandler={getEditorFileHandlers({\n         projectId,\n         uploadFile: editable ? props.uploadFile : async () => \"\",\n+        duplicateFile: editable ? props.duplicateFile : async () => \"\",\n         workspaceId,\n         workspaceSlug,\n       })}\n       getEditorMetaData={getEditorMetaData}\n"
        },
        {
          "path": "apps/web/core/components/editor/sticky-editor/editor.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/editor/sticky-editor/editor.tsx\n===================================================================\n--- apps/web/core/components/editor/sticky-editor/editor.tsx\td462546 (parent)\n+++ apps/web/core/components/editor/sticky-editor/editor.tsx\t8367980 (commit)\n@@ -30,8 +30,9 @@\n   isSubmitting?: boolean;\n   showToolbarInitially?: boolean;\n   showToolbar?: boolean;\n   uploadFile: TFileHandler[\"upload\"];\n+  duplicateFile: TFileHandler[\"duplicate\"];\n   parentClassName?: string;\n   handleColorChange: (data: Partial<TSticky>) => Promise<void>;\n   handleDelete: () => void;\n }\n@@ -47,8 +48,9 @@\n     showToolbarInitially = true,\n     showToolbar = true,\n     parentClassName = \"\",\n     uploadFile,\n+    duplicateFile,\n     ...rest\n   } = props;\n   // states\n   const [isFocused, setIsFocused] = useState(showToolbarInitially);\n@@ -82,8 +84,9 @@\n         editable\n         fileHandler={getEditorFileHandlers({\n           projectId,\n           uploadFile,\n+          duplicateFile,\n           workspaceId,\n           workspaceSlug,\n         })}\n         getEditorMetaData={getEditorMetaData}\n"
        },
        {
          "path": "apps/web/core/components/inbox/modals/create-modal/issue-description.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/inbox/modals/create-modal/issue-description.tsx\n===================================================================\n--- apps/web/core/components/inbox/modals/create-modal/issue-description.tsx\td462546 (parent)\n+++ apps/web/core/components/inbox/modals/create-modal/issue-description.tsx\t8367980 (commit)\n@@ -48,9 +48,9 @@\n   } = props;\n   // i18n\n   const { t } = useTranslation();\n   // store hooks\n-  const { uploadEditorAsset } = useEditorAsset();\n+  const { uploadEditorAsset, duplicateEditorAsset } = useEditorAsset();\n   const { loader } = useProjectInbox();\n   const { isMobile } = usePlatformOS();\n \n   const { getIndex } = getTabIndex(ETabIndices.INTAKE_ISSUE_FORM, isMobile);\n@@ -101,7 +101,21 @@\n           console.log(\"Error in uploading work item asset:\", error);\n           throw new Error(\"Asset upload failed. Please try again later.\");\n         }\n       }}\n+      duplicateFile={async (assetId: string) => {\n+        try {\n+          const { asset_id } = await duplicateEditorAsset({\n+            assetId,\n+            entityType: EFileAssetType.ISSUE_DESCRIPTION,\n+            projectId,\n+            workspaceSlug,\n+          });\n+          onAssetUpload?.(asset_id);\n+          return asset_id;\n+        } catch {\n+          throw new Error(\"Asset duplication failed. Please try again later.\");\n+        }\n+      }}\n     />\n   );\n });\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-detail/issue-activity/helper.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-detail/issue-activity/helper.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-detail/issue-activity/helper.tsx\td462546 (parent)\n+++ apps/web/core/components/issues/issue-detail/issue-activity/helper.tsx\t8367980 (commit)\n@@ -26,9 +26,9 @@\n     issue: { getIssueById },\n   } = useIssueDetail();\n   const { getProjectById } = useProject();\n   const { getUserDetails } = useMember();\n-  const { uploadEditorAsset } = useEditorAsset();\n+  const { uploadEditorAsset, duplicateEditorAsset } = useEditorAsset();\n   const { data: currentUser } = useUser();\n   // derived values\n   const issueDetails = issueId ? getIssueById(issueId) : undefined;\n   const projectDetails = projectId ? getProjectById(projectId) : undefined;\n@@ -135,8 +135,23 @@\n           console.log(\"Error in uploading comment asset:\", error);\n           throw new Error(t(\"issue.comments.upload.error\"));\n         }\n       },\n+      duplicateCommentAsset: async (assetId, commentId) => {\n+        try {\n+          if (!workspaceSlug || !projectId) throw new Error(\"Missing fields\");\n+          const res = await duplicateEditorAsset({\n+            assetId,\n+            entityId: commentId || undefined,\n+            entityType: EFileAssetType.COMMENT_DESCRIPTION,\n+            projectId,\n+            workspaceSlug,\n+          });\n+          return res;\n+        } catch {\n+          throw new Error(\"Asset duplication failed. Please try again later.\");\n+        }\n+      },\n       addCommentReaction: async (commentId, reaction) => {\n         try {\n           if (!workspaceSlug || !projectId || !commentId) throw new Error(\"Missing fields\");\n           await createCommentReaction(workspaceSlug, projectId, commentId, reaction);\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-modal/components/description-editor.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-modal/components/description-editor.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-modal/components/description-editor.tsx\td462546 (parent)\n+++ apps/web/core/components/issues/issue-modal/components/description-editor.tsx\t8367980 (commit)\n@@ -76,9 +76,9 @@\n   // store hooks\n   const { getWorkspaceBySlug } = useWorkspace();\n   const workspaceId = getWorkspaceBySlug(workspaceSlug?.toString())?.id ?? \"\";\n   const { config } = useInstance();\n-  const { uploadEditorAsset } = useEditorAsset();\n+  const { uploadEditorAsset, duplicateEditorAsset } = useEditorAsset();\n   // platform\n   const { isMobile } = usePlatformOS();\n \n   const { getIndex } = getTabIndex(ETabIndices.ISSUE_FORM, isMobile);\n@@ -220,8 +220,23 @@\n                     console.log(\"Error in uploading issue asset:\", error);\n                     throw new Error(\"Asset upload failed. Please try again later.\");\n                   }\n                 }}\n+                duplicateFile={async (assetId: string) => {\n+                  try {\n+                    const { asset_id } = await duplicateEditorAsset({\n+                      assetId,\n+                      entityId: issueId,\n+                      entityType: isDraft ? EFileAssetType.DRAFT_ISSUE_DESCRIPTION : EFileAssetType.ISSUE_DESCRIPTION,\n+                      projectId,\n+                      workspaceSlug,\n+                    });\n+                    onAssetUpload(asset_id);\n+                    return asset_id;\n+                  } catch {\n+                    throw new Error(\"Asset duplication failed. Please try again later.\");\n+                  }\n+                }}\n               />\n             )}\n           />\n           <div className=\"border-0.5 z-10 flex items-center justify-end gap-2 p-3\">\n"
        },
        {
          "path": "apps/web/core/components/stickies/sticky/inputs.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/stickies/sticky/inputs.tsx\n===================================================================\n--- apps/web/core/components/stickies/sticky/inputs.tsx\td462546 (parent)\n+++ apps/web/core/components/stickies/sticky/inputs.tsx\t8367980 (commit)\n@@ -85,8 +85,9 @@\n                 \"max-h-[588px]\": isStickiesPage,\n               }\n             )}\n             uploadFile={async () => \"\"}\n+            duplicateFile={async () => \"\"}\n             showToolbar={showToolbar}\n             parentClassName=\"border-none p-0\"\n             handleDelete={handleDelete}\n             handleColorChange={handleChange}\n"
        },
        {
          "path": "apps/web/core/hooks/editor/use-editor-config.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/hooks/editor/use-editor-config.ts\n===================================================================\n--- apps/web/core/hooks/editor/use-editor-config.ts\td462546 (parent)\n+++ apps/web/core/hooks/editor/use-editor-config.ts\t8367980 (commit)\n@@ -13,8 +13,9 @@\n \n type TArgs = {\n   projectId?: string;\n   uploadFile: TFileHandler[\"upload\"];\n+  duplicateFile: TFileHandler[\"duplicate\"];\n   workspaceId: string;\n   workspaceSlug: string;\n };\n \n@@ -26,9 +27,9 @@\n   const { getExtendedEditorFileHandlers } = useExtendedEditorConfig();\n \n   const getEditorFileHandlers = useCallback(\n     (args: TArgs): TFileHandler => {\n-      const { projectId, uploadFile, workspaceId, workspaceSlug } = args;\n+      const { projectId, uploadFile, duplicateFile, workspaceId, workspaceSlug } = args;\n \n       return {\n         assetsUploadStatus: assetsUploadPercentage,\n         cancel: fileService.cancelUpload,\n@@ -84,8 +85,9 @@\n             await fileService.restoreNewAsset(workspaceSlug, src);\n           }\n         },\n         upload: uploadFile,\n+        duplicate: duplicateFile,\n         validation: {\n           maxFileSize,\n         },\n         ...getExtendedEditorFileHandlers({ projectId, workspaceSlug }),\n"
        },
        {
          "path": "apps/web/core/services/file.service.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/services/file.service.ts\n===================================================================\n--- apps/web/core/services/file.service.ts\td462546 (parent)\n+++ apps/web/core/services/file.service.ts\t8367980 (commit)\n@@ -1,9 +1,9 @@\n import type { AxiosRequestConfig } from \"axios\";\n // plane types\n import { API_BASE_URL } from \"@plane/constants\";\n import { getFileMetaDataForUpload, generateFileUploadPayload } from \"@plane/services\";\n-import type { TFileEntityInfo, TFileSignedURLResponse } from \"@plane/types\";\n+import type { EFileAssetType, TFileEntityInfo, TFileSignedURLResponse } from \"@plane/types\";\n import { getAssetIdFromUrl } from \"@plane/utils\";\n // helpers\n // services\n import { APIService } from \"@/services/api.service\";\n@@ -280,5 +280,21 @@\n       .catch((err) => {\n         throw err?.response?.data;\n       });\n   }\n+\n+  async duplicateAsset(\n+    workspaceSlug: string,\n+    assetId: string,\n+    data: {\n+      entity_id?: string;\n+      entity_type: EFileAssetType;\n+      project_id?: string;\n+    }\n+  ): Promise<{ asset_id: string }> {\n+    return this.post(`/api/assets/v2/workspaces/${workspaceSlug}/duplicate-assets/${assetId}/`, data)\n+      .then((response) => response?.data)\n+      .catch((error) => {\n+        throw error?.response?.data;\n+      });\n+  }\n }\n"
        },
        {
          "path": "apps/web/core/store/editor/asset.store.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/store/editor/asset.store.ts\n===================================================================\n--- apps/web/core/store/editor/asset.store.ts\td462546 (parent)\n+++ apps/web/core/store/editor/asset.store.ts\t8367980 (commit)\n@@ -2,9 +2,9 @@\n import { action, computed, makeObservable, observable, runInAction } from \"mobx\";\n import { computedFn } from \"mobx-utils\";\n import { v4 as uuidv4 } from \"uuid\";\n // plane types\n-import type { TFileEntityInfo, TFileSignedURLResponse } from \"@plane/types\";\n+import type { EFileAssetType, TFileEntityInfo, TFileSignedURLResponse } from \"@plane/types\";\n // services\n import { FileService } from \"@/services/file.service\";\n import type { TAttachmentUploadStatus } from \"../issue/issue-details/attachment.store\";\n \n@@ -26,8 +26,21 @@\n     file: File;\n     projectId?: string;\n     workspaceSlug: string;\n   }) => Promise<TFileSignedURLResponse>;\n+  duplicateEditorAsset: ({\n+    assetId,\n+    entityId,\n+    entityType,\n+    projectId,\n+    workspaceSlug,\n+  }: {\n+    assetId: string;\n+    entityId?: string;\n+    entityType: EFileAssetType;\n+    projectId?: string;\n+    workspaceSlug: string;\n+  }) => Promise<{ asset_id: string }>;\n }\n \n export class EditorAssetStore implements IEditorAssetStore {\n   // observables\n@@ -116,5 +129,14 @@\n         delete this.assetsUploadStatus[blockId];\n       });\n     }\n   };\n+  duplicateEditorAsset: IEditorAssetStore[\"duplicateEditorAsset\"] = async (args) => {\n+    const { assetId, entityId, entityType, projectId, workspaceSlug } = args;\n+    const { asset_id } = await this.fileService.duplicateAsset(workspaceSlug, assetId, {\n+      entity_id: entityId,\n+      entity_type: entityType,\n+      project_id: projectId,\n+    });\n+    return { asset_id };\n+  };\n }\n"
        },
        {
          "path": "packages/editor/src/ce/helpers/asset-duplication.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/ce/helpers/asset-duplication.ts\n===================================================================\n--- packages/editor/src/ce/helpers/asset-duplication.ts\td462546 (parent)\n+++ packages/editor/src/ce/helpers/asset-duplication.ts\t8367980 (commit)\n@@ -0,0 +1,40 @@\n+import { v4 as uuidv4 } from \"uuid\";\n+import { ECustomImageAttributeNames, ECustomImageStatus } from \"@/extensions/custom-image/types\";\n+\n+export type AssetDuplicationContext = {\n+  element: Element;\n+  originalHtml: string;\n+};\n+\n+export type AssetDuplicationResult = {\n+  modifiedHtml: string;\n+  shouldProcess: boolean;\n+};\n+\n+export type AssetDuplicationHandler = (context: AssetDuplicationContext) => AssetDuplicationResult;\n+\n+const imageComponentHandler: AssetDuplicationHandler = ({ element, originalHtml }) => {\n+  const src = element.getAttribute(\"src\");\n+\n+  if (!src || src.startsWith(\"http\")) {\n+    return { modifiedHtml: originalHtml, shouldProcess: false };\n+  }\n+\n+  // Capture the original HTML BEFORE making any modifications\n+  const originalTag = element.outerHTML;\n+\n+  // Use setAttribute to update attributes\n+  const newId = uuidv4();\n+  element.setAttribute(ECustomImageAttributeNames.STATUS, ECustomImageStatus.DUPLICATING);\n+  element.setAttribute(ECustomImageAttributeNames.ID, newId);\n+\n+  // Get the modified HTML AFTER the changes\n+  const modifiedTag = element.outerHTML;\n+  const modifiedHtml = originalHtml.replaceAll(originalTag, modifiedTag);\n+\n+  return { modifiedHtml, shouldProcess: true };\n+};\n+\n+export const assetDuplicationHandlers: Record<string, AssetDuplicationHandler> = {\n+  \"image-component\": imageComponentHandler,\n+};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/block.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/block.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/block.tsx\td462546 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/block.tsx\t8367980 (commit)\n@@ -3,9 +3,9 @@\n // plane imports\n import { cn } from \"@plane/utils\";\n // local imports\n import type { Pixel, TCustomImageAttributes, TCustomImageSize } from \"../types\";\n-import { ensurePixelString, getImageBlockId } from \"../utils\";\n+import { ensurePixelString, getImageBlockId, isImageDuplicating } from \"../utils\";\n import type { CustomImageNodeViewProps } from \"./node-view\";\n import { ImageToolbarRoot } from \"./toolbar\";\n import { ImageUploadStatus } from \"./upload-status\";\n \n@@ -41,8 +41,9 @@\n     height: nodeHeight,\n     aspectRatio: nodeAspectRatio,\n     src: imgNodeSrc,\n     alignment: nodeAlignment,\n+    status,\n   } = node.attrs;\n   // states\n   const [size, setSize] = useState<TCustomImageSize>({\n     width: ensurePixelString(nodeWidth, \"35%\") ?? \"35%\",\n@@ -201,17 +202,18 @@\n     },\n     [editor, getPos, isTouchDevice]\n   );\n \n+  const isDuplicating = isImageDuplicating(status);\n   // show the image loader if the remote image's src or preview image from filesystem is not set yet (while loading the image post upload) (or)\n   // if the initial resize (from 35% width and \"auto\" height attrs to the actual size in px) is not complete\n-  const showImageLoader = !(resolvedImageSrc || imageFromFileSystem) || !initialResizeComplete || hasErroredOnFirstLoad;\n-  // show the image upload status only when the resolvedImageSrc is not ready\n-  const showUploadStatus = !resolvedImageSrc;\n+  const showImageLoader =\n+    (!resolvedImageSrc && !isDuplicating) || !initialResizeComplete || hasErroredOnFirstLoad || isDuplicating; // show the image upload status only when the resolvedImageSrc is not ready\n+  const showUploadStatus = !resolvedImageSrc && !isDuplicating;\n   // show the image utils only if the remote image's (post upload) src is set and the initial resize is complete (but not while we're showing the preview imageFromFileSystem)\n-  const showImageToolbar = resolvedImageSrc && resolvedDownloadSrc && initialResizeComplete;\n+  const showImageToolbar = resolvedImageSrc && resolvedDownloadSrc && initialResizeComplete && !isDuplicating;\n   // show the image resizer only if the editor is editable, the remote image's (post upload) src is set and the initial resize is complete (but not while we're showing the preview imageFromFileSystem)\n-  const showImageResizer = editor.isEditable && resolvedImageSrc && initialResizeComplete;\n+  const showImageResizer = editor.isEditable && resolvedImageSrc && initialResizeComplete && !isDuplicating;\n   // show the preview image from the file system if the remote image's src is not set\n   const displayedImageSrc = resolvedImageSrc || imageFromFileSystem;\n \n   return (\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/node-view.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/node-view.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/node-view.tsx\td462546 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/node-view.tsx\t8367980 (commit)\n@@ -2,8 +2,10 @@\n import type { NodeViewProps } from \"@tiptap/react\";\n import { useEffect, useRef, useState } from \"react\";\n // local imports\n import type { CustomImageExtensionType, TCustomImageAttributes } from \"../types\";\n+import { ECustomImageStatus } from \"../types\";\n+import { hasImageDuplicationFailed } from \"../utils\";\n import { CustomImageBlock } from \"./block\";\n import { CustomImageUploader } from \"./uploader\";\n \n export type CustomImageNodeViewProps = Omit<NodeViewProps, \"extension\" | \"updateAttributes\"> & {\n@@ -14,10 +16,10 @@\n   updateAttributes: (attrs: Partial<TCustomImageAttributes>) => void;\n };\n \n export const CustomImageNodeView: React.FC<CustomImageNodeViewProps> = (props) => {\n-  const { editor, extension, node } = props;\n-  const { src: imgNodeSrc } = node.attrs;\n+  const { editor, extension, node, updateAttributes } = props;\n+  const { src: imgNodeSrc, status } = node.attrs;\n \n   const [isUploaded, setIsUploaded] = useState(!!imgNodeSrc);\n   const [resolvedSrc, setResolvedSrc] = useState<string | undefined>(undefined);\n   const [resolvedDownloadSrc, setResolvedDownloadSrc] = useState<string | undefined>(undefined);\n@@ -25,8 +27,10 @@\n   const [failedToLoadImage, setFailedToLoadImage] = useState(false);\n \n   const [editorContainer, setEditorContainer] = useState<HTMLDivElement | null>(null);\n   const imageComponentRef = useRef<HTMLDivElement>(null);\n+  const hasRetriedOnMount = useRef(false);\n+  const isDuplicatingRef = useRef(false);\n \n   useEffect(() => {\n     const closestEditorContainer = imageComponentRef.current?.closest(\".editor-container\");\n     if (closestEditorContainer) {\n@@ -60,12 +64,68 @@\n     };\n     getImageSource();\n   }, [imgNodeSrc, extension.options]);\n \n+  // Handle image duplication when status is duplicating\n+  useEffect(() => {\n+    const handleDuplication = async () => {\n+      if (status !== ECustomImageStatus.DUPLICATING || !extension.options.duplicateImage || !imgNodeSrc) {\n+        return;\n+      }\n+\n+      // Prevent duplicate calls - check if already duplicating this asset\n+      if (isDuplicatingRef.current) {\n+        return;\n+      }\n+\n+      isDuplicatingRef.current = true;\n+      try {\n+        hasRetriedOnMount.current = true;\n+\n+        const newAssetId = await extension.options.duplicateImage!(imgNodeSrc);\n+\n+        if (!newAssetId) {\n+          throw new Error(\"Duplication returned invalid asset ID\");\n+        }\n+\n+        // Update node with new source and success status\n+        updateAttributes({\n+          src: newAssetId,\n+          status: ECustomImageStatus.UPLOADED,\n+        });\n+      } catch (error: unknown) {\n+        console.error(\"Failed to duplicate image:\", error);\n+        // Update status to failed\n+        updateAttributes({ status: ECustomImageStatus.DUPLICATION_FAILED });\n+      } finally {\n+        isDuplicatingRef.current = false;\n+      }\n+    };\n+\n+    handleDuplication();\n+  }, [status, imgNodeSrc, extension.options.duplicateImage, updateAttributes]);\n+\n+  useEffect(() => {\n+    if (hasImageDuplicationFailed(status) && !hasRetriedOnMount.current && imgNodeSrc) {\n+      hasRetriedOnMount.current = true;\n+      // Add a small delay before retrying to avoid immediate retries\n+      updateAttributes({ status: ECustomImageStatus.DUPLICATING });\n+    }\n+  }, [status, imgNodeSrc, updateAttributes]);\n+\n+  useEffect(() => {\n+    if (status === ECustomImageStatus.UPLOADED) {\n+      hasRetriedOnMount.current = false;\n+    }\n+  }, [status]);\n+\n+  const hasDuplicationFailed = hasImageDuplicationFailed(status);\n+  const shouldShowBlock = (isUploaded || imageFromFileSystem) && !failedToLoadImage;\n+\n   return (\n     <NodeViewWrapper>\n       <div className=\"p-0 mx-0 my-2\" data-drag-handle ref={imageComponentRef}>\n-        {(isUploaded || imageFromFileSystem) && !failedToLoadImage ? (\n+        {shouldShowBlock && !hasDuplicationFailed ? (\n           <CustomImageBlock\n             editorContainer={editorContainer}\n             imageFromFileSystem={imageFromFileSystem}\n             setEditorContainer={setEditorContainer}\n@@ -76,8 +136,9 @@\n           />\n         ) : (\n           <CustomImageUploader\n             failedToLoadImage={failedToLoadImage}\n+            hasDuplicationFailed={hasDuplicationFailed}\n             loadImageFromFileSystem={setImageFromFileSystem}\n             maxFileSize={editor.storage.imageComponent?.maxFileSize}\n             setIsUploaded={setIsUploaded}\n             {...props}\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/uploader.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/uploader.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/uploader.tsx\td462546 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/uploader.tsx\t8367980 (commit)\n@@ -1,5 +1,5 @@\n-import { ImageIcon } from \"lucide-react\";\n+import { ImageIcon, RotateCcw } from \"lucide-react\";\n import type { ChangeEvent } from \"react\";\n import { useCallback, useEffect, useMemo, useRef } from \"react\";\n // plane imports\n import { cn } from \"@plane/utils\";\n@@ -10,13 +10,15 @@\n import type { EFileError } from \"@/helpers/file\";\n // hooks\n import { useUploader, useDropZone, uploadFirstFileAndInsertRemaining } from \"@/hooks/use-file-upload\";\n // local imports\n+import { ECustomImageStatus } from \"../types\";\n import { getImageComponentImageFileMap } from \"../utils\";\n import type { CustomImageNodeViewProps } from \"./node-view\";\n \n type CustomImageUploaderProps = CustomImageNodeViewProps & {\n   failedToLoadImage: boolean;\n+  hasDuplicationFailed: boolean;\n   loadImageFromFileSystem: (file: string) => void;\n   maxFileSize: number;\n   setIsUploaded: (isUploaded: boolean) => void;\n };\n@@ -32,8 +34,9 @@\n     node,\n     selected,\n     setIsUploaded,\n     updateAttributes,\n+    hasDuplicationFailed,\n   } = props;\n   // refs\n   const fileInputRef = useRef<HTMLInputElement>(null);\n   const hasTriggeredFilePickerRef = useRef(false);\n@@ -49,8 +52,9 @@\n         setIsUploaded(true);\n         // Update the node view's src attribute post upload\n         updateAttributes({\n           src: url,\n+          status: ECustomImageStatus.UPLOADED,\n         });\n         imageComponentImageFileMap?.delete(imageEntityId);\n \n         const pos = getPos();\n@@ -83,10 +87,13 @@\n     [imageComponentImageFileMap, imageEntityId, updateAttributes, getPos]\n   );\n \n   const uploadImageEditorCommand = useCallback(\n-    async (file: File) => await extension.options.uploadImage?.(imageEntityId ?? \"\", file),\n-    [extension.options, imageEntityId]\n+    async (file: File) => {\n+      updateAttributes({ status: ECustomImageStatus.UPLOADING });\n+      return await extension.options.uploadImage?.(imageEntityId ?? \"\", file);\n+    },\n+    [extension.options, imageEntityId, updateAttributes]\n   );\n \n   const handleProgressStatus = useCallback(\n     (isUploading: boolean) => {\n@@ -160,9 +167,9 @@\n   );\n \n   const getDisplayMessage = useCallback(() => {\n     const isUploading = isImageBeingUploaded;\n-    if (failedToLoadImage) {\n+    if (failedToLoadImage || hasDuplicationFailed) {\n       return \"Error loading image\";\n     }\n \n     if (isUploading) {\n@@ -173,10 +180,20 @@\n       return \"Drop image here\";\n     }\n \n     return \"Add an image\";\n-  }, [draggedInside, editor.isEditable, failedToLoadImage, isImageBeingUploaded]);\n+  }, [draggedInside, editor.isEditable, failedToLoadImage, isImageBeingUploaded, hasDuplicationFailed]);\n \n+  const handleRetryClick = useCallback(\n+    (e: React.MouseEvent) => {\n+      e.stopPropagation();\n+      if (hasDuplicationFailed && editor.isEditable) {\n+        updateAttributes({ status: ECustomImageStatus.DUPLICATING });\n+      }\n+    },\n+    [hasDuplicationFailed, editor.isEditable, updateAttributes]\n+  );\n+\n   return (\n     <div\n       className={cn(\n         \"image-upload-component flex items-center justify-start gap-2 py-3 px-2 rounded-lg text-custom-text-300 bg-custom-background-90 border border-dashed border-custom-border-300 transition-all duration-200 ease-in-out cursor-default\",\n@@ -184,26 +201,42 @@\n           \"hover:text-custom-text-200 hover:bg-custom-background-80 cursor-pointer\": editor.isEditable,\n           \"bg-custom-background-80 text-custom-text-200\": draggedInside && editor.isEditable,\n           \"text-custom-primary-200 bg-custom-primary-100/10 border-custom-primary-200/10 hover:bg-custom-primary-100/10 hover:text-custom-primary-200\":\n             selected && editor.isEditable,\n-          \"text-red-500 cursor-default\": failedToLoadImage,\n-          \"hover:text-red-500\": failedToLoadImage && editor.isEditable,\n-          \"bg-red-500/10\": failedToLoadImage && selected,\n-          \"hover:bg-red-500/10\": failedToLoadImage && selected && editor.isEditable,\n+          \"text-red-500 cursor-default\": failedToLoadImage || hasDuplicationFailed,\n+          \"hover:text-red-500\": (failedToLoadImage || hasDuplicationFailed) && editor.isEditable,\n+          \"bg-red-500/10\": (failedToLoadImage || hasDuplicationFailed) && selected,\n+          \"hover:bg-red-500/10\": (failedToLoadImage || hasDuplicationFailed) && selected && editor.isEditable,\n         }\n       )}\n       onDrop={onDrop}\n       onDragOver={onDragEnter}\n       onDragLeave={onDragLeave}\n       contentEditable={false}\n       onClick={() => {\n-        if (!failedToLoadImage && editor.isEditable) {\n+        if (!failedToLoadImage && editor.isEditable && !hasDuplicationFailed) {\n           fileInputRef.current?.click();\n         }\n       }}\n     >\n       <ImageIcon className=\"size-4\" />\n-      <div className=\"text-base font-medium\">{getDisplayMessage()}</div>\n+      <div className=\"text-base font-medium flex-1\">{getDisplayMessage()}</div>\n+      {hasDuplicationFailed && editor.isEditable && (\n+        <button\n+          type=\"button\"\n+          onClick={handleRetryClick}\n+          className={cn(\n+            \"flex items-center gap-1 px-2 py-1 text-xs font-medium text-custom-text-300 hover:bg-custom-background-90 hover:text-custom-text-200 rounded-md transition-all duration-200 ease-in-out\",\n+            {\n+              \"hover:bg-red-500/20\": selected,\n+            }\n+          )}\n+          title=\"Retry duplication\"\n+        >\n+          <RotateCcw className=\"size-3\" />\n+          Retry\n+        </button>\n+      )}\n       <input\n         className=\"size-0 overflow-hidden\"\n         ref={fileInputRef}\n         hidden\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/extension.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/extension.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/extension.tsx\td462546 (parent)\n+++ packages/editor/src/core/extensions/custom-image/extension.tsx\t8367980 (commit)\n@@ -11,8 +11,9 @@\n import type { CustomImageNodeViewProps } from \"./components/node-view\";\n import { CustomImageNodeView } from \"./components/node-view\";\n import { CustomImageExtensionConfig } from \"./extension-config\";\n import type { CustomImageExtensionOptions, CustomImageExtensionStorage } from \"./types\";\n+import { ECustomImageAttributeNames, ECustomImageStatus } from \"./types\";\n import { getImageComponentImageFileMap } from \"./utils\";\n \n type Props = {\n   fileHandler: TFileHandler;\n@@ -29,15 +30,16 @@\n     draggable: isEditable,\n \n     addOptions() {\n       const upload = \"upload\" in fileHandler ? fileHandler.upload : undefined;\n-\n+      const duplicate = \"duplicate\" in fileHandler ? fileHandler.duplicate : undefined;\n       return {\n         ...this.parent?.(),\n         getImageDownloadSource: getAssetDownloadSrc,\n         getImageSource: getAssetSrc,\n         restoreImage: restoreImageFn,\n         uploadImage: upload,\n+        duplicateImage: duplicate,\n       };\n     },\n \n     addStorage() {\n@@ -92,9 +94,10 @@\n               }\n             }\n \n             const attributes = {\n-              id: fileId,\n+              [ECustomImageAttributeNames.ID]: fileId,\n+              [ECustomImageAttributeNames.STATUS]: ECustomImageStatus.PENDING,\n             };\n \n             if (props.pos) {\n               return commands.insertContentAt(props.pos, {\n@@ -115,9 +118,8 @@\n         ArrowDown: insertEmptyParagraphAtNodeBoundaries(\"down\", this.name),\n         ArrowUp: insertEmptyParagraphAtNodeBoundaries(\"up\", this.name),\n       };\n     },\n-\n     addNodeView() {\n       return ReactNodeViewRenderer((props) => (\n         <CustomImageNodeView {...props} node={props.node as CustomImageNodeViewProps[\"node\"]} />\n       ));\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/types.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/types.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/types.ts\td462546 (parent)\n+++ packages/editor/src/core/extensions/custom-image/types.ts\t8367980 (commit)\n@@ -8,8 +8,9 @@\n   HEIGHT = \"height\",\n   ASPECT_RATIO = \"aspectRatio\",\n   SOURCE = \"src\",\n   ALIGNMENT = \"alignment\",\n+  STATUS = \"status\",\n }\n \n export type Pixel = `${number}px`;\n \n@@ -22,15 +23,24 @@\n };\n \n export type TCustomImageAlignment = \"left\" | \"center\" | \"right\";\n \n+export enum ECustomImageStatus {\n+  PENDING = \"pending\",\n+  UPLOADING = \"uploading\",\n+  UPLOADED = \"uploaded\",\n+  DUPLICATING = \"duplicating\",\n+  DUPLICATION_FAILED = \"duplication-failed\",\n+}\n+\n export type TCustomImageAttributes = {\n   [ECustomImageAttributeNames.ID]: string | null;\n   [ECustomImageAttributeNames.WIDTH]: PixelAttribute<\"35%\" | number> | null;\n   [ECustomImageAttributeNames.HEIGHT]: PixelAttribute<\"auto\" | number> | null;\n   [ECustomImageAttributeNames.ASPECT_RATIO]: number | null;\n   [ECustomImageAttributeNames.SOURCE]: string | null;\n   [ECustomImageAttributeNames.ALIGNMENT]: TCustomImageAlignment;\n+  [ECustomImageAttributeNames.STATUS]: ECustomImageStatus;\n };\n \n export type UploadEntity = ({ event: \"insert\" } | { event: \"drop\"; file: File }) & { hasOpenedFileInputOnce?: boolean };\n \n@@ -44,8 +54,9 @@\n   getImageDownloadSource: TFileHandler[\"getAssetDownloadSrc\"];\n   getImageSource: TFileHandler[\"getAssetSrc\"];\n   restoreImage: TFileHandler[\"restore\"];\n   uploadImage?: TFileHandler[\"upload\"];\n+  duplicateImage?: TFileHandler[\"duplicate\"];\n };\n \n export type CustomImageExtensionStorage = {\n   fileMap: Map<string, UploadEntity>;\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/utils.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/utils.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/utils.ts\td462546 (parent)\n+++ packages/editor/src/core/extensions/custom-image/utils.ts\t8367980 (commit)\n@@ -1,9 +1,9 @@\n import type { Editor } from \"@tiptap/core\";\n import { AlignCenter, AlignLeft, AlignRight } from \"lucide-react\";\n import type { LucideIcon } from \"lucide-react\";\n // local imports\n-import { ECustomImageAttributeNames } from \"./types\";\n+import { ECustomImageAttributeNames, ECustomImageStatus } from \"./types\";\n import type { TCustomImageAlignment, Pixel, TCustomImageAttributes } from \"./types\";\n \n export const DEFAULT_CUSTOM_IMAGE_ATTRIBUTES: TCustomImageAttributes = {\n   [ECustomImageAttributeNames.SOURCE]: null,\n@@ -11,8 +11,9 @@\n   [ECustomImageAttributeNames.WIDTH]: \"35%\",\n   [ECustomImageAttributeNames.HEIGHT]: \"auto\",\n   [ECustomImageAttributeNames.ASPECT_RATIO]: null,\n   [ECustomImageAttributeNames.ALIGNMENT]: \"left\",\n+  [ECustomImageAttributeNames.STATUS]: ECustomImageStatus.PENDING,\n };\n \n export const getImageComponentImageFileMap = (editor: Editor) => editor.storage.imageComponent?.fileMap;\n \n@@ -52,4 +53,12 @@\n     icon: AlignRight,\n   },\n ];\n export const getImageBlockId = (id: string) => `editor-image-block-${id}`;\n+\n+export const isImageDuplicating = (status: ECustomImageStatus) => status === ECustomImageStatus.DUPLICATING;\n+\n+export const isImageDuplicationComplete = (status: ECustomImageStatus) =>\n+  status === ECustomImageStatus.UPLOADED || status === ECustomImageStatus.DUPLICATION_FAILED;\n+\n+export const hasImageDuplicationFailed = (status: ECustomImageStatus) =>\n+  status === ECustomImageStatus.DUPLICATION_FAILED;\n"
        },
        {
          "path": "packages/editor/src/core/extensions/utility.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/utility.ts\n===================================================================\n--- packages/editor/src/core/extensions/utility.ts\td462546 (parent)\n+++ packages/editor/src/core/extensions/utility.ts\t8367980 (commit)\n@@ -8,8 +8,9 @@\n import { DropHandlerPlugin } from \"@/plugins/drop\";\n import { FilePlugins } from \"@/plugins/file/root\";\n import { MarkdownClipboardPlugin } from \"@/plugins/markdown-clipboard\";\n // types\n+import { PasteAssetPlugin } from \"@/plugins/paste-asset\";\n import type { IEditorProps, TEditorAsset, TFileHandler } from \"@/types\";\n \n type TActiveDropbarExtensions =\n   | CORE_EXTENSIONS.MENTION\n@@ -79,8 +80,9 @@\n         DropHandlerPlugin({\n           disabledExtensions,\n           editor: this.editor,\n         }),\n+        PasteAssetPlugin(),\n       ];\n     },\n \n     onCreate() {\n"
        },
        {
          "path": "packages/editor/src/core/plugins/paste-asset.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/plugins/paste-asset.ts\n===================================================================\n--- packages/editor/src/core/plugins/paste-asset.ts\td462546 (parent)\n+++ packages/editor/src/core/plugins/paste-asset.ts\t8367980 (commit)\n@@ -0,0 +1,77 @@\n+import { Plugin, PluginKey } from \"@tiptap/pm/state\";\n+import { assetDuplicationHandlers } from \"@/plane-editor/helpers/asset-duplication\";\n+\n+export const PasteAssetPlugin = (): Plugin =>\n+  new Plugin({\n+    key: new PluginKey(\"paste-asset-duplication\"),\n+    props: {\n+      handlePaste: (view, event) => {\n+        if (!event.clipboardData) return false;\n+\n+        const htmlContent = event.clipboardData.getData(\"text/html\");\n+        if (!htmlContent || htmlContent.includes('data-uploaded=\"true\"')) return false;\n+\n+        // Process the HTML content using the registry\n+        const { processedHtml, hasChanges } = processAssetDuplication(htmlContent);\n+\n+        if (!hasChanges) return false;\n+\n+        event.preventDefault();\n+        event.stopPropagation();\n+\n+        // Mark the content as already processed to avoid infinite loops\n+        const tempDiv = document.createElement(\"div\");\n+        tempDiv.innerHTML = processedHtml;\n+        const metaTag = tempDiv.querySelector(\"meta[charset='utf-8']\");\n+        if (metaTag) {\n+          metaTag.setAttribute(\"data-uploaded\", \"true\");\n+        }\n+        const finalHtml = tempDiv.innerHTML;\n+\n+        const newDataTransfer = new DataTransfer();\n+        newDataTransfer.setData(\"text/html\", finalHtml);\n+        if (event.clipboardData) {\n+          newDataTransfer.setData(\"text/plain\", event.clipboardData.getData(\"text/plain\"));\n+        }\n+\n+        const pasteEvent = new ClipboardEvent(\"paste\", {\n+          clipboardData: newDataTransfer,\n+          bubbles: true,\n+          cancelable: true,\n+        });\n+\n+        view.dom.dispatchEvent(pasteEvent);\n+\n+        return true;\n+      },\n+    },\n+  });\n+\n+// Utility function to process HTML content with all registered handlers\n+const processAssetDuplication = (htmlContent: string): { processedHtml: string; hasChanges: boolean } => {\n+  const tempDiv = document.createElement(\"div\");\n+  tempDiv.innerHTML = htmlContent;\n+\n+  let processedHtml = htmlContent;\n+  let hasChanges = false;\n+\n+  // Process each registered component type\n+  for (const [componentName, handler] of Object.entries(assetDuplicationHandlers)) {\n+    const elements = tempDiv.querySelectorAll(componentName);\n+\n+    if (elements.length > 0) {\n+      elements.forEach((element) => {\n+        const result = handler({ element, originalHtml: processedHtml });\n+        if (result.shouldProcess) {\n+          processedHtml = result.modifiedHtml;\n+          hasChanges = true;\n+        }\n+      });\n+\n+      // Update tempDiv with processed HTML for next iteration\n+      tempDiv.innerHTML = processedHtml;\n+    }\n+  }\n+\n+  return { processedHtml, hasChanges };\n+};\n"
        },
        {
          "path": "packages/editor/src/core/props.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/props.ts\n===================================================================\n--- packages/editor/src/core/props.ts\td462546 (parent)\n+++ packages/editor/src/core/props.ts\t8367980 (commit)\n@@ -26,9 +26,6 @@\n           }\n         }\n       },\n     },\n-    transformPastedHTML(html) {\n-      return html.replace(/<img.*?>/g, \"\");\n-    },\n   };\n };\n"
        },
        {
          "path": "packages/editor/src/core/types/config.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/types/config.ts\n===================================================================\n--- packages/editor/src/core/types/config.ts\td462546 (parent)\n+++ packages/editor/src/core/types/config.ts\t8367980 (commit)\n@@ -10,8 +10,9 @@\n   getAssetDownloadSrc: (path: string) => Promise<string>;\n   getAssetSrc: (path: string) => Promise<string>;\n   restore: (assetSrc: string) => Promise<void>;\n   upload: (blockId: string, file: File) => Promise<string>;\n+  duplicate: (assetId: string) => Promise<string>;\n   validation: {\n     /**\n      * @description max file size in bytes\n      * @example enter 5242880(5 * 1024 * 1024) for 5MB\n"
        },
        {
          "path": "packages/types/src/issues/activity/issue_comment.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/issues/activity/issue_comment.ts\n===================================================================\n--- packages/types/src/issues/activity/issue_comment.ts\td462546 (parent)\n+++ packages/types/src/issues/activity/issue_comment.ts\t8367980 (commit)\n@@ -46,8 +46,9 @@\n   createComment: (data: Partial<TIssueComment>) => Promise<Partial<TIssueComment> | undefined>;\n   updateComment: (commentId: string, data: Partial<TIssueComment>) => Promise<void>;\n   removeComment: (commentId: string) => Promise<void>;\n   uploadCommentAsset: (blockId: string, file: File, commentId?: string) => Promise<TFileSignedURLResponse>;\n+  duplicateCommentAsset: (assetId: string, commentId?: string) => Promise<{ asset_id: string }>;\n   addCommentReaction: (commentId: string, reactionEmoji: string) => Promise<void>;\n   deleteCommentReaction: (commentId: string, reactionEmoji: string) => Promise<void>;\n   react: (commentId: string, reactionEmoji: string, userReactions: string[]) => Promise<void>;\n   reactionIds: (commentId: string) =>\n"
        }
      ]
    },
    {
      "id": "add-gitea-sso",
      "sha": "1126ca30b0d9d29bdd7e9df4f5db1a073c7d0e84",
      "parentSha": "69fe581fd8cbce5c15b904708adb4e69c27059a6",
      "spec": "Implement Gitea SSO across Admin UI, API OAuth provider/endpoints, Instance config, Types, and Space login, mirroring the patterns used for Google/GitHub/GitLab.\n\nAdmin UI\n1) Add a dedicated Gitea admin page under apps/admin/app/(all)/(dashboard)/authentication/gitea/ with:\n   - layout.tsx: metadata title \"Gitea Authentication - God Mode\"; render children only.\n   - page.tsx: renders an AuthenticationMethodCard for Gitea with ToggleSwitch bound to IS_GITEA_ENABLED via useInstance(), and a body showing a loader or a form. Maintain isSubmitting state, fetch instance configurations via SWR, and call updateInstanceConfigurations on toggle. Show a success toast message reflecting active/disabled state based on value === \"1\".\n   - form.tsx: a controlled form (react-hook-form) for GITEA_HOST, GITEA_CLIENT_ID, GITEA_CLIENT_SECRET. Include a read-only CopyField that shows the Callback URI: {origin}/auth/gitea/callback/. Use ConfirmDiscardModal when navigating back with unsaved changes. On save, call updateInstanceConfigurations with the form data, show a success toast, and reset defaults based on the API response. Default host placeholder and description should point to https://gitea.com; auto-generate the Callback URI text.\n\n2) Add Gitea to the \"Authentication modes\" list in apps/admin/ce/components/authentication/authentication-modes.tsx:\n   - Import and include a card entry for Gitea with name, description, and icon. The config control is a new GiteaConfiguration component (see below).\n\n3) Add apps/admin/core/components/authentication/gitea-config.tsx:\n   - If GITEA_HOST, GITEA_CLIENT_ID, and GITEA_CLIENT_SECRET are present, show an Edit link to /authentication/gitea and a ToggleSwitch bound to IS_GITEA_ENABLED that updates configuration via updateConfig(\"IS_GITEA_ENABLED\", \"0\"|\"1\"). If not configured, show a \"Configure\" button linking to /authentication/gitea.\n\n4) Add gitea-logo.svg asset to admin, space, and web public logos to be used in the UI.\n\n5) For consistency, update success messages in existing provider pages so that the \"active\" state is determined via value === \"1\" for GitHub, GitLab, and Google (they were using truthiness checks).\n\nAPI (Django)\n6) Extend authentication adapter error codes in apps/api/plane/authentication/adapter/error.py:\n   - Add GITEA_NOT_CONFIGURED (5112) and GITEA_OAUTH_PROVIDER_ERROR (5123).\n\n7) Update apps/api/plane/authentication/adapter/oauth.py to map provider \"gitea\" to the new GITEA_OAUTH_PROVIDER_ERROR code in the error_code property logic.\n\n8) Add a new OAuth provider implementation apps/api/plane/authentication/provider/oauth/gitea.py that:\n   - Reads GITEA_CLIENT_ID, GITEA_CLIENT_SECRET, GITEA_HOST from instance configuration (with env var fallbacks) and raises AuthenticationException with GITEA_NOT_CONFIGURED if missing/invalid.\n   - Validates the GITEA_HOST scheme (http/https) and normalizes trailing slashes.\n   - Constructs authorize URL: {GITEA_HOST}/login/oauth/authorize and token URL: {GITEA_HOST}/login/oauth/access_token; user info URL: {GITEA_HOST}/api/v1/user.\n   - Sets redirect_uri to {scheme}://{host}/auth/gitea/callback/ based on request.\n   - Exchanges code for tokens with Accept: application/json, computes token expiry timestamps, and stores access_token, refresh_token, and id_token.\n   - Fetches user info; if email is not present, requests {userinfo_url}/emails and selects an email preferring primary+verified, then verified, then primary, else first; raise GITEA_OAUTH_PROVIDER_ERROR on failures.\n   - Sets user data with provider_id, email, avatar_url, and name fields (last_name can be empty), and marks password auto-set.\n\n9) Wire Gitea endpoints in apps/api/plane/authentication/urls.py:\n   - Add /auth/gitea/ (initiate) and /auth/gitea/callback/ (callback) for app, and spaces equivalents under /auth/spaces/gitea/ and /auth/spaces/gitea/callback/.\n\n10) Add views for app and space:\n   - apps/api/plane/authentication/views/app/gitea.py: GiteaOauthInitiateEndpoint stores session host, next_path, checks instance readiness, sets a CSRF-like state, redirects to provider auth URL. GiteaCallbackEndpoint validates state and code, authenticates via GiteaOAuthProvider, logs in the user (is_app=True), computes and redirects to next_path or default redirection path. On exceptions, redirect back to base host with error params.\n   - apps/api/plane/authentication/views/space/gitea.py: Same pattern for space context (is_space=True), including host resolution and next_path handling.\n   - Ensure these are imported/exported in apps/api/plane/authentication/views/__init__.py.\n\nInstance Config and Types\n11) Update apps/api/plane/license/api/views/instance.py to include IS_GITEA_ENABLED (default from env) and add is_gitea_enabled boolean to response data.\n\n12) Update apps/api/plane/license/management/commands/configure_instance.py:\n   - Add default configuration entries for Gitea category keys: IS_GITEA_ENABLED, GITEA_HOST, GITEA_CLIENT_ID, GITEA_CLIENT_SECRET.\n   - Include IS_GITEA_ENABLED in the keys list created when absent. Set its initial value to \"1\" only if all Gitea config keys are present (else \"0\").\n\n13) Update Space login page apps/space/core/components/account/auth-forms/auth-root.tsx:\n   - Consider is_gitea_enabled in the OAuth-enabled calculation.\n   - Add a Gitea entry to the OAuth button list that redirects to {API_BASE_URL}/auth/gitea/ with optional next_path.\n\n14) Update type definitions:\n   - packages/types/src/instance/auth.ts: add \"IS_GITEA_ENABLED\" to TInstanceAuthenticationMethodKeys, define TInstanceGiteaAuthenticationConfigurationKeys as \"GITEA_HOST\" | \"GITEA_CLIENT_ID\" | \"GITEA_CLIENT_SECRET\", and include them in TInstanceAuthenticationConfigurationKeys.\n   - packages/types/src/instance/base.ts: add is_gitea_enabled: boolean to IInstanceConfig.\n\nObservables/Acceptance\n- Admin panel shows a Gitea card in authentication modes. If configured, it shows Edit and a toggle; if not, a Configure button. Toggling shows promise toasts and persists as string values (\"0\"/\"1\").\n- Admin Gitea configuration page allows setting GITEA_HOST, GITEA_CLIENT_ID, GITEA_CLIENT_SECRET, and displays the Callback URI. Saving updates configuration and shows success toast.\n- API exposes /auth/gitea/ and /auth/gitea/callback/ (and space equivalents) that complete the Gitea OAuth flow, returning with proper error codes on failure.\n- Space login shows a \"Continue with Gitea\" button when enabled; clicking completes SSO and logs in.\n- Instance GET endpoint includes is_gitea_enabled; management command initializes Gitea keys similarly to other providers.\n- Success messages for GitHub/GitLab/Google use value === \"1\" to determine active state.",
      "prompt": "Add a new Gitea SSO provider across the app, mirroring the existing OAuth providers (Google, GitHub, GitLab). Provide an admin configuration screen with a toggle and form fields, implement backend OAuth initiation and callback endpoints for both app and space contexts, expose a provider implementation that completes the OAuth code exchange and fetches user data, update configuration and types to include a Gitea enabled flag and configuration keys, and show a Gitea login option on the end-user sign-in page when enabled. Follow existing patterns for URL structure, error handling, instance configuration, and UI/UX of other providers, including success messaging and a copyable callback URL on the admin screen.",
      "supplementalFiles": [
        "apps/api/plane/authentication/provider/oauth/github.py",
        "apps/api/plane/authentication/provider/oauth/gitlab.py",
        "apps/api/plane/authentication/provider/oauth/google.py",
        "apps/api/plane/authentication/views/app/github.py",
        "apps/api/plane/authentication/views/app/gitlab.py",
        "apps/api/plane/authentication/views/app/google.py",
        "apps/api/plane/authentication/views/space/github.py",
        "apps/api/plane/authentication/views/space/gitlab.py",
        "apps/api/plane/authentication/views/space/google.py",
        "apps/api/plane/authentication/utils/login.py",
        "apps/api/plane/authentication/utils/host.py",
        "apps/api/plane/authentication/utils/redirection_path.py",
        "apps/api/plane/authentication/utils/user_auth_workflow.py",
        "apps/api/plane/utils/path_validator.py",
        "apps/admin/core/components/authentication/github-config.tsx",
        "apps/admin/core/components/authentication/gitlab-config.tsx",
        "apps/admin/core/components/authentication/authentication-method-card.tsx",
        "apps/api/plane/license/utils/instance_value.py",
        "apps/api/plane/license/models.py"
      ],
      "fileDiffs": [
        {
          "path": "apps/admin/app/(all)/(dashboard)/authentication/gitea/form.tsx",
          "status": "added",
          "diff": "Index: apps/admin/app/(all)/(dashboard)/authentication/gitea/form.tsx\n===================================================================\n--- apps/admin/app/(all)/(dashboard)/authentication/gitea/form.tsx\t69fe581 (parent)\n+++ apps/admin/app/(all)/(dashboard)/authentication/gitea/form.tsx\t1126ca3 (commit)\n@@ -0,0 +1,210 @@\n+\"use client\";\n+\n+import type { FC } from \"react\";\n+import { useState } from \"react\";\n+import { isEmpty } from \"lodash-es\";\n+import Link from \"next/link\";\n+import { useForm } from \"react-hook-form\";\n+// plane internal packages\n+import { API_BASE_URL } from \"@plane/constants\";\n+import { TOAST_TYPE, setToast } from \"@plane/propel/toast\";\n+import type { IFormattedInstanceConfiguration, TInstanceGiteaAuthenticationConfigurationKeys } from \"@plane/types\";\n+import { Button, getButtonStyling } from \"@plane/ui\";\n+import { cn } from \"@plane/utils\";\n+// components\n+import { CodeBlock } from \"@/components/common/code-block\";\n+import { ConfirmDiscardModal } from \"@/components/common/confirm-discard-modal\";\n+import type { TControllerInputFormField } from \"@/components/common/controller-input\";\n+import { ControllerInput } from \"@/components/common/controller-input\";\n+import type { TCopyField } from \"@/components/common/copy-field\";\n+import { CopyField } from \"@/components/common/copy-field\";\n+// hooks\n+import { useInstance } from \"@/hooks/store\";\n+\n+type Props = {\n+  config: IFormattedInstanceConfiguration;\n+};\n+\n+type GiteaConfigFormValues = Record<TInstanceGiteaAuthenticationConfigurationKeys, string>;\n+\n+export const InstanceGiteaConfigForm: FC<Props> = (props) => {\n+  const { config } = props;\n+  // states\n+  const [isDiscardChangesModalOpen, setIsDiscardChangesModalOpen] = useState(false);\n+  // store hooks\n+  const { updateInstanceConfigurations } = useInstance();\n+  // form data\n+  const {\n+    handleSubmit,\n+    control,\n+    reset,\n+    formState: { errors, isDirty, isSubmitting },\n+  } = useForm<GiteaConfigFormValues>({\n+    defaultValues: {\n+      GITEA_HOST: config[\"GITEA_HOST\"] || \"https://gitea.com\",\n+      GITEA_CLIENT_ID: config[\"GITEA_CLIENT_ID\"],\n+      GITEA_CLIENT_SECRET: config[\"GITEA_CLIENT_SECRET\"],\n+    },\n+  });\n+\n+  const originURL = !isEmpty(API_BASE_URL) ? API_BASE_URL : typeof window !== \"undefined\" ? window.location.origin : \"\";\n+\n+  const GITEA_FORM_FIELDS: TControllerInputFormField[] = [\n+    {\n+      key: \"GITEA_HOST\",\n+      type: \"text\",\n+      label: \"Gitea Host\",\n+      description: (\n+        <>Use the URL of your Gitea instance. For the official Gitea instance, use &quot;https://gitea.com&quot;.</>\n+      ),\n+      placeholder: \"https://gitea.com\",\n+      error: Boolean(errors.GITEA_HOST),\n+      required: true,\n+    },\n+    {\n+      key: \"GITEA_CLIENT_ID\",\n+      type: \"text\",\n+      label: \"Client ID\",\n+      description: (\n+        <>\n+          You will get this from your{\" \"}\n+          <a\n+            tabIndex={-1}\n+            href=\"https://gitea.com/user/settings/applications\"\n+            target=\"_blank\"\n+            className=\"text-custom-primary-100 hover:underline\"\n+            rel=\"noreferrer\"\n+          >\n+            Gitea OAuth application settings.\n+          </a>\n+        </>\n+      ),\n+      placeholder: \"70a44354520df8bd9bcd\",\n+      error: Boolean(errors.GITEA_CLIENT_ID),\n+      required: true,\n+    },\n+    {\n+      key: \"GITEA_CLIENT_SECRET\",\n+      type: \"password\",\n+      label: \"Client secret\",\n+      description: (\n+        <>\n+          Your client secret is also found in your{\" \"}\n+          <a\n+            tabIndex={-1}\n+            href=\"https://gitea.com/user/settings/applications\"\n+            target=\"_blank\"\n+            className=\"text-custom-primary-100 hover:underline\"\n+            rel=\"noreferrer\"\n+          >\n+            Gitea OAuth application settings.\n+          </a>\n+        </>\n+      ),\n+      placeholder: \"9b0050f94ec1b744e32ce79ea4ffacd40d4119cb\",\n+      error: Boolean(errors.GITEA_CLIENT_SECRET),\n+      required: true,\n+    },\n+  ];\n+\n+  const GITEA_SERVICE_FIELD: TCopyField[] = [\n+    {\n+      key: \"Callback_URI\",\n+      label: \"Callback URI\",\n+      url: `${originURL}/auth/gitea/callback/`,\n+      description: (\n+        <>\n+          We will auto-generate this. Paste this into your <CodeBlock darkerShade>Authorized Callback URI</CodeBlock>{\" \"}\n+          field{\" \"}\n+          <a\n+            tabIndex={-1}\n+            href={`${control._formValues.GITEA_HOST || \"https://gitea.com\"}/user/settings/applications`}\n+            target=\"_blank\"\n+            className=\"text-custom-primary-100 hover:underline\"\n+            rel=\"noreferrer\"\n+          >\n+            here.\n+          </a>\n+        </>\n+      ),\n+    },\n+  ];\n+\n+  const onSubmit = async (formData: GiteaConfigFormValues) => {\n+    const payload: Partial<GiteaConfigFormValues> = { ...formData };\n+\n+    await updateInstanceConfigurations(payload)\n+      .then((response = []) => {\n+        setToast({\n+          type: TOAST_TYPE.SUCCESS,\n+          title: \"Done!\",\n+          message: \"Your Gitea authentication is configured. You should test it now.\",\n+        });\n+        reset({\n+          GITEA_HOST: response.find((item) => item.key === \"GITEA_HOST\")?.value,\n+          GITEA_CLIENT_ID: response.find((item) => item.key === \"GITEA_CLIENT_ID\")?.value,\n+          GITEA_CLIENT_SECRET: response.find((item) => item.key === \"GITEA_CLIENT_SECRET\")?.value,\n+        });\n+      })\n+      .catch((err) => console.error(err));\n+  };\n+\n+  const handleGoBack = (e: React.MouseEvent<HTMLAnchorElement, MouseEvent>) => {\n+    if (isDirty) {\n+      e.preventDefault();\n+      setIsDiscardChangesModalOpen(true);\n+    }\n+  };\n+\n+  return (\n+    <>\n+      <ConfirmDiscardModal\n+        isOpen={isDiscardChangesModalOpen}\n+        onDiscardHref=\"/authentication\"\n+        handleClose={() => setIsDiscardChangesModalOpen(false)}\n+      />\n+      <div className=\"flex flex-col gap-8\">\n+        <div className=\"grid grid-cols-2 gap-x-12 gap-y-8 w-full\">\n+          <div className=\"flex flex-col gap-y-4 col-span-2 md:col-span-1 pt-1\">\n+            <div className=\"pt-2.5 text-xl font-medium\">Gitea-provided details for Plane</div>\n+            {GITEA_FORM_FIELDS.map((field) => (\n+              <ControllerInput\n+                key={field.key}\n+                control={control}\n+                type={field.type}\n+                name={field.key}\n+                label={field.label}\n+                description={field.description}\n+                placeholder={field.placeholder}\n+                error={field.error}\n+                required={field.required}\n+              />\n+            ))}\n+            <div className=\"flex flex-col gap-1 pt-4\">\n+              <div className=\"flex items-center gap-4\">\n+                <Button variant=\"primary\" onClick={handleSubmit(onSubmit)} loading={isSubmitting} disabled={!isDirty}>\n+                  {isSubmitting ? \"Saving...\" : \"Save changes\"}\n+                </Button>\n+                <Link\n+                  href=\"/authentication\"\n+                  className={cn(getButtonStyling(\"neutral-primary\", \"md\"), \"font-medium\")}\n+                  onClick={handleGoBack}\n+                >\n+                  Go back\n+                </Link>\n+              </div>\n+            </div>\n+          </div>\n+          <div className=\"col-span-2 md:col-span-1\">\n+            <div className=\"flex flex-col gap-y-4 px-6 pt-1.5 pb-4 bg-custom-background-80/60 rounded-lg\">\n+              <div className=\"pt-2 text-xl font-medium\">Plane-provided details for Gitea</div>\n+              {GITEA_SERVICE_FIELD.map((field) => (\n+                <CopyField key={field.key} label={field.label} url={field.url} description={field.description} />\n+              ))}\n+            </div>\n+          </div>\n+        </div>\n+      </div>\n+    </>\n+  );\n+};\n"
        },
        {
          "path": "apps/admin/app/(all)/(dashboard)/authentication/gitea/layout.tsx",
          "status": "added",
          "diff": "Index: apps/admin/app/(all)/(dashboard)/authentication/gitea/layout.tsx\n===================================================================\n--- apps/admin/app/(all)/(dashboard)/authentication/gitea/layout.tsx\t69fe581 (parent)\n+++ apps/admin/app/(all)/(dashboard)/authentication/gitea/layout.tsx\t1126ca3 (commit)\n@@ -0,0 +1,10 @@\n+import type { ReactNode } from \"react\";\n+import type { Metadata } from \"next\";\n+\n+export const metadata: Metadata = {\n+  title: \"Gitea Authentication - God Mode\",\n+};\n+\n+export default function GiteaAuthenticationLayout({ children }: { children: ReactNode }) {\n+  return <>{children}</>;\n+}\n"
        },
        {
          "path": "apps/admin/app/(all)/(dashboard)/authentication/gitea/page.tsx",
          "status": "added",
          "diff": "Index: apps/admin/app/(all)/(dashboard)/authentication/gitea/page.tsx\n===================================================================\n--- apps/admin/app/(all)/(dashboard)/authentication/gitea/page.tsx\t69fe581 (parent)\n+++ apps/admin/app/(all)/(dashboard)/authentication/gitea/page.tsx\t1126ca3 (commit)\n@@ -0,0 +1,104 @@\n+\"use client\";\n+\n+import { useState } from \"react\";\n+import { observer } from \"mobx-react\";\n+import Image from \"next/image\";\n+import { useTheme } from \"next-themes\";\n+import useSWR from \"swr\";\n+// plane internal packages\n+import { setPromiseToast } from \"@plane/propel/toast\";\n+import { Loader, ToggleSwitch } from \"@plane/ui\";\n+// components\n+import { AuthenticationMethodCard } from \"@/components/authentication/authentication-method-card\";\n+// hooks\n+import { useInstance } from \"@/hooks/store\";\n+// icons\n+import giteaLogo from \"@/public/logos/gitea-logo.svg\";\n+//local components\n+import { InstanceGiteaConfigForm } from \"./form\";\n+\n+const InstanceGiteaAuthenticationPage = observer(() => {\n+  // store\n+  const { fetchInstanceConfigurations, formattedConfig, updateInstanceConfigurations } = useInstance();\n+  // state\n+  const [isSubmitting, setIsSubmitting] = useState<boolean>(false);\n+  // theme\n+  const { resolvedTheme } = useTheme();\n+  // config\n+  const enableGiteaConfig = formattedConfig?.IS_GITEA_ENABLED ?? \"\";\n+  useSWR(\"INSTANCE_CONFIGURATIONS\", () => fetchInstanceConfigurations());\n+\n+  const updateConfig = async (key: \"IS_GITEA_ENABLED\", value: string) => {\n+    setIsSubmitting(true);\n+\n+    const payload = {\n+      [key]: value,\n+    };\n+\n+    const updateConfigPromise = updateInstanceConfigurations(payload);\n+\n+    setPromiseToast(updateConfigPromise, {\n+      loading: \"Saving Configuration...\",\n+      success: {\n+        title: \"Configuration saved\",\n+        message: () => `Gitea authentication is now ${value === \"1\" ? \"active\" : \"disabled\"}.`,\n+      },\n+      error: {\n+        title: \"Error\",\n+        message: () => \"Failed to save configuration\",\n+      },\n+    });\n+\n+    await updateConfigPromise\n+      .then(() => {\n+        setIsSubmitting(false);\n+      })\n+      .catch((err) => {\n+        console.error(err);\n+        setIsSubmitting(false);\n+      });\n+  };\n+\n+  const isGiteaEnabled = enableGiteaConfig === \"1\";\n+\n+  return (\n+    <>\n+      <div className=\"relative container mx-auto w-full h-full p-4 py-4 space-y-6 flex flex-col\">\n+        <div className=\"border-b border-custom-border-100 mx-4 py-4 space-y-1 flex-shrink-0\">\n+          <AuthenticationMethodCard\n+            name=\"Gitea\"\n+            description=\"Allow members to login or sign up to plane with their Gitea accounts.\"\n+            icon={<Image src={giteaLogo} height={24} width={24} alt=\"Gitea Logo\" />}\n+            config={\n+              <ToggleSwitch\n+                value={isGiteaEnabled}\n+                onChange={() => {\n+                  updateConfig(\"IS_GITEA_ENABLED\", isGiteaEnabled ? \"0\" : \"1\");\n+                }}\n+                size=\"sm\"\n+                disabled={isSubmitting || !formattedConfig}\n+              />\n+            }\n+            disabled={isSubmitting || !formattedConfig}\n+            withBorder={false}\n+          />\n+        </div>\n+        <div className=\"flex-grow overflow-hidden overflow-y-scroll vertical-scrollbar scrollbar-md px-4\">\n+          {formattedConfig ? (\n+            <InstanceGiteaConfigForm config={formattedConfig} />\n+          ) : (\n+            <Loader className=\"space-y-8\">\n+              <Loader.Item height=\"50px\" width=\"25%\" />\n+              <Loader.Item height=\"50px\" />\n+              <Loader.Item height=\"50px\" />\n+              <Loader.Item height=\"50px\" />\n+              <Loader.Item height=\"50px\" width=\"50%\" />\n+            </Loader>\n+          )}\n+        </div>\n+      </div>\n+    </>\n+  );\n+});\n+\n+export default InstanceGiteaAuthenticationPage;\n"
        },
        {
          "path": "apps/admin/app/(all)/(dashboard)/authentication/github/page.tsx",
          "status": "modified",
          "diff": "Index: apps/admin/app/(all)/(dashboard)/authentication/github/page.tsx\n===================================================================\n--- apps/admin/app/(all)/(dashboard)/authentication/github/page.tsx\t69fe581 (parent)\n+++ apps/admin/app/(all)/(dashboard)/authentication/github/page.tsx\t1126ca3 (commit)\n@@ -43,9 +43,9 @@\n     setPromiseToast(updateConfigPromise, {\n       loading: \"Saving Configuration...\",\n       success: {\n         title: \"Configuration saved\",\n-        message: () => `GitHub authentication is now ${value ? \"active\" : \"disabled\"}.`,\n+        message: () => `GitHub authentication is now ${value === \"1\" ? \"active\" : \"disabled\"}.`,\n       },\n       error: {\n         title: \"Error\",\n         message: () => \"Failed to save configuration\",\n"
        },
        {
          "path": "apps/admin/app/(all)/(dashboard)/authentication/gitlab/page.tsx",
          "status": "modified",
          "diff": "Index: apps/admin/app/(all)/(dashboard)/authentication/gitlab/page.tsx\n===================================================================\n--- apps/admin/app/(all)/(dashboard)/authentication/gitlab/page.tsx\t69fe581 (parent)\n+++ apps/admin/app/(all)/(dashboard)/authentication/gitlab/page.tsx\t1126ca3 (commit)\n@@ -37,9 +37,9 @@\n     setPromiseToast(updateConfigPromise, {\n       loading: \"Saving Configuration...\",\n       success: {\n         title: \"Configuration saved\",\n-        message: () => `GitLab authentication is now ${value ? \"active\" : \"disabled\"}.`,\n+        message: () => `GitLab authentication is now ${value === \"1\" ? \"active\" : \"disabled\"}.`,\n       },\n       error: {\n         title: \"Error\",\n         message: () => \"Failed to save configuration\",\n"
        },
        {
          "path": "apps/admin/app/(all)/(dashboard)/authentication/google/page.tsx",
          "status": "modified",
          "diff": "Index: apps/admin/app/(all)/(dashboard)/authentication/google/page.tsx\n===================================================================\n--- apps/admin/app/(all)/(dashboard)/authentication/google/page.tsx\t69fe581 (parent)\n+++ apps/admin/app/(all)/(dashboard)/authentication/google/page.tsx\t1126ca3 (commit)\n@@ -37,9 +37,9 @@\n     setPromiseToast(updateConfigPromise, {\n       loading: \"Saving Configuration...\",\n       success: {\n         title: \"Configuration saved\",\n-        message: () => `Google authentication is now ${value ? \"active\" : \"disabled\"}.`,\n+        message: () => `Google authentication is now ${value === \"1\" ? \"active\" : \"disabled\"}.`,\n       },\n       error: {\n         title: \"Error\",\n         message: () => \"Failed to save configuration\",\n"
        },
        {
          "path": "apps/admin/ce/components/authentication/authentication-modes.tsx",
          "status": "modified",
          "diff": "Index: apps/admin/ce/components/authentication/authentication-modes.tsx\n===================================================================\n--- apps/admin/ce/components/authentication/authentication-modes.tsx\t69fe581 (parent)\n+++ apps/admin/ce/components/authentication/authentication-modes.tsx\t1126ca3 (commit)\n@@ -11,15 +11,17 @@\n import { resolveGeneralTheme } from \"@plane/utils\";\n // components\n import { AuthenticationMethodCard } from \"@/components/authentication/authentication-method-card\";\n import { EmailCodesConfiguration } from \"@/components/authentication/email-config-switch\";\n+import { GiteaConfiguration } from \"@/components/authentication/gitea-config\";\n import { GithubConfiguration } from \"@/components/authentication/github-config\";\n import { GitlabConfiguration } from \"@/components/authentication/gitlab-config\";\n import { GoogleConfiguration } from \"@/components/authentication/google-config\";\n import { PasswordLoginConfiguration } from \"@/components/authentication/password-config-switch\";\n // plane admin components\n import { UpgradeButton } from \"@/plane-admin/components/common\";\n // assets\n+import giteaLogo from \"@/public/logos/gitea-logo.svg\";\n import githubLightModeImage from \"@/public/logos/github-black.png\";\n import githubDarkModeImage from \"@/public/logos/github-white.png\";\n import GitlabLogo from \"@/public/logos/gitlab-logo.svg\";\n import GoogleLogo from \"@/public/logos/google-logo.svg\";\n@@ -80,8 +82,15 @@\n     icon: <Image src={GitlabLogo} height={20} width={20} alt=\"GitLab Logo\" />,\n     config: <GitlabConfiguration disabled={disabled} updateConfig={updateConfig} />,\n   },\n   {\n+    key: \"gitea\",\n+    name: \"Gitea\",\n+    description: \"Allow members to log in or sign up to plane with their Gitea accounts.\",\n+    icon: <Image src={giteaLogo} height={20} width={20} alt=\"Gitea Logo\" />,\n+    config: <GiteaConfiguration disabled={disabled} updateConfig={updateConfig} />,\n+  },\n+  {\n     key: \"oidc\",\n     name: \"OIDC\",\n     description: \"Authenticate your users via the OpenID Connect protocol.\",\n     icon: <Image src={OIDCLogo} height={22} width={22} alt=\"OIDC Logo\" />,\n"
        },
        {
          "path": "apps/admin/core/components/authentication/gitea-config.tsx",
          "status": "added",
          "diff": "Index: apps/admin/core/components/authentication/gitea-config.tsx\n===================================================================\n--- apps/admin/core/components/authentication/gitea-config.tsx\t69fe581 (parent)\n+++ apps/admin/core/components/authentication/gitea-config.tsx\t1126ca3 (commit)\n@@ -0,0 +1,58 @@\n+\"use client\";\n+\n+import React from \"react\";\n+import { observer } from \"mobx-react\";\n+import Link from \"next/link\";\n+// icons\n+import { Settings2 } from \"lucide-react\";\n+// plane internal packages\n+import type { TInstanceAuthenticationMethodKeys } from \"@plane/types\";\n+import { ToggleSwitch, getButtonStyling } from \"@plane/ui\";\n+import { cn } from \"@plane/utils\";\n+// hooks\n+import { useInstance } from \"@/hooks/store\";\n+\n+type Props = {\n+  disabled: boolean;\n+  updateConfig: (key: TInstanceAuthenticationMethodKeys, value: string) => void;\n+};\n+\n+export const GiteaConfiguration: React.FC<Props> = observer((props) => {\n+  const { disabled, updateConfig } = props;\n+  // store\n+  const { formattedConfig } = useInstance();\n+  // derived values\n+  const GiteaConfig = formattedConfig?.IS_GITEA_ENABLED ?? \"\";\n+  const GiteaConfigured =\n+    !!formattedConfig?.GITEA_HOST && !!formattedConfig?.GITEA_CLIENT_ID && !!formattedConfig?.GITEA_CLIENT_SECRET;\n+\n+  return (\n+    <>\n+      {GiteaConfigured ? (\n+        <div className=\"flex items-center gap-4\">\n+          <Link href=\"/authentication/gitea\" className={cn(getButtonStyling(\"link-primary\", \"md\"), \"font-medium\")}>\n+            Edit\n+          </Link>\n+          <ToggleSwitch\n+            value={Boolean(parseInt(GiteaConfig))}\n+            onChange={() => {\n+              Boolean(parseInt(GiteaConfig)) === true\n+                ? updateConfig(\"IS_GITEA_ENABLED\", \"0\")\n+                : updateConfig(\"IS_GITEA_ENABLED\", \"1\");\n+            }}\n+            size=\"sm\"\n+            disabled={disabled}\n+          />\n+        </div>\n+      ) : (\n+        <Link\n+          href=\"/authentication/gitea\"\n+          className={cn(getButtonStyling(\"neutral-primary\", \"sm\"), \"text-custom-text-300\")}\n+        >\n+          <Settings2 className=\"h-4 w-4 p-0.5 text-custom-text-300/80\" />\n+          Configure\n+        </Link>\n+      )}\n+    </>\n+  );\n+});\n"
        },
        {
          "path": "apps/admin/public/logos/gitea-logo.svg",
          "status": "added",
          "diff": "Index: apps/admin/public/logos/gitea-logo.svg\n===================================================================\n--- apps/admin/public/logos/gitea-logo.svg\t69fe581 (parent)\n+++ apps/admin/public/logos/gitea-logo.svg\t1126ca3 (commit)\n@@ -0,0 +1,1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 640 640\" width=\"32\" height=\"32\"><path d=\"m395.9 484.2-126.9-61c-12.5-6-17.9-21.2-11.8-33.8l61-126.9c6-12.5 21.2-17.9 33.8-11.8 17.2 8.3 27.1 13 27.1 13l-.1-109.2 16.7-.1.1 117.1s57.4 24.2 83.1 40.1c3.7 2.3 10.2 6.8 12.9 14.4 2.1 6.1 2 13.1-1 19.3l-61 126.9c-6.2 12.7-21.4 18.1-33.9 12\" style=\"fill:#fff\"/><path d=\"M622.7 149.8c-4.1-4.1-9.6-4-9.6-4s-117.2 6.6-177.9 8c-13.3.3-26.5.6-39.6.7v117.2c-5.5-2.6-11.1-5.3-16.6-7.9 0-36.4-.1-109.2-.1-109.2-29 .4-89.2-2.2-89.2-2.2s-141.4-7.1-156.8-8.5c-9.8-.6-22.5-2.1-39 1.5-8.7 1.8-33.5 7.4-53.8 26.9C-4.9 212.4 6.6 276.2 8 285.8c1.7 11.7 6.9 44.2 31.7 72.5 45.8 56.1 144.4 54.8 144.4 54.8s12.1 28.9 30.6 55.5c25 33.1 50.7 58.9 75.7 62 63 0 188.9-.1 188.9-.1s12 .1 28.3-10.3c14-8.5 26.5-23.4 26.5-23.4S547 483 565 451.5c5.5-9.7 10.1-19.1 14.1-28 0 0 55.2-117.1 55.2-231.1-1.1-34.5-9.6-40.6-11.6-42.6M125.6 353.9c-25.9-8.5-36.9-18.7-36.9-18.7S69.6 321.8 60 295.4c-16.5-44.2-1.4-71.2-1.4-71.2s8.4-22.5 38.5-30c13.8-3.7 31-3.1 31-3.1s7.1 59.4 15.7 94.2c7.2 29.2 24.8 77.7 24.8 77.7s-26.1-3.1-43-9.1m300.3 107.6s-6.1 14.5-19.6 15.4c-5.8.4-10.3-1.2-10.3-1.2s-.3-.1-5.3-2.1l-112.9-55s-10.9-5.7-12.8-15.6c-2.2-8.1 2.7-18.1 2.7-18.1L322 273s4.8-9.7 12.2-13c.6-.3 2.3-1 4.5-1.5 8.1-2.1 18 2.8 18 2.8L467.4 315s12.6 5.7 15.3 16.2c1.9 7.4-.5 14-1.8 17.2-6.3 15.4-55 113.1-55 113.1\" style=\"fill:#609926\"/><path d=\"M326.8 380.1c-8.2.1-15.4 5.8-17.3 13.8s2 16.3 9.1 20c7.7 4 17.5 1.8 22.7-5.4 5.1-7.1 4.3-16.9-1.8-23.1l24-49.1c1.5.1 3.7.2 6.2-.5 4.1-.9 7.1-3.6 7.1-3.6 4.2 1.8 8.6 3.8 13.2 6.1 4.8 2.4 9.3 4.9 13.4 7.3.9.5 1.8 1.1 2.8 1.9 1.6 1.3 3.4 3.1 4.7 5.5 1.9 5.5-1.9 14.9-1.9 14.9-2.3 7.6-18.4 40.6-18.4 40.6-8.1-.2-15.3 5-17.7 12.5-2.6 8.1 1.1 17.3 8.9 21.3s17.4 1.7 22.5-5.3c5-6.8 4.6-16.3-1.1-22.6 1.9-3.7 3.7-7.4 5.6-11.3 5-10.4 13.5-30.4 13.5-30.4.9-1.7 5.7-10.3 2.7-21.3-2.5-11.4-12.6-16.7-12.6-16.7-12.2-7.9-29.2-15.2-29.2-15.2s0-4.1-1.1-7.1c-1.1-3.1-2.8-5.1-3.9-6.3 4.7-9.7 9.4-19.3 14.1-29-4.1-2-8.1-4-12.2-6.1-4.8 9.8-9.7 19.7-14.5 29.5-6.7-.1-12.9 3.5-16.1 9.4-3.4 6.3-2.7 14.1 1.9 19.8z\" style=\"fill:#609926\"/></svg>\n\\ No newline at end of file\n"
        },
        {
          "path": "apps/api/plane/authentication/adapter/error.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/authentication/adapter/error.py\n===================================================================\n--- apps/api/plane/authentication/adapter/error.py\t69fe581 (parent)\n+++ apps/api/plane/authentication/adapter/error.py\t1126ca3 (commit)\n@@ -37,11 +37,13 @@\n     \"GOOGLE_NOT_CONFIGURED\": 5105,\n     \"GITHUB_NOT_CONFIGURED\": 5110,\n     \"GITHUB_USER_NOT_IN_ORG\": 5122,\n     \"GITLAB_NOT_CONFIGURED\": 5111,\n+    \"GITEA_NOT_CONFIGURED\": 5112,\n     \"GOOGLE_OAUTH_PROVIDER_ERROR\": 5115,\n     \"GITHUB_OAUTH_PROVIDER_ERROR\": 5120,\n     \"GITLAB_OAUTH_PROVIDER_ERROR\": 5121,\n+    \"GITEA_OAUTH_PROVIDER_ERROR\": 5123,\n     # Reset Password\n     \"INVALID_PASSWORD_TOKEN\": 5125,\n     \"EXPIRED_PASSWORD_TOKEN\": 5130,\n     # Change password\n"
        },
        {
          "path": "apps/api/plane/authentication/adapter/oauth.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/authentication/adapter/oauth.py\n===================================================================\n--- apps/api/plane/authentication/adapter/oauth.py\t69fe581 (parent)\n+++ apps/api/plane/authentication/adapter/oauth.py\t1126ca3 (commit)\n@@ -47,8 +47,10 @@\n         elif self.provider == \"github\":\n             return \"GITHUB_OAUTH_PROVIDER_ERROR\"\n         elif self.provider == \"gitlab\":\n             return \"GITLAB_OAUTH_PROVIDER_ERROR\"\n+        elif self.provider == \"gitea\":\n+            return \"GITEA_OAUTH_PROVIDER_ERROR\"\n         else:\n             return \"OAUTH_NOT_CONFIGURED\"\n \n     def get_auth_url(self):\n"
        },
        {
          "path": "apps/api/plane/authentication/provider/oauth/gitea.py",
          "status": "added",
          "diff": "Index: apps/api/plane/authentication/provider/oauth/gitea.py\n===================================================================\n--- apps/api/plane/authentication/provider/oauth/gitea.py\t69fe581 (parent)\n+++ apps/api/plane/authentication/provider/oauth/gitea.py\t1126ca3 (commit)\n@@ -0,0 +1,171 @@\n+import os\n+from datetime import datetime, timedelta\n+from urllib.parse import urlencode, urlparse\n+import pytz\n+import requests\n+\n+# Module imports\n+from plane.authentication.adapter.oauth import OauthAdapter\n+from plane.license.utils.instance_value import get_configuration_value\n+from plane.authentication.adapter.error import (\n+    AUTHENTICATION_ERROR_CODES,\n+    AuthenticationException,\n+)\n+\n+\n+class GiteaOAuthProvider(OauthAdapter):\n+    provider = \"gitea\"\n+    scope = \"openid email profile\"\n+\n+    def __init__(self, request, code=None, state=None, callback=None):\n+        (GITEA_CLIENT_ID, GITEA_CLIENT_SECRET, GITEA_HOST) = get_configuration_value(\n+            [\n+                {\n+                    \"key\": \"GITEA_CLIENT_ID\",\n+                    \"default\": os.environ.get(\"GITEA_CLIENT_ID\"),\n+                },\n+                {\n+                    \"key\": \"GITEA_CLIENT_SECRET\",\n+                    \"default\": os.environ.get(\"GITEA_CLIENT_SECRET\"),\n+                },\n+                {\n+                    \"key\": \"GITEA_HOST\",\n+                    \"default\": os.environ.get(\"GITEA_HOST\"),\n+                },\n+            ]\n+        )\n+\n+        if not (GITEA_CLIENT_ID and GITEA_CLIENT_SECRET and GITEA_HOST):\n+            raise AuthenticationException(\n+                error_code=AUTHENTICATION_ERROR_CODES[\"GITEA_NOT_CONFIGURED\"],\n+                error_message=\"GITEA_NOT_CONFIGURED\",\n+            )\n+\n+        # Enforce scheme and normalize trailing slash(es)\n+        parsed = urlparse(GITEA_HOST)\n+        if not parsed.scheme or parsed.scheme not in (\"https\", \"http\"):\n+            raise AuthenticationException(\n+                error_code=AUTHENTICATION_ERROR_CODES[\"GITEA_NOT_CONFIGURED\"],\n+                error_message=\"GITEA_NOT_CONFIGURED\",  # avoid leaking details to query params\n+            )\n+        GITEA_HOST = GITEA_HOST.rstrip(\"/\")\n+\n+        # Set URLs based on the host\n+        self.token_url = f\"{GITEA_HOST}/login/oauth/access_token\"\n+        self.userinfo_url = f\"{GITEA_HOST}/api/v1/user\"\n+\n+        client_id = GITEA_CLIENT_ID\n+        client_secret = GITEA_CLIENT_SECRET\n+\n+        redirect_uri = f\"{'https' if request.is_secure() else 'http'}://{request.get_host()}/auth/gitea/callback/\"\n+        url_params = {\n+            \"client_id\": client_id,\n+            \"scope\": self.scope,\n+            \"redirect_uri\": redirect_uri,\n+            \"response_type\": \"code\",\n+            \"state\": state,\n+        }\n+        auth_url = f\"{GITEA_HOST}/login/oauth/authorize?{urlencode(url_params)}\"\n+\n+        super().__init__(\n+            request,\n+            self.provider,\n+            client_id,\n+            self.scope,\n+            redirect_uri,\n+            auth_url,\n+            self.token_url,\n+            self.userinfo_url,\n+            client_secret,\n+            code,\n+            callback=callback,\n+        )\n+\n+    def set_token_data(self):\n+        data = {\n+            \"code\": self.code,\n+            \"client_id\": self.client_id,\n+            \"client_secret\": self.client_secret,\n+            \"redirect_uri\": self.redirect_uri,\n+            \"grant_type\": \"authorization_code\",\n+        }\n+        headers = {\"Accept\": \"application/json\"}\n+        token_response = self.get_user_token(data=data, headers=headers)\n+        super().set_token_data(\n+            {\n+                \"access_token\": token_response.get(\"access_token\"),\n+                \"refresh_token\": token_response.get(\"refresh_token\", None),\n+                \"access_token_expired_at\": (\n+                    datetime.now(tz=pytz.utc) + timedelta(seconds=token_response.get(\"expires_in\"))\n+                    if token_response.get(\"expires_in\")\n+                    else None\n+                ),\n+                \"refresh_token_expired_at\": (\n+                    datetime.fromtimestamp(\n+                        token_response.get(\"refresh_token_expired_at\"), tz=pytz.utc\n+                    )\n+                    if token_response.get(\"refresh_token_expired_at\")\n+                    else None\n+                ),\n+                \"id_token\": token_response.get(\"id_token\", \"\"),\n+            }\n+        )\n+\n+    def __get_email(self, headers):\n+        try:\n+            # Gitea may not provide email in user response, so fetch it separately\n+            emails_url = f\"{self.userinfo_url}/emails\"\n+            response = requests.get(emails_url, headers=headers)\n+            if not response.ok:\n+                raise AuthenticationException(\n+                    error_code=AUTHENTICATION_ERROR_CODES[\"GITEA_OAUTH_PROVIDER_ERROR\"],\n+                    error_message=\"GITEA_OAUTH_PROVIDER_ERROR: Failed to fetch emails\",\n+                )\n+            emails_response = response.json()\n+\n+            if not emails_response:\n+                raise AuthenticationException(\n+                    error_code=AUTHENTICATION_ERROR_CODES[\"GITEA_OAUTH_PROVIDER_ERROR\"],\n+                    error_message=\"GITEA_OAUTH_PROVIDER_ERROR: No emails found\",\n+                )\n+            # Prefer primary+verified, then any verified, then primary, else first\n+            email = next((e.get(\"email\") for e in emails_response if e.get(\"primary\") and e.get(\"verified\")), None)\n+            if not email:\n+                email = next((e.get(\"email\") for e in emails_response if e.get(\"verified\")), None)\n+            if not email:\n+                email = next((e.get(\"email\") for e in emails_response if e.get(\"primary\")), None)\n+            if not email and emails_response:\n+                # If no primary email, use the first one\n+                email = emails_response[0].get(\"email\")\n+            return email\n+        except requests.RequestException:\n+            raise AuthenticationException(\n+                error_code=AUTHENTICATION_ERROR_CODES[\"GITEA_OAUTH_PROVIDER_ERROR\"],\n+                error_message=\"GITEA_OAUTH_PROVIDER_ERROR: Exception occurred while fetching emails\",\n+            )\n+\n+    def set_user_data(self):\n+        user_info_response = self.get_user_response()\n+        headers = {\n+            \"Authorization\": f\"Bearer {self.token_data.get('access_token')}\",\n+            \"Accept\": \"application/json\",\n+        }\n+\n+        # Get email if not provided in user info\n+        email = user_info_response.get(\"email\")\n+        if not email:\n+            email = self.__get_email(headers=headers)\n+\n+        super().set_user_data(\n+            {\n+                \"email\": email,\n+                \"user\": {\n+                    \"provider_id\": str(user_info_response.get(\"id\")),\n+                    \"email\": email,\n+                    \"avatar\": user_info_response.get(\"avatar_url\"),\n+                    \"first_name\": user_info_response.get(\"full_name\") or user_info_response.get(\"login\"),\n+                    \"last_name\": \"\",  # Gitea doesn't provide separate first/last name\n+                    \"is_password_autoset\": True,\n+                },\n+            }\n+        )\n\\ No newline at end of file\n"
        },
        {
          "path": "apps/api/plane/authentication/urls.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/authentication/urls.py\n===================================================================\n--- apps/api/plane/authentication/urls.py\t69fe581 (parent)\n+++ apps/api/plane/authentication/urls.py\t1126ca3 (commit)\n@@ -35,8 +35,12 @@\n     MagicSignUpSpaceEndpoint,\n     SignInAuthSpaceEndpoint,\n     SignUpAuthSpaceEndpoint,\n     SignOutAuthSpaceEndpoint,\n+    GiteaCallbackEndpoint,\n+    GiteaOauthInitiateEndpoint,\n+    GiteaCallbackSpaceEndpoint,\n+    GiteaOauthInitiateSpaceEndpoint,\n )\n \n urlpatterns = [\n     # credentials\n@@ -128,5 +132,18 @@\n         name=\"space-forgot-password\",\n     ),\n     path(\"change-password/\", ChangePasswordEndpoint.as_view(), name=\"forgot-password\"),\n     path(\"set-password/\", SetUserPasswordEndpoint.as_view(), name=\"set-password\"),\n+    ## Gitea Oauth\n+    path(\"gitea/\", GiteaOauthInitiateEndpoint.as_view(), name=\"gitea-initiate\"),\n+    path(\"gitea/callback/\", GiteaCallbackEndpoint.as_view(), name=\"gitea-callback\"),\n+    path(\n+        \"spaces/gitea/\",\n+        GiteaOauthInitiateSpaceEndpoint.as_view(),\n+        name=\"space-gitea-initiate\",\n+    ),\n+    path(\n+        \"spaces/gitea/callback/\",\n+        GiteaCallbackSpaceEndpoint.as_view(),\n+        name=\"space-gitea-callback\",\n+    ),\n ]\n"
        },
        {
          "path": "apps/api/plane/authentication/views/__init__.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/authentication/views/__init__.py\n===================================================================\n--- apps/api/plane/authentication/views/__init__.py\t69fe581 (parent)\n+++ apps/api/plane/authentication/views/__init__.py\t1126ca3 (commit)\n@@ -4,8 +4,9 @@\n \n from .app.email import SignInAuthEndpoint, SignUpAuthEndpoint\n from .app.github import GitHubCallbackEndpoint, GitHubOauthInitiateEndpoint\n from .app.gitlab import GitLabCallbackEndpoint, GitLabOauthInitiateEndpoint\n+from .app.gitea import GiteaCallbackEndpoint, GiteaOauthInitiateEndpoint\n from .app.google import GoogleCallbackEndpoint, GoogleOauthInitiateEndpoint\n from .app.magic import MagicGenerateEndpoint, MagicSignInEndpoint, MagicSignUpEndpoint\n \n from .app.signout import SignOutAuthEndpoint\n@@ -16,8 +17,10 @@\n from .space.github import GitHubCallbackSpaceEndpoint, GitHubOauthInitiateSpaceEndpoint\n \n from .space.gitlab import GitLabCallbackSpaceEndpoint, GitLabOauthInitiateSpaceEndpoint\n \n+from .space.gitea import GiteaCallbackSpaceEndpoint, GiteaOauthInitiateSpaceEndpoint\n+\n from .space.google import GoogleCallbackSpaceEndpoint, GoogleOauthInitiateSpaceEndpoint\n \n from .space.magic import (\n     MagicGenerateSpaceEndpoint,\n"
        },
        {
          "path": "apps/api/plane/authentication/views/app/gitea.py",
          "status": "added",
          "diff": "Index: apps/api/plane/authentication/views/app/gitea.py\n===================================================================\n--- apps/api/plane/authentication/views/app/gitea.py\t69fe581 (parent)\n+++ apps/api/plane/authentication/views/app/gitea.py\t1126ca3 (commit)\n@@ -0,0 +1,109 @@\n+import uuid\n+from urllib.parse import urlencode, urljoin\n+\n+# Django import\n+from django.http import HttpResponseRedirect\n+from django.views import View\n+\n+# Module imports\n+from plane.authentication.provider.oauth.gitea import GiteaOAuthProvider\n+from plane.authentication.utils.login import user_login\n+from plane.authentication.utils.redirection_path import get_redirection_path\n+from plane.authentication.utils.user_auth_workflow import post_user_auth_workflow\n+from plane.license.models import Instance\n+from plane.authentication.utils.host import base_host\n+from plane.authentication.adapter.error import (\n+    AuthenticationException,\n+    AUTHENTICATION_ERROR_CODES,\n+)\n+from plane.utils.path_validator import validate_next_path\n+\n+\n+class GiteaOauthInitiateEndpoint(View):\n+    def get(self, request):\n+        # Get host and next path\n+        request.session[\"host\"] = base_host(request=request, is_app=True)\n+        next_path = request.GET.get(\"next_path\")\n+        if next_path:\n+            request.session[\"next_path\"] = str(validate_next_path(next_path))\n+\n+        # Check instance configuration\n+        instance = Instance.objects.first()\n+        if instance is None or not instance.is_setup_done:\n+            exc = AuthenticationException(\n+                error_code=AUTHENTICATION_ERROR_CODES[\"INSTANCE_NOT_CONFIGURED\"],\n+                error_message=\"INSTANCE_NOT_CONFIGURED\",\n+            )\n+            params = exc.get_error_dict()\n+            if next_path:\n+                params[\"next_path\"] = str(validate_next_path(next_path))\n+            url = urljoin(\n+                base_host(request=request, is_app=True), \"?\" + urlencode(params)\n+            )\n+            return HttpResponseRedirect(url)\n+        try:\n+            state = uuid.uuid4().hex\n+            provider = GiteaOAuthProvider(request=request, state=state)\n+            request.session[\"state\"] = state\n+            auth_url = provider.get_auth_url()\n+            return HttpResponseRedirect(auth_url)\n+        except AuthenticationException as e:\n+            params = e.get_error_dict()\n+            if next_path:\n+                params[\"next_path\"] = str(validate_next_path(next_path))\n+            url = urljoin(\n+                base_host(request=request, is_app=True), \"?\" + urlencode(params)\n+            )\n+            return HttpResponseRedirect(url)\n+\n+\n+class GiteaCallbackEndpoint(View):\n+    def get(self, request):\n+        code = request.GET.get(\"code\")\n+        state = request.GET.get(\"state\")\n+        base_host = request.session.get(\"host\")\n+        next_path = request.session.get(\"next_path\")\n+\n+        if state != request.session.get(\"state\", \"\"):\n+            exc = AuthenticationException(\n+                error_code=AUTHENTICATION_ERROR_CODES[\"GITEA_OAUTH_PROVIDER_ERROR\"],\n+                error_message=\"GITEA_OAUTH_PROVIDER_ERROR\",\n+            )\n+            params = exc.get_error_dict()\n+            if next_path:\n+                params[\"next_path\"] = str(next_path)\n+            url = urljoin(base_host, \"?\" + urlencode(params))\n+            return HttpResponseRedirect(url)\n+\n+        if not code:\n+            exc = AuthenticationException(\n+                error_code=AUTHENTICATION_ERROR_CODES[\"GITEA_OAUTH_PROVIDER_ERROR\"],\n+                error_message=\"GITEA_OAUTH_PROVIDER_ERROR\",\n+            )\n+            params = exc.get_error_dict()\n+            if next_path:\n+                params[\"next_path\"] = str(validate_next_path(next_path))\n+            url = urljoin(base_host, \"?\" + urlencode(params))\n+            return HttpResponseRedirect(url)\n+\n+        try:\n+            provider = GiteaOAuthProvider(\n+                request=request, code=code, callback=post_user_auth_workflow\n+            )\n+            user = provider.authenticate()\n+            # Login the user and record his device info\n+            user_login(request=request, user=user, is_app=True)\n+            # Get the redirection path\n+            if next_path:\n+                path = str(validate_next_path(next_path))\n+            else:\n+                path = get_redirection_path(user=user)\n+            # redirect to referer path\n+            url = urljoin(base_host, path)\n+            return HttpResponseRedirect(url)\n+        except AuthenticationException as e:\n+            params = e.get_error_dict()\n+            if next_path:\n+                params[\"next_path\"] = str(validate_next_path(next_path))\n+            url = urljoin(base_host, \"?\" + urlencode(params))\n+            return HttpResponseRedirect(url)\n"
        },
        {
          "path": "apps/api/plane/authentication/views/space/gitea.py",
          "status": "added",
          "diff": "Index: apps/api/plane/authentication/views/space/gitea.py\n===================================================================\n--- apps/api/plane/authentication/views/space/gitea.py\t69fe581 (parent)\n+++ apps/api/plane/authentication/views/space/gitea.py\t1126ca3 (commit)\n@@ -0,0 +1,100 @@\n+# Python imports\n+import uuid\n+from urllib.parse import urlencode\n+\n+# Django import\n+from django.http import HttpResponseRedirect\n+from django.views import View\n+\n+# Module imports\n+from plane.authentication.provider.oauth.gitea import GiteaOAuthProvider\n+from plane.authentication.utils.login import user_login\n+from plane.license.models import Instance\n+from plane.authentication.utils.host import base_host\n+from plane.authentication.adapter.error import (\n+    AUTHENTICATION_ERROR_CODES,\n+    AuthenticationException,\n+)\n+from plane.utils.path_validator import validate_next_path\n+\n+\n+class GiteaOauthInitiateSpaceEndpoint(View):\n+    def get(self, request):\n+        # Get host and next path\n+        request.session[\"host\"] = base_host(request=request, is_space=True)\n+        next_path = request.GET.get(\"next_path\")\n+        if next_path:\n+            request.session[\"next_path\"] = str(validate_next_path(next_path))\n+\n+        # Check instance configuration\n+        instance = Instance.objects.first()\n+        if instance is None or not instance.is_setup_done:\n+            exc = AuthenticationException(\n+                error_code=AUTHENTICATION_ERROR_CODES[\"INSTANCE_NOT_CONFIGURED\"],\n+                error_message=\"INSTANCE_NOT_CONFIGURED\",\n+            )\n+            params = exc.get_error_dict()\n+            if next_path:\n+                params[\"next_path\"] = str(validate_next_path(next_path))\n+            url = f\"{base_host(request=request, is_space=True)}?{urlencode(params)}\"\n+            return HttpResponseRedirect(url)\n+\n+        try:\n+            state = uuid.uuid4().hex\n+            provider = GiteaOAuthProvider(request=request, state=state)\n+            request.session[\"state\"] = state\n+            auth_url = provider.get_auth_url()\n+            return HttpResponseRedirect(auth_url)\n+        except AuthenticationException as e:\n+            params = e.get_error_dict()\n+            if next_path:\n+                params[\"next_path\"] = str(next_path)\n+            url = f\"{base_host(request=request, is_space=True)}?{urlencode(params)}\"\n+            return HttpResponseRedirect(url)\n+\n+\n+class GiteaCallbackSpaceEndpoint(View):\n+    def get(self, request):\n+        code = request.GET.get(\"code\")\n+        state = request.GET.get(\"state\")\n+        next_path = request.session.get(\"next_path\")\n+\n+        if state != request.session.get(\"state\", \"\"):\n+            exc = AuthenticationException(\n+                error_code=AUTHENTICATION_ERROR_CODES[\"GITEA_OAUTH_PROVIDER_ERROR\"],\n+                error_message=\"GITEA_OAUTH_PROVIDER_ERROR\",\n+            )\n+            params = exc.get_error_dict()\n+            if next_path:\n+                params[\"next_path\"] = str(validate_next_path(next_path))\n+            url = f\"{base_host(request=request, is_space=True)}?{urlencode(params)}\"\n+            return HttpResponseRedirect(url)\n+\n+        if not code:\n+            exc = AuthenticationException(\n+                error_code=AUTHENTICATION_ERROR_CODES[\"GITEA_OAUTH_PROVIDER_ERROR\"],\n+                error_message=\"GITEA_OAUTH_PROVIDER_ERROR\",\n+            )\n+            params = exc.get_error_dict()\n+            if next_path:\n+                params[\"next_path\"] = str(validate_next_path(next_path))\n+            url = f\"{base_host(request=request, is_space=True)}?{urlencode(params)}\"\n+            return HttpResponseRedirect(url)\n+\n+        try:\n+            provider = GiteaOAuthProvider(request=request, code=code)\n+            user = provider.authenticate()\n+            # Login the user and record his device info\n+            user_login(request=request, user=user, is_space=True)\n+            # Process workspace and project invitations\n+            # redirect to referer path\n+            url = (\n+                f\"{base_host(request=request, is_space=True)}{str(validate_next_path(next_path)) if next_path else ''}\"\n+            )\n+            return HttpResponseRedirect(url)\n+        except AuthenticationException as e:\n+            params = e.get_error_dict()\n+            if next_path:\n+                params[\"next_path\"] = str(validate_next_path(next_path))\n+            url = f\"{base_host(request=request, is_space=True)}?{urlencode(params)}\"\n+            return HttpResponseRedirect(url)\n"
        },
        {
          "path": "apps/api/plane/license/api/views/instance.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/license/api/views/instance.py\n===================================================================\n--- apps/api/plane/license/api/views/instance.py\t69fe581 (parent)\n+++ apps/api/plane/license/api/views/instance.py\t1126ca3 (commit)\n@@ -49,8 +49,9 @@\n             IS_GOOGLE_ENABLED,\n             IS_GITHUB_ENABLED,\n             GITHUB_APP_NAME,\n             IS_GITLAB_ENABLED,\n+            IS_GITEA_ENABLED,\n             EMAIL_HOST,\n             ENABLE_MAGIC_LINK_LOGIN,\n             ENABLE_EMAIL_PASSWORD,\n             SLACK_CLIENT_ID,\n@@ -85,8 +86,12 @@\n                 {\n                     \"key\": \"IS_GITLAB_ENABLED\",\n                     \"default\": os.environ.get(\"IS_GITLAB_ENABLED\", \"0\"),\n                 },\n+                {\n+                    \"key\": \"IS_GITEA_ENABLED\",\n+                    \"default\": os.environ.get(\"IS_GITEA_ENABLED\", \"0\"),\n+                },\n                 {\"key\": \"EMAIL_HOST\", \"default\": os.environ.get(\"EMAIL_HOST\", \"\")},\n                 {\n                     \"key\": \"ENABLE_MAGIC_LINK_LOGIN\",\n                     \"default\": os.environ.get(\"ENABLE_MAGIC_LINK_LOGIN\", \"1\"),\n@@ -133,8 +138,9 @@\n         data[\"is_workspace_creation_disabled\"] = DISABLE_WORKSPACE_CREATION == \"1\"\n         data[\"is_google_enabled\"] = IS_GOOGLE_ENABLED == \"1\"\n         data[\"is_github_enabled\"] = IS_GITHUB_ENABLED == \"1\"\n         data[\"is_gitlab_enabled\"] = IS_GITLAB_ENABLED == \"1\"\n+        data[\"is_gitea_enabled\"] = IS_GITEA_ENABLED == \"1\"\n         data[\"is_magic_login_enabled\"] = ENABLE_MAGIC_LINK_LOGIN == \"1\"\n         data[\"is_email_password_enabled\"] = ENABLE_EMAIL_PASSWORD == \"1\"\n \n         # Github app name\n"
        },
        {
          "path": "apps/api/plane/license/management/commands/configure_instance.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/license/management/commands/configure_instance.py\n===================================================================\n--- apps/api/plane/license/management/commands/configure_instance.py\t69fe581 (parent)\n+++ apps/api/plane/license/management/commands/configure_instance.py\t1126ca3 (commit)\n@@ -186,8 +186,32 @@\n                 \"value\": os.environ.get(\"INTERCOM_APP_ID\", \"\"),\n                 \"category\": \"INTERCOM\",\n                 \"is_encrypted\": False,\n             },\n+            {\n+                \"key\": \"IS_GITEA_ENABLED\",\n+                \"value\": os.environ.get(\"IS_GITEA_ENABLED\", \"0\"),\n+                \"category\": \"GITEA\",\n+                \"is_encrypted\": False,\n+            },\n+            {\n+                \"key\": \"GITEA_HOST\",\n+                \"value\": os.environ.get(\"GITEA_HOST\"),\n+                \"category\": \"GITEA\",\n+                \"is_encrypted\": False,\n+            },\n+            {\n+                \"key\": \"GITEA_CLIENT_ID\",\n+                \"value\": os.environ.get(\"GITEA_CLIENT_ID\"),\n+                \"category\": \"GITEA\",\n+                \"is_encrypted\": False,\n+            },\n+            {\n+                \"key\": \"GITEA_CLIENT_SECRET\",\n+                \"value\": os.environ.get(\"GITEA_CLIENT_SECRET\"),\n+                \"category\": \"GITEA\",\n+                \"is_encrypted\": True,\n+            },\n         ]\n \n         for item in config_keys:\n             obj, created = InstanceConfiguration.objects.get_or_create(key=item.get(\"key\"))\n@@ -202,9 +226,9 @@\n                 self.stdout.write(self.style.SUCCESS(f\"{obj.key} loaded with value from environment variable.\"))\n             else:\n                 self.stdout.write(self.style.WARNING(f\"{obj.key} configuration already exists\"))\n \n-        keys = [\"IS_GOOGLE_ENABLED\", \"IS_GITHUB_ENABLED\", \"IS_GITLAB_ENABLED\"]\n+        keys = [\"IS_GOOGLE_ENABLED\", \"IS_GITHUB_ENABLED\", \"IS_GITLAB_ENABLED\", \"IS_GITEA_ENABLED\"]\n         if not InstanceConfiguration.objects.filter(key__in=keys).exists():\n             for key in keys:\n                 if key == \"IS_GOOGLE_ENABLED\":\n                     GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET = get_configuration_value(\n@@ -281,7 +305,49 @@\n                         category=\"AUTHENTICATION\",\n                         is_encrypted=False,\n                     )\n                     self.stdout.write(self.style.SUCCESS(f\"{key} loaded with value from environment variable.\"))\n+                if key == \"IS_GITEA_ENABLED\":\n+                    GITEA_HOST, GITEA_CLIENT_ID, GITEA_CLIENT_SECRET = (\n+                        get_configuration_value(\n+                            [\n+                                {\n+                                    \"key\": \"GITEA_HOST\",\n+                                    \"default\": os.environ.get(\n+                                        \"GITEA_HOST\", \"\"\n+                                    ),\n+                                },\n+                                {\n+                                    \"key\": \"GITEA_CLIENT_ID\",\n+                                    \"default\": os.environ.get(\"GITEA_CLIENT_ID\", \"\"),\n+                                },\n+                                {\n+                                    \"key\": \"GITEA_CLIENT_SECRET\",\n+                                    \"default\": os.environ.get(\n+                                        \"GITEA_CLIENT_SECRET\", \"\"\n+                                    ),\n+                                },\n+                            ]\n+                        )\n+                    )\n+                    if (\n+                        bool(GITEA_HOST)\n+                        and bool(GITEA_CLIENT_ID)\n+                        and bool(GITEA_CLIENT_SECRET)\n+                    ):\n+                        value = \"1\"\n+                    else:\n+                        value = \"0\"\n+                    InstanceConfiguration.objects.create(\n+                        key=\"IS_GITEA_ENABLED\",\n+                        value=value,\n+                        category=\"AUTHENTICATION\",\n+                        is_encrypted=False,\n+                    )\n+                    self.stdout.write(\n+                        self.style.SUCCESS(\n+                            f\"{key} loaded with value from environment variable.\"\n+                        )\n+                    )\n         else:\n             for key in keys:\n                 self.stdout.write(self.style.WARNING(f\"{key} configuration already exists\"))\n"
        },
        {
          "path": "apps/space/core/components/account/auth-forms/auth-root.tsx",
          "status": "modified",
          "diff": "Index: apps/space/core/components/account/auth-forms/auth-root.tsx\n===================================================================\n--- apps/space/core/components/account/auth-forms/auth-root.tsx\t69fe581 (parent)\n+++ apps/space/core/components/account/auth-forms/auth-root.tsx\t1126ca3 (commit)\n@@ -23,8 +23,9 @@\n import GithubLightLogo from \"/public/logos/github-black.png\";\n import GithubDarkLogo from \"/public/logos/github-dark.svg\";\n import GitlabLogo from \"/public/logos/gitlab-logo.svg\";\n import GoogleLogo from \"/public/logos/google-logo.svg\";\n+import GiteaLogo from \"/public/logos/gitea-logo.svg\";\n // local imports\n import { TermsAndConditions } from \"../terms-and-conditions\";\n import { AuthBanner } from \"./auth-banner\";\n import { AuthHeader } from \"./auth-header\";\n@@ -91,9 +92,14 @@\n   const isSMTPConfigured = config?.is_smtp_configured || false;\n   const isMagicLoginEnabled = config?.is_magic_login_enabled || false;\n   const isEmailPasswordEnabled = config?.is_email_password_enabled || false;\n   const isOAuthEnabled =\n-    (config && (config?.is_google_enabled || config?.is_github_enabled || config?.is_gitlab_enabled)) || false;\n+    (config &&\n+      (config?.is_google_enabled ||\n+        config?.is_github_enabled ||\n+        config?.is_gitlab_enabled ||\n+        config?.is_gitea_enabled)) ||\n+    false;\n \n   // submit handler- email verification\n   const handleEmailVerification = async (data: IEmailCheckData) => {\n     setEmail(data.email);\n@@ -188,8 +194,17 @@\n         window.location.assign(`${API_BASE_URL}/auth/gitlab/${next_path ? `?next_path=${next_path}` : ``}`);\n       },\n       enabled: config?.is_gitlab_enabled,\n     },\n+    {\n+      id: \"gitea\",\n+      text: `${content} with Gitea`,\n+      icon: <Image src={GiteaLogo} height={18} width={18} alt=\"Gitea Logo\" />,\n+      onClick: () => {\n+        window.location.assign(`${API_BASE_URL}/auth/gitea/${next_path ? `?next_path=${next_path}` : ``}`);\n+      },\n+      enabled: config?.is_gitea_enabled,\n+    },\n   ];\n \n   return (\n     <div className=\"flex flex-col justify-center items-center flex-grow w-full py-6 mt-10\">\n"
        },
        {
          "path": "apps/space/public/logos/gitea-logo.svg",
          "status": "added",
          "diff": "Index: apps/space/public/logos/gitea-logo.svg\n===================================================================\n--- apps/space/public/logos/gitea-logo.svg\t69fe581 (parent)\n+++ apps/space/public/logos/gitea-logo.svg\t1126ca3 (commit)\n@@ -0,0 +1,1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 640 640\" width=\"32\" height=\"32\"><path d=\"m395.9 484.2-126.9-61c-12.5-6-17.9-21.2-11.8-33.8l61-126.9c6-12.5 21.2-17.9 33.8-11.8 17.2 8.3 27.1 13 27.1 13l-.1-109.2 16.7-.1.1 117.1s57.4 24.2 83.1 40.1c3.7 2.3 10.2 6.8 12.9 14.4 2.1 6.1 2 13.1-1 19.3l-61 126.9c-6.2 12.7-21.4 18.1-33.9 12\" style=\"fill:#fff\"/><path d=\"M622.7 149.8c-4.1-4.1-9.6-4-9.6-4s-117.2 6.6-177.9 8c-13.3.3-26.5.6-39.6.7v117.2c-5.5-2.6-11.1-5.3-16.6-7.9 0-36.4-.1-109.2-.1-109.2-29 .4-89.2-2.2-89.2-2.2s-141.4-7.1-156.8-8.5c-9.8-.6-22.5-2.1-39 1.5-8.7 1.8-33.5 7.4-53.8 26.9C-4.9 212.4 6.6 276.2 8 285.8c1.7 11.7 6.9 44.2 31.7 72.5 45.8 56.1 144.4 54.8 144.4 54.8s12.1 28.9 30.6 55.5c25 33.1 50.7 58.9 75.7 62 63 0 188.9-.1 188.9-.1s12 .1 28.3-10.3c14-8.5 26.5-23.4 26.5-23.4S547 483 565 451.5c5.5-9.7 10.1-19.1 14.1-28 0 0 55.2-117.1 55.2-231.1-1.1-34.5-9.6-40.6-11.6-42.6M125.6 353.9c-25.9-8.5-36.9-18.7-36.9-18.7S69.6 321.8 60 295.4c-16.5-44.2-1.4-71.2-1.4-71.2s8.4-22.5 38.5-30c13.8-3.7 31-3.1 31-3.1s7.1 59.4 15.7 94.2c7.2 29.2 24.8 77.7 24.8 77.7s-26.1-3.1-43-9.1m300.3 107.6s-6.1 14.5-19.6 15.4c-5.8.4-10.3-1.2-10.3-1.2s-.3-.1-5.3-2.1l-112.9-55s-10.9-5.7-12.8-15.6c-2.2-8.1 2.7-18.1 2.7-18.1L322 273s4.8-9.7 12.2-13c.6-.3 2.3-1 4.5-1.5 8.1-2.1 18 2.8 18 2.8L467.4 315s12.6 5.7 15.3 16.2c1.9 7.4-.5 14-1.8 17.2-6.3 15.4-55 113.1-55 113.1\" style=\"fill:#609926\"/><path d=\"M326.8 380.1c-8.2.1-15.4 5.8-17.3 13.8s2 16.3 9.1 20c7.7 4 17.5 1.8 22.7-5.4 5.1-7.1 4.3-16.9-1.8-23.1l24-49.1c1.5.1 3.7.2 6.2-.5 4.1-.9 7.1-3.6 7.1-3.6 4.2 1.8 8.6 3.8 13.2 6.1 4.8 2.4 9.3 4.9 13.4 7.3.9.5 1.8 1.1 2.8 1.9 1.6 1.3 3.4 3.1 4.7 5.5 1.9 5.5-1.9 14.9-1.9 14.9-2.3 7.6-18.4 40.6-18.4 40.6-8.1-.2-15.3 5-17.7 12.5-2.6 8.1 1.1 17.3 8.9 21.3s17.4 1.7 22.5-5.3c5-6.8 4.6-16.3-1.1-22.6 1.9-3.7 3.7-7.4 5.6-11.3 5-10.4 13.5-30.4 13.5-30.4.9-1.7 5.7-10.3 2.7-21.3-2.5-11.4-12.6-16.7-12.6-16.7-12.2-7.9-29.2-15.2-29.2-15.2s0-4.1-1.1-7.1c-1.1-3.1-2.8-5.1-3.9-6.3 4.7-9.7 9.4-19.3 14.1-29-4.1-2-8.1-4-12.2-6.1-4.8 9.8-9.7 19.7-14.5 29.5-6.7-.1-12.9 3.5-16.1 9.4-3.4 6.3-2.7 14.1 1.9 19.8z\" style=\"fill:#609926\"/></svg>\n\\ No newline at end of file\n"
        },
        {
          "path": "apps/web/public/logos/gitea-logo.svg",
          "status": "added",
          "diff": "Index: apps/web/public/logos/gitea-logo.svg\n===================================================================\n--- apps/web/public/logos/gitea-logo.svg\t69fe581 (parent)\n+++ apps/web/public/logos/gitea-logo.svg\t1126ca3 (commit)\n@@ -0,0 +1,1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 640 640\" width=\"32\" height=\"32\"><path d=\"m395.9 484.2-126.9-61c-12.5-6-17.9-21.2-11.8-33.8l61-126.9c6-12.5 21.2-17.9 33.8-11.8 17.2 8.3 27.1 13 27.1 13l-.1-109.2 16.7-.1.1 117.1s57.4 24.2 83.1 40.1c3.7 2.3 10.2 6.8 12.9 14.4 2.1 6.1 2 13.1-1 19.3l-61 126.9c-6.2 12.7-21.4 18.1-33.9 12\" style=\"fill:#fff\"/><path d=\"M622.7 149.8c-4.1-4.1-9.6-4-9.6-4s-117.2 6.6-177.9 8c-13.3.3-26.5.6-39.6.7v117.2c-5.5-2.6-11.1-5.3-16.6-7.9 0-36.4-.1-109.2-.1-109.2-29 .4-89.2-2.2-89.2-2.2s-141.4-7.1-156.8-8.5c-9.8-.6-22.5-2.1-39 1.5-8.7 1.8-33.5 7.4-53.8 26.9C-4.9 212.4 6.6 276.2 8 285.8c1.7 11.7 6.9 44.2 31.7 72.5 45.8 56.1 144.4 54.8 144.4 54.8s12.1 28.9 30.6 55.5c25 33.1 50.7 58.9 75.7 62 63 0 188.9-.1 188.9-.1s12 .1 28.3-10.3c14-8.5 26.5-23.4 26.5-23.4S547 483 565 451.5c5.5-9.7 10.1-19.1 14.1-28 0 0 55.2-117.1 55.2-231.1-1.1-34.5-9.6-40.6-11.6-42.6M125.6 353.9c-25.9-8.5-36.9-18.7-36.9-18.7S69.6 321.8 60 295.4c-16.5-44.2-1.4-71.2-1.4-71.2s8.4-22.5 38.5-30c13.8-3.7 31-3.1 31-3.1s7.1 59.4 15.7 94.2c7.2 29.2 24.8 77.7 24.8 77.7s-26.1-3.1-43-9.1m300.3 107.6s-6.1 14.5-19.6 15.4c-5.8.4-10.3-1.2-10.3-1.2s-.3-.1-5.3-2.1l-112.9-55s-10.9-5.7-12.8-15.6c-2.2-8.1 2.7-18.1 2.7-18.1L322 273s4.8-9.7 12.2-13c.6-.3 2.3-1 4.5-1.5 8.1-2.1 18 2.8 18 2.8L467.4 315s12.6 5.7 15.3 16.2c1.9 7.4-.5 14-1.8 17.2-6.3 15.4-55 113.1-55 113.1\" style=\"fill:#609926\"/><path d=\"M326.8 380.1c-8.2.1-15.4 5.8-17.3 13.8s2 16.3 9.1 20c7.7 4 17.5 1.8 22.7-5.4 5.1-7.1 4.3-16.9-1.8-23.1l24-49.1c1.5.1 3.7.2 6.2-.5 4.1-.9 7.1-3.6 7.1-3.6 4.2 1.8 8.6 3.8 13.2 6.1 4.8 2.4 9.3 4.9 13.4 7.3.9.5 1.8 1.1 2.8 1.9 1.6 1.3 3.4 3.1 4.7 5.5 1.9 5.5-1.9 14.9-1.9 14.9-2.3 7.6-18.4 40.6-18.4 40.6-8.1-.2-15.3 5-17.7 12.5-2.6 8.1 1.1 17.3 8.9 21.3s17.4 1.7 22.5-5.3c5-6.8 4.6-16.3-1.1-22.6 1.9-3.7 3.7-7.4 5.6-11.3 5-10.4 13.5-30.4 13.5-30.4.9-1.7 5.7-10.3 2.7-21.3-2.5-11.4-12.6-16.7-12.6-16.7-12.2-7.9-29.2-15.2-29.2-15.2s0-4.1-1.1-7.1c-1.1-3.1-2.8-5.1-3.9-6.3 4.7-9.7 9.4-19.3 14.1-29-4.1-2-8.1-4-12.2-6.1-4.8 9.8-9.7 19.7-14.5 29.5-6.7-.1-12.9 3.5-16.1 9.4-3.4 6.3-2.7 14.1 1.9 19.8z\" style=\"fill:#609926\"/></svg>\n\\ No newline at end of file\n"
        },
        {
          "path": "packages/types/src/instance/auth.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/instance/auth.ts\n===================================================================\n--- packages/types/src/instance/auth.ts\t69fe581 (parent)\n+++ packages/types/src/instance/auth.ts\t1126ca3 (commit)\n@@ -12,9 +12,10 @@\n   | \"ENABLE_MAGIC_LINK_LOGIN\"\n   | \"ENABLE_EMAIL_PASSWORD\"\n   | \"IS_GOOGLE_ENABLED\"\n   | \"IS_GITHUB_ENABLED\"\n-  | \"IS_GITLAB_ENABLED\";\n+  | \"IS_GITLAB_ENABLED\"\n+  | \"IS_GITEA_ENABLED\";\n \n export type TInstanceGoogleAuthenticationConfigurationKeys = \"GOOGLE_CLIENT_ID\" | \"GOOGLE_CLIENT_SECRET\";\n \n export type TInstanceGithubAuthenticationConfigurationKeys =\n@@ -26,12 +27,15 @@\n   | \"GITLAB_HOST\"\n   | \"GITLAB_CLIENT_ID\"\n   | \"GITLAB_CLIENT_SECRET\";\n \n+export type TInstanceGiteaAuthenticationConfigurationKeys = \"GITEA_HOST\" | \"GITEA_CLIENT_ID\" | \"GITEA_CLIENT_SECRET\";\n+\n export type TInstanceAuthenticationConfigurationKeys =\n   | TInstanceGoogleAuthenticationConfigurationKeys\n   | TInstanceGithubAuthenticationConfigurationKeys\n-  | TInstanceGitlabAuthenticationConfigurationKeys;\n+  | TInstanceGitlabAuthenticationConfigurationKeys\n+  | TInstanceGiteaAuthenticationConfigurationKeys;\n \n export type TInstanceAuthenticationKeys = TInstanceAuthenticationMethodKeys | TInstanceAuthenticationConfigurationKeys;\n \n export type TGetBaseAuthenticationModeProps = {\n"
        },
        {
          "path": "packages/types/src/instance/base.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/instance/base.ts\n===================================================================\n--- packages/types/src/instance/base.ts\t69fe581 (parent)\n+++ packages/types/src/instance/base.ts\t1126ca3 (commit)\n@@ -41,8 +41,9 @@\n   is_workspace_creation_disabled: boolean;\n   is_google_enabled: boolean;\n   is_github_enabled: boolean;\n   is_gitlab_enabled: boolean;\n+  is_gitea_enabled: boolean;\n   is_magic_login_enabled: boolean;\n   is_email_password_enabled: boolean;\n   github_app_name: string | undefined;\n   slack_client_id: string | undefined;\n"
        }
      ]
    },
    {
      "id": "add-invite-members",
      "sha": "3c6f24de64f3674cf15d956e0690df12716b894c",
      "parentSha": "96bbbec5886d7876be63d1764ea5ea1b7f6945bc",
      "spec": "Implement workspace invitation management and project member management endpoints, a shared BaseViewSet, permission exports, and minor authorization adjustments across the API.\n\n1) Serializers\n- apps/api/plane/api/serializers/__init__.py\n  - Export the new WorkspaceInviteSerializer and ProjectMemberSerializer.\n\n- apps/api/plane/api/serializers/invite.py (new)\n  - Create WorkspaceInviteSerializer for model plane.db.models.WorkspaceMemberInvite.\n  - Fields: id, email, role, created_at, updated_at, responded_at, accepted.\n  - Read-only: id, workspace, created_at, updated_at, responded_at, accepted.\n  - validate_email: ensure a valid email format; raise rest_framework.ValidationError with code INVALID_EMAIL_ADDRESS.\n  - validate_role: accept only ROLE.ADMIN.value, ROLE.MEMBER.value, ROLE.GUEST.value (import ROLE from plane.app.permissions.base); raise code INVALID_WORKSPACE_MEMBER_ROLE.\n  - validate: prevent duplicate invites within the same workspace slug (provided via serializer context[\"slug\"]). If exists, raise code EMAIL_ALREADY_INVITED.\n\n- apps/api/plane/api/serializers/member.py (new)\n  - Create ProjectMemberSerializer for model plane.db.models.ProjectMember.\n  - Fields: id, member (PrimaryKeyRelatedField to User), role. Read-only: id.\n  - validate_member: require slug in context; ensure value is present and is a WorkspaceMember in the given workspace; raise codes INVALID_SLUG or INVALID_MEMBER accordingly.\n  - validate_role: accept only ROLE.ADMIN.value, ROLE.MEMBER.value, ROLE.GUEST.value (import ROLE from plane.utils.permissions); raise code INVALID_ROLE.\n\n2) Base View foundation\n- apps/api/plane/api/views/base.py\n  - Add BaseViewSet(TimezoneMixin, ReadReplicaControlMixin, ModelViewSet, BasePaginator) with:\n    - Default authentication_classes: [APIKeyAuthentication]\n    - Default permission_classes: [IsAuthenticated]\n    - get_queryset: return model.objects.all(), log and raise APIException on error.\n    - handle_exception: standardized responses for IntegrityError (400), ValidationError (400), ObjectDoesNotExist (404), KeyError (400), otherwise 500, using log_exception and logger.\n    - dispatch: call super().dispatch; in DEBUG print count of DB queries; fallback to handle_exception.\n    - Properties: workspace_slug (from kwargs['slug']); project_id (from kwargs['project_id'] else if url_name == 'project' use kwargs['pk']); fields and expand (parsed from query params like in BaseAPIView).\n\n3) Workspace Invitations endpoints\n- apps/api/plane/api/views/invite.py (new)\n  - Create WorkspaceInvitationsViewset(BaseViewSet) with serializer_class WorkspaceInviteSerializer, model WorkspaceMemberInvite, permission_classes [WorkspaceOwnerPermission].\n  - get_queryset: filter by workspace__slug from path slug.\n  - get_object: get by pk within filtered queryset.\n  - list(request, slug): return all invites for workspace.\n  - retrieve(request, slug, pk): return a single invite.\n  - create(request, slug): lookup Workspace by slug; validate serializer with context {\"slug\": slug}; save(workspace=workspace, created_by=request.user); return 201.\n  - partial_update(request, slug, pk): reject email updates with 400 and code EMAIL_CANNOT_BE_UPDATED; allow role updates via serializer with context {\"slug\": slug}.\n  - destroy(request, slug, pk): if accepted is True return 400 INVITE_ALREADY_ACCEPTED; if responded_at set return 400 INVITE_ALREADY_RESPONDED; else delete and return 204.\n  - Use drf-spectacular extend_schema with WORKSPACE_SLUG_PARAMETER for list/create; include pk parameter for retrieve/partial_update/destroy.\n\n- apps/api/plane/api/urls/invite.py (new)\n  - Register a DRF DefaultRouter with prefix \"invitations\" bound to WorkspaceInvitationsViewset and wrap under path(\"workspaces/<str:slug>/\", include(router.urls)).\n\n- apps/api/plane/api/urls/__init__.py\n  - Import and include invite_patterns into urlpatterns.\n\n- apps/api/plane/api/views/__init__.py\n  - Export WorkspaceInvitationsViewset.\n\n4) Project Member endpoints\n- apps/api/plane/api/views/member.py\n  - Replace single ProjectMemberAPIEndpoint with 2 endpoints:\n    - ProjectMemberListCreateAPIEndpoint(BaseAPIView):\n      - permission_classes dynamically: GET uses ProjectMemberPermission; POST uses ProjectAdminPermission (override get_permissions accordingly).\n      - GET: List project members (existing behavior) returning users + role info.\n      - POST: Create project member using ProjectMemberSerializer(data=request.data, context={\"slug\": slug}); serializer.save(project_id=project_id); return 201.\n    - ProjectMemberDetailAPIEndpoint(ProjectMemberListCreateAPIEndpoint):\n      - GET(slug, project_id, pk): Return the user data for a specific project member (serialize the User with UserLiteSerializer).\n      - PATCH(slug, project_id, pk): Partial update of ProjectMember using ProjectMemberSerializer(partial=True, context={\"slug\": slug}); return 200.\n      - DELETE(slug, project_id, pk): Soft-delete by setting project_member.is_active=False and save; return 204.\n  - Import permissions from plane.utils.permissions: ProjectMemberPermission, WorkSpaceAdminPermission, ProjectAdminPermission. Continue using existing workspace list endpoint unchanged.\n\n- apps/api/plane/api/urls/member.py\n  - Update routes:\n    - List/Create: workspaces/<str:slug>/projects/<uuid:project_id>/members/ -> ProjectMemberListCreateAPIEndpoint (GET, POST)\n    - Detail: workspaces/<str:slug>/projects/<uuid:project_id>/members/<uuid:pk>/ -> ProjectMemberDetailAPIEndpoint (GET, PATCH, DELETE)\n    - Aliases (backward compatibility): same patterns under /project-members/ and /project-members/<uuid:pk>/ pointing to the same endpoints.\n\n- apps/api/plane/api/views/__init__.py\n  - Update exports to include ProjectMemberListCreateAPIEndpoint, ProjectMemberDetailAPIEndpoint.\n\n5) Permissions modules\n- apps/api/plane/app/permissions/__init__.py\n  - Export ProjectAdminPermission from .project.\n- apps/api/plane/app/permissions/project.py\n  - Add ProjectAdminPermission(BasePermission) that allows only project admins (ProjectMember with role=ROLE.ADMIN.value) within the given workspace/project to pass has_permission.\n\n6) New permissions utility package\n- apps/api/plane/utils/permissions/__init__.py (new)\n  - Re-export workspace and project permission classes and allow_permission + ROLE enum from local modules for easier imports.\n- apps/api/plane/utils/permissions/base.py (new)\n  - Implement ROLE enum (ADMIN=20, MEMBER=15, GUEST=5) and allow_permission decorator that gates access based on workspace/project-level roles and optionally allows creator via model and pk.\n- apps/api/plane/utils/permissions/workspace.py (new)\n  - Implement WorkSpaceBasePermission, WorkspaceOwnerPermission, WorkSpaceAdminPermission, WorkspaceEntityPermission, WorkspaceViewerPermission, WorkspaceUserPermission with role checks via WorkspaceMember and request.view.workspace_slug.\n- apps/api/plane/utils/permissions/project.py (new)\n  - Implement ProjectBasePermission, ProjectMemberPermission, ProjectEntityPermission, ProjectAdminPermission, ProjectLitePermission using WorkspaceMember and ProjectMember models; for POST/unsafe operations require admin/member appropriately; for admin permission require role=ROLE.ADMIN.\n- apps/api/plane/utils/permissions/page.py (new)\n  - Implement ProjectPagePermission to gate access to pages based on membership and page access rules; base logic as described with placeholders for private page checks.\n\n7) Issue attachment permission adjustments\n- apps/api/plane/api/views/issue.py\n  - In IssueAttachmentListCreateAPIEndpoint permission check, include ROLE.GUEST.value in allowed_roles and ensure user_has_issue_permission is called with request.user.id (user ID) not the user object.\n  - In IssueAttachmentDetailAPIEndpoint for delete and other attachment operations, pass request.user.id and include ROLE.GUEST.value in allowed roles where previously restricted.\n\n8) OpenAPI documentation\n- Ensure drf-spectacular extend_schema is applied to invitations and project member endpoints using shared parameters from plane.utils.openapi.parameters (e.g., WORKSPACE_SLUG_PARAMETER, PROJECT_ID_PARAMETER) and response/request schemas referencing the new serializers.\n\n9) URL wiring\n- apps/api/plane/api/urls/__init__.py must include invite_patterns in the root urlpatterns so the routes become available at /workspaces/{slug}/invitations/.\n\nObservable outcomes:\n- New invitation endpoints under /workspaces/{slug}/invitations/ support list, retrieve, create, partial update (role only), and delete with acceptance/response safeguards.\n- Project member endpoints now support create, retrieve, update, and delete, alongside list, at /workspaces/{slug}/projects/{project_id}/members/ (and alias /project-members/), with correct permission gating.\n- API responses and errors follow consistent patterns from BaseViewSet and new serializers.\n- OpenAPI docs reflect new endpoints and parameters.\n- Issue attachments authorization accepts guests where applicable and uses user ID in checks.",
      "prompt": "Add API support to manage workspace invitations and project members, with OpenAPI documentation and proper permission enforcement.\n\n- Create an invitations API under each workspace to list, view, create, update (role only), and delete invitations. The API must validate email format, enforce allowed roles, reject duplicate invites per workspace, and prevent modifying the email after creation. Only workspace owners should have access to these endpoints.\n\n- Split project member management into list/create and detail endpoints. Allow listing members to project members, but restrict create, update, and delete operations to project admins. When adding a member, require that the user already belongs to the workspace. Use simple serializers to validate inputs and return minimal user/member data.\n\n- Introduce a reusable base viewset that standardizes authentication, permission checks, error handling, and access to common path parameters like workspace slug and project ID.\n\n- Expand issue attachment permissions to include guests where appropriate, and ensure the permission utility is called with the user ID instead of the full user object.\n\n- Update routing to expose the new invitation and project member endpoints under the workspace and project paths, and document the endpoints with shared OpenAPI parameters and request/response schemas.",
      "supplementalFiles": [
        "apps/api/plane/api/serializers/base.py",
        "apps/api/plane/api/serializers/user.py",
        "apps/api/plane/db/models/workspace.py",
        "apps/api/plane/db/models/project.py",
        "apps/api/plane/db/models/__init__.py",
        "apps/api/plane/utils/openapi/parameters.py",
        "apps/api/plane/utils/openapi/__init__.py",
        "apps/api/plane/api/urls/project.py"
      ],
      "fileDiffs": [
        {
          "path": "apps/api/plane/api/serializers/__init__.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/serializers/__init__.py\n===================================================================\n--- apps/api/plane/api/serializers/__init__.py\t96bbbec (parent)\n+++ apps/api/plane/api/serializers/__init__.py\t3c6f24d (commit)\n@@ -52,4 +52,6 @@\n     GenericAssetUploadSerializer,\n     GenericAssetUpdateSerializer,\n     FileAssetSerializer,\n )\n+from .invite import WorkspaceInviteSerializer\n+from .member import ProjectMemberSerializer\n\\ No newline at end of file\n"
        },
        {
          "path": "apps/api/plane/api/serializers/invite.py",
          "status": "added",
          "diff": "Index: apps/api/plane/api/serializers/invite.py\n===================================================================\n--- apps/api/plane/api/serializers/invite.py\t96bbbec (parent)\n+++ apps/api/plane/api/serializers/invite.py\t3c6f24d (commit)\n@@ -0,0 +1,56 @@\n+# Django imports\n+from django.core.exceptions import ValidationError\n+from django.core.validators import validate_email\n+from rest_framework import serializers\n+\n+# Module imports\n+from plane.db.models import WorkspaceMemberInvite\n+from .base import BaseSerializer\n+from plane.app.permissions.base import ROLE\n+\n+\n+class WorkspaceInviteSerializer(BaseSerializer):\n+    \"\"\"\n+    Serializer for workspace invites.\n+    \"\"\"\n+\n+    class Meta:\n+        model = WorkspaceMemberInvite\n+        fields = [\n+            \"id\",\n+            \"email\",\n+            \"role\",\n+            \"created_at\",\n+            \"updated_at\",\n+            \"responded_at\",\n+            \"accepted\",\n+        ]\n+        read_only_fields = [\n+            \"id\",\n+            \"workspace\",\n+            \"created_at\",\n+            \"updated_at\",\n+            \"responded_at\",\n+            \"accepted\",\n+        ]\n+\n+    def validate_email(self, value):\n+        try:\n+            validate_email(value)\n+        except ValidationError:\n+            raise serializers.ValidationError(\"Invalid email address\", code=\"INVALID_EMAIL_ADDRESS\")\n+        return value\n+\n+    def validate_role(self, value):\n+        if value not in [ROLE.ADMIN.value, ROLE.MEMBER.value, ROLE.GUEST.value]:\n+            raise serializers.ValidationError(\"Invalid role\", code=\"INVALID_WORKSPACE_MEMBER_ROLE\")\n+        return value\n+\n+    def validate(self, data):\n+        slug = self.context[\"slug\"]\n+        if (\n+            data.get(\"email\")\n+            and WorkspaceMemberInvite.objects.filter(email=data[\"email\"], workspace__slug=slug).exists()\n+        ):\n+            raise serializers.ValidationError(\"Email already invited\", code=\"EMAIL_ALREADY_INVITED\")\n+        return data\n"
        },
        {
          "path": "apps/api/plane/api/serializers/member.py",
          "status": "added",
          "diff": "Index: apps/api/plane/api/serializers/member.py\n===================================================================\n--- apps/api/plane/api/serializers/member.py\t96bbbec (parent)\n+++ apps/api/plane/api/serializers/member.py\t3c6f24d (commit)\n@@ -0,0 +1,39 @@\n+# Third party imports\n+from rest_framework import serializers\n+\n+# Module imports\n+from plane.db.models import ProjectMember, WorkspaceMember\n+from .base import BaseSerializer\n+from plane.db.models import User\n+from plane.utils.permissions import ROLE\n+\n+\n+class ProjectMemberSerializer(BaseSerializer):\n+    \"\"\"\n+    Serializer for project members.\n+    \"\"\"\n+\n+    member = serializers.PrimaryKeyRelatedField(\n+        queryset=User.objects.all(),\n+        required=True,\n+    )\n+\n+    def validate_member(self, value):\n+        slug = self.context.get(\"slug\")\n+        if not slug:\n+            raise serializers.ValidationError(\"Slug is required\", code=\"INVALID_SLUG\")\n+        if not value:\n+            raise serializers.ValidationError(\"Member is required\", code=\"INVALID_MEMBER\")\n+        if not WorkspaceMember.objects.filter(workspace__slug=slug, member=value).exists():\n+            raise serializers.ValidationError(\"Member not found in workspace\", code=\"INVALID_MEMBER\")\n+        return value\n+\n+    def validate_role(self, value):\n+        if value not in [ROLE.ADMIN.value, ROLE.MEMBER.value, ROLE.GUEST.value]:\n+            raise serializers.ValidationError(\"Invalid role\", code=\"INVALID_ROLE\")\n+        return value\n+\n+    class Meta:\n+        model = ProjectMember\n+        fields = [\"id\", \"member\", \"role\"]\n+        read_only_fields = [\"id\"]\n"
        },
        {
          "path": "apps/api/plane/api/urls/__init__.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/urls/__init__.py\n===================================================================\n--- apps/api/plane/api/urls/__init__.py\t96bbbec (parent)\n+++ apps/api/plane/api/urls/__init__.py\t3c6f24d (commit)\n@@ -7,8 +7,9 @@\n from .project import urlpatterns as project_patterns\n from .state import urlpatterns as state_patterns\n from .user import urlpatterns as user_patterns\n from .work_item import urlpatterns as work_item_patterns\n+from .invite import urlpatterns as invite_patterns\n \n urlpatterns = [\n     *asset_patterns,\n     *cycle_patterns,\n@@ -19,5 +20,6 @@\n     *project_patterns,\n     *state_patterns,\n     *user_patterns,\n     *work_item_patterns,\n+    *invite_patterns,\n ]\n"
        },
        {
          "path": "apps/api/plane/api/urls/invite.py",
          "status": "added",
          "diff": "Index: apps/api/plane/api/urls/invite.py\n===================================================================\n--- apps/api/plane/api/urls/invite.py\t96bbbec (parent)\n+++ apps/api/plane/api/urls/invite.py\t3c6f24d (commit)\n@@ -0,0 +1,18 @@\n+# Django imports\n+from django.urls import path, include\n+\n+# Third party imports\n+from rest_framework.routers import DefaultRouter\n+\n+# Module imports\n+from plane.api.views import WorkspaceInvitationsViewset\n+\n+\n+# Create router with just the invitations prefix (no workspace slug)\n+router = DefaultRouter()\n+router.register(r\"invitations\", WorkspaceInvitationsViewset, basename=\"workspace-invitations\")\n+\n+# Wrap the router URLs with the workspace slug path\n+urlpatterns = [\n+    path(\"workspaces/<str:slug>/\", include(router.urls)),\n+]\n\\ No newline at end of file\n"
        },
        {
          "path": "apps/api/plane/api/urls/member.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/urls/member.py\n===================================================================\n--- apps/api/plane/api/urls/member.py\t96bbbec (parent)\n+++ apps/api/plane/api/urls/member.py\t3c6f24d (commit)\n@@ -1,15 +1,31 @@\n from django.urls import path\n \n-from plane.api.views import ProjectMemberAPIEndpoint, WorkspaceMemberAPIEndpoint\n+from plane.api.views import ProjectMemberListCreateAPIEndpoint, ProjectMemberDetailAPIEndpoint, WorkspaceMemberAPIEndpoint\n \n urlpatterns = [\n+    # Project members\n     path(\n         \"workspaces/<str:slug>/projects/<uuid:project_id>/members/\",\n-        ProjectMemberAPIEndpoint.as_view(http_method_names=[\"get\"]),\n+        ProjectMemberListCreateAPIEndpoint.as_view(http_method_names=[\"get\", \"post\"]),\n         name=\"project-members\",\n     ),\n     path(\n+        \"workspaces/<str:slug>/projects/<uuid:project_id>/members/<uuid:pk>/\",\n+        ProjectMemberDetailAPIEndpoint.as_view(http_method_names=[\"patch\", \"delete\", \"get\"]),\n+        name=\"project-member\",\n+    ),\n+    path(\n+        \"workspaces/<str:slug>/projects/<uuid:project_id>/project-members/\",\n+        ProjectMemberListCreateAPIEndpoint.as_view(http_method_names=[\"get\", \"post\"]),\n+        name=\"project-members\",\n+    ),\n+    path(\n+        \"workspaces/<str:slug>/projects/<uuid:project_id>/project-members/<uuid:pk>/\",\n+        ProjectMemberDetailAPIEndpoint.as_view(http_method_names=[\"patch\", \"delete\", \"get\"]),\n+        name=\"project-member\",\n+    ),\n+    path(\n         \"workspaces/<str:slug>/members/\",\n         WorkspaceMemberAPIEndpoint.as_view(http_method_names=[\"get\"]),\n         name=\"workspace-members\",\n     ),\n"
        },
        {
          "path": "apps/api/plane/api/views/__init__.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/__init__.py\n===================================================================\n--- apps/api/plane/api/views/__init__.py\t96bbbec (parent)\n+++ apps/api/plane/api/views/__init__.py\t3c6f24d (commit)\n@@ -42,9 +42,9 @@\n     ModuleIssueDetailAPIEndpoint,\n     ModuleArchiveUnarchiveAPIEndpoint,\n )\n \n-from .member import ProjectMemberAPIEndpoint, WorkspaceMemberAPIEndpoint\n+from .member import ProjectMemberListCreateAPIEndpoint, ProjectMemberDetailAPIEndpoint, WorkspaceMemberAPIEndpoint\n \n from .intake import (\n     IntakeIssueListCreateAPIEndpoint,\n     IntakeIssueDetailAPIEndpoint,\n@@ -52,4 +52,6 @@\n \n from .asset import UserAssetEndpoint, UserServerAssetEndpoint, GenericAssetEndpoint\n \n from .user import UserEndpoint\n+\n+from .invite import WorkspaceInvitationsViewset\n\\ No newline at end of file\n"
        },
        {
          "path": "apps/api/plane/api/views/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/base.py\n===================================================================\n--- apps/api/plane/api/views/base.py\t96bbbec (parent)\n+++ apps/api/plane/api/views/base.py\t3c6f24d (commit)\n@@ -1,29 +1,37 @@\n # Python imports\n import zoneinfo\n+import logging\n \n # Django imports\n from django.conf import settings\n from django.core.exceptions import ObjectDoesNotExist, ValidationError\n from django.db import IntegrityError\n from django.urls import resolve\n from django.utils import timezone\n-from plane.db.models.api import APIToken\n+\n+# Third party imports\n from rest_framework import status\n from rest_framework.permissions import IsAuthenticated\n from rest_framework.response import Response\n-\n-# Third party imports\n+from django_filters.rest_framework import DjangoFilterBackend\n+from rest_framework.filters import SearchFilter\n+from rest_framework.viewsets import ModelViewSet\n+from rest_framework.exceptions import APIException\n from rest_framework.generics import GenericAPIView\n \n # Module imports\n+from plane.db.models.api import APIToken\n from plane.api.middleware.api_authentication import APIKeyAuthentication\n from plane.api.rate_limit import ApiKeyRateThrottle, ServiceTokenRateThrottle\n from plane.utils.exception_logger import log_exception\n from plane.utils.paginator import BasePaginator\n from plane.utils.core.mixins import ReadReplicaControlMixin\n \n \n+logger = logging.getLogger(\"plane.api\")\n+\n+\n class TimezoneMixin:\n     \"\"\"\n     This enables timezone conversion according\n     to the user set timezone\n@@ -151,4 +159,119 @@\n     @property\n     def expand(self):\n         expand = [expand for expand in self.request.GET.get(\"expand\", \"\").split(\",\") if expand]\n         return expand if expand else None\n+\n+\n+class BaseViewSet(TimezoneMixin, ReadReplicaControlMixin, ModelViewSet, BasePaginator):\n+    model = None\n+\n+    authentication_classes = [APIKeyAuthentication]\n+    permission_classes = [\n+        IsAuthenticated,\n+    ]\n+    use_read_replica = False\n+\n+    def get_queryset(self):\n+        try:\n+            return self.model.objects.all()\n+        except Exception as e:\n+            log_exception(e)\n+            raise APIException(\"Please check the view\", status.HTTP_400_BAD_REQUEST)\n+\n+    def handle_exception(self, exc):\n+        \"\"\"\n+        Handle any exception that occurs, by returning an appropriate response,\n+        or re-raising the error.\n+        \"\"\"\n+        try:\n+            response = super().handle_exception(exc)\n+            return response\n+        except Exception as e:\n+            if isinstance(e, IntegrityError):\n+                log_exception(e)\n+                return Response(\n+                    {\"error\": \"The payload is not valid\"},\n+                    status=status.HTTP_400_BAD_REQUEST,\n+                )\n+\n+            if isinstance(e, ValidationError):\n+                logger.warning(\n+                    \"Validation Error\",\n+                    extra={\n+                        \"error_code\": \"VALIDATION_ERROR\",\n+                        \"error_message\": str(e),\n+                    },\n+                )\n+                return Response(\n+                    {\"error\": \"Please provide valid detail\"},\n+                    status=status.HTTP_400_BAD_REQUEST,\n+                )\n+\n+            if isinstance(e, ObjectDoesNotExist):\n+                logger.warning(\n+                    \"Object Does Not Exist\",\n+                    extra={\n+                        \"error_code\": \"OBJECT_DOES_NOT_EXIST\",\n+                        \"error_message\": str(e),\n+                    },\n+                )\n+                return Response(\n+                    {\"error\": \"The required object does not exist.\"},\n+                    status=status.HTTP_404_NOT_FOUND,\n+                )\n+\n+            if isinstance(e, KeyError):\n+                logger.error(\n+                    \"Key Error\",\n+                    extra={\n+                        \"error_code\": \"KEY_ERROR\",\n+                        \"error_message\": str(e),\n+                    },\n+                )\n+                return Response(\n+                    {\"error\": \"The required key does not exist.\"},\n+                    status=status.HTTP_400_BAD_REQUEST,\n+                )\n+\n+            log_exception(e)\n+            return Response(\n+                {\"error\": \"Something went wrong please try again later\"},\n+                status=status.HTTP_500_INTERNAL_SERVER_ERROR,\n+            )\n+\n+    def dispatch(self, request, *args, **kwargs):\n+        try:\n+            response = super().dispatch(request, *args, **kwargs)\n+\n+            if settings.DEBUG:\n+                from django.db import connection\n+\n+                print(f\"{request.method} - {request.get_full_path()} of Queries: {len(connection.queries)}\")\n+\n+            return response\n+        except Exception as exc:\n+            response = self.handle_exception(exc)\n+            return response\n+\n+    @property\n+    def workspace_slug(self):\n+        return self.kwargs.get(\"slug\", None)\n+\n+    @property\n+    def project_id(self):\n+        project_id = self.kwargs.get(\"project_id\", None)\n+        if project_id:\n+            return project_id\n+\n+        if resolve(self.request.path_info).url_name == \"project\":\n+            return self.kwargs.get(\"pk\", None)\n+\n+    @property\n+    def fields(self):\n+        fields = [field for field in self.request.GET.get(\"fields\", \"\").split(\",\") if field]\n+        return fields if fields else None\n+\n+    @property\n+    def expand(self):\n+        expand = [expand for expand in self.request.GET.get(\"expand\", \"\").split(\",\") if expand]\n+        return expand if expand else None\n"
        },
        {
          "path": "apps/api/plane/api/views/invite.py",
          "status": "added",
          "diff": "Index: apps/api/plane/api/views/invite.py\n===================================================================\n--- apps/api/plane/api/views/invite.py\t96bbbec (parent)\n+++ apps/api/plane/api/views/invite.py\t3c6f24d (commit)\n@@ -0,0 +1,150 @@\n+# Third party imports\n+from rest_framework.response import Response\n+from rest_framework import status\n+from drf_spectacular.utils import (\n+    extend_schema,\n+    OpenApiResponse,\n+    OpenApiRequest,\n+    OpenApiParameter,\n+    OpenApiTypes,\n+)\n+\n+# Module imports\n+from plane.api.views.base import BaseViewSet\n+from plane.db.models import WorkspaceMemberInvite, Workspace\n+from plane.api.serializers import WorkspaceInviteSerializer\n+from plane.utils.permissions import WorkspaceOwnerPermission\n+from plane.utils.openapi.parameters import WORKSPACE_SLUG_PARAMETER\n+\n+\n+class WorkspaceInvitationsViewset(BaseViewSet):\n+    \"\"\"\n+    Endpoint for creating, listing and deleting workspace invites.\n+    \"\"\"\n+\n+    serializer_class = WorkspaceInviteSerializer\n+    model = WorkspaceMemberInvite\n+\n+    permission_classes = [\n+        WorkspaceOwnerPermission,\n+    ]\n+\n+    def get_queryset(self):\n+        return self.filter_queryset(super().get_queryset().filter(workspace__slug=self.kwargs.get(\"slug\")))\n+\n+    def get_object(self):\n+        return self.get_queryset().get(pk=self.kwargs.get(\"pk\"))\n+\n+    @extend_schema(\n+        summary=\"List workspace invites\",\n+        description=\"List all workspace invites for a workspace\",\n+        responses={\n+            200: OpenApiResponse(\n+                description=\"Workspace invites\",\n+                response=WorkspaceInviteSerializer(many=True),\n+            )\n+        },\n+        parameters=[\n+            WORKSPACE_SLUG_PARAMETER,\n+        ],\n+    )\n+    def list(self, request, slug):\n+        workspace_member_invites = self.get_queryset()\n+        serializer = WorkspaceInviteSerializer(workspace_member_invites, many=True)\n+        return Response(serializer.data, status=status.HTTP_200_OK)\n+\n+    @extend_schema(\n+        summary=\"Get workspace invite\",\n+        description=\"Get a workspace invite by ID\",\n+        responses={200: OpenApiResponse(description=\"Workspace invite\", response=WorkspaceInviteSerializer)},\n+        parameters=[\n+            WORKSPACE_SLUG_PARAMETER,\n+            OpenApiParameter(\n+                name=\"pk\",\n+                description=\"Workspace invite ID\",\n+                required=True,\n+                type=OpenApiTypes.UUID,\n+                location=OpenApiParameter.PATH,\n+            ),\n+        ],\n+    )\n+    def retrieve(self, request, slug, pk):\n+        workspace_member_invite = self.get_object()\n+        serializer = WorkspaceInviteSerializer(workspace_member_invite)\n+        return Response(serializer.data, status=status.HTTP_200_OK)\n+\n+    @extend_schema(\n+        summary=\"Create workspace invite\",\n+        description=\"Create a workspace invite\",\n+        responses={201: OpenApiResponse(description=\"Workspace invite\", response=WorkspaceInviteSerializer)},\n+        request=OpenApiRequest(request=WorkspaceInviteSerializer),\n+        parameters=[\n+            WORKSPACE_SLUG_PARAMETER,\n+        ],\n+    )\n+    def create(self, request, slug):\n+        workspace = Workspace.objects.get(slug=slug)\n+        serializer = WorkspaceInviteSerializer(data=request.data, context={\"slug\": slug})\n+        serializer.is_valid(raise_exception=True)\n+        serializer.save(workspace=workspace, created_by=request.user)\n+        return Response(serializer.data, status=status.HTTP_201_CREATED)\n+\n+    @extend_schema(\n+        summary=\"Update workspace invite\",\n+        description=\"Update a workspace invite\",\n+        responses={200: OpenApiResponse(description=\"Workspace invite\", response=WorkspaceInviteSerializer)},\n+        request=OpenApiRequest(request=WorkspaceInviteSerializer),\n+        parameters=[\n+            WORKSPACE_SLUG_PARAMETER,\n+            OpenApiParameter(\n+                name=\"pk\",\n+                description=\"Workspace invite ID\",\n+                required=True,\n+                type=OpenApiTypes.UUID,\n+                location=OpenApiParameter.PATH,\n+            ),\n+        ],\n+    )\n+    def partial_update(self, request, slug, pk):\n+        workspace_member_invite = self.get_object()\n+        if request.data.get(\"email\"):\n+            return Response(\n+                status=status.HTTP_400_BAD_REQUEST,\n+                data={\"error\": \"Email cannot be updated after invite is created.\", \"code\": \"EMAIL_CANNOT_BE_UPDATED\"},\n+            )\n+        serializer = WorkspaceInviteSerializer(\n+            workspace_member_invite, data=request.data, partial=True, context={\"slug\": slug}\n+        )\n+        serializer.is_valid(raise_exception=True)\n+        serializer.save()\n+        return Response(serializer.data, status=status.HTTP_200_OK)\n+\n+    @extend_schema(\n+        summary=\"Delete workspace invite\",\n+        description=\"Delete a workspace invite\",\n+        responses={204: OpenApiResponse(description=\"Workspace invite deleted\")},\n+        parameters=[\n+            WORKSPACE_SLUG_PARAMETER,\n+            OpenApiParameter(\n+                name=\"pk\",\n+                description=\"Workspace invite ID\",\n+                required=True,\n+                type=OpenApiTypes.UUID,\n+                location=OpenApiParameter.PATH,\n+            ),\n+        ],\n+    )\n+    def destroy(self, request, slug, pk):\n+        workspace_member_invite = self.get_object()\n+        if workspace_member_invite.accepted:\n+            return Response(\n+                status=status.HTTP_400_BAD_REQUEST,\n+                data={\"error\": \"Invite already accepted\", \"code\": \"INVITE_ALREADY_ACCEPTED\"},\n+            )\n+        if workspace_member_invite.responded_at:\n+            return Response(\n+                status=status.HTTP_400_BAD_REQUEST,\n+                data={\"error\": \"Invite already responded\", \"code\": \"INVITE_ALREADY_RESPONDED\"},\n+            )\n+        workspace_member_invite.delete()\n+        return Response(status=status.HTTP_204_NO_CONTENT)\n"
        },
        {
          "path": "apps/api/plane/api/views/issue.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/issue.py\n===================================================================\n--- apps/api/plane/api/views/issue.py\t96bbbec (parent)\n+++ apps/api/plane/api/views/issue.py\t3c6f24d (commit)\n@@ -1807,9 +1807,9 @@\n         if not user_has_issue_permission(\n             request.user.id,\n             project_id=project_id,\n             issue=issue,\n-            allowed_roles=[ROLE.ADMIN.value, ROLE.MEMBER.value],\n+            allowed_roles=[ROLE.ADMIN.value, ROLE.MEMBER.value, ROLE.GUEST.value],\n             allow_creator=True,\n         ):\n             return Response(\n                 {\"error\": \"You are not allowed to upload this attachment\"},\n@@ -1960,12 +1960,12 @@\n         \"\"\"\n         issue = Issue.objects.get(pk=issue_id, workspace__slug=slug, project_id=project_id)\n         # if the request user is creator or admin then delete the attachment\n         if not user_has_issue_permission(\n-            request.user,\n+            request.user.id,\n             project_id=project_id,\n             issue=issue,\n-            allowed_roles=[ROLE.ADMIN.value],\n+            allowed_roles=[ROLE.ADMIN.value, ROLE.MEMBER.value, ROLE.GUEST.value],\n             allow_creator=True,\n         ):\n             return Response(\n                 {\"error\": \"You are not allowed to delete this attachment\"},\n@@ -2033,9 +2033,9 @@\n         Retrieve details of a specific attachment.\n         \"\"\"\n         # if the user is part of the project then allow the download\n         if not user_has_issue_permission(\n-            request.user,\n+            request.user.id,\n             project_id=project_id,\n             issue=None,\n             allowed_roles=None,\n             allow_creator=False,\n@@ -2098,12 +2098,12 @@\n \n         issue = Issue.objects.get(pk=issue_id, workspace__slug=slug, project_id=project_id)\n         # if the user is creator or admin then allow the upload\n         if not user_has_issue_permission(\n-            request.user,\n+            request.user.id,\n             project_id=project_id,\n             issue=issue,\n-            allowed_roles=[ROLE.ADMIN.value, ROLE.MEMBER.value],\n+            allowed_roles=[ROLE.ADMIN.value, ROLE.MEMBER.value, ROLE.GUEST.value],\n             allow_creator=True,\n         ):\n             return Response(\n                 {\"error\": \"You are not allowed to upload this attachment\"},\n"
        },
        {
          "path": "apps/api/plane/api/views/member.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/member.py\n===================================================================\n--- apps/api/plane/api/views/member.py\t96bbbec (parent)\n+++ apps/api/plane/api/views/member.py\t3c6f24d (commit)\n@@ -3,15 +3,16 @@\n from rest_framework import status\n from drf_spectacular.utils import (\n     extend_schema,\n     OpenApiResponse,\n+    OpenApiRequest,\n )\n \n # Module imports\n from .base import BaseAPIView\n-from plane.api.serializers import UserLiteSerializer\n+from plane.api.serializers import UserLiteSerializer, ProjectMemberSerializer\n from plane.db.models import User, Workspace, WorkspaceMember, ProjectMember\n-from plane.app.permissions import ProjectMemberPermission, WorkSpaceAdminPermission\n+from plane.utils.permissions import ProjectMemberPermission, WorkSpaceAdminPermission, ProjectAdminPermission\n from plane.utils.openapi import (\n     WORKSPACE_SLUG_PARAMETER,\n     PROJECT_ID_PARAMETER,\n     UNAUTHORIZED_RESPONSE,\n@@ -85,13 +86,17 @@\n \n         return Response(users_with_roles, status=status.HTTP_200_OK)\n \n \n-# API endpoint to get and insert users inside the workspace\n-class ProjectMemberAPIEndpoint(BaseAPIView):\n+class ProjectMemberListCreateAPIEndpoint(BaseAPIView):\n     permission_classes = [ProjectMemberPermission]\n     use_read_replica = True\n \n+    def get_permissions(self):\n+        if self.request.method == \"GET\":\n+            return [ProjectMemberPermission()]\n+        return [ProjectAdminPermission()]\n+\n     @extend_schema(\n         operation_id=\"get_project_members\",\n         summary=\"List project members\",\n         description=\"Retrieve all users who are members of the specified project.\",\n@@ -128,6 +133,87 @@\n         )\n \n         # Get all the users that are present inside the workspace\n         users = UserLiteSerializer(User.objects.filter(id__in=project_members), many=True).data\n-\n         return Response(users, status=status.HTTP_200_OK)\n+\n+    @extend_schema(\n+        operation_id=\"create_project_member\",\n+        summary=\"Create project member\",\n+        description=\"Create a new project member\",\n+        tags=[\"Members\"],\n+        parameters=[WORKSPACE_SLUG_PARAMETER, PROJECT_ID_PARAMETER],\n+        responses={201: OpenApiResponse(description=\"Project member created\", response=ProjectMemberSerializer)},\n+        request=OpenApiRequest(request=ProjectMemberSerializer),\n+    )\n+    def post(self, request, slug, project_id):\n+        serializer = ProjectMemberSerializer(data=request.data, context={\"slug\": slug})\n+        serializer.is_valid(raise_exception=True)\n+        serializer.save(project_id=project_id)\n+        return Response(serializer.data, status=status.HTTP_201_CREATED)\n+\n+\n+# API endpoint to get and update a project member\n+class ProjectMemberDetailAPIEndpoint(ProjectMemberListCreateAPIEndpoint):\n+\n+    @extend_schema(\n+        operation_id=\"get_project_member\",\n+        summary=\"Get project member\",\n+        description=\"Retrieve a project member by ID.\",\n+        tags=[\"Members\"],\n+        parameters=[WORKSPACE_SLUG_PARAMETER, PROJECT_ID_PARAMETER],\n+        responses={\n+            200: OpenApiResponse(description=\"Project member\", response=ProjectMemberSerializer),\n+            401: UNAUTHORIZED_RESPONSE,\n+            403: FORBIDDEN_RESPONSE,\n+            404: PROJECT_NOT_FOUND_RESPONSE,\n+        },\n+    )\n+    # Get a project member by ID\n+    def get(self, request, slug, project_id, pk):\n+        \"\"\"Get project member\n+\n+        Retrieve a project member by ID.\n+        Returns a project member with their project-specific roles and access levels.\n+        \"\"\"\n+        # Check if the workspace exists\n+        if not Workspace.objects.filter(slug=slug).exists():\n+            return Response(\n+                {\"error\": \"Provided workspace does not exist\"},\n+                status=status.HTTP_400_BAD_REQUEST,\n+            )\n+\n+        # Get the workspace members that are present inside the workspace\n+        project_members = ProjectMember.objects.get(project_id=project_id, workspace__slug=slug, pk=pk)\n+        user = User.objects.get(id=project_members.member_id)\n+        user = UserLiteSerializer(user).data\n+        return Response(user, status=status.HTTP_200_OK)\n+\n+    @extend_schema(\n+        operation_id=\"update_project_member\",\n+        summary=\"Update project member\",\n+        description=\"Update a project member\",\n+        tags=[\"Members\"],\n+        parameters=[WORKSPACE_SLUG_PARAMETER, PROJECT_ID_PARAMETER],\n+        responses={200: OpenApiResponse(description=\"Project member updated\", response=ProjectMemberSerializer)},\n+        request=OpenApiRequest(request=ProjectMemberSerializer),\n+    )\n+    def patch(self, request, slug, project_id, pk):\n+        project_member = ProjectMember.objects.get(project_id=project_id, workspace__slug=slug, pk=pk)\n+        serializer = ProjectMemberSerializer(project_member, data=request.data, partial=True, context={\"slug\": slug})\n+        serializer.is_valid(raise_exception=True)\n+        serializer.save()\n+        return Response(serializer.data, status=status.HTTP_200_OK)\n+\n+    @extend_schema(\n+        operation_id=\"delete_project_member\",\n+        summary=\"Delete project member\",\n+        description=\"Delete a project member\",\n+        tags=[\"Members\"],\n+        parameters=[WORKSPACE_SLUG_PARAMETER, PROJECT_ID_PARAMETER],\n+        responses={204: OpenApiResponse(description=\"Project member deleted\")},\n+    )\n+    def delete(self, request, slug, project_id, pk):\n+        project_member = ProjectMember.objects.get(project_id=project_id, workspace__slug=slug, pk=pk)\n+        project_member.is_active = False\n+        project_member.save()\n+        return Response(status=status.HTTP_204_NO_CONTENT)\n"
        },
        {
          "path": "apps/api/plane/app/permissions/__init__.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/permissions/__init__.py\n===================================================================\n--- apps/api/plane/app/permissions/__init__.py\t96bbbec (parent)\n+++ apps/api/plane/app/permissions/__init__.py\t3c6f24d (commit)\n@@ -10,7 +10,8 @@\n     ProjectBasePermission,\n     ProjectEntityPermission,\n     ProjectMemberPermission,\n     ProjectLitePermission,\n+    ProjectAdminPermission,\n )\n from .base import allow_permission, ROLE\n from .page import ProjectPagePermission\n"
        },
        {
          "path": "apps/api/plane/app/permissions/project.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/permissions/project.py\n===================================================================\n--- apps/api/plane/app/permissions/project.py\t96bbbec (parent)\n+++ apps/api/plane/app/permissions/project.py\t3c6f24d (commit)\n@@ -111,8 +111,22 @@\n             is_active=True,\n         ).exists()\n \n \n+class ProjectAdminPermission(BasePermission):\n+    def has_permission(self, request, view):\n+        if request.user.is_anonymous:\n+            return False\n+\n+        return ProjectMember.objects.filter(\n+            workspace__slug=view.workspace_slug,\n+            member=request.user,\n+            role=ROLE.ADMIN.value,\n+            project_id=view.project_id,\n+            is_active=True,\n+        ).exists()\n+\n+\n class ProjectLitePermission(BasePermission):\n     def has_permission(self, request, view):\n         if request.user.is_anonymous:\n             return False\n"
        },
        {
          "path": "apps/api/plane/utils/permissions/__init__.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/permissions/__init__.py\n===================================================================\n--- apps/api/plane/utils/permissions/__init__.py\t96bbbec (parent)\n+++ apps/api/plane/utils/permissions/__init__.py\t3c6f24d (commit)\n@@ -0,0 +1,17 @@\n+from .workspace import (\n+    WorkSpaceBasePermission,\n+    WorkspaceOwnerPermission,\n+    WorkSpaceAdminPermission,\n+    WorkspaceEntityPermission,\n+    WorkspaceViewerPermission,\n+    WorkspaceUserPermission,\n+)\n+from .project import (\n+    ProjectBasePermission,\n+    ProjectEntityPermission,\n+    ProjectMemberPermission,\n+    ProjectLitePermission,\n+    ProjectAdminPermission,\n+)\n+from .base import allow_permission, ROLE\n+from .page import ProjectPagePermission\n"
        },
        {
          "path": "apps/api/plane/utils/permissions/base.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/permissions/base.py\n===================================================================\n--- apps/api/plane/utils/permissions/base.py\t96bbbec (parent)\n+++ apps/api/plane/utils/permissions/base.py\t3c6f24d (commit)\n@@ -0,0 +1,73 @@\n+from plane.db.models import WorkspaceMember, ProjectMember\n+from functools import wraps\n+from rest_framework.response import Response\n+from rest_framework import status\n+\n+from enum import Enum\n+\n+\n+class ROLE(Enum):\n+    ADMIN = 20\n+    MEMBER = 15\n+    GUEST = 5\n+\n+\n+def allow_permission(allowed_roles, level=\"PROJECT\", creator=False, model=None):\n+    def decorator(view_func):\n+        @wraps(view_func)\n+        def _wrapped_view(instance, request, *args, **kwargs):\n+            # Check for creator if required\n+            if creator and model:\n+                obj = model.objects.filter(id=kwargs[\"pk\"], created_by=request.user).exists()\n+                if obj:\n+                    return view_func(instance, request, *args, **kwargs)\n+\n+            # Convert allowed_roles to their values if they are enum members\n+            allowed_role_values = [role.value if isinstance(role, ROLE) else role for role in allowed_roles]\n+\n+            # Check role permissions\n+            if level == \"WORKSPACE\":\n+                if WorkspaceMember.objects.filter(\n+                    member=request.user,\n+                    workspace__slug=kwargs[\"slug\"],\n+                    role__in=allowed_role_values,\n+                    is_active=True,\n+                ).exists():\n+                    return view_func(instance, request, *args, **kwargs)\n+            else:\n+                is_user_has_allowed_role = ProjectMember.objects.filter(\n+                    member=request.user,\n+                    workspace__slug=kwargs[\"slug\"],\n+                    project_id=kwargs[\"project_id\"],\n+                    role__in=allowed_role_values,\n+                    is_active=True,\n+                ).exists()\n+\n+                # Return if the user has the allowed role else if they are workspace admin and part of the project regardless of the role # noqa: E501\n+                if is_user_has_allowed_role:\n+                    return view_func(instance, request, *args, **kwargs)\n+                elif (\n+                    ProjectMember.objects.filter(\n+                        member=request.user,\n+                        workspace__slug=kwargs[\"slug\"],\n+                        project_id=kwargs[\"project_id\"],\n+                        is_active=True,\n+                    ).exists()\n+                    and WorkspaceMember.objects.filter(\n+                        member=request.user,\n+                        workspace__slug=kwargs[\"slug\"],\n+                        role=ROLE.ADMIN.value,\n+                        is_active=True,\n+                    ).exists()\n+                ):\n+                    return view_func(instance, request, *args, **kwargs)\n+\n+            # Return permission denied if no conditions are met\n+            return Response(\n+                {\"error\": \"You don't have the required permissions.\"},\n+                status=status.HTTP_403_FORBIDDEN,\n+            )\n+\n+        return _wrapped_view\n+\n+    return decorator\n"
        },
        {
          "path": "apps/api/plane/utils/permissions/page.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/permissions/page.py\n===================================================================\n--- apps/api/plane/utils/permissions/page.py\t96bbbec (parent)\n+++ apps/api/plane/utils/permissions/page.py\t3c6f24d (commit)\n@@ -0,0 +1,121 @@\n+from plane.db.models import ProjectMember, Page\n+from plane.app.permissions import ROLE\n+\n+\n+from rest_framework.permissions import BasePermission, SAFE_METHODS\n+\n+\n+# Permission Mappings for workspace members\n+ADMIN = ROLE.ADMIN.value\n+MEMBER = ROLE.MEMBER.value\n+GUEST = ROLE.GUEST.value\n+\n+\n+class ProjectPagePermission(BasePermission):\n+    \"\"\"\n+    Custom permission to control access to pages within a workspace\n+    based on user roles, page visibility (public/private), and feature flags.\n+    \"\"\"\n+\n+    def has_permission(self, request, view):\n+        \"\"\"\n+        Check basic project-level permissions before checking object-level permissions.\n+        \"\"\"\n+        if request.user.is_anonymous:\n+            return False\n+\n+        user_id = request.user.id\n+        slug = view.kwargs.get(\"slug\")\n+        page_id = view.kwargs.get(\"page_id\")\n+        project_id = view.kwargs.get(\"project_id\")\n+\n+        # Hook for extended validation\n+        extended_access, role = self._check_access_and_get_role(request, slug, project_id)\n+        if extended_access is False:\n+            return False\n+\n+        if page_id:\n+            page = Page.objects.get(id=page_id, workspace__slug=slug)\n+\n+            # Allow access if the user is the owner of the page\n+            if page.owned_by_id == user_id:\n+                return True\n+\n+            # Handle private page access\n+            if page.access == Page.PRIVATE_ACCESS:\n+                return self._has_private_page_action_access(request, slug, page, project_id)\n+\n+        # Handle public page access\n+        return self._has_public_page_action_access(request, role)\n+\n+    def _check_project_member_access(self, request, slug, project_id):\n+        \"\"\"\n+        Check if the user is a project member.\n+        \"\"\"\n+        return (\n+            ProjectMember.objects.filter(\n+                member=request.user,\n+                workspace__slug=slug,\n+                is_active=True,\n+                project_id=project_id,\n+            )\n+            .values_list(\"role\", flat=True)\n+            .first()\n+        )\n+\n+    def _check_access_and_get_role(self, request, slug, project_id):\n+        \"\"\"\n+        Hook for extended access checking\n+        Returns: True (allow), False (deny), None (continue with normal flow)\n+        \"\"\"\n+        role = self._check_project_member_access(request, slug, project_id)\n+        if not role:\n+            return False, None\n+        return True, role\n+\n+    def _has_private_page_action_access(self, request, slug, page, project_id):\n+        \"\"\"\n+        Check access to private pages. Override for feature flag logic.\n+        \"\"\"\n+        # Base implementation: only owner can access private pages\n+        return False\n+\n+    def _check_project_action_access(self, request, role):\n+        method = request.method\n+\n+        # Only admins can create (POST) pages\n+        if method == \"POST\":\n+            if role in [ADMIN, MEMBER]:\n+                return True\n+            return False\n+\n+        # Safe methods (GET, HEAD, OPTIONS) allowed for all active roles\n+        if method in SAFE_METHODS:\n+            if role in [ADMIN, MEMBER, GUEST]:\n+                return True\n+            return False\n+\n+        # PUT/PATCH: Admins and members can update\n+        if method in [\"PUT\", \"PATCH\"]:\n+            if role in [ADMIN, MEMBER]:\n+                return True\n+            return False\n+\n+        # DELETE: Only admins can delete\n+        if method == \"DELETE\":\n+            if role in [ADMIN]:\n+                return True\n+            return False\n+\n+        # Deny by default\n+        return False\n+\n+    def _has_public_page_action_access(self, request, role):\n+        \"\"\"\n+        Check if the user has permission to access a public page\n+        and can perform operations on the page.\n+        \"\"\"\n+        project_member_exists = self._check_project_action_access(request, role)\n+        if not project_member_exists:\n+            return False\n+        return True\n"
        },
        {
          "path": "apps/api/plane/utils/permissions/project.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/permissions/project.py\n===================================================================\n--- apps/api/plane/utils/permissions/project.py\t96bbbec (parent)\n+++ apps/api/plane/utils/permissions/project.py\t3c6f24d (commit)\n@@ -0,0 +1,139 @@\n+# Third Party imports\n+from rest_framework.permissions import SAFE_METHODS, BasePermission\n+\n+# Module import\n+from plane.db.models import ProjectMember, WorkspaceMember\n+from plane.db.models.project import ROLE\n+\n+\n+class ProjectBasePermission(BasePermission):\n+    def has_permission(self, request, view):\n+        if request.user.is_anonymous:\n+            return False\n+\n+        ## Safe Methods -> Handle the filtering logic in queryset\n+        if request.method in SAFE_METHODS:\n+            return WorkspaceMember.objects.filter(\n+                workspace__slug=view.workspace_slug, member=request.user, is_active=True\n+            ).exists()\n+\n+        ## Only workspace owners or admins can create the projects\n+        if request.method == \"POST\":\n+            return WorkspaceMember.objects.filter(\n+                workspace__slug=view.workspace_slug,\n+                member=request.user,\n+                role__in=[ROLE.ADMIN.value, ROLE.MEMBER.value],\n+                is_active=True,\n+            ).exists()\n+\n+        project_member_qs = ProjectMember.objects.filter(\n+            workspace__slug=view.workspace_slug,\n+            member=request.user,\n+            project_id=view.project_id,\n+            is_active=True,\n+        )\n+\n+        ## Only project admins or workspace admin who is part of the project can access\n+\n+        if project_member_qs.filter(role=ROLE.ADMIN.value).exists():\n+            return True\n+        else:\n+            return (\n+                project_member_qs.exists()\n+                and WorkspaceMember.objects.filter(\n+                    member=request.user,\n+                    workspace__slug=view.workspace_slug,\n+                    role=ROLE.ADMIN.value,\n+                    is_active=True,\n+                ).exists()\n+            )\n+\n+\n+class ProjectMemberPermission(BasePermission):\n+    def has_permission(self, request, view):\n+        if request.user.is_anonymous:\n+            return False\n+\n+        ## Safe Methods -> Handle the filtering logic in queryset\n+        if request.method in SAFE_METHODS:\n+            return ProjectMember.objects.filter(\n+                workspace__slug=view.workspace_slug, member=request.user, is_active=True\n+            ).exists()\n+        ## Only workspace owners or admins can create the projects\n+        if request.method == \"POST\":\n+            return WorkspaceMember.objects.filter(\n+                workspace__slug=view.workspace_slug,\n+                member=request.user,\n+                role__in=[ROLE.ADMIN.value, ROLE.MEMBER.value],\n+                is_active=True,\n+            ).exists()\n+\n+        ## Only Project Admins can update project attributes\n+        return ProjectMember.objects.filter(\n+            workspace__slug=view.workspace_slug,\n+            member=request.user,\n+            role__in=[ROLE.ADMIN.value, ROLE.MEMBER.value],\n+            project_id=view.project_id,\n+            is_active=True,\n+        ).exists()\n+\n+\n+class ProjectEntityPermission(BasePermission):\n+    def has_permission(self, request, view):\n+        if request.user.is_anonymous:\n+            return False\n+\n+        # Handle requests based on project__identifier\n+        if hasattr(view, \"project_identifier\") and view.project_identifier:\n+            if request.method in SAFE_METHODS:\n+                return ProjectMember.objects.filter(\n+                    workspace__slug=view.workspace_slug,\n+                    member=request.user,\n+                    project__identifier=view.project_identifier,\n+                    is_active=True,\n+                ).exists()\n+\n+        ## Safe Methods -> Handle the filtering logic in queryset\n+        if request.method in SAFE_METHODS:\n+            return ProjectMember.objects.filter(\n+                workspace__slug=view.workspace_slug,\n+                member=request.user,\n+                project_id=view.project_id,\n+                is_active=True,\n+            ).exists()\n+\n+        ## Only project members or admins can create and edit the project attributes\n+        return ProjectMember.objects.filter(\n+            workspace__slug=view.workspace_slug,\n+            member=request.user,\n+            role__in=[ROLE.ADMIN.value, ROLE.MEMBER.value],\n+            project_id=view.project_id,\n+            is_active=True,\n+        ).exists()\n+\n+\n+class ProjectAdminPermission(BasePermission):\n+    def has_permission(self, request, view):\n+        if request.user.is_anonymous:\n+            return False\n+\n+        return ProjectMember.objects.filter(\n+            workspace__slug=view.workspace_slug,\n+            member=request.user,\n+            role=ROLE.ADMIN.value,\n+            project_id=view.project_id,\n+            is_active=True,\n+        ).exists()\n+\n+\n+class ProjectLitePermission(BasePermission):\n+    def has_permission(self, request, view):\n+        if request.user.is_anonymous:\n+            return False\n+\n+        return ProjectMember.objects.filter(\n+            workspace__slug=view.workspace_slug,\n+            member=request.user,\n+            project_id=view.project_id,\n+            is_active=True,\n+        ).exists()\n"
        },
        {
          "path": "apps/api/plane/utils/permissions/workspace.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/permissions/workspace.py\n===================================================================\n--- apps/api/plane/utils/permissions/workspace.py\t96bbbec (parent)\n+++ apps/api/plane/utils/permissions/workspace.py\t3c6f24d (commit)\n@@ -0,0 +1,106 @@\n+# Third Party imports\n+from rest_framework.permissions import BasePermission, SAFE_METHODS\n+\n+# Module imports\n+from plane.db.models import WorkspaceMember\n+\n+\n+# Permission Mappings\n+Admin = 20\n+Member = 15\n+Guest = 5\n+\n+\n+# TODO: Move the below logic to python match - python v3.10\n+class WorkSpaceBasePermission(BasePermission):\n+    def has_permission(self, request, view):\n+        # allow anyone to create a workspace\n+        if request.user.is_anonymous:\n+            return False\n+\n+        if request.method == \"POST\":\n+            return True\n+\n+        ## Safe Methods\n+        if request.method in SAFE_METHODS:\n+            return True\n+\n+        # allow only admins and owners to update the workspace settings\n+        if request.method in [\"PUT\", \"PATCH\"]:\n+            return WorkspaceMember.objects.filter(\n+                member=request.user,\n+                workspace__slug=view.workspace_slug,\n+                role__in=[Admin, Member],\n+                is_active=True,\n+            ).exists()\n+\n+        # allow only owner to delete the workspace\n+        if request.method == \"DELETE\":\n+            return WorkspaceMember.objects.filter(\n+                member=request.user,\n+                workspace__slug=view.workspace_slug,\n+                role=Admin,\n+                is_active=True,\n+            ).exists()\n+\n+\n+class WorkspaceOwnerPermission(BasePermission):\n+    def has_permission(self, request, view):\n+        if request.user.is_anonymous:\n+            return False\n+\n+        return WorkspaceMember.objects.filter(\n+            workspace__slug=view.workspace_slug, member=request.user, role=Admin\n+        ).exists()\n+\n+\n+class WorkSpaceAdminPermission(BasePermission):\n+    def has_permission(self, request, view):\n+        if request.user.is_anonymous:\n+            return False\n+\n+        return WorkspaceMember.objects.filter(\n+            member=request.user,\n+            workspace__slug=view.workspace_slug,\n+            role__in=[Admin, Member],\n+            is_active=True,\n+        ).exists()\n+\n+\n+class WorkspaceEntityPermission(BasePermission):\n+    def has_permission(self, request, view):\n+        if request.user.is_anonymous:\n+            return False\n+\n+        ## Safe Methods -> Handle the filtering logic in queryset\n+        if request.method in SAFE_METHODS:\n+            return WorkspaceMember.objects.filter(\n+                workspace__slug=view.workspace_slug, member=request.user, is_active=True\n+            ).exists()\n+\n+        return WorkspaceMember.objects.filter(\n+            member=request.user,\n+            workspace__slug=view.workspace_slug,\n+            role__in=[Admin, Member],\n+            is_active=True,\n+        ).exists()\n+\n+\n+class WorkspaceViewerPermission(BasePermission):\n+    def has_permission(self, request, view):\n+        if request.user.is_anonymous:\n+            return False\n+\n+        return WorkspaceMember.objects.filter(\n+            member=request.user, workspace__slug=view.workspace_slug, is_active=True\n+        ).exists()\n+\n+\n+class WorkspaceUserPermission(BasePermission):\n+    def has_permission(self, request, view):\n+        if request.user.is_anonymous:\n+            return False\n+\n+        return WorkspaceMember.objects.filter(\n+            member=request.user, workspace__slug=view.workspace_slug, is_active=True\n+        ).exists()\n"
        }
      ]
    },
    {
      "id": "add-gantt-layout",
      "sha": "cbfdcd563860edc595e42b4d34a1711764e07009",
      "parentSha": "a04d3b5c29e0fc8a9db1cbb1e1408c2d4e06b03b",
      "spec": "Implement Gantt layout support in the shared base layout system and refactor timeline type handling across web components and hooks.\n\n1) Add Gantt to base layouts UI\n- File: apps/web/core/components/base-layouts/constants.ts\n  - Import TimelineLayoutIcon from @plane/propel/icons alongside existing icons.\n  - Append a new layout config object to BASE_LAYOUTS with key \"gantt\", icon TimelineLayoutIcon, and label \"Gantt Layout\".\n\n2) Introduce Base Gantt layout and sidebar wrappers for base layouts\n- Files: apps/web/core/components/base-layouts/gantt/\n  - index.ts: Export BaseGanttLayout and BaseGanttSidebar.\n  - layout.tsx: Create BaseGanttLayout component that:\n    - Accepts IBaseLayoutsGanttProps<T> where T extends IBaseLayoutsGanttItem from @plane/types.\n    - Flattens groupedItemIds from groups into blockIds for the Gantt.\n    - Wraps user-provided renderBlock and optional renderSidebar to produce sidebarToRender.\n    - Converts onDateUpdate payloads from IBlockUpdateDependencyData[] to TGanttDateUpdate[] (id, start_date, target_date) before passing to onDateUpdate.\n    - Provides timeline type via TimeLineTypeContext.Provider using the timelineType prop (default ISSUE) mapped through GANTT_TIMELINE_TYPE.\n    - Renders GanttChartRoot with blockIds, blockUpdateHandler, blockToRender, sidebarToRender, quickAdd, showAllBlocks/showToday, capability flags, pagination callbacks (loadMoreBlocks, canLoadMoreBlocks) derived from loadMoreItems.\n  - sidebar.tsx: Create BaseGanttSidebar component that:\n    - Accepts items (map of id->item), blockIds, blockUpdateHandler, enableReorder, showAllBlocks, ganttContainerRef, optional pagination (canLoadMoreBlocks, loadMoreItems) and a renderItem callback.\n    - Uses useTimeLineChartStore() to access getBlockById, updateActiveBlockId, isBlockActive, getNumberOfDaysFromPosition.\n    - Renders a virtualized list with RenderIfVisible and GanttDnDHOC for reorder operations; calls handleOrderChange on drop to compute new sort_order and invoke blockUpdateHandler.\n    - Hides items without start and target dates unless showAllBlocks is true; shows duration indicator derived from block position.\n    - Shows an intersection sentinel and invokes loadMoreItems for pagination when canLoadMoreBlocks is true.\n\n3) Plumb \"showAllBlocks\" through Gantt chart UI\n- File: apps/web/core/components/gantt-chart/chart/main-content.tsx\n  - Add showAllBlocks prop when rendering the sidebar region from GanttChartMainContent so downstream sidebars can conditionally render items without dates.\n- File: apps/web/core/components/gantt-chart/sidebar/root.tsx\n  - Accept and pass through showAllBlocks to the specific sidebar renderer used by the chart.\n\n4) Replace local timeline type enum with shared @plane/types timeline type\n- File: apps/web/core/components/gantt-chart/contexts/index.tsx\n  - Remove ETimeLineTypeType. Replace context type with TTimelineType from @plane/types and export TimeLineTypeContext accordingly. useTimeLineType continues to read from context.\n\n5) Update existing Gantt consumers to use the new timeline type\n- Files:\n  - apps/web/core/components/gantt-chart/sidebar/issues/sidebar.tsx\n  - apps/web/core/components/gantt-chart/sidebar/modules/sidebar.tsx\n  - apps/web/core/components/issues/issue-layouts/gantt/base-gantt-root.tsx\n  - apps/web/core/components/modules/gantt-chart/modules-list-layout.tsx\n  - apps/web/core/layouts/auth-layout/project-wrapper.tsx\n  - Replace imports/usage of ETimeLineTypeType with GANTT_TIMELINE_TYPE from @plane/types.\n  - Update TimeLineTypeContext.Provider values to GANTT_TIMELINE_TYPE.<TYPE>.\n  - Update useTimeLineChart calls to pass GANTT_TIMELINE_TYPE.<TYPE>.\n\n6) Refactor timeline store access to a shared mapper\n- File: apps/web/ce/hooks/use-timeline-chart.ts\n  - Implement getTimelineStore(timelineStore: ITimelineStore, timelineType: TTimelineTypeCore) returning the correct timeline sub-store (issues, modules, project, grouped) based on GANTT_TIMELINE_TYPE.\n- File: apps/web/core/hooks/use-timeline-chart.ts\n  - Replace the switch on ETimeLineTypeType with getTimelineStore from the CE hook.\n  - Update types to use TTimelineType.\n  - Expose useTimeLineChart(timelineType: TTimelineType) and useTimeLineChartStore() that reads the type from TimeLineTypeContext and returns the mapped store. Both must throw if StoreContext or timelineType is missing.\n- File: apps/web/ee/hooks/use-timeline-chart.ts\n  - Re-export from ce/hooks/use-timeline-chart to allow future EE extensions.\n\n7) Extend shared types to include Gantt base layout and timeline types\n- Files under packages/types:\n  - src/base-layouts/base.ts: Extend TBaseLayoutType to include \"gantt\".\n  - src/base-layouts/gantt/core.ts: Define CORE_GANTT_TIMELINE_TYPE with ISSUE, MODULE, PROJECT, GROUPED.\n  - src/base-layouts/gantt/extended.ts: Define empty EXTENDED_GANTT_TIMELINE_TYPE export for future extension.\n  - src/base-layouts/gantt/index.ts: Define:\n    - IBaseLayoutsGanttItem with optional start_date and target_date.\n    - TGanttBlockUpdateData (start_date, target_date, sort_order with destinationIndex and newSortOrder).\n    - TGanttDateUpdate for bulk date updates.\n    - IGanttRenderProps, IGanttCapabilities, TGanttDisplayOptions, and IBaseLayoutsGanttProps that extend base layout props tailored for Gantt.\n    - GANTT_TIMELINE_TYPE combining CORE and EXTENDED.\n    - TTimelineTypeCore and TTimelineType types.\n  - src/base-layouts/index.ts: Re-export ./gantt.\n\n8) Ensure icon availability for Gantt layout selector\n- Confirm TimelineLayoutIcon is exported from @plane/propel/icons and ready for use in BASE_LAYOUTS. No changes required if already present.\n\nAcceptance criteria\n- Selecting \"Gantt Layout\" from the base layout selector renders a timeline view using BaseGanttLayout and BaseGanttSidebar with correct icons, title, and controls.\n- Sidebars and chart correctly include/exclude items without dates based on showAllBlocks.\n- Drag-and-drop reorder in the Gantt sidebar updates sort_order via blockUpdateHandler as described.\n- Date dependency updates are transformed and dispatched via onDateUpdate as TGanttDateUpdate.\n- All timeline type references use GANTT_TIMELINE_TYPE/TTimelineType, and timeline store access is centralized through getTimelineStore across CE/EE and core hooks.\n",
      "prompt": "Add first-class Gantt layout support to the shared base layout system and refactor the timeline type handling to use centralized types.\n\n- Extend the base layout selector to include a new Gantt option with the timeline layout icon.\n- Create base Gantt layout and sidebar wrappers that adapt the base layout item model to the existing GanttChartRoot and sidebar rendering, including pagination, selection, reordering, and optional display of items without dates.\n- Replace the local timeline type enum/context consumers to use a shared GANTT_TIMELINE_TYPE and TTimelineType exported from the types package, and update the Gantt hooks and providers accordingly.\n- Centralize timeline store resolution with a shared getTimelineStore that maps the current timeline type to the correct store (issues, modules, project, grouped) and use it in both the core hook and CE/EE exports.\n- Plumb a showAllBlocks flag through the main Gantt chart and sidebar to control whether items without start/target dates are rendered.\n- Update existing issue and module Gantt views to consume the new timeline type constants and context, and ensure drag-and-drop ordering and dependency date updates continue to work.\n\nKeep the implementation consistent with existing base layout and Gantt chart patterns; do not change unrelated behavior.",
      "supplementalFiles": [
        "apps/web/core/components/gantt-chart/root.tsx",
        "apps/web/core/components/gantt-chart/constants.ts",
        "apps/web/core/components/gantt-chart/sidebar/gantt-dnd-HOC.tsx",
        "apps/web/core/components/gantt-chart/sidebar/utils.ts",
        "apps/web/core/components/ui/loader/layouts/gantt-layout-loader.tsx",
        "apps/web/core/lib/store-context.tsx"
      ],
      "fileDiffs": [
        {
          "path": "apps/web/ce/hooks/use-timeline-chart.ts",
          "status": "added",
          "diff": "Index: apps/web/ce/hooks/use-timeline-chart.ts\n===================================================================\n--- apps/web/ce/hooks/use-timeline-chart.ts\ta04d3b5 (parent)\n+++ apps/web/ce/hooks/use-timeline-chart.ts\tcbfdcd5 (commit)\n@@ -0,0 +1,26 @@\n+// types\n+import type { TTimelineTypeCore } from \"@plane/types\";\n+import { GANTT_TIMELINE_TYPE } from \"@plane/types\";\n+// Plane-web\n+\n+import type { IBaseTimelineStore } from \"@/plane-web/store/timeline/base-timeline.store\";\n+import type { ITimelineStore } from \"../store/timeline\";\n+\n+export const getTimelineStore = (\n+  timelineStore: ITimelineStore,\n+  timelineType: TTimelineTypeCore\n+): IBaseTimelineStore => {\n+  if (timelineType === GANTT_TIMELINE_TYPE.ISSUE) {\n+    return timelineStore.issuesTimeLineStore as IBaseTimelineStore;\n+  }\n+  if (timelineType === GANTT_TIMELINE_TYPE.MODULE) {\n+    return timelineStore.modulesTimeLineStore as IBaseTimelineStore;\n+  }\n+  if (timelineType === GANTT_TIMELINE_TYPE.PROJECT) {\n+    return timelineStore.projectTimeLineStore as IBaseTimelineStore;\n+  }\n+  if (timelineType === GANTT_TIMELINE_TYPE.GROUPED) {\n+    return timelineStore.groupedTimeLineStore as IBaseTimelineStore;\n+  }\n+  throw new Error(`Unknown timeline type: ${timelineType}`);\n+};\n"
        },
        {
          "path": "apps/web/core/components/base-layouts/constants.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/components/base-layouts/constants.ts\n===================================================================\n--- apps/web/core/components/base-layouts/constants.ts\ta04d3b5 (parent)\n+++ apps/web/core/components/base-layouts/constants.ts\tcbfdcd5 (commit)\n@@ -1,5 +1,5 @@\n-import { BoardLayoutIcon, ListLayoutIcon } from \"@plane/propel/icons\";\n+import { BoardLayoutIcon, ListLayoutIcon, TimelineLayoutIcon } from \"@plane/propel/icons\";\n import type { IBaseLayoutConfig } from \"@plane/types\";\n \n export const BASE_LAYOUTS: IBaseLayoutConfig[] = [\n   {\n@@ -11,5 +11,10 @@\n     key: \"kanban\",\n     icon: BoardLayoutIcon,\n     label: \"Board Layout\",\n   },\n+  {\n+    key: \"gantt\",\n+    icon: TimelineLayoutIcon,\n+    label: \"Gantt Layout\",\n+  },\n ];\n"
        },
        {
          "path": "apps/web/core/components/base-layouts/gantt/index.ts",
          "status": "added",
          "diff": "Index: apps/web/core/components/base-layouts/gantt/index.ts\n===================================================================\n--- apps/web/core/components/base-layouts/gantt/index.ts\ta04d3b5 (parent)\n+++ apps/web/core/components/base-layouts/gantt/index.ts\tcbfdcd5 (commit)\n@@ -0,0 +1,2 @@\n+export { BaseGanttLayout } from \"./layout\";\n+export { BaseGanttSidebar } from \"./sidebar\";\n"
        },
        {
          "path": "apps/web/core/components/base-layouts/gantt/layout.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/base-layouts/gantt/layout.tsx\n===================================================================\n--- apps/web/core/components/base-layouts/gantt/layout.tsx\ta04d3b5 (parent)\n+++ apps/web/core/components/base-layouts/gantt/layout.tsx\tcbfdcd5 (commit)\n@@ -0,0 +1,140 @@\n+\"use client\";\n+\n+import { useCallback, useMemo } from \"react\";\n+import { observer } from \"mobx-react\";\n+import { GANTT_TIMELINE_TYPE } from \"@plane/types\";\n+import type {\n+  IBaseLayoutsGanttItem,\n+  IBaseLayoutsGanttProps,\n+  TGanttBlockUpdateData,\n+  IBlockUpdateDependencyData,\n+} from \"@plane/types\";\n+import { cn } from \"@plane/utils\";\n+import { TimeLineTypeContext } from \"@/components/gantt-chart/contexts\";\n+import { GanttChartRoot } from \"@/components/gantt-chart/root\";\n+import { BaseGanttSidebar } from \"./sidebar\";\n+\n+export const BaseGanttLayout = observer(<T extends IBaseLayoutsGanttItem>(props: IBaseLayoutsGanttProps<T>) => {\n+  const {\n+    items,\n+    groupedItemIds,\n+    groups,\n+    renderBlock,\n+    renderSidebar,\n+    onBlockUpdate,\n+    onDateUpdate,\n+    enableBlockLeftResize = false,\n+    enableBlockRightResize = false,\n+    enableBlockMove = false,\n+    enableReorder = false,\n+    enableAddBlock = false,\n+    enableSelection = false,\n+    enableDependency = false,\n+    showAllBlocks = false,\n+    showToday = true,\n+    border = false,\n+    title = \"Items\",\n+    loaderTitle = \"items\",\n+    quickAdd,\n+    loadMoreItems,\n+    isLoading: _isLoading,\n+    className,\n+    timelineType: timelineTypeKey = GANTT_TIMELINE_TYPE.ISSUE,\n+  } = props;\n+\n+  // Flatten all grouped item IDs into a single array for gantt\n+  // Gantt doesn't typically show groups, it shows all items on a timeline\n+  const blockIds = useMemo(() => {\n+    const allIds: string[] = [];\n+    groups.forEach((group) => {\n+      const itemIds = groupedItemIds[group.id] || [];\n+      allIds.push(...itemIds);\n+    });\n+    return allIds;\n+  }, [groups, groupedItemIds]);\n+\n+  // Block update handler - transforms base layout item updates to gantt block updates\n+  const handleBlockUpdate = useCallback(\n+    (block: T, payload: TGanttBlockUpdateData) => {\n+      if (onBlockUpdate) {\n+        onBlockUpdate(block, payload);\n+      }\n+    },\n+    [onBlockUpdate]\n+  );\n+\n+  // Block renderer - wraps the user's render function\n+  const blockToRender = useCallback((item: T) => renderBlock(item), [renderBlock]);\n+\n+  // Sidebar renderer - uses custom or default\n+  const sidebarToRender = useCallback(\n+    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n+    (sidebarProps: any) => {\n+      if (renderSidebar) {\n+        // If custom sidebar renderer provided, use it\n+        return (\n+          <BaseGanttSidebar {...sidebarProps} items={items} renderItem={renderSidebar} loadMoreItems={loadMoreItems} />\n+        );\n+      }\n+      // Otherwise use default sidebar\n+      return (\n+        <BaseGanttSidebar {...sidebarProps} items={items} renderItem={renderBlock} loadMoreItems={loadMoreItems} />\n+      );\n+    },\n+    [renderSidebar, renderBlock, items, loadMoreItems]\n+  );\n+\n+  const timelineType = GANTT_TIMELINE_TYPE[timelineTypeKey];\n+\n+  // Date update handler - transforms IBlockUpdateDependencyData to TGanttDateUpdate\n+  const handleDateUpdate = useCallback(\n+    async (updates: IBlockUpdateDependencyData[]) => {\n+      if (onDateUpdate) {\n+        // Transform IBlockUpdateDependencyData[] to TGanttDateUpdate[]\n+        const transformedUpdates = updates.map((update) => ({\n+          id: update.id,\n+          start_date: update.start_date,\n+          target_date: update.target_date,\n+        }));\n+        await onDateUpdate(transformedUpdates);\n+      }\n+    },\n+    [onDateUpdate]\n+  );\n+\n+  // Load more handler - wraps loadMoreItems to match expected signature\n+  const handleLoadMore = useCallback(() => {\n+    if (loadMoreItems) {\n+      loadMoreItems(\"\"); // Pass empty string as default group ID\n+    }\n+  }, [loadMoreItems]);\n+\n+  return (\n+    <TimeLineTypeContext.Provider value={timelineType}>\n+      <div className={cn(\"h-full w-full\", className)}>\n+        <GanttChartRoot\n+          border={border}\n+          title={title}\n+          loaderTitle={loaderTitle}\n+          blockIds={blockIds}\n+          blockUpdateHandler={handleBlockUpdate}\n+          blockToRender={blockToRender}\n+          sidebarToRender={sidebarToRender}\n+          enableBlockLeftResize={enableBlockLeftResize}\n+          enableBlockRightResize={enableBlockRightResize}\n+          enableBlockMove={enableBlockMove}\n+          enableReorder={enableReorder}\n+          enableAddBlock={enableAddBlock}\n+          enableSelection={enableSelection}\n+          enableDependency={enableDependency}\n+          showAllBlocks={showAllBlocks}\n+          showToday={showToday}\n+          quickAdd={quickAdd}\n+          updateBlockDates={onDateUpdate ? handleDateUpdate : undefined}\n+          loadMoreBlocks={loadMoreItems ? handleLoadMore : undefined}\n+          canLoadMoreBlocks={!!loadMoreItems} // Enable pagination if loadMoreItems is provided\n+        />\n+      </div>\n+    </TimeLineTypeContext.Provider>\n+  );\n+});\n"
        },
        {
          "path": "apps/web/core/components/base-layouts/gantt/sidebar.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/base-layouts/gantt/sidebar.tsx\n===================================================================\n--- apps/web/core/components/base-layouts/gantt/sidebar.tsx\ta04d3b5 (parent)\n+++ apps/web/core/components/base-layouts/gantt/sidebar.tsx\tcbfdcd5 (commit)\n@@ -0,0 +1,148 @@\n+\"use client\";\n+\n+import type { RefObject } from \"react\";\n+import { useState } from \"react\";\n+import { observer } from \"mobx-react\";\n+import type { IBaseLayoutsBaseItem, IBlockUpdateData } from \"@plane/types\";\n+import { Loader, Row } from \"@plane/ui\";\n+import { cn } from \"@plane/utils\";\n+import RenderIfVisible from \"@/components/core/render-if-visible-HOC\";\n+import { BLOCK_HEIGHT } from \"@/components/gantt-chart/constants\";\n+import { GanttDnDHOC } from \"@/components/gantt-chart/sidebar/gantt-dnd-HOC\";\n+import { handleOrderChange } from \"@/components/gantt-chart/sidebar/utils\";\n+import { GanttLayoutListItemLoader } from \"@/components/ui/loader/layouts/gantt-layout-loader\";\n+import { useIntersectionObserver } from \"@/hooks/use-intersection-observer\";\n+import { useTimeLineChartStore } from \"@/hooks/use-timeline-chart\";\n+\n+type Props<T extends IBaseLayoutsBaseItem> = {\n+  blockUpdateHandler: (block: T, payload: IBlockUpdateData) => void;\n+  canLoadMoreBlocks?: boolean;\n+  loadMoreItems?: (groupId: string) => void;\n+  ganttContainerRef: RefObject<HTMLDivElement>;\n+  blockIds: string[];\n+  enableReorder: boolean;\n+  showAllBlocks?: boolean;\n+  items: Record<string, T>;\n+  renderItem: (item: T) => React.ReactNode;\n+};\n+\n+export const BaseGanttSidebar = observer(<T extends IBaseLayoutsBaseItem>(props: Props<T>) => {\n+  const {\n+    blockUpdateHandler,\n+    blockIds,\n+    enableReorder,\n+    loadMoreItems,\n+    canLoadMoreBlocks,\n+    ganttContainerRef,\n+    showAllBlocks = false,\n+    items,\n+    renderItem,\n+  } = props;\n+\n+  const { getBlockById, updateActiveBlockId, isBlockActive, getNumberOfDaysFromPosition } = useTimeLineChartStore();\n+\n+  const [intersectionElement, setIntersectionElement] = useState<HTMLDivElement | null>(null);\n+\n+  const isPaginating = false; // TODO: Add proper pagination state\n+\n+  useIntersectionObserver(\n+    ganttContainerRef,\n+    isPaginating ? null : intersectionElement,\n+    loadMoreItems ? () => loadMoreItems(\"\") : undefined,\n+    \"100% 0% 100% 0%\"\n+  );\n+\n+  const handleOnDrop = (\n+    draggingBlockId: string | undefined,\n+    droppedBlockId: string | undefined,\n+    dropAtEndOfList: boolean\n+  ) => {\n+    handleOrderChange(draggingBlockId, droppedBlockId, dropAtEndOfList, blockIds, getBlockById, blockUpdateHandler);\n+  };\n+\n+  return (\n+    <div>\n+      {blockIds ? (\n+        <>\n+          {blockIds.map((blockId, index) => {\n+            const block = getBlockById(blockId);\n+            const item = items[blockId];\n+            const isBlockVisibleOnSidebar = block?.start_date && block?.target_date;\n+\n+            // hide the block if it doesn't have start and target dates and showAllBlocks is false\n+            if (!block || (!showAllBlocks && !isBlockVisibleOnSidebar)) return null;\n+\n+            if (!item) return null;\n+\n+            return (\n+              <RenderIfVisible\n+                key={blockId}\n+                root={ganttContainerRef}\n+                horizontalOffset={100}\n+                verticalOffset={200}\n+                shouldRecordHeights={false}\n+                placeholderChildren={<GanttLayoutListItemLoader />}\n+              >\n+                <GanttDnDHOC\n+                  id={blockId}\n+                  isLastChild={index === blockIds.length - 1}\n+                  isDragEnabled={enableReorder}\n+                  onDrop={handleOnDrop}\n+                >\n+                  {(isDragging: boolean) => {\n+                    const block = getBlockById(blockId);\n+                    const isBlockComplete = !!block?.start_date && !!block?.target_date;\n+                    const duration = isBlockComplete ? getNumberOfDaysFromPosition(block?.position?.width) : undefined;\n+                    const isBlockHoveredOn = isBlockActive(blockId);\n+\n+                    return (\n+                      <div\n+                        className={cn(\"group/list-block\", {\n+                          \"rounded bg-custom-background-80\": isDragging,\n+                        })}\n+                        onMouseEnter={() => updateActiveBlockId(blockId)}\n+                        onMouseLeave={() => updateActiveBlockId(null)}\n+                      >\n+                        <Row\n+                          className={cn(\"group w-full flex items-center gap-2 pr-4\", {\n+                            \"bg-custom-background-90\": isBlockHoveredOn,\n+                          })}\n+                          style={{\n+                            height: `${BLOCK_HEIGHT}px`,\n+                          }}\n+                        >\n+                          <div className=\"flex h-full flex-grow items-center justify-between gap-2 truncate\">\n+                            <div className=\"flex-grow truncate\">{renderItem(item)}</div>\n+                            {duration && (\n+                              <div className=\"flex-shrink-0 text-sm text-custom-text-200\">\n+                                <span>\n+                                  {duration} day{duration > 1 ? \"s\" : \"\"}\n+                                </span>\n+                              </div>\n+                            )}\n+                          </div>\n+                        </Row>\n+                      </div>\n+                    );\n+                  }}\n+                </GanttDnDHOC>\n+              </RenderIfVisible>\n+            );\n+          })}\n+          {canLoadMoreBlocks && (\n+            <div ref={setIntersectionElement} className=\"p-2\">\n+              <div className=\"flex h-10 md:h-8 w-full items-center justify-between gap-1.5 rounded md:px-1 px-4 py-1.5 bg-custom-background-80 animate-pulse\" />\n+            </div>\n+          )}\n+        </>\n+      ) : (\n+        <Loader className=\"space-y-3 pr-2\">\n+          <Loader.Item height=\"34px\" />\n+          <Loader.Item height=\"34px\" />\n+          <Loader.Item height=\"34px\" />\n+          <Loader.Item height=\"34px\" />\n+        </Loader>\n+      )}\n+    </div>\n+  );\n+});\n"
        },
        {
          "path": "apps/web/core/components/gantt-chart/chart/main-content.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/gantt-chart/chart/main-content.tsx\n===================================================================\n--- apps/web/core/components/gantt-chart/chart/main-content.tsx\ta04d3b5 (parent)\n+++ apps/web/core/components/gantt-chart/chart/main-content.tsx\tcbfdcd5 (commit)\n@@ -186,8 +186,9 @@\n                 sidebarToRender={sidebarToRender}\n                 title={title}\n                 quickAdd={quickAdd}\n                 selectionHelpers={helpers}\n+                showAllBlocks={showAllBlocks}\n                 isEpic={isEpic}\n               />\n               <div className=\"relative min-h-full h-max flex-shrink-0 flex-grow\">\n                 <ActiveChartView />\n"
        },
        {
          "path": "apps/web/core/components/gantt-chart/contexts/index.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/gantt-chart/contexts/index.tsx\n===================================================================\n--- apps/web/core/components/gantt-chart/contexts/index.tsx\ta04d3b5 (parent)\n+++ apps/web/core/components/gantt-chart/contexts/index.tsx\tcbfdcd5 (commit)\n@@ -1,16 +1,9 @@\n import { createContext, useContext } from \"react\";\n+import type { TTimelineType } from \"@plane/types\";\n \n-export enum ETimeLineTypeType {\n-  ISSUE = \"ISSUE\",\n-  MODULE = \"MODULE\",\n-  PROJECT = \"PROJECT\",\n-  GROUPED = \"GROUPED\",\n-}\n+export const TimeLineTypeContext = createContext<TTimelineType | undefined>(undefined);\n \n-export const TimeLineTypeContext = createContext<ETimeLineTypeType | undefined>(undefined);\n-\n export const useTimeLineType = () => {\n   const timelineType = useContext(TimeLineTypeContext);\n-\n   return timelineType;\n };\n"
        },
        {
          "path": "apps/web/core/components/gantt-chart/sidebar/issues/sidebar.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/gantt-chart/sidebar/issues/sidebar.tsx\n===================================================================\n--- apps/web/core/components/gantt-chart/sidebar/issues/sidebar.tsx\ta04d3b5 (parent)\n+++ apps/web/core/components/gantt-chart/sidebar/issues/sidebar.tsx\tcbfdcd5 (commit)\n@@ -3,8 +3,9 @@\n import type { RefObject } from \"react\";\n import { useState } from \"react\";\n import { observer } from \"mobx-react\";\n // ui\n+import { GANTT_TIMELINE_TYPE } from \"@plane/types\";\n import type { IBlockUpdateData } from \"@plane/types\";\n import { Loader } from \"@plane/ui\";\n // components\n import RenderIfVisible from \"@/components/core/render-if-visible-HOC\";\n@@ -14,9 +15,8 @@\n import { useIssuesStore } from \"@/hooks/use-issue-layout-store\";\n import type { TSelectionHelper } from \"@/hooks/use-multiple-select\";\n // local imports\n import { useTimeLineChart } from \"../../../../hooks/use-timeline-chart\";\n-import { ETimeLineTypeType } from \"../../contexts\";\n import { GanttDnDHOC } from \"../gantt-dnd-HOC\";\n import { handleOrderChange } from \"../utils\";\n import { IssuesSidebarBlock } from \"./block\";\n \n@@ -46,9 +46,9 @@\n     selectionHelpers,\n     isEpic = false,\n   } = props;\n \n-  const { getBlockById } = useTimeLineChart(ETimeLineTypeType.ISSUE);\n+  const { getBlockById } = useTimeLineChart(GANTT_TIMELINE_TYPE.ISSUE);\n \n   const {\n     issues: { getIssueLoader },\n   } = useIssuesStore();\n"
        },
        {
          "path": "apps/web/core/components/gantt-chart/sidebar/modules/sidebar.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/gantt-chart/sidebar/modules/sidebar.tsx\n===================================================================\n--- apps/web/core/components/gantt-chart/sidebar/modules/sidebar.tsx\ta04d3b5 (parent)\n+++ apps/web/core/components/gantt-chart/sidebar/modules/sidebar.tsx\tcbfdcd5 (commit)\n@@ -1,15 +1,14 @@\n \"use client\";\n \n import { observer } from \"mobx-react\";\n // ui\n+import { GANTT_TIMELINE_TYPE } from \"@plane/types\";\n import type { IBlockUpdateData } from \"@plane/types\";\n import { Loader } from \"@plane/ui\";\n // components\n // hooks\n import { useTimeLineChart } from \"@/hooks/use-timeline-chart\";\n-//\n-import { ETimeLineTypeType } from \"../../contexts\";\n import { GanttDnDHOC } from \"../gantt-dnd-HOC\";\n import { handleOrderChange } from \"../utils\";\n import { ModulesSidebarBlock } from \"./block\";\n // types\n@@ -23,9 +22,9 @@\n \n export const ModuleGanttSidebar: React.FC<Props> = observer((props) => {\n   const { blockUpdateHandler, blockIds, enableReorder } = props;\n \n-  const { getBlockById } = useTimeLineChart(ETimeLineTypeType.MODULE);\n+  const { getBlockById } = useTimeLineChart(GANTT_TIMELINE_TYPE.MODULE);\n \n   const handleOnDrop = (\n     draggingBlockId: string | undefined,\n     droppedBlockId: string | undefined,\n"
        },
        {
          "path": "apps/web/core/components/gantt-chart/sidebar/root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/gantt-chart/sidebar/root.tsx\n===================================================================\n--- apps/web/core/components/gantt-chart/sidebar/root.tsx\ta04d3b5 (parent)\n+++ apps/web/core/components/gantt-chart/sidebar/root.tsx\tcbfdcd5 (commit)\n@@ -23,8 +23,9 @@\n   sidebarToRender: (props: any) => React.ReactNode;\n   title: string;\n   quickAdd?: React.ReactNode | undefined;\n   selectionHelpers: TSelectionHelper;\n+  showAllBlocks?: boolean;\n   isEpic?: boolean;\n };\n \n export const GanttChartSidebar: React.FC<Props> = observer((props) => {\n@@ -40,8 +41,9 @@\n     ganttContainerRef,\n     title,\n     quickAdd,\n     selectionHelpers,\n+    showAllBlocks = false,\n     isEpic = false,\n   } = props;\n \n   const isGroupSelectionEmpty = selectionHelpers.isGroupSelected(GANTT_SELECT_GROUP) === \"empty\";\n@@ -93,8 +95,9 @@\n             canLoadMoreBlocks,\n             ganttContainerRef,\n             loadMoreBlocks,\n             selectionHelpers,\n+            showAllBlocks,\n             isEpic,\n           })}\n       </Row>\n       {quickAdd ? quickAdd : null}\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-layouts/gantt/base-gantt-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-layouts/gantt/base-gantt-root.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-layouts/gantt/base-gantt-root.tsx\ta04d3b5 (parent)\n+++ apps/web/core/components/issues/issue-layouts/gantt/base-gantt-root.tsx\tcbfdcd5 (commit)\n@@ -5,12 +5,12 @@\n import { ALL_ISSUES, EUserPermissions, EUserPermissionsLevel } from \"@plane/constants\";\n import { useTranslation } from \"@plane/i18n\";\n import { TOAST_TYPE, setToast } from \"@plane/propel/toast\";\n import type { EIssuesStoreType, IBlockUpdateData, TIssue } from \"@plane/types\";\n-import { EIssueLayoutTypes } from \"@plane/types\";\n+import { EIssueLayoutTypes, GANTT_TIMELINE_TYPE } from \"@plane/types\";\n import { renderFormattedPayloadDate } from \"@plane/utils\";\n // components\n-import { ETimeLineTypeType, TimeLineTypeContext } from \"@/components/gantt-chart/contexts\";\n+import { TimeLineTypeContext } from \"@/components/gantt-chart/contexts\";\n import { GanttChartRoot } from \"@/components/gantt-chart/root\";\n import { IssueGanttSidebar } from \"@/components/gantt-chart/sidebar/issues/sidebar\";\n // hooks\n import { useIssues } from \"@/hooks/store/use-issues\";\n@@ -46,9 +46,9 @@\n \n   const storeType = useIssueStoreType() as GanttStoreType;\n   const { issues, issuesFilter } = useIssues(storeType);\n   const { fetchIssues, fetchNextIssues, updateIssue, quickAddIssue } = useIssuesActions(storeType);\n-  const { initGantt } = useTimeLineChart(ETimeLineTypeType.ISSUE);\n+  const { initGantt } = useTimeLineChart(GANTT_TIMELINE_TYPE.ISSUE);\n   // store hooks\n   const { allowPermissions } = useUserPermissions();\n \n   const appliedDisplayFilters = issuesFilter.issueFilters?.displayFilters;\n@@ -119,9 +119,9 @@\n     ) : undefined;\n \n   return (\n     <IssueLayoutHOC layout={EIssueLayoutTypes.GANTT}>\n-      <TimeLineTypeContext.Provider value={ETimeLineTypeType.ISSUE}>\n+      <TimeLineTypeContext.Provider value={GANTT_TIMELINE_TYPE.ISSUE}>\n         <div className=\"h-full w-full\">\n           <GanttChartRoot\n             border={false}\n             title={isEpic ? t(\"epic.label\", { count: 2 }) : t(\"issue.label\", { count: 2 })}\n"
        },
        {
          "path": "apps/web/core/components/modules/gantt-chart/modules-list-layout.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/modules/gantt-chart/modules-list-layout.tsx\n===================================================================\n--- apps/web/core/components/modules/gantt-chart/modules-list-layout.tsx\ta04d3b5 (parent)\n+++ apps/web/core/components/modules/gantt-chart/modules-list-layout.tsx\tcbfdcd5 (commit)\n@@ -1,11 +1,12 @@\n import { observer } from \"mobx-react\";\n import { useParams } from \"next/navigation\";\n // PLane\n+import { GANTT_TIMELINE_TYPE } from \"@plane/types\";\n import type { IBlockUpdateData, IBlockUpdateDependencyData, IModule } from \"@plane/types\";\n // components\n import { GanttChartRoot, ModuleGanttSidebar } from \"@/components/gantt-chart\";\n-import { ETimeLineTypeType, TimeLineTypeContext } from \"@/components/gantt-chart/contexts\";\n+import { TimeLineTypeContext } from \"@/components/gantt-chart/contexts\";\n import { ModuleGanttBlock } from \"@/components/modules\";\n // hooks\n import { useModule } from \"@/hooks/store/use-module\";\n import { useModuleFilter } from \"@/hooks/store/use-module-filter\";\n@@ -48,9 +49,9 @@\n \n   if (!filteredModuleIds) return null;\n \n   return (\n-    <TimeLineTypeContext.Provider value={ETimeLineTypeType.MODULE}>\n+    <TimeLineTypeContext.Provider value={GANTT_TIMELINE_TYPE.MODULE}>\n       <GanttChartRoot\n         title=\"Modules\"\n         loaderTitle=\"Modules\"\n         blockIds={filteredModuleIds}\n"
        },
        {
          "path": "apps/web/core/hooks/use-timeline-chart.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/hooks/use-timeline-chart.ts\n===================================================================\n--- apps/web/core/hooks/use-timeline-chart.ts\ta04d3b5 (parent)\n+++ apps/web/core/hooks/use-timeline-chart.ts\tcbfdcd5 (commit)\n@@ -1,31 +1,26 @@\n import { useContext } from \"react\";\n+// types\n+import type { TTimelineType } from \"@plane/types\";\n // lib\n import { StoreContext } from \"@/lib/store-context\";\n // Plane-web\n+import { getTimelineStore } from \"@/plane-web/hooks/use-timeline-chart\";\n import type { IBaseTimelineStore } from \"@/plane-web/store/timeline/base-timeline.store\";\n-//\n-import { ETimeLineTypeType, useTimeLineType } from \"../components/gantt-chart/contexts\";\n+import { useTimeLineType } from \"../components/gantt-chart/contexts\";\n \n-export const useTimeLineChart = (timeLineType: ETimeLineTypeType): IBaseTimelineStore => {\n+export const useTimeLineChart = (timelineType: TTimelineType): IBaseTimelineStore => {\n   const context = useContext(StoreContext);\n-  if (context === undefined) throw new Error(\"useTimeLineChart must be used within StoreProvider\");\n+  if (!context) throw new Error(\"useTimeLineChart must be used within StoreProvider\");\n \n-  switch (timeLineType) {\n-    case ETimeLineTypeType.ISSUE:\n-      return context.timelineStore.issuesTimeLineStore;\n-    case ETimeLineTypeType.MODULE:\n-      return context.timelineStore.modulesTimeLineStore as IBaseTimelineStore;\n-    case ETimeLineTypeType.PROJECT:\n-      return context.timelineStore.projectTimeLineStore as IBaseTimelineStore;\n-    case ETimeLineTypeType.GROUPED:\n-      return context.timelineStore.groupedTimeLineStore as IBaseTimelineStore;\n-  }\n+  return getTimelineStore(context.timelineStore, timelineType);\n };\n \n-export const useTimeLineChartStore = () => {\n+export const useTimeLineChartStore = (): IBaseTimelineStore => {\n+  const context = useContext(StoreContext);\n   const timelineType = useTimeLineType();\n \n+  if (!context) throw new Error(\"useTimeLineChartStore must be used within StoreProvider\");\n   if (!timelineType) throw new Error(\"useTimeLineChartStore must be used within TimeLineTypeContext\");\n \n-  return useTimeLineChart(timelineType);\n+  return getTimelineStore(context.timelineStore, timelineType);\n };\n"
        },
        {
          "path": "apps/web/core/layouts/auth-layout/project-wrapper.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/layouts/auth-layout/project-wrapper.tsx\n===================================================================\n--- apps/web/core/layouts/auth-layout/project-wrapper.tsx\ta04d3b5 (parent)\n+++ apps/web/core/layouts/auth-layout/project-wrapper.tsx\tcbfdcd5 (commit)\n@@ -7,13 +7,12 @@\n // plane imports\n import { EUserPermissions, EUserPermissionsLevel, PROJECT_TRACKER_ELEMENTS } from \"@plane/constants\";\n import { useTranslation } from \"@plane/i18n\";\n import { EmptyStateDetailed } from \"@plane/propel/empty-state\";\n-import { EProjectNetwork } from \"@plane/types\";\n+import { EProjectNetwork, GANTT_TIMELINE_TYPE } from \"@plane/types\";\n // components\n import { JoinProject } from \"@/components/auth-screens/project/join-project\";\n import { LogoSpinner } from \"@/components/common/logo-spinner\";\n-import { ETimeLineTypeType } from \"@/components/gantt-chart/contexts\";\n import {\n   PROJECT_DETAILS,\n   PROJECT_ME_INFORMATION,\n   PROJECT_LABELS,\n@@ -56,9 +55,9 @@\n   const { fetchUserProjectInfo, allowPermissions, getProjectRoleByWorkspaceSlugAndProjectId } = useUserPermissions();\n   const { loader, getProjectById, fetchProjectDetails } = useProject();\n   const { fetchAllCycles } = useCycle();\n   const { fetchModulesSlim, fetchModules } = useModule();\n-  const { initGantt } = useTimeLineChart(ETimeLineTypeType.MODULE);\n+  const { initGantt } = useTimeLineChart(GANTT_TIMELINE_TYPE.MODULE);\n   const { fetchViews } = useProjectView();\n   const {\n     project: { fetchProjectMembers },\n   } = useMember();\n"
        },
        {
          "path": "apps/web/ee/hooks/use-timeline-chart.ts",
          "status": "added",
          "diff": "Index: apps/web/ee/hooks/use-timeline-chart.ts\n===================================================================\n--- apps/web/ee/hooks/use-timeline-chart.ts\ta04d3b5 (parent)\n+++ apps/web/ee/hooks/use-timeline-chart.ts\tcbfdcd5 (commit)\n@@ -0,0 +1,3 @@\n+// For now, just re-export from CE\n+// In the future, you can extend the timeline store mapping here for EE-specific timeline types\n+export * from \"ce/hooks/use-timeline-chart\";\n"
        },
        {
          "path": "packages/types/src/base-layouts/base.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/base-layouts/base.ts\n===================================================================\n--- packages/types/src/base-layouts/base.ts\ta04d3b5 (parent)\n+++ packages/types/src/base-layouts/base.ts\tcbfdcd5 (commit)\n@@ -51,9 +51,9 @@\n export interface IRenderProps<T extends IBaseLayoutsBaseItem> extends IItemRenderProps<T>, IGroupRenderProps {}\n \n // Layout Configuration\n \n-export type TBaseLayoutType = \"list\" | \"kanban\";\n+export type TBaseLayoutType = \"list\" | \"kanban\" | \"gantt\";\n \n export interface IBaseLayoutConfig {\n   key: TBaseLayoutType;\n   icon: React.ComponentType<React.SVGProps<SVGSVGElement>>;\n"
        },
        {
          "path": "packages/types/src/base-layouts/gantt/core.ts",
          "status": "added",
          "diff": "Index: packages/types/src/base-layouts/gantt/core.ts\n===================================================================\n--- packages/types/src/base-layouts/gantt/core.ts\ta04d3b5 (parent)\n+++ packages/types/src/base-layouts/gantt/core.ts\tcbfdcd5 (commit)\n@@ -0,0 +1,6 @@\n+export const CORE_GANTT_TIMELINE_TYPE = {\n+  ISSUE: \"ISSUE\",\n+  MODULE: \"MODULE\",\n+  PROJECT: \"PROJECT\",\n+  GROUPED: \"GROUPED\",\n+} as const;\n"
        },
        {
          "path": "packages/types/src/base-layouts/gantt/extended.ts",
          "status": "added",
          "diff": "Index: packages/types/src/base-layouts/gantt/extended.ts\n===================================================================\n--- packages/types/src/base-layouts/gantt/extended.ts\ta04d3b5 (parent)\n+++ packages/types/src/base-layouts/gantt/extended.ts\tcbfdcd5 (commit)\n@@ -0,0 +1,1 @@\n+export const EXTENDED_GANTT_TIMELINE_TYPE = {} as const;\n"
        },
        {
          "path": "packages/types/src/base-layouts/gantt/index.ts",
          "status": "added",
          "diff": "Index: packages/types/src/base-layouts/gantt/index.ts\n===================================================================\n--- packages/types/src/base-layouts/gantt/index.ts\ta04d3b5 (parent)\n+++ packages/types/src/base-layouts/gantt/index.ts\tcbfdcd5 (commit)\n@@ -0,0 +1,78 @@\n+import type { ReactNode } from \"react\";\n+import type { IBaseLayoutsBaseItem, IBaseLayoutsBaseProps } from \"../base\";\n+import { CORE_GANTT_TIMELINE_TYPE } from \"./core\";\n+import { EXTENDED_GANTT_TIMELINE_TYPE } from \"./extended\";\n+\n+// Gantt-specific item with date fields\n+export interface IBaseLayoutsGanttItem extends IBaseLayoutsBaseItem {\n+  start_date?: string | null;\n+  target_date?: string | null;\n+}\n+\n+// Block update data (for drag/resize operations)\n+export type TGanttBlockUpdateData = {\n+  start_date?: string;\n+  target_date?: string;\n+  sort_order?: {\n+    destinationIndex: number;\n+    newSortOrder: number;\n+  };\n+};\n+\n+// Date update handler for bulk date changes (e.g., dependency updates)\n+export type TGanttDateUpdate = {\n+  id: string;\n+  start_date?: string;\n+  target_date?: string;\n+};\n+\n+// Render props specific to Gantt\n+export interface IGanttRenderProps<T extends IBaseLayoutsGanttItem> {\n+  renderBlock: (item: T) => ReactNode;\n+  renderSidebar?: (item: T) => ReactNode;\n+}\n+\n+// Gantt-specific capabilities\n+export interface IGanttCapabilities {\n+  enableBlockLeftResize?: boolean | ((itemId: string) => boolean);\n+  enableBlockRightResize?: boolean | ((itemId: string) => boolean);\n+  enableBlockMove?: boolean | ((itemId: string) => boolean);\n+  enableReorder?: boolean | ((itemId: string) => boolean);\n+  enableAddBlock?: boolean | ((itemId: string) => boolean);\n+  enableSelection?: boolean | ((itemId: string) => boolean);\n+  enableDependency?: boolean | ((itemId: string) => boolean);\n+}\n+\n+// Gantt display options\n+export type TGanttDisplayOptions = {\n+  showAllBlocks?: boolean; // Show blocks even without dates\n+  showToday?: boolean; // Highlight today on timeline\n+  border?: boolean;\n+  title?: string;\n+  loaderTitle?: string;\n+  quickAdd?: ReactNode;\n+  timelineType?: TTimelineType; // Type of timeline to use for store\n+};\n+\n+// Main Gantt Layout Props\n+export interface IBaseLayoutsGanttProps<T extends IBaseLayoutsGanttItem>\n+  extends Omit<IBaseLayoutsBaseProps<T>, \"renderItem\" | \"enableDragDrop\" | \"onDrop\" | \"canDrag\">,\n+    IGanttRenderProps<T>,\n+    IGanttCapabilities,\n+    TGanttDisplayOptions {\n+  // Handler for block updates (position, dates, order)\n+  onBlockUpdate?: (item: T, payload: TGanttBlockUpdateData) => void | Promise<void>;\n+\n+  // Handler for bulk date updates (dependencies, etc.)\n+  onDateUpdate?: (updates: TGanttDateUpdate[]) => void | Promise<void>;\n+}\n+\n+export const GANTT_TIMELINE_TYPE = {\n+  ...CORE_GANTT_TIMELINE_TYPE,\n+  ...EXTENDED_GANTT_TIMELINE_TYPE,\n+} as const;\n+\n+export type TTimelineTypeCore = (typeof CORE_GANTT_TIMELINE_TYPE)[keyof typeof CORE_GANTT_TIMELINE_TYPE];\n+export type TTimelineType =\n+  | TTimelineTypeCore\n+  | (typeof EXTENDED_GANTT_TIMELINE_TYPE)[keyof typeof EXTENDED_GANTT_TIMELINE_TYPE];\n"
        },
        {
          "path": "packages/types/src/base-layouts/index.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/base-layouts/index.ts\n===================================================================\n--- packages/types/src/base-layouts/index.ts\ta04d3b5 (parent)\n+++ packages/types/src/base-layouts/index.ts\tcbfdcd5 (commit)\n@@ -1,3 +1,4 @@\n export * from \"./base\";\n export * from \"./list\";\n export * from \"./kanban\";\n+export * from \"./gantt\";\n"
        }
      ]
    },
    {
      "id": "implement-exporters",
      "sha": "416812780355550cade5a8af9d082a8a36e5d879",
      "parentSha": "9dc14d8d67e79a486206dab8d88d0a8359f9f1c0",
      "spec": "Implement a schema-driven export system and refactor the issue export task to use it, plus add reverse relation mapping on issues.\n\n1) Create exporters package under apps/api/plane/utils/exporters\n- Directory: apps/api/plane/utils/exporters/\n- Files to add:\n  - __init__.py: Re-export Exporter, formatter classes (BaseFormatter, CSVFormatter, JSONFormatter, XLSXFormatter), base schema classes (ExportSchema, ExportField, StringField, NumberField, DateField, DateTimeField, BooleanField, ListField, JSONField), and IssueExportSchema.\n  - exporter.py: Define Exporter class with FORMATTERS mapping {\"csv\": CSVFormatter, \"json\": JSONFormatter, \"xlsx\": XLSXFormatter}. Methods:\n    - __init__(format_type: str, schema_class: Type, options: dict | None = None): validate format_type, set formatter and options.\n    - export(filename: str, data: QuerySet | List[dict], fields: List[str] | None = None) -> (str, str|bytes): serialize queryset via schema_class.serialize_queryset if data is a QuerySet, else use as-is; pass to formatter.format and return (filename_with_ext, content).\n    - classmethods get_available_formats() and register_formatter(format_type, formatter_class).\n  - formatters.py: Implement BaseFormatter and concrete formatters for CSV/JSON/XLSX.\n    - BaseFormatter.format(...) abstract; _get_field_info(schema_class) returns (field_order, field_labels) from schema._declared_fields preserving declaration order and labels.\n    - CSVFormatter: Join list values with options[\"list_joiner\"] (default \", \"); JSON-serialize dicts; produce .csv content with header row (labels) then data rows.\n    - JSONFormatter: Preserve native types; map field labels as keys; produce a JSON array string with .json extension.\n    - XLSXFormatter: Same value handling as CSV; build an openpyxl Workbook with header and rows; return .xlsx bytes.\n  - schemas/__init__.py: Re-export base field types/classes and IssueExportSchema.\n  - schemas/base.py: Implement ExportField dataclass (source, default, label) with dotted-path resolution; typed fields StringField, NumberField, BooleanField, ListField, JSONField, DateField, DateTimeField with appropriate formatting; ExportSchemaMeta to collect declared fields preserving order; ExportSchema with serialize(obj, fields=None), serialize_queryset(queryset, fields=None) that calls get_context_data(queryset) to build context and then serializes each object; default get_context_data returns {}.\n  - schemas/issue.py: Implement IssueExportSchema extending ExportSchema to export issue data with fields and preparers:\n    - Fields (labels shown are display names): id (ID), project_identifier (Project Identifier from project.identifier), project_name (Project), project_id (Project ID), sequence_id (Sequence ID), name (Name), description (Description, from description_stripped), priority (Priority), start_date (Start Date), target_date (Target Date), state_name (State), created_at (Created At), updated_at (Updated At), completed_at (Completed At), archived_at (Archived At), module_name (Module Name, list), created_by (Created By), labels (Labels, list), comments (Comments, JSON), estimate (Estimate), link (Link, list), assignees (Assignees, list), subscribers_count (Subscribers Count), attachment_count (Attachment Count), attachment_links (Attachment Links, list), cycle_name (Cycle Name), cycle_start_date (Cycle Start Date), cycle_end_date (Cycle End Date), parent (Parent), relations (Relations, JSON map).\n    - Preparers should compute: id as \"{project.identifier}-{sequence_id}\"; state_name from state if present; module_name from issue_module; created_by from created_by; labels from labels; comments with comment_stripped, created_at (date formatted), created_by; estimate from estimate_point.value; link from issue_link; assignees from assignees; subscribers_count from issue_subscribers count; attachment_count and attachment_links using attachments_dict in context; cycle_* using cycles_dict in context; parent as \"{parent.project.identifier}-{parent.sequence_id}\"; relations combining forward relations on issue_relation and reverse relations from issue_related using the reverse mapping (see step 2).\n    - get_context_data(queryset): return dict with attachments_dict (map of issue.id -> [attachment ids] for FileAsset where entity_type=ISSUE_ATTACHMENT) and cycles_dict (issue.id -> last CycleIssue for issue with select_related(\"cycle\")).\n  - README.md: Document usage, API, and examples for exporters, as shown in the diff (overview, quick start, schema, formats, advanced usage). Content must describe ListField/JSONField behaviors and field filtering.\n\n2) Update issue model for reverse relation mapping\n- File to change: apps/api/plane/db/models/issue.py\n- After the IssueRelationChoices declaration, add two class-level attributes (defined after class creation to avoid metaclass conflicts):\n  - IssueRelationChoices._RELATION_PAIRS = (\n      (\"blocked_by\", \"blocking\"),\n      (\"relates_to\", \"relates_to\"),\n      (\"duplicate\", \"duplicate\"),\n      (\"start_before\", \"start_after\"),\n      (\"finish_before\", \"finish_after\"),\n      (\"implemented_by\", \"implements\"),\n    )\n  - IssueRelationChoices._REVERSE_MAPPING = {forward: reverse for forward, reverse in IssueRelationChoices._RELATION_PAIRS}\n\n3) Refactor the issue export task to use the Exporter and IssueExportSchema\n- File to change: apps/api/plane/bgtasks/export_task.py\n- Remove local helper functions related to CSV/JSON/XLSX creation and issue dict assembly: dateTimeConverter, dateConverter, create_csv_file, create_json_file, create_xlsx_file, generate_table_row, generate_json_row, update_json_row, update_table_row, generate_csv, generate_json, generate_xlsx, get_created_by, and the code that builds issues_data and header and maps provider to those functions.\n- Update imports: drop csv, json, datetime/date, openpyxl, F, Label, User, IssueComment, FileAsset; import Prefetch (keep), and import Exporter and IssueExportSchema from plane.utils.exporters.\n- Build workspace_issues queryset filtering by workspace_id and provided project_ids and membership constraints (unchanged), with:\n  - select_related(\"project\", \"workspace\", \"state\", \"created_by\", \"estimate_point\").\n  - prefetch_related: \"labels\", \"issue_cycle__cycle\", \"issue_module__module\", \"issue_comments\", \"assignees\", \"issue_subscribers\", \"issue_link\", and:\n    - Prefetch(\"issue_relation\", queryset=IssueRelation.objects.select_related(\"related_issue\", \"related_issue__project\"))\n    - Prefetch(\"issue_related\", queryset=IssueRelation.objects.select_related(\"issue\", \"issue__project\"))\n    - Prefetch(\"parent\", queryset=Issue.objects.select_related(\"type\", \"project\"))\n- Instantiate an Exporter with the provider: exporter = Exporter(format_type=provider, schema_class=IssueExportSchema, options={\"list_joiner\": \", \"}). If provider is invalid, mark ExporterHistory status failed and set reason to the exception message, then return.\n- Multiple export:\n  - If multiple is True: for each project_id in project_ids, filter project_issues = workspace_issues.filter(project_id=project_id); call exporter.export(f\"{slug}-{project_id}\", project_issues); append the returned (filename, content) to files.\n  - Else: call exporter.export(f\"{slug}-{workspace_id}\", workspace_issues) and append.\n- Keep create_zip_file(files) and upload_to_s3(zip_buffer, workspace_id, token_id, slug) behavior as before. No change to s3 upload logic besides acceptable formatting of long f-strings.\n- Ensure exporter_instance status is set to \"processing\" at start and updated via upload_to_s3 on completion, and on any exception set status to \"failed\" and reason accordingly.\n\n4) Behavior and acceptance criteria\n- Exporting with provider=csv/json/xlsx generates a single file when multiple=False and one file per project when multiple=True.\n- The exported data includes the fields defined in IssueExportSchema with the specified labels and transformations.\n- Lists appear as arrays in JSON and are comma-separated strings in CSV/XLSX (customizable via options[\"list_joiner\"]).\n- Relations field must include both forward and reverse relations using IssueRelationChoices._REVERSE_MAPPING for reverse types.\n- Parent field shows the parent issue key (PROJECT-SEQ) when present or empty otherwise.\n- Attachments and cycle details are populated via context and do not trigger N+1 queries.\n- Invalid provider results in ExporterHistory status \"failed\" with a reason describing unsupported format.\n",
      "prompt": "Refactor the server-side issue export to use a flexible, schema-based exporter that supports CSV, JSON, and XLSX. Add a new exporters utility module that lets you define export schemas with typed fields and custom preparer methods, and use it to define an Issue export schema that includes core fields, labels, assignees, comments, attachments, cycles, parent issue, and bidirectional relations. Update the background export task to build an efficient queryset with the necessary prefetches and delegate the export to this exporter for single-file and per-project exports. Also add a reverse mapping for issue relation types so that reverse relations can be labeled correctly in the export. Ensure incorrect providers fail gracefully, and the resulting files are zipped and uploaded as before.",
      "supplementalFiles": [
        "apps/api/plane/db/models/asset.py",
        "apps/api/plane/db/models/cycle.py",
        "apps/api/plane/db/models/exporter.py"
      ],
      "fileDiffs": [
        {
          "path": "apps/api/plane/bgtasks/export_task.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/bgtasks/export_task.py\n===================================================================\n--- apps/api/plane/bgtasks/export_task.py\t9dc14d8 (parent)\n+++ apps/api/plane/bgtasks/export_task.py\t4168127 (commit)\n@@ -1,85 +1,27 @@\n # Python imports\n-import csv\n import io\n-import json\n import zipfile\n from typing import List\n+from collections import defaultdict\n import boto3\n from botocore.client import Config\n from uuid import UUID\n-from datetime import datetime, date\n \n # Third party imports\n from celery import shared_task\n \n-\n # Django imports\n from django.conf import settings\n from django.utils import timezone\n-from openpyxl import Workbook\n-from django.db.models import F, Prefetch\n+from django.db.models import Prefetch\n \n-from collections import defaultdict\n-\n # Module imports\n-from plane.db.models import ExporterHistory, Issue, FileAsset, Label, User, IssueComment\n+from plane.db.models import ExporterHistory, Issue, IssueRelation\n from plane.utils.exception_logger import log_exception\n+from plane.utils.exporters import Exporter, IssueExportSchema\n \n \n-def dateTimeConverter(time: datetime) -> str | None:\n-    \"\"\"\n-    Convert a datetime object to a formatted string.\n-    \"\"\"\n-    if time:\n-        return time.strftime(\"%a, %d %b %Y %I:%M:%S %Z%z\")\n-\n-\n-def dateConverter(time: date) -> str | None:\n-    \"\"\"\n-    Convert a date object to a formatted string.\n-    \"\"\"\n-    if time:\n-        return time.strftime(\"%a, %d %b %Y\")\n-\n-\n-def create_csv_file(data: List[List[str]]) -> str:\n-    \"\"\"\n-    Create a CSV file from the provided data.\n-    \"\"\"\n-    csv_buffer = io.StringIO()\n-    csv_writer = csv.writer(csv_buffer, delimiter=\",\", quoting=csv.QUOTE_ALL)\n-\n-    for row in data:\n-        csv_writer.writerow(row)\n-\n-    csv_buffer.seek(0)\n-    return csv_buffer.getvalue()\n-\n-\n-def create_json_file(data: List[dict]) -> str:\n-    \"\"\"\n-    Create a JSON file from the provided data.\n-    \"\"\"\n-    return json.dumps(data)\n-\n-\n-def create_xlsx_file(data: List[List[str]]) -> bytes:\n-    \"\"\"\n-    Create an XLSX file from the provided data.\n-    \"\"\"\n-    workbook = Workbook()\n-    sheet = workbook.active\n-\n-    for row in data:\n-        sheet.append(row)\n-\n-    xlsx_buffer = io.BytesIO()\n-    workbook.save(xlsx_buffer)\n-    xlsx_buffer.seek(0)\n-    return xlsx_buffer.getvalue()\n-\n-\n def create_zip_file(files: List[tuple[str, str | bytes]]) -> io.BytesIO:\n     \"\"\"\n     Create a ZIP file from the provided files.\n     \"\"\"\n@@ -117,9 +59,11 @@\n \n         # Generate presigned url for the uploaded file with different base\n         presign_s3 = boto3.client(\n             \"s3\",\n-            endpoint_url=f\"{settings.AWS_S3_URL_PROTOCOL}//{str(settings.AWS_S3_CUSTOM_DOMAIN).replace('/uploads', '')}/\",  # noqa: E501\n+            endpoint_url=(\n+                f\"{settings.AWS_S3_URL_PROTOCOL}//{str(settings.AWS_S3_CUSTOM_DOMAIN).replace('/uploads', '')}/\"\n+            ),\n             aws_access_key_id=settings.AWS_ACCESS_KEY_ID,\n             aws_secret_access_key=settings.AWS_SECRET_ACCESS_KEY,\n             config=Config(signature_version=\"s3v4\"),\n         )\n@@ -175,189 +119,8 @@\n \n     exporter_instance.save(update_fields=[\"status\", \"url\", \"key\"])\n \n \n-def generate_table_row(issue: dict) -> List[str]:\n-    \"\"\"\n-    Generate a table row from an issue dictionary.\n-    \"\"\"\n-    return [\n-        f\"\"\"{issue[\"project_identifier\"]}-{issue[\"sequence_id\"]}\"\"\",\n-        issue[\"project_name\"],\n-        issue[\"name\"],\n-        issue[\"description\"],\n-        issue[\"state_name\"],\n-        dateConverter(issue[\"start_date\"]),\n-        dateConverter(issue[\"target_date\"]),\n-        issue[\"priority\"],\n-        issue[\"created_by\"],\n-        \", \".join(issue[\"labels\"]) if issue[\"labels\"] else \"\",\n-        issue[\"cycle_name\"],\n-        issue[\"cycle_start_date\"],\n-        issue[\"cycle_end_date\"],\n-        \", \".join(issue.get(\"module_name\", \"\")) if issue.get(\"module_name\") else \"\",\n-        dateTimeConverter(issue[\"created_at\"]),\n-        dateTimeConverter(issue[\"updated_at\"]),\n-        dateTimeConverter(issue[\"completed_at\"]),\n-        dateTimeConverter(issue[\"archived_at\"]),\n-        (\n-            \", \".join(\n-                [\n-                    f\"{comment['comment']} ({comment['created_at']} by {comment['created_by']})\"\n-                    for comment in issue[\"comments\"]\n-                ]\n-            )\n-            if issue[\"comments\"]\n-            else \"\"\n-        ),\n-        issue[\"estimate\"] if issue[\"estimate\"] else \"\",\n-        \", \".join(issue[\"link\"]) if issue[\"link\"] else \"\",\n-        \", \".join(issue[\"assignees\"]) if issue[\"assignees\"] else \"\",\n-        issue[\"subscribers_count\"] if issue[\"subscribers_count\"] else \"\",\n-        issue[\"attachment_count\"] if issue[\"attachment_count\"] else \"\",\n-        \", \".join(issue[\"attachment_links\"]) if issue[\"attachment_links\"] else \"\",\n-    ]\n-\n-\n-def generate_json_row(issue: dict) -> dict:\n-    \"\"\"\n-    Generate a JSON row from an issue dictionary.\n-    \"\"\"\n-    return {\n-        \"ID\": f\"\"\"{issue[\"project_identifier\"]}-{issue[\"sequence_id\"]}\"\"\",\n-        \"Project\": issue[\"project_name\"],\n-        \"Name\": issue[\"name\"],\n-        \"Description\": issue[\"description\"],\n-        \"State\": issue[\"state_name\"],\n-        \"Start Date\": dateConverter(issue[\"start_date\"]),\n-        \"Target Date\": dateConverter(issue[\"target_date\"]),\n-        \"Priority\": issue[\"priority\"],\n-        \"Created By\": (f\"{issue['created_by']}\" if issue[\"created_by\"] else \"\"),\n-        \"Assignee\": issue[\"assignees\"],\n-        \"Labels\": issue[\"labels\"],\n-        \"Cycle Name\": issue[\"cycle_name\"],\n-        \"Cycle Start Date\": issue[\"cycle_start_date\"],\n-        \"Cycle End Date\": issue[\"cycle_end_date\"],\n-        \"Module Name\": issue[\"module_name\"],\n-        \"Created At\": dateTimeConverter(issue[\"created_at\"]),\n-        \"Updated At\": dateTimeConverter(issue[\"updated_at\"]),\n-        \"Completed At\": dateTimeConverter(issue[\"completed_at\"]),\n-        \"Archived At\": dateTimeConverter(issue[\"archived_at\"]),\n-        \"Comments\": issue[\"comments\"],\n-        \"Estimate\": issue[\"estimate\"],\n-        \"Link\": issue[\"link\"],\n-        \"Subscribers Count\": issue[\"subscribers_count\"],\n-        \"Attachment Count\": issue[\"attachment_count\"],\n-        \"Attachment Links\": issue[\"attachment_links\"],\n-    }\n-\n-\n-def update_json_row(rows: List[dict], row: dict) -> None:\n-    \"\"\"\n-    Update the json row with the new assignee and label.\n-    \"\"\"\n-    matched_index = next(\n-        (index for index, existing_row in enumerate(rows) if existing_row[\"ID\"] == row[\"ID\"]),\n-        None,\n-    )\n-\n-    if matched_index is not None:\n-        existing_assignees, existing_labels = (\n-            rows[matched_index][\"Assignee\"],\n-            rows[matched_index][\"Labels\"],\n-        )\n-        assignee, label = row[\"Assignee\"], row[\"Labels\"]\n-\n-        if assignee is not None and (existing_assignees is None or label not in existing_assignees):\n-            rows[matched_index][\"Assignee\"] += f\", {assignee}\"\n-        if label is not None and (existing_labels is None or label not in existing_labels):\n-            rows[matched_index][\"Labels\"] += f\", {label}\"\n-    else:\n-        rows.append(row)\n-\n-\n-def update_table_row(rows: List[List[str]], row: List[str]) -> None:\n-    \"\"\"\n-    Update the table row with the new assignee and label.\n-    \"\"\"\n-    matched_index = next(\n-        (index for index, existing_row in enumerate(rows) if existing_row[0] == row[0]),\n-        None,\n-    )\n-\n-    if matched_index is not None:\n-        existing_assignees, existing_labels = rows[matched_index][7:9]\n-        assignee, label = row[7:9]\n-\n-        if assignee is not None and (existing_assignees is None or label not in existing_assignees):\n-            rows[matched_index][8] += f\", {assignee}\"\n-        if label is not None and (existing_labels is None or label not in existing_labels):\n-            rows[matched_index][8] += f\", {label}\"\n-    else:\n-        rows.append(row)\n-\n-\n-def generate_csv(\n-    header: List[str],\n-    project_id: str,\n-    issues: List[dict],\n-    files: List[tuple[str, str | bytes]],\n-) -> None:\n-    \"\"\"\n-    Generate CSV export for all the passed issues.\n-    \"\"\"\n-    rows = [header]\n-    for issue in issues:\n-        row = generate_table_row(issue)\n-        update_table_row(rows, row)\n-    csv_file = create_csv_file(rows)\n-    files.append((f\"{project_id}.csv\", csv_file))\n-\n-\n-def generate_json(\n-    header: List[str],\n-    project_id: str,\n-    issues: List[dict],\n-    files: List[tuple[str, str | bytes]],\n-) -> None:\n-    \"\"\"\n-    Generate JSON export for all the passed issues.\n-    \"\"\"\n-    rows = []\n-    for issue in issues:\n-        row = generate_json_row(issue)\n-        update_json_row(rows, row)\n-    json_file = create_json_file(rows)\n-    files.append((f\"{project_id}.json\", json_file))\n-\n-\n-def generate_xlsx(\n-    header: List[str],\n-    project_id: str,\n-    issues: List[dict],\n-    files: List[tuple[str, str | bytes]],\n-) -> None:\n-    \"\"\"\n-    Generate XLSX export for all the passed issues.\n-    \"\"\"\n-    rows = [header]\n-    for issue in issues:\n-        row = generate_table_row(issue)\n-\n-        update_table_row(rows, row)\n-    xlsx_file = create_xlsx_file(rows)\n-    files.append((f\"{project_id}.xlsx\", xlsx_file))\n-\n-\n-def get_created_by(obj: Issue | IssueComment) -> str:\n-    \"\"\"\n-    Get the created by user for the given object.\n-    \"\"\"\n-    if obj.created_by:\n-        return f\"{obj.created_by.first_name} {obj.created_by.last_name}\"\n-    return \"\"\n-\n-\n @shared_task\n def issue_export_task(\n     provider: str,\n     workspace_id: UUID,\n@@ -376,9 +139,9 @@\n         exporter_instance = ExporterHistory.objects.get(token=token_id)\n         exporter_instance.status = \"processing\"\n         exporter_instance.save(update_fields=[\"status\"])\n \n-        # Base query to get the issues\n+        # Build base queryset for issues\n         workspace_issues = (\n             Issue.objects.filter(\n                 workspace__id=workspace_id,\n                 project_id__in=project_ids,\n@@ -389,9 +152,8 @@\n             .select_related(\n                 \"project\",\n                 \"workspace\",\n                 \"state\",\n-                \"parent\",\n                 \"created_by\",\n                 \"estimate_point\",\n             )\n             .prefetch_related(\n@@ -399,146 +161,53 @@\n                 \"issue_cycle__cycle\",\n                 \"issue_module__module\",\n                 \"issue_comments\",\n                 \"assignees\",\n+                \"issue_subscribers\",\n+                \"issue_link\",\n                 Prefetch(\n-                    \"assignees\",\n-                    queryset=User.objects.only(\"first_name\", \"last_name\").distinct(),\n-                    to_attr=\"assignee_details\",\n+                    \"issue_relation\",\n+                    queryset=IssueRelation.objects.select_related(\"related_issue\", \"related_issue__project\"),\n                 ),\n                 Prefetch(\n-                    \"labels\",\n-                    queryset=Label.objects.only(\"name\").distinct(),\n-                    to_attr=\"label_details\",\n+                    \"issue_related\",\n+                    queryset=IssueRelation.objects.select_related(\"issue\", \"issue__project\"),\n                 ),\n-                \"issue_subscribers\",\n-                \"issue_link\",\n+                Prefetch(\n+                    \"parent\",\n+                    queryset=Issue.objects.select_related(\"type\", \"project\"),\n+                ),\n             )\n         )\n \n-        # Get the attachments for the issues\n-        file_assets = FileAsset.objects.filter(\n-            issue_id__in=workspace_issues.values_list(\"id\", flat=True),\n-            entity_type=FileAsset.EntityTypeContext.ISSUE_ATTACHMENT,\n-        ).annotate(work_item_id=F(\"issue_id\"), asset_id=F(\"id\"))\n+        # Create exporter for the specified format\n+        try:\n+            exporter = Exporter(\n+                format_type=provider,\n+                schema_class=IssueExportSchema,\n+                options={\"list_joiner\": \", \"},\n+            )\n+        except ValueError as e:\n+            # Invalid format type\n+            exporter_instance = ExporterHistory.objects.get(token=token_id)\n+            exporter_instance.status = \"failed\"\n+            exporter_instance.reason = str(e)\n+            exporter_instance.save(update_fields=[\"status\", \"reason\"])\n+            return\n \n-        # Create a dictionary to store the attachments for the issues\n-        attachment_dict = defaultdict(list)\n-        for asset in file_assets:\n-            attachment_dict[asset.work_item_id].append(asset.asset_id)\n-\n-        # Create a list to store the issues data\n-        issues_data = []\n-\n-        # Iterate over the issues\n-        for issue in workspace_issues:\n-            attachments = attachment_dict.get(issue.id, [])\n-\n-            issue_data = {\n-                \"id\": issue.id,\n-                \"project_identifier\": issue.project.identifier,\n-                \"project_name\": issue.project.name,\n-                \"project_id\": issue.project.id,\n-                \"sequence_id\": issue.sequence_id,\n-                \"name\": issue.name,\n-                \"description\": issue.description_stripped,\n-                \"priority\": issue.priority,\n-                \"start_date\": issue.start_date,\n-                \"target_date\": issue.target_date,\n-                \"state_name\": issue.state.name if issue.state else None,\n-                \"created_at\": issue.created_at,\n-                \"updated_at\": issue.updated_at,\n-                \"completed_at\": issue.completed_at,\n-                \"archived_at\": issue.archived_at,\n-                \"module_name\": [module.module.name for module in issue.issue_module.all()],\n-                \"created_by\": get_created_by(issue),\n-                \"labels\": [label.name for label in issue.label_details],\n-                \"comments\": [\n-                    {\n-                        \"comment\": comment.comment_stripped,\n-                        \"created_at\": dateConverter(comment.created_at),\n-                        \"created_by\": get_created_by(comment),\n-                    }\n-                    for comment in issue.issue_comments.all()\n-                ],\n-                \"estimate\": issue.estimate_point.value if issue.estimate_point and issue.estimate_point.value else \"\",\n-                \"link\": [link.url for link in issue.issue_link.all()],\n-                \"assignees\": [f\"{assignee.first_name} {assignee.last_name}\" for assignee in issue.assignee_details],\n-                \"subscribers_count\": issue.issue_subscribers.count(),\n-                \"attachment_count\": len(attachments),\n-                \"attachment_links\": [\n-                    f\"/api/assets/v2/workspaces/{issue.workspace.slug}/projects/{issue.project_id}/issues/{issue.id}/attachments/{asset}/\"\n-                    for asset in attachments\n-                ],\n-            }\n-\n-            # Get Cycles data for the issue\n-            cycle = issue.issue_cycle.last()\n-            if cycle:\n-                # Update cycle data\n-                issue_data[\"cycle_name\"] = cycle.cycle.name\n-                issue_data[\"cycle_start_date\"] = dateConverter(cycle.cycle.start_date)\n-                issue_data[\"cycle_end_date\"] = dateConverter(cycle.cycle.end_date)\n-            else:\n-                issue_data[\"cycle_name\"] = \"\"\n-                issue_data[\"cycle_start_date\"] = \"\"\n-                issue_data[\"cycle_end_date\"] = \"\"\n-\n-            issues_data.append(issue_data)\n-\n-            # CSV header\n-        header = [\n-            \"ID\",\n-            \"Project\",\n-            \"Name\",\n-            \"Description\",\n-            \"State\",\n-            \"Start Date\",\n-            \"Target Date\",\n-            \"Priority\",\n-            \"Created By\",\n-            \"Labels\",\n-            \"Cycle Name\",\n-            \"Cycle Start Date\",\n-            \"Cycle End Date\",\n-            \"Module Name\",\n-            \"Created At\",\n-            \"Updated At\",\n-            \"Completed At\",\n-            \"Archived At\",\n-            \"Comments\",\n-            \"Estimate\",\n-            \"Link\",\n-            \"Assignees\",\n-            \"Subscribers Count\",\n-            \"Attachment Count\",\n-            \"Attachment Links\",\n-        ]\n-\n-        # Map the provider to the function\n-        EXPORTER_MAPPER = {\n-            \"csv\": generate_csv,\n-            \"json\": generate_json,\n-            \"xlsx\": generate_xlsx,\n-        }\n-\n         files = []\n         if multiple:\n-            project_dict = defaultdict(list)\n-            for issue in issues_data:\n-                project_dict[str(issue[\"project_id\"])].append(issue)\n-\n+            # Export each project separately with its own queryset\n             for project_id in project_ids:\n-                issues = project_dict.get(str(project_id), [])\n-\n-                exporter = EXPORTER_MAPPER.get(provider)\n-                if exporter is not None:\n-                    exporter(header, project_id, issues, files)\n-\n+                project_issues = workspace_issues.filter(project_id=project_id)\n+                export_filename = f\"{slug}-{project_id}\"\n+                filename, content = exporter.export(export_filename, project_issues)\n+                files.append((filename, content))\n         else:\n-            exporter = EXPORTER_MAPPER.get(provider)\n-            if exporter is not None:\n-                exporter(header, workspace_id, issues_data, files)\n+            # Export all issues in a single file\n+            export_filename = f\"{slug}-{workspace_id}\"\n+            filename, content = exporter.export(export_filename, workspace_issues)\n+            files.append((filename, content))\n \n         zip_buffer = create_zip_file(files)\n         upload_to_s3(zip_buffer, workspace_id, token_id, slug)\n \n"
        },
        {
          "path": "apps/api/plane/db/models/issue.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/db/models/issue.py\n===================================================================\n--- apps/api/plane/db/models/issue.py\t9dc14d8 (parent)\n+++ apps/api/plane/db/models/issue.py\t4168127 (commit)\n@@ -272,8 +272,23 @@\n     FINISH_BEFORE = \"finish_before\", \"Finish Before\"\n     IMPLEMENTED_BY = \"implemented_by\", \"Implemented By\"\n \n \n+# Bidirectional relation pairs: (forward, reverse)\n+# Defined after class to avoid enum metaclass conflicts\n+IssueRelationChoices._RELATION_PAIRS = (\n+    (\"blocked_by\", \"blocking\"),\n+    (\"relates_to\", \"relates_to\"),  # symmetric\n+    (\"duplicate\", \"duplicate\"),  # symmetric\n+    (\"start_before\", \"start_after\"),\n+    (\"finish_before\", \"finish_after\"),\n+    (\"implemented_by\", \"implements\"),\n+)\n+\n+# Generate reverse mapping from pairs\n+IssueRelationChoices._REVERSE_MAPPING = {forward: reverse for forward, reverse in IssueRelationChoices._RELATION_PAIRS}\n+\n+\n class IssueRelation(ProjectBaseModel):\n     issue = models.ForeignKey(Issue, related_name=\"issue_relation\", on_delete=models.CASCADE)\n     related_issue = models.ForeignKey(Issue, related_name=\"issue_related\", on_delete=models.CASCADE)\n     relation_type = models.CharField(\n"
        },
        {
          "path": "apps/api/plane/utils/exporters/README.md",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/exporters/README.md\n===================================================================\n--- apps/api/plane/utils/exporters/README.md\t9dc14d8 (parent)\n+++ apps/api/plane/utils/exporters/README.md\t4168127 (commit)\n@@ -0,0 +1,496 @@\n+# 📊 Exporters\n+\n+A flexible and extensible data export utility for exporting Django model data in multiple formats (CSV, JSON, XLSX).\n+\n+## 🎯 Overview\n+\n+The exporters module provides a schema-based approach to exporting data with support for:\n+\n+- **📄 Multiple formats**: CSV, JSON, and XLSX (Excel)\n+- **🔒 Type-safe field definitions**: StringField, NumberField, DateField, DateTimeField, BooleanField, ListField, JSONField\n+- **⚡ Custom transformations**: Field-level transformations and custom preparer methods\n+- **🔗 Dotted path notation**: Easy access to nested attributes and related models\n+- **🎨 Format-specific handling**: Automatic formatting based on export format (e.g., lists as arrays in JSON, comma-separated in CSV)\n+\n+## 🚀 Quick Start\n+\n+### Basic Usage\n+\n+```python\n+from plane.utils.exporters import Exporter, ExportSchema, StringField, NumberField\n+\n+# Define a schema\n+class UserExportSchema(ExportSchema):\n+    name = StringField(source=\"username\", label=\"User Name\")\n+    email = StringField(source=\"email\", label=\"Email Address\")\n+    posts_count = NumberField(label=\"Total Posts\")\n+\n+    def prepare_posts_count(self, obj):\n+        return obj.posts.count()\n+\n+# Export data - just pass the queryset!\n+users = User.objects.all()\n+exporter = Exporter(format_type=\"csv\", schema_class=UserExportSchema)\n+filename, content = exporter.export(\"users_export\", users)\n+```\n+\n+### Exporting Issues\n+\n+```python\n+from plane.utils.exporters import Exporter, IssueExportSchema\n+\n+# Get issues with prefetched relations\n+issues = Issue.objects.filter(project_id=project_id).prefetch_related(\n+    'assignee_details',\n+    'label_details',\n+    'issue_module',\n+    # ... other relations\n+)\n+\n+# Export as XLSX - pass the queryset directly!\n+exporter = Exporter(format_type=\"xlsx\", schema_class=IssueExportSchema)\n+filename, content = exporter.export(\"issues\", issues)\n+\n+# Export with custom fields only\n+exporter = Exporter(format_type=\"json\", schema_class=IssueExportSchema)\n+filename, content = exporter.export(\"issues_filtered\", issues, fields=[\"id\", \"name\", \"state_name\", \"assignees\"])\n+```\n+\n+### Exporting Multiple Projects Separately\n+\n+```python\n+# Export each project to a separate file\n+for project_id in project_ids:\n+    project_issues = issues.filter(project_id=project_id)\n+    exporter = Exporter(format_type=\"csv\", schema_class=IssueExportSchema)\n+    filename, content = exporter.export(f\"issues-{project_id}\", project_issues)\n+    # Save or upload the file\n+```\n+\n+## 📝 Schema Definition\n+\n+### Field Types\n+\n+#### 📝 StringField\n+\n+Converts values to strings.\n+\n+```python\n+name = StringField(source=\"name\", label=\"Name\", default=\"N/A\")\n+```\n+\n+#### 🔢 NumberField\n+\n+Handles numeric values (int, float).\n+\n+```python\n+count = NumberField(source=\"items_count\", label=\"Count\", default=0)\n+```\n+\n+#### 📅 DateField\n+\n+Formats date objects as `%a, %d %b %Y` (e.g., \"Mon, 01 Jan 2024\").\n+\n+```python\n+start_date = DateField(source=\"start_date\", label=\"Start Date\")\n+```\n+\n+#### ⏰ DateTimeField\n+\n+Formats datetime objects as `%a, %d %b %Y %I:%M:%S %Z%z`.\n+\n+```python\n+created_at = DateTimeField(source=\"created_at\", label=\"Created At\")\n+```\n+\n+#### ✅ BooleanField\n+\n+Converts values to boolean.\n+\n+```python\n+is_active = BooleanField(source=\"is_active\", label=\"Active\", default=False)\n+```\n+\n+#### 📋 ListField\n+\n+Handles list/array values. In CSV/XLSX, lists are joined with a separator (default: `\", \"`). In JSON, they remain as arrays.\n+\n+```python\n+tags = ListField(source=\"tags\", label=\"Tags\")\n+assignees = ListField(label=\"Assignees\")  # Custom preparer can populate this\n+```\n+\n+#### 🗂️ JSONField\n+\n+Handles complex JSON-serializable objects (dicts, lists of dicts). In CSV/XLSX, they're serialized as JSON strings. In JSON, they remain as objects.\n+\n+```python\n+metadata = JSONField(source=\"metadata\", label=\"Metadata\")\n+comments = JSONField(label=\"Comments\")\n+```\n+\n+### ⚙️ Field Parameters\n+\n+All field types support these parameters:\n+\n+- **`source`**: Dotted path string to the attribute (e.g., `\"project.name\"`)\n+- **`default`**: Default value when field is None\n+- **`label`**: Display name in export headers\n+\n+### 🔗 Dotted Path Notation\n+\n+Access nested attributes using dot notation:\n+\n+```python\n+project_name = StringField(source=\"project.name\", label=\"Project\")\n+owner_email = StringField(source=\"created_by.email\", label=\"Owner Email\")\n+```\n+\n+### 🎯 Custom Preparers\n+\n+For complex logic, define `prepare_{field_name}` methods:\n+\n+```python\n+class MySchema(ExportSchema):\n+    assignees = ListField(label=\"Assignees\")\n+\n+    def prepare_assignees(self, obj):\n+        return [f\"{u.first_name} {u.last_name}\" for u in obj.assignee_details]\n+```\n+\n+Preparers take precedence over field definitions.\n+\n+### ⚡ Custom Transformations with Preparer Methods\n+\n+For any custom logic or transformations, use `prepare_<field_name>` methods:\n+\n+```python\n+class MySchema(ExportSchema):\n+    name = StringField(source=\"name\", label=\"Name (Uppercase)\")\n+    status = StringField(label=\"Status\")\n+\n+    def prepare_name(self, obj):\n+        \"\"\"Transform the name field to uppercase.\"\"\"\n+        return obj.name.upper() if obj.name else \"\"\n+\n+    def prepare_status(self, obj):\n+        \"\"\"Compute status based on model state.\"\"\"\n+        return \"Active\" if obj.is_active else \"Inactive\"\n+```\n+\n+## 📦 Export Formats\n+\n+### 📊 CSV Format\n+\n+- Fields are quoted with `QUOTE_ALL`\n+- Lists are joined with `\", \"` (customizable with `list_joiner` option)\n+- JSON objects are serialized as JSON strings\n+- File extension: `.csv`\n+\n+```python\n+exporter = Exporter(\n+    format_type=\"csv\",\n+    schema_class=MySchema,\n+    options={\"list_joiner\": \"; \"}  # Custom separator\n+)\n+```\n+\n+### 📋 JSON Format\n+\n+- Lists remain as arrays\n+- Objects remain as nested structures\n+- Preserves data types\n+- File extension: `.json`\n+\n+```python\n+exporter = Exporter(format_type=\"json\", schema_class=MySchema)\n+filename, content = exporter.export(\"data\", records)\n+# content is a JSON string: '[{\"field\": \"value\"}, ...]'\n+```\n+\n+### 📗 XLSX Format\n+\n+- Creates Excel-compatible files using openpyxl\n+- Lists are joined with `\", \"` (customizable with `list_joiner` option)\n+- JSON objects are serialized as JSON strings\n+- File extension: `.xlsx`\n+- Returns binary content (bytes)\n+\n+```python\n+exporter = Exporter(format_type=\"xlsx\", schema_class=MySchema)\n+filename, content = exporter.export(\"data\", records)\n+# content is bytes\n+```\n+\n+## 🔧 Advanced Usage\n+\n+### 📦 Using Context for Pre-fetched Data\n+\n+Pass context data to schemas to avoid N+1 queries. Override `get_context_data()` in your schema:\n+\n+```python\n+class MySchema(ExportSchema):\n+    attachment_count = NumberField(label=\"Attachments\")\n+\n+    def prepare_attachment_count(self, obj):\n+        attachments_dict = self.context.get(\"attachments_dict\", {})\n+        return len(attachments_dict.get(obj.id, []))\n+\n+    @classmethod\n+    def get_context_data(cls, queryset):\n+        \"\"\"Pre-fetch all attachments in one query.\"\"\"\n+        attachments_dict = get_attachments_dict(queryset)\n+        return {\"attachments_dict\": attachments_dict}\n+\n+# The Exporter automatically uses get_context_data() when serializing\n+queryset = MyModel.objects.all()\n+exporter = Exporter(format_type=\"csv\", schema_class=MySchema)\n+filename, content = exporter.export(\"data\", queryset)\n+```\n+\n+### 🔌 Registering Custom Formatters\n+\n+Add support for new export formats:\n+\n+```python\n+from plane.utils.exporters import Exporter, BaseFormatter\n+\n+class XMLFormatter(BaseFormatter):\n+    def format(self, filename, records, schema_class, options=None):\n+        # Implementation\n+        return (f\"{filename}.xml\", xml_content)\n+\n+# Register the formatter\n+Exporter.register_formatter(\"xml\", XMLFormatter)\n+\n+# Use it\n+exporter = Exporter(format_type=\"xml\", schema_class=MySchema)\n+```\n+\n+### ✅ Checking Available Formats\n+\n+```python\n+formats = Exporter.get_available_formats()\n+# Returns: ['csv', 'json', 'xlsx']\n+```\n+\n+### 🔍 Filtering Fields\n+\n+Pass a `fields` parameter to export only specific fields:\n+\n+```python\n+# Export only specific fields\n+exporter = Exporter(format_type=\"csv\", schema_class=MySchema)\n+filename, content = exporter.export(\n+    \"filtered_data\",\n+    queryset,\n+    fields=[\"id\", \"name\", \"email\"]\n+)\n+```\n+\n+### 🎯 Extending Schemas\n+\n+Create extended schemas by inheriting from existing ones and overriding `get_context_data()`:\n+\n+```python\n+class ExtendedIssueExportSchema(IssueExportSchema):\n+    custom_field = JSONField(label=\"Custom Data\")\n+\n+    def prepare_custom_field(self, obj):\n+        # Use pre-fetched data from context\n+        return self.context.get(\"custom_data\", {}).get(obj.id, {})\n+\n+    @classmethod\n+    def get_context_data(cls, queryset):\n+        # Get parent context (attachments, etc.)\n+        context = super().get_context_data(queryset)\n+\n+        # Add your custom pre-fetched data\n+        context[\"custom_data\"] = fetch_custom_data(queryset)\n+\n+        return context\n+```\n+\n+### 💾 Manual Serialization\n+\n+If you need to serialize data without exporting, you can use the schema directly:\n+\n+```python\n+# Serialize a queryset to a list of dicts\n+data = MySchema.serialize_queryset(queryset, fields=[\"id\", \"name\"])\n+\n+# Or serialize a single object\n+schema = MySchema()\n+obj_data = schema.serialize(obj)\n+```\n+\n+## 💡 Example: IssueExportSchema\n+\n+The `IssueExportSchema` demonstrates a complete implementation:\n+\n+```python\n+from plane.utils.exporters import Exporter, IssueExportSchema\n+\n+# Simple export - just pass the queryset!\n+issues = Issue.objects.filter(project_id=project_id)\n+exporter = Exporter(format_type=\"csv\", schema_class=IssueExportSchema)\n+filename, content = exporter.export(\"issues\", issues)\n+\n+# Export specific fields only\n+filename, content = exporter.export(\n+    \"issues_filtered\",\n+    issues,\n+    fields=[\"id\", \"name\", \"state_name\", \"assignees\", \"labels\"]\n+)\n+\n+# Export multiple projects to separate files\n+for project_id in project_ids:\n+    project_issues = issues.filter(project_id=project_id)\n+    filename, content = exporter.export(f\"issues-{project_id}\", project_issues)\n+    # Save or upload each file\n+```\n+\n+Key features:\n+\n+- 🔗 Access to related models via dotted paths\n+- 🎯 Custom preparers for complex fields\n+- 📎 Context-based attachment handling via `get_context_data()`\n+- 📋 List and JSON field handling\n+- 📅 Date/datetime formatting\n+\n+## ✨ Best Practices\n+\n+1. **🚄 Avoid N+1 Queries**: Override `get_context_data()` to pre-fetch related data:\n+\n+   ```python\n+   @classmethod\n+   def get_context_data(cls, queryset):\n+       return {\n+           \"attachments\": get_attachments_dict(queryset),\n+           \"comments\": get_comments_dict(queryset),\n+       }\n+   ```\n+\n+2. **🏷️ Use Labels**: Provide descriptive labels for better export headers:\n+\n+   ```python\n+   created_at = DateTimeField(source=\"created_at\", label=\"Created At\")\n+   ```\n+\n+3. **🛡️ Handle None Values**: Set appropriate defaults for fields that might be None:\n+\n+   ```python\n+   count = NumberField(source=\"count\", default=0)\n+   ```\n+\n+4. **🎯 Use Preparers for Complex Logic**: Keep field definitions simple and use preparers for complex transformations:\n+\n+   ```python\n+   def prepare_assignees(self, obj):\n+       return [f\"{u.first_name} {u.last_name}\" for u in obj.assignee_details]\n+   ```\n+\n+5. **⚡ Pass QuerySets Directly**: Let the Exporter handle serialization:\n+\n+   ```python\n+   # Good - Exporter handles serialization\n+   exporter.export(\"data\", queryset)\n+\n+   # Avoid - Manual serialization unless needed\n+   data = MySchema.serialize_queryset(queryset)\n+   exporter.export(\"data\", data)\n+   ```\n+\n+6. **📦 Filter QuerySets, Not Data**: For multiple exports, filter the queryset instead of the serialized data:\n+\n+   ```python\n+   # Good - efficient, only serializes what's needed\n+   for project_id in project_ids:\n+       project_issues = issues.filter(project_id=project_id)\n+       exporter.export(f\"project-{project_id}\", project_issues)\n+\n+   # Avoid - serializes all data upfront\n+   all_data = MySchema.serialize_queryset(issues)\n+   for project_id in project_ids:\n+       project_data = [d for d in all_data if d['project_id'] == project_id]\n+       exporter.export(f\"project-{project_id}\", project_data)\n+   ```\n+\n+## 📚 API Reference\n+\n+### 📊 Exporter\n+\n+**`__init__(format_type, schema_class, options=None)`**\n+\n+- `format_type`: Export format ('csv', 'json', 'xlsx')\n+- `schema_class`: Schema class defining fields\n+- `options`: Optional dict of format-specific options\n+\n+**`export(filename, data, fields=None)`**\n+\n+- `filename`: Filename without extension\n+- `data`: Django QuerySet or list of dicts\n+- `fields`: Optional list of field names to include\n+- Returns: `(filename_with_extension, content)`\n+- `content` is str for CSV/JSON, bytes for XLSX\n+\n+**`get_available_formats()`** (class method)\n+\n+- Returns: List of available format types\n+\n+**`register_formatter(format_type, formatter_class)`** (class method)\n+\n+- Register a custom formatter\n+\n+### 📝 ExportSchema\n+\n+**`__init__(context=None)`**\n+\n+- `context`: Optional dict accessible in preparer methods via `self.context` for pre-fetched data\n+\n+**`serialize(obj, fields=None)`**\n+\n+- Returns: Dict of serialized field values for a single object\n+\n+**`serialize_queryset(queryset, fields=None)`** (class method)\n+\n+- `queryset`: QuerySet of objects to serialize\n+- `fields`: Optional list of field names to include\n+- Returns: List of dicts with serialized data\n+\n+**`get_context_data(queryset)`** (class method)\n+\n+- Override to pre-fetch related data for the queryset\n+- Returns: Dict of context data\n+\n+### 🔧 ExportField\n+\n+Base class for all field types. Subclass to create custom field types.\n+\n+**`get_value(obj, context)`**\n+\n+- Returns: Formatted value for the field\n+\n+**`_format_value(raw)`**\n+\n+- Override in subclasses for type-specific formatting\n+\n+## 🧪 Testing\n+\n+```python\n+# Test exporting a queryset\n+queryset = MyModel.objects.all()\n+exporter = Exporter(format_type=\"json\", schema_class=MySchema)\n+filename, content = exporter.export(\"test\", queryset)\n+assert filename == \"test.json\"\n+assert isinstance(content, str)\n+\n+# Test with field filtering\n+filename, content = exporter.export(\"test\", queryset, fields=[\"id\", \"name\"])\n+data = json.loads(content)\n+assert all(set(item.keys()) == {\"id\", \"name\"} for item in data)\n+\n+# Test manual serialization\n+data = MySchema.serialize_queryset(queryset)\n+assert len(data) == queryset.count()\n+```\n"
        },
        {
          "path": "apps/api/plane/utils/exporters/__init__.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/exporters/__init__.py\n===================================================================\n--- apps/api/plane/utils/exporters/__init__.py\t9dc14d8 (parent)\n+++ apps/api/plane/utils/exporters/__init__.py\t4168127 (commit)\n@@ -0,0 +1,38 @@\n+\"\"\"Export utilities for various data formats.\"\"\"\n+\n+from .exporter import Exporter\n+from .formatters import BaseFormatter, CSVFormatter, JSONFormatter, XLSXFormatter\n+from .schemas import (\n+    BooleanField,\n+    DateField,\n+    DateTimeField,\n+    ExportField,\n+    ExportSchema,\n+    IssueExportSchema,\n+    JSONField,\n+    ListField,\n+    NumberField,\n+    StringField,\n+)\n+\n+__all__ = [\n+    # Core Exporter\n+    \"Exporter\",\n+    # Schemas\n+    \"ExportSchema\",\n+    \"ExportField\",\n+    \"StringField\",\n+    \"NumberField\",\n+    \"DateField\",\n+    \"DateTimeField\",\n+    \"BooleanField\",\n+    \"ListField\",\n+    \"JSONField\",\n+    # Formatters\n+    \"BaseFormatter\",\n+    \"CSVFormatter\",\n+    \"JSONFormatter\",\n+    \"XLSXFormatter\",\n+    # Issue Schema\n+    \"IssueExportSchema\",\n+]\n"
        },
        {
          "path": "apps/api/plane/utils/exporters/exporter.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/exporters/exporter.py\n===================================================================\n--- apps/api/plane/utils/exporters/exporter.py\t9dc14d8 (parent)\n+++ apps/api/plane/utils/exporters/exporter.py\t4168127 (commit)\n@@ -0,0 +1,72 @@\n+from typing import Any, Dict, List, Type, Union\n+\n+from django.db.models import QuerySet\n+\n+from .formatters import CSVFormatter, JSONFormatter, XLSXFormatter\n+\n+\n+class Exporter:\n+    \"\"\"Generic exporter class that handles data exports using different formatters.\"\"\"\n+\n+    # Available formatters\n+    FORMATTERS = {\n+        \"csv\": CSVFormatter,\n+        \"json\": JSONFormatter,\n+        \"xlsx\": XLSXFormatter,\n+    }\n+\n+    def __init__(self, format_type: str, schema_class: Type, options: Dict[str, Any] = None):\n+        \"\"\"Initialize exporter with specified format type and schema.\n+\n+        Args:\n+            format_type: The export format (csv, json, xlsx)\n+            schema_class: The schema class to use for field definitions\n+            options: Optional formatting options\n+        \"\"\"\n+        if format_type not in self.FORMATTERS:\n+            raise ValueError(f\"Unsupported format: {format_type}. Available: {list(self.FORMATTERS.keys())}\")\n+\n+        self.format_type = format_type\n+        self.schema_class = schema_class\n+        self.formatter = self.FORMATTERS[format_type]()\n+        self.options = options or {}\n+\n+    def export(\n+        self,\n+        filename: str,\n+        data: Union[QuerySet, List[dict]],\n+        fields: List[str] = None,\n+    ) -> tuple[str, str | bytes]:\n+        \"\"\"Export data using the configured formatter and return (filename, content).\n+\n+        Args:\n+            filename: The filename for the export (without extension)\n+            data: Either a Django QuerySet or a list of already-serialized dicts\n+            fields: Optional list of field names to include in export\n+\n+        Returns:\n+            Tuple of (filename_with_extension, content)\n+        \"\"\"\n+        # Serialize the queryset if needed\n+        if isinstance(data, QuerySet):\n+            records = self.schema_class.serialize_queryset(data, fields=fields)\n+        else:\n+            # Already serialized data\n+            records = data\n+\n+        # Merge fields into options for the formatter\n+        format_options = {**self.options}\n+        if fields:\n+            format_options[\"fields\"] = fields\n+\n+        return self.formatter.format(filename, records, self.schema_class, format_options)\n+\n+    @classmethod\n+    def get_available_formats(cls) -> List[str]:\n+        \"\"\"Get list of available export formats.\"\"\"\n+        return list(cls.FORMATTERS.keys())\n+\n+    @classmethod\n+    def register_formatter(cls, format_type: str, formatter_class: type) -> None:\n+        \"\"\"Register a new formatter for a format type.\"\"\"\n+        cls.FORMATTERS[format_type] = formatter_class\n"
        },
        {
          "path": "apps/api/plane/utils/exporters/formatters.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/exporters/formatters.py\n===================================================================\n--- apps/api/plane/utils/exporters/formatters.py\t9dc14d8 (parent)\n+++ apps/api/plane/utils/exporters/formatters.py\t4168127 (commit)\n@@ -0,0 +1,199 @@\n+import csv\n+import io\n+import json\n+from typing import Any, Dict, List, Type\n+\n+from openpyxl import Workbook\n+\n+\n+class BaseFormatter:\n+    \"\"\"Base class for export formatters.\"\"\"\n+\n+    def format(\n+        self,\n+        filename: str,\n+        records: List[dict],\n+        schema_class: Type,\n+        options: Dict[str, Any] | None = None,\n+    ) -> tuple[str, str | bytes]:\n+        \"\"\"Format records for export.\n+\n+        Args:\n+            filename: The filename for the export (without extension)\n+            records: List of records to export\n+            schema_class: Schema class to extract field order and labels\n+            options: Optional formatting options\n+\n+        Returns:\n+            Tuple of (filename_with_extension, content)\n+        \"\"\"\n+        raise NotImplementedError\n+\n+    @staticmethod\n+    def _get_field_info(schema_class: Type) -> tuple[List[str], Dict[str, str]]:\n+        \"\"\"Extract field order and labels from schema.\n+\n+        Args:\n+            schema_class: Schema class with field definitions\n+\n+        Returns:\n+            Tuple of (field_order, field_labels)\n+        \"\"\"\n+        if not hasattr(schema_class, \"_declared_fields\"):\n+            raise ValueError(f\"Schema class {schema_class.__name__} must have _declared_fields attribute\")\n+\n+        # Get order and labels from schema\n+        field_order = list(schema_class._declared_fields.keys())\n+        field_labels = {\n+            name: field.label if field.label else name.replace(\"_\", \" \").title()\n+            for name, field in schema_class._declared_fields.items()\n+        }\n+\n+        return field_order, field_labels\n+\n+\n+class CSVFormatter(BaseFormatter):\n+    \"\"\"Formatter for CSV exports.\"\"\"\n+\n+    @staticmethod\n+    def _format_field_value(value: Any, list_joiner: str = \", \") -> str:\n+        \"\"\"Format a field value for CSV output.\"\"\"\n+        if value is None:\n+            return \"\"\n+        if isinstance(value, list):\n+            return list_joiner.join(str(v) for v in value)\n+        if isinstance(value, dict):\n+            # For complex objects, serialize as JSON\n+            return json.dumps(value)\n+        return str(value)\n+\n+    def _generate_table_row(\n+        self, record: dict, field_order: List[str], options: Dict[str, Any] | None = None\n+    ) -> List[str]:\n+        \"\"\"Generate a CSV row from a record.\"\"\"\n+        opts = options or {}\n+        list_joiner = opts.get(\"list_joiner\", \", \")\n+        return [self._format_field_value(record.get(field, \"\"), list_joiner) for field in field_order]\n+\n+    def _create_csv_file(self, data: List[List[str]]) -> str:\n+        \"\"\"Create CSV file content from row data.\"\"\"\n+        buf = io.StringIO()\n+        writer = csv.writer(buf, delimiter=\",\", quoting=csv.QUOTE_ALL)\n+        for row in data:\n+            writer.writerow(row)\n+        buf.seek(0)\n+        return buf.getvalue()\n+\n+    def format(self, filename, records, schema_class, options: Dict[str, Any] | None = None) -> tuple[str, str]:\n+        if not records:\n+            return (f\"{filename}.csv\", \"\")\n+\n+        # Get field order and labels from schema\n+        field_order, field_labels = self._get_field_info(schema_class)\n+\n+        # Filter to requested fields if specified\n+        opts = options or {}\n+        requested_fields = opts.get(\"fields\")\n+        if requested_fields:\n+            field_order = [f for f in field_order if f in requested_fields]\n+\n+        header = [field_labels[field] for field in field_order]\n+\n+        rows = [header]\n+        for record in records:\n+            row = self._generate_table_row(record, field_order, options)\n+            rows.append(row)\n+        content = self._create_csv_file(rows)\n+        return (f\"{filename}.csv\", content)\n+\n+\n+class JSONFormatter(BaseFormatter):\n+    \"\"\"Formatter for JSON exports.\"\"\"\n+\n+    def _generate_json_row(\n+        self, record: dict, field_labels: Dict[str, str], field_order: List[str], options: Dict[str, Any] | None = None\n+    ) -> dict:\n+        \"\"\"Generate a JSON object from a record.\n+\n+        Preserves data types - lists stay as arrays, dicts stay as objects.\n+        \"\"\"\n+        return {field_labels[field]: record.get(field) for field in field_order if field in record}\n+\n+    def format(self, filename, records, schema_class, options: Dict[str, Any] | None = None) -> tuple[str, str]:\n+        if not records:\n+            return (f\"{filename}.json\", \"[]\")\n+\n+        # Get field order and labels from schema\n+        field_order, field_labels = self._get_field_info(schema_class)\n+\n+        # Filter to requested fields if specified\n+        opts = options or {}\n+        requested_fields = opts.get(\"fields\")\n+        if requested_fields:\n+            field_order = [f for f in field_order if f in requested_fields]\n+\n+        rows: List[dict] = []\n+        for record in records:\n+            row = self._generate_json_row(record, field_labels, field_order, options)\n+            rows.append(row)\n+        content = json.dumps(rows)\n+        return (f\"{filename}.json\", content)\n+\n+\n+class XLSXFormatter(BaseFormatter):\n+    \"\"\"Formatter for XLSX (Excel) exports.\"\"\"\n+\n+    @staticmethod\n+    def _format_field_value(value: Any, list_joiner: str = \", \") -> str:\n+        \"\"\"Format a field value for XLSX output.\"\"\"\n+        if value is None:\n+            return \"\"\n+        if isinstance(value, list):\n+            return list_joiner.join(str(v) for v in value)\n+        if isinstance(value, dict):\n+            # For complex objects, serialize as JSON\n+            return json.dumps(value)\n+        return str(value)\n+\n+    def _generate_table_row(\n+        self, record: dict, field_order: List[str], options: Dict[str, Any] | None = None\n+    ) -> List[str]:\n+        \"\"\"Generate an XLSX row from a record.\"\"\"\n+        opts = options or {}\n+        list_joiner = opts.get(\"list_joiner\", \", \")\n+        return [self._format_field_value(record.get(field, \"\"), list_joiner) for field in field_order]\n+\n+    def _create_xlsx_file(self, data: List[List[str]]) -> bytes:\n+        \"\"\"Create XLSX file content from row data.\"\"\"\n+        wb = Workbook()\n+        sh = wb.active\n+        for row in data:\n+            sh.append(row)\n+        out = io.BytesIO()\n+        wb.save(out)\n+        out.seek(0)\n+        return out.getvalue()\n+\n+    def format(self, filename, records, schema_class, options: Dict[str, Any] | None = None) -> tuple[str, bytes]:\n+        if not records:\n+            # Create empty workbook\n+            content = self._create_xlsx_file([])\n+            return (f\"{filename}.xlsx\", content)\n+\n+        # Get field order and labels from schema\n+        field_order, field_labels = self._get_field_info(schema_class)\n+\n+        # Filter to requested fields if specified\n+        opts = options or {}\n+        requested_fields = opts.get(\"fields\")\n+        if requested_fields:\n+            field_order = [f for f in field_order if f in requested_fields]\n+\n+        header = [field_labels[field] for field in field_order]\n+\n+        rows = [header]\n+        for record in records:\n+            row = self._generate_table_row(record, field_order, options)\n+            rows.append(row)\n+        content = self._create_xlsx_file(rows)\n+        return (f\"{filename}.xlsx\", content)\n"
        },
        {
          "path": "apps/api/plane/utils/exporters/schemas/__init__.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/exporters/schemas/__init__.py\n===================================================================\n--- apps/api/plane/utils/exporters/schemas/__init__.py\t9dc14d8 (parent)\n+++ apps/api/plane/utils/exporters/schemas/__init__.py\t4168127 (commit)\n@@ -0,0 +1,30 @@\n+\"\"\"Export schemas for various data types.\"\"\"\n+\n+from .base import (\n+    BooleanField,\n+    DateField,\n+    DateTimeField,\n+    ExportField,\n+    ExportSchema,\n+    JSONField,\n+    ListField,\n+    NumberField,\n+    StringField,\n+)\n+from .issue import IssueExportSchema\n+\n+__all__ = [\n+    # Base field types\n+    \"ExportField\",\n+    \"StringField\",\n+    \"NumberField\",\n+    \"DateField\",\n+    \"DateTimeField\",\n+    \"BooleanField\",\n+    \"ListField\",\n+    \"JSONField\",\n+    # Base schema\n+    \"ExportSchema\",\n+    # Issue schema\n+    \"IssueExportSchema\",\n+]\n"
        },
        {
          "path": "apps/api/plane/utils/exporters/schemas/base.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/exporters/schemas/base.py\n===================================================================\n--- apps/api/plane/utils/exporters/schemas/base.py\t9dc14d8 (parent)\n+++ apps/api/plane/utils/exporters/schemas/base.py\t4168127 (commit)\n@@ -0,0 +1,234 @@\n+from dataclasses import dataclass, field\n+from typing import Any, Dict, List, Optional\n+\n+from django.db.models import QuerySet\n+\n+\n+@dataclass\n+class ExportField:\n+    \"\"\"Base export field class for generic fields.\"\"\"\n+\n+    source: Optional[str] = None\n+    default: Any = \"\"\n+    label: Optional[str] = None  # Display name for export headers\n+\n+    def get_value(self, obj: Any, context: Dict[str, Any]) -> Any:\n+        raw: Any\n+        if self.source:\n+            raw = self._resolve_dotted_path(obj, self.source)\n+        else:\n+            raw = obj\n+\n+        return self._format_value(raw)\n+\n+    def _format_value(self, raw: Any) -> Any:\n+        \"\"\"Format the raw value. Override in subclasses for type-specific formatting.\"\"\"\n+        return raw if raw is not None else self.default\n+\n+    def _resolve_dotted_path(self, obj: Any, path: str) -> Any:\n+        current = obj\n+        for part in path.split(\".\"):\n+            if current is None:\n+                return None\n+            if hasattr(current, part):\n+                current = getattr(current, part)\n+            elif isinstance(current, dict):\n+                current = current.get(part)\n+            else:\n+                return None\n+        return current\n+\n+\n+@dataclass\n+class StringField(ExportField):\n+    \"\"\"Export field for string values.\"\"\"\n+\n+    default: str = \"\"\n+\n+    def _format_value(self, raw: Any) -> str:\n+        if raw is None:\n+            return self.default\n+        return str(raw)\n+\n+\n+@dataclass\n+class DateField(ExportField):\n+    \"\"\"Export field for date values with automatic conversion.\"\"\"\n+\n+    default: str = \"\"\n+\n+    def _format_value(self, raw: Any) -> str:\n+        if raw is None:\n+            return self.default\n+        # Convert date to formatted string\n+        if hasattr(raw, \"strftime\"):\n+            return raw.strftime(\"%a, %d %b %Y\")\n+        return str(raw)\n+\n+\n+@dataclass\n+class DateTimeField(ExportField):\n+    \"\"\"Export field for datetime values with automatic conversion.\"\"\"\n+\n+    default: str = \"\"\n+\n+    def _format_value(self, raw: Any) -> str:\n+        if raw is None:\n+            return self.default\n+        # Convert datetime to formatted string\n+        if hasattr(raw, \"strftime\"):\n+            return raw.strftime(\"%a, %d %b %Y %I:%M:%S %Z%z\")\n+        return str(raw)\n+\n+\n+@dataclass\n+class NumberField(ExportField):\n+    \"\"\"Export field for numeric values.\"\"\"\n+\n+    default: Any = \"\"\n+\n+    def _format_value(self, raw: Any) -> Any:\n+        if raw is None:\n+            return self.default\n+        return raw\n+\n+\n+@dataclass\n+class BooleanField(ExportField):\n+    \"\"\"Export field for boolean values.\"\"\"\n+\n+    default: bool = False\n+\n+    def _format_value(self, raw: Any) -> bool:\n+        if raw is None:\n+            return self.default\n+        return bool(raw)\n+\n+\n+@dataclass\n+class ListField(ExportField):\n+    \"\"\"Export field for list/array values.\n+\n+    Returns the list as-is by default. The formatter will handle conversion to strings\n+    when needed (e.g., CSV/XLSX will join with separator, JSON will keep as array).\n+    \"\"\"\n+\n+    default: Optional[List] = field(default_factory=list)\n+\n+    def _format_value(self, raw: Any) -> List[Any]:\n+        if raw is None:\n+            return self.default if self.default is not None else []\n+        if isinstance(raw, (list, tuple)):\n+            return list(raw)\n+        return [raw]  # Wrap single items in a list\n+\n+\n+@dataclass\n+class JSONField(ExportField):\n+    \"\"\"Export field for complex JSON-serializable values (dicts, lists of dicts, etc).\n+\n+    Preserves the structure as-is for JSON exports. For CSV/XLSX, the formatter\n+    will handle serialization (e.g., JSON stringify).\n+    \"\"\"\n+\n+    default: Any = field(default_factory=dict)\n+\n+    def _format_value(self, raw: Any) -> Any:\n+        if raw is None:\n+            return self.default\n+        # Return as-is - should be JSON-serializable\n+        return raw\n+\n+\n+class ExportSchemaMeta(type):\n+    def __new__(mcls, name, bases, attrs):\n+        declared: Dict[str, ExportField] = {\n+            key: value for key, value in list(attrs.items()) if isinstance(value, ExportField)\n+        }\n+        for key in declared.keys():\n+            attrs.pop(key)\n+        cls = super().__new__(mcls, name, bases, attrs)\n+        base_fields: Dict[str, ExportField] = {}\n+        for base in bases:\n+            if hasattr(base, \"_declared_fields\"):\n+                base_fields.update(base._declared_fields)\n+        base_fields.update(declared)\n+        cls._declared_fields = base_fields\n+        return cls\n+\n+\n+class ExportSchema(metaclass=ExportSchemaMeta):\n+    \"\"\"Base schema for exporting data in various formats.\n+\n+    Subclasses should define fields as class attributes and can override:\n+    - prepare_<field_name> methods for custom field serialization\n+    - get_context_data() class method to pre-fetch related data for the queryset\n+    \"\"\"\n+\n+    def __init__(self, context: Optional[Dict[str, Any]] = None) -> None:\n+        self.context = context or {}\n+\n+    def serialize(self, obj: Any, fields: Optional[List[str]] = None) -> Dict[str, Any]:\n+        \"\"\"Serialize a single object.\n+\n+        Args:\n+            obj: The object to serialize\n+            fields: Optional list of field names to include. If None, all fields are serialized.\n+\n+        Returns:\n+            Dictionary of serialized data\n+        \"\"\"\n+        output: Dict[str, Any] = {}\n+        # Determine which fields to process\n+        fields_to_process = fields if fields else list(self._declared_fields.keys())\n+\n+        for field_name in fields_to_process:\n+            # Skip if field doesn't exist in schema\n+            if field_name not in self._declared_fields:\n+                continue\n+\n+            export_field = self._declared_fields[field_name]\n+\n+            # Prefer explicit preparer methods if present\n+            preparer = getattr(self, f\"prepare_{field_name}\", None)\n+            if callable(preparer):\n+                output[field_name] = preparer(obj)\n+                continue\n+\n+            output[field_name] = export_field.get_value(obj, self.context)\n+        return output\n+\n+    @classmethod\n+    def get_context_data(cls, queryset: QuerySet) -> Dict[str, Any]:\n+        \"\"\"Get context data for serialization. Override in subclasses to pre-fetch related data.\n+\n+        Args:\n+            queryset: QuerySet of objects to be serialized\n+\n+        Returns:\n+            Dictionary of context data to be passed to the schema instance\n+        \"\"\"\n+        return {}\n+\n+    @classmethod\n+    def serialize_queryset(cls, queryset: QuerySet, fields: List[str] = None) -> List[Dict[str, Any]]:\n+        \"\"\"Serialize a queryset of objects to export data.\n+\n+        Args:\n+            queryset: QuerySet of objects to serialize\n+            fields: Optional list of field names to include. Defaults to all fields.\n+\n+        Returns:\n+            List of dictionaries containing serialized data\n+        \"\"\"\n+        # Get context data (can be extended by subclasses)\n+        context = cls.get_context_data(queryset)\n+\n+        # Serialize each object, passing fields to only process requested fields\n+        schema = cls(context=context)\n+        data = []\n+        for obj in queryset:\n+            obj_data = schema.serialize(obj, fields=fields)\n+            data.append(obj_data)\n+\n+        return data\n"
        },
        {
          "path": "apps/api/plane/utils/exporters/schemas/issue.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/exporters/schemas/issue.py\n===================================================================\n--- apps/api/plane/utils/exporters/schemas/issue.py\t9dc14d8 (parent)\n+++ apps/api/plane/utils/exporters/schemas/issue.py\t4168127 (commit)\n@@ -0,0 +1,206 @@\n+from collections import defaultdict\n+from typing import Any, Dict, List, Optional\n+\n+from django.db.models import F, QuerySet\n+\n+from plane.db.models import CycleIssue, FileAsset\n+\n+from .base import (\n+    DateField,\n+    DateTimeField,\n+    ExportSchema,\n+    JSONField,\n+    ListField,\n+    NumberField,\n+    StringField,\n+)\n+\n+\n+def get_issue_attachments_dict(issues_queryset: QuerySet) -> Dict[str, List[str]]:\n+    \"\"\"Get attachments dictionary for the given issues queryset.\n+\n+    Args:\n+        issues_queryset: Queryset of Issue objects\n+\n+    Returns:\n+        Dictionary mapping issue IDs to lists of attachment IDs\n+    \"\"\"\n+    file_assets = FileAsset.objects.filter(\n+        issue_id__in=issues_queryset.values_list(\"id\", flat=True),\n+        entity_type=FileAsset.EntityTypeContext.ISSUE_ATTACHMENT,\n+    ).annotate(work_item_id=F(\"issue_id\"), asset_id=F(\"id\"))\n+\n+    attachment_dict = defaultdict(list)\n+    for asset in file_assets:\n+        attachment_dict[asset.work_item_id].append(asset.asset_id)\n+\n+    return attachment_dict\n+\n+\n+def get_issue_last_cycles_dict(issues_queryset: QuerySet) -> Dict[str, Optional[CycleIssue]]:\n+    \"\"\"Get the last cycle for each issue in the given queryset.\n+\n+    Args:\n+        issues_queryset: Queryset of Issue objects\n+\n+    Returns:\n+        Dictionary mapping issue IDs to their last CycleIssue object\n+    \"\"\"\n+    # Fetch all cycle issues for the given issues, ordered by created_at descending\n+    # select_related is used to fetch cycle data in the same query\n+    cycle_issues = (\n+        CycleIssue.objects.filter(issue_id__in=issues_queryset.values_list(\"id\", flat=True))\n+        .select_related(\"cycle\")\n+        .order_by(\"issue_id\", \"-created_at\")\n+    )\n+\n+    # Keep only the last (most recent) cycle for each issue\n+    last_cycles_dict = {}\n+    for cycle_issue in cycle_issues:\n+        if cycle_issue.issue_id not in last_cycles_dict:\n+            last_cycles_dict[cycle_issue.issue_id] = cycle_issue\n+\n+    return last_cycles_dict\n+\n+\n+class IssueExportSchema(ExportSchema):\n+    \"\"\"Schema for exporting issue data in various formats.\"\"\"\n+\n+    @staticmethod\n+    def _get_created_by(obj) -> str:\n+        \"\"\"Get the created by user for the given object.\"\"\"\n+        try:\n+            if getattr(obj, \"created_by\", None):\n+                return f\"{obj.created_by.first_name} {obj.created_by.last_name}\"\n+        except Exception:\n+            pass\n+        return \"\"\n+\n+    @staticmethod\n+    def _format_date(date_obj) -> str:\n+        \"\"\"Format date object to string.\"\"\"\n+        if date_obj and hasattr(date_obj, \"strftime\"):\n+            return date_obj.strftime(\"%a, %d %b %Y\")\n+        return \"\"\n+\n+    # Field definitions with display labels\n+    id = StringField(label=\"ID\")\n+    project_identifier = StringField(source=\"project.identifier\", label=\"Project Identifier\")\n+    project_name = StringField(source=\"project.name\", label=\"Project\")\n+    project_id = StringField(source=\"project.id\", label=\"Project ID\")\n+    sequence_id = NumberField(source=\"sequence_id\", label=\"Sequence ID\")\n+    name = StringField(source=\"name\", label=\"Name\")\n+    description = StringField(source=\"description_stripped\", label=\"Description\")\n+    priority = StringField(source=\"priority\", label=\"Priority\")\n+    start_date = DateField(source=\"start_date\", label=\"Start Date\")\n+    target_date = DateField(source=\"target_date\", label=\"Target Date\")\n+    state_name = StringField(label=\"State\")\n+    created_at = DateTimeField(source=\"created_at\", label=\"Created At\")\n+    updated_at = DateTimeField(source=\"updated_at\", label=\"Updated At\")\n+    completed_at = DateTimeField(source=\"completed_at\", label=\"Completed At\")\n+    archived_at = DateTimeField(source=\"archived_at\", label=\"Archived At\")\n+    module_name = ListField(label=\"Module Name\")\n+    created_by = StringField(label=\"Created By\")\n+    labels = ListField(label=\"Labels\")\n+    comments = JSONField(label=\"Comments\")\n+    estimate = StringField(label=\"Estimate\")\n+    link = ListField(label=\"Link\")\n+    assignees = ListField(label=\"Assignees\")\n+    subscribers_count = NumberField(label=\"Subscribers Count\")\n+    attachment_count = NumberField(label=\"Attachment Count\")\n+    attachment_links = ListField(label=\"Attachment Links\")\n+    cycle_name = StringField(label=\"Cycle Name\")\n+    cycle_start_date = DateField(label=\"Cycle Start Date\")\n+    cycle_end_date = DateField(label=\"Cycle End Date\")\n+    parent = StringField(label=\"Parent\")\n+    relations = JSONField(label=\"Relations\")\n+\n+    def prepare_id(self, i):\n+        return f\"{i.project.identifier}-{i.sequence_id}\"\n+\n+    def prepare_state_name(self, i):\n+        return i.state.name if i.state else None\n+\n+    def prepare_module_name(self, i):\n+        return [m.module.name for m in i.issue_module.all()]\n+\n+    def prepare_created_by(self, i):\n+        return self._get_created_by(i)\n+\n+    def prepare_labels(self, i):\n+        return [label.name for label in i.labels.all()]\n+\n+    def prepare_comments(self, i):\n+        return [\n+            {\n+                \"comment\": comment.comment_stripped,\n+                \"created_at\": self._format_date(comment.created_at),\n+                \"created_by\": self._get_created_by(comment),\n+            }\n+            for comment in i.issue_comments.all()\n+        ]\n+\n+    def prepare_estimate(self, i):\n+        return i.estimate_point.value if i.estimate_point and i.estimate_point.value else \"\"\n+\n+    def prepare_link(self, i):\n+        return [link.url for link in i.issue_link.all()]\n+\n+    def prepare_assignees(self, i):\n+        return [f\"{u.first_name} {u.last_name}\" for u in i.assignees.all()]\n+\n+    def prepare_subscribers_count(self, i):\n+        return i.issue_subscribers.count()\n+\n+    def prepare_attachment_count(self, i):\n+        return len((self.context.get(\"attachments_dict\") or {}).get(i.id, []))\n+\n+    def prepare_attachment_links(self, i):\n+        return [\n+            f\"/api/assets/v2/workspaces/{i.workspace.slug}/projects/{i.project_id}/issues/{i.id}/attachments/{asset}/\"\n+            for asset in (self.context.get(\"attachments_dict\") or {}).get(i.id, [])\n+        ]\n+\n+    def prepare_cycle_name(self, i):\n+        cycles_dict = self.context.get(\"cycles_dict\") or {}\n+        last_cycle = cycles_dict.get(i.id)\n+        return last_cycle.cycle.name if last_cycle else \"\"\n+\n+    def prepare_cycle_start_date(self, i):\n+        cycles_dict = self.context.get(\"cycles_dict\") or {}\n+        last_cycle = cycles_dict.get(i.id)\n+        return last_cycle.cycle.start_date if last_cycle else None\n+\n+    def prepare_cycle_end_date(self, i):\n+        cycles_dict = self.context.get(\"cycles_dict\") or {}\n+        last_cycle = cycles_dict.get(i.id)\n+        return last_cycle.cycle.end_date if last_cycle else None\n+\n+    def prepare_parent(self, i):\n+        if not i.parent:\n+            return \"\"\n+        return f\"{i.parent.project.identifier}-{i.parent.sequence_id}\"\n+\n+    def prepare_relations(self, i):\n+        # Should show reverse relation as well\n+        from plane.db.models.issue import IssueRelationChoices\n+\n+        relations = {\n+            r.relation_type: f\"{r.related_issue.project.identifier}-{r.related_issue.sequence_id}\"\n+            for r in i.issue_relation.all()\n+        }\n+        reverse_relations = {}\n+        for relation in i.issue_related.all():\n+            reverse_relations[IssueRelationChoices._REVERSE_MAPPING[relation.relation_type]] = (\n+                f\"{relation.issue.project.identifier}-{relation.issue.sequence_id}\"\n+            )\n+        relations.update(reverse_relations)\n+        return relations\n+\n+    @classmethod\n+    def get_context_data(cls, queryset: QuerySet) -> Dict[str, Any]:\n+        \"\"\"Get context data for issue serialization.\"\"\"\n+        return {\n+            \"attachments_dict\": get_issue_attachments_dict(queryset),\n+            \"cycles_dict\": get_issue_last_cycles_dict(queryset),\n+        }\n"
        }
      ]
    },
    {
      "id": "refactor-cycle-transfer",
      "sha": "f94da6859729c06e52f48bae070ff7094cf50d75",
      "parentSha": "68aa2fe0b8d889dfde5ca8793a71d59479029fb7",
      "spec": "Implement a centralized utility to transfer incomplete work items from one cycle to another and update both API and App endpoints to delegate to it.\n\nWhat to implement:\n1) Create shared utility: apps/api/plane/utils/cycle_transfer_issues.py\n- Define a function transfer_cycle_issues(slug, project_id, cycle_id, new_cycle_id, request, user_id) that:\n  - Validates that the destination (new) cycle is not completed (end_date < now should be rejected with the error: \"The cycle where the issues are transferred is already completed\").\n  - Loads the source (old) cycle and annotates counts: total_issues, completed_issues, cancelled_issues, started_issues, unstarted_issues, backlog_issues.\n  - Detects if the project has estimate points enabled (type=\"points\"); if enabled, compute assignee and label estimate distributions and a points-based burndown chart via plane.utils.analytics_plot.burndown_plot.\n  - Always compute issue-based assignee and label distributions and an issue-based burndown chart via burndown_plot.\n  - Save a progress snapshot to the source cycle (progress_snapshot) with counts, distributions, and completion charts (include estimate distributions only if enabled).\n  - Transfer only incomplete issues (issue.state.group in [\"backlog\", \"unstarted\", \"started\"], non-archived, non-draft) from the old cycle to the new cycle using a bulk update on CycleIssue.cycle_id.\n  - Emit issue activity (type=\"cycle.activity.created\") capturing updated_cycle_issues (and no created records) using plane.bgtasks.issue_activities_task.issue_activity with origin from plane.utils.host.base_host(request, is_app=True).\n  - Return {\"success\": true} on success or {\"success\": false, \"error\": \"<message>\"} on failure.\n\n2) API endpoint updates: apps/api/plane/api/views/cycle.py\n- Replace the inline transfer and snapshot logic inside TransferCycleIssueAPIEndpoint with a call to transfer_cycle_issues.\n- Before calling the utility, block transfers when the old cycle is not yet completed. Return a 400 with {\"error\": \"The old cycle is not completed yet\"} in that case.\n- On success, return 200 with {\"message\": \"Success\"}. On failure, propagate the error from the utility with 400.\n- Update imports to remove unused analytics/DB helpers and import transfer_cycle_issues from plane.utils.cycle_transfer_issues.\n- Keep the incidental formatting/line-wrap changes in surrounding endpoints as shown in the diff (e.g., queryset filters, serializer initializations, and error payload formatting).\n\n3) App endpoint updates: apps/api/plane/app/views/cycle/base.py\n- Import transfer_cycle_issues and replace the inline logic in TransferCycleIssueEndpoint with a call to the utility.\n- If the utility returns an error, respond with 400 and the forwarded error message. Otherwise, return 200 with {\"message\": \"Success\"}.\n- Preserve all non-functional formatting adjustments in this file (e.g., prefetch queryset formatting, condition wraps, and serializer setup wrapping).\n\nObservable behavior requirements:\n- Transferring work items now transfers only incomplete issues to the new cycle in bulk and records cycle.activity.created activities for the move.\n- The source cycle’s progress_snapshot is updated atomically around the transfer with counts, distributions, and appropriate burndown chart(s) based on whether estimate points are enabled.\n- Transfers must not be allowed into a completed destination cycle (400 with the error message above).\n- The API version must only allow transfers after the source cycle has completed; otherwise return 400 with {\"error\": \"The old cycle is not completed yet\"}.\n- Both endpoints return a simple {\"message\": \"Success\"} on completion.",
      "prompt": "Refactor and centralize the logic for moving all incomplete work items from one development cycle to another. Add a reusable server-side utility that: validates the destination cycle is active, aggregates the source cycle’s current progress (including distributions and a burndown chart), saves that snapshot on the source cycle, performs a bulk move of incomplete work items, and emits an activity event for each move. Update both the app and API transfer endpoints to delegate to this utility, returning Success on completion and clear 400 errors when the old cycle isn’t eligible or the destination cycle is completed. Keep code style and error payloads consistent with the rest of the project.",
      "supplementalFiles": [
        "apps/api/plane/utils/analytics_plot.py",
        "apps/api/plane/bgtasks/issue_activities_task.py",
        "apps/api/plane/utils/host.py"
      ],
      "fileDiffs": [
        {
          "path": "apps/api/plane/api/views/cycle.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/cycle.py\n===================================================================\n--- apps/api/plane/api/views/cycle.py\t68aa2fe (parent)\n+++ apps/api/plane/api/views/cycle.py\tf94da68 (commit)\n@@ -11,15 +11,9 @@\n     Func,\n     OuterRef,\n     Q,\n     Sum,\n-    FloatField,\n-    Case,\n-    When,\n-    Value,\n )\n-from django.db.models.functions import Cast, Concat\n-from django.db import models\n \n # Third party imports\n from rest_framework import status\n from rest_framework.response import Response\n@@ -46,9 +40,9 @@\n     IssueLink,\n     ProjectMember,\n     UserFavorite,\n )\n-from plane.utils.analytics_plot import burndown_plot\n+from plane.utils.cycle_transfer_issues import transfer_cycle_issues\n from plane.utils.host import base_host\n from .base import BaseAPIView\n from plane.bgtasks.webhook_task import model_activity\n from plane.utils.openapi.decorators import cycle_docs\n@@ -200,9 +194,11 @@\n         cycle_view = request.GET.get(\"cycle_view\", \"all\")\n \n         # Current Cycle\n         if cycle_view == \"current\":\n-            queryset = queryset.filter(start_date__lte=timezone.now(), end_date__gte=timezone.now())\n+            queryset = queryset.filter(\n+                start_date__lte=timezone.now(), end_date__gte=timezone.now()\n+            )\n             data = CycleSerializer(\n                 queryset,\n                 many=True,\n                 fields=self.fields,\n@@ -257,9 +253,11 @@\n             )\n \n         # Incomplete Cycles\n         if cycle_view == \"incomplete\":\n-            queryset = queryset.filter(Q(end_date__gte=timezone.now()) | Q(end_date__isnull=True))\n+            queryset = queryset.filter(\n+                Q(end_date__gte=timezone.now()) | Q(end_date__isnull=True)\n+            )\n             return self.paginate(\n                 request=request,\n                 queryset=(queryset),\n                 on_results=lambda cycles: CycleSerializer(\n@@ -303,13 +301,19 @@\n \n         Create a new development cycle with specified name, description, and date range.\n         Supports external ID tracking for integration purposes.\n         \"\"\"\n-        if (request.data.get(\"start_date\", None) is None and request.data.get(\"end_date\", None) is None) or (\n-            request.data.get(\"start_date\", None) is not None and request.data.get(\"end_date\", None) is not None\n+        if (\n+            request.data.get(\"start_date\", None) is None\n+            and request.data.get(\"end_date\", None) is None\n+        ) or (\n+            request.data.get(\"start_date\", None) is not None\n+            and request.data.get(\"end_date\", None) is not None\n         ):\n \n-            serializer = CycleCreateSerializer(data=request.data, context={\"request\": request})\n+            serializer = CycleCreateSerializer(\n+                data=request.data, context={\"request\": request}\n+            )\n             if serializer.is_valid():\n                 if (\n                     request.data.get(\"external_id\")\n                     and request.data.get(\"external_source\")\n@@ -350,9 +354,11 @@\n                 return Response(serializer.data, status=status.HTTP_201_CREATED)\n             return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n         else:\n             return Response(\n-                {\"error\": \"Both start date and end date are either required or are to be null\"},\n+                {\n+                    \"error\": \"Both start date and end date are either required or are to be null\"\n+                },\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n \n \n@@ -498,9 +504,11 @@\n         Completed cycles can only have their sort order changed.\n         \"\"\"\n         cycle = Cycle.objects.get(workspace__slug=slug, project_id=project_id, pk=pk)\n \n-        current_instance = json.dumps(CycleSerializer(cycle).data, cls=DjangoJSONEncoder)\n+        current_instance = json.dumps(\n+            CycleSerializer(cycle).data, cls=DjangoJSONEncoder\n+        )\n \n         if cycle.archived_at:\n             return Response(\n                 {\"error\": \"Archived cycle cannot be edited\"},\n@@ -511,24 +519,32 @@\n \n         if cycle.end_date is not None and cycle.end_date < timezone.now():\n             if \"sort_order\" in request_data:\n                 # Can only change sort order\n-                request_data = {\"sort_order\": request_data.get(\"sort_order\", cycle.sort_order)}\n+                request_data = {\n+                    \"sort_order\": request_data.get(\"sort_order\", cycle.sort_order)\n+                }\n             else:\n                 return Response(\n-                    {\"error\": \"The Cycle has already been completed so it cannot be edited\"},\n+                    {\n+                        \"error\": \"The Cycle has already been completed so it cannot be edited\"\n+                    },\n                     status=status.HTTP_400_BAD_REQUEST,\n                 )\n \n-        serializer = CycleUpdateSerializer(cycle, data=request.data, partial=True, context={\"request\": request})\n+        serializer = CycleUpdateSerializer(\n+            cycle, data=request.data, partial=True, context={\"request\": request}\n+        )\n         if serializer.is_valid():\n             if (\n                 request.data.get(\"external_id\")\n                 and (cycle.external_id != request.data.get(\"external_id\"))\n                 and Cycle.objects.filter(\n                     project_id=project_id,\n                     workspace__slug=slug,\n-                    external_source=request.data.get(\"external_source\", cycle.external_source),\n+                    external_source=request.data.get(\n+                        \"external_source\", cycle.external_source\n+                    ),\n                     external_id=request.data.get(\"external_id\"),\n                 ).exists()\n             ):\n                 return Response(\n@@ -583,9 +599,13 @@\n                 {\"error\": \"Only admin or creator can delete the cycle\"},\n                 status=status.HTTP_403_FORBIDDEN,\n             )\n \n-        cycle_issues = list(CycleIssue.objects.filter(cycle_id=self.kwargs.get(\"pk\")).values_list(\"issue\", flat=True))\n+        cycle_issues = list(\n+            CycleIssue.objects.filter(cycle_id=self.kwargs.get(\"pk\")).values_list(\n+                \"issue\", flat=True\n+            )\n+        )\n \n         issue_activity.delay(\n             type=\"cycle.activity.deleted\",\n             requested_data=json.dumps(\n@@ -603,9 +623,11 @@\n         )\n         # Delete the cycle\n         cycle.delete()\n         # Delete the user favorite cycle\n-        UserFavorite.objects.filter(entity_type=\"cycle\", entity_identifier=pk, project_id=project_id).delete()\n+        UserFavorite.objects.filter(\n+            entity_type=\"cycle\", entity_identifier=pk, project_id=project_id\n+        ).delete()\n         return Response(status=status.HTTP_204_NO_CONTENT)\n \n \n class CycleArchiveUnarchiveAPIEndpoint(BaseAPIView):\n@@ -741,9 +763,11 @@\n         \"\"\"\n         return self.paginate(\n             request=request,\n             queryset=(self.get_queryset()),\n-            on_results=lambda cycles: CycleSerializer(cycles, many=True, fields=self.fields, expand=self.expand).data,\n+            on_results=lambda cycles: CycleSerializer(\n+                cycles, many=True, fields=self.fields, expand=self.expand\n+            ).data,\n         )\n \n     @cycle_docs(\n         operation_id=\"archive_cycle\",\n@@ -760,9 +784,11 @@\n \n         Move a completed cycle to archived status for historical tracking.\n         Only cycles that have ended can be archived.\n         \"\"\"\n-        cycle = Cycle.objects.get(pk=cycle_id, project_id=project_id, workspace__slug=slug)\n+        cycle = Cycle.objects.get(\n+            pk=cycle_id, project_id=project_id, workspace__slug=slug\n+        )\n         if cycle.end_date >= timezone.now():\n             return Response(\n                 {\"error\": \"Only completed cycles can be archived\"},\n                 status=status.HTTP_400_BAD_REQUEST,\n@@ -791,9 +817,11 @@\n \n         Restore an archived cycle to active status, making it available for regular use.\n         The cycle will reappear in active cycle lists.\n         \"\"\"\n-        cycle = Cycle.objects.get(pk=cycle_id, project_id=project_id, workspace__slug=slug)\n+        cycle = Cycle.objects.get(\n+            pk=cycle_id, project_id=project_id, workspace__slug=slug\n+        )\n         cycle.archived_at = None\n         cycle.save()\n         return Response(status=status.HTTP_204_NO_CONTENT)\n \n@@ -854,9 +882,11 @@\n         \"\"\"\n         # List\n         order_by = request.GET.get(\"order_by\", \"created_at\")\n         issues = (\n-            Issue.issue_objects.filter(issue_cycle__cycle_id=cycle_id, issue_cycle__deleted_at__isnull=True)\n+            Issue.issue_objects.filter(\n+                issue_cycle__cycle_id=cycle_id, issue_cycle__deleted_at__isnull=True\n+            )\n             .annotate(\n                 sub_issues_count=Issue.issue_objects.filter(parent=OuterRef(\"id\"))\n                 .order_by()\n                 .annotate(count=Func(F(\"id\"), function=\"Count\"))\n@@ -891,9 +921,11 @@\n \n         return self.paginate(\n             request=request,\n             queryset=(issues),\n-            on_results=lambda issues: IssueSerializer(issues, many=True, fields=self.fields, expand=self.expand).data,\n+            on_results=lambda issues: IssueSerializer(\n+                issues, many=True, fields=self.fields, expand=self.expand\n+            ).data,\n         )\n \n     @cycle_docs(\n         operation_id=\"add_cycle_work_items\",\n@@ -921,12 +953,15 @@\n         issues = request.data.get(\"issues\", [])\n \n         if not issues:\n             return Response(\n-                {\"error\": \"Work items are required\", \"code\": \"MISSING_WORK_ITEMS\"}, status=status.HTTP_400_BAD_REQUEST\n+                {\"error\": \"Work items are required\", \"code\": \"MISSING_WORK_ITEMS\"},\n+                status=status.HTTP_400_BAD_REQUEST,\n             )\n \n-        cycle = Cycle.objects.get(workspace__slug=slug, project_id=project_id, pk=cycle_id)\n+        cycle = Cycle.objects.get(\n+            workspace__slug=slug, project_id=project_id, pk=cycle_id\n+        )\n \n         if cycle.end_date is not None and cycle.end_date < timezone.now():\n             return Response(\n                 {\n@@ -936,11 +971,15 @@\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n \n         # Get all CycleWorkItems already created\n-        cycle_issues = list(CycleIssue.objects.filter(~Q(cycle_id=cycle_id), issue_id__in=issues))\n+        cycle_issues = list(\n+            CycleIssue.objects.filter(~Q(cycle_id=cycle_id), issue_id__in=issues)\n+        )\n         existing_issues = [\n-            str(cycle_issue.issue_id) for cycle_issue in cycle_issues if str(cycle_issue.issue_id) in issues\n+            str(cycle_issue.issue_id)\n+            for cycle_issue in cycle_issues\n+            if str(cycle_issue.issue_id) in issues\n         ]\n         new_issues = list(set(issues) - set(existing_issues))\n \n         # New issues to create\n@@ -989,9 +1028,11 @@\n             project_id=str(self.kwargs.get(\"project_id\", None)),\n             current_instance=json.dumps(\n                 {\n                     \"updated_cycle_issues\": update_cycle_issue_activity,\n-                    \"created_cycle_issues\": serializers.serialize(\"json\", created_records),\n+                    \"created_cycle_issues\": serializers.serialize(\n+                        \"json\", created_records\n+                    ),\n                 }\n             ),\n             epoch=int(timezone.now().timestamp()),\n             notification=True,\n@@ -1065,9 +1106,11 @@\n             project_id=project_id,\n             cycle_id=cycle_id,\n             issue_id=issue_id,\n         )\n-        serializer = CycleIssueSerializer(cycle_issue, fields=self.fields, expand=self.expand)\n+        serializer = CycleIssueSerializer(\n+            cycle_issue, fields=self.fields, expand=self.expand\n+        )\n         return Response(serializer.data, status=status.HTTP_200_OK)\n \n     @cycle_docs(\n         operation_id=\"delete_cycle_work_item\",\n@@ -1170,407 +1213,35 @@\n             return Response(\n                 {\"error\": \"New Cycle Id is required\"},\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n-\n-        new_cycle = Cycle.objects.filter(workspace__slug=slug, project_id=project_id, pk=new_cycle_id).first()\n-\n-        old_cycle = (\n-            Cycle.objects.filter(workspace__slug=slug, project_id=project_id, pk=cycle_id)\n-            .annotate(\n-                total_issues=Count(\n-                    \"issue_cycle\",\n-                    filter=Q(\n-                        issue_cycle__issue__archived_at__isnull=True,\n-                        issue_cycle__issue__is_draft=False,\n-                        issue_cycle__deleted_at__isnull=True,\n-                        issue_cycle__issue__deleted_at__isnull=True,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                completed_issues=Count(\n-                    \"issue_cycle__issue__state__group\",\n-                    filter=Q(\n-                        issue_cycle__issue__state__group=\"completed\",\n-                        issue_cycle__issue__archived_at__isnull=True,\n-                        issue_cycle__issue__is_draft=False,\n-                        issue_cycle__deleted_at__isnull=True,\n-                        issue_cycle__issue__deleted_at__isnull=True,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                cancelled_issues=Count(\n-                    \"issue_cycle__issue__state__group\",\n-                    filter=Q(\n-                        issue_cycle__issue__state__group=\"cancelled\",\n-                        issue_cycle__issue__archived_at__isnull=True,\n-                        issue_cycle__issue__is_draft=False,\n-                        issue_cycle__deleted_at__isnull=True,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                started_issues=Count(\n-                    \"issue_cycle__issue__state__group\",\n-                    filter=Q(\n-                        issue_cycle__issue__state__group=\"started\",\n-                        issue_cycle__issue__archived_at__isnull=True,\n-                        issue_cycle__issue__is_draft=False,\n-                        issue_cycle__deleted_at__isnull=True,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                unstarted_issues=Count(\n-                    \"issue_cycle__issue__state__group\",\n-                    filter=Q(\n-                        issue_cycle__issue__state__group=\"unstarted\",\n-                        issue_cycle__issue__archived_at__isnull=True,\n-                        issue_cycle__issue__is_draft=False,\n-                        issue_cycle__deleted_at__isnull=True,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                backlog_issues=Count(\n-                    \"issue_cycle__issue__state__group\",\n-                    filter=Q(\n-                        issue_cycle__issue__state__group=\"backlog\",\n-                        issue_cycle__issue__archived_at__isnull=True,\n-                        issue_cycle__issue__is_draft=False,\n-                        issue_cycle__deleted_at__isnull=True,\n-                    ),\n-                )\n-            )\n-        )\n-        old_cycle = old_cycle.first()\n-\n-        estimate_type = Project.objects.filter(\n+        \n+        old_cycle = Cycle.objects.get(\n             workspace__slug=slug,\n-            pk=project_id,\n-            estimate__isnull=False,\n-            estimate__type=\"points\",\n-        ).exists()\n-\n-        if estimate_type:\n-            assignee_estimate_data = (\n-                Issue.issue_objects.filter(\n-                    issue_cycle__cycle_id=cycle_id,\n-                    issue_cycle__deleted_at__isnull=True,\n-                    workspace__slug=slug,\n-                    project_id=project_id,\n-                )\n-                .annotate(display_name=F(\"assignees__display_name\"))\n-                .annotate(assignee_id=F(\"assignees__id\"))\n-                .annotate(avatar=F(\"assignees__avatar\"))\n-                .annotate(\n-                    avatar_url=Case(\n-                        # If `avatar_asset` exists, use it to generate the asset URL\n-                        When(\n-                            assignees__avatar_asset__isnull=False,\n-                            then=Concat(\n-                                Value(\"/api/assets/v2/static/\"),\n-                                \"assignees__avatar_asset\",  # Assuming avatar_asset has an id or relevant field\n-                                Value(\"/\"),\n-                            ),\n-                        ),\n-                        # If `avatar_asset` is None, fall back to using `avatar` field directly\n-                        When(\n-                            assignees__avatar_asset__isnull=True,\n-                            then=\"assignees__avatar\",\n-                        ),\n-                        default=Value(None),\n-                        output_field=models.CharField(),\n-                    )\n-                )\n-                .values(\"display_name\", \"assignee_id\", \"avatar\", \"avatar_url\")\n-                .annotate(total_estimates=Sum(Cast(\"estimate_point__value\", FloatField())))\n-                .annotate(\n-                    completed_estimates=Sum(\n-                        Cast(\"estimate_point__value\", FloatField()),\n-                        filter=Q(\n-                            completed_at__isnull=False,\n-                            archived_at__isnull=True,\n-                            is_draft=False,\n-                        ),\n-                    )\n-                )\n-                .annotate(\n-                    pending_estimates=Sum(\n-                        Cast(\"estimate_point__value\", FloatField()),\n-                        filter=Q(\n-                            completed_at__isnull=True,\n-                            archived_at__isnull=True,\n-                            is_draft=False,\n-                        ),\n-                    )\n-                )\n-                .order_by(\"display_name\")\n-            )\n-            # assignee distribution serialization\n-            assignee_estimate_distribution = [\n-                {\n-                    \"display_name\": item[\"display_name\"],\n-                    \"assignee_id\": (str(item[\"assignee_id\"]) if item[\"assignee_id\"] else None),\n-                    \"avatar\": item.get(\"avatar\", None),\n-                    \"avatar_url\": item.get(\"avatar_url\", None),\n-                    \"total_estimates\": item[\"total_estimates\"],\n-                    \"completed_estimates\": item[\"completed_estimates\"],\n-                    \"pending_estimates\": item[\"pending_estimates\"],\n-                }\n-                for item in assignee_estimate_data\n-            ]\n-\n-            label_distribution_data = (\n-                Issue.issue_objects.filter(\n-                    issue_cycle__cycle_id=cycle_id,\n-                    issue_cycle__deleted_at__isnull=True,\n-                    workspace__slug=slug,\n-                    project_id=project_id,\n-                )\n-                .annotate(label_name=F(\"labels__name\"))\n-                .annotate(color=F(\"labels__color\"))\n-                .annotate(label_id=F(\"labels__id\"))\n-                .values(\"label_name\", \"color\", \"label_id\")\n-                .annotate(total_estimates=Sum(Cast(\"estimate_point__value\", FloatField())))\n-                .annotate(\n-                    completed_estimates=Sum(\n-                        Cast(\"estimate_point__value\", FloatField()),\n-                        filter=Q(\n-                            completed_at__isnull=False,\n-                            archived_at__isnull=True,\n-                            is_draft=False,\n-                        ),\n-                    )\n-                )\n-                .annotate(\n-                    pending_estimates=Sum(\n-                        Cast(\"estimate_point__value\", FloatField()),\n-                        filter=Q(\n-                            completed_at__isnull=True,\n-                            archived_at__isnull=True,\n-                            is_draft=False,\n-                        ),\n-                    )\n-                )\n-                .order_by(\"label_name\")\n-            )\n-\n-            estimate_completion_chart = burndown_plot(\n-                queryset=old_cycle,\n-                slug=slug,\n-                project_id=project_id,\n-                plot_type=\"points\",\n-                cycle_id=cycle_id,\n-            )\n-            # Label distribution serialization\n-            label_estimate_distribution = [\n-                {\n-                    \"label_name\": item[\"label_name\"],\n-                    \"color\": item[\"color\"],\n-                    \"label_id\": (str(item[\"label_id\"]) if item[\"label_id\"] else None),\n-                    \"total_estimates\": item[\"total_estimates\"],\n-                    \"completed_estimates\": item[\"completed_estimates\"],\n-                    \"pending_estimates\": item[\"pending_estimates\"],\n-                }\n-                for item in label_distribution_data\n-            ]\n-\n-        # Get the assignee distribution\n-        assignee_distribution = (\n-            Issue.issue_objects.filter(\n-                issue_cycle__cycle_id=cycle_id,\n-                issue_cycle__deleted_at__isnull=True,\n-                workspace__slug=slug,\n-                project_id=project_id,\n-            )\n-            .annotate(display_name=F(\"assignees__display_name\"))\n-            .annotate(assignee_id=F(\"assignees__id\"))\n-            .annotate(avatar=F(\"assignees__avatar\"))\n-            .annotate(\n-                avatar_url=Case(\n-                    # If `avatar_asset` exists, use it to generate the asset URL\n-                    When(\n-                        assignees__avatar_asset__isnull=False,\n-                        then=Concat(\n-                            Value(\"/api/assets/v2/static/\"),\n-                            \"assignees__avatar_asset\",  # Assuming avatar_asset has an id or relevant field\n-                            Value(\"/\"),\n-                        ),\n-                    ),\n-                    # If `avatar_asset` is None, fall back to using `avatar` field directly\n-                    When(assignees__avatar_asset__isnull=True, then=\"assignees__avatar\"),\n-                    default=Value(None),\n-                    output_field=models.CharField(),\n-                )\n-            )\n-            .values(\"display_name\", \"assignee_id\", \"avatar_url\")\n-            .annotate(total_issues=Count(\"id\", filter=Q(archived_at__isnull=True, is_draft=False)))\n-            .annotate(\n-                completed_issues=Count(\n-                    \"id\",\n-                    filter=Q(\n-                        completed_at__isnull=False,\n-                        archived_at__isnull=True,\n-                        is_draft=False,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                pending_issues=Count(\n-                    \"id\",\n-                    filter=Q(\n-                        completed_at__isnull=True,\n-                        archived_at__isnull=True,\n-                        is_draft=False,\n-                    ),\n-                )\n-            )\n-            .order_by(\"display_name\")\n+            project_id=project_id,\n+            pk=cycle_id,\n         )\n-        # assignee distribution serialized\n-        assignee_distribution_data = [\n-            {\n-                \"display_name\": item[\"display_name\"],\n-                \"assignee_id\": (str(item[\"assignee_id\"]) if item[\"assignee_id\"] else None),\n-                \"avatar\": item.get(\"avatar\", None),\n-                \"avatar_url\": item.get(\"avatar_url\", None),\n-                \"total_issues\": item[\"total_issues\"],\n-                \"completed_issues\": item[\"completed_issues\"],\n-                \"pending_issues\": item[\"pending_issues\"],\n-            }\n-            for item in assignee_distribution\n-        ]\n-\n-        # Get the label distribution\n-        label_distribution = (\n-            Issue.issue_objects.filter(\n-                issue_cycle__cycle_id=cycle_id,\n-                issue_cycle__deleted_at__isnull=True,\n-                workspace__slug=slug,\n-                project_id=project_id,\n+        # transfer work items only when cycle is completed (passed the end data)\n+        if old_cycle.end_date is not None and old_cycle.end_date < timezone.now():\n+            return Response(\n+                {\"error\": \"The old cycle is not completed yet\"},\n+                status=status.HTTP_400_BAD_REQUEST,\n             )\n-            .annotate(label_name=F(\"labels__name\"))\n-            .annotate(color=F(\"labels__color\"))\n-            .annotate(label_id=F(\"labels__id\"))\n-            .values(\"label_name\", \"color\", \"label_id\")\n-            .annotate(total_issues=Count(\"id\", filter=Q(archived_at__isnull=True, is_draft=False)))\n-            .annotate(\n-                completed_issues=Count(\n-                    \"id\",\n-                    filter=Q(\n-                        completed_at__isnull=False,\n-                        archived_at__isnull=True,\n-                        is_draft=False,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                pending_issues=Count(\n-                    \"id\",\n-                    filter=Q(\n-                        completed_at__isnull=True,\n-                        archived_at__isnull=True,\n-                        is_draft=False,\n-                    ),\n-                )\n-            )\n-            .order_by(\"label_name\")\n-        )\n \n-        # Label distribution serilization\n-        label_distribution_data = [\n-            {\n-                \"label_name\": item[\"label_name\"],\n-                \"color\": item[\"color\"],\n-                \"label_id\": (str(item[\"label_id\"]) if item[\"label_id\"] else None),\n-                \"total_issues\": item[\"total_issues\"],\n-                \"completed_issues\": item[\"completed_issues\"],\n-                \"pending_issues\": item[\"pending_issues\"],\n-            }\n-            for item in label_distribution\n-        ]\n-\n-        # Pass the new_cycle queryset to burndown_plot\n-        completion_chart = burndown_plot(\n-            queryset=old_cycle,\n+        # Call the utility function to handle the transfer\n+        result = transfer_cycle_issues(\n             slug=slug,\n             project_id=project_id,\n-            plot_type=\"issues\",\n             cycle_id=cycle_id,\n+            new_cycle_id=new_cycle_id,\n+            request=request,\n+            user_id=self.request.user.id,\n         )\n \n-        current_cycle = Cycle.objects.filter(workspace__slug=slug, project_id=project_id, pk=cycle_id).first()\n-\n-        current_cycle.progress_snapshot = {\n-            \"total_issues\": old_cycle.total_issues,\n-            \"completed_issues\": old_cycle.completed_issues,\n-            \"cancelled_issues\": old_cycle.cancelled_issues,\n-            \"started_issues\": old_cycle.started_issues,\n-            \"unstarted_issues\": old_cycle.unstarted_issues,\n-            \"backlog_issues\": old_cycle.backlog_issues,\n-            \"distribution\": {\n-                \"labels\": label_distribution_data,\n-                \"assignees\": assignee_distribution_data,\n-                \"completion_chart\": completion_chart,\n-            },\n-            \"estimate_distribution\": (\n-                {}\n-                if not estimate_type\n-                else {\n-                    \"labels\": label_estimate_distribution,\n-                    \"assignees\": assignee_estimate_distribution,\n-                    \"completion_chart\": estimate_completion_chart,\n-                }\n-            ),\n-        }\n-        current_cycle.save(update_fields=[\"progress_snapshot\"])\n-\n-        if new_cycle.end_date is not None and new_cycle.end_date < timezone.now():\n+        # Handle the result\n+        if result.get(\"success\"):\n+            return Response({\"message\": \"Success\"}, status=status.HTTP_200_OK)\n+        else:\n             return Response(\n-                {\"error\": \"The cycle where the issues are transferred is already completed\"},\n+                {\"error\": result.get(\"error\")},\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n-\n-        cycle_issues = CycleIssue.objects.filter(\n-            cycle_id=cycle_id,\n-            project_id=project_id,\n-            workspace__slug=slug,\n-            issue__state__group__in=[\"backlog\", \"unstarted\", \"started\"],\n-        )\n-\n-        updated_cycles = []\n-        update_cycle_issue_activity = []\n-        for cycle_issue in cycle_issues:\n-            cycle_issue.cycle_id = new_cycle_id\n-            updated_cycles.append(cycle_issue)\n-            update_cycle_issue_activity.append(\n-                {\n-                    \"old_cycle_id\": str(cycle_id),\n-                    \"new_cycle_id\": str(new_cycle_id),\n-                    \"issue_id\": str(cycle_issue.issue_id),\n-                }\n-            )\n-\n-        cycle_issues = CycleIssue.objects.bulk_update(updated_cycles, [\"cycle_id\"], batch_size=100)\n-\n-        # Capture Issue Activity\n-        issue_activity.delay(\n-            type=\"cycle.activity.created\",\n-            requested_data=json.dumps({\"cycles_list\": []}),\n-            actor_id=str(self.request.user.id),\n-            issue_id=None,\n-            project_id=str(self.kwargs.get(\"project_id\", None)),\n-            current_instance=json.dumps(\n-                {\n-                    \"updated_cycle_issues\": update_cycle_issue_activity,\n-                    \"created_cycle_issues\": \"[]\",\n-                }\n-            ),\n-            epoch=int(timezone.now().timestamp()),\n-            notification=True,\n-            origin=base_host(request=request, is_app=True),\n-        )\n-\n-        return Response({\"message\": \"Success\"}, status=status.HTTP_200_OK)\n"
        },
        {
          "path": "apps/api/plane/app/views/cycle/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/cycle/base.py\n===================================================================\n--- apps/api/plane/app/views/cycle/base.py\t68aa2fe (parent)\n+++ apps/api/plane/app/views/cycle/base.py\tf94da68 (commit)\n@@ -50,8 +50,9 @@\n )\n from plane.utils.analytics_plot import burndown_plot\n from plane.bgtasks.recent_visited_task import recent_visited_task\n from plane.utils.host import base_host\n+from plane.utils.cycle_transfer_issues import transfer_cycle_issues\n from .. import BaseAPIView, BaseViewSet\n from plane.bgtasks.webhook_task import model_activity\n from plane.utils.timezone_converter import convert_to_utc, user_timezone_converter\n \n@@ -95,9 +96,11 @@\n             .select_related(\"project\", \"workspace\", \"owned_by\")\n             .prefetch_related(\n                 Prefetch(\n                     \"issue_cycle__issue__assignees\",\n-                    queryset=User.objects.only(\"avatar_asset\", \"first_name\", \"id\").distinct(),\n+                    queryset=User.objects.only(\n+                        \"avatar_asset\", \"first_name\", \"id\"\n+                    ).distinct(),\n                 )\n             )\n             .prefetch_related(\n                 Prefetch(\n@@ -146,9 +149,10 @@\n             )\n             .annotate(\n                 status=Case(\n                     When(\n-                        Q(start_date__lte=current_time_in_utc) & Q(end_date__gte=current_time_in_utc),\n+                        Q(start_date__lte=current_time_in_utc)\n+                        & Q(end_date__gte=current_time_in_utc),\n                         then=Value(\"CURRENT\"),\n                     ),\n                     When(start_date__gt=current_time_in_utc, then=Value(\"UPCOMING\")),\n                     When(end_date__lt=current_time_in_utc, then=Value(\"COMPLETED\")),\n@@ -165,9 +169,13 @@\n                     ArrayAgg(\n                         \"issue_cycle__issue__assignees__id\",\n                         distinct=True,\n                         filter=~Q(issue_cycle__issue__assignees__id__isnull=True)\n-                        & (Q(issue_cycle__issue__issue_assignee__deleted_at__isnull=True)),\n+                        & (\n+                            Q(\n+                                issue_cycle__issue__issue_assignee__deleted_at__isnull=True\n+                            )\n+                        ),\n                     ),\n                     Value([], output_field=ArrayField(UUIDField())),\n                 )\n             )\n@@ -196,9 +204,11 @@\n         current_time_in_utc = current_time_in_project_tz.astimezone(pytz.utc)\n \n         # Current Cycle\n         if cycle_view == \"current\":\n-            queryset = queryset.filter(start_date__lte=current_time_in_utc, end_date__gte=current_time_in_utc)\n+            queryset = queryset.filter(\n+                start_date__lte=current_time_in_utc, end_date__gte=current_time_in_utc\n+            )\n \n             data = queryset.values(\n                 # necessary fields\n                 \"id\",\n@@ -263,12 +273,18 @@\n         return Response(data, status=status.HTTP_200_OK)\n \n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER])\n     def create(self, request, slug, project_id):\n-        if (request.data.get(\"start_date\", None) is None and request.data.get(\"end_date\", None) is None) or (\n-            request.data.get(\"start_date\", None) is not None and request.data.get(\"end_date\", None) is not None\n+        if (\n+            request.data.get(\"start_date\", None) is None\n+            and request.data.get(\"end_date\", None) is None\n+        ) or (\n+            request.data.get(\"start_date\", None) is not None\n+            and request.data.get(\"end_date\", None) is not None\n         ):\n-            serializer = CycleWriteSerializer(data=request.data, context={\"project_id\": project_id})\n+            serializer = CycleWriteSerializer(\n+                data=request.data, context={\"project_id\": project_id}\n+            )\n             if serializer.is_valid():\n                 serializer.save(project_id=project_id, owned_by=request.user)\n                 cycle = (\n                     self.get_queryset()\n@@ -306,9 +322,11 @@\n                 project = Project.objects.get(id=self.kwargs.get(\"project_id\"))\n                 project_timezone = project.timezone\n \n                 datetime_fields = [\"start_date\", \"end_date\"]\n-                cycle = user_timezone_converter(cycle, datetime_fields, project_timezone)\n+                cycle = user_timezone_converter(\n+                    cycle, datetime_fields, project_timezone\n+                )\n \n                 # Send the model activity\n                 model_activity.delay(\n                     model_name=\"cycle\",\n@@ -322,37 +340,49 @@\n                 return Response(cycle, status=status.HTTP_201_CREATED)\n             return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n         else:\n             return Response(\n-                {\"error\": \"Both start date and end date are either required or are to be null\"},\n+                {\n+                    \"error\": \"Both start date and end date are either required or are to be null\"\n+                },\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n \n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER])\n     def partial_update(self, request, slug, project_id, pk):\n-        queryset = self.get_queryset().filter(workspace__slug=slug, project_id=project_id, pk=pk)\n+        queryset = self.get_queryset().filter(\n+            workspace__slug=slug, project_id=project_id, pk=pk\n+        )\n         cycle = queryset.first()\n         if cycle.archived_at:\n             return Response(\n                 {\"error\": \"Archived cycle cannot be updated\"},\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n \n-        current_instance = json.dumps(CycleSerializer(cycle).data, cls=DjangoJSONEncoder)\n+        current_instance = json.dumps(\n+            CycleSerializer(cycle).data, cls=DjangoJSONEncoder\n+        )\n \n         request_data = request.data\n \n         if cycle.end_date is not None and cycle.end_date < timezone.now():\n             if \"sort_order\" in request_data:\n                 # Can only change sort order for a completed cycle``\n-                request_data = {\"sort_order\": request_data.get(\"sort_order\", cycle.sort_order)}\n+                request_data = {\n+                    \"sort_order\": request_data.get(\"sort_order\", cycle.sort_order)\n+                }\n             else:\n                 return Response(\n-                    {\"error\": \"The Cycle has already been completed so it cannot be edited\"},\n+                    {\n+                        \"error\": \"The Cycle has already been completed so it cannot be edited\"\n+                    },\n                     status=status.HTTP_400_BAD_REQUEST,\n                 )\n \n-        serializer = CycleWriteSerializer(cycle, data=request.data, partial=True, context={\"project_id\": project_id})\n+        serializer = CycleWriteSerializer(\n+            cycle, data=request.data, partial=True, context={\"project_id\": project_id}\n+        )\n         if serializer.is_valid():\n             serializer.save()\n             cycle = queryset.values(\n                 # necessary fields\n@@ -450,9 +480,11 @@\n             .first()\n         )\n \n         if data is None:\n-            return Response({\"error\": \"Cycle not found\"}, status=status.HTTP_404_NOT_FOUND)\n+            return Response(\n+                {\"error\": \"Cycle not found\"}, status=status.HTTP_404_NOT_FOUND\n+            )\n \n         queryset = queryset.first()\n         # Fetch the project timezone\n         project = Project.objects.get(id=self.kwargs.get(\"project_id\"))\n@@ -472,9 +504,13 @@\n     @allow_permission([ROLE.ADMIN], creator=True, model=Cycle)\n     def destroy(self, request, slug, project_id, pk):\n         cycle = Cycle.objects.get(workspace__slug=slug, project_id=project_id, pk=pk)\n \n-        cycle_issues = list(CycleIssue.objects.filter(cycle_id=self.kwargs.get(\"pk\")).values_list(\"issue\", flat=True))\n+        cycle_issues = list(\n+            CycleIssue.objects.filter(cycle_id=self.kwargs.get(\"pk\")).values_list(\n+                \"issue\", flat=True\n+            )\n+        )\n \n         issue_activity.delay(\n             type=\"cycle.activity.deleted\",\n             requested_data=json.dumps(\n@@ -523,9 +559,11 @@\n                 {\"error\": \"Start date and end date both are required\"},\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n \n-        start_date = convert_to_utc(date=str(start_date), project_id=project_id, is_start_date=True)\n+        start_date = convert_to_utc(\n+            date=str(start_date), project_id=project_id, is_start_date=True\n+        )\n         end_date = convert_to_utc(\n             date=str(end_date),\n             project_id=project_id,\n         )\n@@ -596,411 +634,25 @@\n                 {\"error\": \"New Cycle Id is required\"},\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n \n-        new_cycle = Cycle.objects.filter(workspace__slug=slug, project_id=project_id, pk=new_cycle_id).first()\n-\n-        old_cycle = (\n-            Cycle.objects.filter(workspace__slug=slug, project_id=project_id, pk=cycle_id)\n-            .annotate(\n-                total_issues=Count(\n-                    \"issue_cycle\",\n-                    filter=Q(\n-                        issue_cycle__issue__archived_at__isnull=True,\n-                        issue_cycle__issue__is_draft=False,\n-                        issue_cycle__deleted_at__isnull=True,\n-                        issue_cycle__issue__deleted_at__isnull=True,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                completed_issues=Count(\n-                    \"issue_cycle__issue__state__group\",\n-                    filter=Q(\n-                        issue_cycle__issue__state__group=\"completed\",\n-                        issue_cycle__issue__archived_at__isnull=True,\n-                        issue_cycle__issue__is_draft=False,\n-                        issue_cycle__issue__deleted_at__isnull=True,\n-                        issue_cycle__deleted_at__isnull=True,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                cancelled_issues=Count(\n-                    \"issue_cycle__issue__state__group\",\n-                    filter=Q(\n-                        issue_cycle__issue__state__group=\"cancelled\",\n-                        issue_cycle__issue__archived_at__isnull=True,\n-                        issue_cycle__issue__is_draft=False,\n-                        issue_cycle__issue__deleted_at__isnull=True,\n-                        issue_cycle__deleted_at__isnull=True,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                started_issues=Count(\n-                    \"issue_cycle__issue__state__group\",\n-                    filter=Q(\n-                        issue_cycle__issue__state__group=\"started\",\n-                        issue_cycle__issue__archived_at__isnull=True,\n-                        issue_cycle__issue__is_draft=False,\n-                        issue_cycle__issue__deleted_at__isnull=True,\n-                        issue_cycle__deleted_at__isnull=True,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                unstarted_issues=Count(\n-                    \"issue_cycle__issue__state__group\",\n-                    filter=Q(\n-                        issue_cycle__issue__state__group=\"unstarted\",\n-                        issue_cycle__issue__archived_at__isnull=True,\n-                        issue_cycle__issue__is_draft=False,\n-                        issue_cycle__issue__deleted_at__isnull=True,\n-                        issue_cycle__deleted_at__isnull=True,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                backlog_issues=Count(\n-                    \"issue_cycle__issue__state__group\",\n-                    filter=Q(\n-                        issue_cycle__issue__state__group=\"backlog\",\n-                        issue_cycle__issue__archived_at__isnull=True,\n-                        issue_cycle__issue__is_draft=False,\n-                        issue_cycle__issue__deleted_at__isnull=True,\n-                        issue_cycle__deleted_at__isnull=True,\n-                    ),\n-                )\n-            )\n-        )\n-        old_cycle = old_cycle.first()\n-\n-        estimate_type = Project.objects.filter(\n-            workspace__slug=slug,\n-            pk=project_id,\n-            estimate__isnull=False,\n-            estimate__type=\"points\",\n-        ).exists()\n-\n-        if estimate_type:\n-            assignee_estimate_data = (\n-                Issue.issue_objects.filter(\n-                    issue_cycle__cycle_id=cycle_id,\n-                    issue_cycle__deleted_at__isnull=True,\n-                    workspace__slug=slug,\n-                    project_id=project_id,\n-                )\n-                .annotate(display_name=F(\"assignees__display_name\"))\n-                .annotate(assignee_id=F(\"assignees__id\"))\n-                .annotate(\n-                    avatar_url=Case(\n-                        # If `avatar_asset` exists, use it to generate the asset URL\n-                        When(\n-                            assignees__avatar_asset__isnull=False,\n-                            then=Concat(\n-                                Value(\"/api/assets/v2/static/\"),\n-                                \"assignees__avatar_asset\",  # Assuming avatar_asset has an id or relevant field\n-                                Value(\"/\"),\n-                            ),\n-                        ),\n-                        # If `avatar_asset` is None, fall back to using `avatar` field directly\n-                        When(\n-                            assignees__avatar_asset__isnull=True,\n-                            then=\"assignees__avatar\",\n-                        ),\n-                        default=Value(None),\n-                        output_field=models.CharField(),\n-                    )\n-                )\n-                .values(\"display_name\", \"assignee_id\", \"avatar_url\")\n-                .annotate(total_estimates=Sum(Cast(\"estimate_point__value\", FloatField())))\n-                .annotate(\n-                    completed_estimates=Sum(\n-                        Cast(\"estimate_point__value\", FloatField()),\n-                        filter=Q(\n-                            completed_at__isnull=False,\n-                            archived_at__isnull=True,\n-                            is_draft=False,\n-                        ),\n-                    )\n-                )\n-                .annotate(\n-                    pending_estimates=Sum(\n-                        Cast(\"estimate_point__value\", FloatField()),\n-                        filter=Q(\n-                            completed_at__isnull=True,\n-                            archived_at__isnull=True,\n-                            is_draft=False,\n-                        ),\n-                    )\n-                )\n-                .order_by(\"display_name\")\n-            )\n-            # assignee distribution serialization\n-            assignee_estimate_distribution = [\n-                {\n-                    \"display_name\": item[\"display_name\"],\n-                    \"assignee_id\": (str(item[\"assignee_id\"]) if item[\"assignee_id\"] else None),\n-                    \"avatar\": item.get(\"avatar\"),\n-                    \"avatar_url\": item.get(\"avatar_url\"),\n-                    \"total_estimates\": item[\"total_estimates\"],\n-                    \"completed_estimates\": item[\"completed_estimates\"],\n-                    \"pending_estimates\": item[\"pending_estimates\"],\n-                }\n-                for item in assignee_estimate_data\n-            ]\n-\n-            label_distribution_data = (\n-                Issue.issue_objects.filter(\n-                    issue_cycle__cycle_id=cycle_id,\n-                    issue_cycle__deleted_at__isnull=True,\n-                    workspace__slug=slug,\n-                    project_id=project_id,\n-                )\n-                .annotate(label_name=F(\"labels__name\"))\n-                .annotate(color=F(\"labels__color\"))\n-                .annotate(label_id=F(\"labels__id\"))\n-                .values(\"label_name\", \"color\", \"label_id\")\n-                .annotate(total_estimates=Sum(Cast(\"estimate_point__value\", FloatField())))\n-                .annotate(\n-                    completed_estimates=Sum(\n-                        Cast(\"estimate_point__value\", FloatField()),\n-                        filter=Q(\n-                            completed_at__isnull=False,\n-                            archived_at__isnull=True,\n-                            is_draft=False,\n-                        ),\n-                    )\n-                )\n-                .annotate(\n-                    pending_estimates=Sum(\n-                        Cast(\"estimate_point__value\", FloatField()),\n-                        filter=Q(\n-                            completed_at__isnull=True,\n-                            archived_at__isnull=True,\n-                            is_draft=False,\n-                        ),\n-                    )\n-                )\n-                .order_by(\"label_name\")\n-            )\n-\n-            estimate_completion_chart = burndown_plot(\n-                queryset=old_cycle,\n-                slug=slug,\n-                project_id=project_id,\n-                plot_type=\"points\",\n-                cycle_id=cycle_id,\n-            )\n-            # Label distribution serialization\n-            label_estimate_distribution = [\n-                {\n-                    \"label_name\": item[\"label_name\"],\n-                    \"color\": item[\"color\"],\n-                    \"label_id\": (str(item[\"label_id\"]) if item[\"label_id\"] else None),\n-                    \"total_estimates\": item[\"total_estimates\"],\n-                    \"completed_estimates\": item[\"completed_estimates\"],\n-                    \"pending_estimates\": item[\"pending_estimates\"],\n-                }\n-                for item in label_distribution_data\n-            ]\n-\n-        # Get the assignee distribution\n-        assignee_distribution = (\n-            Issue.issue_objects.filter(\n-                issue_cycle__cycle_id=cycle_id,\n-                issue_cycle__deleted_at__isnull=True,\n-                workspace__slug=slug,\n-                project_id=project_id,\n-            )\n-            .annotate(display_name=F(\"assignees__display_name\"))\n-            .annotate(assignee_id=F(\"assignees__id\"))\n-            .annotate(\n-                avatar_url=Case(\n-                    # If `avatar_asset` exists, use it to generate the asset URL\n-                    When(\n-                        assignees__avatar_asset__isnull=False,\n-                        then=Concat(\n-                            Value(\"/api/assets/v2/static/\"),\n-                            \"assignees__avatar_asset\",  # Assuming avatar_asset has an id or relevant field\n-                            Value(\"/\"),\n-                        ),\n-                    ),\n-                    # If `avatar_asset` is None, fall back to using `avatar` field directly\n-                    When(assignees__avatar_asset__isnull=True, then=\"assignees__avatar\"),\n-                    default=Value(None),\n-                    output_field=models.CharField(),\n-                )\n-            )\n-            .values(\"display_name\", \"assignee_id\", \"avatar_url\")\n-            .annotate(total_issues=Count(\"id\", filter=Q(archived_at__isnull=True, is_draft=False)))\n-            .annotate(\n-                completed_issues=Count(\n-                    \"id\",\n-                    filter=Q(\n-                        completed_at__isnull=False,\n-                        archived_at__isnull=True,\n-                        is_draft=False,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                pending_issues=Count(\n-                    \"id\",\n-                    filter=Q(\n-                        completed_at__isnull=True,\n-                        archived_at__isnull=True,\n-                        is_draft=False,\n-                    ),\n-                )\n-            )\n-            .order_by(\"display_name\")\n-        )\n-        # assignee distribution serialized\n-        assignee_distribution_data = [\n-            {\n-                \"display_name\": item[\"display_name\"],\n-                \"assignee_id\": (str(item[\"assignee_id\"]) if item[\"assignee_id\"] else None),\n-                \"avatar\": item.get(\"avatar\"),\n-                \"avatar_url\": item.get(\"avatar_url\"),\n-                \"total_issues\": item[\"total_issues\"],\n-                \"completed_issues\": item[\"completed_issues\"],\n-                \"pending_issues\": item[\"pending_issues\"],\n-            }\n-            for item in assignee_distribution\n-        ]\n-\n-        # Get the label distribution\n-        label_distribution = (\n-            Issue.issue_objects.filter(\n-                issue_cycle__cycle_id=cycle_id,\n-                issue_cycle__deleted_at__isnull=True,\n-                workspace__slug=slug,\n-                project_id=project_id,\n-            )\n-            .annotate(label_name=F(\"labels__name\"))\n-            .annotate(color=F(\"labels__color\"))\n-            .annotate(label_id=F(\"labels__id\"))\n-            .values(\"label_name\", \"color\", \"label_id\")\n-            .annotate(total_issues=Count(\"id\", filter=Q(archived_at__isnull=True, is_draft=False)))\n-            .annotate(\n-                completed_issues=Count(\n-                    \"id\",\n-                    filter=Q(\n-                        completed_at__isnull=False,\n-                        archived_at__isnull=True,\n-                        is_draft=False,\n-                    ),\n-                )\n-            )\n-            .annotate(\n-                pending_issues=Count(\n-                    \"id\",\n-                    filter=Q(\n-                        completed_at__isnull=True,\n-                        archived_at__isnull=True,\n-                        is_draft=False,\n-                    ),\n-                )\n-            )\n-            .order_by(\"label_name\")\n-        )\n-\n-        # Label distribution serilization\n-        label_distribution_data = [\n-            {\n-                \"label_name\": item[\"label_name\"],\n-                \"color\": item[\"color\"],\n-                \"label_id\": (str(item[\"label_id\"]) if item[\"label_id\"] else None),\n-                \"total_issues\": item[\"total_issues\"],\n-                \"completed_issues\": item[\"completed_issues\"],\n-                \"pending_issues\": item[\"pending_issues\"],\n-            }\n-            for item in label_distribution\n-        ]\n-\n-        # Pass the new_cycle queryset to burndown_plot\n-        completion_chart = burndown_plot(\n-            queryset=old_cycle,\n+        # Transfer cycle issues and create progress snapshot\n+        result = transfer_cycle_issues(\n             slug=slug,\n             project_id=project_id,\n-            plot_type=\"issues\",\n             cycle_id=cycle_id,\n+            new_cycle_id=new_cycle_id,\n+            request=request,\n+            user_id=request.user.id,\n         )\n \n-        current_cycle = Cycle.objects.filter(workspace__slug=slug, project_id=project_id, pk=cycle_id).first()\n-\n-        current_cycle.progress_snapshot = {\n-            \"total_issues\": old_cycle.total_issues,\n-            \"completed_issues\": old_cycle.completed_issues,\n-            \"cancelled_issues\": old_cycle.cancelled_issues,\n-            \"started_issues\": old_cycle.started_issues,\n-            \"unstarted_issues\": old_cycle.unstarted_issues,\n-            \"backlog_issues\": old_cycle.backlog_issues,\n-            \"distribution\": {\n-                \"labels\": label_distribution_data,\n-                \"assignees\": assignee_distribution_data,\n-                \"completion_chart\": completion_chart,\n-            },\n-            \"estimate_distribution\": (\n-                {}\n-                if not estimate_type\n-                else {\n-                    \"labels\": label_estimate_distribution,\n-                    \"assignees\": assignee_estimate_distribution,\n-                    \"completion_chart\": estimate_completion_chart,\n-                }\n-            ),\n-        }\n-        current_cycle.save(update_fields=[\"progress_snapshot\"])\n-\n-        if new_cycle.end_date is not None and new_cycle.end_date < timezone.now():\n+        # Handle error response\n+        if result.get(\"error\"):\n             return Response(\n-                {\"error\": \"The cycle where the issues are transferred is already completed\"},\n+                {\"error\": result[\"error\"]},\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n \n-        cycle_issues = CycleIssue.objects.filter(\n-            cycle_id=cycle_id,\n-            project_id=project_id,\n-            workspace__slug=slug,\n-            issue__state__group__in=[\"backlog\", \"unstarted\", \"started\"],\n-        )\n-\n-        updated_cycles = []\n-        update_cycle_issue_activity = []\n-        for cycle_issue in cycle_issues:\n-            cycle_issue.cycle_id = new_cycle_id\n-            updated_cycles.append(cycle_issue)\n-            update_cycle_issue_activity.append(\n-                {\n-                    \"old_cycle_id\": str(cycle_id),\n-                    \"new_cycle_id\": str(new_cycle_id),\n-                    \"issue_id\": str(cycle_issue.issue_id),\n-                }\n-            )\n-\n-        cycle_issues = CycleIssue.objects.bulk_update(updated_cycles, [\"cycle_id\"], batch_size=100)\n-\n-        # Capture Issue Activity\n-        issue_activity.delay(\n-            type=\"cycle.activity.created\",\n-            requested_data=json.dumps({\"cycles_list\": []}),\n-            actor_id=str(self.request.user.id),\n-            issue_id=None,\n-            project_id=str(self.kwargs.get(\"project_id\", None)),\n-            current_instance=json.dumps(\n-                {\n-                    \"updated_cycle_issues\": update_cycle_issue_activity,\n-                    \"created_cycle_issues\": \"[]\",\n-                }\n-            ),\n-            epoch=int(timezone.now().timestamp()),\n-            notification=True,\n-            origin=base_host(request=request, is_app=True),\n-        )\n-\n         return Response({\"message\": \"Success\"}, status=status.HTTP_200_OK)\n \n \n class CycleUserPropertiesEndpoint(BaseAPIView):\n@@ -1013,10 +665,14 @@\n             workspace__slug=slug,\n         )\n \n         cycle_properties.filters = request.data.get(\"filters\", cycle_properties.filters)\n-        cycle_properties.rich_filters = request.data.get(\"rich_filters\", cycle_properties.rich_filters)\n-        cycle_properties.display_filters = request.data.get(\"display_filters\", cycle_properties.display_filters)\n+        cycle_properties.rich_filters = request.data.get(\n+            \"rich_filters\", cycle_properties.rich_filters\n+        )\n+        cycle_properties.display_filters = request.data.get(\n+            \"display_filters\", cycle_properties.display_filters\n+        )\n         cycle_properties.display_properties = request.data.get(\n             \"display_properties\", cycle_properties.display_properties\n         )\n         cycle_properties.save()\n@@ -1038,11 +694,15 @@\n \n class CycleProgressEndpoint(BaseAPIView):\n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n     def get(self, request, slug, project_id, cycle_id):\n-        cycle = Cycle.objects.filter(workspace__slug=slug, project_id=project_id, id=cycle_id).first()\n+        cycle = Cycle.objects.filter(\n+            workspace__slug=slug, project_id=project_id, id=cycle_id\n+        ).first()\n         if not cycle:\n-            return Response({\"error\": \"Cycle not found\"}, status=status.HTTP_404_NOT_FOUND)\n+            return Response(\n+                {\"error\": \"Cycle not found\"}, status=status.HTTP_404_NOT_FOUND\n+            )\n         aggregate_estimates = (\n             Issue.issue_objects.filter(\n                 estimate_point__estimate__type=\"points\",\n                 issue_cycle__cycle_id=cycle_id,\n@@ -1086,9 +746,11 @@\n                         default=Value(0),\n                         output_field=FloatField(),\n                     )\n                 ),\n-                total_estimate_points=Sum(\"value_as_float\", default=Value(0), output_field=FloatField()),\n+                total_estimate_points=Sum(\n+                    \"value_as_float\", default=Value(0), output_field=FloatField()\n+                ),\n             )\n         )\n         if cycle.progress_snapshot:\n             backlog_issues = cycle.progress_snapshot.get(\"backlog_issues\", 0)\n@@ -1146,13 +808,24 @@\n             ).count()\n \n         return Response(\n             {\n-                \"backlog_estimate_points\": aggregate_estimates[\"backlog_estimate_point\"] or 0,\n-                \"unstarted_estimate_points\": aggregate_estimates[\"unstarted_estimate_point\"] or 0,\n-                \"started_estimate_points\": aggregate_estimates[\"started_estimate_point\"] or 0,\n-                \"cancelled_estimate_points\": aggregate_estimates[\"cancelled_estimate_point\"] or 0,\n-                \"completed_estimate_points\": aggregate_estimates[\"completed_estimate_points\"] or 0,\n+                \"backlog_estimate_points\": aggregate_estimates[\"backlog_estimate_point\"]\n+                or 0,\n+                \"unstarted_estimate_points\": aggregate_estimates[\n+                    \"unstarted_estimate_point\"\n+                ]\n+                or 0,\n+                \"started_estimate_points\": aggregate_estimates[\"started_estimate_point\"]\n+                or 0,\n+                \"cancelled_estimate_points\": aggregate_estimates[\n+                    \"cancelled_estimate_point\"\n+                ]\n+                or 0,\n+                \"completed_estimate_points\": aggregate_estimates[\n+                    \"completed_estimate_points\"\n+                ]\n+                or 0,\n                 \"total_estimate_points\": aggregate_estimates[\"total_estimate_points\"],\n                 \"backlog_issues\": backlog_issues,\n                 \"total_issues\": total_issues,\n                 \"completed_issues\": completed_issues,\n@@ -1168,9 +841,11 @@\n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n     def get(self, request, slug, project_id, cycle_id):\n         analytic_type = request.GET.get(\"type\", \"issues\")\n         cycle = (\n-            Cycle.objects.filter(workspace__slug=slug, project_id=project_id, id=cycle_id)\n+            Cycle.objects.filter(\n+                workspace__slug=slug, project_id=project_id, id=cycle_id\n+            )\n             .annotate(\n                 total_issues=Count(\n                     \"issue_cycle__issue__id\",\n                     distinct=True,\n@@ -1251,10 +926,12 @@\n                         output_field=models.CharField(),\n                     )\n                 )\n                 .values(\"display_name\", \"assignee_id\", \"avatar_url\")\n-                .annotate(total_estimates=Sum(Cast(\"estimate_point__value\", FloatField())))\n                 .annotate(\n+                    total_estimates=Sum(Cast(\"estimate_point__value\", FloatField()))\n+                )\n+                .annotate(\n                     completed_estimates=Sum(\n                         Cast(\"estimate_point__value\", FloatField()),\n                         filter=Q(\n                             completed_at__isnull=False,\n@@ -1286,10 +963,12 @@\n                 .annotate(label_name=F(\"labels__name\"))\n                 .annotate(color=F(\"labels__color\"))\n                 .annotate(label_id=F(\"labels__id\"))\n                 .values(\"label_name\", \"color\", \"label_id\")\n-                .annotate(total_estimates=Sum(Cast(\"estimate_point__value\", FloatField())))\n                 .annotate(\n+                    total_estimates=Sum(Cast(\"estimate_point__value\", FloatField()))\n+                )\n+                .annotate(\n                     completed_estimates=Sum(\n                         Cast(\"estimate_point__value\", FloatField()),\n                         filter=Q(\n                             completed_at__isnull=False,\n@@ -1388,10 +1067,14 @@\n                 .annotate(label_name=F(\"labels__name\"))\n                 .annotate(color=F(\"labels__color\"))\n                 .annotate(label_id=F(\"labels__id\"))\n                 .values(\"label_name\", \"color\", \"label_id\")\n-                .annotate(total_issues=Count(\"label_id\", filter=Q(archived_at__isnull=True, is_draft=False)))\n                 .annotate(\n+                    total_issues=Count(\n+                        \"label_id\", filter=Q(archived_at__isnull=True, is_draft=False)\n+                    )\n+                )\n+                .annotate(\n                     completed_issues=Count(\n                         \"label_id\",\n                         filter=Q(\n                             completed_at__isnull=False,\n"
        },
        {
          "path": "apps/api/plane/utils/cycle_transfer_issues.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/cycle_transfer_issues.py\n===================================================================\n--- apps/api/plane/utils/cycle_transfer_issues.py\t68aa2fe (parent)\n+++ apps/api/plane/utils/cycle_transfer_issues.py\tf94da68 (commit)\n@@ -0,0 +1,486 @@\n+# Python imports\n+import json\n+\n+# Django imports\n+from django.db.models import (\n+    Case,\n+    Count,\n+    F,\n+    Q,\n+    Sum,\n+    FloatField,\n+    Value,\n+    When,\n+)\n+from django.db import models\n+from django.db.models.functions import Cast, Concat\n+from django.utils import timezone\n+\n+# Module imports\n+from plane.db.models import (\n+    Cycle,\n+    CycleIssue,\n+    Issue,\n+    Project,\n+)\n+from plane.utils.analytics_plot import burndown_plot\n+from plane.bgtasks.issue_activities_task import issue_activity\n+from plane.utils.host import base_host\n+\n+\n+def transfer_cycle_issues(\n+    slug,\n+    project_id,\n+    cycle_id,\n+    new_cycle_id,\n+    request,\n+    user_id,\n+):\n+    \"\"\"\n+    Transfer incomplete issues from one cycle to another and create progress snapshot.\n+\n+    Args:\n+        slug: Workspace slug\n+        project_id: Project ID\n+        cycle_id: Source cycle ID\n+        new_cycle_id: Destination cycle ID\n+        request: HTTP request object\n+        user_id: User ID performing the transfer\n+\n+    Returns:\n+        dict: Response data with success or error message\n+    \"\"\"\n+    # Get the new cycle\n+    new_cycle = Cycle.objects.filter(\n+        workspace__slug=slug, project_id=project_id, pk=new_cycle_id\n+    ).first()\n+\n+    # Check if new cycle is already completed\n+    if new_cycle.end_date is not None and new_cycle.end_date < timezone.now():\n+        return {\n+            \"success\": False,\n+            \"error\": \"The cycle where the issues are transferred is already completed\",\n+        }\n+\n+    # Get the old cycle with issue counts\n+    old_cycle = (\n+        Cycle.objects.filter(workspace__slug=slug, project_id=project_id, pk=cycle_id)\n+        .annotate(\n+            total_issues=Count(\n+                \"issue_cycle\",\n+                filter=Q(\n+                    issue_cycle__issue__archived_at__isnull=True,\n+                    issue_cycle__issue__is_draft=False,\n+                    issue_cycle__deleted_at__isnull=True,\n+                    issue_cycle__issue__deleted_at__isnull=True,\n+                ),\n+            )\n+        )\n+        .annotate(\n+            completed_issues=Count(\n+                \"issue_cycle__issue__state__group\",\n+                filter=Q(\n+                    issue_cycle__issue__state__group=\"completed\",\n+                    issue_cycle__issue__archived_at__isnull=True,\n+                    issue_cycle__issue__is_draft=False,\n+                    issue_cycle__issue__deleted_at__isnull=True,\n+                    issue_cycle__deleted_at__isnull=True,\n+                ),\n+            )\n+        )\n+        .annotate(\n+            cancelled_issues=Count(\n+                \"issue_cycle__issue__state__group\",\n+                filter=Q(\n+                    issue_cycle__issue__state__group=\"cancelled\",\n+                    issue_cycle__issue__archived_at__isnull=True,\n+                    issue_cycle__issue__is_draft=False,\n+                    issue_cycle__issue__deleted_at__isnull=True,\n+                    issue_cycle__deleted_at__isnull=True,\n+                ),\n+            )\n+        )\n+        .annotate(\n+            started_issues=Count(\n+                \"issue_cycle__issue__state__group\",\n+                filter=Q(\n+                    issue_cycle__issue__state__group=\"started\",\n+                    issue_cycle__issue__archived_at__isnull=True,\n+                    issue_cycle__issue__is_draft=False,\n+                    issue_cycle__issue__deleted_at__isnull=True,\n+                    issue_cycle__deleted_at__isnull=True,\n+                ),\n+            )\n+        )\n+        .annotate(\n+            unstarted_issues=Count(\n+                \"issue_cycle__issue__state__group\",\n+                filter=Q(\n+                    issue_cycle__issue__state__group=\"unstarted\",\n+                    issue_cycle__issue__archived_at__isnull=True,\n+                    issue_cycle__issue__is_draft=False,\n+                    issue_cycle__issue__deleted_at__isnull=True,\n+                    issue_cycle__deleted_at__isnull=True,\n+                ),\n+            )\n+        )\n+        .annotate(\n+            backlog_issues=Count(\n+                \"issue_cycle__issue__state__group\",\n+                filter=Q(\n+                    issue_cycle__issue__state__group=\"backlog\",\n+                    issue_cycle__issue__archived_at__isnull=True,\n+                    issue_cycle__issue__is_draft=False,\n+                    issue_cycle__issue__deleted_at__isnull=True,\n+                    issue_cycle__deleted_at__isnull=True,\n+                ),\n+            )\n+        )\n+    )\n+    old_cycle = old_cycle.first()\n+\n+    if old_cycle is None:\n+        return {\n+            \"success\": False,\n+            \"error\": \"Source cycle not found\",\n+        }\n+\n+    # Check if project uses estimates\n+    estimate_type = Project.objects.filter(\n+        workspace__slug=slug,\n+        pk=project_id,\n+        estimate__isnull=False,\n+        estimate__type=\"points\",\n+    ).exists()\n+\n+    # Initialize estimate distribution variables\n+    assignee_estimate_distribution = []\n+    label_estimate_distribution = []\n+    estimate_completion_chart = {}\n+\n+    if estimate_type:\n+        assignee_estimate_data = (\n+            Issue.issue_objects.filter(\n+                issue_cycle__cycle_id=cycle_id,\n+                issue_cycle__deleted_at__isnull=True,\n+                workspace__slug=slug,\n+                project_id=project_id,\n+            )\n+            .annotate(display_name=F(\"assignees__display_name\"))\n+            .annotate(assignee_id=F(\"assignees__id\"))\n+            .annotate(\n+                avatar_url=Case(\n+                    # If `avatar_asset` exists, use it to generate the asset URL\n+                    When(\n+                        assignees__avatar_asset__isnull=False,\n+                        then=Concat(\n+                            Value(\"/api/assets/v2/static/\"),\n+                            \"assignees__avatar_asset\",\n+                            Value(\"/\"),\n+                        ),\n+                    ),\n+                    # If `avatar_asset` is None, fall back to using `avatar` field directly\n+                    When(\n+                        assignees__avatar_asset__isnull=True,\n+                        then=\"assignees__avatar\",\n+                    ),\n+                    default=Value(None),\n+                    output_field=models.CharField(),\n+                )\n+            )\n+            .values(\"display_name\", \"assignee_id\", \"avatar_url\")\n+            .annotate(total_estimates=Sum(Cast(\"estimate_point__value\", FloatField())))\n+            .annotate(\n+                completed_estimates=Sum(\n+                    Cast(\"estimate_point__value\", FloatField()),\n+                    filter=Q(\n+                        completed_at__isnull=False,\n+                        archived_at__isnull=True,\n+                        is_draft=False,\n+                    ),\n+                )\n+            )\n+            .annotate(\n+                pending_estimates=Sum(\n+                    Cast(\"estimate_point__value\", FloatField()),\n+                    filter=Q(\n+                        completed_at__isnull=True,\n+                        archived_at__isnull=True,\n+                        is_draft=False,\n+                    ),\n+                )\n+            )\n+            .order_by(\"display_name\")\n+        )\n+        # Assignee estimate distribution serialization\n+        assignee_estimate_distribution = [\n+            {\n+                \"display_name\": item[\"display_name\"],\n+                \"assignee_id\": (\n+                    str(item[\"assignee_id\"]) if item[\"assignee_id\"] else None\n+                ),\n+                \"avatar_url\": item.get(\"avatar_url\"),\n+                \"total_estimates\": item[\"total_estimates\"],\n+                \"completed_estimates\": item[\"completed_estimates\"],\n+                \"pending_estimates\": item[\"pending_estimates\"],\n+            }\n+            for item in assignee_estimate_data\n+        ]\n+\n+        label_distribution_data = (\n+            Issue.issue_objects.filter(\n+                issue_cycle__cycle_id=cycle_id,\n+                issue_cycle__deleted_at__isnull=True,\n+                workspace__slug=slug,\n+                project_id=project_id,\n+            )\n+            .annotate(label_name=F(\"labels__name\"))\n+            .annotate(color=F(\"labels__color\"))\n+            .annotate(label_id=F(\"labels__id\"))\n+            .values(\"label_name\", \"color\", \"label_id\")\n+            .annotate(total_estimates=Sum(Cast(\"estimate_point__value\", FloatField())))\n+            .annotate(\n+                completed_estimates=Sum(\n+                    Cast(\"estimate_point__value\", FloatField()),\n+                    filter=Q(\n+                        completed_at__isnull=False,\n+                        archived_at__isnull=True,\n+                        is_draft=False,\n+                    ),\n+                )\n+            )\n+            .annotate(\n+                pending_estimates=Sum(\n+                    Cast(\"estimate_point__value\", FloatField()),\n+                    filter=Q(\n+                        completed_at__isnull=True,\n+                        archived_at__isnull=True,\n+                        is_draft=False,\n+                    ),\n+                )\n+            )\n+            .order_by(\"label_name\")\n+        )\n+\n+        estimate_completion_chart = burndown_plot(\n+            queryset=old_cycle,\n+            slug=slug,\n+            project_id=project_id,\n+            plot_type=\"points\",\n+            cycle_id=cycle_id,\n+        )\n+        # Label estimate distribution serialization\n+        label_estimate_distribution = [\n+            {\n+                \"label_name\": item[\"label_name\"],\n+                \"color\": item[\"color\"],\n+                \"label_id\": (str(item[\"label_id\"]) if item[\"label_id\"] else None),\n+                \"total_estimates\": item[\"total_estimates\"],\n+                \"completed_estimates\": item[\"completed_estimates\"],\n+                \"pending_estimates\": item[\"pending_estimates\"],\n+            }\n+            for item in label_distribution_data\n+        ]\n+\n+    # Get the assignee distribution\n+    assignee_distribution = (\n+        Issue.issue_objects.filter(\n+            issue_cycle__cycle_id=cycle_id,\n+            issue_cycle__deleted_at__isnull=True,\n+            workspace__slug=slug,\n+            project_id=project_id,\n+        )\n+        .annotate(display_name=F(\"assignees__display_name\"))\n+        .annotate(assignee_id=F(\"assignees__id\"))\n+        .annotate(\n+            avatar_url=Case(\n+                # If `avatar_asset` exists, use it to generate the asset URL\n+                When(\n+                    assignees__avatar_asset__isnull=False,\n+                    then=Concat(\n+                        Value(\"/api/assets/v2/static/\"),\n+                        \"assignees__avatar_asset\",\n+                        Value(\"/\"),\n+                    ),\n+                ),\n+                # If `avatar_asset` is None, fall back to using `avatar` field directly\n+                When(assignees__avatar_asset__isnull=True, then=\"assignees__avatar\"),\n+                default=Value(None),\n+                output_field=models.CharField(),\n+            )\n+        )\n+        .values(\"display_name\", \"assignee_id\", \"avatar_url\")\n+        .annotate(\n+            total_issues=Count(\"id\", filter=Q(archived_at__isnull=True, is_draft=False))\n+        )\n+        .annotate(\n+            completed_issues=Count(\n+                \"id\",\n+                filter=Q(\n+                    completed_at__isnull=False,\n+                    archived_at__isnull=True,\n+                    is_draft=False,\n+                ),\n+            )\n+        )\n+        .annotate(\n+            pending_issues=Count(\n+                \"id\",\n+                filter=Q(\n+                    completed_at__isnull=True,\n+                    archived_at__isnull=True,\n+                    is_draft=False,\n+                ),\n+            )\n+        )\n+        .order_by(\"display_name\")\n+    )\n+    # Assignee distribution serialized\n+    assignee_distribution_data = [\n+        {\n+            \"display_name\": item[\"display_name\"],\n+            \"assignee_id\": (str(item[\"assignee_id\"]) if item[\"assignee_id\"] else None),\n+            \"avatar_url\": item.get(\"avatar_url\"),\n+            \"total_issues\": item[\"total_issues\"],\n+            \"completed_issues\": item[\"completed_issues\"],\n+            \"pending_issues\": item[\"pending_issues\"],\n+        }\n+        for item in assignee_distribution\n+    ]\n+\n+    # Get the label distribution\n+    label_distribution = (\n+        Issue.issue_objects.filter(\n+            issue_cycle__cycle_id=cycle_id,\n+            issue_cycle__deleted_at__isnull=True,\n+            workspace__slug=slug,\n+            project_id=project_id,\n+        )\n+        .annotate(label_name=F(\"labels__name\"))\n+        .annotate(color=F(\"labels__color\"))\n+        .annotate(label_id=F(\"labels__id\"))\n+        .values(\"label_name\", \"color\", \"label_id\")\n+        .annotate(\n+            total_issues=Count(\"id\", filter=Q(archived_at__isnull=True, is_draft=False))\n+        )\n+        .annotate(\n+            completed_issues=Count(\n+                \"id\",\n+                filter=Q(\n+                    completed_at__isnull=False,\n+                    archived_at__isnull=True,\n+                    is_draft=False,\n+                ),\n+            )\n+        )\n+        .annotate(\n+            pending_issues=Count(\n+                \"id\",\n+                filter=Q(\n+                    completed_at__isnull=True,\n+                    archived_at__isnull=True,\n+                    is_draft=False,\n+                ),\n+            )\n+        )\n+        .order_by(\"label_name\")\n+    )\n+\n+    # Label distribution serialization\n+    label_distribution_data = [\n+        {\n+            \"label_name\": item[\"label_name\"],\n+            \"color\": item[\"color\"],\n+            \"label_id\": (str(item[\"label_id\"]) if item[\"label_id\"] else None),\n+            \"total_issues\": item[\"total_issues\"],\n+            \"completed_issues\": item[\"completed_issues\"],\n+            \"pending_issues\": item[\"pending_issues\"],\n+        }\n+        for item in label_distribution\n+    ]\n+\n+    # Generate completion chart\n+    completion_chart = burndown_plot(\n+        queryset=old_cycle,\n+        slug=slug,\n+        project_id=project_id,\n+        plot_type=\"issues\",\n+        cycle_id=cycle_id,\n+    )\n+\n+    # Get the current cycle and save progress snapshot\n+    current_cycle = Cycle.objects.filter(\n+        workspace__slug=slug, project_id=project_id, pk=cycle_id\n+    ).first()\n+\n+    current_cycle.progress_snapshot = {\n+        \"total_issues\": old_cycle.total_issues,\n+        \"completed_issues\": old_cycle.completed_issues,\n+        \"cancelled_issues\": old_cycle.cancelled_issues,\n+        \"started_issues\": old_cycle.started_issues,\n+        \"unstarted_issues\": old_cycle.unstarted_issues,\n+        \"backlog_issues\": old_cycle.backlog_issues,\n+        \"distribution\": {\n+            \"labels\": label_distribution_data,\n+            \"assignees\": assignee_distribution_data,\n+            \"completion_chart\": completion_chart,\n+        },\n+        \"estimate_distribution\": (\n+            {}\n+            if not estimate_type\n+            else {\n+                \"labels\": label_estimate_distribution,\n+                \"assignees\": assignee_estimate_distribution,\n+                \"completion_chart\": estimate_completion_chart,\n+            }\n+        ),\n+    }\n+    current_cycle.save(update_fields=[\"progress_snapshot\"])\n+\n+    # Get issues to transfer (only incomplete issues)\n+    cycle_issues = CycleIssue.objects.filter(\n+        cycle_id=cycle_id,\n+        project_id=project_id,\n+        workspace__slug=slug,\n+        issue__archived_at__isnull=True,\n+        issue__is_draft=False,\n+        issue__state__group__in=[\"backlog\", \"unstarted\", \"started\"],\n+    )\n+\n+    updated_cycles = []\n+    update_cycle_issue_activity = []\n+    for cycle_issue in cycle_issues:\n+        cycle_issue.cycle_id = new_cycle_id\n+        updated_cycles.append(cycle_issue)\n+        update_cycle_issue_activity.append(\n+            {\n+                \"old_cycle_id\": str(cycle_id),\n+                \"new_cycle_id\": str(new_cycle_id),\n+                \"issue_id\": str(cycle_issue.issue_id),\n+            }\n+        )\n+\n+    # Bulk update cycle issues\n+    cycle_issues = CycleIssue.objects.bulk_update(\n+        updated_cycles, [\"cycle_id\"], batch_size=100\n+    )\n+\n+    # Capture Issue Activity\n+    issue_activity.delay(\n+        type=\"cycle.activity.created\",\n+        requested_data=json.dumps({\"cycles_list\": []}),\n+        actor_id=str(user_id),\n+        issue_id=None,\n+        project_id=str(project_id),\n+        current_instance=json.dumps(\n+            {\n+                \"updated_cycle_issues\": update_cycle_issue_activity,\n+                \"created_cycle_issues\": [],\n+            }\n+        ),\n+        epoch=int(timezone.now().timestamp()),\n+        notification=True,\n+        origin=base_host(request=request, is_app=True),\n+    )\n+\n+    return {\"success\": True}\n"
        }
      ]
    },
    {
      "id": "add-filters-toggle",
      "sha": "7ce21a6488fc7d38a394b02f5b09c01f7300a4ed",
      "parentSha": "992457efd2be0cc626ca7734f915ec08d9cf5d14",
      "spec": "Implement a work item filters row visibility toggle backed by shared-state visibility and integrate it across issue headers and views. Make the following changes:\n\n1) Add visibility options to rich filters constants\n- In packages/constants/src/rich-filters/option.ts:\n  - Define TAutoVisibilityOptions with two modes:\n    - autoSetVisibility: true\n    - autoSetVisibility: false with isVisibleOnMount: boolean\n  - Export DEFAULT_FILTER_VISIBILITY_OPTIONS = { autoSetVisibility: true }.\n  - Extend TFilterOptions<E> to include visibility: TAutoVisibilityOptions.\n\n2) Expose filter visibility in shared-state rich filters\n- In packages/shared-state/src/store/rich-filters/filter-helpers.ts:\n  - Introduce observable isVisible state managed by FilterInstanceHelper.\n  - Construct FilterInstanceHelper with a reference to the parent filter instance and an adapter, using MobX observables/actions.\n  - Implement setInitialVisibility(visibilityOption): set visibility based on options; if autoSetVisibility is true and the filter has active filters, set visible, else hidden. If autoSetVisibility is false, use isVisibleOnMount.\n  - Implement toggleVisibility(isVisible?): toggle or set explicit visibility.\n- In packages/shared-state/src/store/rich-filters/filter.ts:\n  - Construct FilterInstanceHelper with a reference to the FilterInstance and set initial visibility using options.visibility or DEFAULT_FILTER_VISIBILITY_OPTIONS.\n  - Add computed getter isVisible returning helper.isVisible.\n  - Add action toggleVisibility delegating to helper.\n- In packages/shared-state/src/store/rich-filters/config-manager.ts:\n  - Make the _filterInstance reference private.\n\n3) Update work item filters store to use visibility and a dedicated instance type\n- Create packages/shared-state/src/store/work-item-filters/shared.ts:\n  - Define TWorkItemFilterKey = `${EIssuesStoreType}-${string}`.\n  - Export IWorkItemFilterInstance = IFilterInstance<TWorkItemFilterProperty, TWorkItemFilterExpression>.\n- In packages/shared-state/src/store/work-item-filters/index.ts, export ./shared.\n- In packages/shared-state/src/store/work-item-filters/filter.store.ts:\n  - Update store to use Map<TWorkItemFilterKey, IWorkItemFilterInstance>.\n  - Extend getOrCreateFilter params with showOnMount?: boolean.\n  - For an existing filter, if showOnMount is provided, immediately apply toggleVisibility(showOnMount).\n  - When creating a new filter, pass visibility in options:\n    - If showOnMount is true, use { autoSetVisibility: false, isVisibleOnMount: true };\n    - Otherwise { autoSetVisibility: true }.\n\n4) Introduce a generic filters toggle UI and a work-item-specific wrapper\n- Create apps/web/core/components/rich-filters/filters-toggle.tsx:\n  - Accepts filter?: IFilterInstance and renders a compact control.\n  - Behavior:\n    - If no active conditions, row is hidden, and there are no unsaved changes, show an AddFilterButton (variant neutral-primary) that opens the filters row and allows adding the first condition.\n    - Otherwise, show an icon button (e.g., ListFilter) that toggles visibility; style reflects visible/hidden state; add a small pill when visible, when there are active conditions, or when there are unsaved changes.\n- Create apps/web/core/components/work-item-filters/filters-toggle.tsx:\n  - Takes { entityType: EIssuesStoreType; entityId: string }.\n  - Uses useWorkItemFilters().getFilter to fetch the filter instance and renders the rich-filters/FiltersToggle with that instance.\n\n5) Standardize WorkItemFiltersRow and support two variants\n- Rename apps/web/core/components/work-item-filters/work-item-filters-row.tsx to filters-row.tsx and update all imports accordingly.\n- In apps/web/core/components/rich-filters/add-filters-button.tsx:\n  - Change buttonConfig.label type to string | null and remove its default value.\n- In apps/web/core/components/rich-filters/filters-row.tsx:\n  - Replace visible prop with internal visibility using filter.isVisible and wrap output in a Transition.\n  - Support variant prop: \"header\" (default) and \"modal\". Header variant uses a ternary Header wrapper; modal variant uses a rounded container with background.\n  - Compute hasAnyConditions and hasAvailableOperations to control layout and left border for operation controls.\n  - Use AddFilterButton with ListFilterPlus icon, label null, and defaultOpen when there are no conditions.\n  - Protect handleUpdate with try/finally to avoid flicker.\n- In apps/web/core/components/work-item-filters/filters-row.tsx wrapper:\n  - Update prop types to require filter: IWorkItemFilterInstance.\n\n6) Update HOCs and hooks to wire initial visibility and instance typing\n- In apps/web/core/components/work-item-filters/filters-hoc/shared.ts and base.tsx:\n  - Replace IFilterInstance with IWorkItemFilterInstance in types.\n  - Add showOnMount?: boolean prop.\n  - Pass showOnMount to useWorkItemFilters().getOrCreateFilter so the store can set initial visibility.\n- In apps/web/core/hooks/store/work-item-filters/use-work-item-filter-instance.ts:\n  - Change return type to IWorkItemFilterInstance | undefined.\n\n7) Integrate the toggle control across pages and headers\n- Add WorkItemFiltersToggle to the following components and place it adjacent to layout/display controls:\n  - apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/header.tsx with entityType CYCLE and cycleId.\n  - apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/header.tsx with entityType MODULE and moduleId; also adjust router params to strings, guard nulls, and render ModuleQuickActions only when moduleId exists.\n  - apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/views/(detail)/[viewId]/header.tsx with entityType PROJECT_VIEW and viewId; ensure layout and display dropdowns remain hidden when the view is locked but the toggle is still shown.\n  - apps/web/app/(all)/[workspaceSlug]/(projects)/workspace-views/header.tsx with entityType GLOBAL and globalViewId; ensure locked state hides layout and display but shows the toggle.\n  - apps/web/core/components/issues/archived-issues-header.tsx with entityType ARCHIVED and projectId; coerce route params to strings; return null when missing; update updateFilters calls to use the coerced strings.\n  - apps/web/core/components/issues/filters.tsx with storeType/entityType and projectId.\n  - apps/web/core/components/profile/profile-issues-filter.tsx with entityType PROFILE and userId; coerce route params and update filter calls accordingly.\n\n8) Update view forms to show the filters row on mount in modals\n- In apps/web/core/components/views/form.tsx and apps/web/core/components/workspace/views/form.tsx:\n  - Pass showOnMount to the HOC so temporary filter instances open by default.\n  - Render WorkItemFiltersRow with variant=\"modal\".\n\n9) Update import paths in all issue layout roots and profile issues\n- Update imports of WorkItemFiltersRow to the new location apps/web/core/components/work-item-filters/filters-row in:\n  - all-issue-layout-root.tsx\n  - archived-issue-layout-root.tsx\n  - cycle-layout-root.tsx\n  - module-layout-root.tsx\n  - project-layout-root.tsx\n  - project-view-layout-root.tsx\n  - profile-issues.tsx\n\n10) Ensure safe route param conversions\n- Where route params are used as IDs, convert via toString() and guard undefined cases to avoid runtime errors.\n\nAcceptance criteria\n- Filters row visibility state is managed per filter instance and persists during the session.\n- The new Filters toggle appears across all specified headers and respects locked view rules (toggle visible; layout/display hidden when locked).\n- Clicking the Add filter button when no conditions exist both opens the filters row and focuses adding a condition.\n- The row automatically shows when there are active filters; otherwise starts hidden unless showOnMount is true.\n- Modal usage displays the filters row in a rounded container; header usage uses the header styling.\n- All renamed imports and new types compile without type errors.",
      "prompt": "Add a toggle to show/hide the advanced Work Item Filters row across issue views and headers and wire it to shared filter state so visibility is per-view and persisted during the session. The toggle should indicate when filters are visible, when any conditions are active, or when there are unsaved changes, and it should surface an Add filter button when there are no active filters and the row is hidden. Support two visual variants for the filters row: a compact header variant and a modal variant used in view configuration forms. Ensure initial visibility is determined automatically based on whether filters are active, with an option to force the row visible on mount for temporary filters. Integrate the toggle in project, cycle, module, project view, workspace (global), archived, and profile contexts, and make route param usage safe. Update the filter store/types as needed to expose and update visibility and to rename and standardize the WorkItemFiltersRow component.",
      "supplementalFiles": [
        "apps/web/core/hooks/store/work-item-filters/use-work-item-filters.ts",
        "apps/web/core/components/work-item-filters/filters-hoc/project-level.tsx",
        "apps/web/core/components/work-item-filters/filters-hoc/workspace-level.tsx",
        "apps/web/core/components/rich-filters/filter-item.tsx",
        "packages/shared-state/src/store/rich-filters/index.ts",
        "packages/shared-state/src/store/work-item-filters/adapter.ts",
        "packages/types/src/rich-filters/index.ts",
        "packages/types/src/rich-filters/expression.ts"
      ],
      "fileDiffs": [
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/header.tsx",
          "status": "modified",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/header.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/header.tsx\t992457e (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/header.tsx\t7ce21a6 (commit)\n@@ -37,8 +37,9 @@\n   FiltersDropdown,\n   LayoutSelection,\n   MobileLayoutSelection,\n } from \"@/components/issues/issue-layouts/filters\";\n+import { WorkItemFiltersToggle } from \"@/components/work-item-filters/filters-toggle\";\n // hooks\n import { useCommandPalette } from \"@/hooks/store/use-command-palette\";\n import { useCycle } from \"@/hooks/store/use-cycle\";\n import { useIssues } from \"@/hooks/store/use-issues\";\n@@ -208,8 +209,9 @@\n                 onChange={(layout) => handleLayoutChange(layout)}\n                 activeLayout={activeLayout}\n               />\n             </div>\n+            <WorkItemFiltersToggle entityType={EIssuesStoreType.CYCLE} entityId={cycleId} />\n             <FiltersDropdown\n               title={t(\"common.display\")}\n               placement=\"bottom-end\"\n               miniIcon={<SlidersHorizontal className=\"size-3.5\" />}\n"
        },
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/header.tsx",
          "status": "modified",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/header.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/header.tsx\t992457e (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/header.tsx\t7ce21a6 (commit)\n@@ -34,10 +34,10 @@\n   FiltersDropdown,\n   LayoutSelection,\n   MobileLayoutSelection,\n } from \"@/components/issues/issue-layouts/filters\";\n-// helpers\n import { ModuleQuickActions } from \"@/components/modules\";\n+import { WorkItemFiltersToggle } from \"@/components/work-item-filters/filters-toggle\";\n // hooks\n import { useCommandPalette } from \"@/hooks/store/use-command-palette\";\n import { useIssues } from \"@/hooks/store/use-issues\";\n import { useModule } from \"@/hooks/store/use-module\";\n@@ -56,9 +56,10 @@\n   // states\n   const [analyticsModal, setAnalyticsModal] = useState(false);\n   // router\n   const router = useAppRouter();\n-  const { workspaceSlug, projectId, moduleId } = useParams();\n+  const { workspaceSlug, projectId, moduleId: routerModuleId } = useParams();\n+  const moduleId = routerModuleId ? routerModuleId.toString() : undefined;\n   // hooks\n   const { isMobile } = usePlatformOS();\n   // store hooks\n   const {\n@@ -74,9 +75,9 @@\n   const { setValue, storedValue } = useLocalStorage(\"module_sidebar_collapsed\", \"false\");\n   // derived values\n   const isSidebarCollapsed = storedValue ? (storedValue === \"true\" ? true : false) : false;\n   const activeLayout = issueFilters?.displayFilters?.layout;\n-  const moduleDetails = moduleId ? getModuleById(moduleId.toString()) : undefined;\n+  const moduleDetails = moduleId ? getModuleById(moduleId) : undefined;\n   const canUserCreateIssue = allowPermissions(\n     [EUserPermissions.ADMIN, EUserPermissions.MEMBER],\n     EUserPermissionsLevel.PROJECT\n   );\n@@ -196,8 +197,9 @@\n                 onChange={(layout) => handleLayoutChange(layout)}\n                 activeLayout={activeLayout}\n               />\n             </div>\n+            {moduleId && <WorkItemFiltersToggle entityType={EIssuesStoreType.MODULE} entityId={moduleId} />}\n             <FiltersDropdown\n               title=\"Display\"\n               placement=\"bottom-end\"\n               miniIcon={<SlidersHorizontal className=\"size-3.5\" />}\n@@ -250,15 +252,17 @@\n             onClick={toggleSidebar}\n           >\n             <PanelRight className={cn(\"h-4 w-4\", !isSidebarCollapsed ? \"text-[#3E63DD]\" : \"text-custom-text-200\")} />\n           </button>\n-          <ModuleQuickActions\n-            parentRef={parentRef}\n-            moduleId={moduleId?.toString()}\n-            projectId={projectId.toString()}\n-            workspaceSlug={workspaceSlug.toString()}\n-            customClassName=\"flex-shrink-0 flex items-center justify-center bg-custom-background-80/70 rounded size-[26px]\"\n-          />\n+          {moduleId && (\n+            <ModuleQuickActions\n+              parentRef={parentRef}\n+              moduleId={moduleId}\n+              projectId={projectId.toString()}\n+              workspaceSlug={workspaceSlug.toString()}\n+              customClassName=\"flex-shrink-0 flex items-center justify-center bg-custom-background-80/70 rounded size-[26px]\"\n+            />\n+          )}\n         </Header.RightItem>\n       </Header>\n     </>\n   );\n"
        },
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/views/(detail)/[viewId]/header.tsx",
          "status": "modified",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/views/(detail)/[viewId]/header.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/views/(detail)/[viewId]/header.tsx\t992457e (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/views/(detail)/[viewId]/header.tsx\t7ce21a6 (commit)\n@@ -30,8 +30,9 @@\n import { SwitcherIcon, SwitcherLabel } from \"@/components/common/switcher-label\";\n import { DisplayFiltersSelection, FiltersDropdown, LayoutSelection } from \"@/components/issues/issue-layouts/filters\";\n // constants\n import { ViewQuickActions } from \"@/components/views/quick-actions\";\n+import { WorkItemFiltersToggle } from \"@/components/work-item-filters/filters-toggle\";\n // hooks\n import { useCommandPalette } from \"@/hooks/store/use-command-palette\";\n import { useIssues } from \"@/hooks/store/use-issues\";\n import { useProject } from \"@/hooks/store/use-project\";\n@@ -44,10 +45,11 @@\n export const ProjectViewIssuesHeader: React.FC = observer(() => {\n   // refs\n   const parentRef = useRef(null);\n   // router\n-  const { workspaceSlug, projectId, viewId } = useParams();\n   const router = useAppRouter();\n+  const { workspaceSlug, projectId, viewId: routerViewId } = useParams();\n+  const viewId = routerViewId ? routerViewId.toString() : undefined;\n   // store hooks\n   const {\n     issuesFilter: { issueFilters, updateFilters },\n   } = useIssues(EIssuesStoreType.PROJECT_VIEW);\n@@ -162,10 +164,10 @@\n           <></>\n         )}\n       </Header.LeftItem>\n       <Header.RightItem className=\"items-center\">\n-        {!viewDetails?.is_locked ? (\n-          <>\n+        <>\n+          {!viewDetails.is_locked && (\n             <LayoutSelection\n               layouts={[\n                 EIssueLayoutTypes.LIST,\n                 EIssueLayoutTypes.KANBAN,\n@@ -175,8 +177,11 @@\n               ]}\n               onChange={(layout) => handleLayoutChange(layout)}\n               selectedLayout={activeLayout}\n             />\n+          )}\n+          {viewId && <WorkItemFiltersToggle entityType={EIssuesStoreType.PROJECT_VIEW} entityId={viewId} />}\n+          {!viewDetails.is_locked && (\n             <FiltersDropdown title=\"Display\" placement=\"bottom-end\">\n               <DisplayFiltersSelection\n                 layoutDisplayFiltersOptions={\n                   activeLayout ? ISSUE_DISPLAY_FILTERS_BY_PAGE.issues.layoutOptions[activeLayout] : undefined\n@@ -188,12 +193,10 @@\n                 cycleViewDisabled={!currentProjectDetails?.cycle_view}\n                 moduleViewDisabled={!currentProjectDetails?.module_view}\n               />\n             </FiltersDropdown>\n-          </>\n-        ) : (\n-          <></>\n-        )}\n+          )}\n+        </>\n         {canUserCreateIssue ? (\n           <Button\n             onClick={() => {\n               toggleCreateIssueModal(true, EIssuesStoreType.PROJECT_VIEW);\n"
        },
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(projects)/workspace-views/header.tsx",
          "status": "modified",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(projects)/workspace-views/header.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(projects)/workspace-views/header.tsx\t992457e (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(projects)/workspace-views/header.tsx\t7ce21a6 (commit)\n@@ -24,8 +24,9 @@\n // components\n import { BreadcrumbLink } from \"@/components/common/breadcrumb-link\";\n import { SwitcherLabel } from \"@/components/common/switcher-label\";\n import { DisplayFiltersSelection, FiltersDropdown } from \"@/components/issues/issue-layouts/filters\";\n+import { WorkItemFiltersToggle } from \"@/components/work-item-filters/filters-toggle\";\n import { DefaultWorkspaceViewQuickActions } from \"@/components/workspace/views/default-view-quick-action\";\n import { CreateUpdateWorkspaceViewModal } from \"@/components/workspace/views/modal\";\n import { WorkspaceViewQuickActions } from \"@/components/workspace/views/quick-action\";\n // hooks\n@@ -38,9 +39,10 @@\n   // states\n   const [createViewModal, setCreateViewModal] = useState(false);\n   // router\n   const router = useAppRouter();\n-  const { workspaceSlug, globalViewId } = useParams();\n+  const { workspaceSlug, globalViewId: routerGlobalViewId } = useParams();\n+  const globalViewId = routerGlobalViewId ? routerGlobalViewId.toString() : undefined;\n   // store hooks\n   const {\n     issuesFilter: { filters, updateFilters },\n   } = useIssues(EIssuesStoreType.GLOBAL);\n@@ -49,9 +51,9 @@\n \n   const issueFilters = globalViewId ? filters[globalViewId.toString()] : undefined;\n \n   const activeLayout = issueFilters?.displayFilters?.layout;\n-  const viewDetails = getViewDetailsById(globalViewId.toString());\n+  const viewDetails = globalViewId ? getViewDetailsById(globalViewId) : undefined;\n \n   const handleDisplayFilters = useCallback(\n     (updatedDisplayFilter: Partial<IIssueDisplayFilterOptions>) => {\n       if (!workspaceSlug || !globalViewId) return;\n@@ -59,24 +61,18 @@\n         workspaceSlug.toString(),\n         undefined,\n         EIssueFilterType.DISPLAY_FILTERS,\n         updatedDisplayFilter,\n-        globalViewId.toString()\n+        globalViewId\n       );\n     },\n     [workspaceSlug, updateFilters, globalViewId]\n   );\n \n   const handleDisplayProperties = useCallback(\n     (property: Partial<IIssueDisplayProperties>) => {\n       if (!workspaceSlug || !globalViewId) return;\n-      updateFilters(\n-        workspaceSlug.toString(),\n-        undefined,\n-        EIssueFilterType.DISPLAY_PROPERTIES,\n-        property,\n-        globalViewId.toString()\n-      );\n+      updateFilters(workspaceSlug.toString(), undefined, EIssueFilterType.DISPLAY_PROPERTIES, property, globalViewId);\n     },\n     [workspaceSlug, updateFilters, globalViewId]\n   );\n \n@@ -87,9 +83,9 @@\n         workspaceSlug.toString(),\n         undefined,\n         EIssueFilterType.DISPLAY_FILTERS,\n         { layout: layout },\n-        globalViewId.toString()\n+        globalViewId\n       );\n     },\n     [workspaceSlug, updateFilters, globalViewId]\n   );\n@@ -157,27 +153,26 @@\n           </Breadcrumbs>\n         </Header.LeftItem>\n \n         <Header.RightItem className=\"items-center\">\n-          {!isLocked ? (\n-            <>\n-              <GlobalViewLayoutSelection\n-                onChange={handleLayoutChange}\n-                selectedLayout={activeLayout ?? EIssueLayoutTypes.SPREADSHEET}\n-                workspaceSlug={workspaceSlug.toString()}\n+          {!isLocked && (\n+            <GlobalViewLayoutSelection\n+              onChange={handleLayoutChange}\n+              selectedLayout={activeLayout ?? EIssueLayoutTypes.SPREADSHEET}\n+              workspaceSlug={workspaceSlug.toString()}\n+            />\n+          )}\n+          {globalViewId && <WorkItemFiltersToggle entityType={EIssuesStoreType.GLOBAL} entityId={globalViewId} />}\n+          {!isLocked && (\n+            <FiltersDropdown title={t(\"common.display\")} placement=\"bottom-end\">\n+              <DisplayFiltersSelection\n+                layoutDisplayFiltersOptions={currentLayoutFilters}\n+                displayFilters={issueFilters?.displayFilters ?? {}}\n+                handleDisplayFiltersUpdate={handleDisplayFilters}\n+                displayProperties={issueFilters?.displayProperties ?? {}}\n+                handleDisplayPropertiesUpdate={handleDisplayProperties}\n               />\n-              <FiltersDropdown title={t(\"common.display\")} placement=\"bottom-end\">\n-                <DisplayFiltersSelection\n-                  layoutDisplayFiltersOptions={currentLayoutFilters}\n-                  displayFilters={issueFilters?.displayFilters ?? {}}\n-                  handleDisplayFiltersUpdate={handleDisplayFilters}\n-                  displayProperties={issueFilters?.displayProperties ?? {}}\n-                  handleDisplayPropertiesUpdate={handleDisplayProperties}\n-                />\n-              </FiltersDropdown>\n-            </>\n-          ) : (\n-            <></>\n+            </FiltersDropdown>\n           )}\n \n           <Button\n             variant=\"primary\"\n"
        },
        {
          "path": "apps/web/core/components/issues/archived-issues-header.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/archived-issues-header.tsx\n===================================================================\n--- apps/web/core/components/issues/archived-issues-header.tsx\t992457e (parent)\n+++ apps/web/core/components/issues/archived-issues-header.tsx\t7ce21a6 (commit)\n@@ -8,15 +8,18 @@\n import { EHeaderVariant, Header } from \"@plane/ui\";\n // components\n import { ArchiveTabsList } from \"@/components/archives\";\n import { DisplayFiltersSelection, FiltersDropdown } from \"@/components/issues/issue-layouts/filters\";\n+import { WorkItemFiltersToggle } from \"@/components/work-item-filters/filters-toggle\";\n // hooks\n import { useIssues } from \"@/hooks/store/use-issues\";\n import { useProject } from \"@/hooks/store/use-project\";\n \n export const ArchivedIssuesHeader: FC = observer(() => {\n   // router\n-  const { workspaceSlug, projectId } = useParams();\n+  const { workspaceSlug: routerWorkspaceSlug, projectId: routerProjectId } = useParams();\n+  const workspaceSlug = routerWorkspaceSlug ? routerWorkspaceSlug.toString() : undefined;\n+  const projectId = routerProjectId ? routerProjectId.toString() : undefined;\n   // store hooks\n   const { currentProjectDetails } = useProject();\n   const {\n     issuesFilter: { issueFilters, updateFilters },\n@@ -28,26 +31,28 @@\n \n   const handleDisplayFiltersUpdate = (updatedDisplayFilter: Partial<IIssueDisplayFilterOptions>) => {\n     if (!workspaceSlug || !projectId) return;\n \n-    updateFilters(workspaceSlug.toString(), projectId.toString(), EIssueFilterType.DISPLAY_FILTERS, {\n+    updateFilters(workspaceSlug, projectId, EIssueFilterType.DISPLAY_FILTERS, {\n       ...issueFilters?.displayFilters,\n       ...updatedDisplayFilter,\n     });\n   };\n \n   const handleDisplayPropertiesUpdate = (property: Partial<IIssueDisplayProperties>) => {\n     if (!workspaceSlug || !projectId) return;\n \n-    updateFilters(workspaceSlug.toString(), projectId.toString(), EIssueFilterType.DISPLAY_PROPERTIES, property);\n+    updateFilters(workspaceSlug, projectId, EIssueFilterType.DISPLAY_PROPERTIES, property);\n   };\n \n+  if (!workspaceSlug || !projectId) return null;\n   return (\n     <Header variant={EHeaderVariant.SECONDARY}>\n       <Header.LeftItem>\n         <ArchiveTabsList />\n       </Header.LeftItem>\n       <Header.RightItem className=\"items-center\">\n+        <WorkItemFiltersToggle entityType={EIssuesStoreType.ARCHIVED} entityId={projectId} />\n         <FiltersDropdown title={t(\"common.display\")} placement=\"bottom-end\">\n           <DisplayFiltersSelection\n             displayFilters={issueFilters?.displayFilters || {}}\n             displayProperties={issueFilters?.displayProperties || {}}\n"
        },
        {
          "path": "apps/web/core/components/issues/filters.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/filters.tsx\n===================================================================\n--- apps/web/core/components/issues/filters.tsx\t992457e (parent)\n+++ apps/web/core/components/issues/filters.tsx\t7ce21a6 (commit)\n@@ -13,8 +13,9 @@\n // plane web imports\n import { TProject } from \"@/plane-web/types\";\n // local imports\n import { WorkItemsModal } from \"../analytics/work-items/modal\";\n+import { WorkItemFiltersToggle } from \"../work-item-filters/filters-toggle\";\n import {\n   DisplayFiltersSelection,\n   FiltersDropdown,\n   LayoutSelection,\n@@ -101,8 +102,9 @@\n           onChange={(layout) => handleLayoutChange(layout)}\n           activeLayout={activeLayout}\n         />\n       </div>\n+      <WorkItemFiltersToggle entityType={storeType} entityId={projectId} />\n       <FiltersDropdown\n         miniIcon={<SlidersHorizontal className=\"size-3.5\" />}\n         title={t(\"common.display\")}\n         placement=\"bottom-end\"\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-layouts/roots/all-issue-layout-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-layouts/roots/all-issue-layout-root.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-layouts/roots/all-issue-layout-root.tsx\t992457e (parent)\n+++ apps/web/core/components/issues/issue-layouts/roots/all-issue-layout-root.tsx\t7ce21a6 (commit)\n@@ -9,9 +9,9 @@\n import { EmptyState } from \"@/components/common/empty-state\";\n import { IssuePeekOverview } from \"@/components/issues/peek-overview\";\n import { WorkspaceActiveLayout } from \"@/components/views/helper\";\n import { WorkspaceLevelWorkItemFiltersHOC } from \"@/components/work-item-filters/filters-hoc/workspace-level\";\n-import { WorkItemFiltersRow } from \"@/components/work-item-filters/work-item-filters-row\";\n+import { WorkItemFiltersRow } from \"@/components/work-item-filters/filters-row\";\n // hooks\n import { useGlobalView } from \"@/hooks/store/use-global-view\";\n import { useIssues } from \"@/hooks/store/use-issues\";\n import { useAppRouter } from \"@/hooks/use-app-router\";\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-layouts/roots/archived-issue-layout-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-layouts/roots/archived-issue-layout-root.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-layouts/roots/archived-issue-layout-root.tsx\t992457e (parent)\n+++ apps/web/core/components/issues/issue-layouts/roots/archived-issue-layout-root.tsx\t7ce21a6 (commit)\n@@ -8,9 +8,9 @@\n // components\n import { LogoSpinner } from \"@/components/common/logo-spinner\";\n import { ProjectLevelWorkItemFiltersHOC } from \"@/components/work-item-filters/filters-hoc/project-level\";\n // hooks\n-import { WorkItemFiltersRow } from \"@/components/work-item-filters/work-item-filters-row\";\n+import { WorkItemFiltersRow } from \"@/components/work-item-filters/filters-row\";\n import { useIssues } from \"@/hooks/store/use-issues\";\n import { IssuesStoreContext } from \"@/hooks/use-issue-layout-store\";\n // local imports\n import { IssuePeekOverview } from \"../../peek-overview\";\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-layouts/roots/cycle-layout-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-layouts/roots/cycle-layout-root.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-layouts/roots/cycle-layout-root.tsx\t992457e (parent)\n+++ apps/web/core/components/issues/issue-layouts/roots/cycle-layout-root.tsx\t7ce21a6 (commit)\n@@ -11,9 +11,9 @@\n import { TransferIssues } from \"@/components/cycles/transfer-issues\";\n import { TransferIssuesModal } from \"@/components/cycles/transfer-issues-modal\";\n // hooks\n import { ProjectLevelWorkItemFiltersHOC } from \"@/components/work-item-filters/filters-hoc/project-level\";\n-import { WorkItemFiltersRow } from \"@/components/work-item-filters/work-item-filters-row\";\n+import { WorkItemFiltersRow } from \"@/components/work-item-filters/filters-row\";\n import { useCycle } from \"@/hooks/store/use-cycle\";\n import { useIssues } from \"@/hooks/store/use-issues\";\n import { IssuesStoreContext } from \"@/hooks/use-issue-layout-store\";\n // local imports\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-layouts/roots/module-layout-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-layouts/roots/module-layout-root.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-layouts/roots/module-layout-root.tsx\t992457e (parent)\n+++ apps/web/core/components/issues/issue-layouts/roots/module-layout-root.tsx\t7ce21a6 (commit)\n@@ -9,9 +9,9 @@\n // components\n import { LogoSpinner } from \"@/components/common/logo-spinner\";\n // hooks\n import { ProjectLevelWorkItemFiltersHOC } from \"@/components/work-item-filters/filters-hoc/project-level\";\n-import { WorkItemFiltersRow } from \"@/components/work-item-filters/work-item-filters-row\";\n+import { WorkItemFiltersRow } from \"@/components/work-item-filters/filters-row\";\n import { useIssues } from \"@/hooks/store/use-issues\";\n import { IssuesStoreContext } from \"@/hooks/use-issue-layout-store\";\n // local imports\n import { IssuePeekOverview } from \"../../peek-overview\";\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-layouts/roots/project-layout-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-layouts/roots/project-layout-root.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-layouts/roots/project-layout-root.tsx\t992457e (parent)\n+++ apps/web/core/components/issues/issue-layouts/roots/project-layout-root.tsx\t7ce21a6 (commit)\n@@ -10,9 +10,9 @@\n import { Spinner } from \"@plane/ui\";\n // components\n import { LogoSpinner } from \"@/components/common/logo-spinner\";\n import { ProjectLevelWorkItemFiltersHOC } from \"@/components/work-item-filters/filters-hoc/project-level\";\n-import { WorkItemFiltersRow } from \"@/components/work-item-filters/work-item-filters-row\";\n+import { WorkItemFiltersRow } from \"@/components/work-item-filters/filters-row\";\n // hooks\n import { useIssues } from \"@/hooks/store/use-issues\";\n import { IssuesStoreContext } from \"@/hooks/use-issue-layout-store\";\n // local imports\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-layouts/roots/project-view-layout-root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-layouts/roots/project-view-layout-root.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-layouts/roots/project-view-layout-root.tsx\t992457e (parent)\n+++ apps/web/core/components/issues/issue-layouts/roots/project-view-layout-root.tsx\t7ce21a6 (commit)\n@@ -8,9 +8,9 @@\n // components\n import { LogoSpinner } from \"@/components/common/logo-spinner\";\n // hooks\n import { ProjectLevelWorkItemFiltersHOC } from \"@/components/work-item-filters/filters-hoc/project-level\";\n-import { WorkItemFiltersRow } from \"@/components/work-item-filters/work-item-filters-row\";\n+import { WorkItemFiltersRow } from \"@/components/work-item-filters/filters-row\";\n import { useIssues } from \"@/hooks/store/use-issues\";\n import { useProjectView } from \"@/hooks/store/use-project-view\";\n import { IssuesStoreContext } from \"@/hooks/use-issue-layout-store\";\n // local imports\n"
        },
        {
          "path": "apps/web/core/components/profile/profile-issues-filter.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/profile/profile-issues-filter.tsx\n===================================================================\n--- apps/web/core/components/profile/profile-issues-filter.tsx\t992457e (parent)\n+++ apps/web/core/components/profile/profile-issues-filter.tsx\t7ce21a6 (commit)\n@@ -8,16 +8,18 @@\n // types\n import { EIssuesStoreType, IIssueDisplayFilterOptions, IIssueDisplayProperties, EIssueLayoutTypes } from \"@plane/types\";\n // components\n import { DisplayFiltersSelection, FiltersDropdown, LayoutSelection } from \"@/components/issues/issue-layouts/filters\";\n+import { WorkItemFiltersToggle } from \"@/components/work-item-filters/filters-toggle\";\n // hooks\n import { useIssues } from \"@/hooks/store/use-issues\";\n \n export const ProfileIssuesFilter = observer(() => {\n   // i18n\n   const { t } = useTranslation();\n   // router\n-  const { workspaceSlug, userId } = useParams();\n+  const { workspaceSlug, userId: routeUserId } = useParams();\n+  const userId = routeUserId ? routeUserId.toString() : undefined;\n   // store hook\n   const {\n     issuesFilter: { issueFilters, updateFilters },\n   } = useIssues(EIssuesStoreType.PROFILE);\n@@ -26,15 +28,9 @@\n \n   const handleLayoutChange = useCallback(\n     (layout: EIssueLayoutTypes) => {\n       if (!workspaceSlug || !userId) return;\n-      updateFilters(\n-        workspaceSlug.toString(),\n-        undefined,\n-        EIssueFilterType.DISPLAY_FILTERS,\n-        { layout: layout },\n-        userId.toString()\n-      );\n+      updateFilters(workspaceSlug.toString(), undefined, EIssueFilterType.DISPLAY_FILTERS, { layout: layout }, userId);\n     },\n     [workspaceSlug, updateFilters, userId]\n   );\n \n@@ -45,24 +41,18 @@\n         workspaceSlug.toString(),\n         undefined,\n         EIssueFilterType.DISPLAY_FILTERS,\n         updatedDisplayFilter,\n-        userId.toString()\n+        userId\n       );\n     },\n     [workspaceSlug, updateFilters, userId]\n   );\n \n   const handleDisplayProperties = useCallback(\n     (property: Partial<IIssueDisplayProperties>) => {\n       if (!workspaceSlug || !userId) return;\n-      updateFilters(\n-        workspaceSlug.toString(),\n-        undefined,\n-        EIssueFilterType.DISPLAY_PROPERTIES,\n-        property,\n-        userId.toString()\n-      );\n+      updateFilters(workspaceSlug.toString(), undefined, EIssueFilterType.DISPLAY_PROPERTIES, property, userId);\n     },\n     [workspaceSlug, updateFilters, userId]\n   );\n \n@@ -72,8 +62,9 @@\n         layouts={[EIssueLayoutTypes.LIST, EIssueLayoutTypes.KANBAN]}\n         onChange={(layout) => handleLayoutChange(layout)}\n         selectedLayout={activeLayout}\n       />\n+      {userId && <WorkItemFiltersToggle entityType={EIssuesStoreType.PROFILE} entityId={userId} />}\n       <FiltersDropdown title={t(\"common.display\")} placement=\"bottom-end\">\n         <DisplayFiltersSelection\n           layoutDisplayFiltersOptions={\n             activeLayout ? ISSUE_DISPLAY_FILTERS_BY_PAGE.profile_issues.layoutOptions[activeLayout] : undefined\n"
        },
        {
          "path": "apps/web/core/components/profile/profile-issues.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/profile/profile-issues.tsx\n===================================================================\n--- apps/web/core/components/profile/profile-issues.tsx\t992457e (parent)\n+++ apps/web/core/components/profile/profile-issues.tsx\t7ce21a6 (commit)\n@@ -9,9 +9,9 @@\n import { ProfileIssuesKanBanLayout } from \"@/components/issues/issue-layouts/kanban/roots/profile-issues-root\";\n import { ProfileIssuesListLayout } from \"@/components/issues/issue-layouts/list/roots/profile-issues-root\";\n import { IssuePeekOverview } from \"@/components/issues/peek-overview\";\n import { WorkspaceLevelWorkItemFiltersHOC } from \"@/components/work-item-filters/filters-hoc/workspace-level\";\n-import { WorkItemFiltersRow } from \"@/components/work-item-filters/work-item-filters-row\";\n+import { WorkItemFiltersRow } from \"@/components/work-item-filters/filters-row\";\n // hooks\n import { useIssues } from \"@/hooks/store/use-issues\";\n import { IssuesStoreContext } from \"@/hooks/use-issue-layout-store\";\n \n"
        },
        {
          "path": "apps/web/core/components/rich-filters/add-filters-button.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/rich-filters/add-filters-button.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/add-filters-button.tsx\t992457e (parent)\n+++ apps/web/core/components/rich-filters/add-filters-button.tsx\t7ce21a6 (commit)\n@@ -9,9 +9,9 @@\n import { cn, getOperatorForPayload } from \"@plane/utils\";\n \n export type TAddFilterButtonProps<P extends TFilterProperty, E extends TExternalFilter> = {\n   buttonConfig?: {\n-    label?: string;\n+    label: string | null;\n     variant?: TButtonVariant;\n     className?: string;\n     defaultOpen?: boolean;\n     iconConfig?: {\n@@ -27,9 +27,9 @@\n export const AddFilterButton = observer(\n   <P extends TFilterProperty, E extends TExternalFilter>(props: TAddFilterButtonProps<P, E>) => {\n     const { filter, buttonConfig, onFilterSelect } = props;\n     const {\n-      label = \"Filters\",\n+      label,\n       variant = \"link-neutral\",\n       className,\n       defaultOpen = false,\n       iconConfig = { shouldShowIcon: true },\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filters-row.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/rich-filters/filters-row.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/filters-row.tsx\t992457e (parent)\n+++ apps/web/core/components/rich-filters/filters-row.tsx\t7ce21a6 (commit)\n@@ -1,22 +1,22 @@\n import React, { useCallback, useState } from \"react\";\n import { observer } from \"mobx-react\";\n+import { ListFilterPlus } from \"lucide-react\";\n import { Transition } from \"@headlessui/react\";\n // plane imports\n import { Button } from \"@plane/propel/button\";\n import { IFilterInstance } from \"@plane/shared-state\";\n import { TExternalFilter, TFilterProperty } from \"@plane/types\";\n-import { EHeaderVariant, Header } from \"@plane/ui\";\n+import { cn, EHeaderVariant, Header } from \"@plane/ui\";\n // local imports\n import { AddFilterButton, TAddFilterButtonProps } from \"./add-filters-button\";\n import { FilterItem } from \"./filter-item\";\n \n export type TFiltersRowProps<K extends TFilterProperty, E extends TExternalFilter> = {\n   buttonConfig?: TAddFilterButtonProps<K, E>[\"buttonConfig\"];\n   disabledAllOperations?: boolean;\n   filter: IFilterInstance<K, E>;\n-  variant?: \"default\" | \"header\";\n-  visible?: boolean;\n+  variant?: \"modal\" | \"header\";\n   trackerElements?: {\n     clearFilter?: string;\n     saveView?: string;\n     updateView?: string;\n@@ -24,36 +24,52 @@\n };\n \n export const FiltersRow = observer(\n   <K extends TFilterProperty, E extends TExternalFilter>(props: TFiltersRowProps<K, E>) => {\n-    const {\n-      buttonConfig,\n-      disabledAllOperations = false,\n-      filter,\n-      variant = \"header\",\n-      visible = true,\n-      trackerElements,\n-    } = props;\n+    const { buttonConfig, disabledAllOperations = false, filter, variant = \"header\", trackerElements } = props;\n     // states\n     const [isUpdating, setIsUpdating] = useState(false);\n+    // derived values\n+    const hasAnyConditions = filter.allConditionsForDisplay.length > 0;\n+    const hasAvailableOperations =\n+      !disabledAllOperations && (filter.canClearFilters || filter.canSaveView || filter.canUpdateView);\n \n+    const headerButtonConfig: Partial<TAddFilterButtonProps<K, E>[\"buttonConfig\"]> = {\n+      variant: \"link-neutral\",\n+      className: \"bg-custom-background-90\",\n+      label: null,\n+    };\n+\n+    const modalButtonConfig: Partial<TAddFilterButtonProps<K, E>[\"buttonConfig\"]> = {\n+      variant: \"neutral-primary\",\n+      className: \"bg-custom-background-100\",\n+      label: !hasAnyConditions ? \"Filters\" : null,\n+    };\n+\n     const handleUpdate = useCallback(async () => {\n       setIsUpdating(true);\n-      await filter.updateView();\n-      setTimeout(() => setIsUpdating(false), 240); // To avoid flickering\n+      try {\n+        await filter.updateView();\n+      } finally {\n+        setTimeout(() => setIsUpdating(false), 240); // To avoid flickering\n+      }\n     }, [filter]);\n \n-    if (!visible) return null;\n-\n     const leftContent = (\n       <>\n         {filter.allConditionsForDisplay.map((condition) => (\n           <FilterItem key={condition.id} filter={filter} condition={condition} isDisabled={disabledAllOperations} />\n         ))}\n         <AddFilterButton\n           filter={filter}\n           buttonConfig={{\n-            variant: \"neutral-primary\",\n+            label: null,\n+            ...(variant === \"modal\" ? modalButtonConfig : headerButtonConfig),\n+            iconConfig: {\n+              shouldShowIcon: true,\n+              iconComponent: ListFilterPlus,\n+            },\n+            defaultOpen: buttonConfig?.defaultOpen ?? !hasAnyConditions,\n             ...buttonConfig,\n             isDisabled: disabledAllOperations,\n           }}\n         />\n@@ -99,25 +115,46 @@\n         </ElementTransition>\n       </>\n     );\n \n-    if (variant === \"default\") {\n-      return (\n-        <div className=\"w-full flex flex-wrap items-center gap-2\">\n-          {leftContent}\n+    const mainContent = (\n+      <div className=\"w-full flex items-start gap-2\">\n+        <div className=\"w-full flex flex-wrap items-center gap-2\">{leftContent}</div>\n+        <div\n+          className={cn(\"flex items-center gap-2 border-l border-custom-border-200 pl-4\", {\n+            \"border-l-transparent pl-0\": !hasAvailableOperations,\n+          })}\n+        >\n           {rightContent}\n         </div>\n-      );\n-    }\n+      </div>\n+    );\n \n-    return (\n-      <Header variant={EHeaderVariant.TERNARY}>\n-        <div className=\"w-full flex items-start gap-2\">\n-          <div className=\"w-full flex flex-wrap items-center gap-2\">{leftContent}</div>\n-          <div className=\"flex items-center gap-2\">{rightContent}</div>\n-        </div>\n+    const ModalVariant = (\n+      <div className=\"w-full flex flex-wrap items-center gap-2 min-h-11 bg-custom-background-90 rounded-lg p-2\">\n+        {mainContent}\n+      </div>\n+    );\n+\n+    const HeaderVariant = (\n+      <Header variant={EHeaderVariant.TERNARY} className=\"min-h-11\">\n+        {mainContent}\n       </Header>\n     );\n+\n+    return (\n+      <Transition\n+        show={filter.isVisible}\n+        enter=\"transition-all duration-150 ease-out\"\n+        enterFrom=\"opacity-0 -translate-y-1\"\n+        enterTo=\"opacity-100 translate-y-0\"\n+        leave=\"transition-all duration-100 ease-in\"\n+        leaveFrom=\"opacity-100 translate-y-0\"\n+        leaveTo=\"opacity-0 -translate-y-1\"\n+      >\n+        {variant === \"modal\" ? ModalVariant : HeaderVariant}\n+      </Transition>\n+    );\n   }\n );\n \n const COMMON_OPERATION_BUTTON_CLASSNAME = \"py-1\";\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filters-toggle.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/rich-filters/filters-toggle.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/filters-toggle.tsx\t992457e (parent)\n+++ apps/web/core/components/rich-filters/filters-toggle.tsx\t7ce21a6 (commit)\n@@ -0,0 +1,76 @@\n+import { observer } from \"mobx-react\";\n+import { ListFilter } from \"lucide-react\";\n+// plane imports\n+import { IFilterInstance } from \"@plane/shared-state\";\n+import { TExternalFilter, TFilterProperty } from \"@plane/types\";\n+import { cn } from \"@plane/ui\";\n+// components\n+import { AddFilterButton } from \"@/components/rich-filters/add-filters-button\";\n+\n+type TFiltersToggleProps<P extends TFilterProperty, E extends TExternalFilter> = {\n+  filter: IFilterInstance<P, E> | undefined;\n+};\n+\n+const COMMON_CLASSNAME =\n+  \"grid place-items-center h-7 w-full py-0.5 px-2 rounded border transition-all duration-200 cursor-pointer\";\n+\n+export const FiltersToggle = observer(\n+  <P extends TFilterProperty, E extends TExternalFilter>(props: TFiltersToggleProps<P, E>) => {\n+    const { filter } = props;\n+    // derived values\n+    const hasAnyConditions = (filter?.allConditionsForDisplay.length ?? 0) > 0;\n+    const isFilterRowVisible = filter?.isVisible ?? false;\n+    const hasUpdates = filter?.canUpdateView === true && filter?.hasChanges === true;\n+    const showFilterRowChangesPill = hasUpdates || hasAnyConditions === true;\n+    const showAddFilterButton = !hasAnyConditions && !isFilterRowVisible && !hasUpdates;\n+\n+    const handleToggleFilter = () => {\n+      if (!filter) {\n+        console.error(\"Filters toggle error - filter instance not available\");\n+        return;\n+      }\n+      filter.toggleVisibility();\n+    };\n+\n+    // Show the add filter button when there are no active conditions, the filter row is hidden, and no unsaved changes exist\n+    if (filter && showAddFilterButton) {\n+      return (\n+        <AddFilterButton\n+          filter={filter}\n+          buttonConfig={{\n+            variant: \"neutral-primary\",\n+            className: COMMON_CLASSNAME,\n+            label: null,\n+          }}\n+          onFilterSelect={() => filter?.toggleVisibility(true)}\n+        />\n+      );\n+    }\n+\n+    return (\n+      <div\n+        className={cn(COMMON_CLASSNAME, {\n+          \"border-transparent bg-custom-primary-100/10 hover:bg-custom-primary-100/20\": isFilterRowVisible,\n+          \"border-custom-border-200 hover:bg-custom-background-90\": !isFilterRowVisible,\n+        })}\n+        onClick={handleToggleFilter}\n+      >\n+        <div className=\"relative\">\n+          <ListFilter\n+            className={cn(\"size-4\", {\n+              \"text-custom-primary-100\": isFilterRowVisible,\n+              \"text-custom-text-300\": !isFilterRowVisible,\n+            })}\n+          />\n+          {showFilterRowChangesPill && (\n+            <span\n+              className={cn(\"p-[3px] rounded-full bg-custom-primary-100 absolute top-[0.2px] -right-[0.4px]\", {\n+                \"bg-custom-text-300\": hasAnyConditions === false && filter?.hasChanges === true, // If there are no conditions and there are changes, show the pill in the background color\n+              })}\n+            />\n+          )}\n+        </div>\n+      </div>\n+    );\n+  }\n+);\n"
        },
        {
          "path": "apps/web/core/components/views/form.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/views/form.tsx\n===================================================================\n--- apps/web/core/components/views/form.tsx\t992457e (parent)\n+++ apps/web/core/components/views/form.tsx\t7ce21a6 (commit)\n@@ -22,9 +22,9 @@\n import { getComputedDisplayFilters, getComputedDisplayProperties, getTabIndex } from \"@plane/utils\";\n // components\n import { Logo } from \"@/components/common/logo\";\n import { DisplayFiltersSelection, FiltersDropdown } from \"@/components/issues/issue-layouts/filters\";\n-import { WorkItemFiltersRow } from \"@/components/work-item-filters/work-item-filters-row\";\n+import { WorkItemFiltersRow } from \"@/components/work-item-filters/filters-row\";\n // hooks\n import { useProject } from \"@/hooks/store/use-project\";\n import { usePlatformOS } from \"@/hooks/use-platform-os\";\n // plane web imports\n@@ -264,13 +264,14 @@\n                   initialWorkItemFilters={workItemFilters}\n                   isTemporary\n                   updateFilters={(updateFilters) => onFiltersChange(updateFilters)}\n                   projectId={projectId}\n+                  showOnMount\n                   workspaceSlug={workspaceSlug}\n                 >\n                   {({ filter: projectViewWorkItemsFilter }) =>\n                     projectViewWorkItemsFilter && (\n-                      <WorkItemFiltersRow filter={projectViewWorkItemsFilter} variant=\"default\" />\n+                      <WorkItemFiltersRow filter={projectViewWorkItemsFilter} variant=\"modal\" />\n                     )\n                   }\n                 </ProjectLevelWorkItemFiltersHOC>\n               )}\n"
        },
        {
          "path": "apps/web/core/components/work-item-filters/filters-hoc/base.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/work-item-filters/filters-hoc/base.tsx\n===================================================================\n--- apps/web/core/components/work-item-filters/filters-hoc/base.tsx\t992457e (parent)\n+++ apps/web/core/components/work-item-filters/filters-hoc/base.tsx\t7ce21a6 (commit)\n@@ -2,10 +2,10 @@\n import { observer } from \"mobx-react\";\n import { v4 as uuidv4 } from \"uuid\";\n // plane imports\n import { TSaveViewOptions, TUpdateViewOptions } from \"@plane/constants\";\n-import { IFilterInstance } from \"@plane/shared-state\";\n-import { IIssueFilters, TWorkItemFilterExpression, TWorkItemFilterProperty } from \"@plane/types\";\n+import { IWorkItemFilterInstance } from \"@plane/shared-state\";\n+import { IIssueFilters, TWorkItemFilterExpression } from \"@plane/types\";\n // store hooks\n import { useWorkItemFilters } from \"@/hooks/store/work-item-filters/use-work-item-filters\";\n // plane web imports\n import {\n@@ -38,11 +38,9 @@\n \n type TWorkItemFilterProps = TSharedWorkItemFiltersProps &\n   TAdditionalWorkItemFiltersProps & {\n     initialWorkItemFilters: IIssueFilters;\n-    children:\n-      | React.ReactNode\n-      | ((props: { filter: IFilterInstance<TWorkItemFilterProperty, TWorkItemFilterExpression> }) => React.ReactNode);\n+    children: React.ReactNode | ((props: { filter: IWorkItemFilterInstance }) => React.ReactNode);\n   };\n \n const WorkItemFilterRoot = observer((props: TWorkItemFilterProps) => {\n   const {\n@@ -54,8 +52,9 @@\n     isTemporary,\n     saveViewOptions,\n     updateFilters,\n     updateViewOptions,\n+    showOnMount,\n     ...entityConfigProps\n   } = props;\n   // store hooks\n   const { getOrCreateFilter, deleteFilter } = useWorkItemFilters();\n@@ -83,8 +82,9 @@\n     expressionOptions: {\n       saveViewOptions,\n       updateViewOptions,\n     },\n+    showOnMount,\n   });\n \n   // delete filter instance when component unmounts\n   useEffect(\n"
        },
        {
          "path": "apps/web/core/components/work-item-filters/filters-hoc/shared.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/components/work-item-filters/filters-hoc/shared.ts\n===================================================================\n--- apps/web/core/components/work-item-filters/filters-hoc/shared.ts\t992457e (parent)\n+++ apps/web/core/components/work-item-filters/filters-hoc/shared.ts\t7ce21a6 (commit)\n@@ -1,22 +1,19 @@\n // plane imports\n import { TSaveViewOptions, TUpdateViewOptions } from \"@plane/constants\";\n-import { IFilterInstance } from \"@plane/shared-state\";\n+import { IWorkItemFilterInstance } from \"@plane/shared-state\";\n import { EIssuesStoreType, IIssueFilters, TWorkItemFilterExpression, TWorkItemFilterProperty } from \"@plane/types\";\n \n export type TSharedWorkItemFiltersProps = {\n   entityType: EIssuesStoreType; // entity type (project, cycle, workspace, teamspace, etc)\n   filtersToShowByLayout: TWorkItemFilterProperty[];\n   updateFilters: (updatedFilters: TWorkItemFilterExpression) => void;\n   isTemporary?: boolean;\n+  showOnMount?: boolean;\n } & ({ isTemporary: true; entityId?: string } | { isTemporary?: false; entityId: string }); // entity id (project_id, cycle_id, workspace_id, etc)\n \n export type TSharedWorkItemFiltersHOCProps = TSharedWorkItemFiltersProps & {\n-  children:\n-    | React.ReactNode\n-    | ((props: {\n-        filter: IFilterInstance<TWorkItemFilterProperty, TWorkItemFilterExpression> | undefined;\n-      }) => React.ReactNode);\n+  children: React.ReactNode | ((props: { filter: IWorkItemFilterInstance | undefined }) => React.ReactNode);\n   initialWorkItemFilters: IIssueFilters | undefined;\n };\n \n export type TEnableSaveViewProps = {\n"
        },
        {
          "path": "apps/web/core/components/work-item-filters/filters-row.tsx",
          "status": "renamed",
          "oldPath": "apps/web/core/components/work-item-filters/work-item-filters-row.tsx",
          "diff": "===================================================================\n--- apps/web/core/components/work-item-filters/work-item-filters-row.tsx\t992457e (parent)\n+++ apps/web/core/components/work-item-filters/filters-row.tsx\t7ce21a6 (commit)\n@@ -1,9 +1,12 @@\n import { observer } from \"mobx-react\";\n // plane imports\n+import { IWorkItemFilterInstance } from \"@plane/shared-state\";\n import { TWorkItemFilterExpression, TWorkItemFilterProperty } from \"@plane/types\";\n // components\n import { FiltersRow, TFiltersRowProps } from \"@/components/rich-filters/filters-row\";\n \n-type TWorkItemFiltersRowProps = TFiltersRowProps<TWorkItemFilterProperty, TWorkItemFilterExpression>;\n+type TWorkItemFiltersRowProps = TFiltersRowProps<TWorkItemFilterProperty, TWorkItemFilterExpression> & {\n+  filter: IWorkItemFilterInstance;\n+};\n \n export const WorkItemFiltersRow = observer((props: TWorkItemFiltersRowProps) => <FiltersRow {...props} />);\n"
        },
        {
          "path": "apps/web/core/components/work-item-filters/filters-toggle.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/work-item-filters/filters-toggle.tsx\n===================================================================\n--- apps/web/core/components/work-item-filters/filters-toggle.tsx\t992457e (parent)\n+++ apps/web/core/components/work-item-filters/filters-toggle.tsx\t7ce21a6 (commit)\n@@ -0,0 +1,22 @@\n+import { observer } from \"mobx-react\";\n+// plane imports\n+import { EIssuesStoreType } from \"@plane/types\";\n+// components\n+import { FiltersToggle } from \"@/components/rich-filters/filters-toggle\";\n+// hooks\n+import { useWorkItemFilters } from \"@/hooks/store/work-item-filters/use-work-item-filters\";\n+\n+type TWorkItemFiltersToggleProps = {\n+  entityType: EIssuesStoreType;\n+  entityId: string;\n+};\n+\n+export const WorkItemFiltersToggle = observer((props: TWorkItemFiltersToggleProps) => {\n+  const { entityType, entityId } = props;\n+  // store hooks\n+  const { getFilter } = useWorkItemFilters();\n+  // derived values\n+  const filter = getFilter(entityType, entityId);\n+\n+  return <FiltersToggle filter={filter} />;\n+});\n"
        },
        {
          "path": "apps/web/core/components/workspace/views/form.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/workspace/views/form.tsx\n===================================================================\n--- apps/web/core/components/workspace/views/form.tsx\t992457e (parent)\n+++ apps/web/core/components/workspace/views/form.tsx\t7ce21a6 (commit)\n@@ -20,9 +20,9 @@\n // components\n import { DisplayFiltersSelection, FiltersDropdown } from \"@/components/issues/issue-layouts/filters\";\n import { WorkspaceLevelWorkItemFiltersHOC } from \"@/components/work-item-filters/filters-hoc/workspace-level\";\n // plane web imports\n-import { WorkItemFiltersRow } from \"@/components/work-item-filters/work-item-filters-row\";\n+import { WorkItemFiltersRow } from \"@/components/work-item-filters/filters-row\";\n import { AccessController } from \"@/plane-web/components/views/access-controller\";\n \n type Props = {\n   handleFormSubmit: (values: Partial<IWorkspaceView>) => Promise<void>;\n@@ -175,13 +175,14 @@\n                   filtersToShowByLayout={ISSUE_DISPLAY_FILTERS_BY_PAGE.my_issues.filters}\n                   initialWorkItemFilters={workItemFilters}\n                   isTemporary\n                   updateFilters={(updateFilters) => onFiltersChange(updateFilters)}\n+                  showOnMount\n                   workspaceSlug={workspaceSlug}\n                 >\n                   {({ filter: workspaceViewWorkItemsFilter }) =>\n                     workspaceViewWorkItemsFilter && (\n-                      <WorkItemFiltersRow filter={workspaceViewWorkItemsFilter} variant=\"default\" />\n+                      <WorkItemFiltersRow filter={workspaceViewWorkItemsFilter} variant=\"modal\" />\n                     )\n                   }\n                 </WorkspaceLevelWorkItemFiltersHOC>\n               )}\n"
        },
        {
          "path": "apps/web/core/hooks/store/work-item-filters/use-work-item-filter-instance.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/hooks/store/work-item-filters/use-work-item-filter-instance.ts\n===================================================================\n--- apps/web/core/hooks/store/work-item-filters/use-work-item-filter-instance.ts\t992457e (parent)\n+++ apps/web/core/hooks/store/work-item-filters/use-work-item-filter-instance.ts\t7ce21a6 (commit)\n@@ -1,13 +1,13 @@\n // plane imports\n-import { IFilterInstance } from \"@plane/shared-state\";\n-import { EIssuesStoreType, TWorkItemFilterExpression, TWorkItemFilterProperty } from \"@plane/types\";\n+import { IWorkItemFilterInstance } from \"@plane/shared-state\";\n+import { EIssuesStoreType } from \"@plane/types\";\n // local imports\n import { useWorkItemFilters } from \"./use-work-item-filters\";\n \n export const useWorkItemFilterInstance = (\n   entityType: EIssuesStoreType,\n   entityId: string\n-): IFilterInstance<TWorkItemFilterProperty, TWorkItemFilterExpression> | undefined => {\n+): IWorkItemFilterInstance | undefined => {\n   const { getFilter } = useWorkItemFilters();\n   return getFilter(entityType, entityId);\n };\n"
        },
        {
          "path": "packages/constants/src/rich-filters/option.ts",
          "status": "modified",
          "diff": "Index: packages/constants/src/rich-filters/option.ts\n===================================================================\n--- packages/constants/src/rich-filters/option.ts\t992457e (parent)\n+++ packages/constants/src/rich-filters/option.ts\t7ce21a6 (commit)\n@@ -52,12 +52,32 @@\n  */\n export const DEFAULT_FILTER_EXPRESSION_OPTIONS: TExpressionOptions<TExternalFilter> = {};\n \n /**\n+ * Auto visibility options.\n+ */\n+export type TAutoVisibilityOptions =\n+  | {\n+      autoSetVisibility: true;\n+    }\n+  | {\n+      autoSetVisibility: false;\n+      isVisibleOnMount: boolean;\n+    };\n+\n+/**\n+ * Default filter visibility options.\n+ */\n+export const DEFAULT_FILTER_VISIBILITY_OPTIONS: TAutoVisibilityOptions = {\n+  autoSetVisibility: true,\n+};\n+\n+/**\n  * Filter options.\n  * - expression: Filter expression options.\n  * - config: Filter config options.\n  */\n export type TFilterOptions<E extends TExternalFilter> = {\n   expression: Partial<TExpressionOptions<E>>;\n   config: Partial<TConfigOptions>;\n+  visibility: TAutoVisibilityOptions;\n };\n"
        },
        {
          "path": "packages/shared-state/src/store/rich-filters/config-manager.ts",
          "status": "modified",
          "diff": "Index: packages/shared-state/src/store/rich-filters/config-manager.ts\n===================================================================\n--- packages/shared-state/src/store/rich-filters/config-manager.ts\t992457e (parent)\n+++ packages/shared-state/src/store/rich-filters/config-manager.ts\t7ce21a6 (commit)\n@@ -57,9 +57,9 @@\n   // observables\n   filterConfigs: IFilterConfigManager<P>[\"filterConfigs\"];\n   configOptions: IFilterConfigManager<P>[\"configOptions\"];\n   // parent filter instance\n-  _filterInstance: IFilterInstance<P, E>;\n+  private _filterInstance: IFilterInstance<P, E>;\n \n   /**\n    * Creates a new FilterConfigManager instance.\n    *\n"
        },
        {
          "path": "packages/shared-state/src/store/rich-filters/filter-helpers.ts",
          "status": "modified",
          "diff": "Index: packages/shared-state/src/store/rich-filters/filter-helpers.ts\n===================================================================\n--- packages/shared-state/src/store/rich-filters/filter-helpers.ts\t992457e (parent)\n+++ packages/shared-state/src/store/rich-filters/filter-helpers.ts\t7ce21a6 (commit)\n@@ -1,8 +1,8 @@\n import { cloneDeep } from \"lodash-es\";\n-import { toJS } from \"mobx\";\n+import { action, makeObservable, observable, toJS } from \"mobx\";\n // plane imports\n-import { DEFAULT_FILTER_EXPRESSION_OPTIONS, TExpressionOptions } from \"@plane/constants\";\n+import { DEFAULT_FILTER_EXPRESSION_OPTIONS, TAutoVisibilityOptions, TExpressionOptions } from \"@plane/constants\";\n import {\n   IFilterAdapter,\n   LOGICAL_OPERATOR,\n   TSupportedOperators,\n@@ -13,20 +13,30 @@\n   TLogicalOperator,\n   TFilterConditionPayload,\n } from \"@plane/types\";\n import { addAndCondition, createConditionNode, updateNodeInExpression } from \"@plane/utils\";\n+// local imports\n+import { type IFilterInstance } from \"./filter\";\n \n+type TFilterInstanceHelperParams<P extends TFilterProperty, E extends TExternalFilter> = {\n+  adapter: IFilterAdapter<P, E>;\n+};\n+\n /**\n  * Interface for filter instance helper utilities.\n  * Provides comprehensive methods for filter expression manipulation, node operations,\n  * operator utilities, and expression restructuring.\n  * @template P - The filter property type extending TFilterProperty\n  * @template E - The external filter type extending TExternalFilter\n  */\n export interface IFilterInstanceHelper<P extends TFilterProperty, E extends TExternalFilter> {\n+  isVisible: boolean;\n   // initialization\n   initializeExpression: (initialExpression?: E) => TFilterExpression<P> | null;\n   initializeExpressionOptions: (expressionOptions?: Partial<TExpressionOptions<E>>) => TExpressionOptions<E>;\n+  // visibility\n+  setInitialVisibility: (visibilityOption: TAutoVisibilityOptions) => void;\n+  toggleVisibility: (isVisible?: boolean) => void;\n   // condition operations\n   addConditionToExpression: <V extends TFilterValue>(\n     expression: TFilterExpression<P> | null,\n     groupOperator: TLogicalOperator,\n@@ -53,17 +63,30 @@\n  */\n export class FilterInstanceHelper<P extends TFilterProperty, E extends TExternalFilter>\n   implements IFilterInstanceHelper<P, E>\n {\n+  // parent filter instance\n+  private _filterInstance: IFilterInstance<P, E>;\n+  // adapter\n   private adapter: IFilterAdapter<P, E>;\n+  // visibility\n+  isVisible: boolean;\n \n   /**\n    * Creates a new FilterInstanceHelper instance.\n    *\n    * @param adapter - The filter adapter for converting between internal and external formats\n    */\n-  constructor(adapter: IFilterAdapter<P, E>) {\n-    this.adapter = adapter;\n+  constructor(filterInstance: IFilterInstance<P, E>, params: TFilterInstanceHelperParams<P, E>) {\n+    this._filterInstance = filterInstance;\n+    this.adapter = params.adapter;\n+    this.isVisible = false;\n+\n+    makeObservable(this, {\n+      isVisible: observable,\n+      setInitialVisibility: action,\n+      toggleVisibility: action,\n+    });\n   }\n \n   // ------------ initialization ------------\n \n@@ -86,8 +109,43 @@\n     ...DEFAULT_FILTER_EXPRESSION_OPTIONS,\n     ...expressionOptions,\n   });\n \n+  /**\n+   * Sets the initial visibility state for the filter based on options and active filters.\n+   * @param visibilityOption - The visibility options for the filter instance.\n+   * @returns The initial visibility state\n+   */\n+  setInitialVisibility: IFilterInstanceHelper<P, E>[\"setInitialVisibility\"] = action((visibilityOption) => {\n+    // If explicit initial visibility is provided, use it\n+    if (visibilityOption.autoSetVisibility === false) {\n+      this.isVisible = visibilityOption.isVisibleOnMount;\n+      return;\n+    }\n+\n+    // If filter has active filters, make it visible\n+    if (this._filterInstance.hasActiveFilters) {\n+      this.isVisible = true;\n+      return;\n+    }\n+\n+    // Default to hidden if no active filters\n+    this.isVisible = false;\n+    return;\n+  });\n+\n+  /**\n+   * Toggles the visibility of the filter.\n+   * @param isVisible - The visibility to set.\n+   */\n+  toggleVisibility: IFilterInstanceHelper<P, E>[\"toggleVisibility\"] = action((isVisible) => {\n+    if (isVisible !== undefined) {\n+      this.isVisible = isVisible;\n+      return;\n+    }\n+    this.isVisible = !this.isVisible;\n+  });\n+\n   // ------------ condition operations ------------\n \n   /**\n    * Adds a condition to the filter expression based on the logical operator.\n"
        },
        {
          "path": "packages/shared-state/src/store/rich-filters/filter.ts",
          "status": "modified",
          "diff": "Index: packages/shared-state/src/store/rich-filters/filter.ts\n===================================================================\n--- packages/shared-state/src/store/rich-filters/filter.ts\t992457e (parent)\n+++ packages/shared-state/src/store/rich-filters/filter.ts\t7ce21a6 (commit)\n@@ -3,8 +3,9 @@\n import { computedFn } from \"mobx-utils\";\n import { v4 as uuidv4 } from \"uuid\";\n // plane imports\n import {\n+  DEFAULT_FILTER_VISIBILITY_OPTIONS,\n   TClearFilterOptions,\n   TExpressionOptions,\n   TFilterOptions,\n   TSaveViewOptions,\n@@ -70,8 +71,9 @@\n   onExpressionChange?: (expression: E) => void;\n   // computed\n   hasActiveFilters: boolean;\n   hasChanges: boolean;\n+  isVisible: boolean;\n   allConditions: TFilterConditionNode<P, TFilterValue>[];\n   allConditionsForDisplay: TFilterConditionNodeForDisplay<P, TFilterValue>[];\n   // computed option helpers\n   clearFilterOptions: TClearFilterOptions | undefined;\n@@ -80,8 +82,10 @@\n   // computed permissions\n   canClearFilters: boolean;\n   canSaveView: boolean;\n   canUpdateView: boolean;\n+  // visibility\n+  toggleVisibility: (isVisible?: boolean) => void;\n   // filter expression actions\n   resetExpression: (externalExpression: E, shouldResetInitialExpression?: boolean) => void;\n   // filter condition\n   findConditionsByPropertyAndOperator: (\n@@ -107,9 +111,9 @@\n   // expression options actions\n   updateExpressionOptions: (newOptions: Partial<TExpressionOptions<E>>) => void;\n }\n \n-export type TFilterParams<P extends TFilterProperty, E extends TExternalFilter> = {\n+type TFilterParams<P extends TFilterProperty, E extends TExternalFilter> = {\n   adapter: IFilterAdapter<P, E>;\n   options?: Partial<TFilterOptions<E>>;\n   initialExpression?: E;\n   onExpressionChange?: (expression: E) => void;\n@@ -130,9 +134,11 @@\n \n   constructor(params: TFilterParams<P, E>) {\n     this.id = uuidv4();\n     this.adapter = params.adapter;\n-    this.helper = new FilterInstanceHelper<P, E>(this.adapter);\n+    this.helper = new FilterInstanceHelper<P, E>(this, {\n+      adapter: this.adapter,\n+    });\n     this.configManager = new FilterConfigManager<P, E>(this, {\n       options: params.options?.config,\n     });\n     // initialize expression\n@@ -140,8 +146,9 @@\n     this.initialFilterExpression = cloneDeep(initialExpression);\n     this.expression = cloneDeep(initialExpression);\n     this.expressionOptions = this.helper.initializeExpressionOptions(params.options?.expression);\n     this.onExpressionChange = params.onExpressionChange;\n+    this.helper.setInitialVisibility(params.options?.visibility ?? DEFAULT_FILTER_VISIBILITY_OPTIONS);\n \n     makeObservable(this, {\n       // observables\n       id: observable,\n@@ -152,8 +159,9 @@\n       configManager: observable,\n       // computed\n       hasActiveFilters: computed,\n       hasChanges: computed,\n+      isVisible: computed,\n       allConditions: computed,\n       allConditionsForDisplay: computed,\n       // computed option helpers\n       clearFilterOptions: computed,\n@@ -201,8 +209,16 @@\n     return !deepCompareFilterExpressions(this.initialFilterExpression, this.expression);\n   }\n \n   /**\n+   * Returns the visibility of the filter instance.\n+   * @returns The visibility of the filter instance.\n+   */\n+  get isVisible(): IFilterInstance<P, E>[\"isVisible\"] {\n+    return this.helper.isVisible;\n+  }\n+\n+  /**\n    * Returns all conditions from the filter expression.\n    * @returns An array of filter conditions.\n    */\n   get allConditions(): IFilterInstance<P, E>[\"allConditions\"] {\n@@ -279,8 +295,16 @@\n \n   // ------------ actions ------------\n \n   /**\n+   * Toggles the visibility of the filter instance.\n+   * @param isVisible - The visibility to set.\n+   */\n+  toggleVisibility: IFilterInstance<P, E>[\"toggleVisibility\"] = action((isVisible) => {\n+    this.helper.toggleVisibility(isVisible);\n+  });\n+\n+  /**\n    * Resets the filter expression to the initial expression.\n    * @param externalExpression - The external expression to reset to.\n    */\n   resetExpression: IFilterInstance<P, E>[\"resetExpression\"] = action(\n"
        },
        {
          "path": "packages/shared-state/src/store/work-item-filters/filter.store.ts",
          "status": "modified",
          "diff": "Index: packages/shared-state/src/store/work-item-filters/filter.store.ts\n===================================================================\n--- packages/shared-state/src/store/work-item-filters/filter.store.ts\t992457e (parent)\n+++ packages/shared-state/src/store/work-item-filters/filter.store.ts\t7ce21a6 (commit)\n@@ -5,30 +5,25 @@\n import { EIssuesStoreType, LOGICAL_OPERATOR, TWorkItemFilterExpression, TWorkItemFilterProperty } from \"@plane/types\";\n import { getOperatorForPayload } from \"@plane/utils\";\n // local imports\n import { buildWorkItemFilterExpressionFromConditions, TWorkItemFilterCondition } from \"../../utils\";\n-import { FilterInstance, IFilterInstance } from \"../rich-filters/filter\";\n+import { FilterInstance } from \"../rich-filters/filter\";\n import { workItemFiltersAdapter } from \"./adapter\";\n+import { IWorkItemFilterInstance, TWorkItemFilterKey } from \"./shared\";\n \n type TGetOrCreateFilterParams = {\n+  showOnMount?: boolean;\n   entityId: string;\n   entityType: EIssuesStoreType;\n   expressionOptions?: TExpressionOptions<TWorkItemFilterExpression>;\n   initialExpression?: TWorkItemFilterExpression;\n   onExpressionChange?: (expression: TWorkItemFilterExpression) => void;\n };\n \n-type TWorkItemFilterKey = `${EIssuesStoreType}-${string}`;\n-\n export interface IWorkItemFilterStore {\n-  filters: Map<TWorkItemFilterKey, IFilterInstance<TWorkItemFilterProperty, TWorkItemFilterExpression>>; // key is the entity id (project, cycle, workspace, teamspace, etc)\n-  getFilter: (\n-    entityType: EIssuesStoreType,\n-    entityId: string\n-  ) => IFilterInstance<TWorkItemFilterProperty, TWorkItemFilterExpression> | undefined;\n-  getOrCreateFilter: (\n-    params: TGetOrCreateFilterParams\n-  ) => IFilterInstance<TWorkItemFilterProperty, TWorkItemFilterExpression>;\n+  filters: Map<TWorkItemFilterKey, IWorkItemFilterInstance>; // key is the entity id (project, cycle, workspace, teamspace, etc)\n+  getFilter: (entityType: EIssuesStoreType, entityId: string) => IWorkItemFilterInstance | undefined;\n+  getOrCreateFilter: (params: TGetOrCreateFilterParams) => IWorkItemFilterInstance;\n   resetExpression: (entityType: EIssuesStoreType, entityId: string, expression: TWorkItemFilterExpression) => void;\n   updateFilterExpressionFromConditions: (\n     entityType: EIssuesStoreType,\n     entityId: string,\n@@ -47,9 +42,9 @@\n   // observable\n   filters: IWorkItemFilterStore[\"filters\"];\n \n   constructor() {\n-    this.filters = new Map<TWorkItemFilterKey, IFilterInstance<TWorkItemFilterProperty, TWorkItemFilterExpression>>();\n+    this.filters = new Map<TWorkItemFilterKey, IWorkItemFilterInstance>();\n     makeObservable(this, {\n       filters: observable,\n       getOrCreateFilter: action,\n       resetExpression: action,\n@@ -86,14 +81,19 @@\n       // Update callback if provided\n       if (params.onExpressionChange) {\n         existingFilter.onExpressionChange = params.onExpressionChange;\n       }\n+      // Update visibility if provided\n+      if (params.showOnMount !== undefined) {\n+        existingFilter.toggleVisibility(params.showOnMount);\n+      }\n       return existingFilter;\n     }\n \n     // create new filter instance\n     const newFilter = this._initializeFilterInstance(params);\n-    this.filters.set(this._getFilterKey(params.entityType, params.entityId), newFilter);\n+    const filterKey = this._getFilterKey(params.entityType, params.entityId);\n+    this.filters.set(filterKey, newFilter);\n \n     return newFilter;\n   });\n \n@@ -209,7 +209,10 @@\n       initialExpression: params.initialExpression,\n       onExpressionChange: params.onExpressionChange,\n       options: {\n         expression: params.expressionOptions,\n+        visibility: params.showOnMount\n+          ? { autoSetVisibility: false, isVisibleOnMount: true }\n+          : { autoSetVisibility: true },\n       },\n     });\n }\n"
        },
        {
          "path": "packages/shared-state/src/store/work-item-filters/index.ts",
          "status": "modified",
          "diff": "Index: packages/shared-state/src/store/work-item-filters/index.ts\n===================================================================\n--- packages/shared-state/src/store/work-item-filters/index.ts\t992457e (parent)\n+++ packages/shared-state/src/store/work-item-filters/index.ts\t7ce21a6 (commit)\n@@ -1,2 +1,3 @@\n export * from \"./adapter\";\n export * from \"./filter.store\";\n+export * from \"./shared\";\n"
        },
        {
          "path": "packages/shared-state/src/store/work-item-filters/shared.ts",
          "status": "added",
          "diff": "Index: packages/shared-state/src/store/work-item-filters/shared.ts\n===================================================================\n--- packages/shared-state/src/store/work-item-filters/shared.ts\t992457e (parent)\n+++ packages/shared-state/src/store/work-item-filters/shared.ts\t7ce21a6 (commit)\n@@ -0,0 +1,8 @@\n+// plane imports\n+import { EIssuesStoreType, TWorkItemFilterExpression, TWorkItemFilterProperty } from \"@plane/types\";\n+// local imports\n+import { IFilterInstance } from \"../rich-filters\";\n+\n+export type TWorkItemFilterKey = `${EIssuesStoreType}-${string}`;\n+\n+export type IWorkItemFilterInstance = IFilterInstance<TWorkItemFilterProperty, TWorkItemFilterExpression>;\n"
        }
      ]
    },
    {
      "id": "enhance-rich-filters",
      "sha": "cfb4a8212cbf82b9cdd6d68861256974f75f175b",
      "parentSha": "9f41e92d21359f75b461c533b0d860b1a1d9f705",
      "spec": "- Backend API\n  - Update apps/api/plane/utils/filters/filterset.py IssueFilterSet to include updated_at in the filterset fields with operators [\"exact\", \"range\"], mirroring created_at.\n\n- Types and constants\n  - Extend packages/types/src/view-props.ts:\n    - Add \"created_at\" and \"updated_at\" to WORK_ITEM_FILTER_PROPERTY_KEYS.\n    - Broaden TWorkItemFilterConditionData values to accept string | boolean | number.\n  - Extend packages/types/src/rich-filters/config/filter-config.ts to add optional rightContent and tooltipContent properties to TFilterConfig to support richer dropdown items and tooltips for applied filters.\n  - Add multi-value support:\n    - In packages/types/src/rich-filters/operators/core.ts define CORE_MULTI_VALUE_OPERATORS = [IN, RANGE].\n    - In packages/types/src/rich-filters/operators/extended.ts define EXTENDED_MULTI_VALUE_OPERATORS = [].\n    - In packages/types/src/rich-filters/operators/index.ts export MULTI_VALUE_OPERATORS composed from core and extended lists.\n\n- Shared-state rich filters\n  - Update packages/shared-state/src/store/rich-filters/config-manager.ts:\n    - Add areConfigsReady: boolean observable and setAreConfigsReady(value: boolean) action.\n    - Keep existing behavior for registration and allAvailableConfigs, but expose readiness flag for UI.\n  - Update packages/shared-state/src/store/rich-filters/filter-helpers.ts:\n    - Add handleConditionPropertyUpdate(expression, conditionId, property, operator, isNegation) that updates property, operator, resets value to undefined, and returns updated expression.\n    - Refactor restructureExpressionForOperatorChange(expression, conditionId, newOperator, isNegation, shouldResetValue) to rely on a shared _updateCondition that updates the node and preserves negation handling; accept non-null expression and return updated expression.\n    - Implement private _updateCondition(expression, conditionId, payload, isNegation) to update the node and return expression.\n  - Update packages/shared-state/src/store/rich-filters/filter.ts:\n    - Add updateConditionProperty(conditionId, property, operator, isNegation) to update a condition's property and operator using helper.handleConditionPropertyUpdate, and notify on success.\n    - In updateConditionValue, early-return if new value is deeply equal to existing; if invalid value, remove condition; otherwise update and notify.\n\n- Work item filters adapter\n  - Update packages/shared-state/src/store/work-item-filters/adapter.ts:\n    - Allow unknown/custom properties by accepting keys that start with \"customproperty_\" in addition to the known WORK_ITEM_FILTER_PROPERTY_KEYS.\n    - Parse values based on operator: use MULTI_VALUE_OPERATORS to parse comma-separated strings into arrays only for multi-value operators; otherwise keep scalar.\n    - Update _parseFilterValue to accept and passthrough non-string types and handle empty values.\n\n- Utils: loaders and filter factories\n  - Add packages/utils/src/loader.ts with isLoaderReady(loader: TLoader | undefined) => boolean that returns false only for the init-loader state; export from packages/utils/src/index.ts.\n  - Rich filter factories:\n    - Add packages/utils/src/rich-filters/factories/configs/properties/ with:\n      - shared.ts: shared helpers for date operators (getSupportedDateOperators), member/project multi-select configs (getMemberMultiSelectConfig, getProjectMultiSelectConfig), and type definitions (TCreateUserFilterParams, TCreateProjectFilterParams).\n      - date.ts: getDatePropertyFilterConfig(key) that produces a date property filter allowing multiple filters and using getSupportedDateOperators.\n      - member-picker.ts: getMemberPickerPropertyFilterConfig(key) that produces a member picker filter using getMemberMultiSelectConfig with EXACT singleValueOperator.\n    - Update packages/utils/src/rich-filters/factories/configs/shared.ts:\n      - Include rightContent and tooltipContent passthrough in TCreateFilterConfigParams.\n      - Introduce TFilterIconType and update IFilterIconConfig generic accordingly.\n    - Ensure index exports include new properties module.\n\n- Work item filter configs\n  - Update packages/utils/src/work-item-filters/configs/filters/*.ts:\n    - For existing configs (cycle, label, module, priority, project, state, user, date), spread ...params into createFilterConfig arguments rather than passing specific isEnabled, and use appropriate helper functions that now accept singleValueOperator where necessary.\n    - Add getCreatedAtFilterConfig and getUpdatedAtFilterConfig in date.ts returning date-based configs with allowMultipleFilters = true and supported operators from getSupportedDateOperators.\n\n- UI dropdown updates\n  - Update packages/ui/src/dropdowns/custom-search-select.tsx:\n    - Adjust padding around the options container and search input to include horizontal padding, and add vertical-scrollbar classes.\n    - Replace maxHeight=\"full\" usage with new sizes: add support for maxHeight \"xl\" and \"2xl\" and map them to max-h-80 and max-h-96 respectively; remove any dependency on \"full\".\n  - Update packages/ui/src/dropdowns/helper.tsx to extend IDropdownProps.maxHeight union type to include \"xl\" and \"2xl\"; downstream components must use these instead of \"full\".\n\n- Web core rich filter components\n  - Add apps/web/core/components/rich-filters/add-filters/button.tsx that wraps AddFilterDropdown with a styled button, defaulting to a link-neutral variant and ListFilter icon, and calls filter.addCondition with a default operator (from config.firstOperator) when a filter is selected.\n  - Refactor and move the existing add filter component to apps/web/core/components/rich-filters/add-filters/dropdown.tsx:\n    - Accept customButton and handleFilterSelect(property, operator, isNegation) props.\n    - Render config options with left icon, label, and rightContent.\n    - Increase options maxHeight to \"2xl\" and remove internal button styling (delegated to parent).\n  - Split FilterItem into modular components under apps/web/core/components/rich-filters/filter-item/:\n    - container.tsx: wraps each filter pill with border, background, optional error variant, tooltip, and entry transition when no value.\n    - property.tsx: renders property label and icon; when enabled, wraps with AddFilterDropdown to allow changing the condition property/operator in-place via updateConditionProperty.\n    - close-button.tsx: renders an X icon button to remove the condition.\n    - invalid.tsx: shows an error-styled pill with an alert icon and tooltip when the condition property is missing or invalid.\n    - loader.tsx: shows a skeleton loader for a pill.\n    - root.tsx: the main FilterItem component updated to:\n      - Show FilterItemLoader when filter.configManager.areConfigsReady is false.\n      - Show InvalidFilterItem when filterConfig lookup fails.\n      - Use FilterItemContainer, FilterItemProperty, and FilterItemCloseButton in place of inline markup.\n      - Use CustomSearchSelect with maxHeight=\"2xl\" for operator selection.\n  - Centralize shared constants/types under apps/web/core/components/rich-filters/shared.ts:\n    - Export COMMON_FILTER_ITEM_BORDER_CLASSNAME, EMPTY_FILTER_PLACEHOLDER_TEXT=\"--\", and TFilterValueInputProps type for filter value inputs.\n  - Update apps/web/core/components/rich-filters/filter-value-input/*:\n    - root.tsx: remove inline fallback UI and delegate to CE AdditionalFilterValueInput via import; use centralized TFilterValueInputProps type.\n    - date/single.tsx and date/range.tsx: use EMPTY_FILTER_PLACEHOLDER_TEXT for placeholders.\n    - select/selected-options-display.tsx: use EMPTY_FILTER_PLACEHOLDER_TEXT for emptyValue.\n  - Update apps/web/core/components/rich-filters/filters-row.tsx:\n    - Use the new AddFilterButton and FilterItem paths.\n    - Introduce a RowTransition wrapper component for enter/leave transitions.\n    - When filter.configManager.areConfigsReady is false and there are no existing conditions, render a full-width Loader skeleton matching header/modal variant.\n    - Disable operations while configs are not ready.\n  - Update apps/web/core/components/rich-filters/filters-toggle.tsx import to the new add-filters/button path.\n\n- Web CE additions and work item config\n  - Add apps/web/ce/components/rich-filters/filter-value-input/root.tsx exporting AdditionalFilterValueInput: a simple observer fallback element that displays \"Filter type not supported\" for unsupported fields.\n  - Update apps/web/ce/helpers/work-item-filters/project-level.ts to include entityType: EIssuesStoreType in TGetAdditionalPropsForProjectLevelFiltersHOCParams.\n  - Enhance apps/web/ce/hooks/work-item-filters/use-work-item-filters-config.tsx:\n    - Import Calendar icon and new getCreatedAtFilterConfig, getUpdatedAtFilterConfig, and isLoaderReady from utils.\n    - Compute areAllConfigsInitialized via isLoaderReady(projectLoader) and expose it on the returned object.\n    - Add members to the returned object for filters needing users.\n    - Add createdAtFilterConfig and updatedAtFilterConfig and include them in configs array and configMap under keys created_at and updated_at.\n  - In apps/web/core/components/work-item-filters/filters-hoc/base.tsx:\n    - Before registering configs, call workItemLayoutFilter.configManager.setAreConfigsReady(workItemFiltersConfig.areAllConfigsInitialized).\n    - Then register all configs.\n  - In apps/web/core/components/work-item-filters/filters-hoc/project-level.tsx pass entityType prop into getAdditionalProjectLevelFiltersHOCProps params.\n\n- Web core operator/property behaviors\n  - When selecting a filter from AddFilterDropdown, use the config.firstOperator and pass isNegation derived from getOperatorForPayload; create a new AND condition with undefined value and focus the value input.\n  - In FilterItemProperty, changing the property reuses AddFilterDropdown and calls filter.updateConditionProperty with the selected property's default operator and negation info, resetting value.\n\n- Visual/UX\n  - Replace any CustomSearchSelect maxHeight=\"full\" usages with \"2xl\" and adjust the UI component to support new sizes; ensure vertical scrollbar styles apply to long lists.\n  - Provide tooltipContent via filter config when appropriate, and render rightContent in the add-filter dropdown option rows.\n  - Use a consistent placeholder \"--\" (EMPTY_FILTER_PLACEHOLDER_TEXT) for empty filter values.\n",
      "prompt": "Enhance the rich filters system to support created_at and updated_at date filters and improve the filtering UX across the app.\n\nAt a high level, you should:\n- Add created_at and updated_at as first-class work item filter properties, including API support and utilities.\n- Introduce a loading state for filter configuration readiness so the UI can defer interactions until configs are available.\n- Improve the Add Filter control to show icons, optional right-side content, and better scrolling; split responsibilities so the dropdown can be reused as a property switcher.\n- Break the filter item pill into smaller components for property display, operator selection, value input, invalid/error states, close button, and container with animation/tooltip support.\n- Add a fallback for unsupported filter field types in CE, and use a shared placeholder for empty values.\n- Update shared state helpers to allow changing a condition’s property and operator, avoid redundant updates, and handle multi-value operator parsing.\n\nFollow the existing patterns in the codebase for filter configs, operators, and UI dropdowns. Ensure new fields are reflected in the filter config hook, HOCs, and adapters. Keep the UX consistent with existing filter styles and transitions.",
      "supplementalFiles": [
        "packages/shared-state/src/store/rich-filters/config.ts",
        "packages/utils/src/rich-filters/factories/configs/core.ts",
        "packages/utils/src/rich-filters/factories/nodes/core.ts",
        "packages/types/src/rich-filters/config/index.ts",
        "packages/types/src/rich-filters/operators/index.ts",
        "packages/utils/src/work-item-filters/configs/filters/shared.ts",
        "apps/web/core/components/rich-filters/filter-value-input/select/single.tsx"
      ],
      "fileDiffs": [
        {
          "path": "apps/api/plane/utils/filters/filterset.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/utils/filters/filterset.py\n===================================================================\n--- apps/api/plane/utils/filters/filterset.py\t9f41e92 (parent)\n+++ apps/api/plane/utils/filters/filterset.py\tcfb4a82 (commit)\n@@ -158,8 +158,9 @@\n         fields = {\n             \"start_date\": [\"exact\", \"range\"],\n             \"target_date\": [\"exact\", \"range\"],\n             \"created_at\": [\"exact\", \"range\"],\n+            \"updated_at\": [\"exact\", \"range\"],\n             \"is_draft\": [\"exact\"],\n             \"priority\": [\"exact\", \"in\"],\n         }\n \n"
        },
        {
          "path": "apps/web/ce/components/rich-filters/filter-value-input/root.tsx",
          "status": "added",
          "diff": "Index: apps/web/ce/components/rich-filters/filter-value-input/root.tsx\n===================================================================\n--- apps/web/ce/components/rich-filters/filter-value-input/root.tsx\t9f41e92 (parent)\n+++ apps/web/ce/components/rich-filters/filter-value-input/root.tsx\tcfb4a82 (commit)\n@@ -0,0 +1,15 @@\n+import React from \"react\";\n+import { observer } from \"mobx-react\";\n+// plane imports\n+import { TFilterValue, TFilterProperty } from \"@plane/types\";\n+// local imports\n+import { TFilterValueInputProps } from \"@/components/rich-filters/shared\";\n+\n+export const AdditionalFilterValueInput = observer(\n+  <P extends TFilterProperty, V extends TFilterValue>(_props: TFilterValueInputProps<P, V>) => (\n+    // Fallback\n+    <div className=\"h-full flex items-center px-4 text-xs text-custom-text-400 transition-opacity duration-200 cursor-not-allowed\">\n+      Filter type not supported\n+    </div>\n+  )\n+);\n"
        },
        {
          "path": "apps/web/ce/helpers/work-item-filters/project-level.ts",
          "status": "modified",
          "diff": "Index: apps/web/ce/helpers/work-item-filters/project-level.ts\n===================================================================\n--- apps/web/ce/helpers/work-item-filters/project-level.ts\t9f41e92 (parent)\n+++ apps/web/ce/helpers/work-item-filters/project-level.ts\tcfb4a82 (commit)\n@@ -1,7 +1,11 @@\n+// plane imports\n+import { EIssuesStoreType } from \"@plane/types\";\n+// plane web imports\n import { TWorkItemFiltersEntityProps } from \"@/plane-web/hooks/work-item-filters/use-work-item-filters-config\";\n \n export type TGetAdditionalPropsForProjectLevelFiltersHOCParams = {\n+  entityType: EIssuesStoreType;\n   workspaceSlug: string;\n   projectId: string;\n };\n \n"
        },
        {
          "path": "apps/web/ce/hooks/work-item-filters/use-work-item-filters-config.tsx",
          "status": "modified",
          "diff": "Index: apps/web/ce/hooks/work-item-filters/use-work-item-filters-config.tsx\n===================================================================\n--- apps/web/ce/hooks/work-item-filters/use-work-item-filters-config.tsx\t9f41e92 (parent)\n+++ apps/web/ce/hooks/work-item-filters/use-work-item-filters-config.tsx\tcfb4a82 (commit)\n@@ -1,8 +1,9 @@\n import { useCallback, useMemo } from \"react\";\n import {\n   AtSign,\n   Briefcase,\n+  Calendar,\n   CalendarCheck2,\n   CalendarClock,\n   CircleUserRound,\n   SignalHigh,\n@@ -31,8 +32,9 @@\n } from \"@plane/types\";\n import { Avatar, Logo } from \"@plane/ui\";\n import {\n   getAssigneeFilterConfig,\n+  getCreatedAtFilterConfig,\n   getCreatedByFilterConfig,\n   getCycleFilterConfig,\n   getFileURL,\n   getLabelFilterConfig,\n@@ -44,8 +46,10 @@\n   getStateFilterConfig,\n   getStateGroupFilterConfig,\n   getSubscriberFilterConfig,\n   getTargetDateFilterConfig,\n+  getUpdatedAtFilterConfig,\n+  isLoaderReady,\n } from \"@plane/utils\";\n // store hooks\n import { useCycle } from \"@/hooks/store/use-cycle\";\n import { useLabel } from \"@/hooks/store/use-label\";\n@@ -71,20 +75,22 @@\n   allowedFilters: TWorkItemFilterProperty[];\n } & TWorkItemFiltersEntityProps;\n \n export type TWorkItemFiltersConfig = {\n+  areAllConfigsInitialized: boolean;\n   configs: TFilterConfig<TWorkItemFilterProperty, TFilterValue>[];\n   configMap: {\n     [key in TWorkItemFilterProperty]?: TFilterConfig<TWorkItemFilterProperty, TFilterValue>;\n   };\n   isFilterEnabled: (key: TWorkItemFilterProperty) => boolean;\n+  members: IUserLite[];\n };\n \n export const useWorkItemFiltersConfig = (props: TUseWorkItemFiltersConfigProps): TWorkItemFiltersConfig => {\n   const { allowedFilters, cycleIds, labelIds, memberIds, moduleIds, projectId, projectIds, stateIds, workspaceSlug } =\n     props;\n   // store hooks\n-  const { getProjectById } = useProject();\n+  const { loader: projectLoader, getProjectById } = useProject();\n   const { getCycleById } = useCycle();\n   const { getLabelById } = useLabel();\n   const { getModuleById } = useModule();\n   const { getStateById } = useProjectState();\n@@ -127,8 +133,9 @@\n         ? (projectIds.map((projectId) => getProjectById(projectId)).filter((project) => project) as IProject[])\n         : [],\n     [projectIds, getProjectById]\n   );\n+  const areAllConfigsInitialized = useMemo(() => isLoaderReady(projectLoader), [projectLoader]);\n \n   /**\n    * Checks if a filter is enabled based on the filters to show.\n    * @param key - The filter key.\n@@ -316,8 +323,30 @@\n       }),\n     [operatorConfigs]\n   );\n \n+  // created at filter config\n+  const createdAtFilterConfig = useMemo(\n+    () =>\n+      getCreatedAtFilterConfig<TWorkItemFilterProperty>(\"created_at\")({\n+        isEnabled: true,\n+        filterIcon: Calendar,\n+        ...operatorConfigs,\n+      }),\n+    [operatorConfigs]\n+  );\n+\n+  // updated at filter config\n+  const updatedAtFilterConfig = useMemo(\n+    () =>\n+      getUpdatedAtFilterConfig<TWorkItemFilterProperty>(\"updated_at\")({\n+        isEnabled: true,\n+        filterIcon: Calendar,\n+        ...operatorConfigs,\n+      }),\n+    [operatorConfigs]\n+  );\n+\n   // project filter config\n   const projectFilterConfig = useMemo(\n     () =>\n       getProjectFilterConfig<TWorkItemFilterProperty>(\"project_id\")({\n@@ -330,8 +359,9 @@\n     [isFilterEnabled, projects, operatorConfigs]\n   );\n \n   return {\n+    areAllConfigsInitialized,\n     configs: [\n       stateFilterConfig,\n       stateGroupFilterConfig,\n       assigneeFilterConfig,\n@@ -342,8 +372,10 @@\n       cycleFilterConfig,\n       moduleFilterConfig,\n       startDateFilterConfig,\n       targetDateFilterConfig,\n+      createdAtFilterConfig,\n+      updatedAtFilterConfig,\n       createdByFilterConfig,\n       subscriberFilterConfig,\n     ],\n     configMap: {\n@@ -359,8 +391,11 @@\n       subscriber_id: subscriberFilterConfig,\n       priority: priorityFilterConfig,\n       start_date: startDateFilterConfig,\n       target_date: targetDateFilterConfig,\n+      created_at: createdAtFilterConfig,\n+      updated_at: updatedAtFilterConfig,\n     },\n     isFilterEnabled,\n+    members: members ?? [],\n   };\n };\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/add-filters/button.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/rich-filters/add-filters/button.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/add-filters/button.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/add-filters/button.tsx\tcfb4a82 (commit)\n@@ -0,0 +1,71 @@\n+import React from \"react\";\n+import { observer } from \"mobx-react\";\n+import { ListFilter } from \"lucide-react\";\n+// plane imports\n+import { IFilterInstance } from \"@plane/shared-state\";\n+import { LOGICAL_OPERATOR, TExternalFilter, TFilterProperty, TSupportedOperators } from \"@plane/types\";\n+import { cn, getButtonStyling, TButtonVariant } from \"@plane/ui\";\n+// local imports\n+import { AddFilterDropdown } from \"./dropdown\";\n+\n+export type TAddFilterButtonProps<P extends TFilterProperty, E extends TExternalFilter> = {\n+  buttonConfig?: {\n+    label: string | null;\n+    variant?: TButtonVariant;\n+    className?: string;\n+    defaultOpen?: boolean;\n+    iconConfig?: {\n+      shouldShowIcon: boolean;\n+      iconComponent?: React.ElementType;\n+    };\n+    isDisabled?: boolean;\n+  };\n+  filter: IFilterInstance<P, E>;\n+  onFilterSelect?: (id: string) => void;\n+};\n+\n+export const AddFilterButton = observer(\n+  <P extends TFilterProperty, E extends TExternalFilter>(props: TAddFilterButtonProps<P, E>) => {\n+    const { filter, buttonConfig, onFilterSelect } = props;\n+    const {\n+      variant = \"link-neutral\",\n+      className,\n+      label,\n+      iconConfig = { shouldShowIcon: true },\n+      isDisabled = false,\n+    } = buttonConfig || {};\n+    // derived values\n+    const FilterIcon = iconConfig.iconComponent || ListFilter;\n+\n+    const handleFilterSelect = (property: P, operator: TSupportedOperators, isNegation: boolean) => {\n+      filter.addCondition(\n+        LOGICAL_OPERATOR.AND,\n+        {\n+          property,\n+          operator,\n+          value: undefined,\n+        },\n+        isNegation\n+      );\n+      onFilterSelect?.(property);\n+    };\n+\n+    if (isDisabled) return null;\n+    return (\n+      <AddFilterDropdown\n+        {...props}\n+        buttonConfig={{\n+          ...buttonConfig,\n+          className: cn(getButtonStyling(variant, \"sm\"), \"py-[5px]\", className),\n+        }}\n+        handleFilterSelect={handleFilterSelect}\n+        customButton={\n+          <div className=\"flex items-center gap-1\">\n+            {iconConfig.shouldShowIcon && <FilterIcon className=\"size-4 text-custom-text-200\" />}\n+            {label}\n+          </div>\n+        }\n+      />\n+    );\n+  }\n+);\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/add-filters/dropdown.tsx",
          "status": "renamed",
          "oldPath": "apps/web/core/components/rich-filters/add-filters-button.tsx",
          "diff": "===================================================================\n--- apps/web/core/components/rich-filters/add-filters-button.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/add-filters/dropdown.tsx\tcfb4a82 (commit)\n@@ -1,54 +1,41 @@\n import React from \"react\";\n import { observer } from \"mobx-react\";\n-import { ListFilter } from \"lucide-react\";\n // plane imports\n-import { getButtonStyling } from \"@plane/propel/button\";\n import { setToast, TOAST_TYPE } from \"@plane/propel/toast\";\n import { IFilterInstance } from \"@plane/shared-state\";\n-import { LOGICAL_OPERATOR, TExternalFilter, TFilterProperty } from \"@plane/types\";\n-import { CustomSearchSelect, TButtonVariant } from \"@plane/ui\";\n-import { cn, getOperatorForPayload } from \"@plane/utils\";\n+import { TExternalFilter, TFilterProperty, TSupportedOperators } from \"@plane/types\";\n+import { CustomSearchSelect } from \"@plane/ui\";\n+import { getOperatorForPayload } from \"@plane/utils\";\n \n-export type TAddFilterButtonProps<P extends TFilterProperty, E extends TExternalFilter> = {\n+export type TAddFilterDropdownProps<P extends TFilterProperty, E extends TExternalFilter> = {\n+  customButton: React.ReactNode;\n   buttonConfig?: {\n-    label: string | null;\n-    variant?: TButtonVariant;\n     className?: string;\n     defaultOpen?: boolean;\n-    iconConfig?: {\n-      shouldShowIcon: boolean;\n-      iconComponent?: React.ElementType;\n-    };\n     isDisabled?: boolean;\n   };\n   filter: IFilterInstance<P, E>;\n-  onFilterSelect?: (id: string) => void;\n+  handleFilterSelect: (property: P, operator: TSupportedOperators, isNegation: boolean) => void;\n };\n \n-export const AddFilterButton = observer(\n-  <P extends TFilterProperty, E extends TExternalFilter>(props: TAddFilterButtonProps<P, E>) => {\n-    const { filter, buttonConfig, onFilterSelect } = props;\n-    const {\n-      label,\n-      variant = \"link-neutral\",\n-      className,\n-      defaultOpen = false,\n-      iconConfig = { shouldShowIcon: true },\n-      isDisabled = false,\n-    } = buttonConfig || {};\n-    // derived values\n-    const FilterIcon = iconConfig.iconComponent || ListFilter;\n+export const AddFilterDropdown = observer(\n+  <P extends TFilterProperty, E extends TExternalFilter>(props: TAddFilterDropdownProps<P, E>) => {\n+    const { filter, customButton, buttonConfig } = props;\n+    const { className, defaultOpen = false, isDisabled = false } = buttonConfig || {};\n \n     // Transform available filter configs to CustomSearchSelect options format\n     const filterOptions = filter.configManager.allAvailableConfigs.map((config) => ({\n       value: config.id,\n       content: (\n-        <div className=\"flex items-center gap-2 text-custom-text-200 transition-all duration-200 ease-in-out\">\n-          {config.icon && (\n-            <config.icon className=\"size-4 text-custom-text-300 transition-transform duration-200 ease-in-out\" />\n-          )}\n-          <span>{config.label}</span>\n+        <div className=\"flex items-center justify-between gap-2 text-custom-text-200 transition-all duration-200 ease-in-out\">\n+          <div className=\"flex items-center gap-2\">\n+            {config.icon && (\n+              <config.icon className=\"size-4 text-custom-text-300 transition-transform duration-200 ease-in-out\" />\n+            )}\n+            <span>{config.label}</span>\n+          </div>\n+          {config.rightContent}\n         </div>\n       ),\n       query: config.label.toLowerCase(),\n     }));\n@@ -69,18 +56,9 @@\n     const handleFilterSelect = (property: P) => {\n       const config = filter.configManager.getConfigByProperty(property);\n       if (config?.firstOperator) {\n         const { operator, isNegation } = getOperatorForPayload(config.firstOperator);\n-        filter.addCondition(\n-          LOGICAL_OPERATOR.AND,\n-          {\n-            property: config.id,\n-            operator,\n-            value: undefined,\n-          },\n-          isNegation\n-        );\n-        onFilterSelect?.(property);\n+        props.handleFilterSelect(property, operator, isNegation);\n       } else {\n         setToast({\n           title: \"Filter configuration error\",\n           message: \"This filter is not properly configured and cannot be applied\",\n@@ -88,27 +66,21 @@\n         });\n       }\n     };\n \n-    if (isDisabled) return null;\n     return (\n       <div className=\"relative transition-all duration-200 ease-in-out\">\n         <CustomSearchSelect\n           defaultOpen={defaultOpen}\n           value={\"\"}\n           onChange={handleFilterSelect}\n           options={displayOptions}\n           optionsClassName=\"w-56\"\n-          maxHeight=\"full\"\n+          maxHeight=\"2xl\"\n           placement=\"bottom-start\"\n           disabled={isDisabled}\n-          customButtonClassName={cn(getButtonStyling(variant, \"sm\"), \"py-[5px]\", className)}\n-          customButton={\n-            <div className=\"flex items-center gap-1\">\n-              {iconConfig.shouldShowIcon && <FilterIcon className=\"size-4 text-custom-text-200\" />}\n-              {label}\n-            </div>\n-          }\n+          customButtonClassName={className}\n+          customButton={customButton}\n         />\n       </div>\n     );\n   }\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filter-item/close-button.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/rich-filters/filter-item/close-button.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/filter-item/close-button.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/filter-item/close-button.tsx\tcfb4a82 (commit)\n@@ -0,0 +1,32 @@\n+import React from \"react\";\n+import { observer } from \"mobx-react\";\n+import { X } from \"lucide-react\";\n+// plane imports\n+import { IFilterInstance } from \"@plane/shared-state\";\n+import { TExternalFilter, TFilterProperty } from \"@plane/types\";\n+\n+interface FilterItemCloseButtonProps<P extends TFilterProperty, E extends TExternalFilter> {\n+  conditionId: string;\n+  filter: IFilterInstance<P, E>;\n+}\n+\n+export const FilterItemCloseButton = observer(\n+  <P extends TFilterProperty, E extends TExternalFilter>(props: FilterItemCloseButtonProps<P, E>) => {\n+    const { conditionId, filter } = props;\n+\n+    const handleRemoveFilter = () => {\n+      filter.removeCondition(conditionId);\n+    };\n+\n+    return (\n+      <button\n+        onClick={handleRemoveFilter}\n+        className=\"px-1.5 text-custom-text-400 hover:text-custom-text-300 focus:outline-none hover:bg-custom-background-90\"\n+        type=\"button\"\n+        aria-label=\"Remove filter\"\n+      >\n+        <X className=\"size-3.5\" />\n+      </button>\n+    );\n+  }\n+);\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filter-item/container.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/rich-filters/filter-item/container.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/filter-item/container.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/filter-item/container.tsx\tcfb4a82 (commit)\n@@ -0,0 +1,64 @@\n+import { useEffect, useRef } from \"react\";\n+// plane imports\n+import { Tooltip } from \"@plane/propel/tooltip\";\n+import { cn } from \"@plane/propel/utils\";\n+import { SingleOrArray, TFilterValue } from \"@plane/types\";\n+import { hasValidValue } from \"@plane/utils\";\n+\n+interface FilterItemContainerProps {\n+  children: React.ReactNode;\n+  conditionValue: SingleOrArray<TFilterValue>;\n+  showTransition: boolean;\n+  variant?: \"default\" | \"error\";\n+  tooltipContent?: React.ReactNode;\n+}\n+\n+export const FilterItemContainer: React.FC<FilterItemContainerProps> = (props) => {\n+  const { children, conditionValue, showTransition, variant = \"default\", tooltipContent } = props;\n+  // refs\n+  const itemRef = useRef<HTMLDivElement>(null);\n+\n+  // effects\n+  useEffect(() => {\n+    if (!showTransition) return;\n+\n+    const element = itemRef.current;\n+    if (!element) return;\n+\n+    if (hasValidValue(conditionValue)) return;\n+\n+    const applyInitialStyles = () => {\n+      element.style.opacity = \"0\";\n+      element.style.transform = \"scale(0.95)\";\n+    };\n+\n+    const applyFinalStyles = () => {\n+      // Force a reflow to ensure the initial state is applied\n+      void element.offsetWidth;\n+      element.style.opacity = \"1\";\n+      element.style.transform = \"scale(1)\";\n+    };\n+\n+    applyInitialStyles();\n+    applyFinalStyles();\n+\n+    return () => {\n+      applyInitialStyles();\n+    };\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n+  }, []);\n+\n+  return (\n+    <Tooltip tooltipContent={tooltipContent} position=\"bottom\" disabled={!tooltipContent}>\n+      <div\n+        ref={itemRef}\n+        className={cn(\"flex h-7 items-stretch rounded overflow-hidden border transition-all duration-200\", {\n+          \"border-custom-border-200 bg-custom-background-100\": variant === \"default\",\n+          \"border-red-500 bg-custom-background-90\": variant === \"error\",\n+        })}\n+      >\n+        {children}\n+      </div>\n+    </Tooltip>\n+  );\n+};\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filter-item/invalid.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/rich-filters/filter-item/invalid.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/filter-item/invalid.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/filter-item/invalid.tsx\tcfb4a82 (commit)\n@@ -0,0 +1,36 @@\n+import React from \"react\";\n+import { observer } from \"mobx-react\";\n+import { CircleAlert } from \"lucide-react\";\n+// plane imports\n+import { TExternalFilter, TFilterProperty } from \"@plane/types\";\n+// local imports\n+import { FilterItemCloseButton } from \"./close-button\";\n+import { FilterItemContainer } from \"./container\";\n+import { FilterItemProperty } from \"./property\";\n+import { IFilterItemProps } from \"./root\";\n+\n+export const InvalidFilterItem = observer(\n+  <P extends TFilterProperty, E extends TExternalFilter>(props: IFilterItemProps<P, E>) => {\n+    const { condition, filter, isDisabled = false, showTransition = true } = props;\n+\n+    return (\n+      <FilterItemContainer\n+        conditionValue={condition.value}\n+        showTransition={showTransition}\n+        variant=\"error\"\n+        tooltipContent=\"This filter condition is no longer valid. The property may have been deleted or your access to it may have changed.\"\n+      >\n+        {/* Property section */}\n+        <FilterItemProperty\n+          conditionId={condition.id}\n+          icon={CircleAlert}\n+          label=\"Invalid filter\"\n+          filter={filter}\n+          isDisabled={isDisabled}\n+        />\n+        {/* Remove button */}\n+        {!isDisabled && <FilterItemCloseButton conditionId={condition.id} filter={filter} />}\n+      </FilterItemContainer>\n+    );\n+  }\n+);\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filter-item/loader.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/rich-filters/filter-item/loader.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/filter-item/loader.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/filter-item/loader.tsx\tcfb4a82 (commit)\n@@ -0,0 +1,7 @@\n+import { Loader } from \"@plane/ui\";\n+\n+export const FilterItemLoader = () => (\n+  <Loader>\n+    <Loader.Item height=\"28px\" width=\"180px\" />\n+  </Loader>\n+);\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filter-item/property.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/rich-filters/filter-item/property.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/filter-item/property.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/filter-item/property.tsx\tcfb4a82 (commit)\n@@ -0,0 +1,67 @@\n+import { observer } from \"mobx-react\";\n+// plane imports\n+import { Tooltip } from \"@plane/propel/tooltip\";\n+import { cn } from \"@plane/propel/utils\";\n+import { IFilterInstance } from \"@plane/shared-state\";\n+import { TExternalFilter, TFilterProperty, TSupportedOperators } from \"@plane/types\";\n+// local imports\n+import { AddFilterDropdown } from \"../add-filters/dropdown\";\n+import { COMMON_FILTER_ITEM_BORDER_CLASSNAME } from \"../shared\";\n+\n+interface IFilterItemPropertyProps<P extends TFilterProperty, E extends TExternalFilter> {\n+  conditionId: string;\n+  icon: React.FC<React.SVGAttributes<SVGElement>> | undefined;\n+  isDisabled?: boolean;\n+  filter: IFilterInstance<P, E>;\n+  label: string;\n+  tooltipContent?: React.ReactNode | undefined;\n+}\n+\n+export const FilterItemProperty = observer(\n+  <P extends TFilterProperty, E extends TExternalFilter>(props: IFilterItemPropertyProps<P, E>) => {\n+    const { conditionId, filter, isDisabled } = props;\n+\n+    if (isDisabled) {\n+      return <PropertyButton {...props} />;\n+    }\n+\n+    const handleFilterSelect = (property: P, operator: TSupportedOperators, isNegation: boolean) => {\n+      filter.updateConditionProperty(conditionId, property, operator, isNegation);\n+    };\n+\n+    return (\n+      <AddFilterDropdown\n+        {...props}\n+        handleFilterSelect={handleFilterSelect}\n+        customButton={<PropertyButton {...props} />}\n+      />\n+    );\n+  }\n+);\n+\n+type TPropertyButtonProps<P extends TFilterProperty, E extends TExternalFilter> = IFilterItemPropertyProps<P, E> & {\n+  className?: string;\n+};\n+\n+const PropertyButton = <P extends TFilterProperty, E extends TExternalFilter>(props: TPropertyButtonProps<P, E>) => {\n+  const { icon: Icon, label, tooltipContent, className } = props;\n+\n+  return (\n+    <Tooltip tooltipContent={tooltipContent} position=\"bottom-start\" disabled={!tooltipContent}>\n+      <div\n+        className={cn(\n+          \"flex items-center gap-1 px-2 py-[5px] text-xs text-custom-text-300 min-w-0 h-full\",\n+          COMMON_FILTER_ITEM_BORDER_CLASSNAME,\n+          className\n+        )}\n+      >\n+        {Icon && (\n+          <div className=\"transition-transform duration-200 ease-in-out flex-shrink-0\">\n+            <Icon className=\"size-3.5\" />\n+          </div>\n+        )}\n+        <span className=\"truncate\">{label}</span>\n+      </div>\n+    </Tooltip>\n+  );\n+};\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filter-item/root.tsx",
          "status": "renamed",
          "oldPath": "apps/web/core/components/rich-filters/filter-item.tsx",
          "diff": "===================================================================\n--- apps/web/core/components/rich-filters/filter-item.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/filter-item/root.tsx\tcfb4a82 (commit)\n@@ -1,7 +1,6 @@\n-import React, { useRef, useEffect } from \"react\";\n+import React from \"react\";\n import { observer } from \"mobx-react\";\n-import { X } from \"lucide-react\";\n // plane imports\n import { IFilterInstance } from \"@plane/shared-state\";\n import {\n   SingleOrArray,\n@@ -11,25 +10,28 @@\n   TFilterConditionNodeForDisplay,\n   TAllAvailableOperatorsForDisplay,\n } from \"@plane/types\";\n import { CustomSearchSelect } from \"@plane/ui\";\n-import { cn, hasValidValue, getOperatorForPayload } from \"@plane/utils\";\n+import { cn, getOperatorForPayload } from \"@plane/utils\";\n // local imports\n-import { FilterValueInput } from \"./filter-value-input/root\";\n-import { COMMON_FILTER_ITEM_BORDER_CLASSNAME } from \"./shared\";\n+import { FilterValueInput } from \"../filter-value-input/root\";\n+import { COMMON_FILTER_ITEM_BORDER_CLASSNAME } from \"../shared\";\n+import { FilterItemCloseButton } from \"./close-button\";\n+import { FilterItemContainer } from \"./container\";\n+import { InvalidFilterItem } from \"./invalid\";\n+import { FilterItemLoader } from \"./loader\";\n+import { FilterItemProperty } from \"./property\";\n \n-interface FilterItemProps<P extends TFilterProperty, E extends TExternalFilter> {\n+export interface IFilterItemProps<P extends TFilterProperty, E extends TExternalFilter> {\n   condition: TFilterConditionNodeForDisplay<P, TFilterValue>;\n   filter: IFilterInstance<P, E>;\n   isDisabled?: boolean;\n   showTransition?: boolean;\n }\n \n export const FilterItem = observer(\n-  <P extends TFilterProperty, E extends TExternalFilter>(props: FilterItemProps<P, E>) => {\n+  <P extends TFilterProperty, E extends TExternalFilter>(props: IFilterItemProps<P, E>) => {\n     const { condition, filter, isDisabled = false, showTransition = true } = props;\n-    // refs\n-    const itemRef = useRef<HTMLDivElement>(null);\n     // derived values\n     const filterConfig = condition?.property ? filter.configManager.getConfigByProperty(condition.property) : undefined;\n     const operatorOptions = filterConfig\n       ?.getAllDisplayOperatorOptionsByValue(condition.value as TFilterValue)\n@@ -47,38 +49,8 @@\n     const isOperatorSelectionDisabled =\n       isDisabled ||\n       (condition.operator && operatorOptions?.length === 1 && operatorOptions[0]?.value === condition.operator);\n \n-    // effects\n-    useEffect(() => {\n-      if (!showTransition) return;\n-\n-      const element = itemRef.current;\n-      if (!element) return;\n-\n-      if (hasValidValue(condition.value)) return;\n-\n-      const applyInitialStyles = () => {\n-        element.style.opacity = \"0\";\n-        element.style.transform = \"scale(0.95)\";\n-      };\n-\n-      const applyFinalStyles = () => {\n-        // Force a reflow to ensure the initial state is applied\n-        void element.offsetWidth;\n-        element.style.opacity = \"1\";\n-        element.style.transform = \"scale(1)\";\n-      };\n-\n-      applyInitialStyles();\n-      applyFinalStyles();\n-\n-      return () => {\n-        applyInitialStyles();\n-      };\n-      // eslint-disable-next-line react-hooks/exhaustive-deps\n-    }, []);\n-\n     const handleOperatorChange = (operator: TAllAvailableOperatorsForDisplay) => {\n       if (operator) {\n         const { operator: positiveOperator, isNegation } = getOperatorForPayload(operator);\n         filter.updateConditionOperator(condition.id, positiveOperator, isNegation);\n@@ -88,32 +60,34 @@\n     const handleValueChange = (values: SingleOrArray<TFilterValue>) => {\n       filter.updateConditionValue(condition.id, values);\n     };\n \n-    const handleRemoveFilter = () => {\n-      filter.removeCondition(condition.id);\n-    };\n+    if (!filter.configManager.areConfigsReady) {\n+      return <FilterItemLoader />;\n+    }\n \n-    if (!filterConfig || !filterConfig.isEnabled) return null;\n+    if (!filterConfig) {\n+      return (\n+        <InvalidFilterItem\n+          condition={condition}\n+          filter={filter}\n+          isDisabled={isDisabled}\n+          showTransition={showTransition}\n+        />\n+      );\n+    }\n+\n     return (\n-      <div\n-        ref={itemRef}\n-        className=\"flex h-7 items-stretch rounded overflow-hidden border border-custom-border-200 bg-custom-background-100 transition-all duration-200\"\n-      >\n+      <FilterItemContainer conditionValue={condition.value} showTransition={showTransition}>\n         {/* Property section */}\n-        <div\n-          className={cn(\n-            \"flex items-center gap-1 px-2 py-0.5 text-xs text-custom-text-300 min-w-0\",\n-            COMMON_FILTER_ITEM_BORDER_CLASSNAME\n-          )}\n-        >\n-          {filterConfig.icon && (\n-            <div className=\"transition-transform duration-200 ease-in-out flex-shrink-0\">\n-              <filterConfig.icon className=\"size-3.5\" />\n-            </div>\n-          )}\n-          <span className=\"truncate\">{filterConfig.label}</span>\n-        </div>\n+        <FilterItemProperty\n+          conditionId={condition.id}\n+          filter={filter}\n+          icon={filterConfig.icon}\n+          isDisabled={isDisabled}\n+          label={filterConfig.label}\n+          tooltipContent={filterConfig.tooltipContent}\n+        />\n \n         {/* Operator section */}\n         <CustomSearchSelect\n           value={condition.operator}\n@@ -124,9 +98,9 @@\n             \"h-full px-2 text-sm font-normal\",\n             isOperatorSelectionDisabled && \"hover:bg-custom-background-100\"\n           )}\n           optionsClassName=\"w-48\"\n-          maxHeight=\"full\"\n+          maxHeight=\"2xl\"\n           disabled={isOperatorSelectionDisabled}\n           customButton={\n             <div className=\"flex items-center h-full\" aria-disabled={isOperatorSelectionDisabled}>\n               {filterConfig.getLabelForOperator(selectedOperatorOption)}\n@@ -144,18 +118,9 @@\n           />\n         )}\n \n         {/* Remove button */}\n-        {!isDisabled && (\n-          <button\n-            onClick={handleRemoveFilter}\n-            className=\"px-1.5 text-custom-text-400 hover:text-custom-text-300 focus:outline-none hover:bg-custom-background-90\"\n-            type=\"button\"\n-            aria-label=\"Remove filter\"\n-          >\n-            <X className=\"size-3.5\" />\n-          </button>\n-        )}\n-      </div>\n+        {!isDisabled && <FilterItemCloseButton conditionId={condition.id} filter={filter} />}\n+      </FilterItemContainer>\n     );\n   }\n );\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filter-value-input/date/range.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/rich-filters/filter-value-input/date/range.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/filter-value-input/date/range.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/filter-value-input/date/range.tsx\tcfb4a82 (commit)\n@@ -5,9 +5,9 @@\n import { cn, isValidDate, renderFormattedPayloadDate, toFilterArray } from \"@plane/utils\";\n // components\n import { DateRangeDropdown } from \"@/components/dropdowns/date-range\";\n // local imports\n-import { COMMON_FILTER_ITEM_BORDER_CLASSNAME } from \"../../shared\";\n+import { COMMON_FILTER_ITEM_BORDER_CLASSNAME, EMPTY_FILTER_PLACEHOLDER_TEXT } from \"../../shared\";\n \n type TDateRangeFilterValueInputProps<P extends TFilterProperty> = {\n   config: TDateRangeFilterFieldConfig<string>;\n   condition: TFilterConditionNodeForDisplay<P, string>;\n@@ -41,9 +41,9 @@\n         onSelect={handleSelect}\n         minDate={config.min}\n         maxDate={config.max}\n         mergeDates\n-        placeholder={{ from: \"--\" }}\n+        placeholder={{ from: EMPTY_FILTER_PLACEHOLDER_TEXT }}\n         buttonVariant=\"transparent-with-text\"\n         buttonClassName={cn(\"rounded-none\", {\n           [COMMON_FILTER_ITEM_BORDER_CLASSNAME]: !isDisabled,\n           \"text-red-500\": isIncomplete,\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filter-value-input/date/single.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/rich-filters/filter-value-input/date/single.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/filter-value-input/date/single.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/filter-value-input/date/single.tsx\tcfb4a82 (commit)\n@@ -3,9 +3,9 @@\n // plane imports\n import { TDateFilterFieldConfig, TFilterConditionNodeForDisplay, TFilterProperty } from \"@plane/types\";\n import { cn, renderFormattedPayloadDate } from \"@plane/utils\";\n import { DateDropdown } from \"@/components/dropdowns/date\";\n-import { COMMON_FILTER_ITEM_BORDER_CLASSNAME } from \"../../shared\";\n+import { COMMON_FILTER_ITEM_BORDER_CLASSNAME, EMPTY_FILTER_PLACEHOLDER_TEXT } from \"../../shared\";\n \n type TSingleDateFilterValueInputProps<P extends TFilterProperty> = {\n   config: TDateFilterFieldConfig<string>;\n   condition: TFilterConditionNodeForDisplay<P, string>;\n@@ -33,9 +33,9 @@\n         })}\n         minDate={config.min}\n         maxDate={config.max}\n         icon={null}\n-        placeholder=\"--\"\n+        placeholder={EMPTY_FILTER_PLACEHOLDER_TEXT}\n         buttonVariant=\"transparent-with-text\"\n         isClearable={false}\n         closeOnSelect\n         defaultOpen={!conditionValue}\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filter-value-input/root.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/rich-filters/filter-value-input/root.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/filter-value-input/root.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/filter-value-input/root.tsx\tcfb4a82 (commit)\n@@ -1,5 +1,6 @@\n import React from \"react\";\n+\n import { observer } from \"mobx-react\";\n // plane imports\n import {\n   FILTER_FIELD_TYPE,\n@@ -10,25 +11,18 @@\n   TSingleSelectFilterFieldConfig,\n   TMultiSelectFilterFieldConfig,\n   TDateFilterFieldConfig,\n   TDateRangeFilterFieldConfig,\n-  TSupportedFilterFieldConfigs,\n   TFilterConditionNodeForDisplay,\n } from \"@plane/types\";\n // local imports\n+import { AdditionalFilterValueInput } from \"@/plane-web/components/rich-filters/filter-value-input/root\";\n+import { TFilterValueInputProps } from \"../shared\";\n import { DateRangeFilterValueInput } from \"./date/range\";\n import { SingleDateFilterValueInput } from \"./date/single\";\n import { MultiSelectFilterValueInput } from \"./select/multi\";\n import { SingleSelectFilterValueInput } from \"./select/single\";\n \n-type TFilterValueInputProps<P extends TFilterProperty, V extends TFilterValue> = {\n-  condition: TFilterConditionNodeForDisplay<P, V>;\n-  filterFieldConfig: TSupportedFilterFieldConfigs<V>;\n-  isDisabled?: boolean;\n-  onChange: (values: SingleOrArray<V>) => void;\n-};\n-\n-// TODO: Prevent type assertion\n export const FilterValueInput = observer(\n   <P extends TFilterProperty, V extends TFilterValue>(props: TFilterValueInputProps<P, V>) => {\n     const { condition, filterFieldConfig, isDisabled = false, onChange } = props;\n \n@@ -79,12 +73,7 @@\n         />\n       );\n     }\n \n-    // Fallback\n-    return (\n-      <div className=\"h-full flex items-center px-4 text-xs text-custom-text-400 transition-opacity duration-200 cursor-not-allowed\">\n-        Filter type not supported\n-      </div>\n-    );\n+    return <AdditionalFilterValueInput {...props} />;\n   }\n );\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filter-value-input/select/selected-options-display.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/rich-filters/filter-value-input/select/selected-options-display.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/filter-value-input/select/selected-options-display.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/filter-value-input/select/selected-options-display.tsx\tcfb4a82 (commit)\n@@ -2,8 +2,9 @@\n import { Transition } from \"@headlessui/react\";\n // plane imports\n import { SingleOrArray, IFilterOption, TFilterValue } from \"@plane/types\";\n import { cn, toFilterArray } from \"@plane/utils\";\n+import { EMPTY_FILTER_PLACEHOLDER_TEXT } from \"../../shared\";\n \n type TSelectedOptionsDisplayProps<V extends TFilterValue> = {\n   selectedValue: SingleOrArray<V>;\n   options: IFilterOption<V>[];\n@@ -12,9 +13,9 @@\n   fallbackText?: string;\n };\n \n export const SelectedOptionsDisplay = <V extends TFilterValue>(props: TSelectedOptionsDisplayProps<V>) => {\n-  const { selectedValue, options, displayCount = 2, emptyValue = \"--\", fallbackText } = props;\n+  const { selectedValue, options, displayCount = 2, emptyValue = EMPTY_FILTER_PLACEHOLDER_TEXT, fallbackText } = props;\n   // derived values\n   const selectedArray = toFilterArray(selectedValue);\n   const remainingCount = selectedArray.length - displayCount;\n   const selectedOptions = selectedArray\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filters-row.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/rich-filters/filters-row.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/filters-row.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/filters-row.tsx\tcfb4a82 (commit)\n@@ -5,12 +5,12 @@\n // plane imports\n import { Button } from \"@plane/propel/button\";\n import { IFilterInstance } from \"@plane/shared-state\";\n import { TExternalFilter, TFilterProperty } from \"@plane/types\";\n-import { cn, EHeaderVariant, Header } from \"@plane/ui\";\n+import { cn, EHeaderVariant, Header, Loader } from \"@plane/ui\";\n // local imports\n-import { AddFilterButton, TAddFilterButtonProps } from \"./add-filters-button\";\n-import { FilterItem } from \"./filter-item\";\n+import { AddFilterButton, TAddFilterButtonProps } from \"./add-filters/button\";\n+import { FilterItem } from \"./filter-item/root\";\n \n export type TFiltersRowProps<K extends TFilterProperty, E extends TExternalFilter> = {\n   buttonConfig?: TAddFilterButtonProps<K, E>[\"buttonConfig\"];\n   disabledAllOperations?: boolean;\n@@ -24,12 +24,19 @@\n };\n \n export const FiltersRow = observer(\n   <K extends TFilterProperty, E extends TExternalFilter>(props: TFiltersRowProps<K, E>) => {\n-    const { buttonConfig, disabledAllOperations = false, filter, variant = \"header\", trackerElements } = props;\n+    const {\n+      buttonConfig,\n+      disabledAllOperations: disabledAllOperationsProp = false,\n+      filter,\n+      variant = \"header\",\n+      trackerElements,\n+    } = props;\n     // states\n     const [isUpdating, setIsUpdating] = useState(false);\n     // derived values\n+    const disabledAllOperations = disabledAllOperationsProp || !filter.configManager.areConfigsReady;\n     const hasAnyConditions = filter.allConditionsForDisplay.length > 0;\n     const hasAvailableOperations =\n       !disabledAllOperations && (filter.canClearFilters || filter.canSaveView || filter.canUpdateView);\n \n@@ -139,21 +146,19 @@\n         {mainContent}\n       </Header>\n     );\n \n-    return (\n-      <Transition\n-        show={filter.isVisible}\n-        enter=\"transition-all duration-150 ease-out\"\n-        enterFrom=\"opacity-0 -translate-y-1\"\n-        enterTo=\"opacity-100 translate-y-0\"\n-        leave=\"transition-all duration-100 ease-in\"\n-        leaveFrom=\"opacity-100 translate-y-0\"\n-        leaveTo=\"opacity-0 -translate-y-1\"\n-      >\n-        {variant === \"modal\" ? ModalVariant : HeaderVariant}\n-      </Transition>\n-    );\n+    if (!filter.configManager.areConfigsReady && !hasAnyConditions) {\n+      return (\n+        <RowTransition show={filter.isVisible}>\n+          <Loader>\n+            <Loader.Item height=\"44px\" width=\"100%\" className={cn({ \"rounded-none\": variant === \"header\" })} />\n+          </Loader>\n+        </RowTransition>\n+      );\n+    }\n+\n+    return <RowTransition show={filter.isVisible}>{variant === \"modal\" ? ModalVariant : HeaderVariant}</RowTransition>;\n   }\n );\n \n const COMMON_OPERATION_BUTTON_CLASSNAME = \"py-1\";\n@@ -175,4 +180,23 @@\n   >\n     {props.children}\n   </Transition>\n ));\n+\n+type TRowTransitionProps = {\n+  children: React.ReactNode;\n+  show: boolean;\n+};\n+\n+const RowTransition = observer((props: TRowTransitionProps) => (\n+  <Transition\n+    show={props.show}\n+    enter=\"transition-all duration-150 ease-out\"\n+    enterFrom=\"opacity-0 -translate-y-1\"\n+    enterTo=\"opacity-100 translate-y-0\"\n+    leave=\"transition-all duration-100 ease-in\"\n+    leaveFrom=\"opacity-100 translate-y-0\"\n+    leaveTo=\"opacity-0 -translate-y-1\"\n+  >\n+    {props.children}\n+  </Transition>\n+));\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/filters-toggle.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/rich-filters/filters-toggle.tsx\n===================================================================\n--- apps/web/core/components/rich-filters/filters-toggle.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/filters-toggle.tsx\tcfb4a82 (commit)\n@@ -4,9 +4,9 @@\n import { IFilterInstance } from \"@plane/shared-state\";\n import { TExternalFilter, TFilterProperty } from \"@plane/types\";\n import { cn } from \"@plane/ui\";\n // components\n-import { AddFilterButton } from \"@/components/rich-filters/add-filters-button\";\n+import { AddFilterButton } from \"@/components/rich-filters/add-filters/button\";\n \n type TFiltersToggleProps<P extends TFilterProperty, E extends TExternalFilter> = {\n   filter: IFilterInstance<P, E> | undefined;\n };\n"
        },
        {
          "path": "apps/web/core/components/rich-filters/shared.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/components/rich-filters/shared.ts\n===================================================================\n--- apps/web/core/components/rich-filters/shared.ts\t9f41e92 (parent)\n+++ apps/web/core/components/rich-filters/shared.ts\tcfb4a82 (commit)\n@@ -1,1 +1,18 @@\n+import {\n+  SingleOrArray,\n+  TFilterConditionNodeForDisplay,\n+  TFilterProperty,\n+  TFilterValue,\n+  TSupportedFilterFieldConfigs,\n+} from \"@plane/types\";\n+\n export const COMMON_FILTER_ITEM_BORDER_CLASSNAME = \"border-r border-custom-border-200\";\n+\n+export const EMPTY_FILTER_PLACEHOLDER_TEXT = \"--\";\n+\n+export type TFilterValueInputProps<P extends TFilterProperty, V extends TFilterValue> = {\n+  condition: TFilterConditionNodeForDisplay<P, V>;\n+  filterFieldConfig: TSupportedFilterFieldConfigs<V>;\n+  isDisabled?: boolean;\n+  onChange: (values: SingleOrArray<V>) => void;\n+};\n"
        },
        {
          "path": "apps/web/core/components/work-item-filters/filters-hoc/base.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/work-item-filters/filters-hoc/base.tsx\n===================================================================\n--- apps/web/core/components/work-item-filters/filters-hoc/base.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/work-item-filters/filters-hoc/base.tsx\tcfb4a82 (commit)\n@@ -93,8 +93,9 @@\n     },\n     [deleteFilter, entityType, workItemEntityID]\n   );\n \n+  workItemLayoutFilter.configManager.setAreConfigsReady(workItemFiltersConfig.areAllConfigsInitialized);\n   workItemLayoutFilter.configManager.registerAll(workItemFiltersConfig.configs);\n \n   return <>{typeof children === \"function\" ? children({ filter: workItemLayoutFilter }) : children}</>;\n });\n"
        },
        {
          "path": "apps/web/core/components/work-item-filters/filters-hoc/project-level.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/work-item-filters/filters-hoc/project-level.tsx\n===================================================================\n--- apps/web/core/components/work-item-filters/filters-hoc/project-level.tsx\t9f41e92 (parent)\n+++ apps/web/core/components/work-item-filters/filters-hoc/project-level.tsx\tcfb4a82 (commit)\n@@ -166,8 +166,9 @@\n       />\n       <WorkItemFiltersHOC\n         {...props}\n         {...getAdditionalProjectLevelFiltersHOCProps({\n+          entityType: props.entityType,\n           workspaceSlug,\n           projectId,\n         })}\n         cycleIds={getProjectCycleIds(projectId) ?? undefined}\n"
        },
        {
          "path": "packages/shared-state/src/store/rich-filters/config-manager.ts",
          "status": "modified",
          "diff": "Index: packages/shared-state/src/store/rich-filters/config-manager.ts\n===================================================================\n--- packages/shared-state/src/store/rich-filters/config-manager.ts\t9f41e92 (parent)\n+++ packages/shared-state/src/store/rich-filters/config-manager.ts\tcfb4a82 (commit)\n@@ -23,16 +23,18 @@\n export interface IFilterConfigManager<P extends TFilterProperty> {\n   // observables\n   filterConfigs: Map<P, IFilterConfig<P, TFilterValue>>; // filter property -> config\n   configOptions: TConfigOptions;\n+  areConfigsReady: boolean;\n   // computed\n   allAvailableConfigs: IFilterConfig<P, TFilterValue>[];\n   // computed functions\n   getConfigByProperty: (property: P) => IFilterConfig<P, TFilterValue> | undefined;\n   // helpers\n   register: <C extends TFilterConfig<P, TFilterValue>>(config: C) => void;\n   registerAll: (configs: TFilterConfig<P, TFilterValue>[]) => void;\n   updateConfigByProperty: (property: P, configUpdates: Partial<TFilterConfig<P, TFilterValue>>) => void;\n+  setAreConfigsReady: (value: boolean) => void;\n }\n \n /**\n  * Parameters for initializing the FilterConfigManager.\n@@ -56,8 +58,9 @@\n {\n   // observables\n   filterConfigs: IFilterConfigManager<P>[\"filterConfigs\"];\n   configOptions: IFilterConfigManager<P>[\"configOptions\"];\n+  areConfigsReady: IFilterConfigManager<P>[\"areConfigsReady\"];\n   // parent filter instance\n   private _filterInstance: IFilterInstance<P, E>;\n \n   /**\n@@ -68,20 +71,23 @@\n    */\n   constructor(filterInstance: IFilterInstance<P, E>, params: TConfigManagerParams) {\n     this.filterConfigs = new Map<P, IFilterConfig<P>>();\n     this.configOptions = this._initializeConfigOptions(params.options);\n+    this.areConfigsReady = true;\n     // parent filter instance\n     this._filterInstance = filterInstance;\n \n     makeObservable(this, {\n       filterConfigs: observable,\n       configOptions: observable,\n+      areConfigsReady: observable,\n       // computed\n       allAvailableConfigs: computed,\n       // helpers\n       register: action,\n       registerAll: action,\n       updateConfigByProperty: action,\n+      setAreConfigsReady: action,\n     });\n   }\n \n   // ------------ computed ------------\n@@ -145,8 +151,16 @@\n     const prevConfig = this.filterConfigs.get(property);\n     prevConfig?.mutate(configUpdates);\n   });\n \n+  /**\n+   * Updates the configs ready state.\n+   * @param value - The new configs ready state.\n+   */\n+  setAreConfigsReady: IFilterConfigManager<P>[\"setAreConfigsReady\"] = action((value) => {\n+    this.areConfigsReady = value;\n+  });\n+\n   // ------------ private computed ------------\n \n   private get _allConfigs(): IFilterConfig<P, TFilterValue>[] {\n     return Array.from(this.filterConfigs.values());\n"
        },
        {
          "path": "packages/shared-state/src/store/rich-filters/filter-helpers.ts",
          "status": "modified",
          "diff": "Index: packages/shared-state/src/store/rich-filters/filter-helpers.ts\n===================================================================\n--- packages/shared-state/src/store/rich-filters/filter-helpers.ts\t9f41e92 (parent)\n+++ packages/shared-state/src/store/rich-filters/filter-helpers.ts\tcfb4a82 (commit)\n@@ -5,8 +5,9 @@\n import {\n   IFilterAdapter,\n   LOGICAL_OPERATOR,\n   TSupportedOperators,\n+  TFilterConditionNode,\n   TFilterExpression,\n   TFilterValue,\n   TFilterProperty,\n   TExternalFilter,\n@@ -42,11 +43,18 @@\n     groupOperator: TLogicalOperator,\n     condition: TFilterConditionPayload<P, V>,\n     isNegation: boolean\n   ) => TFilterExpression<P> | null;\n+  handleConditionPropertyUpdate: (\n+    expression: TFilterExpression<P>,\n+    conditionId: string,\n+    property: P,\n+    operator: TSupportedOperators,\n+    isNegation: boolean\n+  ) => TFilterExpression<P> | null;\n   // group operations\n   restructureExpressionForOperatorChange: (\n-    expression: TFilterExpression<P> | null,\n+    expression: TFilterExpression<P>,\n     conditionId: string,\n     newOperator: TSupportedOperators,\n     isNegation: boolean,\n     shouldResetValue: boolean\n@@ -161,8 +169,30 @@\n     condition,\n     isNegation\n   ) => this._addConditionByOperator(expression, groupOperator, this._getConditionPayloadToAdd(condition, isNegation));\n \n+  /**\n+   * Updates the property and operator of a condition in the filter expression.\n+   * This method updates the property, operator, resets the value, and handles negation properly.\n+   * @param expression - The filter expression to operate on\n+   * @param conditionId - The ID of the condition being updated\n+   * @param property - The new property for the condition\n+   * @param operator - The new operator for the condition\n+   * @param isNegation - Whether the condition should be negated\n+   * @returns The updated expression\n+   */\n+  handleConditionPropertyUpdate: IFilterInstanceHelper<P, E>[\"handleConditionPropertyUpdate\"] = (\n+    expression,\n+    conditionId,\n+    property,\n+    operator,\n+    isNegation\n+  ) => {\n+    const payload = { property, operator, value: undefined };\n+\n+    return this._updateCondition(expression, conditionId, payload, isNegation);\n+  };\n+\n   // ------------ group operations ------------\n \n   /**\n    * Restructures the expression when a condition's operator changes between positive and negative.\n@@ -176,19 +206,14 @@\n   restructureExpressionForOperatorChange: IFilterInstanceHelper<P, E>[\"restructureExpressionForOperatorChange\"] = (\n     expression,\n     conditionId,\n     newOperator,\n-    _isNegation,\n+    isNegation,\n     shouldResetValue\n   ) => {\n-    if (!expression) return null;\n-\n     const payload = shouldResetValue ? { operator: newOperator, value: undefined } : { operator: newOperator };\n \n-    // Update the condition with the new operator\n-    updateNodeInExpression(expression, conditionId, payload);\n-\n-    return expression;\n+    return this._updateCondition(expression, conditionId, payload, isNegation);\n   };\n \n   // ------------ private helpers ------------\n \n@@ -226,5 +251,25 @@\n         console.warn(`Unsupported logical operator: ${groupOperator}`);\n         return expression;\n     }\n   }\n+\n+  /**\n+   * Updates a condition with the given payload and handles negation wrapping/unwrapping.\n+   * @param expression - The filter expression to operate on\n+   * @param conditionId - The ID of the condition being updated\n+   * @param payload - The payload to update the condition with\n+   * @param isNegation - Whether the condition should be negated\n+   * @returns The updated expression with proper negation handling\n+   */\n+  private _updateCondition = (\n+    expression: TFilterExpression<P>,\n+    conditionId: string,\n+    payload: Partial<TFilterConditionNode<P, TFilterValue>>,\n+    _isNegation: boolean\n+  ): TFilterExpression<P> | null => {\n+    // Update the condition with the payload\n+    updateNodeInExpression(expression, conditionId, payload);\n+\n+    return expression;\n+  };\n }\n"
        },
        {
          "path": "packages/shared-state/src/store/rich-filters/filter.ts",
          "status": "modified",
          "diff": "Index: packages/shared-state/src/store/rich-filters/filter.ts\n===================================================================\n--- packages/shared-state/src/store/rich-filters/filter.ts\t9f41e92 (parent)\n+++ packages/shared-state/src/store/rich-filters/filter.ts\tcfb4a82 (commit)\n@@ -1,5 +1,5 @@\n-import { cloneDeep } from \"lodash-es\";\n+import { cloneDeep, isEqual } from \"lodash-es\";\n import { action, computed, makeObservable, observable, toJS } from \"mobx\";\n import { computedFn } from \"mobx-utils\";\n import { v4 as uuidv4 } from \"uuid\";\n // plane imports\n@@ -100,8 +100,14 @@\n     groupOperator: TLogicalOperator,\n     condition: TFilterConditionPayload<P, V>,\n     isNegation: boolean\n   ) => void;\n+  updateConditionProperty: (\n+    conditionId: string,\n+    property: P,\n+    operator: TSupportedOperators,\n+    isNegation: boolean\n+  ) => void;\n   updateConditionOperator: (conditionId: string, operator: TSupportedOperators, isNegation: boolean) => void;\n   updateConditionValue: <V extends TFilterValue>(conditionId: string, value: SingleOrArray<V>) => void;\n   removeCondition: (conditionId: string) => void;\n   // config actions\n@@ -360,8 +366,35 @@\n     }\n   });\n \n   /**\n+   * Updates the property of a condition in the filter expression.\n+   * @param conditionId - The id of the condition to update.\n+   * @param property - The new property for the condition.\n+   */\n+  updateConditionProperty: IFilterInstance<P, E>[\"updateConditionProperty\"] = action(\n+    (conditionId: string, property: P, operator: TSupportedOperators, isNegation: boolean) => {\n+      if (!this.expression) return;\n+      const conditionBeforeUpdate = cloneDeep(findNodeById(this.expression, conditionId));\n+      if (!conditionBeforeUpdate || conditionBeforeUpdate.type !== FILTER_NODE_TYPE.CONDITION) return;\n+\n+      // Update the condition property\n+      const updatedExpression = this.helper.handleConditionPropertyUpdate(\n+        this.expression,\n+        conditionId,\n+        property,\n+        operator,\n+        isNegation\n+      );\n+\n+      if (updatedExpression) {\n+        this.expression = updatedExpression;\n+        this._notifyExpressionChange();\n+      }\n+    }\n+  );\n+\n+  /**\n    * Updates the operator of a condition in the filter expression.\n    * @param conditionId - The id of the condition to update.\n    * @param operator - The new operator for the condition.\n    */\n@@ -409,14 +442,25 @@\n     <V extends TFilterValue>(conditionId: string, value: SingleOrArray<V>) => {\n       // If the expression is not valid, return\n       if (!this.expression) return;\n \n+      // Get the condition before update\n+      const conditionBeforeUpdate = cloneDeep(findNodeById(this.expression, conditionId));\n+\n+      // If the condition is not valid, return\n+      if (!conditionBeforeUpdate || conditionBeforeUpdate.type !== FILTER_NODE_TYPE.CONDITION) return;\n+\n       // If the value is not valid, remove the condition\n       if (!hasValidValue(value)) {\n         this.removeCondition(conditionId);\n         return;\n       }\n \n+      // If the value is the same as the condition before update, return\n+      if (isEqual(conditionBeforeUpdate.value, value)) {\n+        return;\n+      }\n+\n       // Update the condition value\n       updateNodeInExpression(this.expression, conditionId, {\n         value,\n       });\n"
        },
        {
          "path": "packages/shared-state/src/store/work-item-filters/adapter.ts",
          "status": "modified",
          "diff": "Index: packages/shared-state/src/store/work-item-filters/adapter.ts\n===================================================================\n--- packages/shared-state/src/store/work-item-filters/adapter.ts\t9f41e92 (parent)\n+++ packages/shared-state/src/store/work-item-filters/adapter.ts\tcfb4a82 (commit)\n@@ -1,8 +1,9 @@\n // plane imports\n import { isEmpty } from \"lodash-es\";\n import {\n   LOGICAL_OPERATOR,\n+  MULTI_VALUE_OPERATORS,\n   SingleOrArray,\n   TFilterExpression,\n   TFilterValue,\n   TSupportedOperators,\n@@ -160,9 +161,10 @@\n     const property = key.substring(0, lastDoubleUnderscoreIndex);\n     const operator = key.substring(lastDoubleUnderscoreIndex + 2);\n \n     // Validate property is in allowed list\n-    if (!WORK_ITEM_FILTER_PROPERTY_KEYS.includes(property as TWorkItemFilterProperty)) {\n+    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n+    if (!WORK_ITEM_FILTER_PROPERTY_KEYS.includes(property as any) && !property.startsWith(\"customproperty_\")) {\n       return false;\n     }\n \n     // Validate operator is not empty\n@@ -191,19 +193,14 @@\n \n     // Find the last occurrence of '__' to separate property from operator\n     const lastDoubleUnderscoreIndex = key.lastIndexOf(\"__\");\n     const property = key.substring(0, lastDoubleUnderscoreIndex);\n-    const operator = key.substring(lastDoubleUnderscoreIndex + 2);\n+    const operator = key.substring(lastDoubleUnderscoreIndex + 2) as TSupportedOperators;\n \n     const rawValue = data[key as TWorkItemFilterConditionKey];\n \n-    if (typeof rawValue !== \"string\") {\n-      console.error(`Filter value must be a string, got: ${typeof rawValue}`);\n-      return null;\n-    }\n-\n     // Parse comma-separated values\n-    const parsedValue = this._parseFilterValue(rawValue);\n+    const parsedValue = MULTI_VALUE_OPERATORS.includes(operator) ? this._parseFilterValue(rawValue) : rawValue;\n \n     return [property as TWorkItemFilterProperty, operator as TSupportedOperators, parsedValue];\n   };\n \n@@ -211,9 +208,11 @@\n    * Parses filter value from string format\n    * @param value - The string value to parse\n    * @returns Parsed value as string or array of strings\n    */\n-  private _parseFilterValue = (value: string): SingleOrArray<TFilterValue> => {\n+  private _parseFilterValue = (value: TFilterValue): SingleOrArray<TFilterValue> => {\n+    if (!value) return value;\n+\n     if (typeof value !== \"string\") return value;\n \n     // Handle empty string\n     if (value === \"\") return value;\n"
        },
        {
          "path": "packages/types/src/rich-filters/config/filter-config.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/rich-filters/config/filter-config.ts\n===================================================================\n--- packages/types/src/rich-filters/config/filter-config.ts\t9f41e92 (parent)\n+++ packages/types/src/rich-filters/config/filter-config.ts\tcfb4a82 (commit)\n@@ -14,5 +14,7 @@\n   icon?: React.FC<React.SVGAttributes<SVGElement>>;\n   isEnabled: boolean;\n   allowMultipleFilters?: boolean;\n   supportedOperatorConfigsMap: TOperatorConfigMap<V>;\n+  rightContent?: React.ReactNode; // content to display on the right side of the filter option in the dropdown\n+  tooltipContent?: React.ReactNode; // content to display when hovering over the applied filter item in the filter list\n };\n"
        },
        {
          "path": "packages/types/src/rich-filters/operators/core.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/rich-filters/operators/core.ts\n===================================================================\n--- packages/types/src/rich-filters/operators/core.ts\t9f41e92 (parent)\n+++ packages/types/src/rich-filters/operators/core.ts\tcfb4a82 (commit)\n@@ -26,8 +26,13 @@\n   RANGE: \"range\",\n } as const;\n \n /**\n+ * Core operators that support multiple values\n+ */\n+export const CORE_MULTI_VALUE_OPERATORS = [CORE_COLLECTION_OPERATOR.IN, CORE_COMPARISON_OPERATOR.RANGE] as const;\n+\n+/**\n  * All core operators\n  */\n export const CORE_OPERATORS = {\n   ...CORE_EQUALITY_OPERATOR,\n"
        },
        {
          "path": "packages/types/src/rich-filters/operators/extended.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/rich-filters/operators/extended.ts\n===================================================================\n--- packages/types/src/rich-filters/operators/extended.ts\t9f41e92 (parent)\n+++ packages/types/src/rich-filters/operators/extended.ts\tcfb4a82 (commit)\n@@ -18,8 +18,13 @@\n  */\n export const EXTENDED_COMPARISON_OPERATOR = {} as const;\n \n /**\n+ * Extended operators that support multiple values\n+ */\n+export const EXTENDED_MULTI_VALUE_OPERATORS = [] as const;\n+\n+/**\n  * All extended operators\n  */\n export const EXTENDED_OPERATORS = {\n   ...EXTENDED_EQUALITY_OPERATOR,\n"
        },
        {
          "path": "packages/types/src/rich-filters/operators/index.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/rich-filters/operators/index.ts\n===================================================================\n--- packages/types/src/rich-filters/operators/index.ts\t9f41e92 (parent)\n+++ packages/types/src/rich-filters/operators/index.ts\tcfb4a82 (commit)\n@@ -3,15 +3,17 @@\n   CORE_EQUALITY_OPERATOR,\n   CORE_COLLECTION_OPERATOR,\n   CORE_COMPARISON_OPERATOR,\n   TCoreSupportedOperators,\n+  CORE_MULTI_VALUE_OPERATORS,\n } from \"./core\";\n import {\n   EXTENDED_LOGICAL_OPERATOR,\n   EXTENDED_EQUALITY_OPERATOR,\n   EXTENDED_COLLECTION_OPERATOR,\n   EXTENDED_COMPARISON_OPERATOR,\n   TExtendedSupportedOperators,\n+  EXTENDED_MULTI_VALUE_OPERATORS,\n } from \"./extended\";\n \n // -------- COMPOSED OPERATORS --------\n \n@@ -34,8 +36,13 @@\n   ...CORE_COMPARISON_OPERATOR,\n   ...EXTENDED_COMPARISON_OPERATOR,\n } as const;\n \n+export const MULTI_VALUE_OPERATORS: ReadonlyArray<TSupportedOperators> = [\n+  ...CORE_MULTI_VALUE_OPERATORS,\n+  ...EXTENDED_MULTI_VALUE_OPERATORS,\n+] as const;\n+\n // -------- COMPOSED TYPES --------\n \n export type TLogicalOperator = (typeof LOGICAL_OPERATOR)[keyof typeof LOGICAL_OPERATOR];\n export type TEqualityOperator = (typeof EQUALITY_OPERATOR)[keyof typeof EQUALITY_OPERATOR];\n"
        },
        {
          "path": "packages/types/src/view-props.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/view-props.ts\n===================================================================\n--- packages/types/src/view-props.ts\t9f41e92 (parent)\n+++ packages/types/src/view-props.ts\tcfb4a82 (commit)\n@@ -99,15 +99,17 @@\n   \"state_id\",\n   \"cycle_id\",\n   \"module_id\",\n   \"project_id\",\n+  \"created_at\",\n+  \"updated_at\",\n ] as const;\n export type TWorkItemFilterProperty = (typeof WORK_ITEM_FILTER_PROPERTY_KEYS)[number];\n \n export type TWorkItemFilterConditionKey = `${TWorkItemFilterProperty}__${TSupportedOperators}`;\n \n export type TWorkItemFilterConditionData = Partial<{\n-  [K in TWorkItemFilterConditionKey]: string;\n+  [K in TWorkItemFilterConditionKey]: string | boolean | number;\n }>;\n \n export type TWorkItemFilterAndGroup = {\n   [LOGICAL_OPERATOR.AND]: TWorkItemFilterConditionData[];\n"
        },
        {
          "path": "packages/ui/src/dropdowns/custom-search-select.tsx",
          "status": "modified",
          "diff": "Index: packages/ui/src/dropdowns/custom-search-select.tsx\n===================================================================\n--- packages/ui/src/dropdowns/custom-search-select.tsx\t9f41e92 (parent)\n+++ packages/ui/src/dropdowns/custom-search-select.tsx\tcfb4a82 (commit)\n@@ -138,16 +138,16 @@\n               createPortal(\n                 <Combobox.Options data-prevent-outside-click static>\n                   <div\n                     className={cn(\n-                      \"my-1 overflow-y-scroll rounded-md border-[0.5px] border-custom-border-300 bg-custom-background-100 px-2 py-2.5 text-xs shadow-custom-shadow-rg focus:outline-none min-w-48 whitespace-nowrap z-30\",\n+                      \"my-1 overflow-y-scroll rounded-md border-[0.5px] border-custom-border-300 bg-custom-background-100 py-2.5 text-xs shadow-custom-shadow-rg focus:outline-none min-w-48 whitespace-nowrap z-30\",\n                       optionsClassName\n                     )}\n                     ref={setPopperElement}\n                     style={styles.popper}\n                     {...attributes.popper}\n                   >\n-                    <div className=\"flex items-center gap-1.5 rounded border border-custom-border-100 bg-custom-background-90 px-2\">\n+                    <div className=\"flex items-center gap-1.5 rounded border border-custom-border-100 bg-custom-background-90 px-2 mx-2\">\n                       <Search className=\"h-3.5 w-3.5 text-custom-text-400\" strokeWidth={1.5} />\n                       <Combobox.Input\n                         className=\"w-full bg-transparent py-1 text-xs text-custom-text-200 placeholder:text-custom-text-400 focus:outline-none\"\n                         value={query}\n@@ -156,14 +156,15 @@\n                         displayValue={(assigned: any) => assigned?.name}\n                       />\n                     </div>\n                     <div\n-                      className={cn(\"mt-2 space-y-1 overflow-y-scroll\", {\n+                      className={cn(\"mt-2 px-2 space-y-1 overflow-y-scroll vertical-scrollbar scrollbar-xs\", {\n+                        \"max-h-96\": maxHeight === \"2xl\",\n+                        \"max-h-80\": maxHeight === \"xl\",\n                         \"max-h-60\": maxHeight === \"lg\",\n                         \"max-h-48\": maxHeight === \"md\",\n                         \"max-h-36\": maxHeight === \"rg\",\n                         \"max-h-28\": maxHeight === \"sm\",\n-                        \"max-h-full\": maxHeight === \"full\",\n                       })}\n                     >\n                       {filteredOptions ? (\n                         filteredOptions.length > 0 ? (\n"
        },
        {
          "path": "packages/ui/src/dropdowns/helper.tsx",
          "status": "modified",
          "diff": "Index: packages/ui/src/dropdowns/helper.tsx\n===================================================================\n--- packages/ui/src/dropdowns/helper.tsx\t9f41e92 (parent)\n+++ packages/ui/src/dropdowns/helper.tsx\tcfb4a82 (commit)\n@@ -23,9 +23,9 @@\n   customButton?: React.ReactNode;\n   disabled?: boolean;\n   input?: boolean;\n   label?: string | React.ReactNode;\n-  maxHeight?: \"sm\" | \"rg\" | \"md\" | \"lg\" | \"full\";\n+  maxHeight?: \"sm\" | \"rg\" | \"md\" | \"lg\" | \"xl\" | \"2xl\";\n   noChevron?: boolean;\n   chevronClassName?: string;\n   onOpen?: () => void;\n   optionsClassName?: string;\n"
        },
        {
          "path": "packages/utils/src/index.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/index.ts\n===================================================================\n--- packages/utils/src/index.ts\t9f41e92 (parent)\n+++ packages/utils/src/index.ts\tcfb4a82 (commit)\n@@ -13,8 +13,9 @@\n export * from \"./file\";\n export * from \"./filter\";\n export * from \"./get-icon-for-link\";\n export * from \"./intake\";\n+export * from \"./loader\";\n export * from \"./math\";\n export * from \"./module\";\n export * from \"./notification\";\n export * from \"./page\";\n"
        },
        {
          "path": "packages/utils/src/loader.ts",
          "status": "added",
          "diff": "Index: packages/utils/src/loader.ts\n===================================================================\n--- packages/utils/src/loader.ts\t9f41e92 (parent)\n+++ packages/utils/src/loader.ts\tcfb4a82 (commit)\n@@ -0,0 +1,4 @@\n+import { TLoader } from \"@plane/types\";\n+\n+// checks if a loader has finished initialization\n+export const isLoaderReady = (loader: TLoader | undefined) => loader !== \"init-loader\";\n"
        },
        {
          "path": "packages/utils/src/rich-filters/factories/configs/index.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/rich-filters/factories/configs/index.ts\n===================================================================\n--- packages/utils/src/rich-filters/factories/configs/index.ts\t9f41e92 (parent)\n+++ packages/utils/src/rich-filters/factories/configs/index.ts\tcfb4a82 (commit)\n@@ -1,2 +1,3 @@\n export * from \"./core\";\n export * from \"./shared\";\n+export * from \"./properties\";\n"
        },
        {
          "path": "packages/utils/src/rich-filters/factories/configs/properties/date.ts",
          "status": "added",
          "diff": "Index: packages/utils/src/rich-filters/factories/configs/properties/date.ts\n===================================================================\n--- packages/utils/src/rich-filters/factories/configs/properties/date.ts\t9f41e92 (parent)\n+++ packages/utils/src/rich-filters/factories/configs/properties/date.ts\tcfb4a82 (commit)\n@@ -0,0 +1,27 @@\n+// plane imports\n+import { TFilterProperty } from \"@plane/types\";\n+// local imports\n+import { createFilterConfig, TCreateDateFilterParams, TCreateFilterConfig } from \"../shared\";\n+import { getSupportedDateOperators, TCustomPropertyFilterParams } from \"./shared\";\n+\n+/**\n+ * Date property filter specific params\n+ */\n+export type TCreateDatePropertyFilterParams = TCustomPropertyFilterParams<Date> & TCreateDateFilterParams;\n+\n+/**\n+ * Get the date property filter config\n+ * @param params - The filter params\n+ * @returns The date property filter config\n+ */\n+export const getDatePropertyFilterConfig =\n+  <P extends TFilterProperty>(key: P): TCreateFilterConfig<P, TCreateDatePropertyFilterParams> =>\n+  (params: TCreateDatePropertyFilterParams) =>\n+    createFilterConfig({\n+      id: key,\n+      ...params,\n+      label: params.propertyDisplayName,\n+      icon: params.filterIcon,\n+      allowMultipleFilters: true,\n+      supportedOperatorConfigsMap: getSupportedDateOperators(params),\n+    });\n"
        },
        {
          "path": "packages/utils/src/rich-filters/factories/configs/properties/index.ts",
          "status": "added",
          "diff": "Index: packages/utils/src/rich-filters/factories/configs/properties/index.ts\n===================================================================\n--- packages/utils/src/rich-filters/factories/configs/properties/index.ts\t9f41e92 (parent)\n+++ packages/utils/src/rich-filters/factories/configs/properties/index.ts\tcfb4a82 (commit)\n@@ -0,0 +1,3 @@\n+export * from \"./date\";\n+export * from \"./member-picker\";\n+export * from \"./shared\";\n"
        },
        {
          "path": "packages/utils/src/rich-filters/factories/configs/properties/member-picker.ts",
          "status": "added",
          "diff": "Index: packages/utils/src/rich-filters/factories/configs/properties/member-picker.ts\n===================================================================\n--- packages/utils/src/rich-filters/factories/configs/properties/member-picker.ts\t9f41e92 (parent)\n+++ packages/utils/src/rich-filters/factories/configs/properties/member-picker.ts\tcfb4a82 (commit)\n@@ -0,0 +1,30 @@\n+// plane imports\n+import { EQUALITY_OPERATOR, IUserLite, TFilterProperty } from \"@plane/types\";\n+// local imports\n+import { createFilterConfig, createOperatorConfigEntry, TCreateFilterConfig } from \"../shared\";\n+import { getMemberMultiSelectConfig, TCreateUserFilterParams, TCustomPropertyFilterParams } from \"./shared\";\n+\n+/**\n+ * Member picker property filter specific params\n+ */\n+type TCreateMemberPickerPropertyFilterParams = TCustomPropertyFilterParams<IUserLite> & TCreateUserFilterParams;\n+\n+/**\n+ * Get the member picker property filter config\n+ * @param params - The filter params\n+ * @returns The member picker property filter config\n+ */\n+export const getMemberPickerPropertyFilterConfig =\n+  <P extends TFilterProperty>(key: P): TCreateFilterConfig<P, TCreateMemberPickerPropertyFilterParams> =>\n+  (params: TCreateMemberPickerPropertyFilterParams) =>\n+    createFilterConfig({\n+      id: key,\n+      ...params,\n+      label: params.propertyDisplayName,\n+      icon: params.filterIcon,\n+      supportedOperatorConfigsMap: new Map([\n+        createOperatorConfigEntry(EQUALITY_OPERATOR.EXACT, params, (updatedParams) =>\n+          getMemberMultiSelectConfig(updatedParams, EQUALITY_OPERATOR.EXACT)\n+        ),\n+      ]),\n+    });\n"
        },
        {
          "path": "packages/utils/src/rich-filters/factories/configs/properties/shared.ts",
          "status": "added",
          "diff": "Index: packages/utils/src/rich-filters/factories/configs/properties/shared.ts\n===================================================================\n--- packages/utils/src/rich-filters/factories/configs/properties/shared.ts\t9f41e92 (parent)\n+++ packages/utils/src/rich-filters/factories/configs/properties/shared.ts\tcfb4a82 (commit)\n@@ -0,0 +1,96 @@\n+// plane imports\n+import {\n+  COMPARISON_OPERATOR,\n+  EQUALITY_OPERATOR,\n+  IProject,\n+  IUserLite,\n+  TOperatorConfigMap,\n+  TSupportedOperators,\n+} from \"@plane/types\";\n+// local imports\n+import { getDatePickerConfig, getDateRangePickerConfig, getMultiSelectConfig } from \"../core\";\n+import {\n+  createOperatorConfigEntry,\n+  IFilterIconConfig,\n+  TCreateDateFilterParams,\n+  TCreateFilterConfigParams,\n+} from \"../shared\";\n+\n+// ------------ Base User Filter Types ------------\n+\n+/**\n+ * User filter specific params\n+ */\n+export type TCreateUserFilterParams = TCreateFilterConfigParams &\n+  IFilterIconConfig<IUserLite> & {\n+    members: IUserLite[];\n+  };\n+\n+/**\n+ * Helper to get the member multi select config\n+ * @param params - The filter params\n+ * @returns The member multi select config\n+ */\n+export const getMemberMultiSelectConfig = (params: TCreateUserFilterParams, singleValueOperator: TSupportedOperators) =>\n+  getMultiSelectConfig<IUserLite, string, IUserLite>(\n+    {\n+      items: params.members,\n+      getId: (member) => member.id,\n+      getLabel: (member) => member.display_name,\n+      getValue: (member) => member.id,\n+      getIconData: (member) => member,\n+    },\n+    {\n+      singleValueOperator,\n+      ...params,\n+    },\n+    {\n+      ...params,\n+    }\n+  );\n+\n+// ------------ Date Operators ------------\n+\n+export const getSupportedDateOperators = (params: TCreateDateFilterParams): TOperatorConfigMap<Date> =>\n+  new Map([\n+    createOperatorConfigEntry(EQUALITY_OPERATOR.EXACT, params, (updatedParams) => getDatePickerConfig(updatedParams)),\n+    createOperatorConfigEntry(COMPARISON_OPERATOR.RANGE, params, (updatedParams) =>\n+      getDateRangePickerConfig(updatedParams)\n+    ),\n+  ]);\n+\n+// ------------ Project filter ------------\n+\n+/**\n+ * Project filter specific params\n+ */\n+export type TCreateProjectFilterParams = TCreateFilterConfigParams &\n+  IFilterIconConfig<IProject> & {\n+    projects: IProject[];\n+  };\n+\n+/**\n+ * Helper to get the project multi select config\n+ * @param params - The filter params\n+ * @returns The member multi select config\n+ */\n+export const getProjectMultiSelectConfig = (\n+  params: TCreateProjectFilterParams,\n+  singleValueOperator: TSupportedOperators\n+) =>\n+  getMultiSelectConfig<IProject, string, IProject>(\n+    {\n+      items: params.projects,\n+      getId: (project) => project.id,\n+      getLabel: (project) => project.name,\n+      getValue: (project) => project.id,\n+      getIconData: (project) => project,\n+    },\n+    {\n+      singleValueOperator,\n+      ...params,\n+    },\n+    {\n+      ...params,\n+    }\n+  );\n"
        },
        {
          "path": "packages/utils/src/rich-filters/factories/configs/shared.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/rich-filters/factories/configs/shared.ts\n===================================================================\n--- packages/utils/src/rich-filters/factories/configs/shared.ts\t9f41e92 (parent)\n+++ packages/utils/src/rich-filters/factories/configs/shared.ts\tcfb4a82 (commit)\n@@ -28,16 +28,23 @@\n  */\n export type TCreateFilterConfigParams = Omit<TBaseFilterFieldConfig, \"isOperatorEnabled\"> & {\n   isEnabled: boolean;\n   allowedOperators: Set<TSupportedOperators>;\n+  rightContent?: React.ReactNode; // content to display on the right side of the filter option in the dropdown\n+  tooltipContent?: React.ReactNode; // content to display when hovering over the applied filter item in the filter list\n };\n \n /**\n+ * Type for filter icon type\n+ */\n+export type TFilterIconType = string | number | boolean | object | undefined;\n+\n+/**\n  * Icon configuration for filters and their options.\n  * - filterIcon: Optional icon for the filter\n  * - getOptionIcon: Function to get icon for specific option values\n  */\n-export interface IFilterIconConfig<T extends string | number | boolean | object | undefined = undefined> {\n+export interface IFilterIconConfig<T extends TFilterIconType = undefined> {\n   filterIcon?: React.FC<React.SVGAttributes<SVGElement>>;\n   getOptionIcon?: (value: T) => React.ReactNode;\n }\n \n"
        },
        {
          "path": "packages/utils/src/rich-filters/factories/index.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/rich-filters/factories/index.ts\n===================================================================\n--- packages/utils/src/rich-filters/factories/index.ts\t9f41e92 (parent)\n+++ packages/utils/src/rich-filters/factories/index.ts\tcfb4a82 (commit)\n@@ -1,3 +1,4 @@\n export * from \"./configs/core\";\n export * from \"./configs/shared\";\n+export * from \"./configs/properties\";\n export * from \"./nodes/core\";\n"
        },
        {
          "path": "packages/utils/src/work-item-filters/configs/filters/cycle.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/work-item-filters/configs/filters/cycle.ts\n===================================================================\n--- packages/utils/src/work-item-filters/configs/filters/cycle.ts\t9f41e92 (parent)\n+++ packages/utils/src/work-item-filters/configs/filters/cycle.ts\tcfb4a82 (commit)\n@@ -59,10 +59,10 @@\n   (params: TCreateCycleFilterParams) =>\n     createFilterConfig<P, string>({\n       id: key,\n       label: \"Cycle\",\n+      ...params,\n       icon: params.filterIcon,\n-      isEnabled: params.isEnabled,\n       supportedOperatorConfigsMap: new Map([\n         createOperatorConfigEntry(COLLECTION_OPERATOR.IN, params, (updatedParams) =>\n           getCycleMultiSelectConfig(updatedParams, EQUALITY_OPERATOR.EXACT)\n         ),\n"
        },
        {
          "path": "packages/utils/src/work-item-filters/configs/filters/date.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/work-item-filters/configs/filters/date.ts\n===================================================================\n--- packages/utils/src/work-item-filters/configs/filters/date.ts\t9f41e92 (parent)\n+++ packages/utils/src/work-item-filters/configs/filters/date.ts\tcfb4a82 (commit)\n@@ -1,9 +1,13 @@\n // plane imports\n import { TFilterProperty } from \"@plane/types\";\n // local imports\n-import { createFilterConfig, TCreateFilterConfig, TCreateDateFilterParams } from \"../../../rich-filters\";\n-import { getSupportedDateOperators } from \"./shared\";\n+import {\n+  createFilterConfig,\n+  TCreateFilterConfig,\n+  TCreateDateFilterParams,\n+  getSupportedDateOperators,\n+} from \"../../../rich-filters\";\n \n // ------------ Date filters ------------\n \n /**\n@@ -17,10 +21,10 @@\n   (params: TCreateDateFilterParams) =>\n     createFilterConfig<P, Date>({\n       id: key,\n       label: \"Start date\",\n+      ...params,\n       icon: params.filterIcon,\n-      isEnabled: params.isEnabled,\n       allowMultipleFilters: true,\n       supportedOperatorConfigsMap: getSupportedDateOperators(params),\n     });\n \n@@ -35,9 +39,45 @@\n   (params: TCreateDateFilterParams) =>\n     createFilterConfig<P, Date>({\n       id: key,\n       label: \"Target date\",\n+      ...params,\n       icon: params.filterIcon,\n-      isEnabled: params.isEnabled,\n       allowMultipleFilters: true,\n       supportedOperatorConfigsMap: getSupportedDateOperators(params),\n     });\n+\n+/**\n+ * Get the created at filter config\n+ * @template K - The filter key\n+ * @param key - The filter key to use\n+ * @returns A function that takes parameters and returns the created at filter config\n+ */\n+export const getCreatedAtFilterConfig =\n+  <P extends TFilterProperty>(key: P): TCreateFilterConfig<P, TCreateDateFilterParams> =>\n+  (params: TCreateDateFilterParams) =>\n+    createFilterConfig<P, Date>({\n+      id: key,\n+      label: \"Created at\",\n+      ...params,\n+      icon: params.filterIcon,\n+      allowMultipleFilters: true,\n+      supportedOperatorConfigsMap: getSupportedDateOperators(params),\n+    });\n+\n+/**\n+ * Get the updated at filter config\n+ * @template K - The filter key\n+ * @param key - The filter key to use\n+ * @returns A function that takes parameters and returns the updated at filter config\n+ */\n+export const getUpdatedAtFilterConfig =\n+  <P extends TFilterProperty>(key: P): TCreateFilterConfig<P, TCreateDateFilterParams> =>\n+  (params: TCreateDateFilterParams) =>\n+    createFilterConfig<P, Date>({\n+      id: key,\n+      label: \"Updated at\",\n+      ...params,\n+      icon: params.filterIcon,\n+      allowMultipleFilters: true,\n+      supportedOperatorConfigsMap: getSupportedDateOperators(params),\n+    });\n"
        },
        {
          "path": "packages/utils/src/work-item-filters/configs/filters/label.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/work-item-filters/configs/filters/label.ts\n===================================================================\n--- packages/utils/src/work-item-filters/configs/filters/label.ts\t9f41e92 (parent)\n+++ packages/utils/src/work-item-filters/configs/filters/label.ts\tcfb4a82 (commit)\n@@ -58,10 +58,10 @@\n   (params: TCreateLabelFilterParams) =>\n     createFilterConfig<P, string>({\n       id: key,\n       label: \"Label\",\n+      ...params,\n       icon: params.filterIcon,\n-      isEnabled: params.isEnabled,\n       supportedOperatorConfigsMap: new Map([\n         createOperatorConfigEntry(COLLECTION_OPERATOR.IN, params, (updatedParams) =>\n           getLabelMultiSelectConfig(updatedParams, EQUALITY_OPERATOR.EXACT)\n         ),\n"
        },
        {
          "path": "packages/utils/src/work-item-filters/configs/filters/module.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/work-item-filters/configs/filters/module.ts\n===================================================================\n--- packages/utils/src/work-item-filters/configs/filters/module.ts\t9f41e92 (parent)\n+++ packages/utils/src/work-item-filters/configs/filters/module.ts\tcfb4a82 (commit)\n@@ -52,10 +52,10 @@\n   (params: TCreateModuleFilterParams) =>\n     createFilterConfig<P, string>({\n       id: key,\n       label: \"Module\",\n+      ...params,\n       icon: params.filterIcon,\n-      isEnabled: params.isEnabled,\n       supportedOperatorConfigsMap: new Map([\n         createOperatorConfigEntry(COLLECTION_OPERATOR.IN, params, (updatedParams) =>\n           getModuleMultiSelectConfig(updatedParams)\n         ),\n"
        },
        {
          "path": "packages/utils/src/work-item-filters/configs/filters/priority.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/work-item-filters/configs/filters/priority.ts\n===================================================================\n--- packages/utils/src/work-item-filters/configs/filters/priority.ts\t9f41e92 (parent)\n+++ packages/utils/src/work-item-filters/configs/filters/priority.ts\tcfb4a82 (commit)\n@@ -55,10 +55,10 @@\n   (params: TCreatePriorityFilterParams) =>\n     createFilterConfig<P, TIssuePriorities>({\n       id: key,\n       label: \"Priority\",\n+      ...params,\n       icon: params.filterIcon,\n-      isEnabled: params.isEnabled,\n       supportedOperatorConfigsMap: new Map([\n         createOperatorConfigEntry(COLLECTION_OPERATOR.IN, params, (updatedParams) =>\n           getPriorityMultiSelectConfig(updatedParams, EQUALITY_OPERATOR.EXACT)\n         ),\n"
        },
        {
          "path": "packages/utils/src/work-item-filters/configs/filters/project.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/work-item-filters/configs/filters/project.ts\n===================================================================\n--- packages/utils/src/work-item-filters/configs/filters/project.ts\t9f41e92 (parent)\n+++ packages/utils/src/work-item-filters/configs/filters/project.ts\tcfb4a82 (commit)\n@@ -1,9 +1,14 @@\n // plane imports\n import { EQUALITY_OPERATOR, TFilterProperty, COLLECTION_OPERATOR } from \"@plane/types\";\n // local imports\n-import { createFilterConfig, createOperatorConfigEntry, TCreateFilterConfig } from \"../../../rich-filters\";\n-import { getProjectMultiSelectConfig, TCreateProjectFilterParams } from \"./shared\";\n+import {\n+  createFilterConfig,\n+  createOperatorConfigEntry,\n+  getProjectMultiSelectConfig,\n+  TCreateFilterConfig,\n+  TCreateProjectFilterParams,\n+} from \"../../../rich-filters\";\n \n // ------------ Project filter ------------\n \n /**\n@@ -17,10 +22,10 @@\n   (params: TCreateProjectFilterParams) =>\n     createFilterConfig<P, string>({\n       id: key,\n       label: \"Projects\",\n+      ...params,\n       icon: params.filterIcon,\n-      isEnabled: params.isEnabled,\n       supportedOperatorConfigsMap: new Map([\n         createOperatorConfigEntry(COLLECTION_OPERATOR.IN, params, (updatedParams) =>\n           getProjectMultiSelectConfig(updatedParams, EQUALITY_OPERATOR.EXACT)\n         ),\n"
        },
        {
          "path": "packages/utils/src/work-item-filters/configs/filters/state.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/work-item-filters/configs/filters/state.ts\n===================================================================\n--- packages/utils/src/work-item-filters/configs/filters/state.ts\t9f41e92 (parent)\n+++ packages/utils/src/work-item-filters/configs/filters/state.ts\tcfb4a82 (commit)\n@@ -62,10 +62,10 @@\n   (params: TCreateStateGroupFilterParams) =>\n     createFilterConfig<P, TStateGroups>({\n       id: key,\n       label: \"State Group\",\n+      ...params,\n       icon: params.filterIcon,\n-      isEnabled: params.isEnabled,\n       supportedOperatorConfigsMap: new Map([\n         createOperatorConfigEntry(COLLECTION_OPERATOR.IN, params, (updatedParams) =>\n           getStateGroupMultiSelectConfig(updatedParams, EQUALITY_OPERATOR.EXACT)\n         ),\n@@ -86,9 +86,9 @@\n  * Helper to get the state multi select config\n  * @param params - The filter params\n  * @returns The state multi select config\n  */\n-export const getStateMultiSelectConfig = (params: TCreateStateFilterParams) =>\n+export const getStateMultiSelectConfig = (params: TCreateStateFilterParams, singleValueOperator: TSupportedOperators) =>\n   getMultiSelectConfig<IState, string, IState>(\n     {\n       items: params.states,\n       getId: (state) => state.id,\n@@ -96,9 +96,9 @@\n       getValue: (state) => state.id,\n       getIconData: (state) => state,\n     },\n     {\n-      singleValueOperator: EQUALITY_OPERATOR.EXACT,\n+      singleValueOperator,\n       ...params,\n     },\n     {\n       ...params,\n@@ -116,12 +116,12 @@\n   (params: TCreateStateFilterParams) =>\n     createFilterConfig<P, string>({\n       id: key,\n       label: \"State\",\n+      ...params,\n       icon: params.filterIcon,\n-      isEnabled: params.isEnabled,\n       supportedOperatorConfigsMap: new Map([\n         createOperatorConfigEntry(COLLECTION_OPERATOR.IN, params, (updatedParams) =>\n-          getStateMultiSelectConfig(updatedParams)\n+          getStateMultiSelectConfig(updatedParams, EQUALITY_OPERATOR.EXACT)\n         ),\n       ]),\n     });\n"
        },
        {
          "path": "packages/utils/src/work-item-filters/configs/filters/user.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/work-item-filters/configs/filters/user.ts\n===================================================================\n--- packages/utils/src/work-item-filters/configs/filters/user.ts\t9f41e92 (parent)\n+++ packages/utils/src/work-item-filters/configs/filters/user.ts\tcfb4a82 (commit)\n@@ -1,49 +1,15 @@\n // plane imports\n-import { EQUALITY_OPERATOR, IUserLite, TFilterProperty, COLLECTION_OPERATOR } from \"@plane/types\";\n+import { EQUALITY_OPERATOR, TFilterProperty, COLLECTION_OPERATOR } from \"@plane/types\";\n // local imports\n import {\n   createFilterConfig,\n-  TCreateFilterConfigParams,\n-  IFilterIconConfig,\n   TCreateFilterConfig,\n-  getMultiSelectConfig,\n   createOperatorConfigEntry,\n+  getMemberMultiSelectConfig,\n+  TCreateUserFilterParams,\n } from \"../../../rich-filters\";\n \n-// ------------ Base User Filter Types ------------\n-\n-/**\n- * User filter specific params\n- */\n-export type TCreateUserFilterParams = TCreateFilterConfigParams &\n-  IFilterIconConfig<IUserLite> & {\n-    members: IUserLite[];\n-  };\n-\n-/**\n- * Helper to get the member multi select config\n- * @param params - The filter params\n- * @returns The member multi select config\n- */\n-export const getMemberMultiSelectConfig = (params: TCreateUserFilterParams) =>\n-  getMultiSelectConfig<IUserLite, string, IUserLite>(\n-    {\n-      items: params.members,\n-      getId: (member) => member.id,\n-      getLabel: (member) => member.display_name,\n-      getValue: (member) => member.id,\n-      getIconData: (member) => member,\n-    },\n-    {\n-      singleValueOperator: EQUALITY_OPERATOR.EXACT,\n-      ...params,\n-    },\n-    {\n-      ...params,\n-    }\n-  );\n-\n // ------------ Assignee filter ------------\n \n /**\n  * Assignee filter specific params\n@@ -61,13 +27,13 @@\n   (params: TCreateAssigneeFilterParams) =>\n     createFilterConfig<P, string>({\n       id: key,\n       label: \"Assignees\",\n+      ...params,\n       icon: params.filterIcon,\n-      isEnabled: params.isEnabled,\n       supportedOperatorConfigsMap: new Map([\n         createOperatorConfigEntry(COLLECTION_OPERATOR.IN, params, (updatedParams) =>\n-          getMemberMultiSelectConfig(updatedParams)\n+          getMemberMultiSelectConfig(updatedParams, EQUALITY_OPERATOR.EXACT)\n         ),\n       ]),\n     });\n \n@@ -89,13 +55,13 @@\n   (params: TCreateMentionFilterParams) =>\n     createFilterConfig<P, string>({\n       id: key,\n       label: \"Mentions\",\n+      ...params,\n       icon: params.filterIcon,\n-      isEnabled: params.isEnabled,\n       supportedOperatorConfigsMap: new Map([\n         createOperatorConfigEntry(COLLECTION_OPERATOR.IN, params, (updatedParams) =>\n-          getMemberMultiSelectConfig(updatedParams)\n+          getMemberMultiSelectConfig(updatedParams, EQUALITY_OPERATOR.EXACT)\n         ),\n       ]),\n     });\n \n@@ -117,13 +83,13 @@\n   (params: TCreateCreatedByFilterParams) =>\n     createFilterConfig<P, string>({\n       id: key,\n       label: \"Created by\",\n+      ...params,\n       icon: params.filterIcon,\n-      isEnabled: params.isEnabled,\n       supportedOperatorConfigsMap: new Map([\n         createOperatorConfigEntry(COLLECTION_OPERATOR.IN, params, (updatedParams) =>\n-          getMemberMultiSelectConfig(updatedParams)\n+          getMemberMultiSelectConfig(updatedParams, EQUALITY_OPERATOR.EXACT)\n         ),\n       ]),\n     });\n \n@@ -145,12 +111,12 @@\n   (params: TCreateSubscriberFilterParams) =>\n     createFilterConfig<P, string>({\n       id: key,\n       label: \"Subscriber\",\n+      ...params,\n       icon: params.filterIcon,\n-      isEnabled: params.isEnabled,\n       supportedOperatorConfigsMap: new Map([\n         createOperatorConfigEntry(COLLECTION_OPERATOR.IN, params, (updatedParams) =>\n-          getMemberMultiSelectConfig(updatedParams)\n+          getMemberMultiSelectConfig(updatedParams, EQUALITY_OPERATOR.EXACT)\n         ),\n       ]),\n     });\n"
        }
      ]
    },
    {
      "id": "refactor-q-filters",
      "sha": "5c842d592ec4d8fd2bbdc715a34c4ced0c23cbf2",
      "parentSha": "0589ac56d5330bc6e3fa2f3c5703bd570e059933",
      "spec": "Implement a Q-object based complex filtering pipeline across the API filters.\n\nMake the following changes:\n\n1) apps/api/plane/utils/filters/__init__.py\n- Import BaseFilterSet from .filterset in addition to IssueFilterSet.\n- Update __all__ to export \"BaseFilterSet\" along with the existing exports.\n\n2) apps/api/plane/utils/filters/filter_backend.py\n- Imports:\n  - Add: from django.db.models import Q\n  - Replace: remove usage of django_filters.rest_framework.DjangoFilterBackend; instead import translate_validation via `from django_filters.utils import translate_validation` (used indirectly by the filterset side when validating).\n- filter_queryset:\n  - Keep behavior of reading complex filters from request or explicit filter_data.\n  - On unexpected exceptions, do not re-raise the raw exception; wrap in Django ValidationError with the message: \"Filter error: {str(e)}\" to keep responses consistent.\n- _apply_json_filter:\n  - Change logic to build a single combined Q from the filter tree using a Q-based evaluation, then apply it once via `queryset.filter(combined_q)`.\n  - Update docstring to indicate Q composition instead of set operations.\n- _evaluate_node signature and behavior:\n  - Change to `_evaluate_node(self, node, view, queryset)` and return a Q object or None.\n  - For logical nodes:\n    - {\"or\": [...]}: return OR-composed Q of children (Q() | ...).\n    - {\"and\": [...]}: return AND-composed Q of children (Q() & ...).\n    - {\"not\": {...}}: return negated Q of the child (~Q(child)).\n  - For leaf nodes: delegate to a new helper that returns a Q.\n- Replace leaf handling:\n  - Implement `_build_leaf_q(self, leaf_conditions, view, queryset)`:\n    - Build a QueryDict from the leaf dict.\n    - Instantiate the view's filterset_class with data=qd and queryset=queryset.\n    - Validate: if invalid, raise translate_validation(filterset.errors).\n    - Require the filterset to implement build_combined_q; call it and return the Q.\n    - If filterset_class is missing on the view, raise ValidationError(\"Filtering requires a filterset_class to be defined on the view\").\n- Preserve existing structure and depth validation in _validate_structure and allowed-field checks in _validate_fields (no functional changes), but ensure allowed field names check still applies to full field keys (including lookups).\n\n3) apps/api/plane/utils/filters/filterset.py\n- Imports:\n  - Add: from django.db import models\n  - Add: from django.db.models import Q\n- Introduce Q-based construction in BaseFilterSet:\n  - Add method build_combined_q(self):\n    - Ensure validation has run (touch self.errors).\n    - Start with Q(). If no cleaned_data, return Q().\n    - Only process filters actually provided in input (use self.data keys to limit processing to provided filters).\n    - For each provided filter value in cleaned_data:\n      - If the filter defines a custom method (f.method is not None):\n        - Call f.filter(self.queryset, value).\n        - Accept return values that are either a Q object or a QuerySet. If QuerySet, wrap as Q(pk__in=queryset.values(\"pk\")) for backward compatibility.\n        - Otherwise raise TypeError stating the filter must return Q or QuerySet.\n      - Else (standard field filter): construct a Q using f.field_name and f.lookup_expr, e.g., Q(**{f\"{f.field_name}__{f.lookup_expr}\": value}).\n      - If the filter has exclude=True, apply negation with ~q_piece; otherwise AND it into combined_q.\n    - Return the combined_q.\n  - Override filter_queryset(self, queryset) to:\n    - Ensure validation has run (self.errors).\n    - Build combined_q via build_combined_q and apply it to the queryset (queryset.filter(combined_q)).\n    - If any filter has distinct=True, return qs.distinct(). Otherwise, return qs.\n- Update IssueFilterSet custom filter methods to return Q objects instead of QuerySets:\n  - filter_is_archived: return Q(archived_at__isnull=False) for true-like values; return Q(archived_at__isnull=True) for false-like; else return Q().\n  - filter_assignee_id: return Q(issue_assignee__assignee_id=value, issue_assignee__deleted_at__isnull=True)\n  - filter_assignee_id_in: return Q(issue_assignee__assignee_id__in=value, issue_assignee__deleted_at__isnull=True)\n  - filter_cycle_id: return Q(issue_cycle__cycle_id=value, issue_cycle__deleted_at__isnull=True)\n  - filter_cycle_id_in: return Q(issue_cycle__cycle_id__in=value, issue_cycle__deleted_at__isnull=True)\n  - filter_module_id: return Q(issue_module__module_id=value, issue_module__deleted_at__isnull=True)\n  - filter_module_id_in: return Q(issue_module__module_id__in=value, issue_module__deleted_at__isnull=True)\n  - filter_mention_id: return Q(issue_mention__mention_id=value, issue_mention__deleted_at__isnull=True)\n  - filter_mention_id_in: return Q(issue_mention__mention_id__in=value, issue_mention__deleted_at__isnull=True)\n  - filter_label_id: return Q(label_issue__label_id=value, label_issue__deleted_at__isnull=True)\n  - filter_label_id_in: return Q(label_issue__label_id__in=value, label_issue__deleted_at__isnull=True)\n  - filter_subscriber_id: return Q(issue_subscribers__subscriber_id=value, issue_subscribers__deleted_at__isnull=True)\n  - filter_subscriber_id_in: return Q(issue_subscribers__subscriber_id__in=value, issue_subscribers__deleted_at__isnull=True)\n- Keep the existing declared filters and Meta fields. Do not change how filters are declared or their lookups; the change is in return types and the new BaseFilterSet logic.\n\nBehavioral expectations after implementation:\n- All endpoints using ComplexFilterBackend and IssueFilterSet continue to accept rich JSON filter trees in the \"filters\" query parameter.\n- ComplexFilterBackend should validate structure and allowed fields, build a single Q for the entire tree, and apply it to the queryset once.\n- FilterSet-based validation errors should surface as DRF-friendly responses via translate_validation.\n- Legacy DjangoFilterBackend behavior is retained for compatibility because BaseFilterSet.filter_queryset now uses the same Q composition under the hood.\n- Views do not require changes; filtering still occurs through self.filter_queryset(queryset).",
      "prompt": "Refactor the API’s complex filtering to use Q-object composition end-to-end. Add a base filterset that can build a single combined Q object for all provided filters, including support for custom filter methods and standard field filters. Update the complex filter backend to parse the JSON filter tree (and/or/not), validate the structure and allowed fields, build one combined Q using the filterset, and apply it to the queryset. Ensure custom filter methods return Q (or are wrapped if they return a queryset), and that validation errors are consistently reported. Keep current endpoints and filter declarations working without further changes.",
      "supplementalFiles": [
        "apps/api/plane/app/views/issue/base.py",
        "apps/api/plane/app/views/view/base.py",
        "apps/api/plane/app/views/issue/archive.py",
        "apps/api/plane/app/views/workspace/user.py",
        "apps/api/plane/app/views/cycle/issue.py",
        "apps/api/plane/app/views/module/issue.py",
        "apps/api/plane/utils/filters/converters.py",
        "apps/api/plane/utils/filters/filter_migrations.py",
        "apps/api/plane/db/migrations/0107_migrate_filters_to_rich_filters.py"
      ],
      "fileDiffs": [
        {
          "path": "apps/api/plane/utils/filters/__init__.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/utils/filters/__init__.py\n===================================================================\n--- apps/api/plane/utils/filters/__init__.py\t0589ac5 (parent)\n+++ apps/api/plane/utils/filters/__init__.py\t5c842d5 (commit)\n@@ -2,9 +2,9 @@\n \n # Import all utilities from base modules\n from .filter_backend import ComplexFilterBackend\n from .converters import LegacyToRichFiltersConverter\n-from .filterset import IssueFilterSet\n+from .filterset import BaseFilterSet, IssueFilterSet\n \n \n # Public API exports\n-__all__ = [\"ComplexFilterBackend\", \"LegacyToRichFiltersConverter\", \"IssueFilterSet\"]\n+__all__ = [\"ComplexFilterBackend\", \"LegacyToRichFiltersConverter\", \"BaseFilterSet\", \"IssueFilterSet\"]\n"
        },
        {
          "path": "apps/api/plane/utils/filters/filter_backend.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/utils/filters/filter_backend.py\n===================================================================\n--- apps/api/plane/utils/filters/filter_backend.py\t0589ac5 (parent)\n+++ apps/api/plane/utils/filters/filter_backend.py\t5c842d5 (commit)\n@@ -1,9 +1,10 @@\n import json\n \n from django.core.exceptions import ValidationError\n+from django.db.models import Q\n from django.http import QueryDict\n-from django_filters.rest_framework import DjangoFilterBackend\n+from django_filters.utils import translate_validation\n from rest_framework import filters\n \n \n class ComplexFilterBackend(filters.BaseFilterBackend):\n@@ -37,9 +38,8 @@\n         except ValidationError:\n             # Propagate validation errors unchanged\n             raise\n         except Exception as e:\n-            raise\n             # Convert unexpected errors to ValidationError to keep response consistent\n             raise ValidationError(f\"Filter error: {str(e)}\")\n \n     def _normalize_filter_data(self, raw_filter, source_label):\n@@ -57,9 +57,9 @@\n         except json.JSONDecodeError:\n             raise ValidationError(f\"Invalid JSON for '{source_label}'. Expected a valid JSON object.\")\n \n     def _apply_json_filter(self, queryset, filter_data, view):\n-        \"\"\"Process a JSON filter structure using OR/AND/NOT set operations.\"\"\"\n+        \"\"\"Process a JSON filter structure using Q object composition.\"\"\"\n         if not filter_data:\n             return queryset\n \n         # Validate structure and depth before field allowlist checks\n@@ -68,14 +68,16 @@\n \n         # Validate against the view's FilterSet (only declared filters are allowed)\n         self._validate_fields(filter_data, view)\n \n-        # Build combined queryset using FilterSet-driven leaf evaluation\n-        combined_qs = self._evaluate_node(filter_data, queryset, view)\n-        if combined_qs is None:\n+        # Build combined Q object from the filter tree\n+        combined_q = self._evaluate_node(filter_data, view, queryset)\n+        if combined_q is None:\n             return queryset\n-        return combined_qs\n \n+        # Apply the combined Q object to the queryset once\n+        return queryset.filter(combined_q)\n+\n     def _validate_fields(self, filter_data, view):\n         \"\"\"Validate that filtered fields are defined in the view's FilterSet.\"\"\"\n         filterset_class = getattr(view, \"filterset_class\", None)\n         allowed_fields = set(filterset_class.base_filters.keys()) if filterset_class else None\n@@ -114,111 +116,79 @@\n                     fields.append(key)\n             return fields\n         return []\n \n-    def _evaluate_node(self, node, base_queryset, view):\n+    def _evaluate_node(self, node, view, queryset):\n         \"\"\"\n-        Recursively evaluate a JSON node into a combined queryset using branch-based filtering.\n+        Recursively evaluate a JSON node into a combined Q object.\n \n         Rules:\n-        - leaf dict → evaluated through DjangoFilterBackend as a mini-querystring\n-        - {\"or\": [...]} → union (|) of children\n-        - {\"and\": [...]} → collect field conditions per branch and apply together\n-        - {\"not\": {...}} → exclude child's rows from the base queryset\n-          (complement within base scope)\n+        - leaf dict → evaluated through FilterSet to produce a Q object\n+        - {\"or\": [...]} → Q() | Q() | ... (OR of children)\n+        - {\"and\": [...]} → Q() & Q() & ... (AND of children)\n+        - {\"not\": {...}} → ~Q() (negation of child)\n+\n+        Returns a Q object that can be applied to a queryset.\n         \"\"\"\n         if not isinstance(node, dict):\n             return None\n \n-        # 'or' combination - requires set operations between children\n+        # 'or' combination - OR of child Q objects\n         if \"or\" in node:\n             children = node[\"or\"]\n             if not isinstance(children, list) or not children:\n                 return None\n-            combined = None\n+            combined_q = Q()\n             for child in children:\n-                child_qs = self._evaluate_node(child, base_queryset, view)\n-                if child_qs is None:\n+                child_q = self._evaluate_node(child, view, queryset)\n+                if child_q is None:\n                     continue\n-                combined = child_qs if combined is None else (combined | child_qs)\n-            return combined\n+                combined_q |= child_q\n+            return combined_q\n \n-        # 'and' combination - collect field conditions per branch\n+        # 'and' combination - AND of child Q objects\n         if \"and\" in node:\n             children = node[\"and\"]\n             if not isinstance(children, list) or not children:\n                 return None\n-            return self._evaluate_and_branch(children, base_queryset, view)\n+            combined_q = Q()\n+            for child in children:\n+                child_q = self._evaluate_node(child, view, queryset)\n+                if child_q is None:\n+                    continue\n+                combined_q &= child_q\n+            return combined_q\n \n-        # 'not' negation\n+        # 'not' negation - negate the child Q object\n         if \"not\" in node:\n             child = node[\"not\"]\n             if not isinstance(child, dict):\n                 return None\n-            child_qs = self._evaluate_node(child, base_queryset, view)\n-            if child_qs is None:\n+            child_q = self._evaluate_node(child, view, queryset)\n+            if child_q is None:\n                 return None\n-            # Use subquery instead of pk__in for better performance\n-            # This avoids evaluating child_qs and creating large IN clauses\n-            return base_queryset.exclude(pk__in=child_qs.values(\"pk\"))\n+            return ~child_q\n \n-        # Leaf dict: evaluate via DjangoFilterBackend using FilterSet\n-        return self._filter_leaf_via_backend(node, base_queryset, view)\n+        # Leaf dict: evaluate via FilterSet to get a Q object\n+        return self._build_leaf_q(node, view, queryset)\n \n-    def _evaluate_and_branch(self, children, base_queryset, view):\n-        \"\"\"\n-        Evaluate an AND branch by collecting field conditions and applying them together.\n+    def _build_leaf_q(self, leaf_conditions, view, queryset):\n+        \"\"\"Build a Q object from leaf filter conditions using the view's FilterSet.\n \n-        This approach is more efficient than individual leaf evaluation because:\n-        - Field conditions within the same AND branch are collected and applied together\n-        - Only logical operation children require separate evaluation and set intersection\n-        - Reduces the number of intermediate querysets and database queries\n-        \"\"\"\n-        collected_conditions = {}\n-        logical_querysets = []\n+        We serialize the leaf dict into a QueryDict and let the view's\n+        filterset_class perform validation and build a combined Q object\n+        from all the field filters.\n \n-        # Separate field conditions from logical operations\n-        for child in children:\n-            if not isinstance(child, dict):\n-                continue\n-\n-            # Check if this child contains logical operators\n-            has_logical = any(k.lower() in (\"or\", \"and\", \"not\") for k in child.keys() if isinstance(k, str))\n-\n-            if has_logical:\n-                # This child has logical operators, evaluate separately\n-                child_qs = self._evaluate_node(child, base_queryset, view)\n-                if child_qs is not None:\n-                    logical_querysets.append(child_qs)\n-            else:\n-                # This is a leaf with field conditions, collect them\n-                collected_conditions.update(child)\n-\n-        # Start with base queryset\n-        result_qs = base_queryset\n-\n-        # Apply collected field conditions together if any exist\n-        if collected_conditions:\n-            result_qs = self._filter_leaf_via_backend(collected_conditions, result_qs, view)\n-            if result_qs is None:\n-                return None\n-\n-        # Intersect with any logical operation results\n-        for logical_qs in logical_querysets:\n-            result_qs = result_qs & logical_qs\n-\n-        return result_qs\n-\n-    def _filter_leaf_via_backend(self, leaf_conditions, base_queryset, view):\n-        \"\"\"Evaluate a leaf dict by delegating to DjangoFilterBackend once.\n-\n-        We serialize the leaf dict into a mini querystring and let the view's\n-        filterset_class perform validation, conversion, and filtering. This returns\n-        a lazy queryset suitable for set-operations with siblings.\n+        Returns a Q object representing all the field conditions in the leaf.\n         \"\"\"\n         if not leaf_conditions:\n-            return None\n+            return Q()\n \n+        # Get the filterset class from the view\n+        filterset_class = getattr(view, \"filterset_class\", None)\n+        if not filterset_class:\n+            raise ValidationError(\"Filtering requires a filterset_class to be defined on the view\")\n+\n         # Build a QueryDict from the leaf conditions\n         qd = QueryDict(mutable=True)\n         for key, value in leaf_conditions.items():\n             # Default serialization to string; QueryDict expects strings\n@@ -230,20 +200,21 @@\n \n         qd = qd.copy()\n         qd._mutable = False\n \n-        # Temporarily patch request.GET and delegate to DjangoFilterBackend\n-        backend = DjangoFilterBackend()\n-        request = view.request\n-        original_get = request._request.GET if hasattr(request, \"_request\") else None\n-        try:\n-            if hasattr(request, \"_request\"):\n-                request._request.GET = qd\n-            return backend.filter_queryset(request, base_queryset, view)\n-        finally:\n-            if hasattr(request, \"_request\") and original_get is not None:\n-                request._request.GET = original_get\n+        # Instantiate the filterset with the actual queryset\n+        # Custom filter methods may need access to the queryset for filtering\n+        fs = filterset_class(data=qd, queryset=queryset)\n \n+        if not fs.is_valid():\n+            raise translate_validation(fs.errors)\n+\n+        # Build and return the combined Q object\n+        if not hasattr(fs, \"build_combined_q\"):\n+            raise ValidationError(\"FilterSet must have build_combined_q method for complex filtering\")\n+\n+        return fs.build_combined_q()\n+\n     def _get_max_depth(self, view):\n         \"\"\"Return the maximum allowed nesting depth for complex filters.\n \n         Falls back to class default if the view does not specify it or has\n"
        },
        {
          "path": "apps/api/plane/utils/filters/filterset.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/utils/filters/filterset.py\n===================================================================\n--- apps/api/plane/utils/filters/filterset.py\t0589ac5 (parent)\n+++ apps/api/plane/utils/filters/filterset.py\t5c842d5 (commit)\n@@ -1,6 +1,8 @@\n import copy\n \n+from django.db import models\n+from django.db.models import Q\n from django_filters import FilterSet, filters\n \n from plane.db.models import Issue\n \n@@ -34,9 +36,88 @@\n         # Add the exact filters to the main filters dict\n         filters.update(exact_filters)\n         return filters\n \n+    def build_combined_q(self):\n+        \"\"\"\n+        Build a combined Q object from all bound filters.\n \n+        For filters with custom methods, we call them and expect Q objects (or wrap\n+        QuerySets as subqueries for backward compatibility).\n+        For standard field filters, we build Q objects directly from field lookups.\n+\n+        Returns:\n+            Q object representing all filter conditions combined.\n+        \"\"\"\n+        # Ensure form validation has occurred\n+        self.errors\n+\n+        combined_q = Q()\n+\n+        # Handle case where cleaned_data might be None or empty\n+        if not self.form.cleaned_data:\n+            return combined_q\n+\n+        # Only process filters that were actually provided in the request data\n+        # This avoids processing all declared filters with None/empty default values\n+        provided_filters = set(self.data.keys()) if self.data else set()\n+\n+        for name, value in self.form.cleaned_data.items():\n+            # Skip filters that weren't provided in the request\n+            if name not in provided_filters:\n+                continue\n+\n+            f = self.filters[name]\n+\n+            # Build the Q object for this filter\n+            if f.method is not None:\n+                # Custom filter method - call it to get Q object\n+                res = f.filter(self.queryset, value)\n+                if isinstance(res, Q):\n+                    q_piece = res\n+                elif isinstance(res, models.QuerySet):\n+                    # Backward compatibility: wrap QuerySet as subquery\n+                    q_piece = Q(pk__in=res.values(\"pk\"))\n+                else:\n+                    raise TypeError(\n+                        f\"Filter method '{name}' must return Q object or QuerySet, got {type(res).__name__}\"\n+                    )\n+            else:\n+                # Standard field filter - build Q object directly\n+                lookup = f\"{f.field_name}__{f.lookup_expr}\"\n+                q_piece = Q(**{lookup: value})\n+\n+            # Apply exclude/include logic\n+            if getattr(f, \"exclude\", False):\n+                combined_q &= ~q_piece\n+            else:\n+                combined_q &= q_piece\n+\n+        return combined_q\n+\n+    def filter_queryset(self, queryset):\n+        \"\"\"\n+        Override to use Q-based filtering for compatibility with DjangoFilterBackend.\n+\n+        This allows the same filterset to work with both ComplexFilterBackend\n+        (which calls build_combined_q directly) and DjangoFilterBackend\n+        (which calls this method).\n+        \"\"\"\n+        # Ensure form validation\n+        self.errors\n+\n+        # Build combined Q and apply to queryset\n+        combined_q = self.build_combined_q()\n+        qs = queryset.filter(combined_q)\n+\n+        # Apply distinct if any filter requires it (typically for many-to-many relations)\n+        for f in self.filters.values():\n+            if getattr(f, \"distinct\", False):\n+                return qs.distinct()\n+\n+        return qs\n+\n+\n class IssueFilterSet(BaseFilterSet):\n     # Custom filter methods to handle soft delete exclusion for relations\n \n     assignee_id = filters.UUIDFilter(method=\"filter_assignee_id\")\n@@ -87,94 +168,94 @@\n         Convenience filter: archived=true -> archived_at is not null,\n         archived=false -> archived_at is null\n         \"\"\"\n         if value in (True, \"true\", \"True\", 1, \"1\"):\n-            return queryset.filter(archived_at__isnull=False)\n+            return Q(archived_at__isnull=False)\n         if value in (False, \"false\", \"False\", 0, \"0\"):\n-            return queryset.filter(archived_at__isnull=True)\n-        return queryset\n+            return Q(archived_at__isnull=True)\n+        return Q()  # No filter\n \n     # Filter methods with soft delete exclusion for relations\n \n     def filter_assignee_id(self, queryset, name, value):\n         \"\"\"Filter by assignee ID, excluding soft deleted users\"\"\"\n-        return queryset.filter(\n+        return Q(\n             issue_assignee__assignee_id=value,\n             issue_assignee__deleted_at__isnull=True,\n         )\n \n     def filter_assignee_id_in(self, queryset, name, value):\n         \"\"\"Filter by assignee IDs (in), excluding soft deleted users\"\"\"\n-        return queryset.filter(\n+        return Q(\n             issue_assignee__assignee_id__in=value,\n             issue_assignee__deleted_at__isnull=True,\n         )\n \n     def filter_cycle_id(self, queryset, name, value):\n         \"\"\"Filter by cycle ID, excluding soft deleted cycles\"\"\"\n-        return queryset.filter(\n+        return Q(\n             issue_cycle__cycle_id=value,\n             issue_cycle__deleted_at__isnull=True,\n         )\n \n     def filter_cycle_id_in(self, queryset, name, value):\n         \"\"\"Filter by cycle IDs (in), excluding soft deleted cycles\"\"\"\n-        return queryset.filter(\n+        return Q(\n             issue_cycle__cycle_id__in=value,\n             issue_cycle__deleted_at__isnull=True,\n         )\n \n     def filter_module_id(self, queryset, name, value):\n         \"\"\"Filter by module ID, excluding soft deleted modules\"\"\"\n-        return queryset.filter(\n+        return Q(\n             issue_module__module_id=value,\n             issue_module__deleted_at__isnull=True,\n         )\n \n     def filter_module_id_in(self, queryset, name, value):\n         \"\"\"Filter by module IDs (in), excluding soft deleted modules\"\"\"\n-        return queryset.filter(\n+        return Q(\n             issue_module__module_id__in=value,\n             issue_module__deleted_at__isnull=True,\n         )\n \n     def filter_mention_id(self, queryset, name, value):\n         \"\"\"Filter by mention ID, excluding soft deleted users\"\"\"\n-        return queryset.filter(\n+        return Q(\n             issue_mention__mention_id=value,\n             issue_mention__deleted_at__isnull=True,\n         )\n \n     def filter_mention_id_in(self, queryset, name, value):\n         \"\"\"Filter by mention IDs (in), excluding soft deleted users\"\"\"\n-        return queryset.filter(\n+        return Q(\n             issue_mention__mention_id__in=value,\n             issue_mention__deleted_at__isnull=True,\n         )\n \n     def filter_label_id(self, queryset, name, value):\n         \"\"\"Filter by label ID, excluding soft deleted labels\"\"\"\n-        return queryset.filter(\n+        return Q(\n             label_issue__label_id=value,\n             label_issue__deleted_at__isnull=True,\n         )\n \n     def filter_label_id_in(self, queryset, name, value):\n         \"\"\"Filter by label IDs (in), excluding soft deleted labels\"\"\"\n-        return queryset.filter(\n+        return Q(\n             label_issue__label_id__in=value,\n             label_issue__deleted_at__isnull=True,\n         )\n \n     def filter_subscriber_id(self, queryset, name, value):\n         \"\"\"Filter by subscriber ID, excluding soft deleted users\"\"\"\n-        return queryset.filter(\n+        return Q(\n             issue_subscribers__subscriber_id=value,\n             issue_subscribers__deleted_at__isnull=True,\n         )\n \n     def filter_subscriber_id_in(self, queryset, name, value):\n         \"\"\"Filter by subscriber IDs (in), excluding soft deleted users\"\"\"\n-        return queryset.filter(\n+        return Q(\n             issue_subscribers__subscriber_id__in=value,\n             issue_subscribers__deleted_at__isnull=True,\n         )\n"
        }
      ]
    },
    {
      "id": "add-member-filters",
      "sha": "586a7a48ba1320cbc927b30ebd45b574c828f476",
      "parentSha": "85bffaa231cd18252d664232754094aa73e29976",
      "spec": "Implement role filters and sortable column headers for project and workspace member lists across web apps.\n\nScope and behavior\n- Add a Filters dropdown to both Project Members and Workspace Members pages that allows toggling role filters (Admin/Member/Guest, mapped to EUserProjectRoles/EUserWorkspaceRoles). Display a small dot indicator on the button when any role filter is active. Toggling a role adds/removes it; if no roles remain, clear the roles filter (set to undefined).\n- Add sortable column headers for Full name, Display name, Email, Role, and Joining date. Each header opens a menu to set ascending/descending order for that property and to clear sorting. Sorting state is stored in a central filter store. When sorting is applied, member lists must be re-ordered accordingly. Clearing sorting removes the order_by filter.\n- Apply role filters before search, and apply search against the filtered set. For project members, use filtered member details when rendering each item so excluded members do not appear.\n- Joining date cells should use a shared formatted render function rather than manual date formatting.\n\nUI components\n- Create a MemberListFiltersDropdown that uses the existing FilterHeader and FilterOption components to render a role filter group for either project or workspace contexts. The button should show an indicator when filters are applied.\n- Create a MemberHeaderColumn component that:\n  - Reads property metadata from constants (MEMBER_PROPERTY_DETAILS) to render a column title and icons.\n  - Reflects current sorting state (ascending/descending icon) for the active property.\n  - Provides menu actions to set ascending or descending order for the given property, and to clear sorting.\n  - Calls a provided handler to update the filter store with order_by.\n\nState management\n- Add a new ProjectMemberFiltersStore that maintains per-project filters (roles?: string[], order_by?: TMemberOrderByOptions), with:\n  - filtersMap keyed by projectId\n  - updateFilters(projectId, filters: Partial<IMemberFilters>) to merge updates\n  - getFilters(projectId) to retrieve current filters\n  - getFilteredMemberIds(...) to return filtered and sorted user IDs based on current filters\n- Add a new WorkspaceMemberFiltersStore that maintains workspace-level filters (shared across the workspace membership view), with:\n  - filters: IMemberFilters\n  - updateFilters(filters: Partial<IMemberFilters>) to merge updates\n  - getFilteredMemberIds(...) to return filtered and sorted user IDs based on current filters\n- Add shared utilities in a member utils module to:\n  - Describe IMemberFilters and parse order keys\n  - Filter by role (project vs workspace)\n  - Compute sort key by property (display_name, full_name, email, joining_date, role)\n  - Sort members generically by the provided property and direction\n  - Compose project and workspace specific sorting/filtering via sortProjectMembers and sortWorkspaceMembers\n\nStores integration\n- For the project member store (base-project-member.store):\n  - Initialize and expose a ProjectMemberFiltersStore instance as filters.\n  - Update projectMemberIds computed to apply sortProjectMembers with current filters (ensuring MobX tracking by accessing filtersMap for the current project ID).\n  - Add getFilteredProjectMemberDetails(userId, projectId) that returns null if the user is filtered out by current filters; otherwise return member details with joining_date derived from membership created_at.\n- For the workspace member store:\n  - Initialize and expose a WorkspaceMemberFiltersStore instance as filtersStore.\n  - Add getFilteredWorkspaceMemberIds(workspaceSlug) that returns member IDs after applying filters and sorting.\n  - Update getSearchedWorkspaceMemberIds to search only within filtered results.\n\nPage and component integration\n- Workspace members page (settings view):\n  - Inject filtersStore from useMember().workspace.\n  - Add MemberListFiltersDropdown next to the search field.\n  - Maintain appliedRoleFilters from filtersStore.filters.roles.\n  - Implement handleRoleFilterUpdate to toggle roles in filtersStore; clear to undefined when none.\n  - Ensure header action buttons retain existing behavior (invite/Billing actions), with layout adjusted to include the new filter dropdown.\n- Workspace useMemberColumns hook:\n  - Use MemberHeaderColumn for the Full name, Display name, Email, Role, and Joining date headers.\n  - Use renderFormattedDate for the Joining date cell rendering.\n  - Wire thRender handlers to update filtersStore.updateFilters via a local handleDisplayFilterUpdate.\n- Project useProjectColumns hook:\n  - Access project filters via useMember().project.filters.getFilters/updateFilters.\n  - Provide displayFilters and handleDisplayFilterUpdate.\n  - Use MemberHeaderColumn for the same headers, and renderFormattedDate for Joining date.\n  - Add Email column to the table with header sorting enabled.\n- Project member list:\n  - Replace getProjectMemberDetails with getFilteredProjectMemberDetails for mapping.\n  - Use filters.getFilters(projectId)/filters.updateFilters(projectId, ...) to manage role filter state in the list header.\n  - Add MemberListFiltersDropdown next to the search field.\n- Workspace members list:\n  - Use getFilteredWorkspaceMemberIds(workspaceSlug) to compute filtered list, and apply search only if searchQuery is non-empty, otherwise use the filtered list.\n\nConstants and i18n\n- Add member property constants in packages/constants members.ts, export from constants index, to define:\n  - TMemberOrderByOptions set including asc/desc forms of display_name, full_name, email, joining_date, role\n  - IProjectMemberDisplayProperties keys for column properties\n  - MEMBER_PROPERTY_DETAILS with i18n keys, ascending/descending order keys and titles, icon names, and sorting support flag\n- Add i18n strings for project_members.full_name, display_name, email, joining_date, role in English translations.\n\nRefactors and path updates\n- Move core/store/member/base-project-member.store.ts to core/store/member/project/base-project-member.store.ts and update all imports accordingly (e.g., in project-member.store.ts and components using IProjectMemberDetails).\n- Move core/store/member/workspace-member.store.ts to core/store/member/workspace/workspace-member.store.ts and update imports in root stores and any dependents.\n- Ensure all imports referencing these moved modules point to the new paths.\n\nFormatting changes\n- Use renderFormattedDate from @plane/utils instead of local date formatting in both project and workspace column hooks.\n- Keep import ordering consistent as in the codebase style.\n\nAcceptance criteria\n- In Project Members and Workspace Members UIs, a Filters dropdown appears next to the search input. Selecting Admin/Member/Guest filters the list accordingly; clearing all role selections removes the filter.\n- Column headers for Full name, Display name, Email, Role, and Joining date display a dropdown allowing ascending/descending sorting and clearing sorting. The current sort direction is reflected via icon on the header.\n- Search applies after filters. Members filtered out are not shown in the list or in computed details mapping.\n- Joining date displays with the shared renderFormattedDate utility.\n- All existing functionality such as invite buttons and billing actions remain intact.\n- All imports compile with updated store paths and new modules available.",
      "prompt": "Add role-based filtering and sortable column headers to the project and workspace member lists. Provide a filter dropdown for roles (Admin/Member/Guest) and update the list header to include sortable column headers for common member properties. Persist the sorting and role filters in appropriate stores so they drive the rendered list order and filtering. Ensure search applies to the filtered results. Update the column hooks to render sortable headers and use a shared date formatting utility for joining dates. Add any missing constants and i18n strings necessary to support the UI. Keep existing invite/billing actions and adjust the header layout to accommodate the new filters.",
      "supplementalFiles": [
        "apps/web/core/components/issues/issue-layouts/filters/index.tsx",
        "apps/web/core/components/issues/issue-layouts/filters/header/helpers/filter-header.tsx",
        "apps/web/core/components/issues/issue-layouts/filters/helpers/filter-option.tsx",
        "apps/web/core/hooks/store/use-member.ts",
        "apps/web/core/hooks/store/user.ts",
        "apps/web/core/store/root.store.ts",
        "apps/web/core/services/project/index.ts",
        "packages/ui/src/dropdowns/custom-menu.tsx",
        "packages/ui/src/button/button.tsx",
        "packages/types/src/index.ts",
        "packages/utils/src/datetime.ts",
        "apps/web/core/components/ui/loader/settings/members.tsx"
      ],
      "fileDiffs": [
        {
          "path": "apps/web/app/(all)/[workspaceSlug]/(settings)/settings/(workspace)/members/page.tsx",
          "status": "modified",
          "diff": "Index: apps/web/app/(all)/[workspaceSlug]/(settings)/settings/(workspace)/members/page.tsx\n===================================================================\n--- apps/web/app/(all)/[workspaceSlug]/(settings)/settings/(workspace)/members/page.tsx\t85bffaa (parent)\n+++ apps/web/app/(all)/[workspaceSlug]/(settings)/settings/(workspace)/members/page.tsx\t586a7a4 (commit)\n@@ -19,8 +19,9 @@\n // components\n import { NotAuthorizedView } from \"@/components/auth-screens/not-authorized-view\";\n import { CountChip } from \"@/components/common/count-chip\";\n import { PageHead } from \"@/components/core/page-title\";\n+import { MemberListFiltersDropdown } from \"@/components/project/dropdowns/filters/member-list\";\n import { SettingsContentWrapper } from \"@/components/settings/content-wrapper\";\n import { WorkspaceMembersList } from \"@/components/workspace/settings/members-list\";\n // helpers\n import { captureError, captureSuccess } from \"@/helpers/event-tracker.helper\";\n@@ -40,9 +41,9 @@\n   const { workspaceSlug } = useParams();\n   // store hooks\n   const { workspaceUserInfo, allowPermissions } = useUserPermissions();\n   const {\n-    workspace: { workspaceMemberIds, inviteMembersToWorkspace },\n+    workspace: { workspaceMemberIds, inviteMembersToWorkspace, filtersStore },\n   } = useMember();\n   const { currentWorkspace } = useWorkspace();\n   const { t } = useTranslation();\n \n@@ -87,10 +88,22 @@\n         throw err;\n       });\n   };\n \n+  // Handler for role filter updates\n+  const handleRoleFilterUpdate = (role: string) => {\n+    const currentFilters = filtersStore.filters;\n+    const currentRoles = currentFilters?.roles || [];\n+    const updatedRoles = currentRoles.includes(role) ? currentRoles.filter((r) => r !== role) : [...currentRoles, role];\n+\n+    filtersStore.updateFilters({\n+      roles: updatedRoles.length > 0 ? updatedRoles : undefined,\n+    });\n+  };\n+\n   // derived values\n   const pageTitle = currentWorkspace?.name ? `${currentWorkspace.name} - Members` : undefined;\n+  const appliedRoleFilters = filtersStore.filters?.roles || [];\n \n   // if user is not authorized to view this page\n   if (workspaceUserInfo && !canPerformWorkspaceMemberActions) {\n     return <NotAuthorizedView section=\"settings\" className=\"h-auto\" />;\n@@ -115,29 +128,36 @@\n             {workspaceMemberIds && workspaceMemberIds.length > 0 && (\n               <CountChip count={workspaceMemberIds.length} className=\"h-5 m-auto\" />\n             )}\n           </h4>\n-          <div className=\"ml-auto flex items-center gap-1.5 rounded-md border border-custom-border-200 bg-custom-background-100 px-2.5 py-1.5\">\n-            <Search className=\"h-3.5 w-3.5 text-custom-text-400\" />\n-            <input\n-              className=\"w-full max-w-[234px] border-none bg-transparent text-sm outline-none placeholder:text-custom-text-400\"\n-              placeholder={`${t(\"search\")}...`}\n-              value={searchQuery}\n-              autoFocus\n-              onChange={(e) => setSearchQuery(e.target.value)}\n+          <div className=\"flex items-center gap-2\">\n+            <div className=\"flex items-center gap-1.5 rounded-md border border-custom-border-200 bg-custom-background-100 px-2.5 py-1.5\">\n+              <Search className=\"h-3.5 w-3.5 text-custom-text-400\" />\n+              <input\n+                className=\"w-full max-w-[234px] border-none bg-transparent text-sm outline-none placeholder:text-custom-text-400\"\n+                placeholder={`${t(\"search\")}...`}\n+                value={searchQuery}\n+                autoFocus\n+                onChange={(e) => setSearchQuery(e.target.value)}\n+              />\n+            </div>\n+            <MemberListFiltersDropdown\n+              appliedFilters={appliedRoleFilters}\n+              handleUpdate={handleRoleFilterUpdate}\n+              memberType=\"workspace\"\n             />\n+            {canPerformWorkspaceAdminActions && (\n+              <Button\n+                variant=\"primary\"\n+                size=\"sm\"\n+                onClick={() => setInviteModal(true)}\n+                data-ph-element={MEMBER_TRACKER_ELEMENTS.HEADER_ADD_BUTTON}\n+              >\n+                {t(\"workspace_settings.settings.members.add_member\")}\n+              </Button>\n+            )}\n+            <BillingActionsButton canPerformWorkspaceAdminActions={canPerformWorkspaceAdminActions} />\n           </div>\n-          {canPerformWorkspaceAdminActions && (\n-            <Button\n-              variant=\"primary\"\n-              size=\"sm\"\n-              onClick={() => setInviteModal(true)}\n-              data-ph-element={MEMBER_TRACKER_ELEMENTS.HEADER_ADD_BUTTON}\n-            >\n-              {t(\"workspace_settings.settings.members.add_member\")}\n-            </Button>\n-          )}\n-          <BillingActionsButton canPerformWorkspaceAdminActions={canPerformWorkspaceAdminActions} />\n         </div>\n         <WorkspaceMembersList searchQuery={searchQuery} isAdmin={canPerformWorkspaceAdminActions} />\n       </section>\n     </SettingsContentWrapper>\n"
        },
        {
          "path": "apps/web/ce/components/projects/settings/useProjectColumns.tsx",
          "status": "modified",
          "diff": "Index: apps/web/ce/components/projects/settings/useProjectColumns.tsx\n===================================================================\n--- apps/web/ce/components/projects/settings/useProjectColumns.tsx\t85bffaa (parent)\n+++ apps/web/ce/components/projects/settings/useProjectColumns.tsx\t586a7a4 (commit)\n@@ -1,12 +1,16 @@\n import { useState } from \"react\";\n // plane imports\n import { EUserPermissions, EUserPermissionsLevel } from \"@plane/constants\";\n import { IWorkspaceMember, TProjectMembership } from \"@plane/types\";\n+import { renderFormattedDate } from \"@plane/utils\";\n // components\n+import { MemberHeaderColumn } from \"@/components/project/member-header-column\";\n import { AccountTypeColumn, NameColumn } from \"@/components/project/settings/member-columns\";\n // hooks\n+import { useMember } from \"@/hooks/store/use-member\";\n import { useUser, useUserPermissions } from \"@/hooks/store/user\";\n+import { IMemberFilters } from \"@/store/member/utils\";\n \n export interface RowData extends Pick<TProjectMembership, \"original_role\"> {\n   member: IWorkspaceMember;\n }\n@@ -19,11 +23,17 @@\n export const useProjectColumns = (props: TUseProjectColumnsProps) => {\n   const { projectId, workspaceSlug } = props;\n   // states\n   const [removeMemberModal, setRemoveMemberModal] = useState<RowData | null>(null);\n+\n   // store hooks\n   const { data: currentUser } = useUser();\n   const { allowPermissions, getProjectRoleByWorkspaceSlugAndProjectId } = useUserPermissions();\n+  const {\n+    project: {\n+      filters: { getFilters, updateFilters },\n+    },\n+  } = useMember();\n   // derived values\n   const isAdmin = allowPermissions(\n     [EUserPermissions.ADMIN],\n     EUserPermissionsLevel.PROJECT,\n@@ -32,20 +42,27 @@\n   );\n   const currentProjectRole =\n     getProjectRoleByWorkspaceSlugAndProjectId(workspaceSlug.toString(), projectId.toString()) ?? EUserPermissions.GUEST;\n \n-  const getFormattedDate = (dateStr: string) => {\n-    const date = new Date(dateStr);\n+  const displayFilters = getFilters(projectId);\n \n-    const options: Intl.DateTimeFormatOptions = { year: \"numeric\", month: \"long\", day: \"numeric\" };\n-    return date.toLocaleDateString(\"en-US\", options);\n+  // handlers\n+  const handleDisplayFilterUpdate = (filters: Partial<IMemberFilters>) => {\n+    updateFilters(projectId, filters);\n   };\n \n   const columns = [\n     {\n       key: \"Full Name\",\n       content: \"Full name\",\n       thClassName: \"text-left\",\n+      thRender: () => (\n+        <MemberHeaderColumn\n+          property=\"full_name\"\n+          displayFilters={displayFilters}\n+          handleDisplayFilterUpdate={handleDisplayFilterUpdate}\n+        />\n+      ),\n       tdRender: (rowData: RowData) => (\n         <NameColumn\n           rowData={rowData}\n           workspaceSlug={workspaceSlug as string}\n@@ -57,14 +74,39 @@\n     },\n     {\n       key: \"Display Name\",\n       content: \"Display name\",\n+      thRender: () => (\n+        <MemberHeaderColumn\n+          property=\"display_name\"\n+          displayFilters={displayFilters}\n+          handleDisplayFilterUpdate={handleDisplayFilterUpdate}\n+        />\n+      ),\n       tdRender: (rowData: RowData) => <div className=\"w-32\">{rowData.member.display_name}</div>,\n     },\n-\n     {\n+      key: \"Email\",\n+      content: \"Email\",\n+      thRender: () => (\n+        <MemberHeaderColumn\n+          property=\"email\"\n+          displayFilters={displayFilters}\n+          handleDisplayFilterUpdate={handleDisplayFilterUpdate}\n+        />\n+      ),\n+      tdRender: (rowData: RowData) => <div className=\"w-48 text-custom-text-200\">{rowData.member.email}</div>,\n+    },\n+    {\n       key: \"Account Type\",\n       content: \"Account type\",\n+      thRender: () => (\n+        <MemberHeaderColumn\n+          property=\"role\"\n+          displayFilters={displayFilters}\n+          handleDisplayFilterUpdate={handleDisplayFilterUpdate}\n+        />\n+      ),\n       tdRender: (rowData: RowData) => (\n         <AccountTypeColumn\n           rowData={rowData}\n           currentProjectRole={currentProjectRole}\n@@ -75,9 +117,22 @@\n     },\n     {\n       key: \"Joining Date\",\n       content: \"Joining date\",\n-      tdRender: (rowData: RowData) => <div>{getFormattedDate(rowData?.member?.joining_date || \"\")}</div>,\n+      thRender: () => (\n+        <MemberHeaderColumn\n+          property=\"joining_date\"\n+          displayFilters={displayFilters}\n+          handleDisplayFilterUpdate={handleDisplayFilterUpdate}\n+        />\n+      ),\n+      tdRender: (rowData: RowData) => <div>{renderFormattedDate(rowData?.member?.joining_date)}</div>,\n     },\n   ];\n-  return { columns, removeMemberModal, setRemoveMemberModal };\n+  return {\n+    columns,\n+    removeMemberModal,\n+    setRemoveMemberModal,\n+    displayFilters,\n+    handleDisplayFilterUpdate,\n+  };\n };\n"
        },
        {
          "path": "apps/web/ce/components/workspace/settings/useMemberColumns.tsx",
          "status": "modified",
          "diff": "Index: apps/web/ce/components/workspace/settings/useMemberColumns.tsx\n===================================================================\n--- apps/web/ce/components/workspace/settings/useMemberColumns.tsx\t85bffaa (parent)\n+++ apps/web/ce/components/workspace/settings/useMemberColumns.tsx\t586a7a4 (commit)\n@@ -1,10 +1,14 @@\n import { useState } from \"react\";\n import { useParams } from \"next/navigation\";\n import { EUserPermissions, EUserPermissionsLevel } from \"@plane/constants\";\n import { useTranslation } from \"@plane/i18n\";\n+import { renderFormattedDate } from \"@plane/utils\";\n+import { MemberHeaderColumn } from \"@/components/project/member-header-column\";\n import { AccountTypeColumn, NameColumn, RowData } from \"@/components/workspace/settings/member-columns\";\n+import { useMember } from \"@/hooks/store/use-member\";\n import { useUser, useUserPermissions } from \"@/hooks/store/user\";\n+import { IMemberFilters } from \"@/store/member/utils\";\n \n export const useMemberColumns = () => {\n   // states\n   const [removeMemberModal, setRemoveMemberModal] = useState<RowData | null>(null);\n@@ -12,25 +16,35 @@\n   const { workspaceSlug } = useParams();\n \n   const { data: currentUser } = useUser();\n   const { allowPermissions } = useUserPermissions();\n+  const {\n+    workspace: {\n+      filtersStore: { filters, updateFilters },\n+    },\n+  } = useMember();\n   const { t } = useTranslation();\n \n-  const getFormattedDate = (dateStr: string) => {\n-    const date = new Date(dateStr);\n-\n-    const options: Intl.DateTimeFormatOptions = { year: \"numeric\", month: \"long\", day: \"numeric\" };\n-    return date.toLocaleDateString(\"en-US\", options);\n-  };\n-\n   // derived values\n   const isAdmin = allowPermissions([EUserPermissions.ADMIN], EUserPermissionsLevel.WORKSPACE);\n \n+  // handlers\n+  const handleDisplayFilterUpdate = (filterUpdates: Partial<IMemberFilters>) => {\n+    updateFilters(filterUpdates);\n+  };\n+\n   const columns = [\n     {\n       key: \"Full name\",\n       content: t(\"workspace_settings.settings.members.details.full_name\"),\n       thClassName: \"text-left\",\n+      thRender: () => (\n+        <MemberHeaderColumn\n+          property=\"full_name\"\n+          displayFilters={filters}\n+          handleDisplayFilterUpdate={handleDisplayFilterUpdate}\n+        />\n+      ),\n       tdRender: (rowData: RowData) => (\n         <NameColumn\n           rowData={rowData}\n           workspaceSlug={workspaceSlug as string}\n@@ -43,20 +57,41 @@\n \n     {\n       key: \"Display name\",\n       content: t(\"workspace_settings.settings.members.details.display_name\"),\n+      thRender: () => (\n+        <MemberHeaderColumn\n+          property=\"display_name\"\n+          displayFilters={filters}\n+          handleDisplayFilterUpdate={handleDisplayFilterUpdate}\n+        />\n+      ),\n       tdRender: (rowData: RowData) => <div className=\"w-32\">{rowData.member.display_name}</div>,\n     },\n \n     {\n       key: \"Email address\",\n       content: t(\"workspace_settings.settings.members.details.email_address\"),\n+      thRender: () => (\n+        <MemberHeaderColumn\n+          property=\"email\"\n+          displayFilters={filters}\n+          handleDisplayFilterUpdate={handleDisplayFilterUpdate}\n+        />\n+      ),\n       tdRender: (rowData: RowData) => <div className=\"w-48 truncate\">{rowData.member.email}</div>,\n     },\n \n     {\n       key: \"Account type\",\n       content: t(\"workspace_settings.settings.members.details.account_type\"),\n+      thRender: () => (\n+        <MemberHeaderColumn\n+          property=\"role\"\n+          displayFilters={filters}\n+          handleDisplayFilterUpdate={handleDisplayFilterUpdate}\n+        />\n+      ),\n       tdRender: (rowData: RowData) => <AccountTypeColumn rowData={rowData} workspaceSlug={workspaceSlug as string} />,\n     },\n \n     {\n@@ -69,9 +104,16 @@\n \n     {\n       key: \"Joining date\",\n       content: t(\"workspace_settings.settings.members.details.joining_date\"),\n-      tdRender: (rowData: RowData) => <div>{getFormattedDate(rowData?.member?.joining_date || \"\")}</div>,\n+      thRender: () => (\n+        <MemberHeaderColumn\n+          property=\"joining_date\"\n+          displayFilters={filters}\n+          handleDisplayFilterUpdate={handleDisplayFilterUpdate}\n+        />\n+      ),\n+      tdRender: (rowData: RowData) => <div>{renderFormattedDate(rowData?.member?.joining_date)}</div>,\n     },\n   ];\n   return { columns, workspaceSlug, removeMemberModal, setRemoveMemberModal };\n };\n"
        },
        {
          "path": "apps/web/ce/store/member/project-member.store.ts",
          "status": "modified",
          "diff": "Index: apps/web/ce/store/member/project-member.store.ts\n===================================================================\n--- apps/web/ce/store/member/project-member.store.ts\t85bffaa (parent)\n+++ apps/web/ce/store/member/project-member.store.ts\t586a7a4 (commit)\n@@ -4,9 +4,9 @@\n // plane web imports\n import type { RootStore } from \"@/plane-web/store/root.store\";\n // store\n import type { IMemberRootStore } from \"@/store/member\";\n-import { BaseProjectMemberStore, IBaseProjectMemberStore } from \"@/store/member/base-project-member.store\";\n+import { BaseProjectMemberStore, IBaseProjectMemberStore } from \"@/store/member/project/base-project-member.store\";\n \n export type IProjectMemberStore = IBaseProjectMemberStore;\n \n export class ProjectMemberStore extends BaseProjectMemberStore implements IProjectMemberStore {\n"
        },
        {
          "path": "apps/web/core/components/pages/version/editor.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/pages/version/editor.tsx\n===================================================================\n--- apps/web/core/components/pages/version/editor.tsx\t85bffaa (parent)\n+++ apps/web/core/components/pages/version/editor.tsx\t586a7a4 (commit)\n@@ -2,10 +2,10 @@\n import { useParams } from \"next/navigation\";\n // plane imports\n import type { TDisplayConfig } from \"@plane/editor\";\n import type { JSONContent, TPageVersion } from \"@plane/types\";\n-import { isJSONContentEmpty } from \"@plane/utils\";\n import { Loader } from \"@plane/ui\";\n+import { isJSONContentEmpty } from \"@plane/utils\";\n // components\n import { DocumentEditor } from \"@/components/editor/document/editor\";\n // hooks\n import { useWorkspace } from \"@/hooks/store/use-workspace\";\n"
        },
        {
          "path": "apps/web/core/components/project/dropdowns/filters/member-list.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/project/dropdowns/filters/member-list.tsx\n===================================================================\n--- apps/web/core/components/project/dropdowns/filters/member-list.tsx\t85bffaa (parent)\n+++ apps/web/core/components/project/dropdowns/filters/member-list.tsx\t586a7a4 (commit)\n@@ -0,0 +1,106 @@\n+import { useState } from \"react\";\n+import { observer } from \"mobx-react\";\n+import { ChevronDown } from \"lucide-react\";\n+// plane imports\n+import { EUserProjectRoles, EUserWorkspaceRoles } from \"@plane/types\";\n+// plane ui\n+import { Button, CustomMenu } from \"@plane/ui\";\n+// components\n+import { FilterHeader, FilterOption } from \"@/components/issues/issue-layouts/filters\";\n+\n+interface IRoleOption {\n+  value: string;\n+  label: string;\n+}\n+\n+type Props = {\n+  appliedFilters: string[] | null;\n+  handleUpdate: (role: string) => void;\n+  memberType: \"project\" | \"workspace\";\n+};\n+\n+const PROJECT_ROLE_OPTIONS: IRoleOption[] = [\n+  { value: String(EUserProjectRoles.ADMIN), label: \"Admin\" },\n+  { value: String(EUserProjectRoles.MEMBER), label: \"Member\" },\n+  { value: String(EUserProjectRoles.GUEST), label: \"Guest\" },\n+];\n+\n+const WORKSPACE_ROLE_OPTIONS: IRoleOption[] = [\n+  { value: String(EUserWorkspaceRoles.ADMIN), label: \"Admin\" },\n+  { value: String(EUserWorkspaceRoles.MEMBER), label: \"Member\" },\n+  { value: String(EUserWorkspaceRoles.GUEST), label: \"Guest\" },\n+];\n+\n+// Role filter group component\n+const RoleFilterGroup: React.FC<{\n+  appliedFilters: string[] | null;\n+  handleUpdate: (role: string) => void;\n+  memberType: \"project\" | \"workspace\";\n+}> = observer(({ appliedFilters, handleUpdate, memberType }) => {\n+  const [isExpanded, setIsExpanded] = useState(true);\n+  const appliedFiltersCount = appliedFilters?.length ?? 0;\n+  const roleOptions = memberType === \"project\" ? PROJECT_ROLE_OPTIONS : WORKSPACE_ROLE_OPTIONS;\n+\n+  return (\n+    <div className=\"space-y-2\">\n+      <FilterHeader\n+        title={`Roles${appliedFiltersCount > 0 ? ` (${appliedFiltersCount})` : \"\"}`}\n+        isPreviewEnabled={isExpanded}\n+        handleIsPreviewEnabled={() => setIsExpanded(!isExpanded)}\n+      />\n+\n+      {isExpanded && (\n+        <div className=\"space-y-1\">\n+          {roleOptions.map((role) => {\n+            const isSelected = appliedFilters?.includes(role.value) ?? false;\n+            return (\n+              <FilterOption\n+                key={`role-${role.value}`}\n+                isChecked={isSelected}\n+                title={role.label}\n+                onClick={() => handleUpdate(role.value)}\n+              />\n+            );\n+          })}\n+        </div>\n+      )}\n+    </div>\n+  );\n+});\n+\n+export const MemberListFilters: React.FC<Props> = observer((props) => {\n+  const { appliedFilters, handleUpdate, memberType } = props;\n+\n+  return (\n+    <div className=\"space-y-4\">\n+      {/* Role Filter Group */}\n+      <RoleFilterGroup appliedFilters={appliedFilters} handleUpdate={handleUpdate} memberType={memberType} />\n+    </div>\n+  );\n+});\n+\n+// Dropdown component for member list filters\n+export const MemberListFiltersDropdown: React.FC<Props> = observer((props) => {\n+  const { appliedFilters, handleUpdate, memberType } = props;\n+\n+  const appliedFiltersCount = appliedFilters?.length ?? 0;\n+\n+  return (\n+    <CustomMenu\n+      customButton={\n+        <div className=\"relative\">\n+          <Button variant=\"neutral-primary\" size=\"sm\" className=\"flex items-center gap-2\">\n+            <span>Filters</span>\n+            <ChevronDown className=\"h-3 w-3\" />\n+          </Button>\n+          {appliedFiltersCount > 0 && (\n+            <div className=\"absolute -top-1 -right-1 h-2 w-2 rounded-full bg-custom-primary-100\" />\n+          )}\n+        </div>\n+      }\n+      placement=\"bottom-start\"\n+    >\n+      <MemberListFilters appliedFilters={appliedFilters} handleUpdate={handleUpdate} memberType={memberType} />\n+    </CustomMenu>\n+  );\n+});\n"
        },
        {
          "path": "apps/web/core/components/project/member-header-column.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/project/member-header-column.tsx\n===================================================================\n--- apps/web/core/components/project/member-header-column.tsx\t85bffaa (parent)\n+++ apps/web/core/components/project/member-header-column.tsx\t586a7a4 (commit)\n@@ -0,0 +1,114 @@\n+// ui\n+import { observer } from \"mobx-react\";\n+import { ArrowDownWideNarrow, ArrowUpNarrowWide, CheckIcon, ChevronDownIcon, Eraser, MoveRight } from \"lucide-react\";\n+// constants\n+import { MEMBER_PROPERTY_DETAILS, IProjectMemberDisplayProperties, TMemberOrderByOptions } from \"@plane/constants\";\n+// i18n\n+import { useTranslation } from \"@plane/i18n\";\n+// types\n+import { CustomMenu } from \"@plane/ui\";\n+import { IMemberFilters } from \"@/store/member/utils\";\n+\n+interface Props {\n+  property: keyof IProjectMemberDisplayProperties;\n+  displayFilters?: IMemberFilters;\n+  handleDisplayFilterUpdate: (data: Partial<IMemberFilters>) => void;\n+}\n+\n+export const MemberHeaderColumn = observer((props: Props) => {\n+  const { displayFilters, handleDisplayFilterUpdate, property } = props;\n+  // i18n\n+  const { t } = useTranslation();\n+\n+  const propertyDetails = MEMBER_PROPERTY_DETAILS[property];\n+\n+  const activeSortingProperty = displayFilters?.order_by;\n+\n+  const handleOrderBy = (order: TMemberOrderByOptions, _itemKey: keyof IProjectMemberDisplayProperties) => {\n+    handleDisplayFilterUpdate({ order_by: order });\n+  };\n+\n+  const handleClearSorting = () => {\n+    handleDisplayFilterUpdate({ order_by: undefined });\n+  };\n+\n+  if (!propertyDetails) return null;\n+\n+  return (\n+    <CustomMenu\n+      customButtonClassName=\"clickable !w-full\"\n+      customButtonTabIndex={-1}\n+      className=\"!w-full\"\n+      customButton={\n+        <div className=\"flex w-full cursor-pointer items-center justify-between gap-1.5 py-2 text-sm text-custom-text-200 hover:text-custom-text-100\">\n+          <span>{t(propertyDetails.i18n_title)}</span>\n+          <div className=\"ml-3 flex\">\n+            {(activeSortingProperty === propertyDetails.ascendingOrderKey ||\n+              activeSortingProperty === propertyDetails.descendingOrderKey) && (\n+              <div className=\"flex h-3.5 w-3.5 items-center justify-center rounded-full\">\n+                {propertyDetails.ascendingOrderKey === activeSortingProperty ? (\n+                  <ArrowDownWideNarrow className=\"h-3 w-3\" />\n+                ) : (\n+                  <ArrowUpNarrowWide className=\"h-3 w-3\" />\n+                )}\n+              </div>\n+            )}\n+            <ChevronDownIcon className=\"h-3 w-3\" aria-hidden=\"true\" />\n+          </div>\n+        </div>\n+      }\n+      placement=\"bottom-end\"\n+      closeOnSelect\n+    >\n+      {propertyDetails.isSortingAllowed && (\n+        <>\n+          <CustomMenu.MenuItem onClick={() => handleOrderBy(propertyDetails.ascendingOrderKey, property)}>\n+            <div\n+              className={`flex items-center justify-between gap-1.5 px-1 ${\n+                activeSortingProperty === propertyDetails.ascendingOrderKey\n+                  ? \"text-custom-text-100\"\n+                  : \"text-custom-text-200 hover:text-custom-text-100\"\n+              }`}\n+            >\n+              <div className=\"flex items-center gap-2\">\n+                <ArrowDownWideNarrow className=\"h-3 w-3 stroke-[1.5]\" />\n+                <span>{propertyDetails.ascendingOrderTitle}</span>\n+                <MoveRight className=\"h-3 w-3\" />\n+                <span>{propertyDetails.descendingOrderTitle}</span>\n+              </div>\n+              {activeSortingProperty === propertyDetails.ascendingOrderKey && <CheckIcon className=\"h-3 w-3\" />}\n+            </div>\n+          </CustomMenu.MenuItem>\n+\n+          <CustomMenu.MenuItem onClick={() => handleOrderBy(propertyDetails.descendingOrderKey, property)}>\n+            <div\n+              className={`flex items-center justify-between gap-1.5 px-1 ${\n+                activeSortingProperty === propertyDetails.descendingOrderKey\n+                  ? \"text-custom-text-100\"\n+                  : \"text-custom-text-200 hover:text-custom-text-100\"\n+              }`}\n+            >\n+              <div className=\"flex items-center gap-2\">\n+                <ArrowUpNarrowWide className=\"h-3 w-3 stroke-[1.5]\" />\n+                <span>{propertyDetails.descendingOrderTitle}</span>\n+                <MoveRight className=\"h-3 w-3\" />\n+                <span>{propertyDetails.ascendingOrderTitle}</span>\n+              </div>\n+              {activeSortingProperty === propertyDetails.descendingOrderKey && <CheckIcon className=\"h-3 w-3\" />}\n+            </div>\n+          </CustomMenu.MenuItem>\n+\n+          {(activeSortingProperty === propertyDetails.ascendingOrderKey ||\n+            activeSortingProperty === propertyDetails.descendingOrderKey) && (\n+            <CustomMenu.MenuItem className=\"mt-0.5\" key={property} onClick={handleClearSorting}>\n+              <div className=\"flex items-center gap-2 px-1\">\n+                <Eraser className=\"h-3 w-3\" />\n+                <span>{t(\"common.actions.clear_sorting\")}</span>\n+              </div>\n+            </CustomMenu.MenuItem>\n+          )}\n+        </>\n+      )}\n+    </CustomMenu>\n+  );\n+});\n"
        },
        {
          "path": "apps/web/core/components/project/member-list-item.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/project/member-list-item.tsx\n===================================================================\n--- apps/web/core/components/project/member-list-item.tsx\t85bffaa (parent)\n+++ apps/web/core/components/project/member-list-item.tsx\t586a7a4 (commit)\n@@ -12,9 +12,9 @@\n import { useAppRouter } from \"@/hooks/use-app-router\";\n // plane web imports\n import { useProjectColumns } from \"@/plane-web/components/projects/settings/useProjectColumns\";\n // store\n-import { IProjectMemberDetails } from \"@/store/member/base-project-member.store\";\n+import { IProjectMemberDetails } from \"@/store/member/project/base-project-member.store\";\n // local imports\n import { ConfirmProjectMemberRemove } from \"./confirm-project-member-remove\";\n \n type Props = {\n"
        },
        {
          "path": "apps/web/core/components/project/member-list.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/project/member-list.tsx\n===================================================================\n--- apps/web/core/components/project/member-list.tsx\t85bffaa (parent)\n+++ apps/web/core/components/project/member-list.tsx\t586a7a4 (commit)\n@@ -12,8 +12,9 @@\n // hooks\n import { useMember } from \"@/hooks/store/use-member\";\n import { useUserPermissions } from \"@/hooks/store/user\";\n // local imports\n+import { MemberListFiltersDropdown } from \"./dropdowns/filters/member-list\";\n import { ProjectMemberListItem } from \"./member-list-item\";\n import { SendProjectInvitationModal } from \"./send-project-invitation-modal\";\n \n type TProjectMemberListProps = {\n@@ -26,30 +27,49 @@\n   // states\n   const [inviteModal, setInviteModal] = useState(false);\n   const [searchQuery, setSearchQuery] = useState(\"\");\n   const {\n-    project: { projectMemberIds, getProjectMemberDetails },\n+    project: { projectMemberIds, getFilteredProjectMemberDetails, filters },\n   } = useMember();\n   const { allowPermissions } = useUserPermissions();\n \n   const { t } = useTranslation();\n \n   const searchedProjectMembers = (projectMemberIds ?? []).filter((userId) => {\n-    const memberDetails = projectId ? getProjectMemberDetails(userId, projectId.toString()) : null;\n+    const memberDetails = projectId ? getFilteredProjectMemberDetails(userId, projectId.toString()) : null;\n \n     if (!memberDetails?.member || !memberDetails.original_role) return false;\n \n     const fullName = `${memberDetails?.member.first_name} ${memberDetails?.member.last_name}`.toLowerCase();\n     const displayName = memberDetails?.member.display_name.toLowerCase();\n \n     return displayName?.includes(searchQuery.toLowerCase()) || fullName.includes(searchQuery.toLowerCase());\n   });\n+\n   const memberDetails = searchedProjectMembers?.map((memberId) =>\n-    projectId ? getProjectMemberDetails(memberId, projectId.toString()) : null\n+    projectId ? getFilteredProjectMemberDetails(memberId, projectId.toString()) : null\n   );\n \n   const isAdmin = allowPermissions([EUserPermissions.ADMIN], EUserPermissionsLevel.PROJECT);\n \n+  // Handler for role filter updates\n+  const handleRoleFilterUpdate = (role: string) => {\n+    if (projectId) {\n+      const currentFilters = filters.getFilters(projectId);\n+      const currentRoles = currentFilters?.roles || [];\n+      const updatedRoles = currentRoles.includes(role)\n+        ? currentRoles.filter((r) => r !== role)\n+        : [...currentRoles, role];\n+\n+      filters.updateFilters(projectId, {\n+        roles: updatedRoles.length > 0 ? updatedRoles : undefined,\n+      });\n+    }\n+  };\n+\n+  // Get current role filters\n+  const appliedRoleFilters = projectId ? filters.getFilters(projectId)?.roles || [] : [];\n+\n   return (\n     <>\n       <SendProjectInvitationModal\n         isOpen={inviteModal}\n@@ -58,30 +78,37 @@\n         workspaceSlug={workspaceSlug}\n       />\n       <div className=\"flex items-center justify-between gap-4 py-2 overflow-x-hidden border-b border-custom-border-100\">\n         <div className=\"text-base font-semibold\">{t(\"common.members\")}</div>\n-        <div className=\"ml-auto flex items-center justify-start gap-1.5 rounded-md border border-custom-border-200 bg-custom-background-100 px-2 py-1\">\n-          <Search className=\"h-3.5 w-3.5\" />\n-          <input\n-            className=\"w-full max-w-[234px] border-none bg-transparent text-sm focus:outline-none placeholder:text-custom-text-400\"\n-            placeholder=\"Search\"\n-            value={searchQuery}\n-            autoFocus\n-            onChange={(e) => setSearchQuery(e.target.value)}\n+        <div className=\"flex items-center gap-2\">\n+          <div className=\"flex items-center justify-start gap-1.5 rounded-md border border-custom-border-200 bg-custom-background-100 px-2 py-1\">\n+            <Search className=\"h-3.5 w-3.5\" />\n+            <input\n+              className=\"w-full max-w-[234px] border-none bg-transparent text-sm focus:outline-none placeholder:text-custom-text-400\"\n+              placeholder=\"Search\"\n+              value={searchQuery}\n+              autoFocus\n+              onChange={(e) => setSearchQuery(e.target.value)}\n+            />\n+          </div>\n+          <MemberListFiltersDropdown\n+            appliedFilters={appliedRoleFilters}\n+            handleUpdate={handleRoleFilterUpdate}\n+            memberType=\"project\"\n           />\n+          {isAdmin && (\n+            <Button\n+              variant=\"primary\"\n+              size=\"sm\"\n+              onClick={() => {\n+                setInviteModal(true);\n+              }}\n+              data-ph-element={MEMBER_TRACKER_ELEMENTS.HEADER_ADD_BUTTON}\n+            >\n+              {t(\"add_member\")}\n+            </Button>\n+          )}\n         </div>\n-        {isAdmin && (\n-          <Button\n-            variant=\"primary\"\n-            size=\"sm\"\n-            onClick={() => {\n-              setInviteModal(true);\n-            }}\n-            data-ph-element={MEMBER_TRACKER_ELEMENTS.HEADER_ADD_BUTTON}\n-          >\n-            {t(\"add_member\")}\n-          </Button>\n-        )}\n       </div>\n       {!projectMemberIds ? (\n         <MembersSettingsLoader />\n       ) : (\n"
        },
        {
          "path": "apps/web/core/components/workspace/settings/members-list.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/workspace/settings/members-list.tsx\n===================================================================\n--- apps/web/core/components/workspace/settings/members-list.tsx\t85bffaa (parent)\n+++ apps/web/core/components/workspace/settings/members-list.tsx\t586a7a4 (commit)\n@@ -27,8 +27,9 @@\n     workspace: {\n       fetchWorkspaceMembers,\n       fetchWorkspaceMemberInvitations,\n       workspaceMemberIds,\n+      getFilteredWorkspaceMemberIds,\n       getSearchedWorkspaceMemberIds,\n       workspaceMemberInvitationIds,\n       getSearchedWorkspaceInvitationIds,\n       getWorkspaceMemberDetails,\n@@ -48,9 +49,10 @@\n \n   if (!workspaceMemberIds && !workspaceMemberInvitationIds) return <MembersSettingsLoader />;\n \n   // derived values\n-  const searchedMemberIds = getSearchedWorkspaceMemberIds(searchQuery);\n+  const filteredMemberIds = workspaceSlug ? getFilteredWorkspaceMemberIds(workspaceSlug.toString()) : [];\n+  const searchedMemberIds = searchQuery ? getSearchedWorkspaceMemberIds(searchQuery) : filteredMemberIds;\n   const searchedInvitationsIds = getSearchedWorkspaceInvitationIds(searchQuery);\n   const memberDetails = searchedMemberIds?.map((memberId) => getWorkspaceMemberDetails(memberId));\n \n   return (\n"
        },
        {
          "path": "apps/web/core/store/issue/root.store.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/store/issue/root.store.ts\n===================================================================\n--- apps/web/core/store/issue/root.store.ts\t85bffaa (parent)\n+++ apps/web/core/store/issue/root.store.ts\t586a7a4 (commit)\n@@ -28,9 +28,9 @@\n } from \"@/plane-web/store/issue/team-views\";\n // root store\n import { IWorkspaceIssues, WorkspaceIssues } from \"@/plane-web/store/issue/workspace/issue.store\";\n import type { RootStore } from \"@/plane-web/store/root.store\";\n-import { IWorkspaceMembership } from \"@/store/member/workspace-member.store\";\n+import { IWorkspaceMembership } from \"@/store/member/workspace/workspace-member.store\";\n // issues data store\n import { IArchivedIssuesFilter, ArchivedIssuesFilter, IArchivedIssues, ArchivedIssues } from \"./archived\";\n import { ICycleIssuesFilter, CycleIssuesFilter, ICycleIssues, CycleIssues } from \"./cycle\";\n import { IIssueStore, IssueStore } from \"./issue.store\";\n"
        },
        {
          "path": "apps/web/core/store/member/index.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/store/member/index.ts\n===================================================================\n--- apps/web/core/store/member/index.ts\t85bffaa (parent)\n+++ apps/web/core/store/member/index.ts\t586a7a4 (commit)\n@@ -5,9 +5,9 @@\n // plane web imports\n import { IProjectMemberStore, ProjectMemberStore } from \"@/plane-web/store/member/project-member.store\";\n import type { RootStore } from \"@/plane-web/store/root.store\";\n // local imports\n-import { IWorkspaceMemberStore, WorkspaceMemberStore } from \"./workspace-member.store\";\n+import { IWorkspaceMemberStore, WorkspaceMemberStore } from \"./workspace/workspace-member.store\";\n \n export interface IMemberRootStore {\n   // observables\n   memberMap: Record<string, IUserLite>;\n"
        },
        {
          "path": "apps/web/core/store/member/project/base-project-member.store.ts",
          "status": "renamed",
          "oldPath": "apps/web/core/store/member/base-project-member.store.ts",
          "diff": "===================================================================\n--- apps/web/core/store/member/base-project-member.store.ts\t85bffaa (parent)\n+++ apps/web/core/store/member/project/base-project-member.store.ts\t586a7a4 (commit)\n@@ -12,13 +12,15 @@\n import type { RootStore } from \"@/plane-web/store/root.store\";\n // services\n import { ProjectMemberService } from \"@/services/project\";\n // store\n+import { IProjectStore } from \"@/store/project/project.store\";\n import { IRouterStore } from \"@/store/router.store\";\n import { IUserStore } from \"@/store/user\";\n // local imports\n-import { IProjectStore } from \"../project/project.store\";\n-import { IMemberRootStore } from \".\";\n+import { IMemberRootStore } from \"../index\";\n+import { sortProjectMembers } from \"../utils\";\n+import { ProjectMemberFiltersStore, IProjectMemberFiltersStore } from \"./project-member-filters.store\";\n \n export interface IProjectMemberDetails extends Omit<TProjectMembership, \"member\"> {\n   member: IUserLite;\n }\n@@ -30,14 +32,17 @@\n   };\n   projectMemberMap: {\n     [projectId: string]: Record<string, TProjectMembership>;\n   };\n+  // filters store\n+  filters: IProjectMemberFiltersStore;\n   // computed\n   projectMemberIds: string[] | null;\n   // computed actions\n   getProjectMemberFetchStatus: (projectId: string) => boolean;\n   getProjectMemberDetails: (userId: string, projectId: string) => IProjectMemberDetails | null;\n   getProjectMemberIds: (projectId: string, includeGuestUsers: boolean) => string[] | null;\n+  getFilteredProjectMemberDetails: (userId: string, projectId: string) => IProjectMemberDetails | null;\n   // fetch actions\n   fetchProjectMembers: (\n     workspaceSlug: string,\n     projectId: string,\n@@ -66,8 +71,10 @@\n   } = {};\n   projectMemberMap: {\n     [projectId: string]: Record<string, TProjectMembership>;\n   } = {};\n+  // filters store\n+  filters: IProjectMemberFiltersStore;\n   // stores\n   routerStore: IRouterStore;\n   userStore: IUserStore;\n   memberRoot: IMemberRootStore;\n@@ -87,33 +94,42 @@\n       bulkAddMembersToProject: action,\n       updateMemberRole: action,\n       removeMemberFromProject: action,\n     });\n-\n     // root store\n     this.rootStore = _rootStore;\n     this.routerStore = _rootStore.router;\n     this.userStore = _rootStore.user;\n     this.memberRoot = _memberRoot;\n     this.projectRoot = _rootStore.projectRoot.project;\n+    this.filters = new ProjectMemberFiltersStore();\n     // services\n     this.projectMemberService = new ProjectMemberService();\n   }\n \n   /**\n    * @description get the list of all the user ids of all the members of the current project\n+   * Returns filtered and sorted member IDs based on current filters\n    */\n   get projectMemberIds() {\n     const projectId = this.routerStore.projectId;\n     if (!projectId) return null;\n-    let members = Object.values(this.projectMemberMap?.[projectId] ?? {});\n+\n+    const members = Object.values(this.projectMemberMap?.[projectId] ?? {});\n     if (members.length === 0) return null;\n-    members = sortBy(members, [\n-      (m) => m.member !== this.userStore.data?.id,\n-      (m) => this.memberRoot.memberMap?.[m.member]?.display_name.toLowerCase(),\n-    ]);\n-    const memberIds = members.map((m) => m.member);\n-    return memberIds;\n+\n+    // Access the filters directly to ensure MobX tracking\n+    const currentFilters = this.filters.filtersMap[projectId];\n+\n+    // Apply filters and sorting directly here to ensure MobX tracking\n+    const sortedMembers = sortProjectMembers(\n+      members,\n+      this.memberRoot?.memberMap || {},\n+      (member) => member.member,\n+      currentFilters\n+    );\n+\n+    return sortedMembers.map((member) => member.member);\n   }\n \n   /**\n    * @description get the fetch status of a project member\n@@ -202,8 +218,43 @@\n     return memberIds;\n   });\n \n   /**\n+   * @description get the filtered project member details for a specific user\n+   * @param userId\n+   * @param projectId\n+   */\n+  getFilteredProjectMemberDetails = computedFn((userId: string, projectId: string) => {\n+    const projectMember = this.getProjectMembershipByUserId(userId, projectId);\n+    const userDetails = this.memberRoot?.memberMap?.[projectMember?.member];\n+    if (!projectMember || !userDetails) return null;\n+\n+    // Check if this member passes the current filters\n+    const allMembers = this.getProjectMemberships(projectId);\n+    const filteredMemberIds = this.filters.getFilteredMemberIds(\n+      allMembers,\n+      this.memberRoot?.memberMap || {},\n+      (member) => member.member,\n+      projectId\n+    );\n+\n+    // Return null if this user doesn't pass the filters\n+    if (!filteredMemberIds.includes(userId)) return null;\n+\n+    const memberDetails: IProjectMemberDetails = {\n+      id: projectMember.id,\n+      role: projectMember.role,\n+      original_role: projectMember.original_role,\n+      member: {\n+        ...userDetails,\n+        joining_date: projectMember.created_at ?? undefined,\n+      },\n+      created_at: projectMember.created_at,\n+    };\n+    return memberDetails;\n+  });\n+\n+  /**\n    * @description fetch the list of all the members of a project\n    * @param workspaceSlug\n    * @param projectId\n    */\n"
        },
        {
          "path": "apps/web/core/store/member/project/project-member-filters.store.ts",
          "status": "added",
          "diff": "Index: apps/web/core/store/member/project/project-member-filters.store.ts\n===================================================================\n--- apps/web/core/store/member/project/project-member-filters.store.ts\t85bffaa (parent)\n+++ apps/web/core/store/member/project/project-member-filters.store.ts\t586a7a4 (commit)\n@@ -0,0 +1,70 @@\n+import { action, makeObservable, observable } from \"mobx\";\n+import { computedFn } from \"mobx-utils\";\n+// types\n+import type { IUserLite, TProjectMembership } from \"@plane/types\";\n+// local imports\n+import { IMemberFilters, sortProjectMembers } from \"../utils\";\n+\n+export interface IProjectMemberFiltersStore {\n+  // observables\n+  filtersMap: Record<string, IMemberFilters>;\n+  // computed actions\n+  getFilteredMemberIds: (\n+    members: TProjectMembership[],\n+    memberDetailsMap: Record<string, IUserLite>,\n+    getMemberKey: (member: TProjectMembership) => string,\n+    projectId: string\n+  ) => string[];\n+  // actions\n+  updateFilters: (projectId: string, filters: Partial<IMemberFilters>) => void;\n+  getFilters: (projectId: string) => IMemberFilters | undefined;\n+}\n+\n+export class ProjectMemberFiltersStore implements IProjectMemberFiltersStore {\n+  // observables\n+  filtersMap: Record<string, IMemberFilters> = {};\n+\n+  constructor() {\n+    makeObservable(this, {\n+      // observables\n+      filtersMap: observable,\n+      // actions\n+      updateFilters: action,\n+    });\n+  }\n+\n+  /**\n+   * @description get filtered and sorted member ids\n+   * @param members - array of project membership objects\n+   * @param memberDetailsMap - map of member details by user id\n+   * @param getMemberKey - function to get member key from membership object\n+   * @param projectId - project id to get filters for\n+   */\n+  getFilteredMemberIds = computedFn(\n+    (\n+      members: TProjectMembership[],\n+      memberDetailsMap: Record<string, IUserLite>,\n+      getMemberKey: (member: TProjectMembership) => string,\n+      projectId: string\n+    ): string[] => {\n+      if (!members || members.length === 0) return [];\n+\n+      // Apply filters and sorting\n+      const sortedMembers = sortProjectMembers(members, memberDetailsMap, getMemberKey, this.filtersMap[projectId]);\n+\n+      return sortedMembers.map(getMemberKey);\n+    }\n+  );\n+\n+  getFilters = (projectId: string) => this.filtersMap[projectId];\n+\n+  /**\n+   * @description update filters\n+   * @param projectId - project id\n+   * @param filters - partial filters to update\n+   */\n+  updateFilters = (projectId: string, filters: Partial<IMemberFilters>) => {\n+    const current = this.filtersMap[projectId] ?? {};\n+    this.filtersMap[projectId] = { ...current, ...filters };\n+  };\n+}\n"
        },
        {
          "path": "apps/web/core/store/member/utils.ts",
          "status": "added",
          "diff": "Index: apps/web/core/store/member/utils.ts\n===================================================================\n--- apps/web/core/store/member/utils.ts\t85bffaa (parent)\n+++ apps/web/core/store/member/utils.ts\t586a7a4 (commit)\n@@ -0,0 +1,163 @@\n+// Types and utilities for member filtering\n+import type { EUserPermissions, TMemberOrderByOptions } from \"@plane/constants\";\n+import type { IUserLite, TProjectMembership } from \"@plane/types\";\n+\n+export interface IMemberFilters {\n+  order_by?: TMemberOrderByOptions;\n+  roles?: string[];\n+}\n+\n+// Helper function to parse order key and direction\n+export const parseOrderKey = (orderKey?: TMemberOrderByOptions): { field: string; direction: \"asc\" | \"desc\" } => {\n+  // Default to sorting by display_name in ascending order when no order key is provided\n+  if (!orderKey) {\n+    return {\n+      field: \"display_name\",\n+      direction: \"asc\",\n+    };\n+  }\n+\n+  const isDescending = orderKey.startsWith(\"-\");\n+  const field = isDescending ? orderKey.slice(1) : orderKey;\n+  return {\n+    field,\n+    direction: isDescending ? \"desc\" : \"asc\",\n+  };\n+};\n+\n+// Unified function to get sort key for any member type\n+export const getMemberSortKey = (memberDetails: IUserLite, field: string, memberRole?: string): string | Date => {\n+  switch (field) {\n+    case \"display_name\":\n+      return memberDetails.display_name?.toLowerCase() || \"\";\n+    case \"full_name\": {\n+      const firstName = memberDetails.first_name || \"\";\n+      const lastName = memberDetails.last_name || \"\";\n+      return `${firstName} ${lastName}`.toLowerCase().trim();\n+    }\n+    case \"email\":\n+      return memberDetails.email?.toLowerCase() || \"\";\n+    case \"joining_date\":\n+      return memberDetails.joining_date ? new Date(memberDetails.joining_date) : new Date(NaN);\n+    case \"role\":\n+      return (memberRole ?? \"\").toString().toLowerCase();\n+    default:\n+      return \"\";\n+  }\n+};\n+\n+// Filter functions\n+export const filterProjectMembersByRole = (\n+  members: TProjectMembership[],\n+  roleFilters: string[]\n+): TProjectMembership[] => {\n+  if (roleFilters.length === 0) return members;\n+\n+  return members.filter((member) => {\n+    const memberRole = String(member.role ?? member.original_role ?? \"\");\n+    return roleFilters.includes(memberRole);\n+  });\n+};\n+\n+export const filterWorkspaceMembersByRole = <T extends { role: string | EUserPermissions }>(\n+  members: T[],\n+  roleFilters: string[]\n+): T[] => {\n+  if (roleFilters.length === 0) return members;\n+\n+  return members.filter((member) => {\n+    const memberRole = String(member.role ?? \"\");\n+    return roleFilters.includes(memberRole);\n+  });\n+};\n+\n+// Unified sorting function\n+export const sortMembers = <T>(\n+  members: T[],\n+  memberDetailsMap: Record<string, IUserLite>,\n+  getMemberKey: (member: T) => string,\n+  getMemberRole: (member: T) => string,\n+  orderBy?: TMemberOrderByOptions\n+): T[] => {\n+  if (!orderBy) return members;\n+\n+  const { field, direction } = parseOrderKey(orderBy);\n+\n+  return [...members].sort((a, b) => {\n+    const aKey = getMemberKey(a);\n+    const bKey = getMemberKey(b);\n+    const aMemberDetails = memberDetailsMap[aKey];\n+    const bMemberDetails = memberDetailsMap[bKey];\n+\n+    if (!aMemberDetails || !bMemberDetails) return 0;\n+\n+    const aRole = getMemberRole(a);\n+    const bRole = getMemberRole(b);\n+\n+    const aValue = getMemberSortKey(aMemberDetails, field, aRole);\n+    const bValue = getMemberSortKey(bMemberDetails, field, bRole);\n+\n+    let comparison = 0;\n+\n+    if (field === \"joining_date\") {\n+      // For dates, we need to handle Date objects\n+      const aDate = aValue instanceof Date ? aValue : new Date(aValue);\n+      const bDate = bValue instanceof Date ? bValue : new Date(bValue);\n+      comparison = aDate.getTime() - bDate.getTime();\n+    } else {\n+      // For strings, use localeCompare for proper alphabetical sorting\n+      const aStr = String(aValue);\n+      const bStr = String(bValue);\n+      comparison = aStr.localeCompare(bStr);\n+    }\n+\n+    return direction === \"desc\" ? -comparison : comparison;\n+  });\n+};\n+\n+// Specific implementations using the unified functions\n+export const sortProjectMembers = (\n+  members: TProjectMembership[],\n+  memberDetailsMap: Record<string, IUserLite>,\n+  getMemberKey: (member: TProjectMembership) => string,\n+  filters?: IMemberFilters\n+): TProjectMembership[] => {\n+  // Apply role filtering first\n+  const filteredMembers =\n+    filters?.roles && filters.roles.length > 0 ? filterProjectMembersByRole(members, filters.roles) : members;\n+\n+  // If no order_by filter, return filtered members\n+  if (!filters?.order_by) return filteredMembers;\n+\n+  // Apply sorting\n+  return sortMembers(\n+    filteredMembers,\n+    memberDetailsMap,\n+    getMemberKey,\n+    (member) => String(member.role ?? member.original_role ?? \"\"),\n+    filters.order_by\n+  );\n+};\n+\n+export const sortWorkspaceMembers = <T extends { role: string | EUserPermissions }>(\n+  members: T[],\n+  memberDetailsMap: Record<string, IUserLite>,\n+  getMemberKey: (member: T) => string,\n+  filters?: IMemberFilters\n+): T[] => {\n+  // Apply role filtering first\n+  const filteredMembers =\n+    filters?.roles && filters.roles.length > 0 ? filterWorkspaceMembersByRole(members, filters.roles) : members;\n+\n+  // If no order_by filter, return filtered members\n+  if (!filters?.order_by) return filteredMembers;\n+\n+  // Apply sorting\n+  return sortMembers(\n+    filteredMembers,\n+    memberDetailsMap,\n+    getMemberKey,\n+    (member) => String(member.role ?? \"\"),\n+    filters.order_by\n+  );\n+};\n"
        },
        {
          "path": "apps/web/core/store/member/workspace/workspace-member-filters.store.ts",
          "status": "added",
          "diff": "Index: apps/web/core/store/member/workspace/workspace-member-filters.store.ts\n===================================================================\n--- apps/web/core/store/member/workspace/workspace-member-filters.store.ts\t85bffaa (parent)\n+++ apps/web/core/store/member/workspace/workspace-member-filters.store.ts\t586a7a4 (commit)\n@@ -0,0 +1,71 @@\n+import { action, makeObservable, observable } from \"mobx\";\n+import { computedFn } from \"mobx-utils\";\n+// types\n+import type { EUserPermissions } from \"@plane/constants\";\n+import type { IUserLite } from \"@plane/types\";\n+// local imports\n+import { IMemberFilters, sortWorkspaceMembers } from \"../utils\";\n+\n+// Workspace membership interface matching the store structure\n+interface IWorkspaceMembership {\n+  id: string;\n+  member: string;\n+  role: EUserPermissions;\n+  is_active?: boolean;\n+}\n+\n+export interface IWorkspaceMemberFiltersStore {\n+  // observables\n+  filters: IMemberFilters;\n+  // computed actions\n+  getFilteredMemberIds: (\n+    members: IWorkspaceMembership[],\n+    memberDetailsMap: Record<string, IUserLite>,\n+    getMemberKey: (member: IWorkspaceMembership) => string\n+  ) => string[];\n+  // actions\n+  updateFilters: (filters: Partial<IMemberFilters>) => void;\n+}\n+\n+export class WorkspaceMemberFiltersStore implements IWorkspaceMemberFiltersStore {\n+  // observables\n+  filters: IMemberFilters = {};\n+\n+  constructor() {\n+    makeObservable(this, {\n+      // observables\n+      filters: observable,\n+      // actions\n+      updateFilters: action,\n+    });\n+  }\n+\n+  /**\n+   * @description get filtered and sorted member ids\n+   * @param members - array of workspace membership objects\n+   * @param memberDetailsMap - map of member details by user id\n+   * @param getMemberKey - function to get member key from membership object\n+   */\n+  getFilteredMemberIds = computedFn(\n+    (\n+      members: IWorkspaceMembership[],\n+      memberDetailsMap: Record<string, IUserLite>,\n+      getMemberKey: (member: IWorkspaceMembership) => string\n+    ): string[] => {\n+      if (!members || members.length === 0) return [];\n+\n+      // Apply filters and sorting\n+      const sortedMembers = sortWorkspaceMembers(members, memberDetailsMap, getMemberKey, this.filters);\n+\n+      return sortedMembers.map(getMemberKey);\n+    }\n+  );\n+\n+  /**\n+   * @description update filters\n+   * @param filters - partial filters to update\n+   */\n+  updateFilters = (filters: Partial<IMemberFilters>) => {\n+    this.filters = { ...this.filters, ...filters };\n+  };\n+}\n"
        },
        {
          "path": "apps/web/core/store/member/workspace/workspace-member.store.ts",
          "status": "renamed",
          "oldPath": "apps/web/core/store/member/workspace-member.store.ts",
          "diff": "===================================================================\n--- apps/web/core/store/member/workspace-member.store.ts\t85bffaa (parent)\n+++ apps/web/core/store/member/workspace/workspace-member.store.ts\t586a7a4 (commit)\n@@ -11,10 +11,11 @@\n // types\n import type { IRouterStore } from \"@/store/router.store\";\n import type { IUserStore } from \"@/store/user\";\n // store\n-import type { CoreRootStore } from \"../root.store\";\n-import type { IMemberRootStore } from \".\";\n+import type { CoreRootStore } from \"../../root.store\";\n+import type { IMemberRootStore } from \"../index.ts\";\n+import { WorkspaceMemberFiltersStore, IWorkspaceMemberFiltersStore } from \"./workspace-member-filters.store\";\n \n export interface IWorkspaceMembership {\n   id: string;\n   member: string;\n@@ -25,14 +26,17 @@\n export interface IWorkspaceMemberStore {\n   // observables\n   workspaceMemberMap: Record<string, Record<string, IWorkspaceMembership>>;\n   workspaceMemberInvitations: Record<string, IWorkspaceMemberInvitation[]>;\n+  // filters store\n+  filtersStore: IWorkspaceMemberFiltersStore;\n   // computed\n   workspaceMemberIds: string[] | null;\n   workspaceMemberInvitationIds: string[] | null;\n   memberMap: Record<string, IWorkspaceMembership> | null;\n   // computed actions\n   getWorkspaceMemberIds: (workspaceSlug: string) => string[];\n+  getFilteredWorkspaceMemberIds: (workspaceSlug: string) => string[];\n   getSearchedWorkspaceMemberIds: (searchQuery: string) => string[] | null;\n   getSearchedWorkspaceInvitationIds: (searchQuery: string) => string[] | null;\n   getWorkspaceMemberDetails: (workspaceMemberId: string) => IWorkspaceMember | null;\n   getWorkspaceInvitationDetails: (invitationId: string) => IWorkspaceMemberInvitation | null;\n@@ -57,8 +61,10 @@\n   workspaceMemberMap: {\n     [workspaceSlug: string]: Record<string, IWorkspaceMembership>;\n   } = {}; // { workspaceSlug: { userId: userDetails } }\n   workspaceMemberInvitations: Record<string, IWorkspaceMemberInvitation[]> = {}; // { workspaceSlug: [invitations] }\n+  // filters store\n+  filtersStore: IWorkspaceMemberFiltersStore;\n   // stores\n   routerStore: IRouterStore;\n   userStore: IUserStore;\n   memberRoot: IMemberRootStore;\n@@ -81,9 +87,10 @@\n       fetchWorkspaceMemberInvitations: action,\n       updateMemberInvitation: action,\n       deleteMemberInvitation: action,\n     });\n-\n+    // initialize filters store\n+    this.filtersStore = new WorkspaceMemberFiltersStore();\n     // root store\n     this.routerStore = _rootStore.router;\n     this.userStore = _rootStore.user;\n     this.memberRoot = _memberRoot;\n@@ -126,17 +133,36 @@\n     return memberIds;\n   });\n \n   /**\n+   * @description get the filtered and sorted list of all the user ids of all the members of the workspace\n+   * @param workspaceSlug\n+   */\n+  getFilteredWorkspaceMemberIds = computedFn((workspaceSlug: string) => {\n+    let members = Object.values(this.workspaceMemberMap?.[workspaceSlug] ?? {});\n+    //filter out bots and inactive members\n+    members = members.filter((m) => m.is_active && !this.memberRoot?.memberMap?.[m.member]?.is_bot);\n+\n+    // Use filters store to get filtered member ids\n+    const memberIds = this.filtersStore.getFilteredMemberIds(\n+      members,\n+      this.memberRoot?.memberMap || {},\n+      (member) => member.member\n+    );\n+\n+    return memberIds;\n+  });\n+\n+  /**\n    * @description get the list of all the user ids that match the search query of all the members of the current workspace\n    * @param searchQuery\n    */\n   getSearchedWorkspaceMemberIds = computedFn((searchQuery: string) => {\n     const workspaceSlug = this.routerStore.workspaceSlug;\n     if (!workspaceSlug) return null;\n-    const workspaceMemberIds = this.workspaceMemberIds;\n-    if (!workspaceMemberIds) return null;\n-    const searchedWorkspaceMemberIds = workspaceMemberIds?.filter((userId) => {\n+    const filteredMemberIds = this.getFilteredWorkspaceMemberIds(workspaceSlug);\n+    if (!filteredMemberIds) return null;\n+    const searchedWorkspaceMemberIds = filteredMemberIds.filter((userId) => {\n       const memberDetails = this.getWorkspaceMemberDetails(userId);\n       if (!memberDetails) return false;\n       const memberSearchQuery = `${memberDetails.member.first_name} ${memberDetails.member.last_name} ${\n         memberDetails.member?.display_name\n"
        },
        {
          "path": "packages/constants/src/index.ts",
          "status": "modified",
          "diff": "Index: packages/constants/src/index.ts\n===================================================================\n--- packages/constants/src/index.ts\t85bffaa (parent)\n+++ packages/constants/src/index.ts\t586a7a4 (commit)\n@@ -14,8 +14,9 @@\n export * from \"./icon\";\n export * from \"./instance\";\n export * from \"./intake\";\n export * from \"./issue\";\n+export * from \"./members\";\n export * from \"./label\";\n export * from \"./metadata\";\n export * from \"./module\";\n export * from \"./notification\";\n"
        },
        {
          "path": "packages/constants/src/members.ts",
          "status": "added",
          "diff": "Index: packages/constants/src/members.ts\n===================================================================\n--- packages/constants/src/members.ts\t85bffaa (parent)\n+++ packages/constants/src/members.ts\t586a7a4 (commit)\n@@ -0,0 +1,79 @@\n+// Member property constants - Single source of truth for member spreadsheet properties\n+\n+export type TMemberOrderByOptions =\n+  | \"display_name\"\n+  | \"-display_name\"\n+  | \"full_name\"\n+  | \"-full_name\"\n+  | \"email\"\n+  | \"-email\"\n+  | \"joining_date\"\n+  | \"-joining_date\"\n+  | \"role\"\n+  | \"-role\";\n+\n+export interface IProjectMemberDisplayProperties {\n+  full_name: boolean;\n+  display_name: boolean;\n+  email: boolean;\n+  joining_date: boolean;\n+  role: boolean;\n+}\n+\n+export const MEMBER_PROPERTY_DETAILS: {\n+  [key in keyof IProjectMemberDisplayProperties]: {\n+    i18n_title: string;\n+    ascendingOrderKey: TMemberOrderByOptions;\n+    ascendingOrderTitle: string;\n+    descendingOrderKey: TMemberOrderByOptions;\n+    descendingOrderTitle: string;\n+    iconName: string;\n+    isSortingAllowed: boolean;\n+  };\n+} = {\n+  full_name: {\n+    i18n_title: \"project_members.full_name\",\n+    ascendingOrderKey: \"full_name\",\n+    ascendingOrderTitle: \"A\",\n+    descendingOrderKey: \"-full_name\",\n+    descendingOrderTitle: \"Z\",\n+    iconName: \"User\",\n+    isSortingAllowed: true,\n+  },\n+  display_name: {\n+    i18n_title: \"project_members.display_name\",\n+    ascendingOrderKey: \"display_name\",\n+    ascendingOrderTitle: \"A\",\n+    descendingOrderKey: \"-display_name\",\n+    descendingOrderTitle: \"Z\",\n+    iconName: \"User\",\n+    isSortingAllowed: true,\n+  },\n+  email: {\n+    i18n_title: \"project_members.email\",\n+    ascendingOrderKey: \"email\",\n+    ascendingOrderTitle: \"A\",\n+    descendingOrderKey: \"-email\",\n+    descendingOrderTitle: \"Z\",\n+    iconName: \"Mail\",\n+    isSortingAllowed: true,\n+  },\n+  joining_date: {\n+    i18n_title: \"project_members.joining_date\",\n+    ascendingOrderKey: \"joining_date\",\n+    ascendingOrderTitle: \"Old\",\n+    descendingOrderKey: \"-joining_date\",\n+    descendingOrderTitle: \"New\",\n+    iconName: \"Calendar\",\n+    isSortingAllowed: true,\n+  },\n+  role: {\n+    i18n_title: \"project_members.role\",\n+    ascendingOrderKey: \"role\",\n+    ascendingOrderTitle: \"Guest\",\n+    descendingOrderKey: \"-role\",\n+    descendingOrderTitle: \"Admin\",\n+    iconName: \"Shield\",\n+    isSortingAllowed: true,\n+  },\n+};\n"
        },
        {
          "path": "packages/i18n/src/locales/en/translations.json",
          "status": "modified",
          "diff": "Index: packages/i18n/src/locales/en/translations.json\n===================================================================\n--- packages/i18n/src/locales/en/translations.json\t85bffaa (parent)\n+++ packages/i18n/src/locales/en/translations.json\t586a7a4 (commit)\n@@ -2404,6 +2404,13 @@\n     },\n     \"open_button\": \"Open navigation pane\",\n     \"close_button\": \"Close navigation pane\",\n     \"outline_floating_button\": \"Open outline\"\n+  },\n+  \"project_members\": {\n+    \"full_name\": \"Full name\",\n+    \"display_name\": \"Display name\",\n+    \"email\": \"Email\",\n+    \"joining_date\": \"Joining date\",\n+    \"role\": \"Role\"\n   }\n }\n"
        }
      ]
    },
    {
      "id": "refactor-page-permissions",
      "sha": "9182c9593b9ceee83500cba3a92cb79395f2b630",
      "parentSha": "f59e557be1070851a2e9dcb053d174b1b296cedc",
      "spec": "Implement a project-scoped page permission refactor and route/serializer cleanup across the API.\n\n1) Add a centralized page permission class\n- Create apps/api/plane/app/permissions/page.py with a DRF BasePermission subclass ProjectPagePermission that:\n  - Denies anonymous access.\n  - Resolves slug, page_id, and project_id from view.kwargs.\n  - Confirms the requester is an active ProjectMember of the given project in the workspace, and returns the member role (ADMIN=20, MEMBER=15, GUEST=5).\n  - If page_id is present, loads Page by id and workspace slug and immediately allows if the requester is the page owner.\n  - For private pages (Page.PRIVATE_ACCESS), deny unless overridden in a helper (base implementation denies non-owners).\n  - For public pages, enforce action-level access by HTTP method:\n    - POST: allowed for ADMIN and MEMBER.\n    - SAFE methods (GET/HEAD/OPTIONS): allowed for ADMIN, MEMBER, and GUEST.\n    - PUT/PATCH: allowed for ADMIN and MEMBER.\n    - DELETE: allowed for ADMIN only.\n  - Provide internal helpers: _check_project_member_access, _check_access_and_get_role, _has_private_page_action_access (base returns False), _check_project_action_access, _has_public_page_action_access.\n\n- Export this permission in apps/api/plane/app/permissions/__init__.py by adding from .page import ProjectPagePermission.\n\n2) Wire the new permission into page views and remove role decorators\n- In apps/api/plane/app/views/page/base.py:\n  - Import ProjectPagePermission from plane.app.permissions.\n  - In PageViewSet, set permission_classes = [ProjectPagePermission].\n  - Remove @allow_permission decorators from create, partial_update, retrieve, list, lock, unlock, access, archive, unarchive, destroy.\n  - Update method signatures and internal references to use page_id instead of pk for all page-specific actions listed above.\n  - Ensure all queries, background tasks, and response payloads use page_id consistently (e.g., recent_visited_task, page_transaction, delete favorites/recent visit).\n  - Remove PageLogEndpoint and SubPagesEndpoint classes entirely and delete any related imports (PageLogSerializer, SubPageSerializer, gzip_page/method_decorator).\n\n- In apps/api/plane/app/views/page/version.py:\n  - Replace the allow_permission decorator with permission_classes = [ProjectPagePermission] on PageVersionEndpoint.\n  - Keep existing GET behavior (list or detail) using page_id.\n\n- In apps/api/plane/app/views/__init__.py:\n  - Remove PageLogEndpoint and SubPagesEndpoint from the exports; keep PageViewSet, PageFavoriteViewSet, PagesDescriptionViewSet, PageDuplicateEndpoint.\n\n- In apps/api/plane/app/views/page/base.py for PagesDescriptionViewSet and PageDuplicateEndpoint:\n  - Set permission_classes = [ProjectPagePermission] instead of allow_permission decorators.\n  - Rename method params from pk to page_id in retrieve and partial_update, and update page_transaction to use page_id.\n\n3) Standardize URL route parameters and remove legacy routes\n- In apps/api/plane/app/urls/page.py:\n  - Rename all page-specific route parameters from <uuid:pk> to <uuid:page_id> for:\n    - pages/<uuid:page_id>/ (retrieve, partial_update, destroy)\n    - favorite-pages/<uuid:page_id>/ (favorite/unfavorite)\n    - pages/<uuid:page_id>/archive/ (archive/unarchive)\n    - pages/<uuid:page_id>/lock/ (lock/unlock)\n    - pages/<uuid:page_id>/access/ (update access)\n    - pages/<uuid:page_id>/description/ (get/patch description)\n  - Remove routes for page transactions and sub-pages:\n    - pages/<uuid:page_id>/transactions/\n    - pages/<uuid:page_id>/transactions/<uuid:transaction>/\n    - pages/<uuid:page_id>/sub-pages/\n  - Keep versions and duplicate endpoints as-is (they already use page_id).\n\n4) Remove obsolete serializers from page serializers exports and definitions\n- In apps/api/plane/app/serializers/__init__.py:\n  - Stop exporting PageLogSerializer and SubPageSerializer from .page.\n\n- In apps/api/plane/app/serializers/page.py:\n  - Remove the SubPageSerializer and PageLogSerializer class definitions entirely (PageSerializer, PageDetailSerializer, PageVersionSerializer, PageBinaryUpdateSerializer remain).\n\nObservable outcomes:\n- All page endpoints now rely on ProjectPagePermission for access control.\n- All page-specific URL routes use page_id instead of pk, and work with updated method signatures.\n- Page log/transactions and sub-page routes are removed; their view classes and serializers no longer exist.\n- Page version and page description endpoints use the new permission class.\n- Favorite endpoints still use the allow_permission decorator but accept page_id in their method signatures.",
      "prompt": "Refactor the project page API to use a centralized permission class and simplify routes:\n\n- Introduce a DRF permission class for project pages that enforces access by project membership and role, honors page ownership for private pages, and maps HTTP methods to allowed roles.\n- Replace method-level role decorators on page endpoints with this permission class and adjust function signatures to accept page_id instead of pk.\n- Remove the legacy transaction and sub-page endpoints and their serializers.\n- Update URL patterns to consistently use page_id for all page-specific routes.\n- Ensure page description and version endpoints also rely on the new permission class and use page_id consistently.\n- Keep all existing business logic for locking, archiving, deleting, and background tasks intact, but switch to page_id in queries and task calls.\n- Update any exports/imports impacted by these changes.",
      "supplementalFiles": [
        "apps/api/plane/app/permissions/base.py",
        "apps/api/plane/app/permissions/project.py",
        "apps/api/plane/app/views/base.py",
        "apps/api/plane/utils/error_codes.py"
      ],
      "fileDiffs": [
        {
          "path": "apps/api/plane/app/permissions/__init__.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/permissions/__init__.py\n===================================================================\n--- apps/api/plane/app/permissions/__init__.py\tf59e557 (parent)\n+++ apps/api/plane/app/permissions/__init__.py\t9182c95 (commit)\n@@ -12,4 +12,5 @@\n     ProjectMemberPermission,\n     ProjectLitePermission,\n )\n from .base import allow_permission, ROLE\n+from .page import ProjectPagePermission\n"
        },
        {
          "path": "apps/api/plane/app/permissions/page.py",
          "status": "added",
          "diff": "Index: apps/api/plane/app/permissions/page.py\n===================================================================\n--- apps/api/plane/app/permissions/page.py\tf59e557 (parent)\n+++ apps/api/plane/app/permissions/page.py\t9182c95 (commit)\n@@ -0,0 +1,125 @@\n+from plane.db.models import ProjectMember, Page\n+from plane.app.permissions import ROLE\n+\n+\n+from rest_framework.permissions import BasePermission, SAFE_METHODS\n+\n+\n+# Permission Mappings for workspace members\n+ADMIN = ROLE.ADMIN.value\n+MEMBER = ROLE.MEMBER.value\n+GUEST = ROLE.GUEST.value\n+\n+\n+class ProjectPagePermission(BasePermission):\n+    \"\"\"\n+    Custom permission to control access to pages within a workspace\n+    based on user roles, page visibility (public/private), and feature flags.\n+    \"\"\"\n+\n+    def has_permission(self, request, view):\n+        \"\"\"\n+        Check basic project-level permissions before checking object-level permissions.\n+        \"\"\"\n+        if request.user.is_anonymous:\n+            return False\n+\n+        user_id = request.user.id\n+        slug = view.kwargs.get(\"slug\")\n+        page_id = view.kwargs.get(\"page_id\")\n+        project_id = view.kwargs.get(\"project_id\")\n+\n+        # Hook for extended validation\n+        extended_access, role = self._check_access_and_get_role(\n+            request, slug, project_id\n+        )\n+        if extended_access is False:\n+            return False\n+\n+        if page_id:\n+            page = Page.objects.get(id=page_id, workspace__slug=slug)\n+\n+            # Allow access if the user is the owner of the page\n+            if page.owned_by_id == user_id:\n+                return True\n+\n+            # Handle private page access\n+            if page.access == Page.PRIVATE_ACCESS:\n+                return self._has_private_page_action_access(\n+                    request, slug, page, project_id\n+                )\n+\n+        # Handle public page access\n+        return self._has_public_page_action_access(request, role)\n+\n+    def _check_project_member_access(self, request, slug, project_id):\n+        \"\"\"\n+        Check if the user is a project member.\n+        \"\"\"\n+        return (\n+            ProjectMember.objects.filter(\n+                member=request.user,\n+                workspace__slug=slug,\n+                is_active=True,\n+                project_id=project_id,\n+            )\n+            .values_list(\"role\", flat=True)\n+            .first()\n+        )\n+\n+    def _check_access_and_get_role(self, request, slug, project_id):\n+        \"\"\"\n+        Hook for extended access checking\n+        Returns: True (allow), False (deny), None (continue with normal flow)\n+        \"\"\"\n+        role = self._check_project_member_access(request, slug, project_id)\n+        if not role:\n+            return False, None\n+        return True, role\n+\n+    def _has_private_page_action_access(self, request, slug, page, project_id):\n+        \"\"\"\n+        Check access to private pages. Override for feature flag logic.\n+        \"\"\"\n+        # Base implementation: only owner can access private pages\n+        return False\n+\n+    def _check_project_action_access(self, request, role):\n+        method = request.method\n+\n+        # Only admins can create (POST) pages\n+        if method == \"POST\":\n+            if role in [ADMIN, MEMBER]:\n+                return True\n+            return False\n+\n+        # Safe methods (GET, HEAD, OPTIONS) allowed for all active roles\n+        if method in SAFE_METHODS:\n+            if role in [ADMIN, MEMBER, GUEST]:\n+                return True\n+            return False\n+\n+        # PUT/PATCH: Admins and members can update\n+        if method in [\"PUT\", \"PATCH\"]:\n+            if role in [ADMIN, MEMBER]:\n+                return True\n+            return False\n+\n+        # DELETE: Only admins can delete\n+        if method == \"DELETE\":\n+            if role in [ADMIN]:\n+                return True\n+            return False\n+\n+        # Deny by default\n+        return False\n+\n+    def _has_public_page_action_access(self, request, role):\n+        \"\"\"\n+        Check if the user has permission to access a public page\n+        and can perform operations on the page.\n+        \"\"\"\n+        project_member_exists = self._check_project_action_access(request, role)\n+        if not project_member_exists:\n+            return False\n+        return True\n"
        },
        {
          "path": "apps/api/plane/app/serializers/__init__.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/serializers/__init__.py\n===================================================================\n--- apps/api/plane/app/serializers/__init__.py\tf59e557 (parent)\n+++ apps/api/plane/app/serializers/__init__.py\t9182c95 (commit)\n@@ -91,10 +91,8 @@\n from .importer import ImporterSerializer\n \n from .page import (\n     PageSerializer,\n-    PageLogSerializer,\n-    SubPageSerializer,\n     PageDetailSerializer,\n     PageVersionSerializer,\n     PageBinaryUpdateSerializer,\n     PageVersionDetailSerializer,\n"
        },
        {
          "path": "apps/api/plane/app/serializers/page.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/serializers/page.py\n===================================================================\n--- apps/api/plane/app/serializers/page.py\tf59e557 (parent)\n+++ apps/api/plane/app/serializers/page.py\t9182c95 (commit)\n@@ -129,34 +129,8 @@\n     class Meta(PageSerializer.Meta):\n         fields = PageSerializer.Meta.fields + [\"description_html\"]\n \n \n-class SubPageSerializer(BaseSerializer):\n-    entity_details = serializers.SerializerMethodField()\n-\n-    class Meta:\n-        model = PageLog\n-        fields = \"__all__\"\n-        read_only_fields = [\"workspace\", \"page\"]\n-\n-    def get_entity_details(self, obj):\n-        entity_name = obj.entity_name\n-        if entity_name == \"forward_link\" or entity_name == \"back_link\":\n-            try:\n-                page = Page.objects.get(pk=obj.entity_identifier)\n-                return PageSerializer(page).data\n-            except Page.DoesNotExist:\n-                return None\n-        return None\n-\n-\n-class PageLogSerializer(BaseSerializer):\n-    class Meta:\n-        model = PageLog\n-        fields = \"__all__\"\n-        read_only_fields = [\"workspace\", \"page\"]\n-\n-\n class PageVersionSerializer(BaseSerializer):\n     class Meta:\n         model = PageVersion\n         fields = [\n"
        },
        {
          "path": "apps/api/plane/app/urls/page.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/urls/page.py\n===================================================================\n--- apps/api/plane/app/urls/page.py\tf59e557 (parent)\n+++ apps/api/plane/app/urls/page.py\t9182c95 (commit)\n@@ -3,70 +3,52 @@\n \n from plane.app.views import (\n     PageViewSet,\n     PageFavoriteViewSet,\n-    PageLogEndpoint,\n-    SubPagesEndpoint,\n     PagesDescriptionViewSet,\n     PageVersionEndpoint,\n     PageDuplicateEndpoint,\n )\n \n-\n urlpatterns = [\n     path(\n         \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/\",\n         PageViewSet.as_view({\"get\": \"list\", \"post\": \"create\"}),\n         name=\"project-pages\",\n     ),\n     path(\n-        \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/<uuid:pk>/\",\n+        \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/<uuid:page_id>/\",\n         PageViewSet.as_view(\n             {\"get\": \"retrieve\", \"patch\": \"partial_update\", \"delete\": \"destroy\"}\n         ),\n         name=\"project-pages\",\n     ),\n     # favorite pages\n     path(\n-        \"workspaces/<str:slug>/projects/<uuid:project_id>/favorite-pages/<uuid:pk>/\",\n+        \"workspaces/<str:slug>/projects/<uuid:project_id>/favorite-pages/<uuid:page_id>/\",\n         PageFavoriteViewSet.as_view({\"post\": \"create\", \"delete\": \"destroy\"}),\n         name=\"user-favorite-pages\",\n     ),\n     # archived pages\n     path(\n-        \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/<uuid:pk>/archive/\",\n+        \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/<uuid:page_id>/archive/\",\n         PageViewSet.as_view({\"post\": \"archive\", \"delete\": \"unarchive\"}),\n         name=\"project-page-archive-unarchive\",\n     ),\n     # lock and unlock\n     path(\n-        \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/<uuid:pk>/lock/\",\n+        \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/<uuid:page_id>/lock/\",\n         PageViewSet.as_view({\"post\": \"lock\", \"delete\": \"unlock\"}),\n         name=\"project-pages-lock-unlock\",\n     ),\n     # private and public page\n     path(\n-        \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/<uuid:pk>/access/\",\n+        \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/<uuid:page_id>/access/\",\n         PageViewSet.as_view({\"post\": \"access\"}),\n         name=\"project-pages-access\",\n     ),\n     path(\n-        \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/<uuid:pk>/transactions/\",\n-        PageLogEndpoint.as_view(),\n-        name=\"page-transactions\",\n-    ),\n-    path(\n-        \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/<uuid:pk>/transactions/<uuid:transaction>/\",\n-        PageLogEndpoint.as_view(),\n-        name=\"page-transactions\",\n-    ),\n-    path(\n-        \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/<uuid:pk>/sub-pages/\",\n-        SubPagesEndpoint.as_view(),\n-        name=\"sub-page\",\n-    ),\n-    path(\n-        \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/<uuid:pk>/description/\",\n+        \"workspaces/<str:slug>/projects/<uuid:project_id>/pages/<uuid:page_id>/description/\",\n         PagesDescriptionViewSet.as_view({\"get\": \"retrieve\", \"patch\": \"partial_update\"}),\n         name=\"page-description\",\n     ),\n     path(\n"
        },
        {
          "path": "apps/api/plane/app/views/__init__.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/__init__.py\n===================================================================\n--- apps/api/plane/app/views/__init__.py\tf59e557 (parent)\n+++ apps/api/plane/app/views/__init__.py\t9182c95 (commit)\n@@ -164,10 +164,8 @@\n \n from .page.base import (\n     PageViewSet,\n     PageFavoriteViewSet,\n-    PageLogEndpoint,\n-    SubPagesEndpoint,\n     PagesDescriptionViewSet,\n     PageDuplicateEndpoint,\n )\n from .page.version import PageVersionEndpoint\n"
        },
        {
          "path": "apps/api/plane/app/views/page/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/page/base.py\n===================================================================\n--- apps/api/plane/app/views/page/base.py\tf59e557 (parent)\n+++ apps/api/plane/app/views/page/base.py\t9182c95 (commit)\n@@ -6,10 +6,8 @@\n \n # Django imports\n from django.db import connection\n from django.db.models import Exists, OuterRef, Q, Value, UUIDField\n-from django.utils.decorators import method_decorator\n-from django.views.decorators.gzip import gzip_page\n from django.http import StreamingHttpResponse\n from django.contrib.postgres.aggregates import ArrayAgg\n from django.contrib.postgres.fields import ArrayField\n from django.db.models.functions import Coalesce\n@@ -20,11 +18,9 @@\n \n # Module imports\n from plane.app.permissions import allow_permission, ROLE\n from plane.app.serializers import (\n-    PageLogSerializer,\n     PageSerializer,\n-    SubPageSerializer,\n     PageDetailSerializer,\n     PageBinaryUpdateSerializer,\n )\n from plane.db.models import (\n@@ -36,15 +32,17 @@\n     Project,\n     UserRecentVisit,\n )\n from plane.utils.error_codes import ERROR_CODES\n+\n+# Local imports\n from ..base import BaseAPIView, BaseViewSet\n from plane.bgtasks.page_transaction_task import page_transaction\n from plane.bgtasks.page_version_task import page_version\n from plane.bgtasks.recent_visited_task import recent_visited_task\n from plane.bgtasks.copy_s3_object import copy_s3_objects_of_description_and_assets\n+from plane.app.permissions import ProjectPagePermission\n \n-\n def unarchive_archive_page_and_descendants(page_id, archived_at):\n     # Your SQL query\n     sql = \"\"\"\n     WITH RECURSIVE descendants AS (\n@@ -62,8 +60,9 @@\n \n class PageViewSet(BaseViewSet):\n     serializer_class = PageSerializer\n     model = Page\n+    permission_classes = [ProjectPagePermission]\n     search_fields = [\"name\"]\n \n     def get_queryset(self):\n         subquery = UserFavorite.objects.filter(\n@@ -116,9 +115,8 @@\n             .filter(project=True)\n             .distinct()\n         )\n \n-    @allow_permission([ROLE.ADMIN, ROLE.MEMBER])\n     def create(self, request, slug, project_id):\n         serializer = PageSerializer(\n             data=request.data,\n             context={\n@@ -138,13 +136,12 @@\n             serializer = PageDetailSerializer(page)\n             return Response(serializer.data, status=status.HTTP_201_CREATED)\n         return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n \n-    @allow_permission([ROLE.ADMIN, ROLE.MEMBER])\n-    def partial_update(self, request, slug, project_id, pk):\n+    def partial_update(self, request, slug, project_id, page_id):\n         try:\n             page = Page.objects.get(\n-                pk=pk, workspace__slug=slug, projects__id=project_id\n+                pk=page_id, workspace__slug=slug, projects__id=project_id\n             )\n \n             if page.is_locked:\n                 return Response(\n@@ -180,24 +177,21 @@\n                         old_value=json.dumps(\n                             {\"description_html\": page_description},\n                             cls=DjangoJSONEncoder,\n                         ),\n-                        page_id=pk,\n+                        page_id=page_id,\n                     )\n \n                 return Response(serializer.data, status=status.HTTP_200_OK)\n             return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n         except Page.DoesNotExist:\n             return Response(\n-                {\n-                    \"error\": \"Access cannot be updated since this page is owned by someone else\"\n-                },\n+                {\"error\": \"Access cannot be updated since this page is owned by someone else\"},\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n \n-    @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n-    def retrieve(self, request, slug, project_id, pk=None):\n-        page = self.get_queryset().filter(pk=pk).first()\n+    def retrieve(self, request, slug, project_id, page_id=None):\n+        page = self.get_queryset().filter(pk=page_id).first()\n         project = Project.objects.get(pk=project_id)\n         track_visit = request.query_params.get(\"track_visit\", \"true\").lower() == \"true\"\n \n         \"\"\"\n@@ -226,67 +220,61 @@\n                 {\"error\": \"Page not found\"}, status=status.HTTP_404_NOT_FOUND\n             )\n         else:\n             issue_ids = PageLog.objects.filter(\n-                page_id=pk, entity_name=\"issue\"\n+                page_id=page_id, entity_name=\"issue\"\n             ).values_list(\"entity_identifier\", flat=True)\n             data = PageDetailSerializer(page).data\n             data[\"issue_ids\"] = issue_ids\n             if track_visit:\n                 recent_visited_task.delay(\n                     slug=slug,\n                     entity_name=\"page\",\n-                    entity_identifier=pk,\n+                    entity_identifier=page_id,\n                     user_id=request.user.id,\n                     project_id=project_id,\n                 )\n             return Response(data, status=status.HTTP_200_OK)\n \n-    @allow_permission([ROLE.ADMIN], model=Page, creator=True)\n-    def lock(self, request, slug, project_id, pk):\n+    def lock(self, request, slug, project_id, page_id):\n         page = Page.objects.filter(\n-            pk=pk, workspace__slug=slug, projects__id=project_id\n+            pk=page_id, workspace__slug=slug, projects__id=project_id\n         ).first()\n \n         page.is_locked = True\n         page.save()\n         return Response(status=status.HTTP_204_NO_CONTENT)\n \n-    @allow_permission([ROLE.ADMIN], model=Page, creator=True)\n-    def unlock(self, request, slug, project_id, pk):\n+    def unlock(self, request, slug, project_id, page_id):\n         page = Page.objects.filter(\n-            pk=pk, workspace__slug=slug, projects__id=project_id\n+            pk=page_id, workspace__slug=slug, projects__id=project_id\n         ).first()\n \n         page.is_locked = False\n         page.save()\n \n         return Response(status=status.HTTP_204_NO_CONTENT)\n \n-    @allow_permission([ROLE.ADMIN], model=Page, creator=True)\n-    def access(self, request, slug, project_id, pk):\n+    def access(self, request, slug, project_id, page_id):\n         access = request.data.get(\"access\", 0)\n         page = Page.objects.filter(\n-            pk=pk, workspace__slug=slug, projects__id=project_id\n+            pk=page_id, workspace__slug=slug, projects__id=project_id\n         ).first()\n \n         # Only update access if the page owner is the requesting user\n         if (\n             page.access != request.data.get(\"access\", page.access)\n             and page.owned_by_id != request.user.id\n         ):\n             return Response(\n-                {\n-                    \"error\": \"Access cannot be updated since this page is owned by someone else\"\n-                },\n+                {\"error\": \"Access cannot be updated since this page is owned by someone else\"},\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n \n         page.access = access\n         page.save()\n         return Response(status=status.HTTP_204_NO_CONTENT)\n \n-    @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n     def list(self, request, slug, project_id):\n         queryset = self.get_queryset()\n         project = Project.objects.get(pk=project_id)\n         if (\n@@ -302,11 +290,12 @@\n             queryset = queryset.filter(owned_by=request.user)\n         pages = PageSerializer(queryset, many=True).data\n         return Response(pages, status=status.HTTP_200_OK)\n \n-    @allow_permission([ROLE.ADMIN], model=Page, creator=True)\n-    def archive(self, request, slug, project_id, pk):\n-        page = Page.objects.get(pk=pk, workspace__slug=slug, projects__id=project_id)\n+    def archive(self, request, slug, project_id, page_id):\n+        page = Page.objects.get(\n+            pk=page_id, workspace__slug=slug, projects__id=project_id\n+        )\n \n         # only the owner or admin can archive the page\n         if (\n             ProjectMember.objects.filter(\n@@ -320,20 +309,21 @@\n             )\n \n         UserFavorite.objects.filter(\n             entity_type=\"page\",\n-            entity_identifier=pk,\n+            entity_identifier=page_id,\n             project_id=project_id,\n             workspace__slug=slug,\n         ).delete()\n \n-        unarchive_archive_page_and_descendants(pk, datetime.now())\n+        unarchive_archive_page_and_descendants(page_id, datetime.now())\n \n         return Response({\"archived_at\": str(datetime.now())}, status=status.HTTP_200_OK)\n \n-    @allow_permission([ROLE.ADMIN], model=Page, creator=True)\n-    def unarchive(self, request, slug, project_id, pk):\n-        page = Page.objects.get(pk=pk, workspace__slug=slug, projects__id=project_id)\n+    def unarchive(self, request, slug, project_id, page_id):\n+        page = Page.objects.get(\n+            pk=page_id, workspace__slug=slug, projects__id=project_id\n+        )\n \n         # only the owner or admin can un archive the page\n         if (\n             ProjectMember.objects.filter(\n@@ -345,20 +335,21 @@\n                 {\"error\": \"Only the owner or admin can un archive the page\"},\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n \n-        # if parent page is archived then the page will be un archived breaking the hierarchy\n+        # if parent archived then page will be un archived breaking hierarchy\n         if page.parent_id and page.parent.archived_at:\n             page.parent = None\n             page.save(update_fields=[\"parent\"])\n \n-        unarchive_archive_page_and_descendants(pk, None)\n+        unarchive_archive_page_and_descendants(page_id, None)\n \n         return Response(status=status.HTTP_204_NO_CONTENT)\n \n-    @allow_permission([ROLE.ADMIN], model=Page, creator=True)\n-    def destroy(self, request, slug, project_id, pk):\n-        page = Page.objects.get(pk=pk, workspace__slug=slug, projects__id=project_id)\n+    def destroy(self, request, slug, project_id, page_id):\n+        page = Page.objects.get(\n+            pk=page_id, workspace__slug=slug, projects__id=project_id\n+        )\n \n         if page.archived_at is None:\n             return Response(\n                 {\"error\": \"The page should be archived before deleting\"},\n@@ -380,24 +371,24 @@\n             )\n \n         # remove parent from all the children\n         _ = Page.objects.filter(\n-            parent_id=pk, projects__id=project_id, workspace__slug=slug\n+            parent_id=page_id, projects__id=project_id, workspace__slug=slug\n         ).update(parent=None)\n \n         page.delete()\n         # Delete the user favorite page\n         UserFavorite.objects.filter(\n             project=project_id,\n             workspace__slug=slug,\n-            entity_identifier=pk,\n+            entity_identifier=page_id,\n             entity_type=\"page\",\n         ).delete()\n         # Delete the page from recent visit\n         UserRecentVisit.objects.filter(\n             project_id=project_id,\n             workspace__slug=slug,\n-            entity_identifier=pk,\n+            entity_identifier=page_id,\n             entity_name=\"page\",\n         ).delete(soft=False)\n         return Response(status=status.HTTP_204_NO_CONTENT)\n \n@@ -405,90 +396,38 @@\n class PageFavoriteViewSet(BaseViewSet):\n     model = UserFavorite\n \n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER])\n-    def create(self, request, slug, project_id, pk):\n+    def create(self, request, slug, project_id, page_id):\n         _ = UserFavorite.objects.create(\n             project_id=project_id,\n-            entity_identifier=pk,\n+            entity_identifier=page_id,\n             entity_type=\"page\",\n             user=request.user,\n         )\n         return Response(status=status.HTTP_204_NO_CONTENT)\n \n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER])\n-    def destroy(self, request, slug, project_id, pk):\n+    def destroy(self, request, slug, project_id, page_id):\n         page_favorite = UserFavorite.objects.get(\n             project=project_id,\n             user=request.user,\n             workspace__slug=slug,\n-            entity_identifier=pk,\n+            entity_identifier=page_id,\n             entity_type=\"page\",\n         )\n         page_favorite.delete(soft=False)\n         return Response(status=status.HTTP_204_NO_CONTENT)\n \n \n-class PageLogEndpoint(BaseAPIView):\n-    serializer_class = PageLogSerializer\n-    model = PageLog\n-\n-    def post(self, request, slug, project_id, page_id):\n-        serializer = PageLogSerializer(data=request.data)\n-        if serializer.is_valid():\n-            serializer.save(project_id=project_id, page_id=page_id)\n-            return Response(serializer.data, status=status.HTTP_201_CREATED)\n-        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n-\n-    def patch(self, request, slug, project_id, page_id, transaction):\n-        page_transaction = PageLog.objects.get(\n-            workspace__slug=slug,\n-            project_id=project_id,\n-            page_id=page_id,\n-            transaction=transaction,\n-        )\n-        serializer = PageLogSerializer(\n-            page_transaction, data=request.data, partial=True\n-        )\n-        if serializer.is_valid():\n-            serializer.save()\n-            return Response(serializer.data, status=status.HTTP_200_OK)\n-        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n-\n-    def delete(self, request, slug, project_id, page_id, transaction):\n-        transaction = PageLog.objects.get(\n-            workspace__slug=slug,\n-            project_id=project_id,\n-            page_id=page_id,\n-            transaction=transaction,\n-        )\n-        # Delete the transaction object\n-        transaction.delete()\n-        return Response(status=status.HTTP_204_NO_CONTENT)\n-\n-\n-class SubPagesEndpoint(BaseAPIView):\n-    @method_decorator(gzip_page)\n-    def get(self, request, slug, project_id, page_id):\n-        pages = (\n-            PageLog.objects.filter(\n-                page_id=page_id,\n-                workspace__slug=slug,\n-                entity_name__in=[\"forward_link\", \"back_link\"],\n-            )\n-            .select_related(\"project\")\n-            .select_related(\"workspace\")\n-        )\n-        return Response(\n-            SubPageSerializer(pages, many=True).data, status=status.HTTP_200_OK\n-        )\n-\n-\n class PagesDescriptionViewSet(BaseViewSet):\n-    @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n-    def retrieve(self, request, slug, project_id, pk):\n+    permission_classes = [ProjectPagePermission]\n+\n+    def retrieve(self, request, slug, project_id, page_id):\n         page = (\n-            Page.objects.filter(pk=pk, workspace__slug=slug, projects__id=project_id)\n+            Page.objects.filter(\n+                pk=page_id, workspace__slug=slug, projects__id=project_id\n+            )\n             .filter(Q(owned_by=self.request.user) | Q(access=0))\n             .first()\n         )\n         if page is None:\n@@ -506,12 +445,13 @@\n         )\n         response[\"Content-Disposition\"] = 'attachment; filename=\"page_description.bin\"'\n         return response\n \n-    @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n-    def partial_update(self, request, slug, project_id, pk):\n+    def partial_update(self, request, slug, project_id, page_id):\n         page = (\n-            Page.objects.filter(pk=pk, workspace__slug=slug, projects__id=project_id)\n+            Page.objects.filter(\n+                pk=page_id, workspace__slug=slug, projects__id=project_id\n+            )\n             .filter(Q(owned_by=self.request.user) | Q(access=0))\n             .first()\n         )\n \n@@ -546,9 +486,9 @@\n         if serializer.is_valid():\n             # Capture the page transaction\n             if request.data.get(\"description_html\"):\n                 page_transaction.delay(\n-                    new_value=request.data, old_value=existing_instance, page_id=pk\n+                    new_value=request.data, old_value=existing_instance, page_id=page_id\n                 )\n \n             # Update the page using serializer\n             updated_page = serializer.save()\n@@ -564,9 +504,9 @@\n             return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n \n \n class PageDuplicateEndpoint(BaseAPIView):\n-    @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n+    permission_classes = [ProjectPagePermission]\n     def post(self, request, slug, project_id, page_id):\n         page = Page.objects.filter(\n             pk=page_id, workspace__slug=slug, projects__id=project_id\n         ).first()\n"
        },
        {
          "path": "apps/api/plane/app/views/page/version.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/page/version.py\n===================================================================\n--- apps/api/plane/app/views/page/version.py\tf59e557 (parent)\n+++ apps/api/plane/app/views/page/version.py\t9182c95 (commit)\n@@ -6,12 +6,14 @@\n from plane.db.models import PageVersion\n from ..base import BaseAPIView\n from plane.app.serializers import PageVersionSerializer, PageVersionDetailSerializer\n from plane.app.permissions import allow_permission, ROLE\n+from plane.app.permissions import ProjectPagePermission\n \n-\n class PageVersionEndpoint(BaseAPIView):\n-    @allow_permission(allowed_roles=[ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n+\n+    permission_classes = [ProjectPagePermission]\n+\n     def get(self, request, slug, project_id, page_id, pk=None):\n         # Check if pk is provided\n         if pk:\n             # Return a single page version\n"
        }
      ]
    },
    {
      "id": "fix-total-count",
      "sha": "008e0489687789a1c54f2e9c616ab2fbd627482e",
      "parentSha": "7e15fcc080b339db24a273b03f2b84373dfa7c32",
      "spec": "Implement a correct total count for paginated issue listings and optimize count annotations.\n\nMake the following changes:\n\n1) Offset paginator total calculation\n- File: apps/api/plane/utils/paginator.py\n- In class OffsetPaginator.get_result(), change the fallback when total_count_queryset is not provided. Compute total_count from the full queryset, not from the sliced results:\n  - total_count = self.total_count_queryset.count() if provided; otherwise, total_count = queryset.count().\n  - Do not alter the existing cursor logic or page slicing, just the total count source.\n\n2) External API: list work items total count\n- File: apps/api/plane/api/views/issue.py\n- In IssueListCreateAPIEndpoint.get():\n  - Define a total_issue_queryset limited to the workspace and project: Issue.issue_objects.filter(project_id=project_id, workspace__slug=slug).\n  - Pass this as total_count_queryset to self.paginate(...):\n    - self.paginate(request=request, queryset=issue_queryset, total_count_queryset=total_issue_queryset, on_results=...)\n  - Leave ordering/annotation logic unchanged.\n\n3) App views: archive issue list\n- File: apps/api/plane/app/views/issue/archive.py\n- Imports: include Count from django.db.models in the import list.\n- In IssueArchiveViewSet.get_queryset(): replace link_count, attachment_count, and sub_issues_count annotations with Subquery + Count patterns:\n  - link_count = Subquery(\n      IssueLink.objects.filter(issue=OuterRef(\"id\"))\n      .values(\"issue\")\n      .annotate(count=Count(\"id\"))\n      .values(\"count\")\n    )\n  - attachment_count = Subquery(\n      FileAsset.objects.filter(issue_id=OuterRef(\"id\"), entity_type=FileAsset.EntityTypeContext.ISSUE_ATTACHMENT)\n      .values(\"issue_id\")\n      .annotate(count=Count(\"id\"))\n      .values(\"count\")\n    )\n  - sub_issues_count = Subquery(\n      Issue.issue_objects.filter(parent=OuterRef(\"id\"))\n      .values(\"parent\")\n      .annotate(count=Count(\"id\"))\n      .values(\"count\")\n    )\n- In IssueArchiveViewSet.list():\n  - Create a total_issue_queryset filtered for archived issues in the same workspace and project with the same filters as issue_queryset:\n    - Base filters: deleted_at__isnull=True, archived_at__isnull=False, project_id=project_id, workspace__slug=slug\n    - Apply the same filters dict used for issue_queryset.\n    - Respect the show_sub_issues toggle; if show_sub_issues == \"false\", add parent__isnull=True to total_issue_queryset.\n  - Pass total_count_queryset=total_issue_queryset to all paginate calls (group + subgroup pagination, group-only pagination, and the default list pagination path).\n\n4) App views: main issue list with guest visibility and total counts\n- File: apps/api/plane/app/views/issue/base.py\n- In IssueViewSet.get_queryset():\n  - Replace link_count, attachment_count, and sub_issues_count annotations with Subquery + Count, just like in the archive view above.\n  - Remove the trailing .distinct() at the end of the queryset chain (so the queryset ends without .distinct()).\n- In IssueViewSet.list():\n  - Add a total_issue_queryset mirroring the base issue scope for the same workspace and project, then apply the exact same filters and extra_filters used for the main issue_queryset.\n  - Apply the guest visibility constraint (created_by=request.user) to total_issue_queryset whenever it is applied to issue_queryset. This ensures guests see correct total counts consistent with visible data.\n  - Pass total_count_queryset=total_issue_queryset into self.paginate(...) in all code paths (group + subgroup pagination, group-only pagination, and default pagination when not grouped).\n\n5) Do not change behavior outside the specified files/sections. Keep serialization, ordering, grouping, on_results projections, and other API surface unchanged.\n\nAcceptance criteria:\n- total_count in paginated responses reflects the full, filtered dataset count (not the page slice), consistent for both grouped and ungrouped listings in app views and external API.\n- Guest users see total_count values restricted to their visibility (created_by constraint when applicable).\n- show_sub_issues toggle in archived issues affects both the page queryset and total counts consistently.\n- Count annotations (link_count, attachment_count, sub_issues_count) use Subquery + Count as described and return correct values.\n- No regressions in ordering, grouping, or response shapes.",
      "prompt": "The work item lists are showing incorrect total results when scrolling/paginating. Fix the pagination to report the correct total count across issue list endpoints and align it with filters and visibility constraints. Introduce a dedicated total count queryset where needed so totals are computed independently of page slices, ensure guest visibility rules apply to totals, and update the archived and main issue list endpoints accordingly. Also update the per-issue count annotations to use more reliable subquery-based counts for links, attachments, and sub-issues. Do not change response shapes or ordering/grouping behavior.",
      "supplementalFiles": [
        "apps/api/plane/app/views/base.py",
        "apps/api/plane/utils/order_queryset.py",
        "apps/api/plane/utils/issue_filters.py",
        "apps/api/plane/utils/grouper.py",
        "apps/api/plane/utils/global_paginator.py"
      ],
      "fileDiffs": [
        {
          "path": "apps/api/plane/api/views/issue.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/issue.py\n===================================================================\n--- apps/api/plane/api/views/issue.py\t7e15fcc (parent)\n+++ apps/api/plane/api/views/issue.py\t008e048 (commit)\n@@ -330,8 +330,12 @@\n                 .values(\"count\")\n             )\n         )\n \n+        total_issue_queryset = Issue.issue_objects.filter(\n+            project_id=project_id, workspace__slug=slug\n+        )\n+\n         # Priority Ordering\n         if order_by_param == \"priority\" or order_by_param == \"-priority\":\n             priority_order = (\n                 priority_order if order_by_param == \"priority\" else priority_order[::-1]\n@@ -389,8 +393,9 @@\n \n         return self.paginate(\n             request=request,\n             queryset=(issue_queryset),\n+            total_count_queryset=total_issue_queryset,\n             on_results=lambda issues: IssueSerializer(\n                 issues, many=True, fields=self.fields, expand=self.expand\n             ).data,\n         )\n"
        },
        {
          "path": "apps/api/plane/app/views/issue/archive.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/issue/archive.py\n===================================================================\n--- apps/api/plane/app/views/issue/archive.py\t7e15fcc (parent)\n+++ apps/api/plane/app/views/issue/archive.py\t008e048 (commit)\n@@ -2,9 +2,9 @@\n import json\n \n # Django imports\n from django.core.serializers.json import DjangoJSONEncoder\n-from django.db.models import F, Func, OuterRef, Q, Prefetch, Exists, Subquery\n+from django.db.models import F, Func, OuterRef, Q, Prefetch, Exists, Subquery, Count\n from django.utils import timezone\n from django.utils.decorators import method_decorator\n from django.views.decorators.gzip import gzip_page\n \n@@ -68,27 +68,33 @@\n                     ).values(\"cycle_id\")[:1]\n                 )\n             )\n             .annotate(\n-                link_count=IssueLink.objects.filter(issue=OuterRef(\"id\"))\n-                .order_by()\n-                .annotate(count=Func(F(\"id\"), function=\"Count\"))\n-                .values(\"count\")\n+                link_count=Subquery(\n+                    IssueLink.objects.filter(issue=OuterRef(\"id\"))\n+                    .values(\"issue\")\n+                    .annotate(count=Count(\"id\"))\n+                    .values(\"count\")\n+                )\n             )\n             .annotate(\n-                attachment_count=FileAsset.objects.filter(\n-                    issue_id=OuterRef(\"id\"),\n-                    entity_type=FileAsset.EntityTypeContext.ISSUE_ATTACHMENT,\n+                attachment_count=Subquery(\n+                    FileAsset.objects.filter(\n+                        issue_id=OuterRef(\"id\"),\n+                        entity_type=FileAsset.EntityTypeContext.ISSUE_ATTACHMENT,\n+                    )\n+                    .values(\"issue_id\")\n+                    .annotate(count=Count(\"id\"))\n+                    .values(\"count\")\n                 )\n-                .order_by()\n-                .annotate(count=Func(F(\"id\"), function=\"Count\"))\n-                .values(\"count\")\n             )\n             .annotate(\n-                sub_issues_count=Issue.issue_objects.filter(parent=OuterRef(\"id\"))\n-                .order_by()\n-                .annotate(count=Func(F(\"id\"), function=\"Count\"))\n-                .values(\"count\")\n+                sub_issues_count=Subquery(\n+                    Issue.issue_objects.filter(parent=OuterRef(\"id\"))\n+                    .values(\"parent\")\n+                    .annotate(count=Count(\"id\"))\n+                    .values(\"count\")\n+                )\n             )\n         )\n \n     @method_decorator(gzip_page)\n@@ -100,8 +106,21 @@\n         order_by_param = request.GET.get(\"order_by\", \"-created_at\")\n \n         issue_queryset = self.get_queryset().filter(**filters)\n \n+        total_issue_queryset = Issue.objects.filter(\n+            deleted_at__isnull=True,\n+            archived_at__isnull=False,\n+            project_id=project_id,\n+            workspace__slug=slug,\n+        ).filter(**filters)\n+\n+        total_issue_queryset = (\n+            total_issue_queryset\n+            if show_sub_issues == \"true\"\n+            else total_issue_queryset.filter(parent__isnull=True)\n+        )\n+\n         issue_queryset = (\n             issue_queryset\n             if show_sub_issues == \"true\"\n             else issue_queryset.filter(parent__isnull=True)\n@@ -135,8 +154,9 @@\n                     return self.paginate(\n                         request=request,\n                         order_by=order_by_param,\n                         queryset=issue_queryset,\n+                        total_count_queryset=total_issue_queryset,\n                         on_results=lambda issues: issue_on_results(\n                             group_by=group_by, issues=issues, sub_group_by=sub_group_by\n                         ),\n                         paginator_cls=SubGroupedOffsetPaginator,\n@@ -169,8 +189,9 @@\n                 return self.paginate(\n                     request=request,\n                     order_by=order_by_param,\n                     queryset=issue_queryset,\n+                    total_count_queryset=total_issue_queryset,\n                     on_results=lambda issues: issue_on_results(\n                         group_by=group_by, issues=issues, sub_group_by=sub_group_by\n                     ),\n                     paginator_cls=GroupedOffsetPaginator,\n@@ -195,8 +216,9 @@\n             return self.paginate(\n                 order_by=order_by_param,\n                 request=request,\n                 queryset=issue_queryset,\n+                total_count_queryset=total_issue_queryset,\n                 on_results=lambda issues: issue_on_results(\n                     group_by=group_by, issues=issues, sub_group_by=sub_group_by\n                 ),\n             )\n"
        },
        {
          "path": "apps/api/plane/app/views/issue/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/issue/base.py\n===================================================================\n--- apps/api/plane/app/views/issue/base.py\t7e15fcc (parent)\n+++ apps/api/plane/app/views/issue/base.py\t008e048 (commit)\n@@ -212,29 +212,35 @@\n                     ).values(\"cycle_id\")[:1]\n                 )\n             )\n             .annotate(\n-                link_count=IssueLink.objects.filter(issue=OuterRef(\"id\"))\n-                .order_by()\n-                .annotate(count=Func(F(\"id\"), function=\"Count\"))\n-                .values(\"count\")\n+                link_count=Subquery(\n+                    IssueLink.objects.filter(issue=OuterRef(\"id\"))\n+                    .values(\"issue\")\n+                    .annotate(count=Count(\"id\"))\n+                    .values(\"count\")\n+                )\n             )\n             .annotate(\n-                attachment_count=FileAsset.objects.filter(\n-                    issue_id=OuterRef(\"id\"),\n-                    entity_type=FileAsset.EntityTypeContext.ISSUE_ATTACHMENT,\n+                attachment_count=Subquery(\n+                    FileAsset.objects.filter(\n+                        issue_id=OuterRef(\"id\"),\n+                        entity_type=FileAsset.EntityTypeContext.ISSUE_ATTACHMENT,\n+                    )\n+                    .values(\"issue_id\")\n+                    .annotate(count=Count(\"id\"))\n+                    .values(\"count\")\n                 )\n-                .order_by()\n-                .annotate(count=Func(F(\"id\"), function=\"Count\"))\n-                .values(\"count\")\n             )\n             .annotate(\n-                sub_issues_count=Issue.issue_objects.filter(parent=OuterRef(\"id\"))\n-                .order_by()\n-                .annotate(count=Func(F(\"id\"), function=\"Count\"))\n-                .values(\"count\")\n+                sub_issues_count=Subquery(\n+                    Issue.issue_objects.filter(parent=OuterRef(\"id\"))\n+                    .values(\"parent\")\n+                    .annotate(count=Count(\"id\"))\n+                    .values(\"count\")\n+                )\n             )\n-        ).distinct()\n+        )\n \n     @method_decorator(gzip_page)\n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n     def list(self, request, slug, project_id):\n@@ -248,8 +254,12 @@\n \n         issue_queryset = self.get_queryset().filter(**filters, **extra_filters)\n         # Custom ordering for priority and state\n \n+        total_issue_queryset = Issue.issue_objects.filter(\n+            project_id=project_id, workspace__slug=slug\n+        ).filter(**filters, **extra_filters)\n+\n         # Issue queryset\n         issue_queryset, order_by_param = order_issue_queryset(\n             issue_queryset=issue_queryset, order_by_param=order_by_param\n         )\n@@ -280,8 +290,9 @@\n             ).exists()\n             and not project.guest_view_all_features\n         ):\n             issue_queryset = issue_queryset.filter(created_by=request.user)\n+            total_issue_queryset = total_issue_queryset.filter(created_by=request.user)\n \n         if group_by:\n             if sub_group_by:\n                 if group_by == sub_group_by:\n@@ -295,8 +306,9 @@\n                     return self.paginate(\n                         request=request,\n                         order_by=order_by_param,\n                         queryset=issue_queryset,\n+                        total_count_queryset=total_issue_queryset,\n                         on_results=lambda issues: issue_on_results(\n                             group_by=group_by, issues=issues, sub_group_by=sub_group_by\n                         ),\n                         paginator_cls=SubGroupedOffsetPaginator,\n@@ -328,8 +340,9 @@\n                 return self.paginate(\n                     request=request,\n                     order_by=order_by_param,\n                     queryset=issue_queryset,\n+                    total_count_queryset=total_issue_queryset,\n                     on_results=lambda issues: issue_on_results(\n                         group_by=group_by, issues=issues, sub_group_by=sub_group_by\n                     ),\n                     paginator_cls=GroupedOffsetPaginator,\n@@ -353,8 +366,9 @@\n             return self.paginate(\n                 order_by=order_by_param,\n                 request=request,\n                 queryset=issue_queryset,\n+                total_count_queryset=total_issue_queryset,\n                 on_results=lambda issues: issue_on_results(\n                     group_by=group_by, issues=issues, sub_group_by=sub_group_by\n                 ),\n             )\n"
        },
        {
          "path": "apps/api/plane/utils/paginator.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/utils/paginator.py\n===================================================================\n--- apps/api/plane/utils/paginator.py\t7e15fcc (parent)\n+++ apps/api/plane/utils/paginator.py\t008e048 (commit)\n@@ -159,9 +159,9 @@\n \n         total_count = (\n             self.total_count_queryset.count()\n             if self.total_count_queryset\n-            else results.count()\n+            else queryset.count()\n         )\n \n         # Check if there are more results available after the current page\n \n"
        }
      ]
    },
    {
      "id": "add-content-validation",
      "sha": "69d5cd183f4c42e10fd59ed6b6586af47c21720a",
      "parentSha": "b93883fc1440c58392c21f98be729c13b36e8621",
      "spec": "Implement server-side validation and a safer page description update flow as follows:\n\n1) Create content validation utilities\n- File: apps/api/plane/utils/content_validator.py\n- Add three functions with the following observable behavior:\n  - validate_binary_data(data): Accepts bytes or a base64 string. Treat empty as valid. If string, decode base64. Fail if decode fails. Enforce a 10 MB max size. Perform a lightweight content sanity check by scanning the first portion of decoded text for suspicious HTML/JS indicators. Return a tuple (is_valid: bool, error_message: Optional[str]).\n  - validate_html_content(html_content): Accepts a string. Treat empty as valid. Enforce a 10 MB max (by bytes). Reject HTML containing clearly malicious patterns (e.g., script tags, javascript: URLs, data:text/html, dangerous iframes, meta refresh, suspicious event handlers with JS). Optionally allow self-closing tags and be tolerant to minor mismatches, but reject blatantly malformed content (e.g., significantly unmatched opening vs closing tags). Return (bool, Optional[str]).\n  - validate_json_content(json_content): Accepts a dict-like object. Treat empty as valid. Enforce a 10 MB max (serialized bytes). Validate for suspicious text or attribute values recursively with a recursion depth cap (e.g., 20). If the object resembles a ProseMirror/Tiptap document (type=\"doc\" with content array), recursively scan nodes (including text nodes and attrs like href/src/action/onclick/onload/onerror) for dangerous patterns. Return (bool, Optional[str]).\n- Consolidate common dangerous patterns via module-level constants and cap recursion depth to avoid stack overflow.\n\n2) Integrate validators into serializers\n- Import the three functions into the following serializers and add validation for description fields in their validate(...) methods (or field validators where applicable):\n  - apps/api/plane/api/serializers/issue.py (IssueSerializer): Validate description (JSON), description_html (HTML), description_binary (binary). Raise serializers.ValidationError with field-specific messages when invalid.\n  - apps/api/plane/api/serializers/project.py (ProjectSerializer): Validate description content with special handling:\n    - description may be plain text; only validate as JSON if it is a dict.\n    - description_text: validate as JSON.\n    - description_html: if a dict, validate as JSON; otherwise, validate as HTML string.\n  - apps/api/plane/app/serializers/draft.py (DraftIssueCreateSerializer): Validate description (JSON), description_html (HTML), description_binary (binary).\n  - apps/api/plane/app/serializers/issue.py (IssueCreateSerializer): Validate description (JSON), description_html (HTML), description_binary (binary).\n  - apps/api/plane/app/serializers/project.py (ProjectSerializer in app layer): Same project-specific rules as api layer: description (JSON only if dict), description_text (JSON), description_html (dict->JSON else HTML string).\n  - apps/api/plane/app/serializers/workspace.py (StickySerializer): Validate description (JSON), description_html (HTML), description_binary (binary).\n- Ensure all validations return field-scoped errors using serializers.ValidationError with a dict like {\"description_html\": \"...\"}.\n\n3) Add a dedicated serializer for page description updates\n- File: apps/api/plane/app/serializers/page.py\n- Define PageBinaryUpdateSerializer with fields: description_binary (optional CharField for base64), description_html (optional CharField), description (optional JSONField).\n- Implement per-field validators:\n  - validate_description_binary: Decode base64 string to bytes; validate with validate_binary_data; if invalid, raise ValidationError with a specific error; on success, return the decoded bytes so instance.description_binary receives raw bytes.\n  - validate_description_html: Validate HTML via validate_html_content; raise field error on failure; return the original string on success.\n  - validate_description: Validate JSON via validate_json_content; raise field error on failure; return the JSON value on success.\n- Implement update(instance, validated_data): Set any provided fields on the instance (description_binary, description_html, description) and save; return the updated instance.\n- Export this serializer by adding it to apps/api/plane/app/serializers/__init__.py so it can be imported by views.\n\n4) Update the page description update endpoint to use the serializer\n- File: apps/api/plane/app/views/page/base.py (PagesDescriptionViewSet)\n- In partial_update:\n  - Replace manual base64 decoding and direct field assignment with PageBinaryUpdateSerializer(instance=page, data=request.data, partial=True).\n  - If serializer.is_valid() is True, then:\n    - If description_html is present in request, continue to enqueue page_transaction with new_value=request.data and old_value existing_instance.\n    - Save via serializer.save() to update the page instance.\n    - Trigger page_version with the updated page id and existing_instance, preserving current behavior.\n    - Return 200 with {\"message\": \"Updated successfully\"}.\n  - If not valid, return 400 with serializer.errors.\n- Ensure retrieve behavior of PagesDescriptionViewSet remains unchanged.\n\n5) Consistency and error handling\n- Ensure all new imports are added at the top of relevant files.\n- Error messages should be concise and field-specific. Empty or missing description fields must be accepted and bypass validation.\n- Maintain the 10 MB size limit and a sensible recursion depth (20) in validators.\n\n6) No changes to database schema or routes\n- Do not alter models or URL patterns. The update only adds validation and improves the update flow in the existing endpoint.",
      "prompt": "Add robust server-side validation for description content across issues, projects, drafts, stickies, and pages, and use a dedicated serializer to update page descriptions safely.\n\nSpecifically:\n- Introduce a reusable validation utility for JSON, HTML, and binary description content with sensible limits and protection against obvious XSS vectors.\n- Apply these validators in the relevant serializers so that description, description_html, and description_binary fields are validated and produce field-specific errors without breaking existing flows.\n- For pages, implement a serializer that accepts base64-encoded binary description, HTML, and JSON, validates each field, decodes binary to bytes, and updates the instance.\n- Update the page description PATCH endpoint to use the new serializer and return validation errors when content is unsafe or malformed.\n- Keep current endpoints, permissions, and background tasks intact while improving input validation.",
      "supplementalFiles": [
        "apps/api/plane/db/models/page.py",
        "apps/api/plane/db/models/issue.py",
        "apps/api/plane/db/models/project.py",
        "apps/api/plane/db/models/sticky.py",
        "apps/api/plane/app/urls/page.py",
        "packages/types/src/page/index.ts",
        "packages/types/src/issues/issue.ts",
        "packages/types/src/stickies.ts"
      ],
      "fileDiffs": [
        {
          "path": "apps/api/plane/api/serializers/issue.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/serializers/issue.py\n===================================================================\n--- apps/api/plane/api/serializers/issue.py\tb93883f (parent)\n+++ apps/api/plane/api/serializers/issue.py\t69d5cd1 (commit)\n@@ -20,8 +20,13 @@\n     ProjectMember,\n     State,\n     User,\n )\n+from plane.utils.content_validator import (\n+    validate_html_content,\n+    validate_json_content,\n+    validate_binary_data,\n+)\n \n from .base import BaseSerializer\n from .cycle import CycleLiteSerializer, CycleSerializer\n from .module import ModuleLiteSerializer, ModuleSerializer\n@@ -74,8 +79,24 @@\n \n         except Exception:\n             raise serializers.ValidationError(\"Invalid HTML passed\")\n \n+        # Validate description content for security\n+        if data.get(\"description\"):\n+            is_valid, error_msg = validate_json_content(data[\"description\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description\": error_msg})\n+\n+        if data.get(\"description_html\"):\n+            is_valid, error_msg = validate_html_content(data[\"description_html\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_html\": error_msg})\n+\n+        if data.get(\"description_binary\"):\n+            is_valid, error_msg = validate_binary_data(data[\"description_binary\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_binary\": error_msg})\n+\n         # Validate assignees are from project\n         if data.get(\"assignees\", []):\n             data[\"assignees\"] = ProjectMember.objects.filter(\n                 project_id=self.context.get(\"project_id\"),\n"
        },
        {
          "path": "apps/api/plane/api/serializers/project.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/serializers/project.py\n===================================================================\n--- apps/api/plane/api/serializers/project.py\tb93883f (parent)\n+++ apps/api/plane/api/serializers/project.py\t69d5cd1 (commit)\n@@ -2,8 +2,13 @@\n from rest_framework import serializers\n \n # Module imports\n from plane.db.models import Project, ProjectIdentifier, WorkspaceMember\n+from plane.utils.content_validator import (\n+    validate_html_content,\n+    validate_json_content,\n+    validate_binary_data,\n+)\n \n from .base import BaseSerializer\n \n \n@@ -56,8 +61,31 @@\n             raise serializers.ValidationError(\n                 \"Default assignee should be a user in the workspace\"\n             )\n \n+        # Validate description content for security\n+        if \"description\" in data and data[\"description\"]:\n+            # For Project, description might be text field, not JSON\n+            if isinstance(data[\"description\"], dict):\n+                is_valid, error_msg = validate_json_content(data[\"description\"])\n+                if not is_valid:\n+                    raise serializers.ValidationError({\"description\": error_msg})\n+\n+        if \"description_text\" in data and data[\"description_text\"]:\n+            is_valid, error_msg = validate_json_content(data[\"description_text\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_text\": error_msg})\n+\n+        if \"description_html\" in data and data[\"description_html\"]:\n+            if isinstance(data[\"description_html\"], dict):\n+                is_valid, error_msg = validate_json_content(data[\"description_html\"])\n+            else:\n+                is_valid, error_msg = validate_html_content(\n+                    str(data[\"description_html\"])\n+                )\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_html\": error_msg})\n+\n         return data\n \n     def create(self, validated_data):\n         identifier = validated_data.get(\"identifier\", \"\").strip().upper()\n"
        },
        {
          "path": "apps/api/plane/app/serializers/__init__.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/serializers/__init__.py\n===================================================================\n--- apps/api/plane/app/serializers/__init__.py\tb93883f (parent)\n+++ apps/api/plane/app/serializers/__init__.py\t69d5cd1 (commit)\n@@ -95,8 +95,9 @@\n     PageLogSerializer,\n     SubPageSerializer,\n     PageDetailSerializer,\n     PageVersionSerializer,\n+    PageBinaryUpdateSerializer,\n     PageVersionDetailSerializer,\n )\n \n from .estimate import (\n"
        },
        {
          "path": "apps/api/plane/app/serializers/draft.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/serializers/draft.py\n===================================================================\n--- apps/api/plane/app/serializers/draft.py\tb93883f (parent)\n+++ apps/api/plane/app/serializers/draft.py\t69d5cd1 (commit)\n@@ -16,8 +16,13 @@\n     DraftIssueLabel,\n     DraftIssueCycle,\n     DraftIssueModule,\n )\n+from plane.utils.content_validator import (\n+    validate_html_content,\n+    validate_json_content,\n+    validate_binary_data,\n+)\n \n \n class DraftIssueCreateSerializer(BaseSerializer):\n     # ids\n@@ -63,8 +68,25 @@\n             and data.get(\"target_date\", None) is not None\n             and data.get(\"start_date\", None) > data.get(\"target_date\", None)\n         ):\n             raise serializers.ValidationError(\"Start date cannot exceed target date\")\n+\n+        # Validate description content for security\n+        if \"description\" in data and data[\"description\"]:\n+            is_valid, error_msg = validate_json_content(data[\"description\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description\": error_msg})\n+\n+        if \"description_html\" in data and data[\"description_html\"]:\n+            is_valid, error_msg = validate_html_content(data[\"description_html\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_html\": error_msg})\n+\n+        if \"description_binary\" in data and data[\"description_binary\"]:\n+            is_valid, error_msg = validate_binary_data(data[\"description_binary\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_binary\": error_msg})\n+\n         return data\n \n     def create(self, validated_data):\n         assignees = validated_data.pop(\"assignee_ids\", None)\n"
        },
        {
          "path": "apps/api/plane/app/serializers/issue.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/serializers/issue.py\n===================================================================\n--- apps/api/plane/app/serializers/issue.py\tb93883f (parent)\n+++ apps/api/plane/app/serializers/issue.py\t69d5cd1 (commit)\n@@ -37,8 +37,13 @@\n     IssueVersion,\n     IssueDescriptionVersion,\n     ProjectMember,\n )\n+from plane.utils.content_validator import (\n+    validate_html_content,\n+    validate_json_content,\n+    validate_binary_data,\n+)\n \n \n class IssueFlatSerializer(BaseSerializer):\n     ## Contain only flat fields\n@@ -126,8 +131,24 @@\n                 is_active=True,\n                 member_id__in=attrs[\"assignee_ids\"],\n             ).values_list(\"member_id\", flat=True)\n \n+        # Validate description content for security\n+        if \"description\" in attrs and attrs[\"description\"]:\n+            is_valid, error_msg = validate_json_content(attrs[\"description\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description\": error_msg})\n+\n+        if \"description_html\" in attrs and attrs[\"description_html\"]:\n+            is_valid, error_msg = validate_html_content(attrs[\"description_html\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_html\": error_msg})\n+\n+        if \"description_binary\" in attrs and attrs[\"description_binary\"]:\n+            is_valid, error_msg = validate_binary_data(attrs[\"description_binary\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_binary\": error_msg})\n+\n         return attrs\n \n     def create(self, validated_data):\n         assignees = validated_data.pop(\"assignee_ids\", None)\n"
        },
        {
          "path": "apps/api/plane/app/serializers/page.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/serializers/page.py\n===================================================================\n--- apps/api/plane/app/serializers/page.py\tb93883f (parent)\n+++ apps/api/plane/app/serializers/page.py\t69d5cd1 (commit)\n@@ -1,9 +1,15 @@\n # Third party imports\n from rest_framework import serializers\n+import base64\n \n # Module imports\n from .base import BaseSerializer\n+from plane.utils.content_validator import (\n+    validate_binary_data,\n+    validate_html_content,\n+    validate_json_content,\n+)\n from plane.db.models import (\n     Page,\n     PageLog,\n     PageLabel,\n@@ -185,4 +191,72 @@\n             \"created_by\",\n             \"updated_by\",\n         ]\n         read_only_fields = [\"workspace\", \"page\"]\n+\n+\n+class PageBinaryUpdateSerializer(serializers.Serializer):\n+    \"\"\"Serializer for updating page binary description with validation\"\"\"\n+\n+    description_binary = serializers.CharField(required=False, allow_blank=True)\n+    description_html = serializers.CharField(required=False, allow_blank=True)\n+    description = serializers.JSONField(required=False, allow_null=True)\n+\n+    def validate_description_binary(self, value):\n+        \"\"\"Validate the base64-encoded binary data\"\"\"\n+        if not value:\n+            return value\n+\n+        try:\n+            # Decode the base64 data\n+            binary_data = base64.b64decode(value)\n+\n+            # Validate the binary data\n+            is_valid, error_message = validate_binary_data(binary_data)\n+            if not is_valid:\n+                raise serializers.ValidationError(\n+                    f\"Invalid binary data: {error_message}\"\n+                )\n+\n+            return binary_data\n+        except Exception as e:\n+            if isinstance(e, serializers.ValidationError):\n+                raise\n+            raise serializers.ValidationError(\"Failed to decode base64 data\")\n+\n+    def validate_description_html(self, value):\n+        \"\"\"Validate the HTML content\"\"\"\n+        if not value:\n+            return value\n+\n+        # Use the validation function from utils\n+        is_valid, error_message = validate_html_content(value)\n+        if not is_valid:\n+            raise serializers.ValidationError(error_message)\n+\n+        return value\n+\n+    def validate_description(self, value):\n+        \"\"\"Validate the JSON description\"\"\"\n+        if not value:\n+            return value\n+\n+        # Use the validation function from utils\n+        is_valid, error_message = validate_json_content(value)\n+        if not is_valid:\n+            raise serializers.ValidationError(error_message)\n+\n+        return value\n+\n+    def update(self, instance, validated_data):\n+        \"\"\"Update the page instance with validated data\"\"\"\n+        if \"description_binary\" in validated_data:\n+            instance.description_binary = validated_data.get(\"description_binary\")\n+\n+        if \"description_html\" in validated_data:\n+            instance.description_html = validated_data.get(\"description_html\")\n+\n+        if \"description\" in validated_data:\n+            instance.description = validated_data.get(\"description\")\n+\n+        instance.save()\n+        return instance\n"
        },
        {
          "path": "apps/api/plane/app/serializers/project.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/serializers/project.py\n===================================================================\n--- apps/api/plane/app/serializers/project.py\tb93883f (parent)\n+++ apps/api/plane/app/serializers/project.py\t69d5cd1 (commit)\n@@ -12,8 +12,13 @@\n     ProjectIdentifier,\n     DeployBoard,\n     ProjectPublicMember,\n )\n+from plane.utils.content_validator import (\n+    validate_html_content,\n+    validate_json_content,\n+    validate_binary_data,\n+)\n \n \n class ProjectSerializer(BaseSerializer):\n     workspace_detail = WorkspaceLiteSerializer(source=\"workspace\", read_only=True)\n@@ -57,8 +62,34 @@\n             )\n \n         return identifier\n \n+    def validate(self, data):\n+        # Validate description content for security\n+        if \"description\" in data and data[\"description\"]:\n+            # For Project, description might be text field, not JSON\n+            if isinstance(data[\"description\"], dict):\n+                is_valid, error_msg = validate_json_content(data[\"description\"])\n+                if not is_valid:\n+                    raise serializers.ValidationError({\"description\": error_msg})\n+\n+        if \"description_text\" in data and data[\"description_text\"]:\n+            is_valid, error_msg = validate_json_content(data[\"description_text\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_text\": error_msg})\n+\n+        if \"description_html\" in data and data[\"description_html\"]:\n+            if isinstance(data[\"description_html\"], dict):\n+                is_valid, error_msg = validate_json_content(data[\"description_html\"])\n+            else:\n+                is_valid, error_msg = validate_html_content(\n+                    str(data[\"description_html\"])\n+                )\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_html\": error_msg})\n+\n+        return data\n+\n     def create(self, validated_data):\n         workspace_id = self.context[\"workspace_id\"]\n \n         project = Project.objects.create(**validated_data, workspace_id=workspace_id)\n"
        },
        {
          "path": "apps/api/plane/app/serializers/workspace.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/serializers/workspace.py\n===================================================================\n--- apps/api/plane/app/serializers/workspace.py\tb93883f (parent)\n+++ apps/api/plane/app/serializers/workspace.py\t69d5cd1 (commit)\n@@ -23,8 +23,13 @@\n     WorkspaceUserPreference,\n )\n from plane.utils.constants import RESTRICTED_WORKSPACE_SLUGS\n from plane.utils.url import contains_url\n+from plane.utils.content_validator import (\n+    validate_html_content,\n+    validate_json_content,\n+    validate_binary_data,\n+)\n \n # Django imports\n from django.core.validators import URLValidator\n from django.core.exceptions import ValidationError\n@@ -311,9 +316,28 @@\n         fields = \"__all__\"\n         read_only_fields = [\"workspace\", \"owner\"]\n         extra_kwargs = {\"name\": {\"required\": False}}\n \n+    def validate(self, data):\n+        # Validate description content for security\n+        if \"description\" in data and data[\"description\"]:\n+            is_valid, error_msg = validate_json_content(data[\"description\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description\": error_msg})\n \n+        if \"description_html\" in data and data[\"description_html\"]:\n+            is_valid, error_msg = validate_html_content(data[\"description_html\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_html\": error_msg})\n+\n+        if \"description_binary\" in data and data[\"description_binary\"]:\n+            is_valid, error_msg = validate_binary_data(data[\"description_binary\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_binary\": error_msg})\n+\n+        return data\n+\n+\n class WorkspaceUserPreferenceSerializer(BaseSerializer):\n     class Meta:\n         model = WorkspaceUserPreference\n         fields = [\"key\", \"is_pinned\", \"sort_order\"]\n"
        },
        {
          "path": "apps/api/plane/app/views/page/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/page/base.py\n===================================================================\n--- apps/api/plane/app/views/page/base.py\tb93883f (parent)\n+++ apps/api/plane/app/views/page/base.py\t69d5cd1 (commit)\n@@ -24,8 +24,9 @@\n     PageLogSerializer,\n     PageSerializer,\n     SubPageSerializer,\n     PageDetailSerializer,\n+    PageBinaryUpdateSerializer,\n )\n from plane.db.models import (\n     Page,\n     PageLog,\n@@ -537,34 +538,29 @@\n         existing_instance = json.dumps(\n             {\"description_html\": page.description_html}, cls=DjangoJSONEncoder\n         )\n \n-        # Get the base64 data from the request\n-        base64_data = request.data.get(\"description_binary\")\n-\n-        # If base64 data is provided\n-        if base64_data:\n-            # Decode the base64 data to bytes\n-            new_binary_data = base64.b64decode(base64_data)\n-            # capture the page transaction\n+        # Use serializer for validation and update\n+        serializer = PageBinaryUpdateSerializer(page, data=request.data, partial=True)\n+        if serializer.is_valid():\n+            # Capture the page transaction\n             if request.data.get(\"description_html\"):\n                 page_transaction.delay(\n                     new_value=request.data, old_value=existing_instance, page_id=pk\n                 )\n-            # Store the updated binary data\n-            page.description_binary = new_binary_data\n-            page.description_html = request.data.get(\"description_html\")\n-            page.description = request.data.get(\"description\")\n-            page.save()\n-            # Return a success response\n+\n+            # Update the page using serializer\n+            updated_page = serializer.save()\n+\n+            # Run background tasks\n             page_version.delay(\n-                page_id=page.id,\n+                page_id=updated_page.id,\n                 existing_instance=existing_instance,\n                 user_id=request.user.id,\n             )\n             return Response({\"message\": \"Updated successfully\"})\n         else:\n-            return Response({\"error\": \"No binary data provided\"})\n+            return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n \n \n class PageDuplicateEndpoint(BaseAPIView):\n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n"
        },
        {
          "path": "apps/api/plane/space/serializer/issue.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/space/serializer/issue.py\n===================================================================\n--- apps/api/plane/space/serializer/issue.py\tb93883f (parent)\n+++ apps/api/plane/space/serializer/issue.py\t69d5cd1 (commit)\n@@ -27,8 +27,13 @@\n     CommentReaction,\n     IssueVote,\n     IssueRelation,\n )\n+from plane.utils.content_validator import (\n+    validate_html_content,\n+    validate_json_content,\n+    validate_binary_data,\n+)\n \n \n class IssueStateFlatSerializer(BaseSerializer):\n     state_detail = StateLiteSerializer(read_only=True, source=\"state\")\n@@ -282,8 +287,25 @@\n             and data.get(\"target_date\", None) is not None\n             and data.get(\"start_date\", None) > data.get(\"target_date\", None)\n         ):\n             raise serializers.ValidationError(\"Start date cannot exceed target date\")\n+\n+        # Validate description content for security\n+        if \"description\" in data and data[\"description\"]:\n+            is_valid, error_msg = validate_json_content(data[\"description\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description\": error_msg})\n+\n+        if \"description_html\" in data and data[\"description_html\"]:\n+            is_valid, error_msg = validate_html_content(data[\"description_html\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_html\": error_msg})\n+\n+        if \"description_binary\" in data and data[\"description_binary\"]:\n+            is_valid, error_msg = validate_binary_data(data[\"description_binary\"])\n+            if not is_valid:\n+                raise serializers.ValidationError({\"description_binary\": error_msg})\n+\n         return data\n \n     def create(self, validated_data):\n         assignees = validated_data.pop(\"assignees\", None)\n"
        },
        {
          "path": "apps/api/plane/utils/content_validator.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/content_validator.py\n===================================================================\n--- apps/api/plane/utils/content_validator.py\tb93883f (parent)\n+++ apps/api/plane/utils/content_validator.py\t69d5cd1 (commit)\n@@ -0,0 +1,357 @@\n+# Python imports\n+import base64\n+import json\n+import re\n+\n+\n+# Maximum allowed size for binary data (10MB)\n+MAX_SIZE = 10 * 1024 * 1024\n+\n+# Maximum recursion depth to prevent stack overflow\n+MAX_RECURSION_DEPTH = 20\n+\n+# Dangerous text patterns that could indicate XSS or script injection\n+DANGEROUS_TEXT_PATTERNS = [\n+    r\"<script[^>]*>.*?</script>\",\n+    r\"javascript\\s*:\",\n+    r\"data\\s*:\\s*text/html\",\n+    r\"eval\\s*\\(\",\n+    r\"document\\s*\\.\",\n+    r\"window\\s*\\.\",\n+    r\"location\\s*\\.\",\n+]\n+\n+# Dangerous attribute patterns for HTML attributes\n+DANGEROUS_ATTR_PATTERNS = [\n+    r\"javascript\\s*:\",\n+    r\"data\\s*:\\s*text/html\",\n+    r\"eval\\s*\\(\",\n+    r\"alert\\s*\\(\",\n+    r\"document\\s*\\.\",\n+    r\"window\\s*\\.\",\n+]\n+\n+# Suspicious patterns for binary data content\n+SUSPICIOUS_BINARY_PATTERNS = [\n+    \"<html\",\n+    \"<!doctype\",\n+    \"<script\",\n+    \"javascript:\",\n+    \"data:\",\n+    \"<iframe\",\n+]\n+\n+# Malicious HTML patterns for content validation\n+MALICIOUS_HTML_PATTERNS = [\n+    # Script tags with any content\n+    r\"<script[^>]*>\",\n+    r\"</script>\",\n+    # JavaScript URLs in various attributes\n+    r'(?:href|src|action)\\s*=\\s*[\"\\']?\\s*javascript:',\n+    # Data URLs with text/html (potential XSS)\n+    r'(?:href|src|action)\\s*=\\s*[\"\\']?\\s*data:text/html',\n+    # Dangerous event handlers with JavaScript-like content\n+    r'on(?:load|error|click|focus|blur|change|submit|reset|select|resize|scroll|unload|beforeunload|hashchange|popstate|storage|message|offline|online)\\s*=\\s*[\"\\']?[^\"\\']*(?:javascript|alert|eval|document\\.|window\\.|location\\.|history\\.)[^\"\\']*[\"\\']?',\n+    # Object and embed tags that could load external content\n+    r\"<(?:object|embed)[^>]*(?:data|src)\\s*=\",\n+    # Base tag that could change relative URL resolution\n+    r\"<base[^>]*href\\s*=\",\n+    # Dangerous iframe sources\n+    r'<iframe[^>]*src\\s*=\\s*[\"\\']?(?:javascript:|data:text/html)',\n+    # Meta refresh redirects\n+    r'<meta[^>]*http-equiv\\s*=\\s*[\"\\']?refresh[\"\\']?',\n+    # Link tags - simplified patterns\n+    r'<link[^>]*rel\\s*=\\s*[\"\\']?stylesheet[\"\\']?',\n+    r'<link[^>]*href\\s*=\\s*[\"\\']?https?://',\n+    r'<link[^>]*href\\s*=\\s*[\"\\']?//',\n+    r'<link[^>]*href\\s*=\\s*[\"\\']?(?:data:|javascript:)',\n+    # Style tags with external imports\n+    r\"<style[^>]*>.*?@import.*?(?:https?://|//)\",\n+    # Link tags with dangerous rel types\n+    r'<link[^>]*rel\\s*=\\s*[\"\\']?(?:import|preload|prefetch|dns-prefetch|preconnect)[\"\\']?',\n+    # Forms with action attributes\n+    r\"<form[^>]*action\\s*=\",\n+]\n+\n+# Dangerous JavaScript patterns for event handlers\n+DANGEROUS_JS_PATTERNS = [\n+    r\"alert\\s*\\(\",\n+    r\"eval\\s*\\(\",\n+    r\"document\\s*\\.\",\n+    r\"window\\s*\\.\",\n+    r\"location\\s*\\.\",\n+    r\"fetch\\s*\\(\",\n+    r\"XMLHttpRequest\",\n+    r\"innerHTML\\s*=\",\n+    r\"outerHTML\\s*=\",\n+    r\"document\\.write\",\n+    r\"script\\s*>\",\n+]\n+\n+# HTML self-closing tags that don't need closing tags\n+SELF_CLOSING_TAGS = {\n+    \"img\",\n+    \"br\",\n+    \"hr\",\n+    \"input\",\n+    \"meta\",\n+    \"link\",\n+    \"area\",\n+    \"base\",\n+    \"col\",\n+    \"embed\",\n+    \"source\",\n+    \"track\",\n+    \"wbr\",\n+}\n+\n+\n+def validate_binary_data(data):\n+    \"\"\"\n+    Validate that binary data appears to be valid document format and doesn't contain malicious content.\n+\n+    Args:\n+        data (bytes or str): The binary data to validate, or base64-encoded string\n+\n+    Returns:\n+        tuple: (is_valid: bool, error_message: str or None)\n+    \"\"\"\n+    if not data:\n+        return True, None  # Empty is OK\n+\n+    # Handle base64-encoded strings by decoding them first\n+    if isinstance(data, str):\n+        try:\n+            binary_data = base64.b64decode(data)\n+        except Exception:\n+            return False, \"Invalid base64 encoding\"\n+    else:\n+        binary_data = data\n+\n+    # Size check - 10MB limit\n+    if len(binary_data) > MAX_SIZE:\n+        return False, \"Binary data exceeds maximum size limit (10MB)\"\n+\n+    # Basic format validation\n+    if len(binary_data) < 4:\n+        return False, \"Binary data too short to be valid document format\"\n+\n+    # Check for suspicious text patterns (HTML/JS)\n+    try:\n+        decoded_text = binary_data.decode(\"utf-8\", errors=\"ignore\")[:200]\n+        if any(\n+            pattern in decoded_text.lower() for pattern in SUSPICIOUS_BINARY_PATTERNS\n+        ):\n+            return False, \"Binary data contains suspicious content patterns\"\n+    except Exception:\n+        pass  # Binary data might not be decodable as text, which is fine\n+\n+    return True, None\n+\n+\n+def validate_html_content(html_content):\n+    \"\"\"\n+    Validate that HTML content is safe and doesn't contain malicious patterns.\n+\n+    Args:\n+        html_content (str): The HTML content to validate\n+\n+    Returns:\n+        tuple: (is_valid: bool, error_message: str or None)\n+    \"\"\"\n+    if not html_content:\n+        return True, None  # Empty is OK\n+\n+    # Size check - 10MB limit (consistent with binary validation)\n+    if len(html_content.encode(\"utf-8\")) > MAX_SIZE:\n+        return False, \"HTML content exceeds maximum size limit (10MB)\"\n+\n+    # Check for specific malicious patterns (simplified and more reliable)\n+    for pattern in MALICIOUS_HTML_PATTERNS:\n+        if re.search(pattern, html_content, re.IGNORECASE | re.DOTALL):\n+            return (\n+                False,\n+                f\"HTML content contains potentially malicious patterns: {pattern}\",\n+            )\n+\n+    # Additional check for inline event handlers that contain suspicious content\n+    # This is more permissive - only blocks if the event handler contains actual dangerous code\n+    event_handler_pattern = r'on\\w+\\s*=\\s*[\"\\']([^\"\\']*)[\"\\']'\n+    event_matches = re.findall(event_handler_pattern, html_content, re.IGNORECASE)\n+\n+    for handler_content in event_matches:\n+        for js_pattern in DANGEROUS_JS_PATTERNS:\n+            if re.search(js_pattern, handler_content, re.IGNORECASE):\n+                return (\n+                    False,\n+                    f\"HTML content contains dangerous JavaScript in event handler: {handler_content[:100]}\",\n+                )\n+\n+    # Basic HTML structure validation - check for common malformed tags\n+    try:\n+        # Count opening and closing tags for basic structure validation\n+        opening_tags = re.findall(r\"<(\\w+)[^>]*>\", html_content)\n+        closing_tags = re.findall(r\"</(\\w+)>\", html_content)\n+\n+        # Filter out self-closing tags from opening tags\n+        opening_tags_filtered = [\n+            tag for tag in opening_tags if tag.lower() not in SELF_CLOSING_TAGS\n+        ]\n+\n+        # Basic check - if we have significantly more opening than closing tags, it might be malformed\n+        if len(opening_tags_filtered) > len(closing_tags) + 10:  # Allow some tolerance\n+            return False, \"HTML content appears to be malformed (unmatched tags)\"\n+\n+    except Exception:\n+        # If HTML parsing fails, we'll allow it\n+        pass\n+\n+    return True, None\n+\n+\n+def validate_json_content(json_content):\n+    \"\"\"\n+    Validate that JSON content is safe and doesn't contain malicious patterns.\n+\n+    Args:\n+        json_content (dict): The JSON content to validate\n+\n+    Returns:\n+        tuple: (is_valid: bool, error_message: str or None)\n+    \"\"\"\n+    if not json_content:\n+        return True, None  # Empty is OK\n+\n+    try:\n+        # Size check - 10MB limit (consistent with other validations)\n+        json_str = json.dumps(json_content)\n+        if len(json_str.encode(\"utf-8\")) > MAX_SIZE:\n+            return False, \"JSON content exceeds maximum size limit (10MB)\"\n+\n+        # Basic structure validation for page description JSON\n+        if isinstance(json_content, dict):\n+            # Check for expected page description structure\n+            # This is based on ProseMirror/Tiptap JSON structure\n+            if \"type\" in json_content and json_content.get(\"type\") == \"doc\":\n+                # Valid document structure\n+                if \"content\" in json_content and isinstance(\n+                    json_content[\"content\"], list\n+                ):\n+                    # Recursively check content for suspicious patterns\n+                    is_valid, error_msg = _validate_json_content_array(\n+                        json_content[\"content\"]\n+                    )\n+                    if not is_valid:\n+                        return False, error_msg\n+            elif \"type\" not in json_content and \"content\" not in json_content:\n+                # Allow other JSON structures but validate for suspicious content\n+                is_valid, error_msg = _validate_json_content_recursive(json_content)\n+                if not is_valid:\n+                    return False, error_msg\n+        else:\n+            return False, \"JSON description must be a valid object\"\n+\n+    except (TypeError, ValueError) as e:\n+        return False, \"Invalid JSON structure\"\n+    except Exception as e:\n+        return False, \"Failed to validate JSON content\"\n+\n+    return True, None\n+\n+\n+def _validate_json_content_array(content, depth=0):\n+    \"\"\"\n+    Validate JSON content array for suspicious patterns.\n+\n+    Args:\n+        content (list): Array of content nodes to validate\n+        depth (int): Current recursion depth (default: 0)\n+\n+    Returns:\n+        tuple: (is_valid: bool, error_message: str or None)\n+    \"\"\"\n+    # Check recursion depth to prevent stack overflow\n+    if depth > MAX_RECURSION_DEPTH:\n+        return False, f\"Maximum recursion depth ({MAX_RECURSION_DEPTH}) exceeded\"\n+\n+    if not isinstance(content, list):\n+        return True, None\n+\n+    for node in content:\n+        if isinstance(node, dict):\n+            # Check text content for suspicious patterns (more targeted)\n+            if node.get(\"type\") == \"text\" and \"text\" in node:\n+                text_content = node[\"text\"]\n+                for pattern in DANGEROUS_TEXT_PATTERNS:\n+                    if re.search(pattern, text_content, re.IGNORECASE):\n+                        return (\n+                            False,\n+                            \"JSON content contains suspicious script patterns in text\",\n+                        )\n+\n+            # Check attributes for suspicious content (more targeted)\n+            if \"attrs\" in node and isinstance(node[\"attrs\"], dict):\n+                for attr_name, attr_value in node[\"attrs\"].items():\n+                    if isinstance(attr_value, str):\n+                        # Only check specific attributes that could be dangerous\n+                        if attr_name.lower() in [\n+                            \"href\",\n+                            \"src\",\n+                            \"action\",\n+                            \"onclick\",\n+                            \"onload\",\n+                            \"onerror\",\n+                        ]:\n+                            for pattern in DANGEROUS_ATTR_PATTERNS:\n+                                if re.search(pattern, attr_value, re.IGNORECASE):\n+                                    return (\n+                                        False,\n+                                        f\"JSON content contains dangerous pattern in {attr_name} attribute\",\n+                                    )\n+\n+            # Recursively check nested content\n+            if \"content\" in node and isinstance(node[\"content\"], list):\n+                is_valid, error_msg = _validate_json_content_array(\n+                    node[\"content\"], depth + 1\n+                )\n+                if not is_valid:\n+                    return False, error_msg\n+\n+    return True, None\n+\n+\n+def _validate_json_content_recursive(obj, depth=0):\n+    \"\"\"\n+    Recursively validate JSON object for suspicious content.\n+\n+    Args:\n+        obj: JSON object (dict, list, or primitive) to validate\n+        depth (int): Current recursion depth (default: 0)\n+\n+    Returns:\n+        tuple: (is_valid: bool, error_message: str or None)\n+    \"\"\"\n+    # Check recursion depth to prevent stack overflow\n+    if depth > MAX_RECURSION_DEPTH:\n+        return False, f\"Maximum recursion depth ({MAX_RECURSION_DEPTH}) exceeded\"\n+    if isinstance(obj, dict):\n+        for key, value in obj.items():\n+            if isinstance(value, str):\n+                # Check for dangerous patterns using module constants\n+                for pattern in DANGEROUS_TEXT_PATTERNS:\n+                    if re.search(pattern, value, re.IGNORECASE):\n+                        return (\n+                            False,\n+                            \"JSON content contains suspicious script patterns\",\n+                        )\n+            elif isinstance(value, (dict, list)):\n+                is_valid, error_msg = _validate_json_content_recursive(value, depth + 1)\n+                if not is_valid:\n+                    return False, error_msg\n+    elif isinstance(obj, list):\n+        for item in obj:\n+            is_valid, error_msg = _validate_json_content_recursive(item, depth + 1)\n+            if not is_valid:\n+                return False, error_msg\n+\n+    return True, None\n"
        }
      ]
    },
    {
      "id": "upgrade-tiptap",
      "sha": "5c22a6cecc6aeef17a64e86f9d5511081e0b12bd",
      "parentSha": "4c3af7f8a14c44de8709a67677d5416944873790",
      "spec": "Implement a TipTap 2.22+ upgrade and align custom NodeView typings and related utilities across the editor package.\n\nDependencies\n- Root package.json: add prosemirror-view at version 1.40.0 under dependencies (to match new TipTap/PM peer constraints).\n- apps/live/package.json: bump @tiptap/core and @tiptap/html to ^2.22.3.\n- packages/editor/package.json:\n  - Bump TipTap packages to ^2.22.3: @tiptap/core, @tiptap/extension-blockquote, @tiptap/extension-character-count, @tiptap/extension-collaboration, @tiptap/extension-image, @tiptap/extension-list-item, @tiptap/extension-mention, @tiptap/extension-placeholder, @tiptap/extension-task-item, @tiptap/extension-task-list, @tiptap/extension-text-align, @tiptap/extension-text-style, @tiptap/extension-underline, @tiptap/html, @tiptap/pm, @tiptap/react, @tiptap/starter-kit, @tiptap/suggestion.\n  - Keep @tiptap/extension-emoji at a compatible version (already ^2.22.3).\n  - Remove prosemirror-utils if listed.\n\nNodeView typing and renderer alignment\n- Callout NodeView\n  - packages/editor/src/core/extensions/callout/block.tsx: define and export CustomCalloutNodeViewProps (extends NodeViewProps with node.attrs typed as TCalloutBlockAttributes). Update CustomCalloutBlock to React.FC<CustomCalloutNodeViewProps>.\n  - packages/editor/src/core/extensions/callout/extension.tsx and read-only-extension.tsx:\n    - Change imports to import { CustomCalloutBlock, CustomCalloutNodeViewProps } from \"@/extensions/callout\" (avoid barrel that hides types).\n    - In addNodeView, wrap ReactNodeViewRenderer with a render function that spreads props and passes node as props.node cast to CustomCalloutNodeViewProps[\"node\"].\n\n- Custom Image NodeView\n  - packages/editor/src/core/extensions/custom-image/extension.tsx (rename to .tsx if needed): import { CustomImageNodeView, CustomImageNodeViewProps } from \"./components/node-view\"; in addNodeView, wrap ReactNodeViewRenderer with a function that spreads props and passes a node prop typed as CustomImageNodeViewProps[\"node\"].\n  - packages/editor/src/core/extensions/image/extension.tsx: import CustomImageNodeView and CustomImageNodeViewProps from ../custom-image/components/node-view; wrap ReactNodeViewRenderer in the same way as above.\n\n- Mentions NodeView\n  - packages/editor/src/core/extensions/mentions/mention-node-view.tsx: export MentionNodeViewProps (extends NodeViewProps with attrs typed as TMentionComponentAttributes) and type MentionNodeView as React.FC<MentionNodeViewProps>.\n  - packages/editor/src/core/extensions/mentions/extension.tsx: import { MentionNodeView, MentionNodeViewProps }; in addNodeView wrap ReactNodeViewRenderer to pass node typed as MentionNodeViewProps[\"node\"].\n\nSlash commands behavior\n- packages/editor/src/core/extensions/slash-commands/root.tsx: allow slash commands to activate in tables by removing the guard that returns false when editor.isActive(CORE_EXTENSIONS.TABLE).\n\nHelper and utils typing clean-up\n- packages/editor/src/core/helpers/editor-commands.ts: change to type-only import for Editor and Range from @tiptap/core (import type { Editor, Range }), and remove ts-expect-error comments; ensure all toggle methods are invoked via chain().focus() consistently without ts-ignore comments.\n- packages/editor/src/core/helpers/yjs-utils.ts: remove ts-expect-error comments around getSchema, generateJSON, and generateHTML calls; keep using the extension lists to produce schemas/content.\n- packages/editor/src/core/extensions/extensions.ts and read-only-extensions.ts: remove stale ts-expect-error comments around returning Extensions arrays.\n\nDrag handle plugin robustness\n- packages/editor/src/core/plugins/drag-handle.ts:\n  - Update getScrollParent signature to accept HTMLElement | SVGElement | null and return Element | null; add an early return if the input node is null.\n  - Ensure dragHandleElement is declared once and handler functions (handleClick, handleDragStart, handleDragEnd) are organized so there is no reference before assignment; preserve existing behavior (including scroll loop and drag state) and class toggling.\n\nPathing and imports\n- Ensure callout extensions import from \"@/extensions/callout\" rather than a broader barrel module to access the new CustomCalloutNodeViewProps type.\n\nGeneral\n- Ensure all changes compile with TipTap v2.22+ without any @ts-expect-error comments related to TipTap types.\n- No runtime behavior changes other than: enabling slash commands inside tables and the drag-handle null-guard; NodeView rendering must remain functionally identical while properly typed.\n",
      "prompt": "Upgrade the editor to the latest TipTap (v2.22+) and align our custom NodeViews and helpers with the updated types. Ensure all custom NodeViews (callout, image, and mentions) expose explicit prop types for their node attrs and use ReactNodeViewRenderer with a wrapper that passes a correctly typed node prop. Remove old TipTap type workarounds and ts-expect-error comments in editor helpers and extension aggregators, and add a null guard to the drag-handle’s getScrollParent to avoid crashes. Also allow slash commands to activate inside tables by dropping the table-only guard. Update editor and live app dependencies accordingly so the project compiles cleanly against TipTap 2.22+ without type suppressions.",
      "supplementalFiles": [
        "packages/editor/src/core/extensions/custom-image/components/node-view.tsx",
        "packages/editor/src/core/extensions/callout/extension-config.ts",
        "packages/editor/src/core/extensions/callout/index.ts",
        "packages/editor/src/core/extensions/callout/types.ts",
        "packages/editor/src/core/extensions/mentions/extension-config.ts",
        "packages/editor/src/core/extensions/mentions/types.ts",
        "packages/editor/src/core/extensions/custom-image/extension-config.ts",
        "packages/editor/src/core/helpers/insert-empty-paragraph-at-node-boundary.ts",
        "packages/editor/src/core/constants/extension.ts",
        "packages/editor/tsconfig.json"
      ],
      "fileDiffs": [
        {
          "path": "apps/live/package.json",
          "status": "modified",
          "diff": "Index: apps/live/package.json\n===================================================================\n--- apps/live/package.json\t4c3af7f (parent)\n+++ apps/live/package.json\t5c22a6c (commit)\n@@ -25,10 +25,10 @@\n     \"@hocuspocus/extension-redis\": \"^2.15.0\",\n     \"@hocuspocus/server\": \"^2.15.0\",\n     \"@plane/editor\": \"*\",\n     \"@plane/types\": \"*\",\n-    \"@tiptap/core\": \"2.10.4\",\n-    \"@tiptap/html\": \"2.11.0\",\n+    \"@tiptap/core\": \"^2.22.3\",\n+    \"@tiptap/html\": \"^2.22.3\",\n     \"axios\": \"^1.8.3\",\n     \"compression\": \"1.8.1\",\n     \"cors\": \"^2.8.5\",\n     \"dotenv\": \"^16.4.5\",\n"
        },
        {
          "path": "package.json",
          "status": "modified",
          "diff": "Index: package.json\n===================================================================\n--- package.json\t4c3af7f (parent)\n+++ package.json\t5c22a6c (commit)\n@@ -28,8 +28,9 @@\n     \"esbuild\": \"0.25.0\",\n     \"@babel/helpers\": \"7.26.10\",\n     \"@babel/runtime\": \"7.26.10\",\n     \"chokidar\": \"3.6.0\",\n-    \"tar-fs\": \"3.0.9\"\n+    \"tar-fs\": \"3.0.9\",\n+    \"prosemirror-view\": \"1.40.0\"\n   },\n   \"packageManager\": \"yarn@1.22.22\"\n }\n"
        },
        {
          "path": "packages/editor/package.json",
          "status": "modified",
          "diff": "Index: packages/editor/package.json\n===================================================================\n--- packages/editor/package.json\t4c3af7f (parent)\n+++ packages/editor/package.json\t5c22a6c (commit)\n@@ -44,35 +44,33 @@\n     \"@plane/hooks\": \"*\",\n     \"@plane/types\": \"*\",\n     \"@plane/ui\": \"*\",\n     \"@plane/utils\": \"*\",\n-    \"@tiptap/core\": \"2.10.4\",\n-    \"@tiptap/extension-blockquote\": \"2.10.4\",\n-    \"@tiptap/extension-character-count\": \"2.11.0\",\n-    \"@tiptap/extension-collaboration\": \"2.11.0\",\n+    \"@tiptap/core\": \"^2.22.3\",\n+    \"@tiptap/extension-blockquote\": \"^2.22.3\",\n+    \"@tiptap/extension-character-count\": \"^2.22.3\",\n+    \"@tiptap/extension-collaboration\": \"^2.22.3\",\n     \"@tiptap/extension-emoji\": \"^2.22.3\",\n-    \"@tiptap/extension-image\": \"2.11.0\",\n-    \"@tiptap/extension-list-item\": \"2.11.0\",\n-    \"@tiptap/extension-mention\": \"2.11.0\",\n-    \"@tiptap/extension-placeholder\": \"2.11.0\",\n-    \"@tiptap/extension-task-item\": \"2.11.0\",\n-    \"@tiptap/extension-task-list\": \"2.11.0\",\n-    \"@tiptap/extension-text-align\": \"2.11.0\",\n-    \"@tiptap/extension-text-style\": \"2.11.0\",\n-    \"@tiptap/extension-underline\": \"2.11.0\",\n-    \"@tiptap/html\": \"2.11.0\",\n-    \"@tiptap/pm\": \"2.11.0\",\n-    \"@tiptap/react\": \"2.11.0\",\n-    \"@tiptap/starter-kit\": \"2.11.0\",\n-    \"@tiptap/suggestion\": \"2.11.0\",\n-    \"class-variance-authority\": \"^0.7.0\",\n+    \"@tiptap/extension-image\": \"^2.22.3\",\n+    \"@tiptap/extension-list-item\": \"^2.22.3\",\n+    \"@tiptap/extension-mention\": \"^2.22.3\",\n+    \"@tiptap/extension-placeholder\": \"^2.22.3\",\n+    \"@tiptap/extension-task-item\": \"^2.22.3\",\n+    \"@tiptap/extension-task-list\": \"^2.22.3\",\n+    \"@tiptap/extension-text-align\": \"^2.22.3\",\n+    \"@tiptap/extension-text-style\": \"^2.22.3\",\n+    \"@tiptap/extension-underline\": \"^2.22.3\",\n+    \"@tiptap/html\": \"^2.22.3\",\n+    \"@tiptap/pm\": \"^2.22.3\",\n+    \"@tiptap/react\": \"^2.22.3\",\n+    \"@tiptap/starter-kit\": \"^2.22.3\",\n+    \"@tiptap/suggestion\": \"^2.22.3\",\n     \"highlight.js\": \"^11.8.0\",\n     \"jsx-dom-cjs\": \"^8.0.3\",\n     \"linkifyjs\": \"^4.1.3\",\n     \"lowlight\": \"^3.0.0\",\n     \"lucide-react\": \"^0.469.0\",\n     \"prosemirror-codemark\": \"^0.4.2\",\n-    \"prosemirror-utils\": \"^1.2.2\",\n     \"tippy.js\": \"^6.3.7\",\n     \"tiptap-markdown\": \"^0.8.10\",\n     \"uuid\": \"^10.0.0\",\n     \"y-indexeddb\": \"^9.0.12\",\n"
        },
        {
          "path": "packages/editor/src/core/extensions/callout/block.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/callout/block.tsx\n===================================================================\n--- packages/editor/src/core/extensions/callout/block.tsx\t4c3af7f (parent)\n+++ packages/editor/src/core/extensions/callout/block.tsx\t5c22a6c (commit)\n@@ -9,16 +9,16 @@\n import { EAttributeNames, TCalloutBlockAttributes } from \"./types\";\n // utils\n import { updateStoredBackgroundColor } from \"./utils\";\n \n-type Props = NodeViewProps & {\n+export type CustomCalloutNodeViewProps = NodeViewProps & {\n   node: NodeViewProps[\"node\"] & {\n     attrs: TCalloutBlockAttributes;\n   };\n   updateAttributes: (attrs: Partial<TCalloutBlockAttributes>) => void;\n };\n \n-export const CustomCalloutBlock: React.FC<Props> = (props) => {\n+export const CustomCalloutBlock: React.FC<CustomCalloutNodeViewProps> = (props) => {\n   const { editor, node, updateAttributes } = props;\n   // states\n   const [isEmojiPickerOpen, setIsEmojiPickerOpen] = useState(false);\n   const [isColorPickerOpen, setIsColorPickerOpen] = useState(false);\n"
        },
        {
          "path": "packages/editor/src/core/extensions/callout/extension.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/callout/extension.tsx\n===================================================================\n--- packages/editor/src/core/extensions/callout/extension.tsx\t4c3af7f (parent)\n+++ packages/editor/src/core/extensions/callout/extension.tsx\t5c22a6c (commit)\n@@ -1,7 +1,7 @@\n import { findParentNodeClosestToPos, Predicate, ReactNodeViewRenderer } from \"@tiptap/react\";\n // extensions\n-import { CustomCalloutBlock } from \"@/extensions\";\n+import { CustomCalloutBlock, CustomCalloutNodeViewProps } from \"@/extensions/callout\";\n // helpers\n import { insertEmptyParagraphAtNodeBoundaries } from \"@/helpers/insert-empty-paragraph-at-node-boundary\";\n // config\n import { CustomCalloutExtensionConfig } from \"./extension-config\";\n@@ -62,7 +62,9 @@\n     };\n   },\n \n   addNodeView() {\n-    return ReactNodeViewRenderer(CustomCalloutBlock);\n+    return ReactNodeViewRenderer((props) => (\n+      <CustomCalloutBlock {...props} node={props.node as CustomCalloutNodeViewProps[\"node\"]} />\n+    ));\n   },\n });\n"
        },
        {
          "path": "packages/editor/src/core/extensions/callout/read-only-extension.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/callout/read-only-extension.tsx\n===================================================================\n--- packages/editor/src/core/extensions/callout/read-only-extension.tsx\t4c3af7f (parent)\n+++ packages/editor/src/core/extensions/callout/read-only-extension.tsx\t5c22a6c (commit)\n@@ -1,14 +1,16 @@\n import { ReactNodeViewRenderer } from \"@tiptap/react\";\n // extensions\n-import { CustomCalloutBlock } from \"@/extensions\";\n+import { CustomCalloutBlock, CustomCalloutNodeViewProps } from \"@/extensions/callout\";\n // config\n import { CustomCalloutExtensionConfig } from \"./extension-config\";\n \n export const CustomCalloutReadOnlyExtension = CustomCalloutExtensionConfig.extend({\n   selectable: false,\n   draggable: false,\n \n   addNodeView() {\n-    return ReactNodeViewRenderer(CustomCalloutBlock);\n+    return ReactNodeViewRenderer((props) => (\n+      <CustomCalloutBlock {...props} node={props.node as CustomCalloutNodeViewProps[\"node\"]} />\n+    ));\n   },\n });\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/extension.tsx",
          "status": "renamed",
          "oldPath": "packages/editor/src/core/extensions/custom-image/extension.ts",
          "diff": "===================================================================\n--- packages/editor/src/core/extensions/custom-image/extension.ts\t4c3af7f (parent)\n+++ packages/editor/src/core/extensions/custom-image/extension.tsx\t5c22a6c (commit)\n@@ -7,9 +7,9 @@\n import { insertEmptyParagraphAtNodeBoundaries } from \"@/helpers/insert-empty-paragraph-at-node-boundary\";\n // types\n import type { TFileHandler, TReadOnlyFileHandler } from \"@/types\";\n // local imports\n-import { CustomImageNodeView } from \"./components/node-view\";\n+import { CustomImageNodeView, CustomImageNodeViewProps } from \"./components/node-view\";\n import { CustomImageExtensionConfig } from \"./extension-config\";\n import { getImageComponentImageFileMap } from \"./utils\";\n \n type Props = {\n@@ -115,8 +115,10 @@\n       };\n     },\n \n     addNodeView() {\n-      return ReactNodeViewRenderer(CustomImageNodeView);\n+      return ReactNodeViewRenderer((props) => (\n+        <CustomImageNodeView {...props} node={props.node as CustomImageNodeViewProps[\"node\"]} />\n+      ));\n     },\n   });\n };\n"
        },
        {
          "path": "packages/editor/src/core/extensions/extensions.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/extensions.ts\n===================================================================\n--- packages/editor/src/core/extensions/extensions.ts\t4c3af7f (parent)\n+++ packages/editor/src/core/extensions/extensions.ts\t5c22a6c (commit)\n@@ -121,7 +121,6 @@\n       })\n     );\n   }\n \n-  // @ts-expect-error tiptap types are incorrect\n   return extensions;\n };\n"
        },
        {
          "path": "packages/editor/src/core/extensions/image/extension.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/image/extension.tsx\n===================================================================\n--- packages/editor/src/core/extensions/image/extension.tsx\t4c3af7f (parent)\n+++ packages/editor/src/core/extensions/image/extension.tsx\t5c22a6c (commit)\n@@ -3,9 +3,9 @@\n import { insertEmptyParagraphAtNodeBoundaries } from \"@/helpers/insert-empty-paragraph-at-node-boundary\";\n // types\n import type { TFileHandler, TReadOnlyFileHandler } from \"@/types\";\n // local imports\n-import { CustomImageNodeView } from \"../custom-image/components/node-view\";\n+import { CustomImageNodeView, CustomImageNodeViewProps } from \"../custom-image/components/node-view\";\n import { ImageExtensionConfig } from \"./extension-config\";\n \n export type ImageExtensionStorage = {\n   deletedImageSet: Map<string, boolean>;\n@@ -46,8 +46,10 @@\n     },\n \n     // render custom image node\n     addNodeView() {\n-      return ReactNodeViewRenderer(CustomImageNodeView);\n+      return ReactNodeViewRenderer((props) => (\n+        <CustomImageNodeView {...props} node={props.node as CustomImageNodeViewProps[\"node\"]} />\n+      ));\n     },\n   });\n };\n"
        },
        {
          "path": "packages/editor/src/core/extensions/mentions/extension.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/mentions/extension.tsx\n===================================================================\n--- packages/editor/src/core/extensions/mentions/extension.tsx\t4c3af7f (parent)\n+++ packages/editor/src/core/extensions/mentions/extension.tsx\t5c22a6c (commit)\n@@ -3,9 +3,9 @@\n import { TMentionHandler } from \"@/types\";\n // extension config\n import { CustomMentionExtensionConfig } from \"./extension-config\";\n // node view\n-import { MentionNodeView } from \"./mention-node-view\";\n+import { MentionNodeView, MentionNodeViewProps } from \"./mention-node-view\";\n // utils\n import { renderMentionsDropdown } from \"./utils\";\n \n export const CustomMentionExtension = (props: TMentionHandler) => {\n@@ -19,9 +19,11 @@\n       };\n     },\n \n     addNodeView() {\n-      return ReactNodeViewRenderer(MentionNodeView);\n+      return ReactNodeViewRenderer((props) => (\n+        <MentionNodeView {...props} node={props.node as MentionNodeViewProps[\"node\"]} />\n+      ));\n     },\n   }).configure({\n     suggestion: {\n       render: renderMentionsDropdown({\n"
        },
        {
          "path": "packages/editor/src/core/extensions/mentions/mention-node-view.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/mentions/mention-node-view.tsx\n===================================================================\n--- packages/editor/src/core/extensions/mentions/mention-node-view.tsx\t4c3af7f (parent)\n+++ packages/editor/src/core/extensions/mentions/mention-node-view.tsx\t5c22a6c (commit)\n@@ -3,19 +3,20 @@\n import { TMentionExtensionOptions } from \"./extension-config\";\n // extension types\n import { EMentionComponentAttributeNames, TMentionComponentAttributes } from \"./types\";\n \n-type Props = NodeViewProps & {\n+export type MentionNodeViewProps = NodeViewProps & {\n   node: NodeViewProps[\"node\"] & {\n     attrs: TMentionComponentAttributes;\n   };\n };\n \n-export const MentionNodeView = (props: Props) => {\n+export const MentionNodeView: React.FC<MentionNodeViewProps> = (props) => {\n   const {\n     extension,\n     node: { attrs },\n   } = props;\n+\n   return (\n     <NodeViewWrapper className=\"mention-component inline w-fit\">\n       {(extension.options as TMentionExtensionOptions).renderComponent({\n         entity_identifier: attrs[EMentionComponentAttributeNames.ENTITY_IDENTIFIER] ?? \"\",\n"
        },
        {
          "path": "packages/editor/src/core/extensions/read-only-extensions.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/read-only-extensions.ts\n===================================================================\n--- packages/editor/src/core/extensions/read-only-extensions.ts\t4c3af7f (parent)\n+++ packages/editor/src/core/extensions/read-only-extensions.ts\t5c22a6c (commit)\n@@ -97,7 +97,6 @@\n       })\n     );\n   }\n \n-  // @ts-expect-error tiptap types are incorrect\n   return extensions;\n };\n"
        },
        {
          "path": "packages/editor/src/core/extensions/slash-commands/root.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/slash-commands/root.tsx\n===================================================================\n--- packages/editor/src/core/extensions/slash-commands/root.tsx\t4c3af7f (parent)\n+++ packages/editor/src/core/extensions/slash-commands/root.tsx\t5c22a6c (commit)\n@@ -39,12 +39,8 @@\n           if (blockType === CORE_EXTENSIONS.CODE_BLOCK) {\n             return false;\n           }\n \n-          if (editor.isActive(CORE_EXTENSIONS.TABLE)) {\n-            return false;\n-          }\n-\n           return true;\n         },\n       },\n     };\n"
        },
        {
          "path": "packages/editor/src/core/helpers/editor-commands.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/helpers/editor-commands.ts\n===================================================================\n--- packages/editor/src/core/helpers/editor-commands.ts\t4c3af7f (parent)\n+++ packages/editor/src/core/helpers/editor-commands.ts\t5c22a6c (commit)\n@@ -1,5 +1,5 @@\n-import { Editor, Range } from \"@tiptap/core\";\n+import type { Editor, Range } from \"@tiptap/core\";\n // constants\n import { CORE_EXTENSIONS } from \"@/constants/extension\";\n // extensions\n import { replaceCodeWithText } from \"@/extensions/code/utils/replace-code-block-with-text\";\n@@ -13,23 +13,18 @@\n };\n \n export const toggleHeading = (editor: Editor, level: 1 | 2 | 3 | 4 | 5 | 6, range?: Range) => {\n   if (range) editor.chain().focus().deleteRange(range).setNode(CORE_EXTENSIONS.HEADING, { level }).run();\n-  // @ts-expect-error tiptap types are incorrect\n   else editor.chain().focus().toggleHeading({ level }).run();\n };\n \n export const toggleBold = (editor: Editor, range?: Range) => {\n-  // @ts-expect-error tiptap types are incorrect\n   if (range) editor.chain().focus().deleteRange(range).toggleBold().run();\n-  // @ts-expect-error tiptap types are incorrect\n   else editor.chain().focus().toggleBold().run();\n };\n \n export const toggleItalic = (editor: Editor, range?: Range) => {\n-  // @ts-expect-error tiptap types are incorrect\n   if (range) editor.chain().focus().deleteRange(range).toggleItalic().run();\n-  // @ts-expect-error tiptap types are incorrect\n   else editor.chain().focus().toggleItalic().run();\n };\n \n export const toggleUnderline = (editor: Editor, range?: Range) => {\n@@ -66,18 +61,14 @@\n   }\n };\n \n export const toggleOrderedList = (editor: Editor, range?: Range) => {\n-  // @ts-expect-error tiptap types are incorrect\n   if (range) editor.chain().focus().deleteRange(range).toggleOrderedList().run();\n-  // @ts-expect-error tiptap types are incorrect\n   else editor.chain().focus().toggleOrderedList().run();\n };\n \n export const toggleBulletList = (editor: Editor, range?: Range) => {\n-  // @ts-expect-error tiptap types are incorrect\n   if (range) editor.chain().focus().deleteRange(range).toggleBulletList().run();\n-  // @ts-expect-error tiptap types are incorrect\n   else editor.chain().focus().toggleBulletList().run();\n };\n \n export const toggleTaskList = (editor: Editor, range?: Range) => {\n@@ -85,11 +76,9 @@\n   else editor.chain().focus().toggleTaskList().run();\n };\n \n export const toggleStrike = (editor: Editor, range?: Range) => {\n-  // @ts-expect-error tiptap types are incorrect\n   if (range) editor.chain().focus().deleteRange(range).toggleStrike().run();\n-  // @ts-expect-error tiptap types are incorrect\n   else editor.chain().focus().toggleStrike().run();\n };\n \n export const toggleBlockquote = (editor: Editor, range?: Range) => {\n"
        },
        {
          "path": "packages/editor/src/core/helpers/yjs-utils.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/helpers/yjs-utils.ts\n===================================================================\n--- packages/editor/src/core/helpers/yjs-utils.ts\t4c3af7f (parent)\n+++ packages/editor/src/core/helpers/yjs-utils.ts\t5c22a6c (commit)\n@@ -12,11 +12,9 @@\n // editor extension configs\n const RICH_TEXT_EDITOR_EXTENSIONS = CoreEditorExtensionsWithoutProps;\n const DOCUMENT_EDITOR_EXTENSIONS = [...CoreEditorExtensionsWithoutProps, ...DocumentEditorExtensionsWithoutProps];\n // editor schemas\n-// @ts-expect-error tiptap types are incorrect\n const richTextEditorSchema = getSchema(RICH_TEXT_EDITOR_EXTENSIONS);\n-// @ts-expect-error tiptap types are incorrect\n const documentEditorSchema = getSchema(DOCUMENT_EDITOR_EXTENSIONS);\n \n /**\n  * @description apply updates to a doc and return the updated doc in binary format\n@@ -56,9 +54,8 @@\n  * @returns {Uint8Array}\n  */\n export const getBinaryDataFromRichTextEditorHTMLString = (descriptionHTML: string): Uint8Array => {\n   // convert HTML to JSON\n-  // @ts-expect-error tiptap types are incorrect\n   const contentJSON = generateJSON(descriptionHTML ?? \"<p></p>\", RICH_TEXT_EDITOR_EXTENSIONS);\n   // convert JSON to Y.Doc format\n   const transformedData = prosemirrorJSONToYDoc(richTextEditorSchema, contentJSON, \"default\");\n   // convert Y.Doc to Uint8Array format\n@@ -72,9 +69,8 @@\n  * @returns {Uint8Array}\n  */\n export const getBinaryDataFromDocumentEditorHTMLString = (descriptionHTML: string): Uint8Array => {\n   // convert HTML to JSON\n-  // @ts-expect-error tiptap types are incorrect\n   const contentJSON = generateJSON(descriptionHTML ?? \"<p></p>\", DOCUMENT_EDITOR_EXTENSIONS);\n   // convert JSON to Y.Doc format\n   const transformedData = prosemirrorJSONToYDoc(documentEditorSchema, contentJSON, \"default\");\n   // convert Y.Doc to Uint8Array format\n@@ -101,9 +97,8 @@\n   // convert to JSON\n   const type = yDoc.getXmlFragment(\"default\");\n   const contentJSON = yXmlFragmentToProseMirrorRootNode(type, richTextEditorSchema).toJSON();\n   // convert to HTML\n-  // @ts-expect-error tiptap types are incorrect\n   const contentHTML = generateHTML(contentJSON, RICH_TEXT_EDITOR_EXTENSIONS);\n \n   return {\n     contentBinaryEncoded: base64Data,\n@@ -131,9 +126,8 @@\n   // convert to JSON\n   const type = yDoc.getXmlFragment(\"default\");\n   const contentJSON = yXmlFragmentToProseMirrorRootNode(type, documentEditorSchema).toJSON();\n   // convert to HTML\n-  // @ts-expect-error tiptap types are incorrect\n   const contentHTML = generateHTML(contentJSON, DOCUMENT_EDITOR_EXTENSIONS);\n \n   return {\n     contentBinaryEncoded: base64Data,\n"
        },
        {
          "path": "packages/editor/src/core/plugins/drag-handle.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/plugins/drag-handle.ts\n===================================================================\n--- packages/editor/src/core/plugins/drag-handle.ts\t4c3af7f (parent)\n+++ packages/editor/src/core/plugins/drag-handle.ts\t5c22a6c (commit)\n@@ -64,9 +64,11 @@\n     return value === \"auto\" || value === \"scroll\";\n   });\n };\n \n-const getScrollParent = (node: HTMLElement | SVGElement) => {\n+const getScrollParent = (node: HTMLElement | SVGElement | null): Element | null => {\n+  if (!node) return null;\n+\n   if (scrollParentCache.has(node)) {\n     return scrollParentCache.get(node);\n   }\n \n@@ -136,35 +138,10 @@\n   let scrollAnimationFrame: number | null = null;\n   let isDraggedOutsideWindow: \"top\" | \"bottom\" | boolean = false;\n   let isMouseInsideWhileDragging = false;\n   let currentScrollSpeed = 0;\n+  let dragHandleElement: HTMLElement | null = null;\n \n-  const handleClick = (event: MouseEvent, view: EditorView) => {\n-    handleNodeSelection(event, view, false, options);\n-  };\n-\n-  const handleDragStart = (event: DragEvent, view: EditorView) => {\n-    const { listType: listTypeFromDragStart } = handleNodeSelection(event, view, true, options) ?? {};\n-    if (listTypeFromDragStart) {\n-      listType = listTypeFromDragStart;\n-    }\n-    isDragging = true;\n-    lastClientY = event.clientY;\n-    scroll();\n-  };\n-\n-  const handleDragEnd = <TEvent extends DragEvent | FocusEvent>(event: TEvent, view?: EditorView) => {\n-    event.preventDefault();\n-    isDragging = false;\n-    isMouseInsideWhileDragging = false;\n-    if (scrollAnimationFrame) {\n-      cancelAnimationFrame(scrollAnimationFrame);\n-      scrollAnimationFrame = null;\n-    }\n-\n-    view?.dom.classList.remove(\"dragging\");\n-  };\n-\n   function scroll() {\n     if (!isDragging) {\n       currentScrollSpeed = 0;\n       return;\n@@ -198,9 +175,34 @@\n \n     scrollAnimationFrame = requestAnimationFrame(scroll);\n   }\n \n-  let dragHandleElement: HTMLElement | null = null;\n+  const handleClick = (event: MouseEvent, view: EditorView) => {\n+    handleNodeSelection(event, view, false, options);\n+  };\n+\n+  const handleDragStart = (event: DragEvent, view: EditorView) => {\n+    const { listType: listTypeFromDragStart } = handleNodeSelection(event, view, true, options) ?? {};\n+    if (listTypeFromDragStart) {\n+      listType = listTypeFromDragStart;\n+    }\n+    isDragging = true;\n+    lastClientY = event.clientY;\n+    scroll();\n+  };\n+\n+  const handleDragEnd = <TEvent extends DragEvent | FocusEvent>(event: TEvent, view?: EditorView) => {\n+    event.preventDefault();\n+    isDragging = false;\n+    isMouseInsideWhileDragging = false;\n+    if (scrollAnimationFrame) {\n+      cancelAnimationFrame(scrollAnimationFrame);\n+      scrollAnimationFrame = null;\n+    }\n+\n+    view?.dom.classList.remove(\"dragging\");\n+  };\n+\n   // drag handle view actions\n   const showDragHandle = () => dragHandleElement?.classList.remove(\"drag-handle-hidden\");\n   const hideDragHandle = () => {\n     if (!dragHandleElement?.classList.contains(\"drag-handle-hidden\"))\n"
        },
        {
          "path": "yarn.lock",
          "status": "modified",
          "diff": "Index: yarn.lock\n===================================================================\n--- yarn.lock\t4c3af7f (parent)\n+++ yarn.lock\t5c22a6c (commit)\n@@ -313,26 +313,26 @@\n   resolved \"https://registry.yarnpkg.com/@date-fns/tz/-/tz-1.2.0.tgz#81cb3211693830babaf3b96aff51607e143030a6\"\n   integrity sha512-LBrd7MiJZ9McsOgxqWX7AaxrDjcFVjWH/tIKJd7pnR7McaslGYOP1QmmiBXdJH/H/yLCT+rcQ7FaPBUxRGUtrg==\n \n \"@emnapi/core@^1.4.3\":\n-  version \"1.4.4\"\n-  resolved \"https://registry.yarnpkg.com/@emnapi/core/-/core-1.4.4.tgz#76620673f3033626c6d79b1420d69f06a6bb153c\"\n-  integrity sha512-A9CnAbC6ARNMKcIcrQwq6HeHCjpcBZ5wSx4U01WXCqEKlrzB9F9315WDNHkrs2xbx7YjjSxbUYxuN6EQzpcY2g==\n+  version \"1.4.5\"\n+  resolved \"https://registry.yarnpkg.com/@emnapi/core/-/core-1.4.5.tgz#bfbb0cbbbb9f96ec4e2c4fd917b7bbe5495ceccb\"\n+  integrity sha512-XsLw1dEOpkSX/WucdqUhPWP7hDxSvZiY+fsUC14h+FtQ2Ifni4znbBt8punRX+Uj2JG/uDb8nEHVKvrVlvdZ5Q==\n   dependencies:\n-    \"@emnapi/wasi-threads\" \"1.0.3\"\n+    \"@emnapi/wasi-threads\" \"1.0.4\"\n     tslib \"^2.4.0\"\n \n \"@emnapi/runtime@^1.4.3\":\n-  version \"1.4.4\"\n-  resolved \"https://registry.yarnpkg.com/@emnapi/runtime/-/runtime-1.4.4.tgz#19a8f00719c51124e2d0fbf4aaad3fa7b0c92524\"\n-  integrity sha512-hHyapA4A3gPaDCNfiqyZUStTMqIkKRshqPIuDOXv1hcBnD4U3l8cP0T1HMCfGRxQ6V64TGCcoswChANyOAwbQg==\n+  version \"1.4.5\"\n+  resolved \"https://registry.yarnpkg.com/@emnapi/runtime/-/runtime-1.4.5.tgz#c67710d0661070f38418b6474584f159de38aba9\"\n+  integrity sha512-++LApOtY0pEEz1zrd9vy1/zXVaVJJ/EbAF3u0fXIzPJEDtnITsBGbbK0EkM72amhl/R5b+5xx0Y/QhcVOpuulg==\n   dependencies:\n     tslib \"^2.4.0\"\n \n-\"@emnapi/wasi-threads@1.0.3\":\n-  version \"1.0.3\"\n-  resolved \"https://registry.yarnpkg.com/@emnapi/wasi-threads/-/wasi-threads-1.0.3.tgz#83fa228bde0e71668aad6db1af4937473d1d3ab1\"\n-  integrity sha512-8K5IFFsQqF9wQNJptGbS6FNKgUTsSRYnTqNCG1vPP8jFdjSv18n2mQfJpkt2Oibo9iBEzcDnDxNwKTzC7svlJw==\n+\"@emnapi/wasi-threads@1.0.4\":\n+  version \"1.0.4\"\n+  resolved \"https://registry.yarnpkg.com/@emnapi/wasi-threads/-/wasi-threads-1.0.4.tgz#703fc094d969e273b1b71c292523b2f792862bf4\"\n+  integrity sha512-PJR+bOmMOPH8AtcTGAyYNiuJ3/Fcoj2XN/gBEWzDIKh254XO+mM9XoXHk5GNEhodxeMznbg7BlRojVbKN+gC6g==\n   dependencies:\n     tslib \"^2.4.0\"\n \n \"@emotion/babel-plugin@^11.13.5\":\n@@ -1377,107 +1377,107 @@\n   version \"3.0.0\"\n   resolved \"https://registry.yarnpkg.com/@remirror/core-constants/-/core-constants-3.0.0.tgz#96fdb89d25c62e7b6a5d08caf0ce5114370e3b8f\"\n   integrity sha512-42aWfPrimMfDKDi4YegyS7x+/0tlzaqwPQCULLanv3DMIlu96KTJR0fM5isWX2UViOqlGnX6YFgqWepcX+XMNg==\n \n-\"@rollup/rollup-android-arm-eabi@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-android-arm-eabi/-/rollup-android-arm-eabi-4.45.0.tgz#0592252f7550bc0ea0474bb5a22430850f92bdbd\"\n-  integrity sha512-2o/FgACbji4tW1dzXOqAV15Eu7DdgbKsF2QKcxfG4xbh5iwU7yr5RRP5/U+0asQliSYv5M4o7BevlGIoSL0LXg==\n+\"@rollup/rollup-android-arm-eabi@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-android-arm-eabi/-/rollup-android-arm-eabi-4.45.1.tgz#8560592f0dcf43b8cb0949af9f1d916205148d12\"\n+  integrity sha512-NEySIFvMY0ZQO+utJkgoMiCAjMrGvnbDLHvcmlA33UXJpYBCvlBEbMMtV837uCkS+plG2umfhn0T5mMAxGrlRA==\n \n-\"@rollup/rollup-android-arm64@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-android-arm64/-/rollup-android-arm64-4.45.0.tgz#00a51d1d4380cc677da80ac9da1a19e7806bf57e\"\n-  integrity sha512-PSZ0SvMOjEAxwZeTx32eI/j5xSYtDCRxGu5k9zvzoY77xUNssZM+WV6HYBLROpY5CkXsbQjvz40fBb7WPwDqtQ==\n+\"@rollup/rollup-android-arm64@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-android-arm64/-/rollup-android-arm64-4.45.1.tgz#6bfb777bbce998691b6fd3e916b05cd46392d020\"\n+  integrity sha512-ujQ+sMXJkg4LRJaYreaVx7Z/VMgBBd89wGS4qMrdtfUFZ+TSY5Rs9asgjitLwzeIbhwdEhyj29zhst3L1lKsRQ==\n \n-\"@rollup/rollup-darwin-arm64@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-darwin-arm64/-/rollup-darwin-arm64-4.45.0.tgz#6638299dd282ebde1ebdf7dc5b0f150aa6e256e5\"\n-  integrity sha512-BA4yPIPssPB2aRAWzmqzQ3y2/KotkLyZukVB7j3psK/U3nVJdceo6qr9pLM2xN6iRP/wKfxEbOb1yrlZH6sYZg==\n+\"@rollup/rollup-darwin-arm64@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-darwin-arm64/-/rollup-darwin-arm64-4.45.1.tgz#7efce10220293a22e7b7b595d05d8b8400a7bcf3\"\n+  integrity sha512-FSncqHvqTm3lC6Y13xncsdOYfxGSLnP+73k815EfNmpewPs+EyM49haPS105Rh4aF5mJKywk9X0ogzLXZzN9lA==\n \n-\"@rollup/rollup-darwin-x64@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-darwin-x64/-/rollup-darwin-x64-4.45.0.tgz#33e61daa0a66890059648feda78e1075d4ea1bcb\"\n-  integrity sha512-Pr2o0lvTwsiG4HCr43Zy9xXrHspyMvsvEw4FwKYqhli4FuLE5FjcZzuQ4cfPe0iUFCvSQG6lACI0xj74FDZKRA==\n+\"@rollup/rollup-darwin-x64@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-darwin-x64/-/rollup-darwin-x64-4.45.1.tgz#c617a8ece21050bfbea299c126767d2e70cfa79a\"\n+  integrity sha512-2/vVn/husP5XI7Fsf/RlhDaQJ7x9zjvC81anIVbr4b/f0xtSmXQTFcGIQ/B1cXIYM6h2nAhJkdMHTnD7OtQ9Og==\n \n-\"@rollup/rollup-freebsd-arm64@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-freebsd-arm64/-/rollup-freebsd-arm64-4.45.0.tgz#2cc4bd3ba7026cd5374e902285ce76e8fae0f6eb\"\n-  integrity sha512-lYE8LkE5h4a/+6VnnLiL14zWMPnx6wNbDG23GcYFpRW1V9hYWHAw9lBZ6ZUIrOaoK7NliF1sdwYGiVmziUF4vA==\n+\"@rollup/rollup-freebsd-arm64@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-freebsd-arm64/-/rollup-freebsd-arm64-4.45.1.tgz#5a6af0a9acf82162d2910933649ae24fc0ea3ecb\"\n+  integrity sha512-4g1kaDxQItZsrkVTdYQ0bxu4ZIQ32cotoQbmsAnW1jAE4XCMbcBPDirX5fyUzdhVCKgPcrwWuucI8yrVRBw2+g==\n \n-\"@rollup/rollup-freebsd-x64@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-freebsd-x64/-/rollup-freebsd-x64-4.45.0.tgz#64664ba3015deac473a5d6d6c60c068f274bf2d5\"\n-  integrity sha512-PVQWZK9sbzpvqC9Q0GlehNNSVHR+4m7+wET+7FgSnKG3ci5nAMgGmr9mGBXzAuE5SvguCKJ6mHL6vq1JaJ/gvw==\n+\"@rollup/rollup-freebsd-x64@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-freebsd-x64/-/rollup-freebsd-x64-4.45.1.tgz#ae9709463560196fc275bd0da598668a2e341023\"\n+  integrity sha512-L/6JsfiL74i3uK1Ti2ZFSNsp5NMiM4/kbbGEcOCps99aZx3g8SJMO1/9Y0n/qKlWZfn6sScf98lEOUe2mBvW9A==\n \n-\"@rollup/rollup-linux-arm-gnueabihf@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-arm-gnueabihf/-/rollup-linux-arm-gnueabihf-4.45.0.tgz#7ab16acae3bcae863e9a9bc32038cd05e794a0ff\"\n-  integrity sha512-hLrmRl53prCcD+YXTfNvXd776HTxNh8wPAMllusQ+amcQmtgo3V5i/nkhPN6FakW+QVLoUUr2AsbtIRPFU3xIA==\n+\"@rollup/rollup-linux-arm-gnueabihf@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-arm-gnueabihf/-/rollup-linux-arm-gnueabihf-4.45.1.tgz#6ec52661764dbd54c19d6520a403aa385a5c0fbf\"\n+  integrity sha512-RkdOTu2jK7brlu+ZwjMIZfdV2sSYHK2qR08FUWcIoqJC2eywHbXr0L8T/pONFwkGukQqERDheaGTeedG+rra6Q==\n \n-\"@rollup/rollup-linux-arm-musleabihf@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-arm-musleabihf/-/rollup-linux-arm-musleabihf-4.45.0.tgz#bef91b1e924ab57e82e767dc2655264bbde7acc6\"\n-  integrity sha512-XBKGSYcrkdiRRjl+8XvrUR3AosXU0NvF7VuqMsm7s5nRy+nt58ZMB19Jdp1RdqewLcaYnpk8zeVs/4MlLZEJxw==\n+\"@rollup/rollup-linux-arm-musleabihf@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-arm-musleabihf/-/rollup-linux-arm-musleabihf-4.45.1.tgz#fd33ba4a43ef8419e96811236493d19436271923\"\n+  integrity sha512-3kJ8pgfBt6CIIr1o+HQA7OZ9mp/zDk3ctekGl9qn/pRBgrRgfwiffaUmqioUGN9hv0OHv2gxmvdKOkARCtRb8Q==\n \n-\"@rollup/rollup-linux-arm64-gnu@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-arm64-gnu/-/rollup-linux-arm64-gnu-4.45.0.tgz#0a811b16da334125f6e44570d0badf543876f49e\"\n-  integrity sha512-fRvZZPUiBz7NztBE/2QnCS5AtqLVhXmUOPj9IHlfGEXkapgImf4W9+FSkL8cWqoAjozyUzqFmSc4zh2ooaeF6g==\n+\"@rollup/rollup-linux-arm64-gnu@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-arm64-gnu/-/rollup-linux-arm64-gnu-4.45.1.tgz#933b3d99b73c9d7bf4506cab0d5d313c7e74fd2d\"\n+  integrity sha512-k3dOKCfIVixWjG7OXTCOmDfJj3vbdhN0QYEqB+OuGArOChek22hn7Uy5A/gTDNAcCy5v2YcXRJ/Qcnm4/ma1xw==\n \n-\"@rollup/rollup-linux-arm64-musl@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-arm64-musl/-/rollup-linux-arm64-musl-4.45.0.tgz#e8c166efe3cb963faaa924c7721eafbade63036f\"\n-  integrity sha512-Btv2WRZOcUGi8XU80XwIvzTg4U6+l6D0V6sZTrZx214nrwxw5nAi8hysaXj/mctyClWgesyuxbeLylCBNauimg==\n+\"@rollup/rollup-linux-arm64-musl@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-arm64-musl/-/rollup-linux-arm64-musl-4.45.1.tgz#dbe9ae24ee9e97b75662fddcb69eb7f23c89280a\"\n+  integrity sha512-PmI1vxQetnM58ZmDFl9/Uk2lpBBby6B6rF4muJc65uZbxCs0EA7hhKCk2PKlmZKuyVSHAyIw3+/SiuMLxKxWog==\n \n-\"@rollup/rollup-linux-loongarch64-gnu@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-loongarch64-gnu/-/rollup-linux-loongarch64-gnu-4.45.0.tgz#239feea00fa2a1e734bdff09b8d1c90def2abbf5\"\n-  integrity sha512-Li0emNnwtUZdLwHjQPBxn4VWztcrw/h7mgLyHiEI5Z0MhpeFGlzaiBHpSNVOMB/xucjXTTcO+dhv469Djr16KA==\n+\"@rollup/rollup-linux-loongarch64-gnu@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-loongarch64-gnu/-/rollup-linux-loongarch64-gnu-4.45.1.tgz#818c5a071eec744436dbcdd76fe9c3c869dc9a8d\"\n+  integrity sha512-9UmI0VzGmNJ28ibHW2GpE2nF0PBQqsyiS4kcJ5vK+wuwGnV5RlqdczVocDSUfGX/Na7/XINRVoUgJyFIgipoRg==\n \n-\"@rollup/rollup-linux-powerpc64le-gnu@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-powerpc64le-gnu/-/rollup-linux-powerpc64le-gnu-4.45.0.tgz#1de2f926bddbf7d689a089277c1284ea6df4b6d1\"\n-  integrity sha512-sB8+pfkYx2kvpDCfd63d5ScYT0Fz1LO6jIb2zLZvmK9ob2D8DeVqrmBDE0iDK8KlBVmsTNzrjr3G1xV4eUZhSw==\n+\"@rollup/rollup-linux-powerpc64le-gnu@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-powerpc64le-gnu/-/rollup-linux-powerpc64le-gnu-4.45.1.tgz#6b8591def27d886fa147fb0340126c7d6682a7e4\"\n+  integrity sha512-7nR2KY8oEOUTD3pBAxIBBbZr0U7U+R9HDTPNy+5nVVHDXI4ikYniH1oxQz9VoB5PbBU1CZuDGHkLJkd3zLMWsg==\n \n-\"@rollup/rollup-linux-riscv64-gnu@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-riscv64-gnu/-/rollup-linux-riscv64-gnu-4.45.0.tgz#28dbac643244e477a7b931feb9b475aa826f84c1\"\n-  integrity sha512-5GQ6PFhh7E6jQm70p1aW05G2cap5zMOvO0se5JMecHeAdj5ZhWEHbJ4hiKpfi1nnnEdTauDXxPgXae/mqjow9w==\n+\"@rollup/rollup-linux-riscv64-gnu@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-riscv64-gnu/-/rollup-linux-riscv64-gnu-4.45.1.tgz#f1861ac4ee8da64e0b0d23853ff26fe2baa876cf\"\n+  integrity sha512-nlcl3jgUultKROfZijKjRQLUu9Ma0PeNv/VFHkZiKbXTBQXhpytS8CIj5/NfBeECZtY2FJQubm6ltIxm/ftxpw==\n \n-\"@rollup/rollup-linux-riscv64-musl@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-riscv64-musl/-/rollup-linux-riscv64-musl-4.45.0.tgz#5d05eeaedadec3625cd50e3ca5d35ef6f96a4bf0\"\n-  integrity sha512-N/euLsBd1rekWcuduakTo/dJw6U6sBP3eUq+RXM9RNfPuWTvG2w/WObDkIvJ2KChy6oxZmOSC08Ak2OJA0UiAA==\n+\"@rollup/rollup-linux-riscv64-musl@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-riscv64-musl/-/rollup-linux-riscv64-musl-4.45.1.tgz#320c961401a923b374e358664527b188e374e1ae\"\n+  integrity sha512-HJV65KLS51rW0VY6rvZkiieiBnurSzpzore1bMKAhunQiECPuxsROvyeaot/tcK3A3aGnI+qTHqisrpSgQrpgA==\n \n-\"@rollup/rollup-linux-s390x-gnu@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-s390x-gnu/-/rollup-linux-s390x-gnu-4.45.0.tgz#55b0790f499fb7adc14eb074c4e46aef92915813\"\n-  integrity sha512-2l9sA7d7QdikL0xQwNMO3xURBUNEWyHVHfAsHsUdq+E/pgLTUcCE+gih5PCdmyHmfTDeXUWVhqL0WZzg0nua3g==\n+\"@rollup/rollup-linux-s390x-gnu@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-s390x-gnu/-/rollup-linux-s390x-gnu-4.45.1.tgz#1763eed3362b50b6164d3f0947486c03cc7e616d\"\n+  integrity sha512-NITBOCv3Qqc6hhwFt7jLV78VEO/il4YcBzoMGGNxznLgRQf43VQDae0aAzKiBeEPIxnDrACiMgbqjuihx08OOw==\n \n-\"@rollup/rollup-linux-x64-gnu@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-x64-gnu/-/rollup-linux-x64-gnu-4.45.0.tgz#e822632fe5b324b16bdc37149149c8c760b031fd\"\n-  integrity sha512-XZdD3fEEQcwG2KrJDdEQu7NrHonPxxaV0/w2HpvINBdcqebz1aL+0vM2WFJq4DeiAVT6F5SUQas65HY5JDqoPw==\n+\"@rollup/rollup-linux-x64-gnu@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-x64-gnu/-/rollup-linux-x64-gnu-4.45.1.tgz#0d4c8d0b8f801902f0844a40a9d981a0179f4971\"\n+  integrity sha512-+E/lYl6qu1zqgPEnTrs4WysQtvc/Sh4fC2nByfFExqgYrqkKWp1tWIbe+ELhixnenSpBbLXNi6vbEEJ8M7fiHw==\n \n-\"@rollup/rollup-linux-x64-musl@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-x64-musl/-/rollup-linux-x64-musl-4.45.0.tgz#19a3602cb8fabd7eb3087f0a1e1e01adac31bbff\"\n-  integrity sha512-7ayfgvtmmWgKWBkCGg5+xTQ0r5V1owVm67zTrsEY1008L5ro7mCyGYORomARt/OquB9KY7LpxVBZes+oSniAAQ==\n+\"@rollup/rollup-linux-x64-musl@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-linux-x64-musl/-/rollup-linux-x64-musl-4.45.1.tgz#ec30bb48b5fe22a3aaba98072f2d5b7139e1a8eb\"\n+  integrity sha512-a6WIAp89p3kpNoYStITT9RbTbTnqarU7D8N8F2CV+4Cl9fwCOZraLVuVFvlpsW0SbIiYtEnhCZBPLoNdRkjQFw==\n \n-\"@rollup/rollup-win32-arm64-msvc@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-win32-arm64-msvc/-/rollup-win32-arm64-msvc-4.45.0.tgz#42e08bf3ea4fc463fc9f199c4f0310a736f03eb1\"\n-  integrity sha512-B+IJgcBnE2bm93jEW5kHisqvPITs4ddLOROAcOc/diBgrEiQJJ6Qcjby75rFSmH5eMGrqJryUgJDhrfj942apQ==\n+\"@rollup/rollup-win32-arm64-msvc@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-win32-arm64-msvc/-/rollup-win32-arm64-msvc-4.45.1.tgz#27a6e48d1502e8e4bed96bedfb533738655874f2\"\n+  integrity sha512-T5Bi/NS3fQiJeYdGvRpTAP5P02kqSOpqiopwhj0uaXB6nzs5JVi2XMJb18JUSKhCOX8+UE1UKQufyD6Or48dJg==\n \n-\"@rollup/rollup-win32-ia32-msvc@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-win32-ia32-msvc/-/rollup-win32-ia32-msvc-4.45.0.tgz#043d25557f59d7e28dfe38ee1f60ddcb95a08124\"\n-  integrity sha512-+CXwwG66g0/FpWOnP/v1HnrGVSOygK/osUbu3wPRy8ECXjoYKjRAyfxYpDQOfghC5qPJYLPH0oN4MCOjwgdMug==\n+\"@rollup/rollup-win32-ia32-msvc@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-win32-ia32-msvc/-/rollup-win32-ia32-msvc-4.45.1.tgz#a2fbad3bec20ff879f3fd51720adf33692ca8f3d\"\n+  integrity sha512-lxV2Pako3ujjuUe9jiU3/s7KSrDfH6IgTSQOnDWr9aJ92YsFd7EurmClK0ly/t8dzMkDtd04g60WX6yl0sGfdw==\n \n-\"@rollup/rollup-win32-x64-msvc@4.45.0\":\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/rollup-win32-x64-msvc/-/rollup-win32-x64-msvc-4.45.0.tgz#0a7eecae41f463d6591c8fecd7a5c5087345ee36\"\n-  integrity sha512-SRf1cytG7wqcHVLrBc9VtPK4pU5wxiB/lNIkNmW2ApKXIg+RpqwHfsaEK+e7eH4A1BpI6BX/aBWXxZCIrJg3uA==\n+\"@rollup/rollup-win32-x64-msvc@4.45.1\":\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/rollup-win32-x64-msvc/-/rollup-win32-x64-msvc-4.45.1.tgz#e5085c6d13da15b4c5133cd2a6bb11f25b6bb77a\"\n+  integrity sha512-M/fKi4sasCdM8i0aWJjCSFm2qEnYRR8AMLG2kxp6wD13+tMGA4Z1tVAuHkNRjud5SW2EM3naLuK35w9twvf6aA==\n \n \"@rtsao/scc@^1.1.0\":\n   version \"1.1.0\"\n   resolved \"https://registry.yarnpkg.com/@rtsao/scc/-/scc-1.1.0.tgz#927dd2fae9bc3361403ac2c7a00c32ddce9ad7e8\"\n@@ -1800,76 +1800,76 @@\n   version \"8.6.14\"\n   resolved \"https://registry.yarnpkg.com/@storybook/theming/-/theming-8.6.14.tgz#78c6dc878f705de70c67f2b2d08b8313b985d81a\"\n   integrity sha512-r4y+LsiB37V5hzpQo+BM10PaCsp7YlZ0YcZzQP1OCkPlYXmUAFy2VvDKaFRpD8IeNPKug2u4iFm/laDEbs03dg==\n \n-\"@swc/core-darwin-arm64@1.12.11\":\n-  version \"1.12.11\"\n-  resolved \"https://registry.yarnpkg.com/@swc/core-darwin-arm64/-/core-darwin-arm64-1.12.11.tgz#684bb6e82f4704ff00eff82479df889bcbf99e8a\"\n-  integrity sha512-J19Jj9Y5x/N0loExH7W0OI9OwwoVyxutDdkyq1o/kgXyBqmmzV7Y/Q9QekI2Fm/qc5mNeAdP7aj4boY4AY/JPw==\n+\"@swc/core-darwin-arm64@1.13.1\":\n+  version \"1.13.1\"\n+  resolved \"https://registry.yarnpkg.com/@swc/core-darwin-arm64/-/core-darwin-arm64-1.13.1.tgz#a66e5bc1186f8b7402855560adc7448612b159af\"\n+  integrity sha512-zO6SW/jSMTUORPm6dUZFPUwf+EFWZsaXWMGXadRG6akCofYpoQb8pcY2QZkVr43z8TMka6BtXpyoD/DJ0iOPHQ==\n \n-\"@swc/core-darwin-x64@1.12.11\":\n-  version \"1.12.11\"\n-  resolved \"https://registry.yarnpkg.com/@swc/core-darwin-x64/-/core-darwin-x64-1.12.11.tgz#3d9ed5f7038cd22cfc46997777f82c51056fe110\"\n-  integrity sha512-PTuUQrfStQ6cjW+uprGO2lpQHy84/l0v+GqRqq8s/jdK55rFRjMfCeyf6FAR0l6saO5oNOQl+zWR1aNpj8pMQw==\n+\"@swc/core-darwin-x64@1.13.1\":\n+  version \"1.13.1\"\n+  resolved \"https://registry.yarnpkg.com/@swc/core-darwin-x64/-/core-darwin-x64-1.13.1.tgz#9c56b3d25df950bdeb080b287f2a9d8331eb08a3\"\n+  integrity sha512-8RjaTZYxrlYKE5PgzZYWSOT4mAsyhIuh30Nu4dnn/2r0Ef68iNCbvX4ynGnFMhOIhqunjQbJf+mJKpwTwdHXhw==\n \n-\"@swc/core-linux-arm-gnueabihf@1.12.11\":\n-  version \"1.12.11\"\n-  resolved \"https://registry.yarnpkg.com/@swc/core-linux-arm-gnueabihf/-/core-linux-arm-gnueabihf-1.12.11.tgz#8d97b9b55ed286af233aef702208ed3b99db0364\"\n-  integrity sha512-poxBq152HsupOtnZilenvHmxZ9a8SRj4LtfxUnkMDNOGrZR9oxbQNwEzNKfi3RXEcXz+P8c0Rai1ubBazXv8oQ==\n+\"@swc/core-linux-arm-gnueabihf@1.13.1\":\n+  version \"1.13.1\"\n+  resolved \"https://registry.yarnpkg.com/@swc/core-linux-arm-gnueabihf/-/core-linux-arm-gnueabihf-1.13.1.tgz#cb4b6f7b793d0047c3936c1e57308d5e5a6a7533\"\n+  integrity sha512-jEqK6pECs2m4BpL2JA/4CCkq04p6iFOEtVNXTisO+lJ3zwmxlnIEm9UfJZG6VSu8GS9MHRKGB0ieZ1tEdN1qDA==\n \n-\"@swc/core-linux-arm64-gnu@1.12.11\":\n-  version \"1.12.11\"\n-  resolved \"https://registry.yarnpkg.com/@swc/core-linux-arm64-gnu/-/core-linux-arm64-gnu-1.12.11.tgz#e2eb74af3b863be2464bf343ed0f56652f3df6b2\"\n-  integrity sha512-y1HNamR/D0Hc8xIE910ysyLe269UYiGaQPoLjQS0phzWFfWdMj9bHM++oydVXZ4RSWycO7KyJ3uvw4NilvyMKQ==\n+\"@swc/core-linux-arm64-gnu@1.13.1\":\n+  version \"1.13.1\"\n+  resolved \"https://registry.yarnpkg.com/@swc/core-linux-arm64-gnu/-/core-linux-arm64-gnu-1.13.1.tgz#d208622b6fdff92595d23b4aba36d73be31fffe6\"\n+  integrity sha512-PbkuIOYXO/gQbWQ7NnYIwm59ygNqmUcF8LBeoKvxhx1VtOwE+9KiTfoplOikkPLhMiTzKsd8qentTslbITIg+Q==\n \n-\"@swc/core-linux-arm64-musl@1.12.11\":\n-  version \"1.12.11\"\n-  resolved \"https://registry.yarnpkg.com/@swc/core-linux-arm64-musl/-/core-linux-arm64-musl-1.12.11.tgz#fc5093d83eba3958cd6ff6d03fb6069f0fe33456\"\n-  integrity sha512-LlBxPh/32pyQsu2emMEOFRm7poEFLsw12Y1mPY7FWZiZeptomKSOSHRzKDz9EolMiV4qhK1caP1lvW4vminYgQ==\n+\"@swc/core-linux-arm64-musl@1.13.1\":\n+  version \"1.13.1\"\n+  resolved \"https://registry.yarnpkg.com/@swc/core-linux-arm64-musl/-/core-linux-arm64-musl-1.13.1.tgz#dd306f08f277a3e3a0c223f1a22ef25be791a8dd\"\n+  integrity sha512-JaqFdBCarIBKiMu5bbAp+kWPMNGg97ej+7KzbKOzWP5pRptqKi86kCDZT3WmjPe8hNG6dvBwbm7Y8JNry5LebQ==\n \n-\"@swc/core-linux-x64-gnu@1.12.11\":\n-  version \"1.12.11\"\n-  resolved \"https://registry.yarnpkg.com/@swc/core-linux-x64-gnu/-/core-linux-x64-gnu-1.12.11.tgz#cff28bb15fd8ad85c9e85333aaa1b348cbdc2d4d\"\n-  integrity sha512-bOjiZB8O/1AzHkzjge1jqX62HGRIpOHqFUrGPfAln/NC6NR+Z2A78u3ixV7k5KesWZFhCV0YVGJL+qToL27myA==\n+\"@swc/core-linux-x64-gnu@1.13.1\":\n+  version \"1.13.1\"\n+  resolved \"https://registry.yarnpkg.com/@swc/core-linux-x64-gnu/-/core-linux-x64-gnu-1.13.1.tgz#c2a41b8065c7d9cb165cc3df5317897426091823\"\n+  integrity sha512-t4cLkku10YECDaakWUH0452WJHIZtrLPRwezt6BdoMntVMwNjvXRX7C8bGuYcKC3YxRW7enZKFpozLhQIQ37oA==\n \n-\"@swc/core-linux-x64-musl@1.12.11\":\n-  version \"1.12.11\"\n-  resolved \"https://registry.yarnpkg.com/@swc/core-linux-x64-musl/-/core-linux-x64-musl-1.12.11.tgz#10bb975d77ab88caff665e508df0978be7f1915b\"\n-  integrity sha512-4dzAtbT/m3/UjF045+33gLiHd8aSXJDoqof7gTtu4q0ZyAf7XJ3HHspz+/AvOJLVo4FHHdFcdXhmo/zi1nFn8A==\n+\"@swc/core-linux-x64-musl@1.13.1\":\n+  version \"1.13.1\"\n+  resolved \"https://registry.yarnpkg.com/@swc/core-linux-x64-musl/-/core-linux-x64-musl-1.13.1.tgz#6691322d5a2cfe5187d43370c07c7ceaaac045ed\"\n+  integrity sha512-fSMwZOaG+3ukUucbEbzz9GhzGhUhXoCPqHe9qW0/Vc2IZRp538xalygKyZynYweH5d9EHux1aj3+IO8/xBaoiA==\n \n-\"@swc/core-win32-arm64-msvc@1.12.11\":\n-  version \"1.12.11\"\n-  resolved \"https://registry.yarnpkg.com/@swc/core-win32-arm64-msvc/-/core-win32-arm64-msvc-1.12.11.tgz#66bdf65a5ba851da78bd430852414c9f72d1a5d6\"\n-  integrity sha512-h8HiwBZErKvCAmjW92JvQp0iOqm6bncU4ac5jxBGkRApabpUenNJcj3h2g5O6GL5K6T9/WhnXE5gyq/s1fhPQg==\n+\"@swc/core-win32-arm64-msvc@1.13.1\":\n+  version \"1.13.1\"\n+  resolved \"https://registry.yarnpkg.com/@swc/core-win32-arm64-msvc/-/core-win32-arm64-msvc-1.13.1.tgz#451eff0efdb79804d6983dc6f533a046a90e82a0\"\n+  integrity sha512-tweCXK/79vAwj1NhAsYgICy8T1z2QEairmN2BFEBYFBFNMEB1iI1YlXwBkBtuihRvgZrTh1ORusKa4jLYzLCZA==\n \n-\"@swc/core-win32-ia32-msvc@1.12.11\":\n-  version \"1.12.11\"\n-  resolved \"https://registry.yarnpkg.com/@swc/core-win32-ia32-msvc/-/core-win32-ia32-msvc-1.12.11.tgz#b551f23eea19a14da9ade021b29c4b16ae08f8b1\"\n-  integrity sha512-1pwr325mXRNUhxTtXmx1IokV5SiRL+6iDvnt3FRXj+X5UvXXKtg2zeyftk+03u8v8v8WUr5I32hIypVJPTNxNg==\n+\"@swc/core-win32-ia32-msvc@1.13.1\":\n+  version \"1.13.1\"\n+  resolved \"https://registry.yarnpkg.com/@swc/core-win32-ia32-msvc/-/core-win32-ia32-msvc-1.13.1.tgz#3b5ed14186017a1e181f48f48d5b26147c0b857e\"\n+  integrity sha512-zi7hO9D+2R2yQN9D7T10/CAI9KhuXkNkz8tcJOW6+dVPtAk/gsIC5NoGPELjgrAlLL9CS38ZQpLDslLfpP15ng==\n \n-\"@swc/core-win32-x64-msvc@1.12.11\":\n-  version \"1.12.11\"\n-  resolved \"https://registry.yarnpkg.com/@swc/core-win32-x64-msvc/-/core-win32-x64-msvc-1.12.11.tgz#a88f84c40c98c1dd252e8fd2ae5004e1336c2f5b\"\n-  integrity sha512-5gggWo690Gvs7XiPxAmb5tHwzB9RTVXUV7AWoGb6bmyUd1OXYaebQF0HAOtade5jIoNhfQMQJ7QReRgt/d2jAA==\n+\"@swc/core-win32-x64-msvc@1.13.1\":\n+  version \"1.13.1\"\n+  resolved \"https://registry.yarnpkg.com/@swc/core-win32-x64-msvc/-/core-win32-x64-msvc-1.13.1.tgz#bd35da282344ad73a86cd32a7edc0b03a457d9f7\"\n+  integrity sha512-KubYjzqs/nz3H69ncX/XHKsC8c1xqc7UvonQAj26BhbL22HBsqdAaVutZ+Obho6RMpd3F5qQ95ldavUTWskRrw==\n \n \"@swc/core@^1.7.3\":\n-  version \"1.12.11\"\n-  resolved \"https://registry.yarnpkg.com/@swc/core/-/core-1.12.11.tgz#68c53384322896c52841c4e73b7d07459367985e\"\n-  integrity sha512-P3GM+0lqjFctcp5HhR9mOcvLSX3SptI9L1aux0Fuvgt8oH4f92rCUrkodAa0U2ktmdjcyIiG37xg2mb/dSCYSA==\n+  version \"1.13.1\"\n+  resolved \"https://registry.yarnpkg.com/@swc/core/-/core-1.13.1.tgz#36cb623f0b0282240ec007678a515fdb7c72997f\"\n+  integrity sha512-jEKKErLC6uwSqA+p6bmZR08usZM5Fpc+HdEu5CAzvye0q43yf1si1kjhHEa9XMkz0A2SAaal3eKCg/YYmtOsCA==\n   dependencies:\n     \"@swc/counter\" \"^0.1.3\"\n     \"@swc/types\" \"^0.1.23\"\n   optionalDependencies:\n-    \"@swc/core-darwin-arm64\" \"1.12.11\"\n-    \"@swc/core-darwin-x64\" \"1.12.11\"\n-    \"@swc/core-linux-arm-gnueabihf\" \"1.12.11\"\n-    \"@swc/core-linux-arm64-gnu\" \"1.12.11\"\n-    \"@swc/core-linux-arm64-musl\" \"1.12.11\"\n-    \"@swc/core-linux-x64-gnu\" \"1.12.11\"\n-    \"@swc/core-linux-x64-musl\" \"1.12.11\"\n-    \"@swc/core-win32-arm64-msvc\" \"1.12.11\"\n-    \"@swc/core-win32-ia32-msvc\" \"1.12.11\"\n-    \"@swc/core-win32-x64-msvc\" \"1.12.11\"\n+    \"@swc/core-darwin-arm64\" \"1.13.1\"\n+    \"@swc/core-darwin-x64\" \"1.13.1\"\n+    \"@swc/core-linux-arm-gnueabihf\" \"1.13.1\"\n+    \"@swc/core-linux-arm64-gnu\" \"1.13.1\"\n+    \"@swc/core-linux-arm64-musl\" \"1.13.1\"\n+    \"@swc/core-linux-x64-gnu\" \"1.13.1\"\n+    \"@swc/core-linux-x64-musl\" \"1.13.1\"\n+    \"@swc/core-win32-arm64-msvc\" \"1.13.1\"\n+    \"@swc/core-win32-ia32-msvc\" \"1.13.1\"\n+    \"@swc/core-win32-x64-msvc\" \"1.13.1\"\n \n \"@swc/counter@^0.1.3\":\n   version \"0.1.3\"\n   resolved \"https://registry.yarnpkg.com/@swc/counter/-/counter-0.1.3.tgz#cc7463bd02949611c6329596fccd2b0ec782b0e9\"\n@@ -1967,71 +1967,61 @@\n   version \"14.5.2\"\n   resolved \"https://registry.yarnpkg.com/@testing-library/user-event/-/user-event-14.5.2.tgz#db7257d727c891905947bd1c1a99da20e03c2ebd\"\n   integrity sha512-YAh82Wh4TIrxYLmfGcixwD18oIjyC1pFQC2Y01F2lzV2HTMiYrI0nze0FD0ocB//CKS/7jIUgae+adPqxK5yCQ==\n \n-\"@tiptap/core@2.10.4\":\n-  version \"2.10.4\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/core/-/core-2.10.4.tgz#0b3ad822d71f5834b281590809f430e6fd41523c\"\n-  integrity sha512-fExFRTRgb6MSpg2VvR5qO2dPTQAZWuUoU4UsBCurIVcPWcyVv4FG1YzgMyoLDKy44rebFtwUGJbfU9NzX7Q/bA==\n-\n-\"@tiptap/core@^2.11.0\":\n+\"@tiptap/core@^2.22.3\", \"@tiptap/core@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/core/-/core-2.26.1.tgz#8f97c223629972221d4175e4779f6ee955c41a37\"\n   integrity sha512-fymyd/XZvYiHjBoLt1gxs024xP/LY26d43R1vluYq7AHBL/7DE3ywzy+1GEsGyAv5Je2L0KBhNIR/izbq3Kaqg==\n \n-\"@tiptap/extension-blockquote@2.10.4\":\n-  version \"2.10.4\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/extension-blockquote/-/extension-blockquote-2.10.4.tgz#0f9a26740009fc7430fabc423077c369feaebb42\"\n-  integrity sha512-4JSwAM3B92YWvGzu/Vd5rovPrCGwLSaSLD5rxcLyfxLSrTDQd3n7lp78pzVgGhunVECzaGF5A0ByWWpEyS0a3w==\n-\n-\"@tiptap/extension-blockquote@^2.11.0\":\n+\"@tiptap/extension-blockquote@^2.22.3\", \"@tiptap/extension-blockquote@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-blockquote/-/extension-blockquote-2.26.1.tgz#8ad2b3c119ff22430432ef46c852c135c156d63b\"\n   integrity sha512-viQ6AHRhjCYYipKK6ZepBzwZpkuMvO9yhRHeUZDvlSOAh8rvsUTSre0y74nu8QRYUt4a44lJJ6BpphJK7bEgYA==\n \n-\"@tiptap/extension-bold@^2.11.0\":\n+\"@tiptap/extension-bold@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-bold/-/extension-bold-2.26.1.tgz#1218b847d360d69b6fc9e30596991bc53bc8fb98\"\n   integrity sha512-zCce9PRuTNhadFir71luLo99HERDpGJ0EEflGm7RN8I1SnNi9gD5ooK42BOIQtejGCJqg3hTPZiYDJC2hXvckQ==\n \n-\"@tiptap/extension-bubble-menu@^2.11.0\":\n+\"@tiptap/extension-bubble-menu@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-bubble-menu/-/extension-bubble-menu-2.26.1.tgz#7d78abb95bfc96468b40819ec00e2770ddcf63ad\"\n   integrity sha512-oHevUcZbTMFOTpdCEo4YEDe044MB4P1ZrWyML8CGe5tnnKdlI9BN03AXpI1mEEa5CA3H1/eEckXx8EiCgYwQ3Q==\n   dependencies:\n     tippy.js \"^6.3.7\"\n \n-\"@tiptap/extension-bullet-list@^2.11.0\":\n+\"@tiptap/extension-bullet-list@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-bullet-list/-/extension-bullet-list-2.26.1.tgz#b92170ca5d0b3404599799277fd73a124e81d093\"\n   integrity sha512-HHakuV4ckYCDOnBbne088FvCEP4YICw+wgPBz/V2dfpiFYQ4WzT0LPK9s7OFMCN+ROraoug+1ryN1Z1KdIgujQ==\n \n-\"@tiptap/extension-character-count@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/extension-character-count/-/extension-character-count-2.11.0.tgz#7d3992ceba72f1eeb2db3a1fc997c50dddd7cf8c\"\n-  integrity sha512-WbqVr1QY62vxpmDJP5k3bwyzoHha1sZTs0xj3L+4s1j/SB2A7tAlFdcNPPwfbPOINHQgomSAyClfTyd4Gor7HA==\n+\"@tiptap/extension-character-count@^2.22.3\":\n+  version \"2.26.1\"\n+  resolved \"https://registry.yarnpkg.com/@tiptap/extension-character-count/-/extension-character-count-2.26.1.tgz#f053ba6c0ac82dd02ffe3fddcb645da4d49fa9ea\"\n+  integrity sha512-F7LP1a9GF28thbApowWT2I41baqX74HMUTrV9LGrNXaOkW2gxZz+CDOzfHsbHyfuwfIxIjv07Qf/HKA6Cc1qbA==\n \n-\"@tiptap/extension-code-block@^2.11.0\":\n+\"@tiptap/extension-code-block@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-code-block/-/extension-code-block-2.26.1.tgz#dd6f9ec59440844f8e0ab0b33a75ff8ab6b6669f\"\n   integrity sha512-/TDDOwONl0qEUc4+B6V9NnWtSjz95eg7/8uCb8Y8iRbGvI9vT4/znRKofFxstvKmW4URu/H74/g0ywV57h0B+A==\n \n-\"@tiptap/extension-code@^2.11.0\":\n+\"@tiptap/extension-code@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-code/-/extension-code-2.26.1.tgz#ed289955423da20faa6ef4c81472835ac5fe1574\"\n   integrity sha512-GU9deB1A/Tr4FMPu71CvlcjGKwRhGYz60wQ8m4aM+ELZcVIcZRa1ebR8bExRIEWnvRztQuyRiCQzw2N0xQJ1QQ==\n \n-\"@tiptap/extension-collaboration@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/extension-collaboration/-/extension-collaboration-2.11.0.tgz#21ac1c8bc2ca6d8ba2a838e63457528627294888\"\n-  integrity sha512-pS3E//ODD80PwVXp7zOqek0q9z5AtZ6sMSK5nPneNioe7dSvCeQzToOD9V6EevK4KChUIN9wEryK8mkQs57ioA==\n+\"@tiptap/extension-collaboration@^2.22.3\":\n+  version \"2.26.1\"\n+  resolved \"https://registry.yarnpkg.com/@tiptap/extension-collaboration/-/extension-collaboration-2.26.1.tgz#7dccd127e5356d72337dad8d71be11c3265e2d27\"\n+  integrity sha512-ozCrGW5IAzi/18Ngdi0v/Q175D7J3ZGoTffDDyPxnTK/oksfROajoe+ZIEgoDGXPeI/I7TTlTONuqQ6LZT5r7Q==\n \n-\"@tiptap/extension-document@^2.11.0\":\n+\"@tiptap/extension-document@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-document/-/extension-document-2.26.1.tgz#3e65e4833fee138e5afaed4be586d75db10cb8b6\"\n   integrity sha512-2P2IZp1NRAE+21mRuFBiP3X2WKfZ6kUC23NJKpn8bcOamY3obYqCt0ltGPhE4eR8n8QAl2fI/3jIgjR07dC8ow==\n \n-\"@tiptap/extension-dropcursor@^2.11.0\":\n+\"@tiptap/extension-dropcursor@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-dropcursor/-/extension-dropcursor-2.26.1.tgz#2eff232f3ab50816ba7182275f84f475a88b4443\"\n   integrity sha512-JkDQU2ZYFOuT5mNYb8OiWGwD1HcjbtmX8tLNugQbToECmz9WvVPqJmn7V/q8VGpP81iEECz/IsyRmuf2kSD4uA==\n \n@@ -2043,152 +2033,118 @@\n     emoji-regex \"^10.4.0\"\n     emojibase-data \"^15\"\n     is-emoji-supported \"^0.0.5\"\n \n-\"@tiptap/extension-floating-menu@^2.11.0\":\n+\"@tiptap/extension-floating-menu@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-floating-menu/-/extension-floating-menu-2.26.1.tgz#4be572fa98f356d44b1817cff5cd0db819f45c01\"\n   integrity sha512-OJF+H6qhQogVTMedAGSWuoL1RPe3LZYXONuFCVyzHnvvMpK+BP1vm180E2zDNFnn/DVA+FOrzNGpZW7YjoFH1w==\n   dependencies:\n     tippy.js \"^6.3.7\"\n \n-\"@tiptap/extension-gapcursor@^2.11.0\":\n+\"@tiptap/extension-gapcursor@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-gapcursor/-/extension-gapcursor-2.26.1.tgz#7a5ebd84d4495aa8403ececd1ace51d3ba9ab139\"\n   integrity sha512-KOiMZc3PwJS3hR0nSq5d0TJi2jkNZkLZElcT6pCEnhRHzPH6dRMu9GM5Jj798ZRUy0T9UFcKJalFZaDxnmRnpg==\n \n-\"@tiptap/extension-hard-break@^2.11.0\":\n+\"@tiptap/extension-hard-break@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-hard-break/-/extension-hard-break-2.26.1.tgz#70226e2b63e2252a74f6e59b5c001a4c02e0c1e5\"\n   integrity sha512-d6uStdNKi8kjPlHAyO59M6KGWATNwhLCD7dng0NXfwGndc22fthzIk/6j9F6ltQx30huy5qQram6j3JXwNACoA==\n \n-\"@tiptap/extension-heading@^2.11.0\":\n+\"@tiptap/extension-heading@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-heading/-/extension-heading-2.26.1.tgz#49d1e8f2d10eb1c06bf348d7cb9d131097d65f78\"\n   integrity sha512-KSzL8WZV3pjJG9ke4RaU70+B5UlYR2S6olNt5UCAawM+fi11mobVztiBoC19xtpSVqIXC1AmXOqUgnuSvmE4ZA==\n \n-\"@tiptap/extension-history@^2.11.0\":\n+\"@tiptap/extension-history@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-history/-/extension-history-2.26.1.tgz#de8e8a5ebf08cbbccb6dec11291128843a2d24e6\"\n   integrity sha512-m6YR1gkkauIDo3PRl0gP+7Oc4n5OqDzcjVh6LvWREmZP8nmi94hfseYbqOXUb6RPHIc0JKF02eiRifT4MSd2nw==\n \n-\"@tiptap/extension-horizontal-rule@^2.11.0\":\n+\"@tiptap/extension-horizontal-rule@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-horizontal-rule/-/extension-horizontal-rule-2.26.1.tgz#5c0c635d4444f38cb70e721d06fbe2d47a79982c\"\n   integrity sha512-mT6baqOhs/NakgrAeDeed194E/ZJFGL692H0C7f1N7WDRaWxUu2oR0LrnRqSH5OyPjELkzu6nQnNy0+0tFGHHg==\n \n-\"@tiptap/extension-image@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/extension-image/-/extension-image-2.11.0.tgz#e9611a6a032804279f9b12a483a7afe696358a3f\"\n-  integrity sha512-R+JkK5ocX35ag1c42aAw6rcb9QlLUBB0ju8A7b+8qZXN5yWKE0yO/oixYFmnZN7WSnBYtzuCVDX8cvRG+BPbgA==\n+\"@tiptap/extension-image@^2.22.3\":\n+  version \"2.26.1\"\n+  resolved \"https://registry.yarnpkg.com/@tiptap/extension-image/-/extension-image-2.26.1.tgz#1b71633f31a7c53c4570f94e1068ceb46fe93224\"\n+  integrity sha512-96+MaYBJebQlR/ik5W72GLUfXdEoxFs+6jsoERxbM5qEdhb7TEnodBFtWZOwgDO27kFd6rSNZuW9r5KJNtljEg==\n \n-\"@tiptap/extension-italic@^2.11.0\":\n+\"@tiptap/extension-italic@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-italic/-/extension-italic-2.26.1.tgz#cd798d5e410d112f70aaea2c7eb30716f4a483c6\"\n   integrity sha512-pOs6oU4LyGO89IrYE4jbE8ZYsPwMMIiKkYfXcfeD9NtpGNBnjeVXXF5I9ndY2ANrCAgC8k58C3/powDRf0T2yA==\n \n-\"@tiptap/extension-list-item@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/extension-list-item/-/extension-list-item-2.11.0.tgz#15889fd8217b998bfef78cd9079c8405b5a9abcd\"\n-  integrity sha512-Jikcg0fccpM13a3hAFLtguMcpVg4eMWI8NnC0aUULD9rFhvWZQYQYQuoK3fO6vQrAQpNhsV4oa0dfSq1btu9kg==\n-\n-\"@tiptap/extension-list-item@^2.11.0\":\n+\"@tiptap/extension-list-item@^2.22.3\", \"@tiptap/extension-list-item@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-list-item/-/extension-list-item-2.26.1.tgz#932e041245d3a696c943e9d4a32cdf59cb386e88\"\n   integrity sha512-quOXckC73Luc3x+Dcm88YAEBW+Crh3x5uvtQOQtn2GEG91AshrvbnhGRiYnfvEN7UhWIS+FYI5liHFcRKSUKrQ==\n \n-\"@tiptap/extension-mention@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/extension-mention/-/extension-mention-2.11.0.tgz#515f831975188ce33e3c0951f94a34396a3f35cd\"\n-  integrity sha512-5/Yk2rTpsoIZaNyo4f+CgsCCkQkSiNAp24HOvvCm9Dp9w1gIFm6y6dSj5RYqzEucGjOkoaBbfMcm1QxKWIj6/A==\n+\"@tiptap/extension-mention@^2.22.3\":\n+  version \"2.26.1\"\n+  resolved \"https://registry.yarnpkg.com/@tiptap/extension-mention/-/extension-mention-2.26.1.tgz#f61a77f8b3dd99b12b9aac0a9ee8041f098b3986\"\n+  integrity sha512-sBrlJ9nWjFx7oWCtt0hV192FgCBXva1zwImWbgXTCGPAjv0d5EoPymIfRgoeanAmuQjOHoKzzZnJ6bELTZhkGw==\n \n-\"@tiptap/extension-ordered-list@^2.11.0\":\n+\"@tiptap/extension-ordered-list@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-ordered-list/-/extension-ordered-list-2.26.1.tgz#81e60f4b679533b736ef0fbad4263a11e1c8465e\"\n   integrity sha512-UHKNRxq6TBnXMGFSq91knD6QaHsyyOwLOsXMzupmKM5Su0s+CRXEjfav3qKlbb9e4m7D7S/a0aPm8nC9KIXNhQ==\n \n-\"@tiptap/extension-paragraph@^2.11.0\":\n+\"@tiptap/extension-paragraph@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-paragraph/-/extension-paragraph-2.26.1.tgz#2e25f9e72fd5b4b34ca8e9e3c355303d86eae055\"\n   integrity sha512-UezvM9VDRAVJlX1tykgHWSD1g3MKfVMWWZ+Tg+PE4+kizOwoYkRWznVPgCAxjmyHajxpCKRXgqTZkOxjJ9Kjzg==\n \n-\"@tiptap/extension-placeholder@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/extension-placeholder/-/extension-placeholder-2.11.0.tgz#a330df0bc791df82b3a84490031a8db9a68f4061\"\n-  integrity sha512-ee8vz51pW6H+1rEDMFg2FnBs2Tj5rUHlJ1JgD7Dcp3+89SVHGB3UILGfbNpAnHZvhmsTY3NcfPAcZZ80QfQFMQ==\n+\"@tiptap/extension-placeholder@^2.22.3\":\n+  version \"2.26.1\"\n+  resolved \"https://registry.yarnpkg.com/@tiptap/extension-placeholder/-/extension-placeholder-2.26.1.tgz#a44280063978dfa86aad71dee6cad36c3a7862a0\"\n+  integrity sha512-MBlqbkd+63btY7Qu+SqrXvWjPwooGZDsLTtl7jp52BczBl61cq9yygglt9XpM11TFMBdySgdLHBrLtQ0B7fBlw==\n \n-\"@tiptap/extension-strike@^2.11.0\":\n+\"@tiptap/extension-strike@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-strike/-/extension-strike-2.26.1.tgz#d703acfa78455021082ccbac72b41ee9ab3f8c9b\"\n   integrity sha512-CkoRH+pAi6MgdCh7K0cVZl4N2uR4pZdabXAnFSoLZRSg6imLvEUmWHfSi1dl3Z7JOvd3a4yZ4NxerQn5MWbJ7g==\n \n-\"@tiptap/extension-task-item@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/extension-task-item/-/extension-task-item-2.11.0.tgz#ff97f10bf39d6c27fd3f3f1ee3987d7015304c11\"\n-  integrity sha512-qu6VuRc8qF80Bwr82CItFcrKtC67LJkwpxESLEIi42zWZ5sXF/3DJEPPS/4Kk+nAc9UCBoEMFAULibPq7rRl/w==\n+\"@tiptap/extension-task-item@^2.22.3\":\n+  version \"2.26.1\"\n+  resolved \"https://registry.yarnpkg.com/@tiptap/extension-task-item/-/extension-task-item-2.26.1.tgz#060535e2c0f910fca1eb7bb0aa764ca2bd4d6584\"\n+  integrity sha512-b7JNeOsBqEd1p2oQ5N6Msz9fr2o73WR1WsYDC0WhECg07Goud2gQEkwWkQaLsvfcwuS746eMJK/nrT2pVEngYA==\n \n-\"@tiptap/extension-task-list@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/extension-task-list/-/extension-task-list-2.11.0.tgz#2f197a70aafc0c23163ed70aa314cc0300534cf6\"\n-  integrity sha512-+dZRjeXLXxyliFt3J7uQADxfOwi6ntyepVM+ri1rnmIaqVZUHJbUFodOc0LivI+Z5iZZ10u3TId8gehqWJHD+w==\n+\"@tiptap/extension-task-list@^2.22.3\":\n+  version \"2.26.1\"\n+  resolved \"https://registry.yarnpkg.com/@tiptap/extension-task-list/-/extension-task-list-2.26.1.tgz#5cb01a50368a2d38aa7b1ecc90b75b74b6fd3be4\"\n+  integrity sha512-xR4LMpMPZ6bpkZNmFvIojmNGtdGKNlKFbpvyIOgs4qhlWskbFQQVevglHjV1R8xJLic5c+byJQaAmQdQudqGng==\n \n-\"@tiptap/extension-text-align@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/extension-text-align/-/extension-text-align-2.11.0.tgz#b90b86ee3f6e14c9abf186cb8ab6ced20c0df14d\"\n-  integrity sha512-VRXBqO17po6ddqhoWLBa2aCX/tqHdzdKPLfjnBy1fF8hjQKbidzjMWhb4CMm31ApvJjKK/DTkM3EnyYS/XDhng==\n+\"@tiptap/extension-text-align@^2.22.3\":\n+  version \"2.26.1\"\n+  resolved \"https://registry.yarnpkg.com/@tiptap/extension-text-align/-/extension-text-align-2.26.1.tgz#79add5084d2b9ff1c347686834f924613d6c98cb\"\n+  integrity sha512-x6mpNGELy2QtSPBoQqNgiXO9PjZoB+O2EAfXA9YRiBDSIRNOrw+7vOVpi+IgzswFmhMNgIYUVfQRud4FHUCNew==\n \n-\"@tiptap/extension-text-style@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/extension-text-style/-/extension-text-style-2.11.0.tgz#2acb6207fe6acdb5479384682846980be15caa80\"\n-  integrity sha512-vuA16wMZ6J3fboL7FObwV2f5uN9Vg0WYmqU7971vxzJyaRj9VE1eeH8Kh5fq4RgwDzc13MZGvZZV4HcE1R8o8A==\n-\n-\"@tiptap/extension-text-style@^2.11.0\":\n+\"@tiptap/extension-text-style@^2.22.3\", \"@tiptap/extension-text-style@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-text-style/-/extension-text-style-2.26.1.tgz#a6be329ff881df9da37d9a8c353b2b2e7b8508b3\"\n   integrity sha512-t9Nc/UkrbCfnSHEUi1gvUQ2ZPzvfdYFT5TExoV2DTiUCkhG6+mecT5bTVFGW3QkPmbToL+nFhGn4ZRMDD0SP3Q==\n \n-\"@tiptap/extension-text@^2.11.0\":\n+\"@tiptap/extension-text@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/extension-text/-/extension-text-2.26.1.tgz#a51a11aa446d32b136851ce5173c89ad5ff0f57a\"\n   integrity sha512-p2n8WVMd/2vckdJlol24acaTDIZAhI7qle5cM75bn01sOEZoFlSw6SwINOULrUCzNJsYb43qrLEibZb4j2LeQw==\n \n-\"@tiptap/extension-underline@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/extension-underline/-/extension-underline-2.11.0.tgz#473025d3ed01953fb2c23f8060ea90be4c231faa\"\n-  integrity sha512-DE1piq441y1+9Aj1pvvuq1dcc5B2HZ2d1SPtO4DTMjCxrhok12biTkMxxq0q1dzA5/BouLlUW6WTPpinhmrUWA==\n+\"@tiptap/extension-underline@^2.22.3\":\n+  version \"2.26.1\"\n+  resolved \"https://registry.yarnpkg.com/@tiptap/extension-underline/-/extension-underline-2.26.1.tgz#79f2eced758b5432e7b2dd764bd0d4e53e8c1721\"\n+  integrity sha512-/fufv41WDMdf0a4xmFAxONoAz08TonJXX6NEoSJmuGKO59M/Y0Pz8DTK1g32Wk44kn7dyScDiPlvvndl+UOv0A==\n \n-\"@tiptap/html@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/html/-/html-2.11.0.tgz#dd0b4195a07bbdca27aa13325b8ebac41480a6a0\"\n-  integrity sha512-9+8eSeey3gm6vMtbt+uKZfkvtwsWr577lhtTeGUsoThim9zyBnbhzHc1dQw2m1RefOoPcODrnnQPvi5nvA84Cw==\n+\"@tiptap/html@^2.22.3\":\n+  version \"2.26.1\"\n+  resolved \"https://registry.yarnpkg.com/@tiptap/html/-/html-2.26.1.tgz#61c2929d3bd5f91d22b3f43448a5e6dc369f6988\"\n+  integrity sha512-93keIjciRdjgQabxntXBjW6NTrAoM+uC/u3dwoM5CJFs40cpJC+/CEPYG7SJ5Cyv8srv/OqzyjCjoz7PQGvXyA==\n   dependencies:\n     zeed-dom \"^0.15.1\"\n \n-\"@tiptap/pm@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/pm/-/pm-2.11.0.tgz#c2ccb0c9b99fd5915d9390e90d3ab9e5fb408cd8\"\n-  integrity sha512-4RU6bpODkMY+ZshzdRFcuUc5jWlMW82LWXR6UOsHK/X/Mav41ZFS0Cyf+hQM6gxxTB09YFIICmGpEpULb+/CuA==\n-  dependencies:\n-    prosemirror-changeset \"^2.2.1\"\n-    prosemirror-collab \"^1.3.1\"\n-    prosemirror-commands \"^1.6.2\"\n-    prosemirror-dropcursor \"^1.8.1\"\n-    prosemirror-gapcursor \"^1.3.2\"\n-    prosemirror-history \"^1.4.1\"\n-    prosemirror-inputrules \"^1.4.0\"\n-    prosemirror-keymap \"^1.2.2\"\n-    prosemirror-markdown \"^1.13.1\"\n-    prosemirror-menu \"^1.2.4\"\n-    prosemirror-model \"^1.23.0\"\n-    prosemirror-schema-basic \"^1.2.3\"\n-    prosemirror-schema-list \"^1.4.1\"\n-    prosemirror-state \"^1.4.3\"\n-    prosemirror-tables \"^1.6.1\"\n-    prosemirror-trailing-node \"^3.0.0\"\n-    prosemirror-transform \"^1.10.2\"\n-    prosemirror-view \"^1.37.0\"\n-\n-\"@tiptap/pm@^2.11.0\":\n+\"@tiptap/pm@^2.22.3\", \"@tiptap/pm@^2.26.1\":\n   version \"2.26.1\"\n   resolved \"https://registry.yarnpkg.com/@tiptap/pm/-/pm-2.26.1.tgz#5e4bd79e60fe698fa12770b2845e5133b3333d06\"\n   integrity sha512-8aF+mY/vSHbGFqyG663ds84b+vca5Lge3tHdTMTKazxCnhXR9dn2oQJMnZ78YZvdRbkPkMJJHti9h3K7u2UQvw==\n   dependencies:\n@@ -2210,50 +2166,50 @@\n     prosemirror-trailing-node \"^3.0.0\"\n     prosemirror-transform \"^1.10.2\"\n     prosemirror-view \"^1.37.0\"\n \n-\"@tiptap/react@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/react/-/react-2.11.0.tgz#28b9ca64bdeb6302eaca1941ef792e3acea2e40e\"\n-  integrity sha512-AALzHbqNq/gerJpkbXmN2OXFmHAs2bQENH7rXbnH70bpxVdIfQVtvjK4dIb+cQQvAuTWZvhsISnTrFY2BesT3Q==\n+\"@tiptap/react@^2.22.3\":\n+  version \"2.26.1\"\n+  resolved \"https://registry.yarnpkg.com/@tiptap/react/-/react-2.26.1.tgz#793d035a1decd6655f40195f58a6fd873ee65c83\"\n+  integrity sha512-Zxlwzi1iML7aELa+PyysFD2ncVo2mEcjTkhoDok9iTbMGpm1oU8hgR1i6iHrcSNQLfaRiW6M7HNhZZQPKIC9yw==\n   dependencies:\n-    \"@tiptap/extension-bubble-menu\" \"^2.11.0\"\n-    \"@tiptap/extension-floating-menu\" \"^2.11.0\"\n+    \"@tiptap/extension-bubble-menu\" \"^2.26.1\"\n+    \"@tiptap/extension-floating-menu\" \"^2.26.1\"\n     \"@types/use-sync-external-store\" \"^0.0.6\"\n     fast-deep-equal \"^3\"\n     use-sync-external-store \"^1\"\n \n-\"@tiptap/starter-kit@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/starter-kit/-/starter-kit-2.11.0.tgz#3b4a9ca9daaffed3abd030d4cd72e8d9d3eb0649\"\n-  integrity sha512-lrYmkeaAFiuUjN5nGnCowdjponrsR7eRmeTf/15/5oZsNrMN7t/fvPb014AqhG/anNasa0ism4CKZns3D+4pKQ==\n+\"@tiptap/starter-kit@^2.22.3\":\n+  version \"2.26.1\"\n+  resolved \"https://registry.yarnpkg.com/@tiptap/starter-kit/-/starter-kit-2.26.1.tgz#00a19c05491a51423aabe511f624567942bd2baa\"\n+  integrity sha512-oziMGCds8SVQ3s5dRpBxVdEKZAmO/O//BjZ69mhA3q4vJdR0rnfLb5fTxSeQvHiqB878HBNn76kNaJrHrV35GA==\n   dependencies:\n-    \"@tiptap/core\" \"^2.11.0\"\n-    \"@tiptap/extension-blockquote\" \"^2.11.0\"\n-    \"@tiptap/extension-bold\" \"^2.11.0\"\n-    \"@tiptap/extension-bullet-list\" \"^2.11.0\"\n-    \"@tiptap/extension-code\" \"^2.11.0\"\n-    \"@tiptap/extension-code-block\" \"^2.11.0\"\n-    \"@tiptap/extension-document\" \"^2.11.0\"\n-    \"@tiptap/extension-dropcursor\" \"^2.11.0\"\n-    \"@tiptap/extension-gapcursor\" \"^2.11.0\"\n-    \"@tiptap/extension-hard-break\" \"^2.11.0\"\n-    \"@tiptap/extension-heading\" \"^2.11.0\"\n-    \"@tiptap/extension-history\" \"^2.11.0\"\n-    \"@tiptap/extension-horizontal-rule\" \"^2.11.0\"\n-    \"@tiptap/extension-italic\" \"^2.11.0\"\n-    \"@tiptap/extension-list-item\" \"^2.11.0\"\n-    \"@tiptap/extension-ordered-list\" \"^2.11.0\"\n-    \"@tiptap/extension-paragraph\" \"^2.11.0\"\n-    \"@tiptap/extension-strike\" \"^2.11.0\"\n-    \"@tiptap/extension-text\" \"^2.11.0\"\n-    \"@tiptap/extension-text-style\" \"^2.11.0\"\n-    \"@tiptap/pm\" \"^2.11.0\"\n+    \"@tiptap/core\" \"^2.26.1\"\n+    \"@tiptap/extension-blockquote\" \"^2.26.1\"\n+    \"@tiptap/extension-bold\" \"^2.26.1\"\n+    \"@tiptap/extension-bullet-list\" \"^2.26.1\"\n+    \"@tiptap/extension-code\" \"^2.26.1\"\n+    \"@tiptap/extension-code-block\" \"^2.26.1\"\n+    \"@tiptap/extension-document\" \"^2.26.1\"\n+    \"@tiptap/extension-dropcursor\" \"^2.26.1\"\n+    \"@tiptap/extension-gapcursor\" \"^2.26.1\"\n+    \"@tiptap/extension-hard-break\" \"^2.26.1\"\n+    \"@tiptap/extension-heading\" \"^2.26.1\"\n+    \"@tiptap/extension-history\" \"^2.26.1\"\n+    \"@tiptap/extension-horizontal-rule\" \"^2.26.1\"\n+    \"@tiptap/extension-italic\" \"^2.26.1\"\n+    \"@tiptap/extension-list-item\" \"^2.26.1\"\n+    \"@tiptap/extension-ordered-list\" \"^2.26.1\"\n+    \"@tiptap/extension-paragraph\" \"^2.26.1\"\n+    \"@tiptap/extension-strike\" \"^2.26.1\"\n+    \"@tiptap/extension-text\" \"^2.26.1\"\n+    \"@tiptap/extension-text-style\" \"^2.26.1\"\n+    \"@tiptap/pm\" \"^2.26.1\"\n \n-\"@tiptap/suggestion@2.11.0\":\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/@tiptap/suggestion/-/suggestion-2.11.0.tgz#826140c6f1a76af2d91713dafb4b142c803eabef\"\n-  integrity sha512-f+KcczhzEEy2f7/0N/RSID+Z6NjxCX6ab26NLfWZxdaEm/J+vQ2Pqh/e5Z59vMfKiC0DJXVcO0rdv2LBh23qDw==\n+\"@tiptap/suggestion@^2.22.3\":\n+  version \"2.26.1\"\n+  resolved \"https://registry.yarnpkg.com/@tiptap/suggestion/-/suggestion-2.26.1.tgz#64b567443668ff9afb5533737f877e3604ab53ae\"\n+  integrity sha512-iNWJdQN7h01keNoVwyCsdI7ZX11YkrexZjCnutWK17Dd72s3NYVTmQXu7saftwddT4nDdlczNxAFosrt0zMhcg==\n \n \"@tsconfig/node10@^1.0.7\":\n   version \"1.0.11\"\n   resolved \"https://registry.yarnpkg.com/@tsconfig/node10/-/node10-1.0.11.tgz#6ee46400685f130e278128c7b38b7e031ff5b2f2\"\n@@ -2597,11 +2553,11 @@\n   resolved \"https://registry.yarnpkg.com/@types/ms/-/ms-2.1.0.tgz#052aa67a48eccc4309d7f0191b7e41434b90bb78\"\n   integrity sha512-GsCCIZDE/p3i96vtEqx+7dBUGXrc7zeSK3wwPHIaRThS+9OhWIXRqzs4d6k1SVU8g91DrNRWxWUGhp5KXQb2VA==\n \n \"@types/node@*\":\n-  version \"24.0.13\"\n-  resolved \"https://registry.yarnpkg.com/@types/node/-/node-24.0.13.tgz#93ed8c05c7b188a59760be0ce2ee3fa7ad0f83f6\"\n-  integrity sha512-Qm9OYVOFHFYg3wJoTSrz80hoec5Lia/dPp84do3X7dZvLikQvM1YpmvTBEdIr/e+U8HTkFjLHLnl78K/qjf+jQ==\n+  version \"24.0.15\"\n+  resolved \"https://registry.yarnpkg.com/@types/node/-/node-24.0.15.tgz#f34fbc973e7d64217106e0c59ed8761e6b51381e\"\n+  integrity sha512-oaeTSbCef7U/z7rDeJA138xpG3NuKc64/rZ2qmUFkFJmnMsAPaluIifqyWd8hSSMxyP9oie3dLAqYPblag9KgA==\n   dependencies:\n     undici-types \"~7.8.0\"\n \n \"@types/node@18.14.1\":\n@@ -2619,18 +2575,18 @@\n   resolved \"https://registry.yarnpkg.com/@types/node/-/node-18.16.1.tgz#5db121e9c5352925bb1f1b892c4ae620e3526799\"\n   integrity sha512-DZxSZWXxFfOlx7k7Rv4LAyiMroaxa3Ly/7OOzZO8cBNho0YzAi4qlbrx8W27JGqG57IgR/6J7r+nOJWw6kcvZA==\n \n \"@types/node@^20.14.9\", \"@types/node@^20.5.2\":\n-  version \"20.19.7\"\n-  resolved \"https://registry.yarnpkg.com/@types/node/-/node-20.19.7.tgz#1d3656e25ec91731c1cce21889e4754ebc988b4e\"\n-  integrity sha512-1GM9z6BJOv86qkPvzh2i6VW5+VVrXxCLknfmTkWEqz+6DqosiY28XUWCTmBcJ0ACzKqx/iwdIREfo1fwExIlkA==\n+  version \"20.19.9\"\n+  resolved \"https://registry.yarnpkg.com/@types/node/-/node-20.19.9.tgz#ca9a58193fec361cc6e859d88b52261853f1f0d3\"\n+  integrity sha512-cuVNgarYWZqxRJDQHEB58GEONhOK79QVR/qYx4S7kcUObQvUwvFnYxJuuHUKm2aieN9X3yZB4LZsuYNU1Qphsw==\n   dependencies:\n     undici-types \"~6.21.0\"\n \n \"@types/node@^22.5.4\":\n-  version \"22.16.3\"\n-  resolved \"https://registry.yarnpkg.com/@types/node/-/node-22.16.3.tgz#006f83d80e6f05f65768acc77f4a57bfac1d545f\"\n-  integrity sha512-sr4Xz74KOUeYadexo1r8imhRtlVXcs+j3XK3TcoiYk7B1t3YRVJgtaD3cwX73NYb71pmVuMLNRhJ9XKdoDB74g==\n+  version \"22.16.5\"\n+  resolved \"https://registry.yarnpkg.com/@types/node/-/node-22.16.5.tgz#cc46ac3994cd957000d0c11095a0b1dae2ea2368\"\n+  integrity sha512-bJFoMATwIGaxxx8VJPeM8TonI8t579oRvgAuT8zFugJsJZgzqv0Fu8Mhp68iecjzG7cnN3mO2dJQ5uUM2EFrgQ==\n   dependencies:\n     undici-types \"~6.21.0\"\n \n \"@types/nprogress@^0.2.0\":\n@@ -2822,17 +2778,17 @@\n   resolved \"https://registry.yarnpkg.com/@types/zxcvbn/-/zxcvbn-4.4.5.tgz#8ce8623ed7a36e3a76d1c0b539708dfb2e859bc0\"\n   integrity sha512-FZJgC5Bxuqg7Rhsm/bx6gAruHHhDQ55r+s0JhDh8CQ16fD7NsJJ+p8YMMQDhSQoIrSmjpqqYWA96oQVMNkjRyA==\n \n \"@typescript-eslint/eslint-plugin@^5.4.2 || ^6.0.0 || ^7.0.0 || ^8.0.0\", \"@typescript-eslint/eslint-plugin@^8.6.0\":\n-  version \"8.36.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-8.36.0.tgz#880ce277f8a30ccf539ec027acac157088f131ae\"\n-  integrity sha512-lZNihHUVB6ZZiPBNgOQGSxUASI7UJWhT8nHyUGCnaQ28XFCw98IfrMCG3rUl1uwUWoAvodJQby2KTs79UTcrAg==\n+  version \"8.37.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-8.37.0.tgz#332392883f936137cd6252c8eb236d298e514e70\"\n+  integrity sha512-jsuVWeIkb6ggzB+wPCsR4e6loj+rM72ohW6IBn2C+5NCvfUVY8s33iFPySSVXqtm5Hu29Ne/9bnA0JmyLmgenA==\n   dependencies:\n     \"@eslint-community/regexpp\" \"^4.10.0\"\n-    \"@typescript-eslint/scope-manager\" \"8.36.0\"\n-    \"@typescript-eslint/type-utils\" \"8.36.0\"\n-    \"@typescript-eslint/utils\" \"8.36.0\"\n-    \"@typescript-eslint/visitor-keys\" \"8.36.0\"\n+    \"@typescript-eslint/scope-manager\" \"8.37.0\"\n+    \"@typescript-eslint/type-utils\" \"8.37.0\"\n+    \"@typescript-eslint/utils\" \"8.37.0\"\n+    \"@typescript-eslint/visitor-keys\" \"8.37.0\"\n     graphemer \"^1.4.0\"\n     ignore \"^7.0.0\"\n     natural-compare \"^1.4.0\"\n     ts-api-utils \"^2.1.0\"\n@@ -2853,25 +2809,25 @@\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n \"@typescript-eslint/parser@^5.4.2 || ^6.0.0 || ^7.0.0 || ^8.0.0\", \"@typescript-eslint/parser@^8.6.0\":\n-  version \"8.36.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-8.36.0.tgz#003007fe2030013936b6634b9cf52c457d36ed42\"\n-  integrity sha512-FuYgkHwZLuPbZjQHzJXrtXreJdFMKl16BFYyRrLxDhWr6Qr7Kbcu2s1Yhu8tsiMXw1S0W1pjfFfYEt+R604s+Q==\n+  version \"8.37.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-8.37.0.tgz#b87f6b61e25ad5cc5bbf8baf809b8da889c89804\"\n+  integrity sha512-kVIaQE9vrN9RLCQMQ3iyRlVJpTiDUY6woHGb30JDkfJErqrQEmtdWH3gV0PBAfGZgQXoqzXOO0T3K6ioApbbAA==\n   dependencies:\n-    \"@typescript-eslint/scope-manager\" \"8.36.0\"\n-    \"@typescript-eslint/types\" \"8.36.0\"\n-    \"@typescript-eslint/typescript-estree\" \"8.36.0\"\n-    \"@typescript-eslint/visitor-keys\" \"8.36.0\"\n+    \"@typescript-eslint/scope-manager\" \"8.37.0\"\n+    \"@typescript-eslint/types\" \"8.37.0\"\n+    \"@typescript-eslint/typescript-estree\" \"8.37.0\"\n+    \"@typescript-eslint/visitor-keys\" \"8.37.0\"\n     debug \"^4.3.4\"\n \n-\"@typescript-eslint/project-service@8.36.0\":\n-  version \"8.36.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/project-service/-/project-service-8.36.0.tgz#0c4acdcbe56476a43cdabaac1f08819424a379fd\"\n-  integrity sha512-JAhQFIABkWccQYeLMrHadu/fhpzmSQ1F1KXkpzqiVxA/iYI6UnRt2trqXHt1sYEcw1mxLnB9rKMsOxXPxowN/g==\n+\"@typescript-eslint/project-service@8.37.0\":\n+  version \"8.37.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/project-service/-/project-service-8.37.0.tgz#0594352e32a4ac9258591b88af77b5653800cdfe\"\n+  integrity sha512-BIUXYsbkl5A1aJDdYJCBAo8rCEbAvdquQ8AnLb6z5Lp1u3x5PNgSSx9A/zqYc++Xnr/0DVpls8iQ2cJs/izTXA==\n   dependencies:\n-    \"@typescript-eslint/tsconfig-utils\" \"^8.36.0\"\n-    \"@typescript-eslint/types\" \"^8.36.0\"\n+    \"@typescript-eslint/tsconfig-utils\" \"^8.37.0\"\n+    \"@typescript-eslint/types\" \"^8.37.0\"\n     debug \"^4.3.4\"\n \n \"@typescript-eslint/scope-manager@5.62.0\":\n   version \"5.62.0\"\n@@ -2880,20 +2836,20 @@\n   dependencies:\n     \"@typescript-eslint/types\" \"5.62.0\"\n     \"@typescript-eslint/visitor-keys\" \"5.62.0\"\n \n-\"@typescript-eslint/scope-manager@8.36.0\":\n-  version \"8.36.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-8.36.0.tgz#23e4196ed07d7ea3737a584fbebc9a79c3835168\"\n-  integrity sha512-wCnapIKnDkN62fYtTGv2+RY8FlnBYA3tNm0fm91kc2BjPhV2vIjwwozJ7LToaLAyb1ca8BxrS7vT+Pvvf7RvqA==\n+\"@typescript-eslint/scope-manager@8.37.0\":\n+  version \"8.37.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-8.37.0.tgz#a31a3c80ca2ef4ed58de13742debb692e7d4c0a4\"\n+  integrity sha512-0vGq0yiU1gbjKob2q691ybTg9JX6ShiVXAAfm2jGf3q0hdP6/BruaFjL/ManAR/lj05AvYCH+5bbVo0VtzmjOA==\n   dependencies:\n-    \"@typescript-eslint/types\" \"8.36.0\"\n-    \"@typescript-eslint/visitor-keys\" \"8.36.0\"\n+    \"@typescript-eslint/types\" \"8.37.0\"\n+    \"@typescript-eslint/visitor-keys\" \"8.37.0\"\n \n-\"@typescript-eslint/tsconfig-utils@8.36.0\", \"@typescript-eslint/tsconfig-utils@^8.36.0\":\n-  version \"8.36.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/tsconfig-utils/-/tsconfig-utils-8.36.0.tgz#63ef8a20ae9b5754c6ceacbe87b2fe1aab12ba13\"\n-  integrity sha512-Nhh3TIEgN18mNbdXpd5Q8mSCBnrZQeY9V7Ca3dqYvNDStNIGRmJA6dmrIPMJ0kow3C7gcQbpsG2rPzy1Ks/AnA==\n+\"@typescript-eslint/tsconfig-utils@8.37.0\", \"@typescript-eslint/tsconfig-utils@^8.37.0\":\n+  version \"8.37.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/tsconfig-utils/-/tsconfig-utils-8.37.0.tgz#47a2760d265c6125f8e7864bc5c8537cad2bd053\"\n+  integrity sha512-1/YHvAVTimMM9mmlPvTec9NP4bobA1RkDbMydxG8omqwJJLEW/Iy2C4adsAESIXU3WGLXFHSZUU+C9EoFWl4Zg==\n \n \"@typescript-eslint/type-utils@5.62.0\":\n   version \"5.62.0\"\n   resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-5.62.0.tgz#286f0389c41681376cdad96b309cedd17d70346a\"\n@@ -2903,27 +2859,28 @@\n     \"@typescript-eslint/utils\" \"5.62.0\"\n     debug \"^4.3.4\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/type-utils@8.36.0\":\n-  version \"8.36.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-8.36.0.tgz#16b092c2cbbb5549f6a4df1382a481586850502f\"\n-  integrity sha512-5aaGYG8cVDd6cxfk/ynpYzxBRZJk7w/ymto6uiyUFtdCozQIsQWh7M28/6r57Fwkbweng8qAzoMCPwSJfWlmsg==\n+\"@typescript-eslint/type-utils@8.37.0\":\n+  version \"8.37.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-8.37.0.tgz#2a682e4c6ff5886712dad57e9787b5e417124507\"\n+  integrity sha512-SPkXWIkVZxhgwSwVq9rqj/4VFo7MnWwVaRNznfQDc/xPYHjXnPfLWn+4L6FF1cAz6e7dsqBeMawgl7QjUMj4Ow==\n   dependencies:\n-    \"@typescript-eslint/typescript-estree\" \"8.36.0\"\n-    \"@typescript-eslint/utils\" \"8.36.0\"\n+    \"@typescript-eslint/types\" \"8.37.0\"\n+    \"@typescript-eslint/typescript-estree\" \"8.37.0\"\n+    \"@typescript-eslint/utils\" \"8.37.0\"\n     debug \"^4.3.4\"\n     ts-api-utils \"^2.1.0\"\n \n \"@typescript-eslint/types@5.62.0\":\n   version \"5.62.0\"\n   resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.62.0.tgz#258607e60effa309f067608931c3df6fed41fd2f\"\n   integrity sha512-87NVngcbVXUahrRTqIK27gD2t5Cu1yuCXxbLcFtCzZGlfyVWWh8mLHkoxzjsB6DDNnvdL+fW8MiwPEJyGJQDgQ==\n \n-\"@typescript-eslint/types@8.36.0\", \"@typescript-eslint/types@^8.36.0\":\n-  version \"8.36.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-8.36.0.tgz#d3d184adc2899e2912c13b17c1590486ef37c7ac\"\n-  integrity sha512-xGms6l5cTJKQPZOKM75Dl9yBfNdGeLRsIyufewnxT4vZTrjC0ImQT4fj8QmtJK84F58uSh5HVBSANwcfiXxABQ==\n+\"@typescript-eslint/types@8.37.0\", \"@typescript-eslint/types@^8.37.0\":\n+  version \"8.37.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-8.37.0.tgz#09517aa9625eb3c68941dde3ac8835740587b6ff\"\n+  integrity sha512-ax0nv7PUF9NOVPs+lmQ7yIE7IQmAf8LGcXbMvHX5Gm+YJUYNAl340XkGnrimxZ0elXyoQJuN5sbg6C4evKA4SQ==\n \n \"@typescript-eslint/typescript-estree@5.62.0\":\n   version \"5.62.0\"\n   resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-5.62.0.tgz#7d17794b77fabcac615d6a48fb143330d962eb9b\"\n@@ -2936,17 +2893,17 @@\n     is-glob \"^4.0.3\"\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/typescript-estree@8.36.0\":\n-  version \"8.36.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-8.36.0.tgz#344857fa79f71715369554a3cbb6b4ff8695a7bc\"\n-  integrity sha512-JaS8bDVrfVJX4av0jLpe4ye0BpAaUW7+tnS4Y4ETa3q7NoZgzYbN9zDQTJ8kPb5fQ4n0hliAt9tA4Pfs2zA2Hg==\n+\"@typescript-eslint/typescript-estree@8.37.0\":\n+  version \"8.37.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-8.37.0.tgz#a07e4574d8e6e4355a558f61323730c987f5fcbc\"\n+  integrity sha512-zuWDMDuzMRbQOM+bHyU4/slw27bAUEcKSKKs3hcv2aNnc/tvE/h7w60dwVw8vnal2Pub6RT1T7BI8tFZ1fE+yg==\n   dependencies:\n-    \"@typescript-eslint/project-service\" \"8.36.0\"\n-    \"@typescript-eslint/tsconfig-utils\" \"8.36.0\"\n-    \"@typescript-eslint/types\" \"8.36.0\"\n-    \"@typescript-eslint/visitor-keys\" \"8.36.0\"\n+    \"@typescript-eslint/project-service\" \"8.37.0\"\n+    \"@typescript-eslint/tsconfig-utils\" \"8.37.0\"\n+    \"@typescript-eslint/types\" \"8.37.0\"\n+    \"@typescript-eslint/visitor-keys\" \"8.37.0\"\n     debug \"^4.3.4\"\n     fast-glob \"^3.3.2\"\n     is-glob \"^4.0.3\"\n     minimatch \"^9.0.4\"\n@@ -2966,17 +2923,17 @@\n     \"@typescript-eslint/typescript-estree\" \"5.62.0\"\n     eslint-scope \"^5.1.1\"\n     semver \"^7.3.7\"\n \n-\"@typescript-eslint/utils@8.36.0\":\n-  version \"8.36.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-8.36.0.tgz#2c9af5292f14e0aa4b0e9c7ac0406afafb299acf\"\n-  integrity sha512-VOqmHu42aEMT+P2qYjylw6zP/3E/HvptRwdn/PZxyV27KhZg2IOszXod4NcXisWzPAGSS4trE/g4moNj6XmH2g==\n+\"@typescript-eslint/utils@8.37.0\":\n+  version \"8.37.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-8.37.0.tgz#189ea59b2709f5d898614611f091a776751ee335\"\n+  integrity sha512-TSFvkIW6gGjN2p6zbXo20FzCABbyUAuq6tBvNRGsKdsSQ6a7rnV6ADfZ7f4iI3lIiXc4F4WWvtUfDw9CJ9pO5A==\n   dependencies:\n     \"@eslint-community/eslint-utils\" \"^4.7.0\"\n-    \"@typescript-eslint/scope-manager\" \"8.36.0\"\n-    \"@typescript-eslint/types\" \"8.36.0\"\n-    \"@typescript-eslint/typescript-estree\" \"8.36.0\"\n+    \"@typescript-eslint/scope-manager\" \"8.37.0\"\n+    \"@typescript-eslint/types\" \"8.37.0\"\n+    \"@typescript-eslint/typescript-estree\" \"8.37.0\"\n \n \"@typescript-eslint/visitor-keys@5.62.0\":\n   version \"5.62.0\"\n   resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-5.62.0.tgz#2174011917ce582875954ffe2f6912d5931e353e\"\n@@ -2984,14 +2941,14 @@\n   dependencies:\n     \"@typescript-eslint/types\" \"5.62.0\"\n     eslint-visitor-keys \"^3.3.0\"\n \n-\"@typescript-eslint/visitor-keys@8.36.0\":\n-  version \"8.36.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-8.36.0.tgz#7dc6ba4dd037979eb3a3bdd2093aa3604bb73674\"\n-  integrity sha512-vZrhV2lRPWDuGoxcmrzRZyxAggPL+qp3WzUrlZD+slFueDiYHxeBa34dUXPuC0RmGKzl4lS5kFJYvKCq9cnNDA==\n+\"@typescript-eslint/visitor-keys@8.37.0\":\n+  version \"8.37.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-8.37.0.tgz#cdb6a6bd3e8d6dd69bd70c1bdda36e2d18737455\"\n+  integrity sha512-YzfhzcTnZVPiLfP/oeKtDp2evwvHLMe0LOy7oe+hb9KKIumLNohYS9Hgp1ifwpu42YWxhZE8yieggz6JpqO/1w==\n   dependencies:\n-    \"@typescript-eslint/types\" \"8.36.0\"\n+    \"@typescript-eslint/types\" \"8.37.0\"\n     eslint-visitor-keys \"^4.2.1\"\n \n \"@ungap/structured-clone@^1.2.0\":\n   version \"1.3.0\"\n@@ -3296,11 +3253,11 @@\n     mime-types \"~2.1.34\"\n     negotiator \"0.6.3\"\n \n acorn-import-phases@^1.0.3:\n-  version \"1.0.3\"\n-  resolved \"https://registry.yarnpkg.com/acorn-import-phases/-/acorn-import-phases-1.0.3.tgz#30394a1dccee5f380aecb8205b8c69b4f7ae688e\"\n-  integrity sha512-jtKLnfoOzm28PazuQ4dVBcE9Jeo6ha1GAJvq3N0LlNOszmTfx+wSycBehn+FN0RnyeR77IBxN/qVYMw0Rlj0Xw==\n+  version \"1.0.4\"\n+  resolved \"https://registry.yarnpkg.com/acorn-import-phases/-/acorn-import-phases-1.0.4.tgz#16eb850ba99a056cb7cbfe872ffb8972e18c8bd7\"\n+  integrity sha512-wKmbr/DDiIXzEOiWrTTUcDm24kQ2vGfZQvM2fwg2vXqR5uW6aapr7ObPtj1th32b9u90/Pf4AItvdTh42fBmVQ==\n \n acorn-jsx@^5.3.2:\n   version \"5.3.2\"\n   resolved \"https://registry.yarnpkg.com/acorn-jsx/-/acorn-jsx-5.3.2.tgz#7ed5bb55908b3b2f1bc55c6af1653bada7f07937\"\n@@ -3997,9 +3954,9 @@\n   version \"1.4.3\"\n   resolved \"https://registry.yarnpkg.com/cjs-module-lexer/-/cjs-module-lexer-1.4.3.tgz#0f79731eb8cfe1ec72acd4066efac9d61991b00d\"\n   integrity sha512-9z8TZaGM1pfswYeXrUpzPrkx8UnWYdhJclsiYMm6x/w5+nN+8Tf/LnAgfLGQCm59qAOxU8WwHEq2vNwF6i4j+Q==\n \n-class-variance-authority@^0.7.0, class-variance-authority@^0.7.1:\n+class-variance-authority@^0.7.1:\n   version \"0.7.1\"\n   resolved \"https://registry.yarnpkg.com/class-variance-authority/-/class-variance-authority-0.7.1.tgz#4008a798a0e4553a781a57ac5177c9fb5d043787\"\n   integrity sha512-Ka+9Trutv7G8M6WT6SeiRWz792K5qEqIGEGzXKhAE6xOWAY6pPH8U+9IY3oCMv6kqTmLsv7Xh/2w2RigkePMsg==\n   dependencies:\n@@ -4846,11 +4803,11 @@\n   resolved \"https://registry.yarnpkg.com/ee-first/-/ee-first-1.1.1.tgz#590c61156b0ae2f4f0255732a158b266bc56b21d\"\n   integrity sha512-WMwm9LhRUo+WUaRN+vRuETqG89IgZphVSNkdFgeb6sS/E4OrDIN7t48CAewSHXc6C8lefD8KKfr5vY61brQlow==\n \n electron-to-chromium@^1.5.173:\n-  version \"1.5.182\"\n-  resolved \"https://registry.yarnpkg.com/electron-to-chromium/-/electron-to-chromium-1.5.182.tgz#4ab73104f893938acb3ab9c28d7bec170c116b3e\"\n-  integrity sha512-Lv65Btwv9W4J9pyODI6EWpdnhfvrve/us5h1WspW8B2Fb0366REPtY3hX7ounk1CkV/TBjWCEvCBBbYbmV0qCA==\n+  version \"1.5.187\"\n+  resolved \"https://registry.yarnpkg.com/electron-to-chromium/-/electron-to-chromium-1.5.187.tgz#8c58854e065962351dc87e95614dd78d50425966\"\n+  integrity sha512-cl5Jc9I0KGUoOoSbxvTywTa40uspGJt/BDBoDLoxJRSBpWh4FFXBsjNRHfQrONsV/OoEjDfHUmZQa2d6Ze4YgA==\n \n element-resize-detector@^1.1.9:\n   version \"1.2.4\"\n   resolved \"https://registry.yarnpkg.com/element-resize-detector/-/element-resize-detector-1.2.4.tgz#3e6c5982dd77508b5fa7e6d5c02170e26325c9b1\"\n@@ -4858,11 +4815,11 @@\n   dependencies:\n     batch-processor \"1.0.0\"\n \n emoji-picker-react@^4.5.16:\n-  version \"4.13.1\"\n-  resolved \"https://registry.yarnpkg.com/emoji-picker-react/-/emoji-picker-react-4.13.1.tgz#f1d0c7624e757b30d6025cb4afe0a546511516f8\"\n-  integrity sha512-0I+8stp8/l3H/DAa8axeO/ffb7NmqSs4zlh4fW+CgQ4BsEaNiDnXFv6Ll72iZiGzvIKR4GEVVAkj3B692Ey3Gg==\n+  version \"4.13.2\"\n+  resolved \"https://registry.yarnpkg.com/emoji-picker-react/-/emoji-picker-react-4.13.2.tgz#cf2a669ae902c982b9f0b4bddc78f7cdbe6ff384\"\n+  integrity sha512-azaJQLTshEOZVhksgU136izJWJyZ4Clx6xQ6Vctzk1gOdPPAUbTa/JYDwZJ8rh97QxnjpyeftXl99eRlYr3vNA==\n   dependencies:\n     flairup \"1.0.0\"\n \n emoji-regex@^10.3.0, emoji-regex@^10.4.0:\n@@ -5150,11 +5107,11 @@\n     eslint-plugin-react \"^7.33.2\"\n     eslint-plugin-react-hooks \"^4.5.0 || 5.0.0-canary-7118f5dd7-20230705\"\n \n eslint-config-prettier@^9.1.0:\n-  version \"9.1.0\"\n-  resolved \"https://registry.yarnpkg.com/eslint-config-prettier/-/eslint-config-prettier-9.1.0.tgz#31af3d94578645966c082fcb71a5846d3c94867f\"\n-  integrity sha512-NSWl5BFQWEPi1j4TjVNItzYV7dZXZ+wP6I6ZhrBGpChQhZRUaElihE9uRRkcbRnNb76UMKDF3r+WTmNcGPKsqw==\n+  version \"9.1.2\"\n+  resolved \"https://registry.yarnpkg.com/eslint-config-prettier/-/eslint-config-prettier-9.1.2.tgz#90deb4fa0259592df774b600dbd1d2249a78ce91\"\n+  integrity sha512-iI1f+D2ViGn+uvv5HuHVUamg8ll4tN+JRHGc6IJi4TP9Kl976C57fzPXgseXNs8v0iA8aSJpHsTWjDb9QJamGQ==\n \n eslint-config-turbo@^1.12.4:\n   version \"1.13.4\"\n   resolved \"https://registry.yarnpkg.com/eslint-config-turbo/-/eslint-config-turbo-1.13.4.tgz#9c06f10c4e5d971d317baee8695fbdda24b92804\"\n@@ -5737,11 +5694,11 @@\n     semver \"^7.3.5\"\n     tapable \"^2.2.1\"\n \n form-data@^4.0.0:\n-  version \"4.0.3\"\n-  resolved \"https://registry.yarnpkg.com/form-data/-/form-data-4.0.3.tgz#608b1b3f3e28be0fccf5901fc85fb3641e5cf0ae\"\n-  integrity sha512-qsITQPfmvMOSAdeyZ+12I1c+CKSstAFAwu+97zrnWAbIr5u8wfsExUzCesVLC8NgHuRUqNN4Zy6UPWUTRGslcA==\n+  version \"4.0.4\"\n+  resolved \"https://registry.yarnpkg.com/form-data/-/form-data-4.0.4.tgz#784cdcce0669a9d68e94d11ac4eea98088edd2c4\"\n+  integrity sha512-KrGhL9Q4zjj0kiUt5OO4Mr/A/jlI2jDYs5eHBpYHPcBEVSiipAvn2Ko2HnPe20rmcuuvMHNdZFp+4IlGTMF0Ow==\n   dependencies:\n     asynckit \"^0.4.0\"\n     combined-stream \"^1.0.8\"\n     es-set-tostringtag \"^2.1.0\"\n@@ -5786,11 +5743,11 @@\n     jsonfile \"^6.0.1\"\n     universalify \"^2.0.0\"\n \n fs-monkey@^1.0.4:\n-  version \"1.0.6\"\n-  resolved \"https://registry.yarnpkg.com/fs-monkey/-/fs-monkey-1.0.6.tgz#8ead082953e88d992cf3ff844faa907b26756da2\"\n-  integrity sha512-b1FMfwetIKymC0eioW7mTywihSQE4oLzQn1dB6rZB5fx/3NpNEdAWeCSMB+60/AeT0TCXsxzAlcYVEFCTAksWg==\n+  version \"1.1.0\"\n+  resolved \"https://registry.yarnpkg.com/fs-monkey/-/fs-monkey-1.1.0.tgz#632aa15a20e71828ed56b24303363fb1414e5997\"\n+  integrity sha512-QMUezzXWII9EV5aTFXW1UBVUO77wYPpjqIF8/AviUCThNeSYZykpoTixUeaNNBwmCev0AMDWMAni+f8Hxb1IFw==\n \n fs.realpath@^1.0.0:\n   version \"1.0.0\"\n   resolved \"https://registry.yarnpkg.com/fs.realpath/-/fs.realpath-1.0.0.tgz#1504ad2523158caa40db4a2787cb01411994ea4f\"\n@@ -6813,11 +6770,11 @@\n     prelude-ls \"^1.2.1\"\n     type-check \"~0.4.0\"\n \n lib0@^0.2.109, lib0@^0.2.47, lib0@^0.2.74, lib0@^0.2.85, lib0@^0.2.87, lib0@^0.2.99:\n-  version \"0.2.109\"\n-  resolved \"https://registry.yarnpkg.com/lib0/-/lib0-0.2.109.tgz#78a4a15cfb9de489a031396c6497eefe620ca794\"\n-  integrity sha512-jP0gbnyW0kwlx1Atc4dcHkBbrVAkdHjuyHxtClUPYla7qCmwIif1qZ6vQeJdR5FrOVdn26HvQT0ko01rgW7/Xw==\n+  version \"0.2.114\"\n+  resolved \"https://registry.yarnpkg.com/lib0/-/lib0-0.2.114.tgz#0b0e55c3ffa8768fe3d9efca971059f465db4baf\"\n+  integrity sha512-gcxmNFzA4hv8UYi8j43uPlQ7CGcyMJ2KQb5kZASw6SnAKAf10hK12i2fjrS3Cl/ugZa5Ui6WwIu1/6MIXiHttQ==\n   dependencies:\n     isomorphic.js \"^0.2.4\"\n \n lilconfig@^3.0.0, lilconfig@^3.1.1, lilconfig@^3.1.3:\n@@ -7493,11 +7450,11 @@\n   resolved \"https://registry.yarnpkg.com/napi-build-utils/-/napi-build-utils-2.0.0.tgz#13c22c0187fcfccce1461844136372a47ddc027e\"\n   integrity sha512-GEbrYkbfF7MoNaoh2iGG84Mnf/WZfB0GdGEsM8wz7Expx/LlWf5U8t9nvJKXSp3qr5IsEbK04cBGhol/KwOsWA==\n \n napi-postinstall@^0.3.0:\n-  version \"0.3.0\"\n-  resolved \"https://registry.yarnpkg.com/napi-postinstall/-/napi-postinstall-0.3.0.tgz#888e51d1fb500e86dcf6ace1baccdbb377e654ce\"\n-  integrity sha512-M7NqKyhODKV1gRLdkwE7pDsZP2/SC2a2vHkOYh9MCpKMbWVfyVfUw5MaH83Fv6XMjxr5jryUp3IDDL9rlxsTeA==\n+  version \"0.3.2\"\n+  resolved \"https://registry.yarnpkg.com/napi-postinstall/-/napi-postinstall-0.3.2.tgz#03c62080e88b311c4d7423b0f15f0c920bbcc626\"\n+  integrity sha512-tWVJxJHmBWLy69PvO96TZMZDrzmw5KeiZBz3RHmiM2XZ9grBJ2WgMAFVVg25nqp3ZjTFUs2Ftw1JhscL3Teliw==\n \n natural-compare-lite@^1.4.0:\n   version \"1.4.0\"\n   resolved \"https://registry.yarnpkg.com/natural-compare-lite/-/natural-compare-lite-1.4.0.tgz#17b09581988979fddafe0201e931ba933c96cbb4\"\n@@ -7986,11 +7943,11 @@\n   resolved \"https://registry.yarnpkg.com/picomatch/-/picomatch-2.3.1.tgz#3ba3833733646d9d3e4995946c1365a67fb07a42\"\n   integrity sha512-JU3teHTNjmE2VCGFzuY8EXzCDVwEqB2a8fsIvwaStHhAWJEeVd1o1QD80CU6+ZdEXXSLbSsuLwJjkCBWqRQUVA==\n \n picomatch@^4.0.2:\n-  version \"4.0.2\"\n-  resolved \"https://registry.yarnpkg.com/picomatch/-/picomatch-4.0.2.tgz#77c742931e8f3b8820946c76cd0c1f13730d1dab\"\n-  integrity sha512-M7BAV6Rlcy5u+m6oPhAPFgJTzAioX/6B0DxyvDlo9l8+T3nLKbrczg2WLUyzd45L8RqfUMyGPzekbMvX2Ldkwg==\n+  version \"4.0.3\"\n+  resolved \"https://registry.yarnpkg.com/picomatch/-/picomatch-4.0.3.tgz#796c76136d1eead715db1e7bad785dedd695a042\"\n+  integrity sha512-5gTmgEY/sqK6gFXLIsQNH19lWb4ebPDLA4SdLP7dsWkIXHWlG66oPuVvXSGFPppYZz8ZDZq0dYYrbHfBCVUb1Q==\n \n pify@^2.3.0:\n   version \"2.3.0\"\n   resolved \"https://registry.yarnpkg.com/pify/-/pify-2.3.0.tgz#ed141a6ac043a849ea588498e7dca8b15330e90c\"\n@@ -8352,9 +8309,9 @@\n   version \"6.5.0\"\n   resolved \"https://registry.yarnpkg.com/property-information/-/property-information-6.5.0.tgz#6212fbb52ba757e92ef4fb9d657563b933b7ffec\"\n   integrity sha512-PgTgs/BlvHxOu8QuEN7wi5A0OmXaBcHpmCSTehcs6Uuu9IkDIEo13Hy7n898RHfrQ49vKCoGeWZSaAK01nwVig==\n \n-prosemirror-changeset@^2.2.1, prosemirror-changeset@^2.3.0:\n+prosemirror-changeset@^2.3.0:\n   version \"2.3.1\"\n   resolved \"https://registry.yarnpkg.com/prosemirror-changeset/-/prosemirror-changeset-2.3.1.tgz#eee3299cfabc7a027694e9abdc4e85505e9dd5e7\"\n   integrity sha512-j0kORIBm8ayJNl3zQvD1TTPHJX3g042et6y/KQhZhnPrruO8exkTgG8X+NRpj7kIyMMEx74Xb3DyMIBtO0IKkQ==\n   dependencies:\n@@ -8476,9 +8433,9 @@\n     prosemirror-model \"^1.0.0\"\n     prosemirror-transform \"^1.0.0\"\n     prosemirror-view \"^1.27.0\"\n \n-prosemirror-tables@^1.6.1, prosemirror-tables@^1.6.4:\n+prosemirror-tables@^1.6.4:\n   version \"1.7.1\"\n   resolved \"https://registry.yarnpkg.com/prosemirror-tables/-/prosemirror-tables-1.7.1.tgz#df2507f285c6c7563097b4904cb7c4b9e0cd724b\"\n   integrity sha512-eRQ97Bf+i9Eby99QbyAiyov43iOKgWa7QCGly+lrDt7efZ1v8NWolhXiB43hSDGIXT1UXgbs4KJN3a06FGpr1Q==\n   dependencies:\n@@ -8502,14 +8459,9 @@\n   integrity sha512-pwDy22nAnGqNR1feOQKHxoFkkUtepoFAd3r2hbEDsnf4wp57kKA36hXsB3njA9FtONBEwSDnDeCiJe+ItD+ykw==\n   dependencies:\n     prosemirror-model \"^1.21.0\"\n \n-prosemirror-utils@^1.2.2:\n-  version \"1.2.2\"\n-  resolved \"https://registry.yarnpkg.com/prosemirror-utils/-/prosemirror-utils-1.2.2.tgz#21ff3777e7b9b22b9ec8d7ded7d15b9aeeb1d008\"\n-  integrity sha512-7a2MPf99oCW8/587rQYI1/snX71Ban40+apr1hLkY8TmU9YXd7JeR6QsmktcTisJURO3WRjxIia4lTMsYgZVOw==\n-\n-prosemirror-view@^1.0.0, prosemirror-view@^1.1.0, prosemirror-view@^1.27.0, prosemirror-view@^1.31.0, prosemirror-view@^1.37.0, prosemirror-view@^1.39.1:\n+prosemirror-view@1.40.0, prosemirror-view@^1.0.0, prosemirror-view@^1.1.0, prosemirror-view@^1.27.0, prosemirror-view@^1.31.0, prosemirror-view@^1.37.0, prosemirror-view@^1.39.1:\n   version \"1.40.0\"\n   resolved \"https://registry.yarnpkg.com/prosemirror-view/-/prosemirror-view-1.40.0.tgz#212e627a0c4f0198ac9823a1232e0099c9a92865\"\n   integrity sha512-2G3svX0Cr1sJjkD/DYWSe3cfV5VPVTBOxI9XQEGWJDFEpsZb/gh4MV29ctv+OJx2RFX4BLt09i+6zaGM/ldkCw==\n   dependencies:\n@@ -9086,34 +9038,34 @@\n   dependencies:\n     glob \"^7.1.3\"\n \n rollup@^4.34.8:\n-  version \"4.45.0\"\n-  resolved \"https://registry.yarnpkg.com/rollup/-/rollup-4.45.0.tgz#92d1b164eca1c6f2cb399ae7a1a8ee78967b6e33\"\n-  integrity sha512-WLjEcJRIo7i3WDDgOIJqVI2d+lAC3EwvOGy+Xfq6hs+GQuAA4Di/H72xmXkOhrIWFg2PFYSKZYfH0f4vfKXN4A==\n+  version \"4.45.1\"\n+  resolved \"https://registry.yarnpkg.com/rollup/-/rollup-4.45.1.tgz#d0ef72a8d0a9210d832f9c3c5f3b6a2aa4b0ba64\"\n+  integrity sha512-4iya7Jb76fVpQyLoiVpzUrsjQ12r3dM7fIVz+4NwoYvZOShknRmiv+iu9CClZml5ZLGb0XMcYLutK6w9tgxHDw==\n   dependencies:\n     \"@types/estree\" \"1.0.8\"\n   optionalDependencies:\n-    \"@rollup/rollup-android-arm-eabi\" \"4.45.0\"\n-    \"@rollup/rollup-android-arm64\" \"4.45.0\"\n-    \"@rollup/rollup-darwin-arm64\" \"4.45.0\"\n-    \"@rollup/rollup-darwin-x64\" \"4.45.0\"\n-    \"@rollup/rollup-freebsd-arm64\" \"4.45.0\"\n-    \"@rollup/rollup-freebsd-x64\" \"4.45.0\"\n-    \"@rollup/rollup-linux-arm-gnueabihf\" \"4.45.0\"\n-    \"@rollup/rollup-linux-arm-musleabihf\" \"4.45.0\"\n-    \"@rollup/rollup-linux-arm64-gnu\" \"4.45.0\"\n-    \"@rollup/rollup-linux-arm64-musl\" \"4.45.0\"\n-    \"@rollup/rollup-linux-loongarch64-gnu\" \"4.45.0\"\n-    \"@rollup/rollup-linux-powerpc64le-gnu\" \"4.45.0\"\n-    \"@rollup/rollup-linux-riscv64-gnu\" \"4.45.0\"\n-    \"@rollup/rollup-linux-riscv64-musl\" \"4.45.0\"\n-    \"@rollup/rollup-linux-s390x-gnu\" \"4.45.0\"\n-    \"@rollup/rollup-linux-x64-gnu\" \"4.45.0\"\n-    \"@rollup/rollup-linux-x64-musl\" \"4.45.0\"\n-    \"@rollup/rollup-win32-arm64-msvc\" \"4.45.0\"\n-    \"@rollup/rollup-win32-ia32-msvc\" \"4.45.0\"\n-    \"@rollup/rollup-win32-x64-msvc\" \"4.45.0\"\n+    \"@rollup/rollup-android-arm-eabi\" \"4.45.1\"\n+    \"@rollup/rollup-android-arm64\" \"4.45.1\"\n+    \"@rollup/rollup-darwin-arm64\" \"4.45.1\"\n+    \"@rollup/rollup-darwin-x64\" \"4.45.1\"\n+    \"@rollup/rollup-freebsd-arm64\" \"4.45.1\"\n+    \"@rollup/rollup-freebsd-x64\" \"4.45.1\"\n+    \"@rollup/rollup-linux-arm-gnueabihf\" \"4.45.1\"\n+    \"@rollup/rollup-linux-arm-musleabihf\" \"4.45.1\"\n+    \"@rollup/rollup-linux-arm64-gnu\" \"4.45.1\"\n+    \"@rollup/rollup-linux-arm64-musl\" \"4.45.1\"\n+    \"@rollup/rollup-linux-loongarch64-gnu\" \"4.45.1\"\n+    \"@rollup/rollup-linux-powerpc64le-gnu\" \"4.45.1\"\n+    \"@rollup/rollup-linux-riscv64-gnu\" \"4.45.1\"\n+    \"@rollup/rollup-linux-riscv64-musl\" \"4.45.1\"\n+    \"@rollup/rollup-linux-s390x-gnu\" \"4.45.1\"\n+    \"@rollup/rollup-linux-x64-gnu\" \"4.45.1\"\n+    \"@rollup/rollup-linux-x64-musl\" \"4.45.1\"\n+    \"@rollup/rollup-win32-arm64-msvc\" \"4.45.1\"\n+    \"@rollup/rollup-win32-ia32-msvc\" \"4.45.1\"\n+    \"@rollup/rollup-win32-x64-msvc\" \"4.45.1\"\n     fsevents \"~2.3.2\"\n \n rope-sequence@^1.3.0:\n   version \"1.3.4\"\n@@ -9580,26 +9532,17 @@\n     text-decoder \"^1.1.0\"\n   optionalDependencies:\n     bare-events \"^2.2.0\"\n \n-\"string-width-cjs@npm:string-width@^4.2.0\":\n+\"string-width-cjs@npm:string-width@^4.2.0\", string-width@^4.1.0, string-width@^4.2.0, string-width@^4.2.3:\n   version \"4.2.3\"\n   resolved \"https://registry.yarnpkg.com/string-width/-/string-width-4.2.3.tgz#269c7117d27b05ad2e536830a8ec895ef9c6d010\"\n   integrity sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==\n   dependencies:\n     emoji-regex \"^8.0.0\"\n     is-fullwidth-code-point \"^3.0.0\"\n     strip-ansi \"^6.0.1\"\n \n-string-width@^4.1.0, string-width@^4.2.0, string-width@^4.2.3:\n-  version \"4.2.3\"\n-  resolved \"https://registry.yarnpkg.com/string-width/-/string-width-4.2.3.tgz#269c7117d27b05ad2e536830a8ec895ef9c6d010\"\n-  integrity sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==\n-  dependencies:\n-    emoji-regex \"^8.0.0\"\n-    is-fullwidth-code-point \"^3.0.0\"\n-    strip-ansi \"^6.0.1\"\n-\n string-width@^5.0.1, string-width@^5.1.2:\n   version \"5.1.2\"\n   resolved \"https://registry.yarnpkg.com/string-width/-/string-width-5.1.2.tgz#14f8daec6d81e7221d2a357e668cab73bdbca794\"\n   integrity sha512-HnLOCR3vjcY8beoNLtcjZ5/nxn2afmME6lhrDrebokqMap+XbeW8n9TXpPDOqdGK5qcI3oT0GKTW6wC7EMiVqA==\n@@ -9682,22 +9625,15 @@\n   integrity sha512-hkRX8U1WjJFd8LsDJ2yQ/wWWxaopEsABU1XfkM8A+j0+85JAGppt16cr1Whg6KIbb4okU6Mql6BOj+uup/wKeA==\n   dependencies:\n     safe-buffer \"~5.2.0\"\n \n-\"strip-ansi-cjs@npm:strip-ansi@^6.0.1\":\n+\"strip-ansi-cjs@npm:strip-ansi@^6.0.1\", strip-ansi@^6.0.0, strip-ansi@^6.0.1:\n   version \"6.0.1\"\n   resolved \"https://registry.yarnpkg.com/strip-ansi/-/strip-ansi-6.0.1.tgz#9e26c63d30f53443e9489495b2105d37b67a85d9\"\n   integrity sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==\n   dependencies:\n     ansi-regex \"^5.0.1\"\n \n-strip-ansi@^6.0.0, strip-ansi@^6.0.1:\n-  version \"6.0.1\"\n-  resolved \"https://registry.yarnpkg.com/strip-ansi/-/strip-ansi-6.0.1.tgz#9e26c63d30f53443e9489495b2105d37b67a85d9\"\n-  integrity sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==\n-  dependencies:\n-    ansi-regex \"^5.0.1\"\n-\n strip-ansi@^7.0.1, strip-ansi@^7.1.0:\n   version \"7.1.0\"\n   resolved \"https://registry.yarnpkg.com/strip-ansi/-/strip-ansi-7.1.0.tgz#d5b6568ca689d8561370b0707685d22434faff45\"\n   integrity sha512-iq6eVVI64nQQTRYq2KtEg2d2uU7LElhTJwsH4YzIHZshxlgZms/wIc4VoDQTlG/IvVIrBKG06CrZnp0qv7hkcQ==\n@@ -10186,49 +10122,49 @@\n   integrity sha512-McnNiV1l8RYeY8tBgEpuodCC1mLUdbSN+CYBL7kJsJNInOP8UjDDEwdk6Mw60vdLLrr5NHKZhMAOSrR2NZuQ+w==\n   dependencies:\n     safe-buffer \"^5.0.1\"\n \n-turbo-darwin-64@2.5.4:\n-  version \"2.5.4\"\n-  resolved \"https://registry.yarnpkg.com/turbo-darwin-64/-/turbo-darwin-64-2.5.4.tgz#f03b3f071365c626d05e84d0d4b9db96348f2951\"\n-  integrity sha512-ah6YnH2dErojhFooxEzmvsoZQTMImaruZhFPfMKPBq8sb+hALRdvBNLqfc8NWlZq576FkfRZ/MSi4SHvVFT9PQ==\n+turbo-darwin-64@2.5.5:\n+  version \"2.5.5\"\n+  resolved \"https://registry.yarnpkg.com/turbo-darwin-64/-/turbo-darwin-64-2.5.5.tgz#96a9f4f0acd61e48685c5be1765fa3a0c9be120d\"\n+  integrity sha512-RYnTz49u4F5tDD2SUwwtlynABNBAfbyT2uU/brJcyh5k6lDLyNfYKdKmqd3K2ls4AaiALWrFKVSBsiVwhdFNzQ==\n \n-turbo-darwin-arm64@2.5.4:\n-  version \"2.5.4\"\n-  resolved \"https://registry.yarnpkg.com/turbo-darwin-arm64/-/turbo-darwin-arm64-2.5.4.tgz#614becf281da75af5a01094373f380ac2b48190a\"\n-  integrity sha512-2+Nx6LAyuXw2MdXb7pxqle3MYignLvS7OwtsP9SgtSBaMlnNlxl9BovzqdYAgkUW3AsYiQMJ/wBRb7d+xemM5A==\n+turbo-darwin-arm64@2.5.5:\n+  version \"2.5.5\"\n+  resolved \"https://registry.yarnpkg.com/turbo-darwin-arm64/-/turbo-darwin-arm64-2.5.5.tgz#2d8e47e1b04d2cb339455adb64fb52c94e587a44\"\n+  integrity sha512-Tk+ZeSNdBobZiMw9aFypQt0DlLsWSFWu1ymqsAdJLuPoAH05qCfYtRxE1pJuYHcJB5pqI+/HOxtJoQ40726Btw==\n \n-turbo-linux-64@2.5.4:\n-  version \"2.5.4\"\n-  resolved \"https://registry.yarnpkg.com/turbo-linux-64/-/turbo-linux-64-2.5.4.tgz#fc7425f35feb19a8373e7926eccdd4a3b2fb77a4\"\n-  integrity sha512-5May2kjWbc8w4XxswGAl74GZ5eM4Gr6IiroqdLhXeXyfvWEdm2mFYCSWOzz0/z5cAgqyGidF1jt1qzUR8hTmOA==\n+turbo-linux-64@2.5.5:\n+  version \"2.5.5\"\n+  resolved \"https://registry.yarnpkg.com/turbo-linux-64/-/turbo-linux-64-2.5.5.tgz#3f8512243d9fa0927d677235d720c07540bf66e8\"\n+  integrity sha512-2/XvMGykD7VgsvWesZZYIIVXMlgBcQy+ZAryjugoTcvJv8TZzSU/B1nShcA7IAjZ0q7OsZ45uP2cOb8EgKT30w==\n \n-turbo-linux-arm64@2.5.4:\n-  version \"2.5.4\"\n-  resolved \"https://registry.yarnpkg.com/turbo-linux-arm64/-/turbo-linux-arm64-2.5.4.tgz#ab5418a88089e4ec20b2c28c3d3c6b8a99b07a81\"\n-  integrity sha512-/2yqFaS3TbfxV3P5yG2JUI79P7OUQKOUvAnx4MV9Bdz6jqHsHwc9WZPpO4QseQm+NvmgY6ICORnoVPODxGUiJg==\n+turbo-linux-arm64@2.5.5:\n+  version \"2.5.5\"\n+  resolved \"https://registry.yarnpkg.com/turbo-linux-arm64/-/turbo-linux-arm64-2.5.5.tgz#705dc5fdaed6b2c8cc9cd35bbd154ed16e4a78d3\"\n+  integrity sha512-DW+8CjCjybu0d7TFm9dovTTVg1VRnlkZ1rceO4zqsaLrit3DgHnN4to4uwyuf9s2V/BwS3IYcRy+HG9BL596Iw==\n \n-turbo-windows-64@2.5.4:\n-  version \"2.5.4\"\n-  resolved \"https://registry.yarnpkg.com/turbo-windows-64/-/turbo-windows-64-2.5.4.tgz#fc78585d3950e5cd64bed8d6648f078e7f32f9a5\"\n-  integrity sha512-EQUO4SmaCDhO6zYohxIjJpOKRN3wlfU7jMAj3CgcyTPvQR/UFLEKAYHqJOnJtymbQmiiM/ihX6c6W6Uq0yC7mA==\n+turbo-windows-64@2.5.5:\n+  version \"2.5.5\"\n+  resolved \"https://registry.yarnpkg.com/turbo-windows-64/-/turbo-windows-64-2.5.5.tgz#70c7937e59d1a48391c4ed300b28d0e58ea22073\"\n+  integrity sha512-q5p1BOy8ChtSZfULuF1BhFMYIx6bevXu4fJ+TE/hyNfyHJIfjl90Z6jWdqAlyaFLmn99X/uw+7d6T/Y/dr5JwQ==\n \n-turbo-windows-arm64@2.5.4:\n-  version \"2.5.4\"\n-  resolved \"https://registry.yarnpkg.com/turbo-windows-arm64/-/turbo-windows-arm64-2.5.4.tgz#5134537cc9fa27f4647f2f899b7ba2dacfc6ad22\"\n-  integrity sha512-oQ8RrK1VS8lrxkLriotFq+PiF7iiGgkZtfLKF4DDKsmdbPo0O9R2mQxm7jHLuXraRCuIQDWMIw6dpcr7Iykf4A==\n+turbo-windows-arm64@2.5.5:\n+  version \"2.5.5\"\n+  resolved \"https://registry.yarnpkg.com/turbo-windows-arm64/-/turbo-windows-arm64-2.5.5.tgz#0ab29d38fcc67ba38652f1cd273df49177cb55b8\"\n+  integrity sha512-AXbF1KmpHUq3PKQwddMGoKMYhHsy5t1YBQO8HZ04HLMR0rWv9adYlQ8kaeQJTko1Ay1anOBFTqaxfVOOsu7+1Q==\n \n turbo@^2.5.4:\n-  version \"2.5.4\"\n-  resolved \"https://registry.yarnpkg.com/turbo/-/turbo-2.5.4.tgz#e46213a4560b94e56c014e0fd56d06605de16753\"\n-  integrity sha512-kc8ZibdRcuWUG1pbYSBFWqmIjynlD8Lp7IB6U3vIzvOv9VG+6Sp8bzyeBWE3Oi8XV5KsQrznyRTBPvrf99E4mA==\n+  version \"2.5.5\"\n+  resolved \"https://registry.yarnpkg.com/turbo/-/turbo-2.5.5.tgz#6057f87c1262acdfa30cf16d4cf74629623f36c9\"\n+  integrity sha512-eZ7wI6KjtT1eBqCnh2JPXWNUAxtoxxfi6VdBdZFvil0ychCOTxbm7YLRBi1JSt7U3c+u3CLxpoPxLdvr/Npr3A==\n   optionalDependencies:\n-    turbo-darwin-64 \"2.5.4\"\n-    turbo-darwin-arm64 \"2.5.4\"\n-    turbo-linux-64 \"2.5.4\"\n-    turbo-linux-arm64 \"2.5.4\"\n-    turbo-windows-64 \"2.5.4\"\n-    turbo-windows-arm64 \"2.5.4\"\n+    turbo-darwin-64 \"2.5.5\"\n+    turbo-darwin-arm64 \"2.5.5\"\n+    turbo-linux-64 \"2.5.5\"\n+    turbo-linux-arm64 \"2.5.5\"\n+    turbo-windows-64 \"2.5.5\"\n+    turbo-windows-arm64 \"2.5.5\"\n \n tween-functions@^1.2.0:\n   version \"1.2.0\"\n   resolved \"https://registry.yarnpkg.com/tween-functions/-/tween-functions-1.2.0.tgz#1ae3a50e7c60bb3def774eac707acbca73bbc3ff\"\n@@ -10705,11 +10641,11 @@\n   resolved \"https://registry.yarnpkg.com/webpack-virtual-modules/-/webpack-virtual-modules-0.6.2.tgz#057faa9065c8acf48f24cb57ac0e77739ab9a7e8\"\n   integrity sha512-66/V2i5hQanC51vBQKPH4aI8NMAcBW59FVBs+rC7eGHupMyfn34q7rZIE+ETlJ+XTevqfUhVVBgSUNSW2flEUQ==\n \n webpack@5:\n-  version \"5.100.1\"\n-  resolved \"https://registry.yarnpkg.com/webpack/-/webpack-5.100.1.tgz#d8a7e7761d253b961248ed9ed7661c51698593de\"\n-  integrity sha512-YJB/ESPUe2Locd0NKXmw72Dx8fZQk1gTzI6rc9TAT4+Sypbnhl8jd8RywB1bDsDF9Dy1RUR7gn3q/ZJTd0OZZg==\n+  version \"5.100.2\"\n+  resolved \"https://registry.yarnpkg.com/webpack/-/webpack-5.100.2.tgz#e2341facf9f7de1d702147c91bcb65b693adf9e8\"\n+  integrity sha512-QaNKAvGCDRh3wW1dsDjeMdDXwZm2vqq3zn6Pvq4rHOEOGSaUMgOOjG2Y9ZbIGzpfkJk9ZYTHpDqgDfeBDcnLaw==\n   dependencies:\n     \"@types/eslint-scope\" \"^3.7.7\"\n     \"@types/estree\" \"^1.0.8\"\n     \"@types/json-schema\" \"^7.0.15\"\n@@ -10873,26 +10809,17 @@\n   version \"1.2.5\"\n   resolved \"https://registry.yarnpkg.com/word-wrap/-/word-wrap-1.2.5.tgz#d2c45c6dd4fbce621a66f136cbe328afd0410b34\"\n   integrity sha512-BN22B5eaMMI9UMtjrGd5g5eCYPpCPDUy0FJXbYsaT5zYxjFOckS53SQDE3pWkVoWpHXVb3BrYcEN4Twa55B5cA==\n \n-\"wrap-ansi-cjs@npm:wrap-ansi@^7.0.0\":\n+\"wrap-ansi-cjs@npm:wrap-ansi@^7.0.0\", wrap-ansi@^7.0.0:\n   version \"7.0.0\"\n   resolved \"https://registry.yarnpkg.com/wrap-ansi/-/wrap-ansi-7.0.0.tgz#67e145cff510a6a6984bdf1152911d69d2eb9e43\"\n   integrity sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt/Fi7D16Q==\n   dependencies:\n     ansi-styles \"^4.0.0\"\n     string-width \"^4.1.0\"\n     strip-ansi \"^6.0.0\"\n \n-wrap-ansi@^7.0.0:\n-  version \"7.0.0\"\n-  resolved \"https://registry.yarnpkg.com/wrap-ansi/-/wrap-ansi-7.0.0.tgz#67e145cff510a6a6984bdf1152911d69d2eb9e43\"\n-  integrity sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt/Fi7D16Q==\n-  dependencies:\n-    ansi-styles \"^4.0.0\"\n-    string-width \"^4.1.0\"\n-    strip-ansi \"^6.0.0\"\n-\n wrap-ansi@^8.1.0:\n   version \"8.1.0\"\n   resolved \"https://registry.yarnpkg.com/wrap-ansi/-/wrap-ansi-8.1.0.tgz#56dc22368ee570face1b49819975d9b9a5ead214\"\n   integrity sha512-si7QWI6zUMq56bESFvagtmzMdGOtoxfR+Sez11Mobfc7tm+VkUckk9bW2UeffTGVUbOksxmSw0AA2gs8g71NCQ==\n"
        }
      ]
    },
    {
      "id": "implement-read-replica",
      "sha": "84879ee3bdf52e3a8bd3c78f3615429a249d1e40",
      "parentSha": "b1162395ed455d65e48c80a3df142e214ac9775a",
      "spec": "Implement read-replica routing across the Django/DRF API with request-scoped control, middleware, and opt-in views.\n\nScope and behavior\n- Add request-scoped control for selecting read-replica vs primary DB for the duration of a request. GET/HEAD/OPTIONS should route to a replica only when the view explicitly opts in; all writes must use the primary DB. Context must be isolated per request and cleaned up even on exceptions.\n- Introduce a Django DB router that consults the request-scoped flag to choose the 'replica' database for reads when enabled; always route writes/migrations to 'default'.\n- Add a middleware that:\n  - For non-read-only methods (POST/PUT/PATCH/DELETE): sets primary DB immediately.\n  - For read-only methods (GET/HEAD/OPTIONS): inspects the view's use_read_replica attribute (on function-based view, view_class, or cls for DRF) to decide whether to use a replica; if no attribute is found, default to primary DB.\n  - Always clears the request-scoped context in a finally block and in process_exception.\n- Create a DRF mixin that provides a use_read_replica flag for views. Base API/ViewSet classes must include this mixin but default to use_read_replica = False so endpoints explicitly opt in.\n- Settings must conditionally enable the feature using environment variables. When ENABLE_READ_REPLICA=1, configure a 'replica' database from DATABASE_READ_REPLICA_URL or individual POSTGRES_READ_REPLICA_* vars, register the DB router, and append the middleware.\n- Opt in the specified read endpoints by setting use_read_replica = True on those classes.\n- Add unit tests covering middleware init, routing on read/write, attribute detection across FBV/CBV/DRF wrappers, exception cleanup, and integration behavior.\n\nFiles to create\n1) apps/api/plane/utils/core/request_scope.py\n- Provide request-scoped helpers: set_use_read_replica(bool), should_use_read_replica() -> bool, clear_read_replica_context().\n- Use asgiref.local.Local to maintain context per request. Default behavior of should_use_read_replica() is False.\n\n2) apps/api/plane/utils/core/dbrouters.py\n- Implement ReadReplicaRouter with:\n  - db_for_read: return 'replica' when should_use_read_replica() is True, else 'default'.\n  - db_for_write: always return 'default'.\n  - allow_migrate: only allow on 'default'.\n\n3) apps/api/plane/utils/core/mixins/view.py\n- Implement ReadReplicaControlMixin with attribute use_read_replica: bool = True and docstring stating it only affects read-only methods and is honored by the middleware.\n\n4) apps/api/plane/utils/core/__init__.py\n- Export: ReadReplicaRouter, ReadReplicaControlMixin, set_use_read_replica, should_use_read_replica, clear_read_replica_context.\n\n5) apps/api/plane/middleware/db_routing.py\n- Implement ReadReplicaRoutingMiddleware with:\n  - READ_ONLY_METHODS = {\"GET\", \"HEAD\", \"OPTIONS\"}\n  - __call__: for write methods, set_use_read_replica(False), then call get_response; always clear_read_replica_context() in finally.\n  - process_view: for read-only methods, determine use_read_replica via helper that checks view_func.use_read_replica, view_func.view_class.use_read_replica, or view_func.cls.use_read_replica. If None, default to False. Call set_use_read_replica accordingly.\n  - process_exception: call clear_read_replica_context(); return None.\n\nSettings\n6) apps/api/plane/settings/common.py\n- When ENABLE_READ_REPLICA == '1':\n  - Ensure DATABASES['replica'] is set from DATABASE_READ_REPLICA_URL if present, else from POSTGRES_READ_REPLICA_DB, USER, PASSWORD, HOST, PORT (default 5432).\n  - Set DATABASE_ROUTERS = [\"plane.utils.core.dbrouters.ReadReplicaRouter\"].\n  - Append \"plane.middleware.db_routing.ReadReplicaRoutingMiddleware\" to MIDDLEWARE.\n\nBase view integration\n7) apps/api/plane/api/views/base.py\n- Import ReadReplicaControlMixin.\n- Update BaseAPIView to inherit ReadReplicaControlMixin and set use_read_replica = False.\n\n8) apps/api/plane/app/views/base.py\n- Import ReadReplicaControlMixin.\n- Update BaseViewSet and BaseAPIView to inherit ReadReplicaControlMixin and set use_read_replica = False.\n\nOpt-in endpoints (set use_read_replica = True)\n9) apps/api/plane/api/views/asset.py\n- GenericAssetEndpoint: use_read_replica = True.\n\n10) apps/api/plane/api/views/cycle.py\n- CycleListCreateAPIEndpoint, CycleDetailAPIEndpoint, CycleArchiveUnarchiveAPIEndpoint, CycleIssueListCreateAPIEndpoint, CycleIssueDetailAPIEndpoint: use_read_replica = True.\n\n11) apps/api/plane/api/views/intake.py\n- IntakeIssueListCreateAPIEndpoint, IntakeIssueDetailAPIEndpoint: use_read_replica = True.\n\n12) apps/api/plane/api/views/issue.py\n- WorkspaceIssueAPIEndpoint, IssueListCreateAPIEndpoint, IssueDetailAPIEndpoint: use_read_replica = True.\n- LabelListCreateAPIEndpoint, LabelDetailAPIEndpoint: use_read_replica = True.\n- IssueLinkListCreateAPIEndpoint, IssueLinkDetailAPIEndpoint: use_read_replica = True.\n- IssueCommentListCreateAPIEndpoint, IssueCommentDetailAPIEndpoint (all occurrences): use_read_replica = True.\n- IssueActivityListAPIEndpoint, IssueActivityDetailAPIEndpoint: use_read_replica = True.\n- IssueAttachmentListCreateAPIEndpoint, IssueAttachmentDetailAPIEndpoint: use_read_replica = True.\n- IssueSearchEndpoint: use_read_replica = True.\n\n13) apps/api/plane/api/views/member.py\n- WorkspaceMemberAPIEndpoint, ProjectMemberAPIEndpoint: use_read_replica = True.\n\n14) apps/api/plane/api/views/module.py\n- ModuleListCreateAPIEndpoint, ModuleDetailAPIEndpoint, ModuleIssueListCreateAPIEndpoint, ModuleIssueDetailAPIEndpoint, ModuleArchiveUnarchiveAPIEndpoint: use_read_replica = True.\n\n15) apps/api/plane/api/views/project.py\n- ProjectListCreateAPIEndpoint, ProjectDetailAPIEndpoint: use_read_replica = True.\n\n16) apps/api/plane/api/views/state.py\n- StateListCreateAPIEndpoint, StateDetailAPIEndpoint: use_read_replica = True.\n\n17) apps/api/plane/app/views/issue/activity.py\n- IssueActivityEndpoint: use_read_replica = True.\n\n18) apps/api/plane/app/views/notification/base.py\n- UnreadNotificationEndpoint: use_read_replica = True.\n\n19) apps/api/plane/app/views/project/base.py\n- ProjectViewSet: use_read_replica = True.\n\n20) apps/api/plane/app/views/project/member.py\n- UserProjectRolesEndpoint: use_read_replica = True.\n\n21) apps/api/plane/app/views/user/base.py\n- UserEndpoint: use_read_replica = True.\n\n22) apps/api/plane/app/views/workspace/base.py\n- UserWorkSpacesEndpoint: use_read_replica = True.\n\n23) apps/api/plane/app/views/workspace/estimate.py\n- WorkspaceEstimatesEndpoint: use_read_replica = True.\n\n24) apps/api/plane/app/views/workspace/favorite.py\n- WorkspaceFavoriteEndpoint: use_read_replica = True.\n\n25) apps/api/plane/app/views/workspace/label.py\n- WorkspaceLabelsEndpoint: use_read_replica = True.\n\n26) apps/api/plane/app/views/workspace/member.py\n- WorkSpaceMemberViewSet and WorkspaceMemberUserEndpoint: use_read_replica = True.\n\n27) apps/api/plane/app/views/workspace/quick_link.py\n- QuickLinkViewSet: use_read_replica = True.\n\n28) apps/api/plane/app/views/workspace/recent_visit.py\n- UserRecentVisitViewSet: use_read_replica = True.\n\n29) apps/api/plane/app/views/workspace/state.py\n- WorkspaceStatesEndpoint: use_read_replica = True.\n\n30) apps/api/plane/app/views/workspace/sticky.py\n- WorkspaceStickyViewSet: use_read_replica = True.\n\n31) apps/api/plane/app/views/workspace/user_preference.py\n- WorkspaceUserPreferenceViewSet: use_read_replica = True.\n\nUnit tests\n32) apps/api/plane/tests/unit/middleware/test_db_routing.py\n- Add pytest tests covering: middleware initialization, routing decisions for read/write, process_view behavior for use_read_replica=True/False/missing, attribute resolution across FBV/CBV/DRF, truthy/falsy handling of attribute values, context cleanup in finally and process_exception, and a basic integration path across __call__ and process_view.\n- Add empty package file apps/api/plane/tests/unit/middleware/__init__.py.\n\nNon-functional constraints\n- No code should attempt to use the replica unless ENABLE_READ_REPLICA=1 is set. The router and middleware should only activate under that condition via settings. Reads default to primary when no explicit view opt-in is present. Writes always go to primary. All request-scoped state must be cleaned up after each request to prevent cross-request leakage.",
      "prompt": "Add read-replica support to the Django/DRF API. The system should send reads to a replica only for endpoints that explicitly opt in, while all writes and any non-opted-in reads should go to the primary database. Make the feature toggled by environment variables, use request-scoped context to carry the routing decision for the duration of a request, and ensure context is cleaned up even when exceptions occur. Provide a mixin so views can opt in or out easily, wire a database router and middleware to enforce routing, default base API/ViewSet classes to the primary by default, update selected read-only endpoints to opt in, and add unit tests that verify middleware behavior and attribute detection across different types of views.",
      "supplementalFiles": [
        "apps/api/plane/plane/urls.py",
        "apps/api/plane/plane/asgi.py",
        "apps/api/plane/plane/wsgi.py",
        "apps/api/plane/manage.py",
        "apps/api/plane/utils/exception_logger.py",
        "apps/api/plane/utils/paginator.py",
        "apps/api/plane/pytest.ini",
        "apps/api/plane/run_tests.py"
      ],
      "fileDiffs": [
        {
          "path": "apps/api/plane/api/views/asset.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/asset.py\n===================================================================\n--- apps/api/plane/api/views/asset.py\tb116239 (parent)\n+++ apps/api/plane/api/views/asset.py\t84879ee (commit)\n@@ -404,8 +404,10 @@\n \n class GenericAssetEndpoint(BaseAPIView):\n     \"\"\"This endpoint is used to upload generic assets that can be later bound to entities.\"\"\"\n \n+    use_read_replica = True\n+\n     @asset_docs(\n         operation_id=\"get_generic_asset\",\n         summary=\"Get presigned URL for asset download\",\n         description=\"Get presigned URL for asset download\",\n"
        },
        {
          "path": "apps/api/plane/api/views/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/base.py\n===================================================================\n--- apps/api/plane/api/views/base.py\tb116239 (parent)\n+++ apps/api/plane/api/views/base.py\t84879ee (commit)\n@@ -19,8 +19,9 @@\n from plane.api.middleware.api_authentication import APIKeyAuthentication\n from plane.api.rate_limit import ApiKeyRateThrottle, ServiceTokenRateThrottle\n from plane.utils.exception_logger import log_exception\n from plane.utils.paginator import BasePaginator\n+from plane.utils.core.mixins import ReadReplicaControlMixin\n \n \n class TimezoneMixin:\n     \"\"\"\n@@ -35,13 +36,17 @@\n         else:\n             timezone.deactivate()\n \n \n-class BaseAPIView(TimezoneMixin, GenericAPIView, BasePaginator):\n+class BaseAPIView(\n+    TimezoneMixin, GenericAPIView, ReadReplicaControlMixin, BasePaginator\n+):\n     authentication_classes = [APIKeyAuthentication]\n \n     permission_classes = [IsAuthenticated]\n \n+    use_read_replica = False\n+\n     def filter_queryset(self, queryset):\n         for backend in list(self.filter_backends):\n             queryset = backend().filter_queryset(self.request, queryset, self)\n         return queryset\n"
        },
        {
          "path": "apps/api/plane/api/views/cycle.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/cycle.py\n===================================================================\n--- apps/api/plane/api/views/cycle.py\tb116239 (parent)\n+++ apps/api/plane/api/views/cycle.py\t84879ee (commit)\n@@ -85,8 +85,9 @@\n     serializer_class = CycleSerializer\n     model = Cycle\n     webhook_event = \"cycle\"\n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             Cycle.objects.filter(workspace__slug=self.kwargs.get(\"slug\"))\n@@ -372,8 +373,9 @@\n     serializer_class = CycleSerializer\n     model = Cycle\n     webhook_event = \"cycle\"\n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             Cycle.objects.filter(workspace__slug=self.kwargs.get(\"slug\"))\n@@ -632,8 +634,9 @@\n class CycleArchiveUnarchiveAPIEndpoint(BaseAPIView):\n     \"\"\"Cycle Archive and Unarchive Endpoint\"\"\"\n \n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             Cycle.objects.filter(workspace__slug=self.kwargs.get(\"slug\"))\n@@ -830,8 +833,9 @@\n     serializer_class = CycleIssueSerializer\n     model = CycleIssue\n     webhook_event = \"cycle_issue\"\n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             CycleIssue.objects.annotate(\n@@ -1044,8 +1048,9 @@\n     model = CycleIssue\n     webhook_event = \"cycle_issue\"\n     bulk = True\n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             CycleIssue.objects.annotate(\n"
        },
        {
          "path": "apps/api/plane/api/views/intake.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/intake.py\n===================================================================\n--- apps/api/plane/api/views/intake.py\tb116239 (parent)\n+++ apps/api/plane/api/views/intake.py\t84879ee (commit)\n@@ -50,10 +50,12 @@\n class IntakeIssueListCreateAPIEndpoint(BaseAPIView):\n     \"\"\"Intake Work Item List and Create Endpoint\"\"\"\n \n     serializer_class = IntakeIssueSerializer\n+\n     model = Intake\n     permission_classes = [ProjectLitePermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         intake = Intake.objects.filter(\n             workspace__slug=self.kwargs.get(\"slug\"),\n@@ -213,8 +215,9 @@\n     permission_classes = [ProjectLitePermission]\n \n     serializer_class = IntakeIssueSerializer\n     model = IntakeIssue\n+    use_read_replica = True\n \n     filterset_fields = [\"status\"]\n \n     def get_queryset(self):\n"
        },
        {
          "path": "apps/api/plane/api/views/issue.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/issue.py\n===================================================================\n--- apps/api/plane/api/views/issue.py\tb116239 (parent)\n+++ apps/api/plane/api/views/issue.py\t84879ee (commit)\n@@ -155,8 +155,9 @@\n     model = Issue\n     webhook_event = \"issue\"\n     permission_classes = [ProjectEntityPermission]\n     serializer_class = IssueSerializer\n+    use_read_replica = True\n \n     @property\n     def project_identifier(self):\n         return self.kwargs.get(\"project_identifier\", None)\n@@ -230,8 +231,9 @@\n     model = Issue\n     webhook_event = \"issue\"\n     permission_classes = [ProjectEntityPermission]\n     serializer_class = IssueSerializer\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             Issue.issue_objects.annotate(\n@@ -494,8 +496,9 @@\n     model = Issue\n     webhook_event = \"issue\"\n     permission_classes = [ProjectEntityPermission]\n     serializer_class = IssueSerializer\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             Issue.issue_objects.annotate(\n@@ -821,8 +824,9 @@\n \n     serializer_class = LabelSerializer\n     model = Label\n     permission_classes = [ProjectMemberPermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             Label.objects.filter(workspace__slug=self.kwargs.get(\"slug\"))\n@@ -948,8 +952,9 @@\n \n     serializer_class = LabelSerializer\n     model = Label\n     permission_classes = [ProjectMemberPermission]\n+    use_read_replica = True\n \n     @label_docs(\n         operation_id=\"get_labels\",\n         description=\"Retrieve details of a specific label.\",\n@@ -1056,8 +1061,9 @@\n \n     serializer_class = IssueLinkSerializer\n     model = IssueLink\n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             IssueLink.objects.filter(workspace__slug=self.kwargs.get(\"slug\"))\n@@ -1162,8 +1168,9 @@\n     permission_classes = [ProjectEntityPermission]\n \n     model = IssueLink\n     serializer_class = IssueLinkSerializer\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             IssueLink.objects.filter(workspace__slug=self.kwargs.get(\"slug\"))\n@@ -1318,8 +1325,9 @@\n     serializer_class = IssueCommentSerializer\n     model = IssueComment\n     webhook_event = \"issue_comment\"\n     permission_classes = [ProjectLitePermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             IssueComment.objects.filter(workspace__slug=self.kwargs.get(\"slug\"))\n@@ -1476,8 +1484,9 @@\n     serializer_class = IssueCommentSerializer\n     model = IssueComment\n     webhook_event = \"issue_comment\"\n     permission_classes = [ProjectLitePermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             IssueComment.objects.filter(workspace__slug=self.kwargs.get(\"slug\"))\n@@ -1656,8 +1665,9 @@\n \n \n class IssueActivityListAPIEndpoint(BaseAPIView):\n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     @issue_activity_docs(\n         operation_id=\"list_work_item_activities\",\n         description=\"Retrieve all activities for a work item. Supports filtering by activity type and date range.\",\n@@ -1711,8 +1721,9 @@\n class IssueActivityDetailAPIEndpoint(BaseAPIView):\n     \"\"\"Issue Activity Detail Endpoint\"\"\"\n \n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     @issue_activity_docs(\n         operation_id=\"retrieve_work_item_activity\",\n         description=\"Retrieve details of a specific activity.\",\n@@ -1769,8 +1780,9 @@\n \n     serializer_class = IssueAttachmentSerializer\n     model = FileAsset\n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     @issue_attachment_docs(\n         operation_id=\"create_work_item_attachment\",\n         description=\"Generate presigned URL for uploading file attachments to a work item.\",\n@@ -1976,8 +1988,9 @@\n \n     serializer_class = IssueAttachmentSerializer\n     permission_classes = [ProjectEntityPermission]\n     model = FileAsset\n+    use_read_replica = True\n \n     @issue_attachment_docs(\n         operation_id=\"delete_work_item_attachment\",\n         description=\"Permanently remove an attachment from a work item. Records deletion activity for audit purposes.\",\n@@ -2145,8 +2158,10 @@\n \n class IssueSearchEndpoint(BaseAPIView):\n     \"\"\"Endpoint to search across multiple fields in the issues\"\"\"\n \n+    use_read_replica = True\n+\n     @extend_schema(\n         operation_id=\"search_work_items\",\n         tags=[\"Work Items\"],\n         description=\"Perform semantic search across issue names, sequence IDs, and project identifiers.\",\n"
        },
        {
          "path": "apps/api/plane/api/views/member.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/member.py\n===================================================================\n--- apps/api/plane/api/views/member.py\tb116239 (parent)\n+++ apps/api/plane/api/views/member.py\t84879ee (commit)\n@@ -23,11 +23,10 @@\n )\n \n \n class WorkspaceMemberAPIEndpoint(BaseAPIView):\n-    permission_classes = [\n-        WorkSpaceAdminPermission,\n-    ]\n+    permission_classes = [WorkSpaceAdminPermission]\n+    use_read_replica = True\n \n     @extend_schema(\n         operation_id=\"get_workspace_members\",\n         summary=\"List workspace members\",\n@@ -91,8 +90,9 @@\n \n # API endpoint to get and insert users inside the workspace\n class ProjectMemberAPIEndpoint(BaseAPIView):\n     permission_classes = [ProjectMemberPermission]\n+    use_read_replica = True\n \n     @extend_schema(\n         operation_id=\"get_project_members\",\n         summary=\"List project members\",\n"
        },
        {
          "path": "apps/api/plane/api/views/module.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/module.py\n===================================================================\n--- apps/api/plane/api/views/module.py\tb116239 (parent)\n+++ apps/api/plane/api/views/module.py\t84879ee (commit)\n@@ -79,8 +79,9 @@\n     serializer_class = ModuleSerializer\n     model = Module\n     webhook_event = \"module\"\n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             Module.objects.filter(project_id=self.kwargs.get(\"project_id\"))\n@@ -281,8 +282,9 @@\n     model = Module\n     permission_classes = [ProjectEntityPermission]\n     serializer_class = ModuleSerializer\n     webhook_event = \"module\"\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             Module.objects.filter(project_id=self.kwargs.get(\"project_id\"))\n@@ -549,8 +551,9 @@\n     serializer_class = ModuleIssueSerializer\n     model = ModuleIssue\n     webhook_event = \"module_issue\"\n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             ModuleIssue.objects.annotate(\n@@ -768,8 +771,9 @@\n     serializer_class = ModuleIssueSerializer\n     model = ModuleIssue\n     webhook_event = \"module_issue\"\n     bulk = True\n+    use_read_replica = True\n \n     permission_classes = [ProjectEntityPermission]\n \n     def get_queryset(self):\n@@ -915,8 +919,9 @@\n \n \n class ModuleArchiveUnarchiveAPIEndpoint(BaseAPIView):\n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             Module.objects.filter(project_id=self.kwargs.get(\"project_id\"))\n"
        },
        {
          "path": "apps/api/plane/api/views/project.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/project.py\n===================================================================\n--- apps/api/plane/api/views/project.py\tb116239 (parent)\n+++ apps/api/plane/api/views/project.py\t84879ee (commit)\n@@ -66,8 +66,9 @@\n     serializer_class = ProjectSerializer\n     model = Project\n     webhook_event = \"project\"\n     permission_classes = [ProjectBasePermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             Project.objects.filter(workspace__slug=self.kwargs.get(\"slug\"))\n@@ -330,8 +331,9 @@\n     model = Project\n     webhook_event = \"project\"\n \n     permission_classes = [ProjectBasePermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             Project.objects.filter(workspace__slug=self.kwargs.get(\"slug\"))\n"
        },
        {
          "path": "apps/api/plane/api/views/state.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/api/views/state.py\n===================================================================\n--- apps/api/plane/api/views/state.py\tb116239 (parent)\n+++ apps/api/plane/api/views/state.py\t84879ee (commit)\n@@ -37,8 +37,9 @@\n \n     serializer_class = StateSerializer\n     model = State\n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             State.objects.filter(workspace__slug=self.kwargs.get(\"slug\"))\n@@ -163,8 +164,9 @@\n \n     serializer_class = StateSerializer\n     model = State\n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return (\n             State.objects.filter(workspace__slug=self.kwargs.get(\"slug\"))\n"
        },
        {
          "path": "apps/api/plane/app/views/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/base.py\n===================================================================\n--- apps/api/plane/app/views/base.py\tb116239 (parent)\n+++ apps/api/plane/app/views/base.py\t84879ee (commit)\n@@ -23,8 +23,9 @@\n # Module imports\n from plane.authentication.session import BaseSessionAuthentication\n from plane.utils.exception_logger import log_exception\n from plane.utils.paginator import BasePaginator\n+from plane.utils.core.mixins import ReadReplicaControlMixin\n \n \n class TimezoneMixin:\n     \"\"\"\n@@ -39,9 +40,9 @@\n         else:\n             timezone.deactivate()\n \n \n-class BaseViewSet(TimezoneMixin, ModelViewSet, BasePaginator):\n+class BaseViewSet(TimezoneMixin, ReadReplicaControlMixin, ModelViewSet, BasePaginator):\n     model = None\n \n     permission_classes = [IsAuthenticated]\n \n@@ -52,8 +53,10 @@\n     filterset_fields = []\n \n     search_fields = []\n \n+    use_read_replica = False\n+\n     def get_queryset(self):\n         try:\n             return self.model.objects.all()\n         except Exception as e:\n@@ -148,9 +151,9 @@\n         ]\n         return expand if expand else None\n \n \n-class BaseAPIView(TimezoneMixin, APIView, BasePaginator):\n+class BaseAPIView(TimezoneMixin, ReadReplicaControlMixin, APIView, BasePaginator):\n     permission_classes = [IsAuthenticated]\n \n     filter_backends = (DjangoFilterBackend, SearchFilter)\n \n@@ -159,8 +162,10 @@\n     filterset_fields = []\n \n     search_fields = []\n \n+    use_read_replica = False\n+\n     def filter_queryset(self, queryset):\n         for backend in list(self.filter_backends):\n             queryset = backend().filter_queryset(self.request, queryset, self)\n         return queryset\n"
        },
        {
          "path": "apps/api/plane/app/views/issue/activity.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/issue/activity.py\n===================================================================\n--- apps/api/plane/app/views/issue/activity.py\tb116239 (parent)\n+++ apps/api/plane/app/views/issue/activity.py\t84879ee (commit)\n@@ -18,8 +18,9 @@\n \n \n class IssueActivityEndpoint(BaseAPIView):\n     permission_classes = [ProjectEntityPermission]\n+    use_read_replica = True\n \n     @method_decorator(gzip_page)\n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n     def get(self, request, slug, project_id, issue_id):\n"
        },
        {
          "path": "apps/api/plane/app/views/notification/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/notification/base.py\n===================================================================\n--- apps/api/plane/app/views/notification/base.py\tb116239 (parent)\n+++ apps/api/plane/app/views/notification/base.py\t84879ee (commit)\n@@ -231,8 +231,10 @@\n         return Response(serializer.data, status=status.HTTP_200_OK)\n \n \n class UnreadNotificationEndpoint(BaseAPIView):\n+    use_read_replica = True\n+\n     @allow_permission(\n         allowed_roles=[ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST], level=\"WORKSPACE\"\n     )\n     def get(self, request, slug):\n"
        },
        {
          "path": "apps/api/plane/app/views/project/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/project/base.py\n===================================================================\n--- apps/api/plane/app/views/project/base.py\tb116239 (parent)\n+++ apps/api/plane/app/views/project/base.py\t84879ee (commit)\n@@ -45,8 +45,9 @@\n class ProjectViewSet(BaseViewSet):\n     serializer_class = ProjectListSerializer\n     model = Project\n     webhook_event = \"project\"\n+    use_read_replica = True\n \n     def get_queryset(self):\n         sort_order = ProjectMember.objects.filter(\n             member=self.request.user,\n"
        },
        {
          "path": "apps/api/plane/app/views/project/member.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/project/member.py\n===================================================================\n--- apps/api/plane/app/views/project/member.py\tb116239 (parent)\n+++ apps/api/plane/app/views/project/member.py\t84879ee (commit)\n@@ -311,8 +311,9 @@\n \n \n class UserProjectRolesEndpoint(BaseAPIView):\n     permission_classes = [WorkspaceUserPermission]\n+    use_read_replica = True\n \n     def get(self, request, slug):\n         project_members = ProjectMember.objects.filter(\n             workspace__slug=slug,\n"
        },
        {
          "path": "apps/api/plane/app/views/user/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/user/base.py\n===================================================================\n--- apps/api/plane/app/views/user/base.py\tb116239 (parent)\n+++ apps/api/plane/app/views/user/base.py\t84879ee (commit)\n@@ -43,8 +43,9 @@\n \n class UserEndpoint(BaseViewSet):\n     serializer_class = UserSerializer\n     model = User\n+    use_read_replica = True\n \n     def get_object(self):\n         return self.request.user\n \n"
        },
        {
          "path": "apps/api/plane/app/views/workspace/base.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/workspace/base.py\n===================================================================\n--- apps/api/plane/app/views/workspace/base.py\tb116239 (parent)\n+++ apps/api/plane/app/views/workspace/base.py\t84879ee (commit)\n@@ -176,8 +176,9 @@\n \n class UserWorkSpacesEndpoint(BaseAPIView):\n     search_fields = [\"name\"]\n     filterset_fields = [\"owner\"]\n+    use_read_replica = True\n \n     def get(self, request):\n         fields = [field for field in request.GET.get(\"fields\", \"\").split(\",\") if field]\n         member_count = (\n"
        },
        {
          "path": "apps/api/plane/app/views/workspace/estimate.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/workspace/estimate.py\n===================================================================\n--- apps/api/plane/app/views/workspace/estimate.py\tb116239 (parent)\n+++ apps/api/plane/app/views/workspace/estimate.py\t84879ee (commit)\n@@ -11,8 +11,9 @@\n \n \n class WorkspaceEstimatesEndpoint(BaseAPIView):\n     permission_classes = [WorkspaceEntityPermission]\n+    use_read_replica = True\n \n     @cache_response(60 * 60 * 2)\n     def get(self, request, slug):\n         estimate_ids = Project.objects.filter(\n"
        },
        {
          "path": "apps/api/plane/app/views/workspace/favorite.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/workspace/favorite.py\n===================================================================\n--- apps/api/plane/app/views/workspace/favorite.py\tb116239 (parent)\n+++ apps/api/plane/app/views/workspace/favorite.py\t84879ee (commit)\n@@ -13,8 +13,10 @@\n from plane.app.permissions import allow_permission, ROLE\n \n \n class WorkspaceFavoriteEndpoint(BaseAPIView):\n+    use_read_replica = True\n+\n     @allow_permission(allowed_roles=[ROLE.ADMIN, ROLE.MEMBER], level=\"WORKSPACE\")\n     def get(self, request, slug):\n         # the second filter is to check if the user is a member of the project\n         favorites = UserFavorite.objects.filter(\n"
        },
        {
          "path": "apps/api/plane/app/views/workspace/label.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/workspace/label.py\n===================================================================\n--- apps/api/plane/app/views/workspace/label.py\tb116239 (parent)\n+++ apps/api/plane/app/views/workspace/label.py\t84879ee (commit)\n@@ -11,8 +11,9 @@\n \n \n class WorkspaceLabelsEndpoint(BaseAPIView):\n     permission_classes = [WorkspaceViewerPermission]\n+    use_read_replica = True\n \n     @cache_response(60 * 60 * 2)\n     def get(self, request, slug):\n         labels = Label.objects.filter(\n"
        },
        {
          "path": "apps/api/plane/app/views/workspace/member.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/workspace/member.py\n===================================================================\n--- apps/api/plane/app/views/workspace/member.py\tb116239 (parent)\n+++ apps/api/plane/app/views/workspace/member.py\t84879ee (commit)\n@@ -27,8 +27,9 @@\n     serializer_class = WorkspaceMemberAdminSerializer\n     model = WorkspaceMember\n \n     search_fields = [\"member__display_name\", \"member__first_name\"]\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return self.filter_queryset(\n             super()\n@@ -213,8 +214,10 @@\n         return Response(status=status.HTTP_204_NO_CONTENT)\n \n \n class WorkspaceMemberUserEndpoint(BaseAPIView):\n+    use_read_replica = True\n+\n     def get(self, request, slug):\n         draft_issue_count = (\n             DraftIssue.objects.filter(\n                 created_by=request.user, workspace_id=OuterRef(\"workspace_id\")\n"
        },
        {
          "path": "apps/api/plane/app/views/workspace/quick_link.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/workspace/quick_link.py\n===================================================================\n--- apps/api/plane/app/views/workspace/quick_link.py\tb116239 (parent)\n+++ apps/api/plane/app/views/workspace/quick_link.py\t84879ee (commit)\n@@ -10,8 +10,9 @@\n \n \n class QuickLinkViewSet(BaseViewSet):\n     model = WorkspaceUserLink\n+    use_read_replica = True\n \n     def get_serializer_class(self):\n         return WorkspaceUserLinkSerializer\n \n"
        },
        {
          "path": "apps/api/plane/app/views/workspace/recent_visit.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/workspace/recent_visit.py\n===================================================================\n--- apps/api/plane/app/views/workspace/recent_visit.py\tb116239 (parent)\n+++ apps/api/plane/app/views/workspace/recent_visit.py\t84879ee (commit)\n@@ -11,8 +11,9 @@\n \n \n class UserRecentVisitViewSet(BaseViewSet):\n     model = UserRecentVisit\n+    use_read_replica = True\n \n     def get_serializer_class(self):\n         return WorkspaceRecentVisitSerializer\n \n"
        },
        {
          "path": "apps/api/plane/app/views/workspace/state.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/workspace/state.py\n===================================================================\n--- apps/api/plane/app/views/workspace/state.py\tb116239 (parent)\n+++ apps/api/plane/app/views/workspace/state.py\t84879ee (commit)\n@@ -12,8 +12,9 @@\n \n \n class WorkspaceStatesEndpoint(BaseAPIView):\n     permission_classes = [WorkspaceEntityPermission]\n+    use_read_replica = True\n \n     @cache_response(60 * 60 * 2)\n     def get(self, request, slug):\n         states = State.objects.filter(\n"
        },
        {
          "path": "apps/api/plane/app/views/workspace/sticky.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/workspace/sticky.py\n===================================================================\n--- apps/api/plane/app/views/workspace/sticky.py\tb116239 (parent)\n+++ apps/api/plane/app/views/workspace/sticky.py\t84879ee (commit)\n@@ -11,8 +11,9 @@\n \n class WorkspaceStickyViewSet(BaseViewSet):\n     serializer_class = StickySerializer\n     model = Sticky\n+    use_read_replica = True\n \n     def get_queryset(self):\n         return self.filter_queryset(\n             super()\n"
        },
        {
          "path": "apps/api/plane/app/views/workspace/user_preference.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/app/views/workspace/user_preference.py\n===================================================================\n--- apps/api/plane/app/views/workspace/user_preference.py\tb116239 (parent)\n+++ apps/api/plane/app/views/workspace/user_preference.py\t84879ee (commit)\n@@ -12,8 +12,9 @@\n \n \n class WorkspaceUserPreferenceViewSet(BaseAPIView):\n     model = WorkspaceUserPreference\n+    use_read_replica = True\n \n     def get_serializer_class(self):\n         return WorkspaceUserPreferenceSerializer\n \n"
        },
        {
          "path": "apps/api/plane/middleware/db_routing.py",
          "status": "added",
          "diff": "Index: apps/api/plane/middleware/db_routing.py\n===================================================================\n--- apps/api/plane/middleware/db_routing.py\tb116239 (parent)\n+++ apps/api/plane/middleware/db_routing.py\t84879ee (commit)\n@@ -0,0 +1,162 @@\n+\"\"\"\n+Database routing middleware for read replica selection.\n+This middleware determines whether database queries should be routed to\n+read replicas or the primary database based on HTTP method and view configuration.\n+\"\"\"\n+\n+import logging\n+from typing import Callable, Optional\n+\n+from django.http import HttpRequest, HttpResponse\n+\n+from plane.utils.core import (\n+    set_use_read_replica,\n+    clear_read_replica_context,\n+)\n+\n+logger = logging.getLogger(\"plane.api\")\n+\n+\n+class ReadReplicaRoutingMiddleware:\n+    \"\"\"\n+    Middleware for intelligent database routing to read replicas.\n+    Routing Logic:\n+    • Non-GET requests (POST, PUT, DELETE, PATCH) ➜ Primary database\n+    • GET requests:\n+        - View has use_read_replica=False ➜ Primary database\n+        - View has use_read_replica=True ➜ Read replica\n+        - View has no use_read_replica attribute ➜ Primary database (safe default)\n+    The middleware supports both Django CBVs and DRF APIViews/ViewSets.\n+    Context is properly isolated per request to prevent data leakage.\n+    \"\"\"\n+\n+    # HTTP methods that are considered read-only by default\n+    READ_ONLY_METHODS = {\"GET\", \"HEAD\", \"OPTIONS\"}\n+\n+    def __init__(self, get_response):\n+        \"\"\"\n+        Initialize the middleware with the next middleware/view in the chain.\n+        Args:\n+            get_response: The next middleware or view function\n+        \"\"\"\n+        self.get_response = get_response\n+\n+    def __call__(self, request: HttpRequest) -> HttpResponse:\n+        \"\"\"\n+        Process the request and determine database routing.\n+        Args:\n+            request: The HTTP request object\n+        Returns:\n+            HttpResponse: The HTTP response from the view\n+        \"\"\"\n+        # For non-read operations, set primary database immediately\n+        if request.method not in self.READ_ONLY_METHODS:\n+            set_use_read_replica(False)\n+            logger.debug(f\"Routing {request.method} {request.path} to primary database\")\n+\n+        try:\n+            # Process the request through the middleware chain\n+            response = self.get_response(request)\n+            return response\n+        finally:\n+            # Always clean up context, even if an exception occurs\n+            # This prevents context leakage between requests\n+            clear_read_replica_context()\n+\n+    def process_view(\n+        self,\n+        request: HttpRequest,\n+        view_func: Callable,\n+        view_args: tuple,\n+        view_kwargs: dict,\n+    ) -> None:\n+        \"\"\"\n+        Hook called just before Django calls the view.\n+        This is more efficient than resolving URLs in __call__ since Django\n+        provides the view function directly.\n+        Args:\n+            request: The HTTP request object\n+            view_func: The view function to be called\n+            view_args: Positional arguments for the view\n+            view_kwargs: Keyword arguments for the view\n+        \"\"\"\n+        # Only process read operations (write operations already handled in __call__)\n+        if request.method in self.READ_ONLY_METHODS:\n+            use_replica = self._should_use_read_replica(view_func)\n+            set_use_read_replica(use_replica)\n+\n+            db_type = \"read replica\" if use_replica else \"primary database\"\n+            logger.debug(f\"Routing {request.method} {request.path} to {db_type}\")\n+\n+        # Return None to continue normal request processing\n+        return None\n+\n+    def _should_use_read_replica(self, view_func: Callable) -> bool:\n+        \"\"\"\n+        Determine if the view should use read replica based on its configuration.\n+        Args:\n+            view_func: The view function to inspect\n+        Returns:\n+            bool: True if should use read replica, False for primary database\n+        \"\"\"\n+        use_replica_attr = self._get_use_replica_attribute(view_func)\n+\n+        # Default to primary database for GET requests if no explicit setting\n+        # This ensures only views that explicitly opt-in use read replicas\n+        if use_replica_attr is None:\n+            return False\n+\n+        return bool(use_replica_attr)\n+\n+    def _get_use_replica_attribute(self, view_func: Callable) -> Optional[bool]:\n+        \"\"\"\n+        Extract the use_read_replica attribute from various view types.\n+        Args:\n+            view_func: The view function to inspect\n+        Returns:\n+            Optional[bool]: The use_read_replica setting, or None if not found\n+        \"\"\"\n+        # Return None if view_func is None to prevent AttributeError\n+        if view_func is None:\n+            return None\n+\n+        # Check function-based view attribute\n+        use_replica = getattr(view_func, \"use_read_replica\", None)\n+        if use_replica is not None:\n+            return use_replica\n+\n+        # Check Django CBV wrapper\n+        if hasattr(view_func, \"view_class\"):\n+            use_replica = getattr(view_func.view_class, \"use_read_replica\", None)\n+            if use_replica is not None:\n+                return use_replica\n+\n+        # Check DRF wrapper (APIView / ViewSet)\n+        if hasattr(view_func, \"cls\"):\n+            use_replica = getattr(view_func.cls, \"use_read_replica\", None)\n+            if use_replica is not None:\n+                return use_replica\n+\n+        return None\n+\n+    def process_exception(self, request: HttpRequest, exception: Exception) -> None:\n+        \"\"\"\n+        Handle exceptions that occur during view processing.\n+        This provides an additional safety net for context cleanup when views\n+        raise exceptions, complementing the try/finally in __call__.\n+        Args:\n+            request: The HTTP request object\n+            exception: The exception that was raised\n+        Returns:\n+            None: Don't handle the exception, just clean up context\n+        \"\"\"\n+        # Clean up context on exception as a safety measure\n+        # The try/finally in __call__ should handle most cases, but this\n+        # provides extra protection specifically for view exceptions\n+        clear_read_replica_context()\n+        logger.debug(\n+            f\"Cleaned up read replica context due to exception: {type(exception).__name__}\"\n+        )\n+\n+        # Return None to let the exception continue propagating\n+        return None\n"
        },
        {
          "path": "apps/api/plane/settings/common.py",
          "status": "modified",
          "diff": "Index: apps/api/plane/settings/common.py\n===================================================================\n--- apps/api/plane/settings/common.py\tb116239 (parent)\n+++ apps/api/plane/settings/common.py\t84879ee (commit)\n@@ -148,8 +148,31 @@\n             \"PORT\": os.environ.get(\"POSTGRES_PORT\", \"5432\"),\n         }\n     }\n \n+\n+if os.environ.get(\"ENABLE_READ_REPLICA\", \"0\") == \"1\":\n+    if bool(os.environ.get(\"DATABASE_READ_REPLICA_URL\")):\n+        # Parse database configuration from $DATABASE_URL\n+        DATABASES[\"replica\"] = dj_database_url.parse(\n+            os.environ.get(\"DATABASE_READ_REPLICA_URL\")\n+        )\n+    else:\n+        DATABASES[\"replica\"] = {\n+            \"ENGINE\": \"django.db.backends.postgresql\",\n+            \"NAME\": os.environ.get(\"POSTGRES_READ_REPLICA_DB\"),\n+            \"USER\": os.environ.get(\"POSTGRES_READ_REPLICA_USER\"),\n+            \"PASSWORD\": os.environ.get(\"POSTGRES_READ_REPLICA_PASSWORD\"),\n+            \"HOST\": os.environ.get(\"POSTGRES_READ_REPLICA_HOST\"),\n+            \"PORT\": os.environ.get(\"POSTGRES_READ_REPLICA_PORT\", \"5432\"),\n+        }\n+\n+    # Database Routers\n+    DATABASE_ROUTERS = [\"plane.utils.core.dbrouters.ReadReplicaRouter\"]\n+    # Add middleware at the end for read replica routing\n+    MIDDLEWARE.append(\"plane.middleware.db_routing.ReadReplicaRoutingMiddleware\")\n+\n+\n # Redis Config\n REDIS_URL = os.environ.get(\"REDIS_URL\")\n REDIS_SSL = REDIS_URL and \"rediss\" in REDIS_URL\n \n"
        },
        {
          "path": "apps/api/plane/tests/unit/middleware/__init__.py",
          "status": "added",
          "diff": "Index: apps/api/plane/tests/unit/middleware/__init__.py\n===================================================================\n--- apps/api/plane/tests/unit/middleware/__init__.py\tb116239 (parent)\n+++ apps/api/plane/tests/unit/middleware/__init__.py\t84879ee (commit)\n"
        },
        {
          "path": "apps/api/plane/tests/unit/middleware/test_db_routing.py",
          "status": "added",
          "diff": "Index: apps/api/plane/tests/unit/middleware/test_db_routing.py\n===================================================================\n--- apps/api/plane/tests/unit/middleware/test_db_routing.py\tb116239 (parent)\n+++ apps/api/plane/tests/unit/middleware/test_db_routing.py\t84879ee (commit)\n@@ -0,0 +1,433 @@\n+\"\"\"\n+Unit tests for ReadReplicaRoutingMiddleware.\n+This module contains comprehensive tests for the ReadReplicaRoutingMiddleware\n+that handles intelligent database routing to read replicas based on HTTP methods\n+and view configuration.\n+Test Organization:\n+- TestReadReplicaRoutingMiddleware: Core middleware functionality\n+- TestProcessView: process_view method behavior\n+- TestReplicaDecisionLogic: Decision logic for replica usage\n+- TestAttributeDetection: View attribute detection methods\n+- TestExceptionHandling: Exception handling and cleanup\n+- TestRealViewIntegration: Real Django/DRF view integration\n+- TestEdgeCases: Edge cases and error conditions\n+\"\"\"\n+\n+import pytest\n+from unittest.mock import Mock, patch\n+\n+from django.http import HttpResponse\n+from django.test import RequestFactory\n+from django.views import View\n+from rest_framework.views import APIView\n+from rest_framework.viewsets import ViewSet\n+\n+from plane.middleware.db_routing import ReadReplicaRoutingMiddleware\n+\n+\n+# Pytest fixtures\n+@pytest.fixture\n+def mock_get_response():\n+    \"\"\"Fixture for mocked get_response callable.\"\"\"\n+    return Mock(return_value=HttpResponse())\n+\n+\n+@pytest.fixture\n+def middleware(mock_get_response):\n+    \"\"\"Fixture for ReadReplicaRoutingMiddleware instance.\"\"\"\n+    return ReadReplicaRoutingMiddleware(mock_get_response)\n+\n+\n+@pytest.fixture\n+def request_factory():\n+    \"\"\"Fixture for Django RequestFactory.\"\"\"\n+    return RequestFactory()\n+\n+\n+@pytest.fixture\n+def mock_view_func():\n+    \"\"\"Fixture for a basic mocked view function.\"\"\"\n+    view = Mock()\n+    view.use_read_replica = True\n+    return view\n+\n+\n+@pytest.fixture\n+def get_request(request_factory):\n+    \"\"\"Fixture for a GET request.\"\"\"\n+    return request_factory.get(\"/api/test/\")\n+\n+\n+@pytest.fixture\n+def post_request(request_factory):\n+    \"\"\"Fixture for a POST request.\"\"\"\n+    return request_factory.post(\"/api/test/\")\n+\n+\n+@pytest.mark.unit\n+class TestReadReplicaRoutingMiddleware:\n+    \"\"\"Test cases for ReadReplicaRoutingMiddleware core functionality.\"\"\"\n+\n+    def test_middleware_initialization(self, middleware, mock_get_response):\n+        \"\"\"Test middleware initializes correctly with expected attributes.\"\"\"\n+        assert middleware.get_response == mock_get_response\n+        assert hasattr(middleware, \"READ_ONLY_METHODS\")\n+        assert \"GET\" in middleware.READ_ONLY_METHODS\n+        assert \"HEAD\" in middleware.READ_ONLY_METHODS\n+        assert \"OPTIONS\" in middleware.READ_ONLY_METHODS\n+\n+    def test_read_only_methods_constant(self, middleware):\n+        \"\"\"Test READ_ONLY_METHODS contains expected HTTP methods.\"\"\"\n+        expected_methods = {\"GET\", \"HEAD\", \"OPTIONS\"}\n+        assert middleware.READ_ONLY_METHODS == expected_methods\n+\n+    @patch(\"plane.middleware.db_routing.set_use_read_replica\")\n+    @patch(\"plane.middleware.db_routing.clear_read_replica_context\")\n+    def test_call_routes_write_methods_to_primary(\n+        self, mock_clear, mock_set, middleware, post_request, mock_get_response\n+    ):\n+        \"\"\"Test __call__ routes write methods to primary database.\"\"\"\n+        response = middleware(post_request)\n+\n+        mock_set.assert_called_once_with(False)  # Primary database\n+        mock_clear.assert_called_once()\n+        assert response == mock_get_response.return_value\n+\n+    @patch(\"plane.middleware.db_routing.clear_read_replica_context\")\n+    def test_call_with_read_methods_waits_for_process_view(\n+        self, mock_clear, middleware, get_request, mock_get_response\n+    ):\n+        \"\"\"Test __call__ with read methods waits for process_view.\"\"\"\n+        response = middleware(get_request)\n+\n+        mock_clear.assert_called_once()\n+        assert response == mock_get_response.return_value\n+\n+    @patch(\"plane.middleware.db_routing.clear_read_replica_context\")\n+    def test_call_always_cleans_up_context(self, mock_clear, middleware, get_request):\n+        \"\"\"Test __call__ always cleans up context.\"\"\"\n+        middleware(get_request)\n+\n+        mock_clear.assert_called_once()\n+\n+    @patch(\"plane.middleware.db_routing.clear_read_replica_context\")\n+    def test_call_cleans_up_context_on_exception(\n+        self, mock_clear, middleware, get_request, mock_get_response\n+    ):\n+        \"\"\"Test __call__ cleans up context even if get_response raises.\"\"\"\n+        mock_get_response.side_effect = Exception(\"Test exception\")\n+\n+        with pytest.raises(Exception, match=\"Test exception\"):\n+            middleware(get_request)\n+\n+        mock_clear.assert_called_once()\n+\n+\n+@pytest.mark.unit\n+class TestProcessView:\n+    \"\"\"Test cases for process_view method functionality.\"\"\"\n+\n+    @patch(\"plane.middleware.db_routing.set_use_read_replica\")\n+    def test_with_read_method_and_replica_true(self, mock_set, middleware, get_request):\n+        \"\"\"Test process_view with GET request and use_read_replica=True.\"\"\"\n+        view_func = Mock()\n+        view_func.use_read_replica = True\n+\n+        result = middleware.process_view(get_request, view_func, (), {})\n+\n+        mock_set.assert_called_once_with(True)\n+        assert result is None\n+\n+    @patch(\"plane.middleware.db_routing.set_use_read_replica\")\n+    def test_with_read_method_and_replica_false(\n+        self, mock_set, middleware, get_request\n+    ):\n+        \"\"\"Test process_view with GET request and use_read_replica=False.\"\"\"\n+        view_func = Mock()\n+        view_func.use_read_replica = False\n+\n+        result = middleware.process_view(get_request, view_func, (), {})\n+\n+        mock_set.assert_called_once_with(False)\n+        assert result is None\n+\n+    @patch(\"plane.middleware.db_routing.set_use_read_replica\")\n+    def test_with_read_method_and_no_replica_attribute(\n+        self, mock_set, middleware, get_request\n+    ):\n+        \"\"\"Test process_view with GET request and no use_read_replica attr.\"\"\"\n+        view_func = Mock(spec=[])  # No use_read_replica attribute\n+\n+        result = middleware.process_view(get_request, view_func, (), {})\n+\n+        mock_set.assert_called_once_with(False)  # Default to primary\n+        assert result is None\n+\n+    def test_with_write_method_ignores_view_attributes(self, middleware, post_request):\n+        \"\"\"Test process_view with write methods ignores view attributes.\"\"\"\n+        view_func = Mock()\n+        view_func.use_read_replica = True  # This should be ignored for POST\n+\n+        result = middleware.process_view(post_request, view_func, (), {})\n+\n+        assert result is None  # Should not process for write methods\n+\n+\n+@pytest.mark.unit\n+class TestReplicaDecisionLogic:\n+    \"\"\"Test cases for replica decision logic methods.\"\"\"\n+\n+    def test_should_use_read_replica_with_true_attribute(self, middleware):\n+        \"\"\"Test _should_use_read_replica returns True for True attribute.\"\"\"\n+        view_func = Mock()\n+        view_func.use_read_replica = True\n+\n+        result = middleware._should_use_read_replica(view_func)\n+\n+        assert result is True\n+\n+    def test_should_use_read_replica_with_false_attribute(self, middleware):\n+        \"\"\"Test _should_use_read_replica returns False for False attribute.\"\"\"\n+        view_func = Mock()\n+        view_func.use_read_replica = False\n+\n+        result = middleware._should_use_read_replica(view_func)\n+\n+        assert result is False\n+\n+    def test_should_use_read_replica_with_no_attribute_defaults_false(self, middleware):\n+        \"\"\"Test _should_use_read_replica defaults to False for missing attr.\"\"\"\n+        view_func = Mock(spec=[])  # No use_read_replica attribute\n+\n+        result = middleware._should_use_read_replica(view_func)\n+\n+        assert result is False\n+\n+\n+@pytest.mark.unit\n+class TestAttributeDetection:\n+    \"\"\"Test cases for view attribute detection methods.\"\"\"\n+\n+    def test_get_use_replica_attribute_function_based_view(self, middleware):\n+        \"\"\"Test _get_use_replica_attribute with function-based view.\"\"\"\n+        # Test with True\n+        view_func = Mock()\n+        view_func.use_read_replica = True\n+        result = middleware._get_use_replica_attribute(view_func)\n+        assert result is True\n+\n+        # Test with False\n+        view_func.use_read_replica = False\n+        result = middleware._get_use_replica_attribute(view_func)\n+        assert result is False\n+\n+        # Test with no attribute\n+        view_func = Mock(spec=[])\n+        result = middleware._get_use_replica_attribute(view_func)\n+        assert result is None\n+\n+    def test_get_use_replica_attribute_django_cbv(self, middleware):\n+        \"\"\"Test _get_use_replica_attribute with Django CBV wrapper.\"\"\"\n+        view_class = Mock()\n+        view_class.use_read_replica = True\n+        view_func = Mock()\n+        view_func.view_class = view_class\n+        # Remove use_read_replica from view_func to ensure it checks view_class\n+        del view_func.use_read_replica\n+\n+        result = middleware._get_use_replica_attribute(view_func)\n+\n+        assert result is True\n+\n+    def test_get_use_replica_attribute_drf_wrapper(self, middleware):\n+        \"\"\"Test _get_use_replica_attribute with DRF wrapper.\"\"\"\n+\n+        # Create a real object to avoid Mock issues\n+        class ViewClass:\n+            use_read_replica = True\n+\n+        class ViewFunc:\n+            cls = ViewClass()\n+\n+        view_func = ViewFunc()\n+\n+        result = middleware._get_use_replica_attribute(view_func)\n+\n+        assert result is True\n+\n+    def test_get_use_replica_attribute_priority_order(self, middleware):\n+        \"\"\"Test attribute priority: direct > view_class > cls.\"\"\"\n+        view_func = Mock()\n+        view_func.use_read_replica = True  # Direct attribute (highest priority)\n+\n+        # Add conflicting attributes with lower priority\n+        view_class = Mock()\n+        view_class.use_read_replica = False\n+        view_func.view_class = view_class\n+\n+        cls = Mock()\n+        cls.use_read_replica = False\n+        view_func.cls = cls\n+\n+        result = middleware._get_use_replica_attribute(view_func)\n+\n+        assert result is True  # Should use direct attribute\n+\n+    @pytest.mark.parametrize(\n+        \"value,expected\",\n+        [\n+            (True, True),\n+            (False, False),\n+            (1, True),\n+            (0, False),\n+            (\"yes\", True),\n+            (\"\", False),\n+            ([], False),\n+            ([1], True),\n+            (None, False),\n+        ],\n+    )\n+    def test_should_use_read_replica_truthy_falsy_values(\n+        self, middleware, value, expected\n+    ):\n+        \"\"\"Test _should_use_read_replica with various truthy/falsy values.\"\"\"\n+\n+        # Create a real object to test the attribute handling\n+        class TestView:\n+            pass\n+\n+        view_func = TestView()\n+        view_func.use_read_replica = value\n+\n+        result = middleware._should_use_read_replica(view_func)\n+\n+        assert result == expected\n+\n+\n+@pytest.mark.unit\n+class TestExceptionHandling:\n+    \"\"\"Test cases for exception handling and cleanup.\"\"\"\n+\n+    @patch(\"plane.middleware.db_routing.clear_read_replica_context\")\n+    def test_process_exception_cleans_up_context(\n+        self, mock_clear, middleware, request_factory\n+    ):\n+        \"\"\"Test process_exception cleans up context.\"\"\"\n+        request = request_factory.get(\"/api/test/\")\n+        exception = Exception(\"Test exception\")\n+\n+        result = middleware.process_exception(request, exception)\n+\n+        mock_clear.assert_called_once()\n+        assert result is None  # Don't handle the exception\n+\n+    @patch(\"plane.middleware.db_routing.set_use_read_replica\")\n+    @patch(\"plane.middleware.db_routing.clear_read_replica_context\")\n+    def test_integration_full_request_cycle(\n+        self, mock_clear, mock_set, middleware, request_factory, mock_get_response\n+    ):\n+        \"\"\"Test complete request cycle from __call__ through process_view.\"\"\"\n+        request = request_factory.get(\"/api/test/\")\n+        view_func = Mock()\n+        view_func.use_read_replica = True\n+\n+        # Call middleware and process_view manually\n+        response = middleware(request)\n+        middleware.process_view(request, view_func, (), {})\n+\n+        mock_set.assert_called_once_with(True)\n+        mock_clear.assert_called_once()\n+        assert response == mock_get_response.return_value\n+\n+\n+@pytest.mark.unit\n+class TestRealViewIntegration:\n+    \"\"\"Test middleware with real Django/DRF view classes.\"\"\"\n+\n+    @patch(\"plane.middleware.db_routing.set_use_read_replica\")\n+    def test_with_django_class_based_view(self, mock_set, middleware, request_factory):\n+        \"\"\"Test middleware with actual Django CBV.\"\"\"\n+\n+        class TestView(View):\n+            use_read_replica = True\n+\n+        # Simulate Django's URL resolver creating a view wrapper\n+        view_func = TestView.as_view()\n+        request = request_factory.get(\"/api/test/\")\n+\n+        middleware.process_view(request, view_func, (), {})\n+\n+        mock_set.assert_called_once_with(True)\n+\n+    @patch(\"plane.middleware.db_routing.set_use_read_replica\")\n+    def test_with_drf_api_view(self, mock_set, middleware, request_factory):\n+        \"\"\"Test middleware with DRF APIView.\"\"\"\n+\n+        class TestAPIView(APIView):\n+            use_read_replica = True\n+\n+        # Simulate DRF's URL pattern creating a view wrapper\n+        view_func = TestAPIView.as_view()\n+        request = request_factory.get(\"/api/test/\")\n+\n+        middleware.process_view(request, view_func, (), {})\n+\n+        mock_set.assert_called_once_with(True)\n+\n+    @patch(\"plane.middleware.db_routing.set_use_read_replica\")\n+    def test_with_drf_viewset(self, mock_set, middleware, request_factory):\n+        \"\"\"Test middleware with DRF ViewSet.\"\"\"\n+\n+        class TestViewSet(ViewSet):\n+            use_read_replica = True\n+\n+        # Simulate DRF router creating viewset action\n+        view_func = TestViewSet.as_view({\"get\": \"list\"})\n+        request = request_factory.get(\"/api/test/\")\n+\n+        middleware.process_view(request, view_func, (), {})\n+\n+        mock_set.assert_called_once_with(True)\n+\n+\n+@pytest.mark.unit\n+class TestEdgeCases:\n+    \"\"\"Test edge cases and error conditions.\"\"\"\n+\n+    def test_process_view_with_none_view_func(self, middleware, request_factory):\n+        \"\"\"Test process_view handles None view_func gracefully.\"\"\"\n+        request = request_factory.get(\"/api/test/\")\n+\n+        result = middleware.process_view(request, None, (), {})\n+\n+        assert result is None  # Should not crash\n+\n+    def test_get_use_replica_attribute_with_attribute_error(self, middleware):\n+        \"\"\"Test _get_use_replica_attribute with view that raises AttributeError.\"\"\"\n+\n+        # Create a view class that raises AttributeError on access\n+        class ProblematicView:\n+            def __getattr__(self, name):\n+                if name == \"use_read_replica\":\n+                    raise AttributeError(\"Simulated attribute error\")\n+                raise AttributeError(\n+                    f\"'{type(self).__name__}' object has no attribute '{name}'\"\n+                )\n+\n+        view_func = ProblematicView()\n+\n+        result = middleware._get_use_replica_attribute(view_func)\n+\n+        assert result is None  # Should handle gracefully\n+\n+    def test_multiple_exception_calls_are_safe(self, middleware, request_factory):\n+        \"\"\"Test that multiple calls to process_exception don't cause issues.\"\"\"\n+        request = request_factory.get(\"/api/test/\")\n+        exception = Exception(\"Test exception\")\n+\n+        # Call multiple times\n+        result1 = middleware.process_exception(request, exception)\n+        result2 = middleware.process_exception(request, exception)\n+\n+        assert result1 is None  # Both should return None safely\n+        assert result2 is None\n"
        },
        {
          "path": "apps/api/plane/utils/core/__init__.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/core/__init__.py\n===================================================================\n--- apps/api/plane/utils/core/__init__.py\tb116239 (parent)\n+++ apps/api/plane/utils/core/__init__.py\t84879ee (commit)\n@@ -0,0 +1,21 @@\n+\"\"\"\n+Core utilities for Plane database routing and request scoping.\n+This package contains essential components for managing read replica routing\n+and request-scoped context in the Plane application.\n+\"\"\"\n+\n+from .dbrouters import ReadReplicaRouter\n+from .mixins import ReadReplicaControlMixin\n+from .request_scope import (\n+    set_use_read_replica,\n+    should_use_read_replica,\n+    clear_read_replica_context,\n+)\n+\n+__all__ = [\n+    \"ReadReplicaRouter\",\n+    \"ReadReplicaControlMixin\",\n+    \"set_use_read_replica\",\n+    \"should_use_read_replica\",\n+    \"clear_read_replica_context\",\n+]\n"
        },
        {
          "path": "apps/api/plane/utils/core/dbrouters.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/core/dbrouters.py\n===================================================================\n--- apps/api/plane/utils/core/dbrouters.py\tb116239 (parent)\n+++ apps/api/plane/utils/core/dbrouters.py\t84879ee (commit)\n@@ -0,0 +1,73 @@\n+\"\"\"\n+Database router for read replica selection.\n+This router determines which database to use for read/write operations\n+based on the request context set by the ReadReplicaRoutingMiddleware.\n+\"\"\"\n+\n+import logging\n+from typing import Type\n+\n+from django.db import models\n+\n+from .request_scope import should_use_read_replica\n+\n+logger = logging.getLogger(\"plane.db\")\n+\n+\n+class ReadReplicaRouter:\n+    \"\"\"\n+    Database router that directs read operations to replica when appropriate.\n+    This router works in conjunction with ReadReplicaRoutingMiddleware to:\n+    - Route read operations to replica database when request context allows\n+    - Always route write operations to primary database\n+    - Ensure migrations only run on primary database\n+    \"\"\"\n+\n+    def db_for_read(self, model: Type[models.Model], **hints) -> str:\n+        \"\"\"\n+        Determine which database to use for read operations.\n+        Args:\n+            model: The Django model class being queried\n+            **hints: Additional routing hints\n+        Returns:\n+            str: Database alias ('replica' or 'default')\n+        \"\"\"\n+        if should_use_read_replica():\n+            logger.debug(f\"Routing read for {model._meta.label} to replica database\")\n+            return \"replica\"\n+        else:\n+            logger.debug(f\"Routing read for {model._meta.label} to primary database\")\n+            return \"default\"\n+\n+    def db_for_write(self, model: Type[models.Model], **hints) -> str:\n+        \"\"\"\n+        Determine which database to use for write operations.\n+        All write operations always go to the primary database to ensure\n+        data consistency and avoid replication lag issues.\n+        Args:\n+            model: The Django model class being written to\n+            **hints: Additional routing hints\n+        Returns:\n+            str: Always returns 'default' (primary database)\n+        \"\"\"\n+        logger.debug(f\"Routing write for {model._meta.label} to primary database\")\n+        return \"default\"\n+\n+    def allow_migrate(\n+        self, db: str, app_label: str, model_name: str = None, **hints\n+    ) -> bool:\n+        \"\"\"\n+        Ensure migrations only run on the primary database.\n+        Args:\n+            db: Database alias\n+            app_label: Application label\n+            model_name: Model name (optional)\n+            **hints: Additional routing hints\n+        Returns:\n+            bool: True if migration is allowed on this database\n+        \"\"\"\n+        # Only allow migrations on the primary database\n+        allowed = db == \"default\"\n+        if not allowed:\n+            logger.debug(f\"Blocking migration for {app_label} on {db} database\")\n+        return allowed\n"
        },
        {
          "path": "apps/api/plane/utils/core/mixins/__init__.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/core/mixins/__init__.py\n===================================================================\n--- apps/api/plane/utils/core/mixins/__init__.py\tb116239 (parent)\n+++ apps/api/plane/utils/core/mixins/__init__.py\t84879ee (commit)\n@@ -0,0 +1,11 @@\n+\"\"\"\n+Core mixins for read replica functionality.\n+This package provides mixins for different aspects of read replica management\n+in Django and Django REST Framework applications.\n+\"\"\"\n+\n+from .view import ReadReplicaControlMixin\n+\n+__all__ = [\n+    \"ReadReplicaControlMixin\",\n+]\n"
        },
        {
          "path": "apps/api/plane/utils/core/mixins/view.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/core/mixins/view.py\n===================================================================\n--- apps/api/plane/utils/core/mixins/view.py\tb116239 (parent)\n+++ apps/api/plane/utils/core/mixins/view.py\t84879ee (commit)\n@@ -0,0 +1,20 @@\n+\"\"\"\n+Mixins for Django REST Framework views.\n+\"\"\"\n+\n+\n+class ReadReplicaControlMixin:\n+    \"\"\"\n+    Mixin to control read replica usage in DRF views.\n+    Set use_read_replica = True/False to route read operations to\n+    replica/primary database. Works with ReadReplicaRoutingMiddleware.\n+    Usage:\n+        class MyViewSet(ReadReplicaControlMixin, ModelViewSet):\n+            use_read_replica = True  # Use replica for GET requests\n+    Note:\n+        - Only affects GET, HEAD, OPTIONS requests\n+        - Write operations always use primary database\n+        - Defaults to True for safe replica usage\n+    \"\"\"\n+\n+    use_read_replica: bool = True\n"
        },
        {
          "path": "apps/api/plane/utils/core/request_scope.py",
          "status": "added",
          "diff": "Index: apps/api/plane/utils/core/request_scope.py\n===================================================================\n--- apps/api/plane/utils/core/request_scope.py\tb116239 (parent)\n+++ apps/api/plane/utils/core/request_scope.py\t84879ee (commit)\n@@ -0,0 +1,72 @@\n+\"\"\"\n+Database routing utilities for read replica selection.\n+This module provides request-scoped context management for database routing,\n+specifically for determining when to use read replicas vs primary database.\n+Used in conjunction with middleware and DRF views that set use_read_replica=True.\n+The context is maintained per request to ensure proper isolation between\n+concurrent requests in async environments.\n+\"\"\"\n+\n+from asgiref.local import Local\n+\n+__all__ = [\n+    \"set_use_read_replica\",\n+    \"should_use_read_replica\",\n+    \"clear_read_replica_context\",\n+]\n+\n+# Request-scoped context storage for database routing preferences\n+# Uses asgiref.local.Local which provides ContextVar under the hood\n+# This ensures proper context isolation per request in async environments\n+_db_routing_context = Local()\n+\n+\n+def set_use_read_replica(use_replica: bool) -> None:\n+    \"\"\"\n+    Mark the current request context to use read replica database.\n+    This function sets a request-scoped flag that determines database routing.\n+    The context is isolated per request to ensure thread safety in async environments.\n+    This function is typically called from:\n+    - Middleware that detects read-only operations\n+    - DRF views with use_read_replica=True attribute\n+    - API endpoints that only perform read operations\n+    Args:\n+        use_replica (bool): True to route database queries to read replica,\n+                           False to use primary database\n+    Note:\n+        The context is automatically isolated per request and should be\n+        cleared at the end of each request using clear_read_replica_context().\n+    \"\"\"\n+    _db_routing_context.use_read_replica = bool(use_replica)\n+\n+\n+def should_use_read_replica() -> bool:\n+    \"\"\"\n+    Check if the current request should use read replica database.\n+    This function reads the request-scoped context to determine database routing.\n+    It's called by the database router to decide which connection to use.\n+    Returns:\n+        bool: True if queries should be routed to read replica,\n+              False if they should use primary database (default)\n+    Note:\n+        Returns False by default if no context is set for the current request.\n+        The context is automatically isolated per request.\n+    \"\"\"\n+    return getattr(_db_routing_context, \"use_read_replica\", False)\n+\n+\n+def clear_read_replica_context() -> None:\n+    \"\"\"\n+    Clear the read replica context for the current request.\n+    This function should be called at the end of each request to ensure\n+    that context doesn't leak between requests. Typically called from\n+    middleware during request cleanup.\n+    This is important for:\n+    - Preventing context leakage between requests\n+    - Ensuring clean state for each new request\n+    - Proper memory management in long-running processes\n+    \"\"\"\n+    try:\n+        delattr(_db_routing_context, \"use_read_replica\")\n+    except AttributeError:\n+        pass\n"
        }
      ]
    },
    {
      "id": "refactor-document-editor",
      "sha": "27f74206a3db34a43d6c2aea483b4fad6e5d0b06",
      "parentSha": "e20bfa55d6615621bee04d4626b61e72c8a63665",
      "spec": "Implement a unified document editor and update app and package code to use it.\n\n1) Add a new app-level wrapper for the document editor\n- Create apps/web/core/components/editor/document/editor.tsx.\n- Export a forwardRef component DocumentEditor that wraps @plane/editor's DocumentEditorWithRef.\n- Props: \n  - Required: workspaceSlug (string), workspaceId (string).\n  - Optional: projectId (string), embedHandler (partial of IDocumentEditorProps[\"embedHandler\"]).\n  - Mode union:\n    - editable: false (read-only mode)\n    - OR editable: true with searchMentionCallback(payload: TSearchEntityRequestPayload) => Promise<TSearchResponse> and uploadFile: TFileHandler[\"upload\"].\n  - Allow MakeOptional on IDocumentEditorProps to make disabledExtensions, editable, flaggedExtensions optional.\n- Behavior:\n  - Use useMember().getUserDetails for mention entity display names.\n  - Use useEditorFlagging(workspaceSlug) to compute disabled/flagged extensions and pass them through to DocumentEditorWithRef (disabledExtensions = [...document.disabled, ...additionalDisabledExtensions], flaggedExtensions = document.flagged).\n  - Use useEditorMention with searchEntity calling searchMentionCallback when editable, else a no-op.\n  - Use useEditorConfig().getEditorFileHandlers with workspaceSlug, workspaceId, projectId, and uploadFile only when editable (otherwise pass a stub that returns an empty string).\n  - Use useIssueEmbed({ workspaceSlug, projectId }) and merge issue embed handler into embedHandler (embedHandler = { issue: issueEmbedProps, ...embedHandler }).\n  - Render EditorMentionsRoot as the mention renderComponent and map mentioned entity details via getUserDetails.\n  - Set containerClassName = cn(\"relative pl-3 pb-3\", provided containerClassName).\n\n2) Update editor barrel exports and paths in apps/web\n- Modify apps/web/core/components/editor/index.ts to export from the renamed directories:\n  - export * from \"./embeds\";\n  - export * from \"./lite-text\"; (replace old \"./lite-text-editor\")\n  - export * from \"./pdf\";\n  - export * from \"./rich-text\"; (replace old \"./rich-text-editor\")\n  - export * from \"./sticky-editor\";\n\n3) Rename lite-text and rich-text components directories\n- Move apps/web/core/components/editor/lite-text-editor/* to apps/web/core/components/editor/lite-text/* and create a new index.ts with re-exports:\n  - export * from \"./editor\";\n  - export * from \"./read-only-editor\";\n  - export * from \"./toolbar\";\n- Move apps/web/core/components/editor/rich-text-editor/* to apps/web/core/components/editor/rich-text/* and create a new index.ts with:\n  - export * from \"./editor\";\n- Remove old index files under lite-text-editor and rich-text-editor.\n\n4) Update imports in app code that reference the moved editors\n- In apps/web/core/components/inbox/modals/create-modal/issue-description.tsx change the import to:\n  - import { RichTextEditor } from \"@/components/editor/rich-text/editor\";\n  - Keep the existing behavior and props (including editable, onChange, uploadFile, etc.).\n\n5) Switch Pages Version view to the new DocumentEditor wrapper and JSON content\n- In apps/web/core/components/pages/version/editor.tsx:\n  - Replace import of DocumentReadOnlyEditorWithRef with the new wrapper: import { DocumentEditor } from \"@/components/editor/document/editor\"; and remove unused imports for mentions/config/flagging/embed handlers.\n  - Use versionDetails.description_json as the source of the document value; if absent, return null.\n  - Render <DocumentEditor key={activeVersion ?? \"\"} editable={false} id={activeVersion ?? \"\"} value={description_json} containerClassName=\"p-0 pb-64 border-none\" displayConfig={displayConfig} editorClassName=\"pl-10\" projectId={projectId?.toString()} workspaceId={workspaceDetails?.id ?? \"\"} workspaceSlug={workspaceSlug?.toString() ?? \"\"} />.\n\n6) Update editor package to support unified document editor and remove read-only editor\n- In packages/editor/src/ce/extensions/document-extensions.tsx, extend TDocumentEditorAdditionalExtensionsProps with isEditable: boolean.\n- Add packages/editor/src/core/components/editors/document/editor.tsx implementing DocumentEditorWithRef:\n  - Accept IDocumentEditorProps with editable, value (tiptap Content), embedHandler, fileHandler, mentionHandler, etc.\n  - Build extensions via:\n    - WorkItemEmbedExtension when embedHandler.issue is provided (widgetCallback from embedHandler.issue).\n    - SideMenuExtension({ aiEnabled: !disabledExtensions?.includes(\"ai\"), dragDropEnabled: true }).\n    - HeadingListExtension.\n    - ...DocumentEditorAdditionalExtensions({ disabledExtensions, embedConfig: embedHandler, flaggedExtensions, isEditable: editable, fileHandler, userDetails: user ?? { id: \"\", name: \"\", color: \"\" } }).\n  - Use useEditor({ editable, enableHistory: true, disabledExtensions, flaggedExtensions, editorClassName, fileHandler, handleEditorReady, id, initialValue: value, mentionHandler, onChange, forwardedRef }).\n  - Render PageRenderer with displayConfig (default DEFAULT_DISPLAY_CONFIG), bubbleMenuEnabled default false, editorContainerClassName cn(getEditorClassNames, \"document-editor\").\n- Update packages/editor/src/core/components/editors/document/index.ts to export the new editor and stop exporting read-only-editor:\n  - export * from \"./collaborative-editor\";\n  - export * from \"./editor\";\n  - export * from \"./loader\";\n  - export * from \"./page-renderer\";\n- Remove packages/editor/src/core/components/editors/document/read-only-editor.tsx.\n- In packages/editor/src/core/hooks/use-collaborative-editor.ts, when building DocumentEditorAdditionalExtensions, pass isEditable: editable.\n- Remove packages/editor/src/core/hooks/use-editor-markings.tsx and its export; add IMarking type to packages/editor/src/core/types/config.ts as:\n  - type IMarking = { type: \"heading\"; level: number; text: string; sequence: number }.\n- Update types:\n  - packages/editor/src/core/types/editor.ts:\n    - Convert imports to type-only where appropriate.\n    - Add IDocumentEditorProps extending Omit<IEditorProps, \"initialValue\" | \"onEnterKeyPress\" | \"value\"> with fields: aiHandler?, editable (boolean), embedHandler (TEmbedConfig), user? (TUserDetails), value (tiptap Content).\n    - Remove IDocumentReadOnlyEditorProps.\n  - packages/editor/src/core/types/hook.ts:\n    - Import Content from @tiptap/core.\n    - Change TEditorHookProps.initialValue?: Content.\n  - packages/editor/src/core/hooks/use-editor.ts:\n    - Set content: initialValue without coercing to a string placeholder; keep the effect that syncs value via setContent.\n- Update editor package public API exports in packages/editor/src/index.ts:\n  - Export editors: CollaborativeDocumentEditorWithRef, DocumentEditorWithRef, LiteTextEditorWithRef, LiteTextReadOnlyEditorWithRef, RichTextEditorWithRef.\n  - Keep exports for constants/common, helpers/common, helpers/yjs-utils, CORE_EXTENSIONS, ADDITIONAL_EXTENSIONS, and types.\n  - Remove exports for isCellSelection, helpers/editor-commands, table extension re-exports, components/menus, useEditorMarkings, useReadOnlyEditor, and any other removed symbols.\n\n7) Ensure all remaining references to the old read-only editor and old lite/rich paths are updated\n- Replace any lingering imports of:\n  - \"@/components/editor/rich-text-editor/...\" -> \"@/components/editor/rich-text/...\"\n  - \"@/components/editor/lite-text-editor/...\" -> \"@/components/editor/lite-text/...\"\n  - DocumentReadOnlyEditorWithRef -> DocumentEditorWithRef or the app-level DocumentEditor wrapper depending on context.\n\n8) Content type alignment\n- Where JSON content is the source of document content (e.g., page version), pass it via the new value prop (tiptap Content) instead of initialValue string HTML.\n- Editable flows using rich text editors continue to accept HTML where used; only document editor consumers should migrate to value.\n\nAcceptance criteria:\n- Pages Version view renders using the new DocumentEditor app wrapper in read-only mode using description_json and no longer references DocumentReadOnlyEditorWithRef.\n- All imports from rich-text-editor and lite-text-editor paths are updated to rich-text and lite-text respectively and build succeeds.\n- Editor package compiles with the new DocumentEditorWithRef, types updated, and removed read-only editor and markings hook.\n- No broken exports from @plane/editor; only the new intended public surface is exported.",
      "prompt": "Refactor the document editor into a single component that supports both editable and read-only modes, and update the app to use it. Add an app-level wrapper that wires mentions, file handlers, and issue embeds. Rename lite/rich text editor directories to simplified paths and fix all imports. Update the pages version view to render the JSON document content using the new wrapper in read-only mode. In the editor package, add a new DocumentEditorWithRef, remove the legacy read-only editor and markings hook, add an isEditable flag to document extensions, and adjust types and public exports so the consolidated editor is the primary entry point.",
      "supplementalFiles": [
        "packages/editor/src/core/components/editors/document/page-renderer.tsx",
        "packages/editor/src/core/components/editors/document/collaborative-editor.tsx",
        "packages/editor/src/core/components/editors/document/loader.tsx",
        "packages/editor/src/core/constants/config.ts",
        "packages/editor/src/core/constants/extension.ts"
      ],
      "fileDiffs": [
        {
          "path": "apps/web/core/components/editor/document/editor.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/editor/document/editor.tsx\n===================================================================\n--- apps/web/core/components/editor/document/editor.tsx\te20bfa5 (parent)\n+++ apps/web/core/components/editor/document/editor.tsx\t27f7420 (commit)\n@@ -0,0 +1,92 @@\n+import React, { forwardRef } from \"react\";\n+// plane imports\n+import { DocumentEditorWithRef, EditorRefApi, IDocumentEditorProps, TFileHandler } from \"@plane/editor\";\n+import { MakeOptional, TSearchEntityRequestPayload, TSearchResponse } from \"@plane/types\";\n+import { cn } from \"@plane/utils\";\n+// components\n+import { EditorMentionsRoot } from \"@/components/editor\";\n+// hooks\n+import { useEditorConfig, useEditorMention } from \"@/hooks/editor\";\n+import { useMember } from \"@/hooks/store\";\n+// plane web hooks\n+import { useEditorFlagging } from \"@/plane-web/hooks/use-editor-flagging\";\n+import { useIssueEmbed } from \"@/plane-web/hooks/use-issue-embed\";\n+\n+type DocumentEditorWrapperProps = MakeOptional<\n+  Omit<IDocumentEditorProps, \"fileHandler\" | \"mentionHandler\" | \"embedHandler\" | \"user\">,\n+  \"disabledExtensions\" | \"editable\" | \"flaggedExtensions\"\n+> & {\n+  embedHandler?: Partial<IDocumentEditorProps[\"embedHandler\"]>;\n+  workspaceSlug: string;\n+  workspaceId: string;\n+  projectId?: string;\n+} & (\n+    | {\n+        editable: false;\n+      }\n+    | {\n+        editable: true;\n+        searchMentionCallback: (payload: TSearchEntityRequestPayload) => Promise<TSearchResponse>;\n+        uploadFile: TFileHandler[\"upload\"];\n+      }\n+  );\n+\n+export const DocumentEditor = forwardRef<EditorRefApi, DocumentEditorWrapperProps>((props, ref) => {\n+  const {\n+    containerClassName,\n+    editable,\n+    embedHandler,\n+    workspaceSlug,\n+    workspaceId,\n+    projectId,\n+    disabledExtensions: additionalDisabledExtensions = [],\n+    ...rest\n+  } = props;\n+  // store hooks\n+  const { getUserDetails } = useMember();\n+  // editor flaggings\n+  const { document: documentEditorExtensions } = useEditorFlagging(workspaceSlug);\n+  // use editor mention\n+  const { fetchMentions } = useEditorMention({\n+    searchEntity: editable ? async (payload) => await props.searchMentionCallback(payload) : async () => ({}),\n+  });\n+  // editor config\n+  const { getEditorFileHandlers } = useEditorConfig();\n+  // issue-embed\n+  const { issueEmbedProps } = useIssueEmbed({\n+    projectId,\n+    workspaceSlug,\n+  });\n+\n+  return (\n+    <DocumentEditorWithRef\n+      ref={ref}\n+      disabledExtensions={[...documentEditorExtensions.disabled, ...(additionalDisabledExtensions ?? [])]}\n+      editable={editable}\n+      flaggedExtensions={documentEditorExtensions.flagged}\n+      fileHandler={getEditorFileHandlers({\n+        projectId,\n+        uploadFile: editable ? props.uploadFile : async () => \"\",\n+        workspaceId,\n+        workspaceSlug,\n+      })}\n+      mentionHandler={{\n+        searchCallback: async (query) => {\n+          const res = await fetchMentions(query);\n+          if (!res) throw new Error(\"Failed in fetching mentions\");\n+          return res;\n+        },\n+        renderComponent: EditorMentionsRoot,\n+        getMentionedEntityDetails: (id: string) => ({ display_name: getUserDetails(id)?.display_name ?? \"\" }),\n+      }}\n+      embedHandler={{\n+        issue: issueEmbedProps,\n+        ...embedHandler,\n+      }}\n+      {...rest}\n+      containerClassName={cn(\"relative pl-3 pb-3\", containerClassName)}\n+    />\n+  );\n+});\n+\n+DocumentEditor.displayName = \"DocumentEditor\";\n"
        },
        {
          "path": "apps/web/core/components/editor/index.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/components/editor/index.ts\n===================================================================\n--- apps/web/core/components/editor/index.ts\te20bfa5 (parent)\n+++ apps/web/core/components/editor/index.ts\t27f7420 (commit)\n@@ -1,5 +1,5 @@\n export * from \"./embeds\";\n-export * from \"./lite-text-editor\";\n+export * from \"./lite-text\";\n export * from \"./pdf\";\n-export * from \"./rich-text-editor\";\n+export * from \"./rich-text\";\n export * from \"./sticky-editor\";\n"
        },
        {
          "path": "apps/web/core/components/editor/lite-text-editor/index.ts",
          "status": "deleted",
          "diff": "Index: apps/web/core/components/editor/lite-text-editor/index.ts\n===================================================================\n--- apps/web/core/components/editor/lite-text-editor/index.ts\te20bfa5 (parent)\n+++ apps/web/core/components/editor/lite-text-editor/index.ts\t27f7420 (commit)\n@@ -1,3 +0,0 @@\n-export * from \"./lite-text-editor\";\n-export * from \"./lite-text-read-only-editor\";\n-export * from \"./toolbar\";\n"
        },
        {
          "path": "apps/web/core/components/editor/lite-text/editor.tsx",
          "status": "renamed",
          "oldPath": "apps/web/core/components/editor/lite-text-editor/lite-text-editor.tsx",
          "diff": "===================================================================\n--- apps/web/core/components/editor/lite-text-editor/lite-text-editor.tsx\te20bfa5 (parent)\n+++ apps/web/core/components/editor/lite-text/editor.tsx\t27f7420 (commit)\n"
        },
        {
          "path": "apps/web/core/components/editor/lite-text/index.ts",
          "status": "added",
          "diff": "Index: apps/web/core/components/editor/lite-text/index.ts\n===================================================================\n--- apps/web/core/components/editor/lite-text/index.ts\te20bfa5 (parent)\n+++ apps/web/core/components/editor/lite-text/index.ts\t27f7420 (commit)\n@@ -0,0 +1,3 @@\n+export * from \"./editor\";\n+export * from \"./read-only-editor\";\n+export * from \"./toolbar\";\n"
        },
        {
          "path": "apps/web/core/components/editor/lite-text/read-only-editor.tsx",
          "status": "renamed",
          "oldPath": "apps/web/core/components/editor/lite-text-editor/lite-text-read-only-editor.tsx",
          "diff": "===================================================================\n--- apps/web/core/components/editor/lite-text-editor/lite-text-read-only-editor.tsx\te20bfa5 (parent)\n+++ apps/web/core/components/editor/lite-text/read-only-editor.tsx\t27f7420 (commit)\n"
        },
        {
          "path": "apps/web/core/components/editor/lite-text/toolbar.tsx",
          "status": "renamed",
          "oldPath": "apps/web/core/components/editor/lite-text-editor/toolbar.tsx",
          "diff": "===================================================================\n--- apps/web/core/components/editor/lite-text-editor/toolbar.tsx\te20bfa5 (parent)\n+++ apps/web/core/components/editor/lite-text/toolbar.tsx\t27f7420 (commit)\n"
        },
        {
          "path": "apps/web/core/components/editor/rich-text-editor/index.ts",
          "status": "deleted",
          "diff": "Index: apps/web/core/components/editor/rich-text-editor/index.ts\n===================================================================\n--- apps/web/core/components/editor/rich-text-editor/index.ts\te20bfa5 (parent)\n+++ apps/web/core/components/editor/rich-text-editor/index.ts\t27f7420 (commit)\n@@ -1,1 +0,0 @@\n-export * from \"./rich-text-editor\";\n"
        },
        {
          "path": "apps/web/core/components/editor/rich-text/editor.tsx",
          "status": "renamed",
          "oldPath": "apps/web/core/components/editor/rich-text-editor/rich-text-editor.tsx",
          "diff": "===================================================================\n--- apps/web/core/components/editor/rich-text-editor/rich-text-editor.tsx\te20bfa5 (parent)\n+++ apps/web/core/components/editor/rich-text/editor.tsx\t27f7420 (commit)\n"
        },
        {
          "path": "apps/web/core/components/editor/rich-text/index.ts",
          "status": "added",
          "diff": "Index: apps/web/core/components/editor/rich-text/index.ts\n===================================================================\n--- apps/web/core/components/editor/rich-text/index.ts\te20bfa5 (parent)\n+++ apps/web/core/components/editor/rich-text/index.ts\t27f7420 (commit)\n@@ -0,0 +1,1 @@\n+export * from \"./editor\";\n"
        },
        {
          "path": "apps/web/core/components/inbox/modals/create-modal/issue-description.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/inbox/modals/create-modal/issue-description.tsx\n===================================================================\n--- apps/web/core/components/inbox/modals/create-modal/issue-description.tsx\te20bfa5 (parent)\n+++ apps/web/core/components/inbox/modals/create-modal/issue-description.tsx\t27f7420 (commit)\n@@ -9,9 +9,9 @@\n import { EFileAssetType, TIssue } from \"@plane/types\";\n import { Loader } from \"@plane/ui\";\n import { getDescriptionPlaceholderI18n, getTabIndex } from \"@plane/utils\";\n // components\n-import { RichTextEditor } from \"@/components/editor/rich-text-editor/rich-text-editor\";\n+import { RichTextEditor } from \"@/components/editor/rich-text/editor\";\n // hooks\n import { useEditorAsset, useProjectInbox } from \"@/hooks/store\";\n import { usePlatformOS } from \"@/hooks/use-platform-os\";\n // services\n"
        },
        {
          "path": "apps/web/core/components/pages/version/editor.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/pages/version/editor.tsx\n===================================================================\n--- apps/web/core/components/pages/version/editor.tsx\te20bfa5 (parent)\n+++ apps/web/core/components/pages/version/editor.tsx\t27f7420 (commit)\n@@ -1,44 +1,29 @@\n import { observer } from \"mobx-react\";\n import { useParams } from \"next/navigation\";\n // plane imports\n-import { DocumentReadOnlyEditorWithRef, TDisplayConfig } from \"@plane/editor\";\n+import { TDisplayConfig } from \"@plane/editor\";\n import { TPageVersion } from \"@plane/types\";\n import { Loader } from \"@plane/ui\";\n // components\n-import { EditorMentionsRoot } from \"@/components/editor\";\n+import { DocumentEditor } from \"@/components/editor/document/editor\";\n // hooks\n-import { useEditorConfig } from \"@/hooks/editor\";\n-import { useMember, useWorkspace } from \"@/hooks/store\";\n+import { useWorkspace } from \"@/hooks/store\";\n import { usePageFilters } from \"@/hooks/use-page-filters\";\n-// plane web hooks\n-import { useEditorFlagging } from \"@/plane-web/hooks/use-editor-flagging\";\n-import { useIssueEmbed } from \"@/plane-web/hooks/use-issue-embed\";\n \n export type TVersionEditorProps = {\n   activeVersion: string | null;\n   versionDetails: TPageVersion | undefined;\n };\n \n export const PagesVersionEditor: React.FC<TVersionEditorProps> = observer((props) => {\n   const { activeVersion, versionDetails } = props;\n-  // store hooks\n-  const { getUserDetails } = useMember();\n   // params\n   const { workspaceSlug, projectId } = useParams();\n   // store hooks\n   const { getWorkspaceBySlug } = useWorkspace();\n   // derived values\n   const workspaceDetails = getWorkspaceBySlug(workspaceSlug?.toString() ?? \"\");\n-  // editor flaggings\n-  const { document: documentEditorExtensions } = useEditorFlagging(workspaceSlug?.toString() ?? \"\");\n-  // editor config\n-  const { getReadOnlyEditorFileHandlers } = useEditorConfig();\n-  // issue-embed\n-  const { issueEmbedProps } = useIssueEmbed({\n-    projectId: projectId?.toString() ?? \"\",\n-    workspaceSlug: workspaceSlug?.toString() ?? \"\",\n-  });\n   // page filters\n   const { fontSize, fontStyle } = usePageFilters();\n \n   const displayConfig: TDisplayConfig = {\n@@ -88,33 +73,22 @@\n         </Loader>\n       </div>\n     );\n \n-  const description = versionDetails?.description_html;\n-  if (description === undefined || description?.trim() === \"\") return null;\n+  const description = versionDetails?.description_json;\n+  if (!description) return null;\n \n   return (\n-    <DocumentReadOnlyEditorWithRef\n+    <DocumentEditor\n+      key={activeVersion ?? \"\"}\n+      editable={false}\n       id={activeVersion ?? \"\"}\n-      initialValue={description ?? \"<p></p>\"}\n+      value={description}\n       containerClassName=\"p-0 pb-64 border-none\"\n-      disabledExtensions={documentEditorExtensions.disabled}\n-      flaggedExtensions={documentEditorExtensions.flagged}\n       displayConfig={displayConfig}\n       editorClassName=\"pl-10\"\n-      fileHandler={getReadOnlyEditorFileHandlers({\n-        projectId: projectId?.toString() ?? \"\",\n-        workspaceId: workspaceDetails?.id ?? \"\",\n-        workspaceSlug: workspaceSlug?.toString() ?? \"\",\n-      })}\n-      mentionHandler={{\n-        renderComponent: (props) => <EditorMentionsRoot {...props} />,\n-        getMentionedEntityDetails: (id: string) => ({ display_name: getUserDetails(id)?.display_name ?? \"\" }),\n-      }}\n-      embedHandler={{\n-        issue: {\n-          widgetCallback: issueEmbedProps.widgetCallback,\n-        },\n-      }}\n+      projectId={projectId?.toString()}\n+      workspaceId={workspaceDetails?.id ?? \"\"}\n+      workspaceSlug={workspaceSlug?.toString() ?? \"\"}\n     />\n   );\n });\n"
        },
        {
          "path": "packages/editor/src/ce/extensions/document-extensions.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/ce/extensions/document-extensions.tsx\n===================================================================\n--- packages/editor/src/ce/extensions/document-extensions.tsx\te20bfa5 (parent)\n+++ packages/editor/src/ce/extensions/document-extensions.tsx\t27f7420 (commit)\n@@ -10,8 +10,9 @@\n   IEditorProps,\n   \"disabledExtensions\" | \"flaggedExtensions\" | \"fileHandler\"\n > & {\n   embedConfig: TEmbedConfig | undefined;\n+  isEditable: boolean;\n   provider?: HocuspocusProvider;\n   userDetails: TUserDetails;\n };\n \n"
        },
        {
          "path": "packages/editor/src/core/components/editors/document/editor.tsx",
          "status": "added",
          "diff": "Index: packages/editor/src/core/components/editors/document/editor.tsx\n===================================================================\n--- packages/editor/src/core/components/editors/document/editor.tsx\te20bfa5 (parent)\n+++ packages/editor/src/core/components/editors/document/editor.tsx\t27f7420 (commit)\n@@ -0,0 +1,109 @@\n+import { Extensions } from \"@tiptap/core\";\n+import { forwardRef, MutableRefObject, useMemo } from \"react\";\n+// plane imports\n+import { cn } from \"@plane/utils\";\n+// components\n+import { PageRenderer } from \"@/components/editors\";\n+// constants\n+import { DEFAULT_DISPLAY_CONFIG } from \"@/constants/config\";\n+// extensions\n+import { HeadingListExtension, WorkItemEmbedExtension, SideMenuExtension } from \"@/extensions\";\n+// helpers\n+import { getEditorClassNames } from \"@/helpers/common\";\n+// hooks\n+import { useEditor } from \"@/hooks/use-editor\";\n+// plane editor extensions\n+import { DocumentEditorAdditionalExtensions } from \"@/plane-editor/extensions\";\n+// types\n+import { EditorRefApi, IDocumentEditorProps } from \"@/types\";\n+\n+const DocumentEditor = (props: IDocumentEditorProps) => {\n+  const {\n+    bubbleMenuEnabled = false,\n+    containerClassName,\n+    disabledExtensions,\n+    displayConfig = DEFAULT_DISPLAY_CONFIG,\n+    editable,\n+    editorClassName = \"\",\n+    embedHandler,\n+    fileHandler,\n+    flaggedExtensions,\n+    forwardedRef,\n+    id,\n+    handleEditorReady,\n+    mentionHandler,\n+    onChange,\n+    user,\n+    value,\n+  } = props;\n+  const extensions: Extensions = useMemo(() => {\n+    const additionalExtensions: Extensions = [];\n+    if (embedHandler?.issue) {\n+      additionalExtensions.push(\n+        WorkItemEmbedExtension({\n+          widgetCallback: embedHandler.issue.widgetCallback,\n+        })\n+      );\n+    }\n+    additionalExtensions.push(\n+      SideMenuExtension({\n+        aiEnabled: !disabledExtensions?.includes(\"ai\"),\n+        dragDropEnabled: true,\n+      }),\n+      HeadingListExtension,\n+      ...DocumentEditorAdditionalExtensions({\n+        disabledExtensions,\n+        embedConfig: embedHandler,\n+        flaggedExtensions,\n+        isEditable: editable,\n+        fileHandler,\n+        userDetails: user ?? {\n+          id: \"\",\n+          name: \"\",\n+          color: \"\",\n+        },\n+      })\n+    );\n+    return additionalExtensions;\n+  }, []);\n+\n+  const editor = useEditor({\n+    disabledExtensions,\n+    editable,\n+    editorClassName,\n+    enableHistory: true,\n+    extensions,\n+    fileHandler,\n+    flaggedExtensions,\n+    forwardedRef,\n+    handleEditorReady,\n+    id,\n+    initialValue: value,\n+    mentionHandler,\n+    onChange,\n+  });\n+\n+  const editorContainerClassName = getEditorClassNames({\n+    containerClassName,\n+  });\n+\n+  if (!editor) return null;\n+\n+  return (\n+    <PageRenderer\n+      bubbleMenuEnabled={bubbleMenuEnabled}\n+      displayConfig={displayConfig}\n+      editor={editor}\n+      editorContainerClassName={cn(editorContainerClassName, \"document-editor\")}\n+      id={id}\n+    />\n+  );\n+};\n+\n+const DocumentEditorWithRef = forwardRef<EditorRefApi, IDocumentEditorProps>((props, ref) => (\n+  <DocumentEditor {...props} forwardedRef={ref as MutableRefObject<EditorRefApi | null>} />\n+));\n+\n+DocumentEditorWithRef.displayName = \"DocumentEditorWithRef\";\n+\n+export { DocumentEditorWithRef };\n"
        },
        {
          "path": "packages/editor/src/core/components/editors/document/index.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/components/editors/document/index.ts\n===================================================================\n--- packages/editor/src/core/components/editors/document/index.ts\te20bfa5 (parent)\n+++ packages/editor/src/core/components/editors/document/index.ts\t27f7420 (commit)\n@@ -1,4 +1,4 @@\n export * from \"./collaborative-editor\";\n+export * from \"./editor\";\n export * from \"./loader\";\n export * from \"./page-renderer\";\n-export * from \"./read-only-editor\";\n"
        },
        {
          "path": "packages/editor/src/core/components/editors/document/read-only-editor.tsx",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/components/editors/document/read-only-editor.tsx\n===================================================================\n--- packages/editor/src/core/components/editors/document/read-only-editor.tsx\te20bfa5 (parent)\n+++ packages/editor/src/core/components/editors/document/read-only-editor.tsx\t27f7420 (commit)\n@@ -1,77 +0,0 @@\n-import { Extensions } from \"@tiptap/core\";\n-import React, { forwardRef, MutableRefObject } from \"react\";\n-// plane imports\n-import { cn } from \"@plane/utils\";\n-// components\n-import { PageRenderer } from \"@/components/editors\";\n-// constants\n-import { DEFAULT_DISPLAY_CONFIG } from \"@/constants/config\";\n-// extensions\n-import { WorkItemEmbedExtension } from \"@/extensions\";\n-// helpers\n-import { getEditorClassNames } from \"@/helpers/common\";\n-// hooks\n-import { useReadOnlyEditor } from \"@/hooks/use-read-only-editor\";\n-// types\n-import { EditorReadOnlyRefApi, IDocumentReadOnlyEditorProps } from \"@/types\";\n-\n-const DocumentReadOnlyEditor: React.FC<IDocumentReadOnlyEditorProps> = (props) => {\n-  const {\n-    containerClassName,\n-    disabledExtensions,\n-    displayConfig = DEFAULT_DISPLAY_CONFIG,\n-    editorClassName = \"\",\n-    embedHandler,\n-    fileHandler,\n-    flaggedExtensions,\n-    id,\n-    forwardedRef,\n-    handleEditorReady,\n-    initialValue,\n-    mentionHandler,\n-  } = props;\n-  const extensions: Extensions = [];\n-  if (embedHandler?.issue) {\n-    extensions.push(\n-      WorkItemEmbedExtension({\n-        widgetCallback: embedHandler.issue.widgetCallback,\n-      })\n-    );\n-  }\n-\n-  const editor = useReadOnlyEditor({\n-    disabledExtensions,\n-    editorClassName,\n-    extensions,\n-    fileHandler,\n-    flaggedExtensions,\n-    forwardedRef,\n-    handleEditorReady,\n-    initialValue,\n-    mentionHandler,\n-  });\n-\n-  const editorContainerClassName = getEditorClassNames({\n-    containerClassName,\n-  });\n-\n-  if (!editor) return null;\n-\n-  return (\n-    <PageRenderer\n-      bubbleMenuEnabled={false}\n-      displayConfig={displayConfig}\n-      editor={editor}\n-      editorContainerClassName={cn(editorContainerClassName, \"document-editor\")}\n-      id={id}\n-    />\n-  );\n-};\n-\n-const DocumentReadOnlyEditorWithRef = forwardRef<EditorReadOnlyRefApi, IDocumentReadOnlyEditorProps>((props, ref) => (\n-  <DocumentReadOnlyEditor {...props} forwardedRef={ref as MutableRefObject<EditorReadOnlyRefApi | null>} />\n-));\n-\n-DocumentReadOnlyEditorWithRef.displayName = \"DocumentReadOnlyEditorWithRef\";\n-\n-export { DocumentReadOnlyEditorWithRef };\n"
        },
        {
          "path": "packages/editor/src/core/hooks/use-collaborative-editor.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/hooks/use-collaborative-editor.ts\n===================================================================\n--- packages/editor/src/core/hooks/use-collaborative-editor.ts\te20bfa5 (parent)\n+++ packages/editor/src/core/hooks/use-collaborative-editor.ts\t27f7420 (commit)\n@@ -97,8 +97,9 @@\n         disabledExtensions,\n         embedConfig: embedHandler,\n         fileHandler,\n         flaggedExtensions,\n+        isEditable: editable,\n         provider,\n         userDetails: user,\n       }),\n     ],\n"
        },
        {
          "path": "packages/editor/src/core/hooks/use-editor-markings.tsx",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/hooks/use-editor-markings.tsx\n===================================================================\n--- packages/editor/src/core/hooks/use-editor-markings.tsx\te20bfa5 (parent)\n+++ packages/editor/src/core/hooks/use-editor-markings.tsx\t27f7420 (commit)\n@@ -1,39 +0,0 @@\n-import { useCallback, useState } from \"react\";\n-\n-export interface IMarking {\n-  type: \"heading\";\n-  level: number;\n-  text: string;\n-  sequence: number;\n-}\n-\n-export const useEditorMarkings = () => {\n-  const [markings, setMarkings] = useState<IMarking[]>([]);\n-\n-  const updateMarkings = useCallback((html: string) => {\n-    const parser = new DOMParser();\n-    const doc = parser.parseFromString(html, \"text/html\");\n-    const headings = doc.querySelectorAll(\"h1, h2, h3\");\n-    const tempMarkings: IMarking[] = [];\n-    let h1Sequence: number = 0;\n-    let h2Sequence: number = 0;\n-    let h3Sequence: number = 0;\n-\n-    headings.forEach((heading) => {\n-      const level = parseInt(heading.tagName[1]); // Extract the number from h1, h2, h3\n-      tempMarkings.push({\n-        type: \"heading\",\n-        level: level,\n-        text: heading.textContent || \"\",\n-        sequence: level === 1 ? ++h1Sequence : level === 2 ? ++h2Sequence : ++h3Sequence,\n-      });\n-    });\n-\n-    setMarkings(tempMarkings);\n-  }, []);\n-\n-  return {\n-    updateMarkings,\n-    markings,\n-  };\n-};\n"
        },
        {
          "path": "packages/editor/src/core/hooks/use-editor.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/hooks/use-editor.ts\n===================================================================\n--- packages/editor/src/core/hooks/use-editor.ts\te20bfa5 (parent)\n+++ packages/editor/src/core/hooks/use-editor.ts\t27f7420 (commit)\n@@ -69,9 +69,9 @@\n           tabIndex,\n         }),\n         ...extensions,\n       ],\n-      content: typeof initialValue === \"string\" && initialValue.trim() !== \"\" ? initialValue : \"<p></p>\",\n+      content: initialValue,\n       onCreate: () => handleEditorReady?.(true),\n       onTransaction: () => {\n         onTransaction?.();\n       },\n"
        },
        {
          "path": "packages/editor/src/core/types/config.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/types/config.ts\n===================================================================\n--- packages/editor/src/core/types/config.ts\te20bfa5 (parent)\n+++ packages/editor/src/core/types/config.ts\t27f7420 (commit)\n@@ -45,4 +45,11 @@\n export type TRealtimeConfig = {\n   url: string;\n   queryParams: TWebhookConnectionQueryParams;\n };\n+\n+export type IMarking = {\n+  type: \"heading\";\n+  level: number;\n+  text: string;\n+  sequence: number;\n+};\n"
        },
        {
          "path": "packages/editor/src/core/types/editor.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/types/editor.ts\n===================================================================\n--- packages/editor/src/core/types/editor.ts\te20bfa5 (parent)\n+++ packages/editor/src/core/types/editor.ts\t27f7420 (commit)\n@@ -1,6 +1,6 @@\n-import { Extensions, JSONContent } from \"@tiptap/core\";\n-import { Selection } from \"@tiptap/pm/state\";\n+import type { Content, Extensions, JSONContent } from \"@tiptap/core\";\n+import type { Selection } from \"@tiptap/pm/state\";\n // extension types\n import type { TTextAlign } from \"@/extensions\";\n // helpers\n import type { IMarking } from \"@/helpers/scroll-to-node\";\n@@ -159,8 +159,16 @@\n   serverHandler?: TServerHandler;\n   user: TUserDetails;\n }\n \n+export interface IDocumentEditorProps extends Omit<IEditorProps, \"initialValue\" | \"onEnterKeyPress\" | \"value\"> {\n+  aiHandler?: TAIHandler;\n+  editable: boolean;\n+  embedHandler: TEmbedConfig;\n+  user?: TUserDetails;\n+  value: Content;\n+}\n+\n // read only editor props\n export interface IReadOnlyEditorProps\n   extends Pick<\n     IEditorProps,\n@@ -180,12 +188,8 @@\n }\n \n export type ILiteTextReadOnlyEditorProps = IReadOnlyEditorProps;\n \n-export interface IDocumentReadOnlyEditorProps extends IReadOnlyEditorProps {\n-  embedHandler: TEmbedConfig;\n-}\n-\n export interface EditorEvents {\n   beforeCreate: never;\n   create: never;\n   update: never;\n"
        },
        {
          "path": "packages/editor/src/core/types/hook.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/types/hook.ts\n===================================================================\n--- packages/editor/src/core/types/hook.ts\te20bfa5 (parent)\n+++ packages/editor/src/core/types/hook.ts\t27f7420 (commit)\n@@ -1,5 +1,6 @@\n import type { HocuspocusProvider } from \"@hocuspocus/provider\";\n+import type { Content } from \"@tiptap/core\";\n import type { EditorProps } from \"@tiptap/pm/view\";\n // local imports\n import type { ICollaborativeDocumentEditorProps, IEditorProps, IReadOnlyEditorProps } from \"./editor\";\n \n@@ -26,9 +27,9 @@\n     | \"value\"\n   > & {\n     editable: boolean;\n     enableHistory: boolean;\n-    initialValue?: string;\n+    initialValue?: Content;\n     provider?: HocuspocusProvider;\n   };\n \n export type TCollaborativeEditorHookProps = TCoreHookProps &\n"
        },
        {
          "path": "packages/editor/src/index.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/index.ts\n===================================================================\n--- packages/editor/src/index.ts\te20bfa5 (parent)\n+++ packages/editor/src/index.ts\t27f7420 (commit)\n@@ -8,33 +8,21 @@\n \n // editors\n export {\n   CollaborativeDocumentEditorWithRef,\n-  DocumentReadOnlyEditorWithRef,\n+  DocumentEditorWithRef,\n   LiteTextEditorWithRef,\n   LiteTextReadOnlyEditorWithRef,\n   RichTextEditorWithRef,\n } from \"@/components/editors\";\n \n-export { isCellSelection } from \"@/extensions/table/table/utilities/helpers\";\n-\n // constants\n export * from \"@/constants/common\";\n \n // helpers\n export * from \"@/helpers/common\";\n-export * from \"@/helpers/editor-commands\";\n export * from \"@/helpers/yjs-utils\";\n-export * from \"@/extensions/table/table\";\n \n-// components\n-export * from \"@/components/menus\";\n-\n-// hooks\n-export { useEditor } from \"@/hooks/use-editor\";\n-export { type IMarking, useEditorMarkings } from \"@/hooks/use-editor-markings\";\n-export { useReadOnlyEditor } from \"@/hooks/use-read-only-editor\";\n-\n export { CORE_EXTENSIONS } from \"@/constants/extension\";\n export { ADDITIONAL_EXTENSIONS } from \"@/plane-editor/constants/extensions\";\n \n // types\n"
        }
      ]
    },
    {
      "id": "add-touch-support",
      "sha": "c3273b1a857dfe5c0d9c8f33b9e078d756f0b233",
      "parentSha": "7cec92113f091c8fa2cd540dbffb38d0ecf4e7ab",
      "spec": "- Add touch-device awareness end to end\n  - Introduce and propagate isTouchDevice?: boolean through the editor stack.\n    - Accept isTouchDevice in IEditorProps and thread it through EditorWrapper and CollaborativeDocumentEditor to PageRenderer and EditorContainer, then into hooks use-editor and use-collaborative-editor, and into CoreEditorExtensions and UtilityExtension storage.\n    - In UtilityExtension storage, add isTouchDevice: boolean and initialize it from props so extensions/components can read it via getExtensionStorage(editor, CORE_EXTENSIONS.UTILITY).\n    - In CoreEditorExtensions, accept isTouchDevice and pass it to UtilityExtension.\n  - Adjust UI behavior for touch devices:\n    - PageRenderer: add props isTouchDevice and documentLoaderClassName; pass className to DocumentContentLoader; pass isTouchDevice to EditorContainer; when editor.isEditable, suppress BubbleMenu and BlockMenu on touch devices.\n    - EditorContainer: add isTouchDevice and, when true, do not render LinkViewContainer.\n    - Custom Image extension UI:\n      - In block component: read isTouchDevice from UtilityExtension storage; on image mousedown prevent default and blur on touch; on image restore, use extension.options.getImageSource for refreshed src on touch; pass isTouchDevice to ImageToolbarRoot.\n      - In toolbar root: accept isTouchDevice and hide ImageDownloadAction when true; pass isTouchDevice into full-screen action root.\n      - In full-screen action root: accept isTouchDevice and forward it to the modal; disable tooltip when touch.\n      - In full-screen modal: accept isTouchDevice; for zoom buttons, prevent default/stop propagation on touch; hide Download and Open-in-new-tab buttons on touch devices; when #editor-portal is missing, portal the modal to document.body instead of just logging.\n      - In uploader: read isTouchDevice from UtilityExtension storage and avoid programmatic file input clicks on touch devices for the \"insert\" flow.\n- Collaborative editor configuration and prop plumbing\n  - In CollaborativeDocumentEditor: accept new props documentLoaderClassName?, editorProps?, dragDropEnabled? (default true), isTouchDevice?, onEditorFocus?. Build extensions via useMemo from external extensions and conditionally append WorkItemEmbedExtension when embedHandler.issue exists. Pass new props to useCollaborativeEditor and PageRenderer.\n  - In use-collaborative-editor: accept dragDropEnabled (default true), isTouchDevice, onEditorFocus; pass dragDropEnabled to SideMenuExtension; pass isTouchDevice and onEditorFocus through to useEditor.\n- Core editor hook and wrapper updates\n  - In EditorWrapper: accept editorProps, isTouchDevice, onEditorFocus; forward isTouchDevice to EditorContainer; pass editorProps and onEditorFocus into useEditor.\n  - In use-editor: accept isTouchDevice and onEditorFocus; pass isTouchDevice to CoreEditorExtensions and set onFocus handler in Editor options.\n- Menu: add a Link command\n  - In menu-items.ts: import LinkIcon and editor link commands; define LinkItem with key \"link\" that applies or unsets link, optionally replacing selection text; include LinkItem in getEditorMenuItems; ensure HorizontalRuleItem is explicitly typed as EditorMenuItem<\"divider\">.\n- Editor commands for links\n  - In editor-commands.ts: update setLinkEditor(editor, url, text?) to optionally replace the selection with provided text, select it, then set the link href; retain unsetLinkEditor unchanged.\n- Editor ref API extensions and signature adjustment\n  - In editor-ref.ts and corresponding types: add methods to EditorRefApi: createSelectionAtCursorPosition (selects word under caret if selection empty), focus(options), getCoordsFromPos(pos?), getAttributesWithExtendedMark(mark, attribute), redo(), undo().\n  - Change scrollToNodeViaDOMCoordinates signature to accept an object { pos?: number; behavior?: ScrollBehavior } and default behavior to \"smooth\".\n- Type and contract updates\n  - In types/editor.ts: extend TEditorCommands with \"link\" and TCommandExtraProps with link { url: string; text?: string }. Add editorProps?: EditorProps, isTouchDevice?: boolean, onEditorFocus?: () => void to IEditorProps. Update ICollaborativeDocumentEditorProps to include documentLoaderClassName?, dragDropEnabled?, editable and allow external extensions. Extend EditorRefApi with new methods and updated scrollToNodeViaDOMCoordinates signature.\n  - In types/hook.ts: include editorProps, isTouchDevice, onEditorFocus in TCoreHookProps; include dragDropEnabled in TCollaborativeEditorHookProps.\n  - In types/config.ts: add \"mobile-font\" to TEditorFontSize and \"mobile-regular\" to TEditorLineSpacing.\n- Mobile typography tokens\n  - In styles/variables.css: add .mobile-font font size/line-height tokens for headings, regular, code, list; add .line-spacing-mobile-regular spacing tokens for headings, paragraphs, lists, and divider.\n- Behavioral acceptance criteria\n  - On touch devices: bubble and block menus are hidden; link view overlay is not rendered; image toolbar hides Download/Open controls and tooltip is disabled; zoom controls handle touch events without side effects; uploader does not auto-invoke file picker; tapping an image does not propagate focus and blurs the editor.\n  - Link menu item appears in editor item registry and can set a link with optional replacement text or unset a link when no URL is provided.\n  - Editor ref exposes new utility methods and adjusted scrollToNodeViaDOMCoordinates signature.\n  - Collaborative editor respects dragDropEnabled and document loader can be styled via documentLoaderClassName.\n  - Mobile typography classes are available for use by displayConfig to render compact text on mobile.",
      "prompt": "Implement touch device support and link tooling across the rich text editor. Add an isTouchDevice flag that flows through editor props, hooks, and extensions, and conditionally disable desktop-only UI on touch (bubble/block menus, link overlay, image download/open controls, tooltips, and automatic file picker). Provide mobile-friendly typography and spacing tokens. Expose a dragDropEnabled toggle for collaborative mode and a className override for the document loader. Add a Link menu command that can set or unset links and optionally replace the current selection with provided text. Expand the editor ref API with utilities to select the word at the cursor, focus with options, get coordinates at a position, extend mark range when retrieving attributes, and perform undo/redo, and change the scroll-to-node method to accept an options object.",
      "supplementalFiles": [
        "packages/editor/src/core/constants/extension.ts",
        "packages/editor/src/core/helpers/get-extension-storage.ts",
        "packages/editor/src/core/helpers/scroll-to-node.ts",
        "packages/editor/src/core/extensions/custom-link/extension.tsx",
        "packages/editor/src/core/extensions/side-menu/index.ts"
      ],
      "fileDiffs": [
        {
          "path": "packages/editor/src/core/components/editors/document/collaborative-editor.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/components/editors/document/collaborative-editor.tsx\n===================================================================\n--- packages/editor/src/core/components/editors/document/collaborative-editor.tsx\t7cec921 (parent)\n+++ packages/editor/src/core/components/editors/document/collaborative-editor.tsx\tc3273b1 (commit)\n@@ -1,6 +1,6 @@\n-import { Extensions } from \"@tiptap/core\";\n-import React from \"react\";\n+import type { Extensions } from \"@tiptap/core\";\n+import React, { useMemo } from \"react\";\n // plane imports\n import { cn } from \"@plane/utils\";\n // components\n import { PageRenderer } from \"@/components/editors\";\n@@ -12,61 +12,75 @@\n import { getEditorClassNames } from \"@/helpers/common\";\n // hooks\n import { useCollaborativeEditor } from \"@/hooks/use-collaborative-editor\";\n // types\n-import { EditorRefApi, ICollaborativeDocumentEditorProps } from \"@/types\";\n+import type { EditorRefApi, ICollaborativeDocumentEditorProps } from \"@/types\";\n \n const CollaborativeDocumentEditor: React.FC<ICollaborativeDocumentEditorProps> = (props) => {\n   const {\n     aiHandler,\n     bubbleMenuEnabled = true,\n     containerClassName,\n+    documentLoaderClassName,\n+    extensions: externalExtensions = [],\n     disabledExtensions,\n     displayConfig = DEFAULT_DISPLAY_CONFIG,\n     editable,\n     editorClassName = \"\",\n+    editorProps,\n     embedHandler,\n     fileHandler,\n     flaggedExtensions,\n     forwardedRef,\n     handleEditorReady,\n     id,\n+    dragDropEnabled = true,\n+    isTouchDevice,\n     mentionHandler,\n     onAssetChange,\n     onChange,\n+    onEditorFocus,\n     onTransaction,\n     placeholder,\n     realtimeConfig,\n     serverHandler,\n     tabIndex,\n     user,\n   } = props;\n \n-  const extensions: Extensions = [];\n+  const extensions: Extensions = useMemo(() => {\n+    const allExtensions = [...externalExtensions];\n \n-  if (embedHandler?.issue) {\n-    extensions.push(\n-      WorkItemEmbedExtension({\n-        widgetCallback: embedHandler.issue.widgetCallback,\n-      })\n-    );\n-  }\n+    if (embedHandler?.issue) {\n+      allExtensions.push(\n+        WorkItemEmbedExtension({\n+          widgetCallback: embedHandler.issue.widgetCallback,\n+        })\n+      );\n+    }\n \n+    return allExtensions;\n+  }, [externalExtensions, embedHandler.issue]);\n+\n   // use document editor\n   const { editor, hasServerConnectionFailed, hasServerSynced } = useCollaborativeEditor({\n     disabledExtensions,\n     editable,\n     editorClassName,\n+    editorProps,\n     embedHandler,\n     extensions,\n     fileHandler,\n     flaggedExtensions,\n     forwardedRef,\n     handleEditorReady,\n     id,\n+    dragDropEnabled,\n+    isTouchDevice,\n     mentionHandler,\n     onAssetChange,\n     onChange,\n+    onEditorFocus,\n     onTransaction,\n     placeholder,\n     realtimeConfig,\n     serverHandler,\n@@ -86,11 +100,13 @@\n     <PageRenderer\n       aiHandler={aiHandler}\n       bubbleMenuEnabled={bubbleMenuEnabled}\n       displayConfig={displayConfig}\n+      documentLoaderClassName={documentLoaderClassName}\n       editor={editor}\n       editorContainerClassName={cn(editorContainerClassNames, \"document-editor\")}\n       id={id}\n+      isTouchDevice={!!isTouchDevice}\n       isLoading={!hasServerSynced && !hasServerConnectionFailed}\n       tabIndex={tabIndex}\n     />\n   );\n"
        },
        {
          "path": "packages/editor/src/core/components/editors/document/page-renderer.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/components/editors/document/page-renderer.tsx\n===================================================================\n--- packages/editor/src/core/components/editors/document/page-renderer.tsx\t7cec921 (parent)\n+++ packages/editor/src/core/components/editors/document/page-renderer.tsx\tc3273b1 (commit)\n@@ -10,36 +10,49 @@\n type Props = {\n   aiHandler?: TAIHandler;\n   bubbleMenuEnabled: boolean;\n   displayConfig: TDisplayConfig;\n+  documentLoaderClassName?: string;\n   editor: Editor;\n   editorContainerClassName: string;\n   id: string;\n   isLoading?: boolean;\n+  isTouchDevice: boolean;\n   tabIndex?: number;\n };\n \n export const PageRenderer = (props: Props) => {\n-  const { aiHandler, bubbleMenuEnabled, displayConfig, editor, editorContainerClassName, id, isLoading, tabIndex } =\n-    props;\n+  const {\n+    aiHandler,\n+    bubbleMenuEnabled,\n+    displayConfig,\n+    documentLoaderClassName,\n+    editor,\n+    editorContainerClassName,\n+    id,\n+    isLoading,\n+    isTouchDevice,\n+    tabIndex,\n+  } = props;\n \n   return (\n     <div\n       className={cn(\"frame-renderer flex-grow w-full\", {\n         \"wide-layout\": displayConfig.wideLayout,\n       })}\n     >\n       {isLoading ? (\n-        <DocumentContentLoader />\n+        <DocumentContentLoader className={documentLoaderClassName} />\n       ) : (\n         <EditorContainer\n           displayConfig={displayConfig}\n           editor={editor}\n           editorContainerClassName={editorContainerClassName}\n           id={id}\n+          isTouchDevice={isTouchDevice}\n         >\n           <EditorContentWrapper editor={editor} id={id} tabIndex={tabIndex} />\n-          {editor.isEditable && (\n+          {editor.isEditable && !isTouchDevice && (\n             <div>\n               {bubbleMenuEnabled && <EditorBubbleMenu editor={editor} />}\n               <BlockMenu editor={editor} />\n               <AIFeaturesMenu menu={aiHandler?.menu} />\n"
        },
        {
          "path": "packages/editor/src/core/components/editors/editor-container.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/components/editors/editor-container.tsx\n===================================================================\n--- packages/editor/src/core/components/editors/editor-container.tsx\t7cec921 (parent)\n+++ packages/editor/src/core/components/editors/editor-container.tsx\tc3273b1 (commit)\n@@ -1,5 +1,5 @@\n-import { Editor } from \"@tiptap/react\";\n+import type { Editor } from \"@tiptap/react\";\n import { FC, ReactNode, useRef } from \"react\";\n // plane utils\n import { cn } from \"@plane/utils\";\n // constants\n@@ -9,18 +9,20 @@\n import { TDisplayConfig } from \"@/types\";\n // components\n import { LinkViewContainer } from \"./link-view-container\";\n \n-interface EditorContainerProps {\n+type Props = {\n   children: ReactNode;\n   displayConfig: TDisplayConfig;\n   editor: Editor;\n   editorContainerClassName: string;\n   id: string;\n-}\n+  isTouchDevice: boolean;\n+};\n \n-export const EditorContainer: FC<EditorContainerProps> = (props) => {\n-  const { children, displayConfig, editor, editorContainerClassName, id } = props;\n+export const EditorContainer: FC<Props> = (props) => {\n+  const { children, displayConfig, editor, editorContainerClassName, id, isTouchDevice } = props;\n+  // refs\n   const containerRef = useRef<HTMLDivElement>(null);\n \n   const handleContainerClick = (event: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n     if (event.target !== event.currentTarget) return;\n@@ -93,9 +95,9 @@\n           editorContainerClassName\n         )}\n       >\n         {children}\n-        <LinkViewContainer editor={editor} containerRef={containerRef} />\n+        {!isTouchDevice && <LinkViewContainer editor={editor} containerRef={containerRef} />}\n       </div>\n     </>\n   );\n };\n"
        },
        {
          "path": "packages/editor/src/core/components/editors/editor-wrapper.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/components/editors/editor-wrapper.tsx\n===================================================================\n--- packages/editor/src/core/components/editors/editor-wrapper.tsx\t7cec921 (parent)\n+++ packages/editor/src/core/components/editors/editor-wrapper.tsx\tc3273b1 (commit)\n@@ -23,16 +23,19 @@\n     disabledExtensions,\n     displayConfig = DEFAULT_DISPLAY_CONFIG,\n     editable,\n     editorClassName = \"\",\n+    editorProps,\n     extensions,\n     id,\n     initialValue,\n+    isTouchDevice,\n     fileHandler,\n     flaggedExtensions,\n     forwardedRef,\n     mentionHandler,\n     onChange,\n+    onEditorFocus,\n     onTransaction,\n     handleEditorReady,\n     autofocus,\n     placeholder,\n@@ -43,17 +46,20 @@\n   const editor = useEditor({\n     editable,\n     disabledExtensions,\n     editorClassName,\n+    editorProps,\n     enableHistory: true,\n     extensions,\n     fileHandler,\n     flaggedExtensions,\n     forwardedRef,\n     id,\n+    isTouchDevice,\n     initialValue,\n     mentionHandler,\n     onChange,\n+    onEditorFocus,\n     onTransaction,\n     handleEditorReady,\n     autofocus,\n     placeholder,\n@@ -74,8 +80,9 @@\n       displayConfig={displayConfig}\n       editor={editor}\n       editorContainerClassName={editorContainerClassName}\n       id={id}\n+      isTouchDevice={!!isTouchDevice}\n     >\n       {children?.(editor)}\n       <div className=\"flex flex-col\">\n         <EditorContentWrapper editor={editor} id={id} tabIndex={tabIndex} />\n"
        },
        {
          "path": "packages/editor/src/core/components/menus/menu-items.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/components/menus/menu-items.ts\n===================================================================\n--- packages/editor/src/core/components/menus/menu-items.ts\t7cec921 (parent)\n+++ packages/editor/src/core/components/menus/menu-items.ts\tc3273b1 (commit)\n@@ -21,16 +21,18 @@\n   LucideIcon,\n   MinusSquare,\n   Palette,\n   AlignCenter,\n+  LinkIcon,\n } from \"lucide-react\";\n // constants\n import { CORE_EXTENSIONS } from \"@/constants/extension\";\n // helpers\n import {\n   insertHorizontalRule,\n   insertImage,\n   insertTableCommand,\n+  setLinkEditor,\n   setText,\n   setTextAlign,\n   toggleBackgroundColor,\n   toggleBlockquote,\n@@ -43,8 +45,9 @@\n   toggleStrike,\n   toggleTaskList,\n   toggleTextColor,\n   toggleUnderline,\n+  unsetLinkEditor,\n } from \"@/helpers/editor-commands\";\n // types\n import { TCommandWithProps, TEditorCommands } from \"@/types\";\n \n@@ -188,17 +191,30 @@\n   command: () => insertImage({ editor, event: \"insert\", pos: editor.state.selection.from }),\n   icon: ImageIcon,\n });\n \n-export const HorizontalRuleItem = (editor: Editor) =>\n+export const HorizontalRuleItem = (editor: Editor): EditorMenuItem<\"divider\"> =>\n   ({\n     key: \"divider\",\n     name: \"Divider\",\n     isActive: () => editor?.isActive(CORE_EXTENSIONS.HORIZONTAL_RULE),\n     command: () => insertHorizontalRule(editor),\n     icon: MinusSquare,\n   }) as const;\n \n+export const LinkItem = (editor: Editor): EditorMenuItem<\"link\"> =>\n+  ({\n+    key: \"link\",\n+    name: \"Link\",\n+    isActive: () => editor?.isActive(\"link\"),\n+    command: (props) => {\n+      if (!props) return;\n+      if (props.url) setLinkEditor(editor, props.url, props.text);\n+      else unsetLinkEditor(editor);\n+    },\n+    icon: LinkIcon,\n+  }) as const;\n+\n export const TextColorItem = (editor: Editor): EditorMenuItem<\"text-color\"> => ({\n   key: \"text-color\",\n   name: \"Color\",\n   isActive: (props) => editor.isActive(CORE_EXTENSIONS.CUSTOM_COLOR, { color: props?.color }),\n@@ -253,8 +269,9 @@\n     QuoteItem(editor),\n     TableItem(editor),\n     ImageItem(editor),\n     HorizontalRuleItem(editor),\n+    LinkItem(editor),\n     TextColorItem(editor),\n     BackgroundColorItem(editor),\n     TextAlignItem(editor),\n   ];\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/block.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/block.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/block.tsx\t7cec921 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/block.tsx\tc3273b1 (commit)\n@@ -1,8 +1,12 @@\n import { NodeSelection } from \"@tiptap/pm/state\";\n import React, { useRef, useState, useCallback, useLayoutEffect, useEffect } from \"react\";\n // plane imports\n import { cn } from \"@plane/utils\";\n+// constants\n+import { CORE_EXTENSIONS } from \"@/constants/extension\";\n+// helpers\n+import { getExtensionStorage } from \"@/helpers/get-extension-storage\";\n // local imports\n import { Pixel, TCustomImageAttributes, TCustomImageSize } from \"../types\";\n import { ensurePixelString, getImageBlockId } from \"../utils\";\n import type { CustomImageNodeViewProps } from \"./node-view\";\n@@ -56,8 +60,10 @@\n   const containerRect = useRef<DOMRect | null>(null);\n   const imageRef = useRef<HTMLImageElement>(null);\n   const [hasErroredOnFirstLoad, setHasErroredOnFirstLoad] = useState(false);\n   const [hasTriedRestoringImageOnce, setHasTriedRestoringImageOnce] = useState(false);\n+  // extension options\n+  const isTouchDevice = !!getExtensionStorage(editor, CORE_EXTENSIONS.UTILITY).isTouchDevice;\n \n   const updateAttributesSafely = useCallback(\n     (attributes: Partial<TCustomImageAttributes>, errorMessage: string) => {\n       try {\n@@ -187,13 +193,17 @@\n \n   const handleImageMouseDown = useCallback(\n     (e: React.MouseEvent) => {\n       e.stopPropagation();\n+      if (isTouchDevice) {\n+        e.preventDefault();\n+        editor.commands.blur();\n+      }\n       const pos = getPos();\n       const nodeSelection = NodeSelection.create(editor.state.doc, pos);\n       editor.view.dispatch(editor.state.tr.setSelection(nodeSelection));\n     },\n-    [editor, getPos]\n+    [editor, getPos, isTouchDevice]\n   );\n \n   // show the image loader if the remote image's src or preview image from filesystem is not set yet (while loading the image post upload) (or)\n   // if the initial resize (from 35% width and \"auto\" height attrs to the actual size in px) is not complete\n@@ -253,9 +263,14 @@\n               }\n               if (!resolvedImageSrc) {\n                 throw new Error(\"No resolved image source available\");\n               }\n-              imageRef.current.src = resolvedImageSrc;\n+              if (isTouchDevice) {\n+                const refreshedSrc = await extension.options.getImageSource?.(imgNodeSrc);\n+                imageRef.current.src = refreshedSrc;\n+              } else {\n+                imageRef.current.src = resolvedImageSrc;\n+              }\n             } catch {\n               // if the image failed to even restore, then show the error state\n               setFailedToLoadImage(true);\n               console.error(\"Error while loading image\", e);\n@@ -280,16 +295,17 @@\n         {showImageToolbar && (\n           <ImageToolbarRoot\n             alignment={nodeAlignment ?? \"left\"}\n             editor={editor}\n-            width={size.width}\n-            height={size.height}\n             aspectRatio={size.aspectRatio === null ? 1 : size.aspectRatio}\n-            src={resolvedImageSrc}\n             downloadSrc={resolvedDownloadSrc}\n             handleAlignmentChange={(alignment) =>\n               updateAttributesSafely({ alignment }, \"Failed to update attributes while changing alignment:\")\n             }\n+            height={size.height}\n+            isTouchDevice={isTouchDevice}\n+            width={size.width}\n+            src={resolvedImageSrc}\n           />\n         )}\n         {selected && displayedImageSrc === resolvedImageSrc && (\n           <div className=\"absolute inset-0 size-full bg-custom-primary-500/30 pointer-events-none\" />\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/node-view.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/node-view.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/node-view.tsx\t7cec921 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/node-view.tsx\tc3273b1 (commit)\n@@ -23,9 +23,9 @@\n export const CustomImageNodeView: React.FC<CustomImageNodeViewProps> = (props) => {\n   const { editor, extension, node } = props;\n   const { src: imgNodeSrc } = node.attrs;\n \n-  const [isUploaded, setIsUploaded] = useState(false);\n+  const [isUploaded, setIsUploaded] = useState(!!imgNodeSrc);\n   const [resolvedSrc, setResolvedSrc] = useState<string | undefined>(undefined);\n   const [resolvedDownloadSrc, setResolvedDownloadSrc] = useState<string | undefined>(undefined);\n   const [imageFromFileSystem, setImageFromFileSystem] = useState<string | undefined>(undefined);\n   const [failedToLoadImage, setFailedToLoadImage] = useState(false);\n@@ -42,15 +42,15 @@\n \n   // the image is already uploaded if the image-component node has src attribute\n   // and we need to remove the blob from our file system\n   useEffect(() => {\n-    if (resolvedSrc) {\n+    if (resolvedSrc || imgNodeSrc) {\n       setIsUploaded(true);\n       setImageFromFileSystem(undefined);\n     } else {\n       setIsUploaded(false);\n     }\n-  }, [resolvedSrc]);\n+  }, [resolvedSrc, imgNodeSrc]);\n \n   useEffect(() => {\n     if (!imgNodeSrc) {\n       setResolvedSrc(undefined);\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/modal.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/modal.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/modal.tsx\t7cec921 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/modal.tsx\tc3273b1 (commit)\n@@ -10,17 +10,18 @@\n const ZOOM_STEPS = [0.5, 1, 1.5, 2];\n \n type Props = {\n   aspectRatio: number;\n-  isFullScreenEnabled: boolean;\n   downloadSrc: string;\n+  isFullScreenEnabled: boolean;\n+  isTouchDevice: boolean;\n   src: string;\n   toggleFullScreenMode: (val: boolean) => void;\n   width: string;\n };\n \n const ImageFullScreenModalWithoutPortal = (props: Props) => {\n-  const { aspectRatio, isFullScreenEnabled, downloadSrc, src, toggleFullScreenMode, width } = props;\n+  const { aspectRatio, isFullScreenEnabled, isTouchDevice, downloadSrc, src, toggleFullScreenMode, width } = props;\n   // refs\n   const dragStart = useRef({ x: 0, y: 0 });\n   const dragOffset = useRef({ x: 0, y: 0 });\n \n@@ -232,9 +233,15 @@\n         <div className=\"fixed bottom-10 left-1/2 -translate-x-1/2 flex items-center justify-center gap-1 rounded-md border border-white/20 py-2 divide-x divide-white/20 bg-black\">\n           <div className=\"flex items-center\">\n             <button\n               type=\"button\"\n-              onClick={() => handleMagnification(\"decrease\")}\n+              onClick={(e) => {\n+                if (isTouchDevice) {\n+                  e.preventDefault();\n+                  e.stopPropagation();\n+                }\n+                handleMagnification(\"decrease\");\n+              }}\n               className=\"size-6 grid place-items-center text-white/60 hover:text-white disabled:text-white/30 transition-colors duration-200\"\n               disabled={magnification <= MIN_ZOOM}\n               aria-label=\"Zoom out\"\n             >\n@@ -242,32 +249,42 @@\n             </button>\n             <span className=\"text-sm w-12 text-center text-white\">{Math.round(100 * magnification)}%</span>\n             <button\n               type=\"button\"\n-              onClick={() => handleMagnification(\"increase\")}\n+              onClick={(e) => {\n+                if (isTouchDevice) {\n+                  e.preventDefault();\n+                  e.stopPropagation();\n+                }\n+                handleMagnification(\"increase\");\n+              }}\n               className=\"size-6 grid place-items-center text-white/60 hover:text-white disabled:text-white/30 transition-colors duration-200\"\n               disabled={magnification >= MAX_ZOOM}\n               aria-label=\"Zoom in\"\n             >\n               <Plus className=\"size-4\" />\n             </button>\n           </div>\n-          <button\n-            type=\"button\"\n-            onClick={() => window.open(downloadSrc, \"_blank\")}\n-            className=\"flex-shrink-0 size-8 grid place-items-center text-white/60 hover:text-white transition-colors duration-200\"\n-            aria-label=\"Download image\"\n-          >\n-            <Download className=\"size-4\" />\n-          </button>\n-          <button\n-            type=\"button\"\n-            onClick={() => window.open(src, \"_blank\")}\n-            className=\"flex-shrink-0 size-8 grid place-items-center text-white/60 hover:text-white transition-colors duration-200\"\n-            aria-label=\"Open image in new tab\"\n-          >\n-            <ExternalLink className=\"size-4\" />\n-          </button>\n+          {!isTouchDevice && (\n+            <button\n+              type=\"button\"\n+              onClick={() => window.open(downloadSrc, \"_blank\")}\n+              className=\"flex-shrink-0 size-8 grid place-items-center text-white/60 hover:text-white transition-colors duration-200\"\n+              aria-label=\"Download image\"\n+            >\n+              <Download className=\"size-4\" />\n+            </button>\n+          )}\n+          {!isTouchDevice && (\n+            <button\n+              type=\"button\"\n+              onClick={() => window.open(src, \"_blank\")}\n+              className=\"flex-shrink-0 size-8 grid place-items-center text-white/60 hover:text-white transition-colors duration-200\"\n+              aria-label=\"Open image in new tab\"\n+            >\n+              <ExternalLink className=\"size-4\" />\n+            </button>\n+          )}\n         </div>\n       </div>\n     </div>\n   );\n@@ -278,8 +295,11 @@\n   const portal = document.querySelector(\"#editor-portal\");\n   if (portal) {\n     modal = ReactDOM.createPortal(modal, portal);\n   } else {\n-    console.warn(\"Portal element #editor-portal not found. Rendering inline.\");\n+    console.warn(\"Portal element #editor-portal not found. Rendering in document.body\");\n+    if (typeof document !== \"undefined\" && document.body) {\n+      modal = ReactDOM.createPortal(modal, document.body);\n+    }\n   }\n   return modal;\n };\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/root.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/root.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/root.tsx\t7cec921 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/root.tsx\tc3273b1 (commit)\n@@ -6,19 +6,20 @@\n import { ImageFullScreenModal } from \"./modal\";\n \n type Props = {\n   image: {\n+    aspectRatio: number;\n     downloadSrc: string;\n-    src: string;\n     height: string;\n+    src: string;\n     width: string;\n-    aspectRatio: number;\n   };\n+  isTouchDevice: boolean;\n   toggleToolbarViewStatus: (val: boolean) => void;\n };\n \n export const ImageFullScreenActionRoot: React.FC<Props> = (props) => {\n-  const { image, toggleToolbarViewStatus } = props;\n+  const { image, isTouchDevice, toggleToolbarViewStatus } = props;\n   // states\n   const [isFullScreenEnabled, setIsFullScreenEnabled] = useState(false);\n   // derived values\n   const { downloadSrc, src, width, aspectRatio } = image;\n@@ -30,15 +31,16 @@\n   return (\n     <>\n       <ImageFullScreenModal\n         aspectRatio={aspectRatio}\n+        downloadSrc={downloadSrc}\n         isFullScreenEnabled={isFullScreenEnabled}\n+        isTouchDevice={isTouchDevice}\n         src={src}\n-        downloadSrc={downloadSrc}\n         width={width}\n         toggleFullScreenMode={setIsFullScreenEnabled}\n       />\n-      <Tooltip tooltipContent=\"View in full screen\">\n+      <Tooltip tooltipContent=\"View in full screen\" disabled={isTouchDevice}>\n         <button\n           type=\"button\"\n           onClick={(e) => {\n             e.preventDefault();\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/toolbar/root.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/toolbar/root.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/toolbar/root.tsx\t7cec921 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/toolbar/root.tsx\tc3273b1 (commit)\n@@ -10,18 +10,19 @@\n \n type Props = {\n   alignment: TCustomImageAlignment;\n   editor: Editor;\n-  width: string;\n-  height: string;\n   aspectRatio: number;\n-  src: string;\n   downloadSrc: string;\n   handleAlignmentChange: (alignment: TCustomImageAlignment) => void;\n+  height: string;\n+  isTouchDevice: boolean;\n+  src: string;\n+  width: string;\n };\n \n export const ImageToolbarRoot: React.FC<Props> = (props) => {\n-  const { alignment, editor, downloadSrc, handleAlignmentChange } = props;\n+  const { alignment, editor, downloadSrc, handleAlignmentChange, isTouchDevice } = props;\n   // states\n   const [shouldShowToolbar, setShouldShowToolbar] = useState(false);\n   // derived values\n   const isEditable = editor.isEditable;\n@@ -35,17 +36,21 @@\n             \"opacity-100 pointer-events-auto\": shouldShowToolbar,\n           }\n         )}\n       >\n-        <ImageDownloadAction src={downloadSrc} />\n+        {!isTouchDevice && <ImageDownloadAction src={downloadSrc} />}\n         {isEditable && (\n           <ImageAlignmentAction\n             activeAlignment={alignment}\n             handleChange={handleAlignmentChange}\n             toggleToolbarViewStatus={setShouldShowToolbar}\n           />\n         )}\n-        <ImageFullScreenActionRoot image={props} toggleToolbarViewStatus={setShouldShowToolbar} />\n+        <ImageFullScreenActionRoot\n+          image={props}\n+          isTouchDevice={isTouchDevice}\n+          toggleToolbarViewStatus={setShouldShowToolbar}\n+        />\n       </div>\n     </>\n   );\n };\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/uploader.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/uploader.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/uploader.tsx\t7cec921 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/uploader.tsx\tc3273b1 (commit)\n@@ -39,8 +39,9 @@\n   const hasTriggeredFilePickerRef = useRef(false);\n   const { id: imageEntityId } = node.attrs;\n   // derived values\n   const imageComponentImageFileMap = useMemo(() => getImageComponentImageFileMap(editor), [editor]);\n+  const isTouchDevice = !!getExtensionStorage(editor, CORE_EXTENSIONS.UTILITY).isTouchDevice;\n \n   const onUpload = useCallback(\n     (url: string) => {\n       if (url) {\n@@ -124,14 +125,16 @@\n       if (meta.event === \"drop\" && \"file\" in meta) {\n         uploadFile(meta.file);\n       } else if (meta.event === \"insert\" && fileInputRef.current && !hasTriggeredFilePickerRef.current) {\n         if (meta.hasOpenedFileInputOnce) return;\n-        fileInputRef.current.click();\n+        if (!isTouchDevice) {\n+          fileInputRef.current.click();\n+        }\n         hasTriggeredFilePickerRef.current = true;\n         imageComponentImageFileMap?.set(imageEntityId ?? \"\", { ...meta, hasOpenedFileInputOnce: true });\n       }\n     }\n-  }, [meta, uploadFile, imageComponentImageFileMap, imageEntityId]);\n+  }, [meta, uploadFile, imageComponentImageFileMap, imageEntityId, isTouchDevice]);\n \n   const onFileChange = useCallback(\n     async (e: ChangeEvent<HTMLInputElement>) => {\n       e.preventDefault();\n"
        },
        {
          "path": "packages/editor/src/core/extensions/extensions.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/extensions.ts\n===================================================================\n--- packages/editor/src/core/extensions/extensions.ts\t7cec921 (parent)\n+++ packages/editor/src/core/extensions/extensions.ts\tc3273b1 (commit)\n@@ -37,9 +37,15 @@\n import { CustomStarterKitExtension } from \"./starter-kit\";\n \n type TArguments = Pick<\n   IEditorProps,\n-  \"disabledExtensions\" | \"flaggedExtensions\" | \"fileHandler\" | \"mentionHandler\" | \"placeholder\" | \"tabIndex\"\n+  | \"disabledExtensions\"\n+  | \"flaggedExtensions\"\n+  | \"fileHandler\"\n+  | \"isTouchDevice\"\n+  | \"mentionHandler\"\n+  | \"placeholder\"\n+  | \"tabIndex\"\n > & {\n   enableHistory: boolean;\n   editable: boolean;\n };\n@@ -49,8 +55,9 @@\n     disabledExtensions,\n     enableHistory,\n     fileHandler,\n     flaggedExtensions,\n+    isTouchDevice = false,\n     mentionHandler,\n     placeholder,\n     tabIndex,\n     editable,\n@@ -101,8 +108,9 @@\n     UtilityExtension({\n       disabledExtensions,\n       fileHandler,\n       isEditable: editable,\n+      isTouchDevice,\n     }),\n     ...CoreEditorAdditionalExtensions({\n       disabledExtensions,\n       flaggedExtensions,\n"
        },
        {
          "path": "packages/editor/src/core/extensions/utility.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/utility.ts\n===================================================================\n--- packages/editor/src/core/extensions/utility.ts\t7cec921 (parent)\n+++ packages/editor/src/core/extensions/utility.ts\tc3273b1 (commit)\n@@ -34,17 +34,19 @@\n   assetsList: TEditorAsset[];\n   assetsUploadStatus: TFileHandler[\"assetsUploadStatus\"];\n   uploadInProgress: boolean;\n   activeDropbarExtensions: TActiveDropbarExtensions[];\n+  isTouchDevice: boolean;\n }\n \n type Props = Pick<IEditorProps, \"disabledExtensions\"> & {\n   fileHandler: TFileHandler;\n   isEditable: boolean;\n+  isTouchDevice: boolean;\n };\n \n export const UtilityExtension = (props: Props) => {\n-  const { disabledExtensions, fileHandler, isEditable } = props;\n+  const { disabledExtensions, fileHandler, isEditable, isTouchDevice } = props;\n   const { restore } = fileHandler;\n \n   return Extension.create<Record<string, unknown>, UtilityExtensionStorage>({\n     name: \"utility\",\n@@ -75,8 +77,9 @@\n         assetsList: [],\n         assetsUploadStatus: isEditable && \"assetsUploadStatus\" in fileHandler ? fileHandler.assetsUploadStatus : {},\n         uploadInProgress: false,\n         activeDropbarExtensions: [],\n+        isTouchDevice,\n       };\n     },\n \n     addCommands() {\n"
        },
        {
          "path": "packages/editor/src/core/helpers/editor-commands.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/helpers/editor-commands.ts\n===================================================================\n--- packages/editor/src/core/helpers/editor-commands.ts\t7cec921 (parent)\n+++ packages/editor/src/core/helpers/editor-commands.ts\tc3273b1 (commit)\n@@ -126,9 +126,23 @@\n export const unsetLinkEditor = (editor: Editor) => {\n   editor.chain().focus().unsetLink().run();\n };\n \n-export const setLinkEditor = (editor: Editor, url: string) => {\n+export const setLinkEditor = (editor: Editor, url: string, text?: string) => {\n+  const { selection } = editor.state;\n+  const previousSelection = { from: selection.from, to: selection.to };\n+  if (text) {\n+    editor\n+      .chain()\n+      .focus()\n+      .deleteRange({ from: selection.from, to: selection.to })\n+      .insertContentAt(previousSelection.from, text)\n+      .run();\n+    // Extracting the new selection start point.\n+    const previousFrom = previousSelection.from;\n+\n+    editor.commands.setTextSelection({ from: previousFrom, to: previousFrom + text.length });\n+  }\n   editor.chain().focus().setLink({ href: url }).run();\n };\n \n export const toggleTextColor = (color: string | undefined, editor: Editor, range?: Range) => {\n"
        },
        {
          "path": "packages/editor/src/core/helpers/editor-ref.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/helpers/editor-ref.ts\n===================================================================\n--- packages/editor/src/core/helpers/editor-ref.ts\t7cec921 (parent)\n+++ packages/editor/src/core/helpers/editor-ref.ts\tc3273b1 (commit)\n@@ -23,11 +23,44 @@\n export const getEditorRefHelpers = (args: TArgs): EditorRefApi => {\n   const { editor, provider } = args;\n \n   return {\n+    blur: () => editor?.commands.blur(),\n     clearEditor: (emitUpdate = false) => {\n       editor?.chain().setMeta(CORE_EDITOR_META.SKIP_FILE_DELETION, true).clearContent(emitUpdate).run();\n     },\n+    createSelectionAtCursorPosition: () => {\n+      if (!editor) return;\n+      const { empty } = editor.state.selection;\n+\n+      if (empty) {\n+        // Get the text content and position info\n+        const { $from } = editor.state.selection;\n+        const textContent = $from.parent.textContent;\n+        const posInNode = $from.parentOffset;\n+\n+        // Find word boundaries\n+        let start = posInNode;\n+        let end = posInNode;\n+\n+        // Move start position backwards until we hit a word boundary\n+        while (start > 0 && /\\w/.test(textContent[start - 1])) {\n+          start--;\n+        }\n+\n+        // Move end position forwards until we hit a word boundary\n+        while (end < textContent.length && /\\w/.test(textContent[end])) {\n+          end++;\n+        }\n+\n+        // If we found a word, select it using editor commands\n+        if (start !== end) {\n+          const from = $from.start() + start;\n+          const to = $from.start() + end;\n+          editor.commands.setTextSelection({ from, to });\n+        }\n+      }\n+    },\n     getDocument: () => {\n       const documentBinary = provider?.document ? Y.encodeStateAsUpdate(provider?.document) : null;\n       const documentHTML = editor?.getHTML() ?? \"<p></p>\";\n       const documentJSON = editor?.getJSON() ?? null;\n@@ -54,9 +87,8 @@\n     },\n     setEditorValue: (content, emitUpdate = false) => {\n       editor?.commands.setContent(content, emitUpdate, { preserveWhitespace: true });\n     },\n-    blur: () => editor?.commands.blur(),\n     emitRealTimeUpdate: (message) => provider?.sendStateless(message),\n     executeMenuItemCommand: (props) => {\n       const { itemKey } = props;\n       const editorItems = getEditorMenuItems(editor);\n@@ -69,9 +101,16 @@\n       } else {\n         console.warn(`No command found for item: ${itemKey}`);\n       }\n     },\n+    focus: (args) => editor?.commands.focus(args),\n+    getCoordsFromPos: (pos) => editor?.view.coordsAtPos(pos ?? editor.state.selection.from),\n     getCurrentCursorPosition: () => editor?.state.selection.from,\n+    getAttributesWithExtendedMark: (mark, attribute) => {\n+      if (!editor) return;\n+      editor.commands.extendMarkRange(mark);\n+      return editor.getAttributes(attribute);\n+    },\n     getSelectedText: () => {\n       if (!editor) return null;\n \n       const { state } = editor;\n@@ -164,9 +203,10 @@\n       return () => {\n         editor?.off(\"transaction\", callback);\n       };\n     },\n-    scrollToNodeViaDOMCoordinates(behavior, pos) {\n+    redo: () => editor?.commands.redo(),\n+    scrollToNodeViaDOMCoordinates({ pos, behavior = \"smooth\" }) {\n       const resolvedPos = pos ?? editor?.state.selection.from;\n       if (!editor || !resolvedPos) return;\n       scrollToNodeViaDOMCoordinates(editor, resolvedPos, behavior);\n     },\n@@ -196,6 +236,7 @@\n       const document = provider?.document;\n       if (!document) return;\n       Y.applyUpdate(document, value);\n     },\n+    undo: () => editor?.commands.undo(),\n   };\n };\n"
        },
        {
          "path": "packages/editor/src/core/hooks/use-collaborative-editor.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/hooks/use-collaborative-editor.ts\n===================================================================\n--- packages/editor/src/core/hooks/use-collaborative-editor.ts\t7cec921 (parent)\n+++ packages/editor/src/core/hooks/use-collaborative-editor.ts\tc3273b1 (commit)\n@@ -26,9 +26,12 @@\n     flaggedExtensions,\n     forwardedRef,\n     handleEditorReady,\n     id,\n+    dragDropEnabled = true,\n+    isTouchDevice,\n     mentionHandler,\n+    onEditorFocus,\n     placeholder,\n     realtimeConfig,\n     serverHandler,\n     tabIndex,\n@@ -85,9 +88,9 @@\n     enableHistory: false,\n     extensions: [\n       SideMenuExtension({\n         aiEnabled: !disabledExtensions?.includes(\"ai\"),\n-        dragDropEnabled: true,\n+        dragDropEnabled,\n       }),\n       HeadingListExtension,\n       Collaboration.configure({\n         document: provider.document,\n@@ -106,11 +109,13 @@\n     fileHandler,\n     flaggedExtensions,\n     forwardedRef,\n     handleEditorReady,\n+    isTouchDevice,\n     mentionHandler,\n     onAssetChange,\n     onChange,\n+    onEditorFocus,\n     onTransaction,\n     placeholder,\n     provider,\n     tabIndex,\n"
        },
        {
          "path": "packages/editor/src/core/hooks/use-editor.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/hooks/use-editor.ts\n===================================================================\n--- packages/editor/src/core/hooks/use-editor.ts\t7cec921 (parent)\n+++ packages/editor/src/core/hooks/use-editor.ts\tc3273b1 (commit)\n@@ -26,11 +26,13 @@\n     forwardedRef,\n     handleEditorReady,\n     id = \"\",\n     initialValue,\n+    isTouchDevice,\n     mentionHandler,\n     onAssetChange,\n     onChange,\n+    onEditorFocus,\n     onTransaction,\n     placeholder,\n     provider,\n     tabIndex,\n@@ -56,8 +58,9 @@\n           disabledExtensions,\n           enableHistory,\n           fileHandler,\n           flaggedExtensions,\n+          isTouchDevice,\n           mentionHandler,\n           placeholder,\n           tabIndex,\n         }),\n@@ -69,8 +72,9 @@\n         onTransaction?.();\n       },\n       onUpdate: ({ editor }) => onChange?.(editor.getJSON(), editor.getHTML()),\n       onDestroy: () => handleEditorReady?.(false),\n+      onFocus: onEditorFocus,\n     },\n     [editable]\n   );\n \n"
        },
        {
          "path": "packages/editor/src/core/types/config.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/types/config.ts\n===================================================================\n--- packages/editor/src/core/types/config.ts\t7cec921 (parent)\n+++ packages/editor/src/core/types/config.ts\tc3273b1 (commit)\n@@ -20,11 +20,11 @@\n };\n \n export type TEditorFontStyle = \"sans-serif\" | \"serif\" | \"monospace\";\n \n-export type TEditorFontSize = \"small-font\" | \"large-font\";\n+export type TEditorFontSize = \"small-font\" | \"large-font\" | \"mobile-font\";\n \n-export type TEditorLineSpacing = \"regular\" | \"small\";\n+export type TEditorLineSpacing = \"regular\" | \"small\" | \"mobile-regular\";\n \n export type TDisplayConfig = {\n   fontStyle?: TEditorFontStyle;\n   fontSize?: TEditorFontSize;\n"
        },
        {
          "path": "packages/editor/src/core/types/editor.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/types/editor.ts\n===================================================================\n--- packages/editor/src/core/types/editor.ts\t7cec921 (parent)\n+++ packages/editor/src/core/types/editor.ts\tc3273b1 (commit)\n@@ -1,6 +1,8 @@\n-import type { Content, Extensions, JSONContent } from \"@tiptap/core\";\n+import type { Content, Extensions, JSONContent, RawCommands } from \"@tiptap/core\";\n+import type { MarkType, NodeType } from \"@tiptap/pm/model\";\n import type { Selection } from \"@tiptap/pm/state\";\n+import type { EditorProps, EditorView } from \"@tiptap/pm/view\";\n // extension types\n import type { TTextAlign } from \"@/extensions\";\n // helpers\n import type { IMarking } from \"@/helpers/scroll-to-node\";\n@@ -39,8 +41,9 @@\n   | \"code\"\n   | \"table\"\n   | \"image\"\n   | \"divider\"\n+  | \"link\"\n   | \"issue-embed\"\n   | \"text-color\"\n   | \"background-color\"\n   | \"text-align\"\n@@ -57,8 +60,12 @@\n   };\n   \"text-color\": {\n     color: string | undefined;\n   };\n+  link: {\n+    url: string;\n+    text?: string;\n+  };\n   \"background-color\": {\n     color: string | undefined;\n   };\n   \"text-align\": {\n@@ -83,10 +90,17 @@\n \n export type EditorRefApi = {\n   blur: () => void;\n   clearEditor: (emitUpdate?: boolean) => void;\n+  createSelectionAtCursorPosition: () => void;\n   emitRealTimeUpdate: (action: TDocumentEventsServer) => void;\n   executeMenuItemCommand: <T extends TEditorCommands>(props: TCommandWithPropsWithItemKey<T>) => void;\n+  focus: (args: Parameters<RawCommands[\"focus\"]>[0]) => void;\n+  getAttributesWithExtendedMark: (\n+    mark: string | MarkType,\n+    attribute: string | NodeType | MarkType\n+  ) => Record<string, any> | undefined;\n+  getCoordsFromPos: (pos?: number) => ReturnType<EditorView[\"coordsAtPos\"]> | undefined;\n   getCurrentCursorPosition: () => number | undefined;\n   getDocument: () => {\n     binary: Uint8Array | null;\n     html: string;\n@@ -102,15 +116,17 @@\n   listenToRealTimeUpdate: () => TDocumentEventEmitter | undefined;\n   onDocumentInfoChange: (callback: (documentInfo: TDocumentInfo) => void) => () => void;\n   onHeadingChange: (callback: (headings: IMarking[]) => void) => () => void;\n   onStateChange: (callback: () => void) => () => void;\n+  redo: () => void;\n   scrollSummary: (marking: IMarking) => void;\n   // eslint-disable-next-line no-undef\n-  scrollToNodeViaDOMCoordinates: (behavior?: ScrollBehavior, position?: number) => void;\n+  scrollToNodeViaDOMCoordinates: ({ pos, behavior }: { pos?: number; behavior?: ScrollBehavior }) => void;\n   setEditorValue: (content: string, emitUpdate?: boolean) => void;\n   setEditorValueAtCursorPosition: (content: string) => void;\n   setFocusAtPosition: (position: number) => void;\n   setProviderDocument: (value: Uint8Array) => void;\n+  undo: () => void;\n };\n \n // editor props\n export interface IEditorProps {\n@@ -120,17 +136,20 @@\n   displayConfig?: TDisplayConfig;\n   disabledExtensions: TExtensions[];\n   editable: boolean;\n   editorClassName?: string;\n+  editorProps?: EditorProps;\n   extensions?: Extensions;\n   flaggedExtensions: TExtensions[];\n   fileHandler: TFileHandler;\n   forwardedRef?: React.MutableRefObject<EditorRefApi | null>;\n   handleEditorReady?: (value: boolean) => void;\n   id: string;\n   initialValue: string;\n+  isTouchDevice?: boolean;\n   mentionHandler: TMentionHandler;\n   onAssetChange?: (assets: TEditorAsset[]) => void;\n+  onEditorFocus?: () => void;\n   onChange?: (json: object, html: string) => void;\n   onEnterKeyPress?: (e?: any) => void;\n   onTransaction?: () => void;\n   placeholder?: string | ((isFocused: boolean, value: string) => string);\n@@ -144,10 +163,13 @@\n   dragDropEnabled?: boolean;\n };\n \n export interface ICollaborativeDocumentEditorProps\n-  extends Omit<IEditorProps, \"extensions\" | \"initialValue\" | \"onEnterKeyPress\" | \"value\"> {\n+  extends Omit<IEditorProps, \"initialValue\" | \"onEnterKeyPress\" | \"value\"> {\n   aiHandler?: TAIHandler;\n+  documentLoaderClassName?: string;\n+  dragDropEnabled?: boolean;\n+  editable: boolean;\n   embedHandler: TEmbedConfig;\n   realtimeConfig: TRealtimeConfig;\n   serverHandler?: TServerHandler;\n   user: TUserDetails;\n"
        },
        {
          "path": "packages/editor/src/core/types/hook.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/types/hook.ts\n===================================================================\n--- packages/editor/src/core/types/hook.ts\t7cec921 (parent)\n+++ packages/editor/src/core/types/hook.ts\tc3273b1 (commit)\n@@ -1,16 +1,20 @@\n import type { HocuspocusProvider } from \"@hocuspocus/provider\";\n import type { Content } from \"@tiptap/core\";\n-import type { EditorProps } from \"@tiptap/pm/view\";\n // local imports\n import type { ICollaborativeDocumentEditorProps, IEditorProps } from \"./editor\";\n \n type TCoreHookProps = Pick<\n   IEditorProps,\n-  \"disabledExtensions\" | \"editorClassName\" | \"extensions\" | \"flaggedExtensions\" | \"handleEditorReady\"\n-> & {\n-  editorProps?: EditorProps;\n-};\n+  | \"disabledExtensions\"\n+  | \"editorClassName\"\n+  | \"editorProps\"\n+  | \"extensions\"\n+  | \"flaggedExtensions\"\n+  | \"handleEditorReady\"\n+  | \"isTouchDevice\"\n+  | \"onEditorFocus\"\n+>;\n \n export type TEditorHookProps = TCoreHookProps &\n   Pick<\n     IEditorProps,\n@@ -45,5 +49,8 @@\n     | \"onTransaction\"\n     | \"placeholder\"\n     | \"tabIndex\"\n   > &\n-  Pick<ICollaborativeDocumentEditorProps, \"embedHandler\" | \"realtimeConfig\" | \"serverHandler\" | \"user\">;\n+  Pick<\n+    ICollaborativeDocumentEditorProps,\n+    \"dragDropEnabled\" | \"embedHandler\" | \"realtimeConfig\" | \"serverHandler\" | \"user\"\n+  >;\n"
        },
        {
          "path": "packages/editor/src/styles/variables.css",
          "status": "modified",
          "diff": "Index: packages/editor/src/styles/variables.css\n===================================================================\n--- packages/editor/src/styles/variables.css\t7cec921 (parent)\n+++ packages/editor/src/styles/variables.css\tc3273b1 (commit)\n@@ -87,8 +87,30 @@\n     --line-height-regular: 1.2rem;\n     --line-height-code: 1.2rem;\n     --line-height-list: var(--line-height-regular);\n   }\n+\n+  &.mobile-font {\n+    --font-size-h1: 1.75rem;\n+    --font-size-h2: 1.5rem;\n+    --font-size-h3: 1.375rem;\n+    --font-size-h4: 1.25rem;\n+    --font-size-h5: 1.125rem;\n+    --font-size-h6: 1rem;\n+    --font-size-regular: 0.95rem;\n+    --font-size-code: 0.85rem;\n+    --font-size-list: var(--font-size-regular);\n+\n+    --line-height-h1: 2.25rem;\n+    --line-height-h2: 2rem;\n+    --line-height-h3: 1.75rem;\n+    --line-height-h4: 1.5rem;\n+    --line-height-h5: 1.5rem;\n+    --line-height-h6: 1.5rem;\n+    --line-height-regular: 1.5rem;\n+    --line-height-code: 1.5rem;\n+    --line-height-list: var(--line-height-regular);\n+  }\n   /* end font sizes and line heights */\n \n   /* font styles */\n   --font-style: \"Inter\", sans-serif;\n@@ -145,8 +167,29 @@\n     --list-spacing-y: 0px;\n     --divider-padding-top: 0px;\n     --divider-padding-bottom: 4px;\n   }\n+\n+  &.line-spacing-mobile-regular {\n+    --heading-1-padding-top: 16px;\n+    --heading-1-padding-bottom: 4px;\n+    --heading-2-padding-top: 16px;\n+    --heading-2-padding-bottom: 4px;\n+    --heading-3-padding-top: 16px;\n+    --heading-3-padding-bottom: 4px;\n+    --heading-4-padding-top: 16px;\n+    --heading-4-padding-bottom: 4px;\n+    --heading-5-padding-top: 12px;\n+    --heading-5-padding-bottom: 4px;\n+    --heading-6-padding-top: 12px;\n+    --heading-6-padding-bottom: 4px;\n+    --paragraph-padding-top: 2px;\n+    --paragraph-padding-bottom: 2px;\n+    --paragraph-padding-between: 4px;\n+    --list-spacing-y: 0px;\n+    --divider-padding-top: 0px;\n+    --divider-padding-bottom: 4px;\n+  }\n   /* end spacing */\n }\n /* end font size and style */\n \n"
        }
      ]
    },
    {
      "id": "bulk-table-delete",
      "sha": "d8f2c9781044284232a447c496110cdfd41f0d70",
      "parentSha": "89983b06d26402ac0b7fdbb43dc68d9355aae1e2",
      "spec": "Implement multi-row/column deletion for tables and centralize selection/cell helpers across the editor table extension.\n\nScope and requirements:\n\n1) Add a new keyboard handler for delete keys\n- File: packages/editor/src/core/extensions/table/table/utilities/delete-key-shortcut.ts\n- Define a keyboard shortcut command that:\n  - Activates only when the current selection is a table CellSelection.\n  - Determines the current table (using the table node name from CORE_EXTENSIONS.TABLE) and builds a TableMap.\n  - Collects the coordinates for all selected cells, computes selection bounds (min/max row and column), and checks if all selected cells are empty.\n  - If selected cells are not empty, do nothing (return false).\n  - If the selection spans all columns across one or more rows, delete the selected rows as a group using editor.commands.deleteRow(), repositioning selection between deletions so that subsequent deletions target the intended rows.\n  - Else if the selection spans all rows across one or more columns, delete the selected columns as a group using editor.commands.deleteColumn(), repositioning selection between deletions so that subsequent deletions target the intended columns.\n  - Otherwise, do nothing (return false).\n  - Return true when a delete action was performed; false otherwise.\n\n2) Wire the new handler into table keymaps\n- File: packages/editor/src/core/extensions/table/table/table.ts\n- Import the new handler from ./utilities/delete-key-shortcut.\n- Replace Backspace, Mod-Backspace, Delete, and Mod-Delete key bindings to call the new handler instead of the removed deleteTableWhenAllCellsSelected.\n\n3) Remove the obsolete single-table-delete handler\n- Delete file: packages/editor/src/core/extensions/table/table/utilities/delete-table-when-all-cells-selected.ts\n- Ensure no imports remain for this module.\n\n4) Centralize and reuse helpers for selection and cell emptiness\n- File: packages/editor/src/core/extensions/table/table/utilities/helpers.ts\n  - Ensure it exports both:\n    - isCellSelection(selection): true if selection is a CellSelection.\n    - isCellEmpty(cell): true if a table cell node has no content (paragraphs with no text, no other content, and no text nodes).\n\n- Update all call sites to reuse these helpers:\n  a) File: packages/editor/src/core/extensions/table/plugins/insert-handlers/utils.ts\n     - Import isCellEmpty from ../../table/utilities/helpers.\n     - Remove any local isCellEmpty implementation.\n\n  b) File: packages/editor/src/core/extensions/table/plugins/selection-outline/plugin.ts\n     - Stop importing CellSelection directly; import isCellSelection from ../../table/utilities/helpers and use it for the selection type guard.\n     - Keep TableMap import for geometry.\n\n  c) File: packages/editor/src/core/extensions/table/table/table-view.tsx\n     - Import and use isCellSelection when checking selection type before applying a background color to a row.\n\n5) Consolidate selection outline plugins\n- Remove duplicate table selection outline implementation:\n  - Delete files:\n    - packages/editor/src/core/extensions/table/plugins/table-selection-outline/plugin.ts\n    - packages/editor/src/core/extensions/table/plugins/table-selection-outline/utils.ts\n- Ensure the codebase uses the existing selection outline utilities at packages/editor/src/core/extensions/table/plugins/selection-outline/utils.ts.\n\nBehavioral expectations:\n- Pressing Backspace/Delete (with or without Mod) while a table cell selection is active:\n  - If selection covers complete rows and all selected cells are empty, those rows are deleted in one action.\n  - If selection covers complete columns and all selected cells are empty, those columns are deleted in one action.\n  - If cells contain content or selection does not cover entire rows/columns, default behavior is preserved (no bulk deletion by this handler).\n- No duplication of selection outline plugin code remains; only one selection-outline utility module is used.\n- All selection checks use the shared helper; cell emptiness checks are unified via helpers.\n",
      "prompt": "Enhance the table editing experience so that when a user selects an entire set of rows or columns in a table and presses Delete or Backspace, the selected rows or columns are removed in one action, but only if the selected cells are empty. Centralize selection and cell-empty checks in shared helpers and make all relevant table plugins use them. Also remove any duplicate table selection outline plugin so only one selection outline utility remains. Finally, wire the new delete behavior to the table’s delete key bindings and remove the old handler that only deleted the table when all cells were selected.",
      "supplementalFiles": [
        "packages/editor/src/core/constants/extension.ts",
        "packages/editor/src/core/extensions/table/table/utilities/delete-row.ts",
        "packages/editor/src/core/extensions/table/table/utilities/delete-column.ts",
        "packages/editor/src/core/extensions/table/plugins/selection-outline/utils.ts"
      ],
      "fileDiffs": [
        {
          "path": "packages/editor/src/core/extensions/table/plugins/insert-handlers/utils.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/table/plugins/insert-handlers/utils.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/plugins/insert-handlers/utils.ts\t89983b0 (parent)\n+++ packages/editor/src/core/extensions/table/plugins/insert-handlers/utils.ts\td8f2c97 (commit)\n@@ -1,7 +1,9 @@\n import type { Editor } from \"@tiptap/core\";\n import type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\n import { addColumn, removeColumn, addRow, removeRow, TableMap } from \"@tiptap/pm/tables\";\n+// local imports\n+import { isCellEmpty } from \"../../table/utilities/helpers\";\n \n const addSvg = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n <path\n   d=\"M8.5 7.49988V3.49988C8.5 3.22374 8.27614 2.99988 8 2.99988C7.72386 2.99988 7.5 3.22374 7.5 3.49988L7.5 7.49988L3.5 7.49988C3.22386 7.49988 3 7.72374 3 7.99988C3 8.27602 3.22386 8.49988 3.5 8.49988H7.5L7.5 12.4999C7.5 12.776 7.72386 12.9999 8 12.9999C8.27614 12.9999 8.5 12.776 8.5 12.4999L8.5 8.49988L12.5 8.49988C12.7761 8.49988 13 8.27602 13 7.99988C13 7.72374 12.7761 7.49988 12.5 7.49988L8.5 7.49988Z\"\n@@ -318,29 +320,8 @@\n   editor.view.dispatch(tr);\n   return true;\n };\n \n-// Helper function to check if a single cell is empty\n-const isCellEmpty = (cell: ProseMirrorNode | null | undefined): boolean => {\n-  if (!cell || cell.content.size === 0) {\n-    return true;\n-  }\n-\n-  // Check if cell has any non-empty content\n-  let hasContent = false;\n-  cell.content.forEach((node) => {\n-    if (node.type.name === \"paragraph\") {\n-      if (node.content.size > 0) {\n-        hasContent = true;\n-      }\n-    } else if (node.content.size > 0 || node.isText) {\n-      hasContent = true;\n-    }\n-  });\n-\n-  return !hasContent;\n-};\n-\n const isColumnEmpty = (tableInfo: TableInfo, columnIndex: number): boolean => {\n   const { tableNode } = tableInfo;\n   const tableMapData = TableMap.get(tableNode);\n \n"
        },
        {
          "path": "packages/editor/src/core/extensions/table/plugins/selection-outline/plugin.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/table/plugins/selection-outline/plugin.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/plugins/selection-outline/plugin.ts\t89983b0 (parent)\n+++ packages/editor/src/core/extensions/table/plugins/selection-outline/plugin.ts\td8f2c97 (commit)\n@@ -1,9 +1,10 @@\n import { findParentNode, type Editor } from \"@tiptap/core\";\n import { Plugin, PluginKey } from \"@tiptap/pm/state\";\n-import { CellSelection, TableMap } from \"@tiptap/pm/tables\";\n+import { TableMap } from \"@tiptap/pm/tables\";\n import { Decoration, DecorationSet } from \"@tiptap/pm/view\";\n // local imports\n+import { isCellSelection } from \"../../table/utilities/helpers\";\n import { getCellBorderClasses } from \"./utils\";\n \n type TableCellSelectionOutlinePluginState = {\n   decorations?: DecorationSet;\n@@ -24,9 +25,9 @@\n           return table === undefined ? {} : prev;\n         }\n \n         const { selection } = newState;\n-        if (!(selection instanceof CellSelection)) return {};\n+        if (!isCellSelection(selection)) return {};\n \n         const decorations: Decoration[] = [];\n         const tableMap = TableMap.get(table.node);\n         const selectedCells: number[] = [];\n"
        },
        {
          "path": "packages/editor/src/core/extensions/table/plugins/table-selection-outline/plugin.ts",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/extensions/table/plugins/table-selection-outline/plugin.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/plugins/table-selection-outline/plugin.ts\t89983b0 (parent)\n+++ packages/editor/src/core/extensions/table/plugins/table-selection-outline/plugin.ts\td8f2c97 (commit)\n@@ -1,58 +0,0 @@\n-import { findParentNode, type Editor } from \"@tiptap/core\";\n-import { Plugin, PluginKey } from \"@tiptap/pm/state\";\n-import { CellSelection, TableMap } from \"@tiptap/pm/tables\";\n-import { Decoration, DecorationSet } from \"@tiptap/pm/view\";\n-// local imports\n-import { getCellBorderClasses } from \"./utils\";\n-\n-type TableCellSelectionOutlinePluginState = {\n-  decorations?: DecorationSet;\n-};\n-\n-const TABLE_SELECTION_OUTLINE_PLUGIN_KEY = new PluginKey(\"table-cell-selection-outline\");\n-\n-export const TableCellSelectionOutlinePlugin = (editor: Editor): Plugin<TableCellSelectionOutlinePluginState> =>\n-  new Plugin<TableCellSelectionOutlinePluginState>({\n-    key: TABLE_SELECTION_OUTLINE_PLUGIN_KEY,\n-    state: {\n-      init: () => ({}),\n-      apply(tr, prev, oldState, newState) {\n-        if (!editor.isEditable) return {};\n-        const table = findParentNode((node) => node.type.spec.tableRole === \"table\")(newState.selection);\n-        const hasDocChanged = tr.docChanged || !newState.selection.eq(oldState.selection);\n-        if (!table || !hasDocChanged) {\n-          return table === undefined ? {} : prev;\n-        }\n-\n-        const { selection } = newState;\n-        if (!(selection instanceof CellSelection)) return {};\n-\n-        const decorations: Decoration[] = [];\n-        const tableMap = TableMap.get(table.node);\n-        const selectedCells: number[] = [];\n-\n-        // First, collect all selected cell positions\n-        selection.forEachCell((_node, pos) => {\n-          const start = pos - table.pos - 1;\n-          selectedCells.push(start);\n-        });\n-\n-        // Then, add decorations with appropriate border classes\n-        selection.forEachCell((node, pos) => {\n-          const start = pos - table.pos - 1;\n-          const classes = getCellBorderClasses(start, selectedCells, tableMap);\n-\n-          decorations.push(Decoration.node(pos, pos + node.nodeSize, { class: classes.join(\" \") }));\n-        });\n-\n-        return {\n-          decorations: DecorationSet.create(newState.doc, decorations),\n-        };\n-      },\n-    },\n-    props: {\n-      decorations(state) {\n-        return TABLE_SELECTION_OUTLINE_PLUGIN_KEY.getState(state).decorations;\n-      },\n-    },\n-  });\n"
        },
        {
          "path": "packages/editor/src/core/extensions/table/plugins/table-selection-outline/utils.ts",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/extensions/table/plugins/table-selection-outline/utils.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/plugins/table-selection-outline/utils.ts\t89983b0 (parent)\n+++ packages/editor/src/core/extensions/table/plugins/table-selection-outline/utils.ts\td8f2c97 (commit)\n@@ -1,75 +0,0 @@\n-import type { TableMap } from \"@tiptap/pm/tables\";\n-\n-/**\n- * Calculates the positions of cells adjacent to a given cell in a table\n- * @param cellStart - The start position of the current cell in the document\n- * @param tableMap - ProseMirror's table mapping structure containing cell positions and dimensions\n- * @returns Object with positions of adjacent cells (undefined if cell doesn't exist at table edge)\n- */\n-const getAdjacentCellPositions = (\n-  cellStart: number,\n-  tableMap: TableMap\n-): { top?: number; bottom?: number; left?: number; right?: number } => {\n-  // Extract table dimensions\n-  // width -> number of columns in the table\n-  // height -> number of rows in the table\n-  const { width, height } = tableMap;\n-\n-  // Find the index of our cell in the flat tableMap.map array\n-  // tableMap.map contains start positions of all cells in row-by-row order\n-  const cellIndex = tableMap.map.indexOf(cellStart);\n-\n-  // Safety check: if cell position not found in table map, return empty object\n-  if (cellIndex === -1) return {};\n-\n-  // Convert flat array index to 2D grid coordinates\n-  // row = which row the cell is in (0-based from top)\n-  // col = which column the cell is in (0-based from left)\n-  const row = Math.floor(cellIndex / width); // Integer division gives row number\n-  const col = cellIndex % width; // Remainder gives column number\n-\n-  return {\n-    // Top cell: same column, one row up\n-    // Check if we're not in the first row (row > 0) before calculating\n-    top: row > 0 ? tableMap.map[(row - 1) * width + col] : undefined,\n-\n-    // Bottom cell: same column, one row down\n-    // Check if we're not in the last row (row < height - 1) before calculating\n-    bottom: row < height - 1 ? tableMap.map[(row + 1) * width + col] : undefined,\n-\n-    // Left cell: same row, one column left\n-    // Check if we're not in the first column (col > 0) before calculating\n-    left: col > 0 ? tableMap.map[row * width + (col - 1)] : undefined,\n-\n-    // Right cell: same row, one column right\n-    // Check if we're not in the last column (col < width - 1) before calculating\n-    right: col < width - 1 ? tableMap.map[row * width + (col + 1)] : undefined,\n-  };\n-};\n-\n-export const getCellBorderClasses = (cellStart: number, selectedCells: number[], tableMap: TableMap): string[] => {\n-  const adjacent = getAdjacentCellPositions(cellStart, tableMap);\n-  const classes: string[] = [];\n-\n-  // Add border-right if right cell is not selected or doesn't exist\n-  if (adjacent.right === undefined || !selectedCells.includes(adjacent.right)) {\n-    classes.push(\"selectedCell-border-right\");\n-  }\n-\n-  // Add border-left if left cell is not selected or doesn't exist\n-  if (adjacent.left === undefined || !selectedCells.includes(adjacent.left)) {\n-    classes.push(\"selectedCell-border-left\");\n-  }\n-\n-  // Add border-top if top cell is not selected or doesn't exist\n-  if (adjacent.top === undefined || !selectedCells.includes(adjacent.top)) {\n-    classes.push(\"selectedCell-border-top\");\n-  }\n-\n-  // Add border-bottom if bottom cell is not selected or doesn't exist\n-  if (adjacent.bottom === undefined || !selectedCells.includes(adjacent.bottom)) {\n-    classes.push(\"selectedCell-border-bottom\");\n-  }\n-\n-  return classes;\n-};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/table/table/table-view.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/table/table/table-view.tsx\n===================================================================\n--- packages/editor/src/core/extensions/table/table/table-view.tsx\t89983b0 (parent)\n+++ packages/editor/src/core/extensions/table/table/table-view.tsx\td8f2c97 (commit)\n@@ -6,8 +6,10 @@\n import { icons } from \"src/core/extensions/table/table/icons\";\n import tippy, { Instance, Props } from \"tippy.js\";\n // constants\n import { CORE_EXTENSIONS } from \"@/constants/extension\";\n+// local imports\n+import { isCellSelection } from \"./utilities/helpers\";\n \n type ToolboxItem = {\n   label: string;\n   icon: string;\n@@ -94,9 +96,9 @@\n \n function setTableRowBackgroundColor(editor: Editor, color: { backgroundColor: string; textColor: string }) {\n   const { state, dispatch } = editor.view;\n   const { selection } = state;\n-  if (!(selection instanceof CellSelection)) {\n+  if (!isCellSelection(selection)) {\n     return false;\n   }\n \n   // Get the position of the hovered cell in the selection to determine the row.\n"
        },
        {
          "path": "packages/editor/src/core/extensions/table/table/table.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/table/table/table.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/table/table.ts\t89983b0 (parent)\n+++ packages/editor/src/core/extensions/table/table/table.ts\td8f2c97 (commit)\n@@ -25,10 +25,10 @@\n import { tableControls } from \"./table-controls\";\n import { TableView } from \"./table-view\";\n import { createTable } from \"./utilities/create-table\";\n import { deleteColumnOrTable } from \"./utilities/delete-column\";\n+import { handleDeleteKeyOnTable } from \"./utilities/delete-key-shortcut\";\n import { deleteRowOrTable } from \"./utilities/delete-row\";\n-import { deleteTableWhenAllCellsSelected } from \"./utilities/delete-table-when-all-cells-selected\";\n import { insertLineAboveTableAction } from \"./utilities/insert-line-above-table-action\";\n import { insertLineBelowTableAction } from \"./utilities/insert-line-below-table-action\";\n import { DEFAULT_COLUMN_WIDTH } from \".\";\n \n@@ -235,12 +235,12 @@\n         }\n         return false;\n       },\n       \"Shift-Tab\": () => this.editor.commands.goToPreviousCell(),\n-      Backspace: deleteTableWhenAllCellsSelected,\n-      \"Mod-Backspace\": deleteTableWhenAllCellsSelected,\n-      Delete: deleteTableWhenAllCellsSelected,\n-      \"Mod-Delete\": deleteTableWhenAllCellsSelected,\n+      Backspace: handleDeleteKeyOnTable,\n+      \"Mod-Backspace\": handleDeleteKeyOnTable,\n+      Delete: handleDeleteKeyOnTable,\n+      \"Mod-Delete\": handleDeleteKeyOnTable,\n       ArrowDown: insertLineBelowTableAction,\n       ArrowUp: insertLineAboveTableAction,\n     };\n   },\n"
        },
        {
          "path": "packages/editor/src/core/extensions/table/table/utilities/delete-key-shortcut.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/table/table/utilities/delete-key-shortcut.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/table/utilities/delete-key-shortcut.ts\t89983b0 (parent)\n+++ packages/editor/src/core/extensions/table/table/utilities/delete-key-shortcut.ts\td8f2c97 (commit)\n@@ -0,0 +1,201 @@\n+import { Editor, findParentNodeClosestToPos, KeyboardShortcutCommand } from \"@tiptap/core\";\n+import type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\n+import { CellSelection, TableMap } from \"@tiptap/pm/tables\";\n+// constants\n+import { CORE_EXTENSIONS } from \"@/constants/extension\";\n+// extensions\n+import { isCellEmpty, isCellSelection } from \"@/extensions/table/table/utilities/helpers\";\n+\n+interface CellCoord {\n+  row: number;\n+  col: number;\n+}\n+\n+interface TableInfo {\n+  node: ProseMirrorNode;\n+  pos: number;\n+  map: TableMap;\n+  totalColumns: number;\n+  totalRows: number;\n+}\n+\n+export const handleDeleteKeyOnTable: KeyboardShortcutCommand = (props) => {\n+  const { editor } = props;\n+  const { selection } = editor.state;\n+\n+  try {\n+    if (!isCellSelection(selection)) return false;\n+\n+    const tableInfo = getTableInfo(editor);\n+    if (!tableInfo) return false;\n+\n+    const selectedCellCoords = getSelectedCellCoords(selection, tableInfo);\n+    if (selectedCellCoords.length === 0) return false;\n+\n+    const hasContent = checkCellsHaveContent(selection);\n+    if (hasContent) return false;\n+\n+    const selectionBounds = calculateSelectionBounds(selectedCellCoords);\n+    const { totalColumnsInSelection, totalRowsInSelection, minRow, minCol } = selectionBounds;\n+\n+    // Check if entire rows are selected\n+    if (totalColumnsInSelection === tableInfo.totalColumns) {\n+      return deleteMultipleRows(editor, totalRowsInSelection, minRow, tableInfo);\n+    }\n+\n+    // Check if entire columns are selected\n+    if (totalRowsInSelection === tableInfo.totalRows) {\n+      return deleteMultipleColumns(editor, totalColumnsInSelection, minCol, tableInfo);\n+    }\n+\n+    return false;\n+  } catch (error) {\n+    console.error(\"Error in handleDeleteKeyOnTable\", error);\n+    return false;\n+  }\n+};\n+\n+const getTableInfo = (editor: Editor): TableInfo | null => {\n+  const table = findParentNodeClosestToPos(\n+    editor.state.selection.ranges[0].$from,\n+    (node) => node.type.name === CORE_EXTENSIONS.TABLE\n+  );\n+\n+  if (!table) return null;\n+\n+  const tableMap = TableMap.get(table.node);\n+  return {\n+    node: table.node,\n+    pos: table.pos,\n+    map: tableMap,\n+    totalColumns: tableMap.width,\n+    totalRows: tableMap.height,\n+  };\n+};\n+\n+const getSelectedCellCoords = (selection: CellSelection, tableInfo: TableInfo): CellCoord[] => {\n+  const selectedCellCoords: CellCoord[] = [];\n+\n+  selection.forEachCell((_node, pos) => {\n+    const cellStart = pos - tableInfo.pos - 1;\n+    const coord = findCellCoordinate(cellStart, tableInfo);\n+\n+    if (coord) {\n+      selectedCellCoords.push(coord);\n+    }\n+  });\n+\n+  return selectedCellCoords;\n+};\n+\n+const findCellCoordinate = (cellStart: number, tableInfo: TableInfo): CellCoord | null => {\n+  // Primary method: use indexOf\n+  const cellIndex = tableInfo.map.map.indexOf(cellStart);\n+\n+  if (cellIndex !== -1) {\n+    return {\n+      row: Math.floor(cellIndex / tableInfo.totalColumns),\n+      col: cellIndex % tableInfo.totalColumns,\n+    };\n+  }\n+\n+  // Fallback: manual search\n+  for (let i = 0; i < tableInfo.map.map.length; i++) {\n+    if (tableInfo.map.map[i] === cellStart) {\n+      return {\n+        row: Math.floor(i / tableInfo.totalColumns),\n+        col: i % tableInfo.totalColumns,\n+      };\n+    }\n+  }\n+\n+  return null;\n+};\n+\n+const checkCellsHaveContent = (selection: CellSelection): boolean => {\n+  let hasContent = false;\n+\n+  selection.forEachCell((node) => {\n+    if (node && !isCellEmpty(node)) {\n+      hasContent = true;\n+    }\n+  });\n+\n+  return hasContent;\n+};\n+\n+const calculateSelectionBounds = (selectedCellCoords: CellCoord[]) => {\n+  const minRow = Math.min(...selectedCellCoords.map((c) => c.row));\n+  const maxRow = Math.max(...selectedCellCoords.map((c) => c.row));\n+  const minCol = Math.min(...selectedCellCoords.map((c) => c.col));\n+  const maxCol = Math.max(...selectedCellCoords.map((c) => c.col));\n+\n+  return {\n+    minRow,\n+    maxRow,\n+    minCol,\n+    maxCol,\n+    totalColumnsInSelection: maxCol - minCol + 1,\n+    totalRowsInSelection: maxRow - minRow + 1,\n+  };\n+};\n+\n+const deleteMultipleRows = (\n+  editor: Editor,\n+  totalRowsInSelection: number,\n+  minRow: number,\n+  initialTableInfo: TableInfo\n+): boolean => {\n+  // Position cursor at the first selected row\n+  setCursorAtPosition(editor, initialTableInfo, minRow, 0);\n+\n+  // Delete rows one by one\n+  for (let i = 0; i < totalRowsInSelection; i++) {\n+    editor.commands.deleteRow();\n+\n+    // Reposition cursor if there are more rows to delete\n+    if (i < totalRowsInSelection - 1) {\n+      const updatedTableInfo = getTableInfo(editor);\n+      if (updatedTableInfo) {\n+        setCursorAtPosition(editor, updatedTableInfo, minRow, 0);\n+      }\n+    }\n+  }\n+\n+  return true;\n+};\n+\n+const deleteMultipleColumns = (\n+  editor: Editor,\n+  totalColumnsInSelection: number,\n+  minCol: number,\n+  initialTableInfo: TableInfo\n+): boolean => {\n+  // Position cursor at the first selected column\n+  setCursorAtPosition(editor, initialTableInfo, 0, minCol);\n+\n+  // Delete columns one by one\n+  for (let i = 0; i < totalColumnsInSelection; i++) {\n+    editor.commands.deleteColumn();\n+\n+    // Reposition cursor if there are more columns to delete\n+    if (i < totalColumnsInSelection - 1) {\n+      const updatedTableInfo = getTableInfo(editor);\n+      if (updatedTableInfo) {\n+        setCursorAtPosition(editor, updatedTableInfo, 0, minCol);\n+      }\n+    }\n+  }\n+\n+  return true;\n+};\n+\n+const setCursorAtPosition = (editor: Editor, tableInfo: TableInfo, row: number, col: number): void => {\n+  const cellIndex = row * tableInfo.totalColumns + col;\n+  const cellPos = tableInfo.pos + tableInfo.map.map[cellIndex] + 1;\n+\n+  editor.commands.setCellSelection({\n+    anchorCell: cellPos,\n+    headCell: cellPos,\n+  });\n+};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/table/table/utilities/delete-table-when-all-cells-selected.ts",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/extensions/table/table/utilities/delete-table-when-all-cells-selected.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/table/utilities/delete-table-when-all-cells-selected.ts\t89983b0 (parent)\n+++ packages/editor/src/core/extensions/table/table/utilities/delete-table-when-all-cells-selected.ts\td8f2c97 (commit)\n@@ -1,39 +0,0 @@\n-import { findParentNodeClosestToPos, KeyboardShortcutCommand } from \"@tiptap/core\";\n-// constants\n-import { CORE_EXTENSIONS } from \"@/constants/extension\";\n-// extensions\n-import { isCellSelection } from \"@/extensions/table/table/utilities/helpers\";\n-\n-export const deleteTableWhenAllCellsSelected: KeyboardShortcutCommand = ({ editor }) => {\n-  const { selection } = editor.state;\n-\n-  if (!isCellSelection(selection)) {\n-    return false;\n-  }\n-\n-  let cellCount = 0;\n-  const table = findParentNodeClosestToPos(\n-    selection.ranges[0].$from,\n-    (node) => node.type.name === CORE_EXTENSIONS.TABLE\n-  );\n-\n-  table?.node.descendants((node) => {\n-    if (node.type.name === CORE_EXTENSIONS.TABLE) {\n-      return false;\n-    }\n-\n-    if ([CORE_EXTENSIONS.TABLE_CELL, CORE_EXTENSIONS.TABLE_HEADER].includes(node.type.name as CORE_EXTENSIONS)) {\n-      cellCount += 1;\n-    }\n-  });\n-\n-  const allCellsSelected = cellCount === selection.ranges.length;\n-\n-  if (!allCellsSelected) {\n-    return false;\n-  }\n-\n-  editor.commands.deleteTable();\n-\n-  return true;\n-};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/table/table/utilities/helpers.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/table/table/utilities/helpers.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/table/utilities/helpers.ts\t89983b0 (parent)\n+++ packages/editor/src/core/extensions/table/table/utilities/helpers.ts\td8f2c97 (commit)\n@@ -1,4 +1,5 @@\n+import type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\n import type { Selection } from \"@tiptap/pm/state\";\n import { CellSelection } from \"@tiptap/pm/tables\";\n \n /**\n@@ -6,4 +7,29 @@\n  * @param {Selection} selection - The selection to check\n  * @returns {boolean} True if the selection is a cell selection, false otherwise\n  */\n export const isCellSelection = (selection: Selection): selection is CellSelection => selection instanceof CellSelection;\n+\n+/**\n+ * @description Check if a cell is empty\n+ * @param {ProseMirrorNode | null} cell - The cell to check\n+ * @returns {boolean} True if the cell is empty, false otherwise\n+ */\n+export const isCellEmpty = (cell: ProseMirrorNode | null): boolean => {\n+  if (!cell || cell.content.size === 0) {\n+    return true;\n+  }\n+\n+  // Check if cell has any non-empty content\n+  let hasContent = false;\n+  cell.content.forEach((node) => {\n+    if (node.type.name === \"paragraph\") {\n+      if (node.content.size > 0) {\n+        hasContent = true;\n+      }\n+    } else if (node.content.size > 0 || node.isText) {\n+      hasContent = true;\n+    }\n+  });\n+\n+  return !hasContent;\n+};\n"
        }
      ]
    },
    {
      "id": "add-table-handles",
      "sha": "fcb6e269a0a5ceca2f4b2951e3cccdbd6c312f3a",
      "parentSha": "853423608c884f38fedbf6cf66672528f29dce45",
      "spec": "Implement table selection outline and interactive insert handles for TipTap tables, and wire them into the table extensions with accompanying styles.\n\n1) Add table cell selection outline plugin\n- Create packages/editor/src/core/extensions/table/plugins/selection-outline/plugin.ts that:\n  - Registers a ProseMirror Plugin keyed uniquely for table cell selection outlines.\n  - When the editor is editable and the selection is a CellSelection inside a table, compute DecorationSet for each selected cell adding CSS classes that render an outline only on the outer perimeter of the selection.\n  - Use TableMap to determine adjacency and only add top/left/right/bottom classes when the neighboring cell is not part of the selection or is out of bounds.\n  - Do not decorate when the editor is not editable or when selection is not a CellSelection.\n  - Expose the decorations via props.decorations.\n- Create packages/editor/src/core/extensions/table/plugins/selection-outline/utils.ts with helpers to:\n  - Given a cell start position and a TableMap, find adjacent cell positions (top, bottom, left, right) or undefined when out of bounds.\n  - Given the current cell start and the set of selected cell starts, return an array of CSS class names to apply (selectedCell-border-top, -right, -bottom, -left) only for the edges of the selection.\n- Update packages/editor/src/core/extensions/table/table-cell.ts to import the new plugin from ./plugins/selection-outline/plugin and to include it in addProseMirrorPlugins so that cell selections render with the correct visual outline.\n\n2) Add table insert column/row handles plugin\n- Create packages/editor/src/core/extensions/table/plugins/insert-handlers/plugin.ts that:\n  - Registers a ProseMirror Plugin keyed for table insert handles.\n  - Maintains a map of DOM table elements to their associated TableInfo, which includes the ProseMirror node and position, plus references to appended UI buttons.\n  - On view init and when the document changes, scans the current editor DOM to find all table elements, maps them to their PM table nodes/positions, and ensures each table has exactly one column-insert button and one row-insert button appended. Remove any UI elements for tables no longer present. When the editor is not editable, remove all buttons.\n  - On plugin destroy, clean up all appended buttons and clear the map.\n- Create packages/editor/src/core/extensions/table/plugins/insert-handlers/utils.ts that:\n  - Defines TableInfo (tableElement, tableNode, tablePos, optional columnButtonElement/rowButtonElement).\n  - Exposes a findAllTables(editor) utility to locate each DOM table and resolve its PM node and position within the document.\n  - Provides createColumnInsertButton(editor, tableInfo) and createRowInsertButton(editor, tableInfo) that return positioned button elements with ARIA labels and an add icon. The buttons must support:\n    - Click: insert a new column (for the column button) or a new row (for the row button) at the end of the table.\n    - Drag: while holding the mouse button, moving in the positive direction repeatedly inserts new columns (drag right) or rows (drag down) when a movement threshold is crossed; moving in the negative direction removes the last column/row only if it is empty, again on crossing thresholds. Use separate drag thresholds to start dragging and action thresholds to trigger inserts/deletes. Ensure drag state cleans up on mouseup and prevent text selection while dragging.\n  - Implement helpers to insert after the last column/row using @tiptap/pm/tables addColumn/addRow and to remove the last column/row using removeColumn/removeRow only if that final column/row is empty. Use TableMap to compute sizes and positions, and helpers to determine whether a given cell, column, or row is empty.\n- Update packages/editor/src/core/extensions/table/table/table.ts to register the insert-handles plugin in addProseMirrorPlugins by importing TableInsertPlugin from ../plugins/insert-handlers/plugin and including TableInsertPlugin(this.editor) in the returned plugin list (alongside existing table editing/controls and optional columnResizing).\n\n3) Update styles for tables, selection outline, and insert handles\n- Modify packages/editor/src/styles/table.css to:\n  - Ensure .table-wrapper has enough space for the bottom row insert handle (e.g., padding-bottom) and that table has position: relative.\n  - Adjust table margins to remove bottom margin that would interfere with the bottom handle.\n  - Add CSS to render the selection perimeter using classes selectedCell-border-top/left/right/bottom applied to td/th.selectedCell, using a 2px highlight color for borders.\n  - Add styles for the column/row insert buttons (.table-column-insert-button and .table-row-insert-button) so they are absolutely positioned at the right side and bottom of the table respectively, have subtle background/border, are shown on table hover, and gain a visual active/dragging state. Include a small plus icon and appropriate transitions.\n  - Preserve existing column resize handle styling and table-controls styling.\n\nBehavioral expectations\n- When selecting multiple cells, only the outer perimeter shows highlighted borders; internal borders are not doubled.\n- When hovering a table in editable mode, a vertical handle appears at the right edge (column insert) and a horizontal handle at the bottom (row insert). Clicking inserts one at the end. Dragging beyond the action threshold inserts more in the drag direction; dragging backwards deletes only if the last column/row is empty. No UI should appear or persist in read-only mode. All appended DOM is cleaned up on plugin destroy or when tables are removed.\n",
      "prompt": "Enhance the TipTap table experience with two features: a visual outline for multi-cell selections and interactive insert handles for adding/removing rows and columns. The selection outline should highlight only the perimeter of a contiguous cell selection. The insert handles should appear on hover at the table’s right and bottom edges, allow single-click insertion at the end, support drag-to-insert multiple, and allow drag-back to remove only if the trailing column/row is empty. Integrate these as ProseMirror plugins with the existing table extensions so they are automatically enabled when the editor is editable, and add the necessary CSS for the outline and handles. Ensure DOM elements are created/removed appropriately as tables appear/disappear or when the editor becomes read-only.",
      "supplementalFiles": [
        "packages/editor/src/core/extensions/table/table/utilities/create-table.ts",
        "packages/editor/src/core/extensions/table/table/table-controls.ts",
        "packages/editor/src/core/extensions/table/index.ts",
        "packages/editor/src/core/extensions/table/table/index.ts",
        "packages/editor/src/core/extensions/table/table/utilities/delete-table-when-all-cells-selected.ts"
      ],
      "fileDiffs": [
        {
          "path": "packages/editor/src/core/extensions/table/plugins/insert-handlers/plugin.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/table/plugins/insert-handlers/plugin.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/plugins/insert-handlers/plugin.ts\t8534236 (parent)\n+++ packages/editor/src/core/extensions/table/plugins/insert-handlers/plugin.ts\tfcb6e26 (commit)\n@@ -0,0 +1,87 @@\n+import { type Editor } from \"@tiptap/core\";\n+import { Plugin, PluginKey } from \"@tiptap/pm/state\";\n+// local imports\n+import { createColumnInsertButton, createRowInsertButton, findAllTables, TableInfo } from \"./utils\";\n+\n+const TABLE_INSERT_PLUGIN_KEY = new PluginKey(\"table-insert\");\n+\n+export const TableInsertPlugin = (editor: Editor): Plugin => {\n+  const tableMap = new Map<HTMLElement, TableInfo>();\n+\n+  const setupTable = (tableInfo: TableInfo) => {\n+    const { tableElement } = tableInfo;\n+\n+    // Create and add column button if it doesn't exist\n+    if (!tableInfo.columnButtonElement) {\n+      const columnButton = createColumnInsertButton(editor, tableInfo);\n+      tableElement.appendChild(columnButton);\n+      tableInfo.columnButtonElement = columnButton;\n+    }\n+\n+    // Create and add row button if it doesn't exist\n+    if (!tableInfo.rowButtonElement) {\n+      const rowButton = createRowInsertButton(editor, tableInfo);\n+      tableElement.appendChild(rowButton);\n+      tableInfo.rowButtonElement = rowButton;\n+    }\n+\n+    tableMap.set(tableElement, tableInfo);\n+  };\n+\n+  const cleanupTable = (tableElement: HTMLElement) => {\n+    const tableInfo = tableMap.get(tableElement);\n+    tableInfo?.columnButtonElement?.remove();\n+    tableInfo?.rowButtonElement?.remove();\n+    tableMap.delete(tableElement);\n+  };\n+\n+  const updateAllTables = () => {\n+    if (!editor.isEditable) {\n+      // Clean up all tables if editor is not editable\n+      tableMap.forEach((_, tableElement) => {\n+        cleanupTable(tableElement);\n+      });\n+      return;\n+    }\n+\n+    const currentTables = findAllTables(editor);\n+    const currentTableElements = new Set(currentTables.map((t) => t.tableElement));\n+\n+    // Remove buttons from tables that no longer exist\n+    tableMap.forEach((_, tableElement) => {\n+      if (!currentTableElements.has(tableElement)) {\n+        cleanupTable(tableElement);\n+      }\n+    });\n+\n+    // Add buttons to new tables\n+    currentTables.forEach((tableInfo) => {\n+      if (!tableMap.has(tableInfo.tableElement)) {\n+        setupTable(tableInfo);\n+      }\n+    });\n+  };\n+\n+  return new Plugin({\n+    key: TABLE_INSERT_PLUGIN_KEY,\n+    view() {\n+      setTimeout(updateAllTables, 0);\n+\n+      return {\n+        update(view, prevState) {\n+          // Update when document changes\n+          if (!prevState.doc.eq(view.state.doc)) {\n+            updateAllTables();\n+          }\n+        },\n+        destroy() {\n+          // Clean up all tables\n+          tableMap.forEach((_, tableElement) => {\n+            cleanupTable(tableElement);\n+          });\n+          tableMap.clear();\n+        },\n+      };\n+    },\n+  });\n+};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/table/plugins/insert-handlers/utils.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/table/plugins/insert-handlers/utils.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/plugins/insert-handlers/utils.ts\t8534236 (parent)\n+++ packages/editor/src/core/extensions/table/plugins/insert-handlers/utils.ts\tfcb6e26 (commit)\n@@ -0,0 +1,430 @@\n+import type { Editor } from \"@tiptap/core\";\n+import type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\n+import { addColumn, removeColumn, addRow, removeRow, TableMap } from \"@tiptap/pm/tables\";\n+\n+const addSvg = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n+<path\n+  d=\"M8.5 7.49988V3.49988C8.5 3.22374 8.27614 2.99988 8 2.99988C7.72386 2.99988 7.5 3.22374 7.5 3.49988L7.5 7.49988L3.5 7.49988C3.22386 7.49988 3 7.72374 3 7.99988C3 8.27602 3.22386 8.49988 3.5 8.49988H7.5L7.5 12.4999C7.5 12.776 7.72386 12.9999 8 12.9999C8.27614 12.9999 8.5 12.776 8.5 12.4999L8.5 8.49988L12.5 8.49988C12.7761 8.49988 13 8.27602 13 7.99988C13 7.72374 12.7761 7.49988 12.5 7.49988L8.5 7.49988Z\"\n+  fill=\"currentColor\"\n+/>\n+</svg>`;\n+\n+export type TableInfo = {\n+  tableElement: HTMLElement;\n+  tableNode: ProseMirrorNode;\n+  tablePos: number;\n+  columnButtonElement?: HTMLElement;\n+  rowButtonElement?: HTMLElement;\n+};\n+\n+export const createColumnInsertButton = (editor: Editor, tableInfo: TableInfo): HTMLElement => {\n+  const button = document.createElement(\"button\");\n+  button.type = \"button\";\n+  button.className = \"table-column-insert-button\";\n+  button.title = \"Insert columns\";\n+  button.ariaLabel = \"Insert columns\";\n+\n+  const icon = document.createElement(\"span\");\n+  icon.innerHTML = addSvg;\n+  button.appendChild(icon);\n+\n+  let mouseDownX = 0;\n+  let isDragging = false;\n+  let dragStarted = false;\n+  let lastActionX = 0;\n+  const DRAG_THRESHOLD = 5; // pixels to start drag\n+  const ACTION_THRESHOLD = 150; // pixels total distance to trigger action\n+\n+  const onMouseDown = (e: MouseEvent) => {\n+    if (e.button !== 0) return; // Only left mouse button\n+\n+    e.preventDefault();\n+    e.stopPropagation();\n+\n+    mouseDownX = e.clientX;\n+    lastActionX = e.clientX;\n+    isDragging = false;\n+    dragStarted = false;\n+\n+    document.addEventListener(\"mousemove\", onMouseMove);\n+    document.addEventListener(\"mouseup\", onMouseUp);\n+  };\n+\n+  const onMouseMove = (e: MouseEvent) => {\n+    const deltaX = e.clientX - mouseDownX;\n+    const distance = Math.abs(deltaX);\n+\n+    // Start dragging if moved more than threshold\n+    if (!isDragging && distance > DRAG_THRESHOLD) {\n+      isDragging = true;\n+      dragStarted = true;\n+\n+      // Visual feedback\n+      button.classList.add(\"dragging\");\n+      document.body.style.userSelect = \"none\";\n+    }\n+\n+    if (isDragging) {\n+      const totalDistance = Math.abs(e.clientX - lastActionX);\n+\n+      // Only trigger action when total distance reaches threshold\n+      if (totalDistance >= ACTION_THRESHOLD) {\n+        // Determine direction based on current movement relative to last action point\n+        const directionFromLastAction = e.clientX - lastActionX;\n+\n+        // Right direction - add columns\n+        if (directionFromLastAction > 0) {\n+          insertColumnAfterLast(editor, tableInfo);\n+          lastActionX = e.clientX; // Reset action point\n+        }\n+        // Left direction - delete empty columns\n+        else if (directionFromLastAction < 0) {\n+          const deleted = removeLastColumn(editor, tableInfo);\n+          if (deleted) {\n+            lastActionX = e.clientX; // Reset action point\n+          }\n+        }\n+      }\n+    }\n+  };\n+\n+  const onMouseUp = () => {\n+    document.removeEventListener(\"mousemove\", onMouseMove);\n+    document.removeEventListener(\"mouseup\", onMouseUp);\n+\n+    if (isDragging) {\n+      // Clean up drag state\n+      button.classList.remove(\"dragging\");\n+      document.body.style.cursor = \"\";\n+      document.body.style.userSelect = \"\";\n+    } else if (!dragStarted) {\n+      // Handle as click if no dragging occurred\n+      insertColumnAfterLast(editor, tableInfo);\n+    }\n+\n+    isDragging = false;\n+    dragStarted = false;\n+  };\n+\n+  button.addEventListener(\"mousedown\", onMouseDown);\n+\n+  // Prevent context menu and text selection\n+  button.addEventListener(\"contextmenu\", (e) => e.preventDefault());\n+  button.addEventListener(\"selectstart\", (e) => e.preventDefault());\n+\n+  return button;\n+};\n+\n+export const createRowInsertButton = (editor: Editor, tableInfo: TableInfo): HTMLElement => {\n+  const button = document.createElement(\"button\");\n+  button.type = \"button\";\n+  button.className = \"table-row-insert-button\";\n+  button.title = \"Insert rows\";\n+  button.ariaLabel = \"Insert rows\";\n+\n+  const icon = document.createElement(\"span\");\n+  icon.innerHTML = addSvg;\n+  button.appendChild(icon);\n+\n+  let mouseDownY = 0;\n+  let isDragging = false;\n+  let dragStarted = false;\n+  let lastActionY = 0;\n+  const DRAG_THRESHOLD = 5; // pixels to start drag\n+  const ACTION_THRESHOLD = 40; // pixels total distance to trigger action\n+\n+  const onMouseDown = (e: MouseEvent) => {\n+    if (e.button !== 0) return; // Only left mouse button\n+\n+    e.preventDefault();\n+    e.stopPropagation();\n+\n+    mouseDownY = e.clientY;\n+    lastActionY = e.clientY;\n+    isDragging = false;\n+    dragStarted = false;\n+\n+    document.addEventListener(\"mousemove\", onMouseMove);\n+    document.addEventListener(\"mouseup\", onMouseUp);\n+  };\n+\n+  const onMouseMove = (e: MouseEvent) => {\n+    const deltaY = e.clientY - mouseDownY;\n+    const distance = Math.abs(deltaY);\n+\n+    // Start dragging if moved more than threshold\n+    if (!isDragging && distance > DRAG_THRESHOLD) {\n+      isDragging = true;\n+      dragStarted = true;\n+\n+      // Visual feedback\n+      button.classList.add(\"dragging\");\n+      document.body.style.userSelect = \"none\";\n+    }\n+\n+    if (isDragging) {\n+      const totalDistance = Math.abs(e.clientY - lastActionY);\n+\n+      // Only trigger action when total distance reaches threshold\n+      if (totalDistance >= ACTION_THRESHOLD) {\n+        // Determine direction based on current movement relative to last action point\n+        const directionFromLastAction = e.clientY - lastActionY;\n+\n+        // Down direction - add rows\n+        if (directionFromLastAction > 0) {\n+          insertRowAfterLast(editor, tableInfo);\n+          lastActionY = e.clientY; // Reset action point\n+        }\n+        // Up direction - delete empty rows\n+        else if (directionFromLastAction < 0) {\n+          const deleted = removeLastRow(editor, tableInfo);\n+          if (deleted) {\n+            lastActionY = e.clientY; // Reset action point\n+          }\n+        }\n+      }\n+    }\n+  };\n+\n+  const onMouseUp = () => {\n+    document.removeEventListener(\"mousemove\", onMouseMove);\n+    document.removeEventListener(\"mouseup\", onMouseUp);\n+\n+    if (isDragging) {\n+      // Clean up drag state\n+      button.classList.remove(\"dragging\");\n+      document.body.style.cursor = \"\";\n+      document.body.style.userSelect = \"\";\n+    } else if (!dragStarted) {\n+      // Handle as click if no dragging occurred\n+      insertRowAfterLast(editor, tableInfo);\n+    }\n+\n+    isDragging = false;\n+    dragStarted = false;\n+  };\n+\n+  button.addEventListener(\"mousedown\", onMouseDown);\n+\n+  // Prevent context menu and text selection\n+  button.addEventListener(\"contextmenu\", (e) => e.preventDefault());\n+  button.addEventListener(\"selectstart\", (e) => e.preventDefault());\n+\n+  return button;\n+};\n+\n+export const findAllTables = (editor: Editor): TableInfo[] => {\n+  const tables: TableInfo[] = [];\n+  const tableElements = editor.view.dom.querySelectorAll(\"table\");\n+\n+  tableElements.forEach((tableElement) => {\n+    // Find the table's ProseMirror position\n+    let tablePos = -1;\n+    let tableNode: ProseMirrorNode | null = null;\n+\n+    // Walk through the document to find matching table nodes\n+    editor.state.doc.descendants((node, pos) => {\n+      if (node.type.spec.tableRole === \"table\") {\n+        const domAtPos = editor.view.domAtPos(pos + 1);\n+        let domTable = domAtPos.node;\n+\n+        // Navigate to find the table element\n+        while (domTable && domTable.parentNode && domTable.nodeType !== Node.ELEMENT_NODE) {\n+          domTable = domTable.parentNode;\n+        }\n+\n+        while (domTable && domTable.parentNode && (domTable as HTMLElement).tagName !== \"TABLE\") {\n+          domTable = domTable.parentNode;\n+        }\n+\n+        if (domTable === tableElement) {\n+          tablePos = pos;\n+          tableNode = node;\n+          return false; // Stop iteration\n+        }\n+      }\n+    });\n+\n+    if (tablePos !== -1 && tableNode) {\n+      tables.push({\n+        tableElement,\n+        tableNode,\n+        tablePos,\n+      });\n+    }\n+  });\n+\n+  return tables;\n+};\n+\n+const getCurrentTableInfo = (editor: Editor, tableInfo: TableInfo): TableInfo => {\n+  // Refresh table info to get latest state\n+  const tables = findAllTables(editor);\n+  const updated = tables.find((t) => t.tableElement === tableInfo.tableElement);\n+  return updated || tableInfo;\n+};\n+\n+// Column functions\n+const insertColumnAfterLast = (editor: Editor, tableInfo: TableInfo) => {\n+  const currentTableInfo = getCurrentTableInfo(editor, tableInfo);\n+  const { tableNode, tablePos } = currentTableInfo;\n+  const tableMapData = TableMap.get(tableNode);\n+  const lastColumnIndex = tableMapData.width;\n+\n+  const tr = editor.state.tr;\n+  const rect = {\n+    map: tableMapData,\n+    tableStart: tablePos,\n+    table: tableNode,\n+    top: 0,\n+    left: 0,\n+    bottom: tableMapData.height - 1,\n+    right: tableMapData.width - 1,\n+  };\n+\n+  const newTr = addColumn(tr, rect, lastColumnIndex);\n+  editor.view.dispatch(newTr);\n+};\n+\n+const removeLastColumn = (editor: Editor, tableInfo: TableInfo): boolean => {\n+  const currentTableInfo = getCurrentTableInfo(editor, tableInfo);\n+  const { tableNode, tablePos } = currentTableInfo;\n+  const tableMapData = TableMap.get(tableNode);\n+\n+  // Don't delete if only one column left\n+  if (tableMapData.width <= 1) {\n+    return false;\n+  }\n+\n+  const lastColumnIndex = tableMapData.width - 1;\n+\n+  // Check if last column is empty\n+  if (!isColumnEmpty(currentTableInfo, lastColumnIndex)) {\n+    return false;\n+  }\n+\n+  const tr = editor.state.tr;\n+  const rect = {\n+    map: tableMapData,\n+    tableStart: tablePos,\n+    table: tableNode,\n+    top: 0,\n+    left: 0,\n+    bottom: tableMapData.height - 1,\n+    right: tableMapData.width - 1,\n+  };\n+\n+  removeColumn(tr, rect, lastColumnIndex);\n+  editor.view.dispatch(tr);\n+  return true;\n+};\n+\n+// Helper function to check if a single cell is empty\n+const isCellEmpty = (cell: ProseMirrorNode | null | undefined): boolean => {\n+  if (!cell || cell.content.size === 0) {\n+    return true;\n+  }\n+\n+  // Check if cell has any non-empty content\n+  let hasContent = false;\n+  cell.content.forEach((node) => {\n+    if (node.type.name === \"paragraph\") {\n+      if (node.content.size > 0) {\n+        hasContent = true;\n+      }\n+    } else if (node.content.size > 0 || node.isText) {\n+      hasContent = true;\n+    }\n+  });\n+\n+  return !hasContent;\n+};\n+\n+const isColumnEmpty = (tableInfo: TableInfo, columnIndex: number): boolean => {\n+  const { tableNode } = tableInfo;\n+  const tableMapData = TableMap.get(tableNode);\n+\n+  // Check each cell in the column\n+  for (let row = 0; row < tableMapData.height; row++) {\n+    const cellIndex = row * tableMapData.width + columnIndex;\n+    const cellPos = tableMapData.map[cellIndex];\n+    const cell = tableNode.nodeAt(cellPos);\n+\n+    if (!isCellEmpty(cell)) {\n+      return false;\n+    }\n+  }\n+  return true;\n+};\n+\n+// Row functions\n+const insertRowAfterLast = (editor: Editor, tableInfo: TableInfo) => {\n+  const currentTableInfo = getCurrentTableInfo(editor, tableInfo);\n+  const { tableNode, tablePos } = currentTableInfo;\n+  const tableMapData = TableMap.get(tableNode);\n+  const lastRowIndex = tableMapData.height;\n+\n+  const tr = editor.state.tr;\n+  const rect = {\n+    map: tableMapData,\n+    tableStart: tablePos,\n+    table: tableNode,\n+    top: 0,\n+    left: 0,\n+    bottom: tableMapData.height - 1,\n+    right: tableMapData.width - 1,\n+  };\n+\n+  const newTr = addRow(tr, rect, lastRowIndex);\n+  editor.view.dispatch(newTr);\n+};\n+\n+const removeLastRow = (editor: Editor, tableInfo: TableInfo): boolean => {\n+  const currentTableInfo = getCurrentTableInfo(editor, tableInfo);\n+  const { tableNode, tablePos } = currentTableInfo;\n+  const tableMapData = TableMap.get(tableNode);\n+\n+  // Don't delete if only one row left\n+  if (tableMapData.height <= 1) {\n+    return false;\n+  }\n+\n+  const lastRowIndex = tableMapData.height - 1;\n+\n+  // Check if last row is empty\n+  if (!isRowEmpty(currentTableInfo, lastRowIndex)) {\n+    return false;\n+  }\n+\n+  const tr = editor.state.tr;\n+  const rect = {\n+    map: tableMapData,\n+    tableStart: tablePos,\n+    table: tableNode,\n+    top: 0,\n+    left: 0,\n+    bottom: tableMapData.height - 1,\n+    right: tableMapData.width - 1,\n+  };\n+\n+  removeRow(tr, rect, lastRowIndex);\n+  editor.view.dispatch(tr);\n+  return true;\n+};\n+\n+const isRowEmpty = (tableInfo: TableInfo, rowIndex: number): boolean => {\n+  const { tableNode } = tableInfo;\n+  const tableMapData = TableMap.get(tableNode);\n+\n+  // Check each cell in the row\n+  for (let col = 0; col < tableMapData.width; col++) {\n+    const cellIndex = rowIndex * tableMapData.width + col;\n+    const cellPos = tableMapData.map[cellIndex];\n+    const cell = tableNode.nodeAt(cellPos);\n+\n+    if (!isCellEmpty(cell)) {\n+      return false;\n+    }\n+  }\n+  return true;\n+};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/table/plugins/selection-outline/plugin.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/table/plugins/selection-outline/plugin.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/plugins/selection-outline/plugin.ts\t8534236 (parent)\n+++ packages/editor/src/core/extensions/table/plugins/selection-outline/plugin.ts\tfcb6e26 (commit)\n@@ -0,0 +1,58 @@\n+import { findParentNode, type Editor } from \"@tiptap/core\";\n+import { Plugin, PluginKey } from \"@tiptap/pm/state\";\n+import { CellSelection, TableMap } from \"@tiptap/pm/tables\";\n+import { Decoration, DecorationSet } from \"@tiptap/pm/view\";\n+// local imports\n+import { getCellBorderClasses } from \"./utils\";\n+\n+type TableCellSelectionOutlinePluginState = {\n+  decorations?: DecorationSet;\n+};\n+\n+const TABLE_SELECTION_OUTLINE_PLUGIN_KEY = new PluginKey(\"table-cell-selection-outline\");\n+\n+export const TableCellSelectionOutlinePlugin = (editor: Editor): Plugin<TableCellSelectionOutlinePluginState> =>\n+  new Plugin<TableCellSelectionOutlinePluginState>({\n+    key: TABLE_SELECTION_OUTLINE_PLUGIN_KEY,\n+    state: {\n+      init: () => ({}),\n+      apply(tr, prev, oldState, newState) {\n+        if (!editor.isEditable) return {};\n+        const table = findParentNode((node) => node.type.spec.tableRole === \"table\")(newState.selection);\n+        const hasDocChanged = tr.docChanged || !newState.selection.eq(oldState.selection);\n+        if (!table || !hasDocChanged) {\n+          return table === undefined ? {} : prev;\n+        }\n+\n+        const { selection } = newState;\n+        if (!(selection instanceof CellSelection)) return {};\n+\n+        const decorations: Decoration[] = [];\n+        const tableMap = TableMap.get(table.node);\n+        const selectedCells: number[] = [];\n+\n+        // First, collect all selected cell positions\n+        selection.forEachCell((_node, pos) => {\n+          const start = pos - table.pos - 1;\n+          selectedCells.push(start);\n+        });\n+\n+        // Then, add decorations with appropriate border classes\n+        selection.forEachCell((node, pos) => {\n+          const start = pos - table.pos - 1;\n+          const classes = getCellBorderClasses(start, selectedCells, tableMap);\n+\n+          decorations.push(Decoration.node(pos, pos + node.nodeSize, { class: classes.join(\" \") }));\n+        });\n+\n+        return {\n+          decorations: DecorationSet.create(newState.doc, decorations),\n+        };\n+      },\n+    },\n+    props: {\n+      decorations(state) {\n+        return TABLE_SELECTION_OUTLINE_PLUGIN_KEY.getState(state).decorations;\n+      },\n+    },\n+  });\n"
        },
        {
          "path": "packages/editor/src/core/extensions/table/plugins/selection-outline/utils.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/table/plugins/selection-outline/utils.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/plugins/selection-outline/utils.ts\t8534236 (parent)\n+++ packages/editor/src/core/extensions/table/plugins/selection-outline/utils.ts\tfcb6e26 (commit)\n@@ -0,0 +1,75 @@\n+import type { TableMap } from \"@tiptap/pm/tables\";\n+\n+/**\n+ * Calculates the positions of cells adjacent to a given cell in a table\n+ * @param cellStart - The start position of the current cell in the document\n+ * @param tableMap - ProseMirror's table mapping structure containing cell positions and dimensions\n+ * @returns Object with positions of adjacent cells (undefined if cell doesn't exist at table edge)\n+ */\n+const getAdjacentCellPositions = (\n+  cellStart: number,\n+  tableMap: TableMap\n+): { top?: number; bottom?: number; left?: number; right?: number } => {\n+  // Extract table dimensions\n+  // width -> number of columns in the table\n+  // height -> number of rows in the table\n+  const { width, height } = tableMap;\n+\n+  // Find the index of our cell in the flat tableMap.map array\n+  // tableMap.map contains start positions of all cells in row-by-row order\n+  const cellIndex = tableMap.map.indexOf(cellStart);\n+\n+  // Safety check: if cell position not found in table map, return empty object\n+  if (cellIndex === -1) return {};\n+\n+  // Convert flat array index to 2D grid coordinates\n+  // row = which row the cell is in (0-based from top)\n+  // col = which column the cell is in (0-based from left)\n+  const row = Math.floor(cellIndex / width); // Integer division gives row number\n+  const col = cellIndex % width; // Remainder gives column number\n+\n+  return {\n+    // Top cell: same column, one row up\n+    // Check if we're not in the first row (row > 0) before calculating\n+    top: row > 0 ? tableMap.map[(row - 1) * width + col] : undefined,\n+\n+    // Bottom cell: same column, one row down\n+    // Check if we're not in the last row (row < height - 1) before calculating\n+    bottom: row < height - 1 ? tableMap.map[(row + 1) * width + col] : undefined,\n+\n+    // Left cell: same row, one column left\n+    // Check if we're not in the first column (col > 0) before calculating\n+    left: col > 0 ? tableMap.map[row * width + (col - 1)] : undefined,\n+\n+    // Right cell: same row, one column right\n+    // Check if we're not in the last column (col < width - 1) before calculating\n+    right: col < width - 1 ? tableMap.map[row * width + (col + 1)] : undefined,\n+  };\n+};\n+\n+export const getCellBorderClasses = (cellStart: number, selectedCells: number[], tableMap: TableMap): string[] => {\n+  const adjacent = getAdjacentCellPositions(cellStart, tableMap);\n+  const classes: string[] = [];\n+\n+  // Add border-right if right cell is not selected or doesn't exist\n+  if (adjacent.right === undefined || !selectedCells.includes(adjacent.right)) {\n+    classes.push(\"selectedCell-border-right\");\n+  }\n+\n+  // Add border-left if left cell is not selected or doesn't exist\n+  if (adjacent.left === undefined || !selectedCells.includes(adjacent.left)) {\n+    classes.push(\"selectedCell-border-left\");\n+  }\n+\n+  // Add border-top if top cell is not selected or doesn't exist\n+  if (adjacent.top === undefined || !selectedCells.includes(adjacent.top)) {\n+    classes.push(\"selectedCell-border-top\");\n+  }\n+\n+  // Add border-bottom if bottom cell is not selected or doesn't exist\n+  if (adjacent.bottom === undefined || !selectedCells.includes(adjacent.bottom)) {\n+    classes.push(\"selectedCell-border-bottom\");\n+  }\n+\n+  return classes;\n+};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/table/table-cell.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/table/table-cell.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/table-cell.ts\t8534236 (parent)\n+++ packages/editor/src/core/extensions/table/table-cell.ts\tfcb6e26 (commit)\n@@ -1,9 +1,9 @@\n import { mergeAttributes, Node } from \"@tiptap/core\";\n // constants\n import { CORE_EXTENSIONS } from \"@/constants/extension\";\n // local imports\n-import { TableCellSelectionOutlinePlugin } from \"./plugins/table-selection-outline/plugin\";\n+import { TableCellSelectionOutlinePlugin } from \"./plugins/selection-outline/plugin\";\n import { DEFAULT_COLUMN_WIDTH } from \"./table\";\n \n export interface TableCellOptions {\n   HTMLAttributes: Record<string, any>;\n"
        },
        {
          "path": "packages/editor/src/core/extensions/table/table/table.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/table/table/table.ts\n===================================================================\n--- packages/editor/src/core/extensions/table/table/table.ts\t8534236 (parent)\n+++ packages/editor/src/core/extensions/table/table/table.ts\tfcb6e26 (commit)\n@@ -22,8 +22,9 @@\n import { Decoration } from \"@tiptap/pm/view\";\n // constants\n import { CORE_EXTENSIONS } from \"@/constants/extension\";\n // local imports\n+import { TableInsertPlugin } from \"../plugins/insert-handlers/plugin\";\n import { tableControls } from \"./table-controls\";\n import { TableView } from \"./table-view\";\n import { createTable } from \"./utilities/create-table\";\n import { deleteTableWhenAllCellsSelected } from \"./utilities/delete-table-when-all-cells-selected\";\n@@ -265,8 +266,9 @@\n       tableEditing({\n         allowTableNodeSelection: this.options.allowTableNodeSelection,\n       }),\n       tableControls(),\n+      TableInsertPlugin(this.editor),\n     ];\n \n     if (isResizable) {\n       plugins.unshift(\n"
        },
        {
          "path": "packages/editor/src/styles/table.css",
          "status": "modified",
          "diff": "Index: packages/editor/src/styles/table.css\n===================================================================\n--- packages/editor/src/styles/table.css\t8534236 (parent)\n+++ packages/editor/src/styles/table.css\tfcb6e26 (commit)\n@@ -1,11 +1,13 @@\n .table-wrapper {\n   overflow-x: auto;\n+  padding-bottom: 30px;\n \n   table {\n+    position: relative;\n     border-collapse: collapse;\n     table-layout: fixed;\n-    margin: 0.5rem 0 1rem 0;\n+    margin: 0.5rem 0 0 0;\n     border: 1px solid rgba(var(--color-border-200));\n     width: 100%;\n \n     td,\n@@ -21,8 +23,9 @@\n       > * {\n         margin-bottom: 0;\n       }\n \n+      /* Selected cell outline */\n       &.selectedCell {\n         user-select: none;\n \n         &::after {\n@@ -49,8 +52,9 @@\n         &.selectedCell-border-right::after {\n           border-right: 2px solid rgba(var(--color-primary-100));\n         }\n       }\n+      /* End selected cell outline */\n     }\n \n     th {\n       font-weight: 500;\n@@ -64,16 +68,18 @@\n       }\n     }\n   }\n \n+  /* Selected status */\n   &.ProseMirror-selectednode {\n     table {\n       background-color: rgba(var(--color-primary-100), 0.2);\n     }\n   }\n+  /* End selected status */\n }\n \n-/* table dropdown */\n+/* Column resizer */\n .table-wrapper table .column-resize-handle {\n   position: absolute;\n   right: -1px;\n   top: -1px;\n@@ -82,8 +88,9 @@\n   z-index: 5;\n   background-color: rgba(var(--color-primary-100));\n   pointer-events: none;\n }\n+/* End column resizer */\n \n .table-wrapper .table-controls {\n   position: absolute;\n \n@@ -145,4 +152,66 @@\n .table-wrapper.controls--disabled .table-controls .columns-control {\n   opacity: 0;\n   pointer-events: none;\n }\n+\n+/* Insert buttons */\n+.table-wrapper {\n+  .table-column-insert-button,\n+  .table-row-insert-button {\n+    position: absolute;\n+    background-color: rgba(var(--color-background-90));\n+    color: rgba(var(--color-text-300));\n+    border: 1px solid rgba(var(--color-border-200));\n+    border-radius: 4px;\n+    display: grid;\n+    place-items: center;\n+    opacity: 0;\n+    pointer-events: none;\n+    outline: none;\n+    z-index: 1000;\n+    transition: all 0.2s ease;\n+\n+    &:hover {\n+      background-color: rgba(var(--color-background-80));\n+      color: rgba(var(--color-text-100));\n+    }\n+\n+    &.dragging {\n+      opacity: 1;\n+      pointer-events: auto;\n+      background-color: rgba(var(--color-primary-100), 0.2);\n+      color: rgba(var(--color-text-100));\n+    }\n+\n+    svg {\n+      width: 12px;\n+      height: 12px;\n+    }\n+  }\n+\n+  .table-column-insert-button {\n+    top: 0;\n+    right: -20px;\n+    width: 20px;\n+    height: 100%;\n+    transform: translateX(50%);\n+  }\n+\n+  .table-row-insert-button {\n+    bottom: -20px;\n+    left: 0;\n+    width: 100%;\n+    height: 20px;\n+    transform: translateY(50%);\n+  }\n+\n+  /* Show buttons on table hover */\n+  &:hover {\n+    .table-column-insert-button,\n+    .table-row-insert-button {\n+      opacity: 1;\n+      pointer-events: auto;\n+    }\n+  }\n+}\n+/* End insert buttons */\n"
        }
      ]
    },
    {
      "id": "refactor-dropdowns",
      "sha": "f3daac6f95bdb5f98485235edcf56f66012033ac",
      "parentSha": "5660b285740c7648a4cb3946c090a0d1ee1da987",
      "spec": "Implement a UI and context refactor to decouple dropdowns/work item modal properties from store hooks and introduce base components with wrapper adapters. Apply the following changes:\n\n1) Introduce base + wrapper pattern for dropdowns and update barrel exports\n- Member dropdown:\n  - Create MemberDropdownBase in apps/web/core/components/dropdowns/member/base.tsx. It must receive plain props only (no store access): getUserDetails(userId) -> IUserLite|undefined, memberIds: string[], onDropdownOpen?: () => void, and existing UI props. It should pass combobox props directly (including multiple) and render MemberOptions with getUserDetails, memberIds, onDropdownOpen, placement, referenceElement, optionsClassName.\n  - Update MemberOptions to accept getUserDetails, memberIds, onDropdownOpen instead of reading from useMember or useParams. Remove role/guest filtering; only derive options via getUserDetails and query filtering. Focus the input on open and call onDropdownOpen when isOpen becomes true.\n  - Add MemberDropdown wrapper in apps/web/core/components/dropdowns/member/dropdown.tsx. It must use useMember to inject getUserDetails, resolve memberIds (provided, project-based via getProjectMemberIds, or workspaceMemberIds), and lazily fetch project members on open via fetchProjectMembers using workspaceSlug from useParams.\n- Module dropdown:\n  - Create ModuleDropdownBase in apps/web/core/components/dropdowns/module/base.tsx that accepts getModuleById(moduleId) -> IModule|null, moduleIds?: string[], onDropdownOpen?: () => void, and existing UI props. Remove internal store calls. Ensure comboboxProps includes multiple directly.\n  - Move button content rendering into a new ModuleButtonContent component in apps/web/core/components/dropdowns/module/button-content.tsx; it should use useModule for name resolution and handle tag removal for multi-select.\n  - Update ModuleOptions in apps/web/core/components/dropdowns/module/module-options.tsx to accept getModuleById, moduleIds, and onDropdownOpen. Do not access store/hooks internally.\n  - Add ModuleDropdown wrapper in apps/web/core/components/dropdowns/module/dropdown.tsx. It must use useModule to get getModuleById, getProjectModuleIds, and fetchModules; derive moduleIds; and fetch on open if needed, using workspaceSlug from useParams.\n- Project dropdown:\n  - Create ProjectDropdownBase in apps/web/core/components/dropdowns/project/base.tsx that accepts getProjectById(projectId) and projectIds: string[]. Change renderCondition signature to renderCondition(projectId: string) and update internal option generation accordingly. Handle icon rendering using projectDetails.logo_props when present.\n  - Add ProjectDropdown wrapper in apps/web/core/components/dropdowns/project/dropdown.tsx that injects joinedProjectIds and getProjectById via useProject.\n- State dropdown:\n  - Create WorkItemStateDropdownBase in apps/web/core/components/dropdowns/state/base.tsx that accepts getStateById(stateId), stateIds: string[], onDropdownOpen?: () => void, and isInitializing?: boolean to show a spinner. Compute statesList from stateIds and getStateById. Keep default state selection logic, showDefaultState handling, and dropdown interactions but remove internal store fetching.\n  - Add StateDropdown wrapper in apps/web/core/components/dropdowns/state/dropdown.tsx that uses useProjectState to derive stateIds (or accept props.stateIds when provided), injects getStateById, and implements onDropdownOpen with a local state loader to fetchProjectStates when necessary (based on workspaceSlug and projectId). Pass isInitializing to the base.\n- Update barrel exports in apps/web/core/components/dropdowns/index.ts to export the wrapper components: member/dropdown, module/dropdown, project/dropdown, state/dropdown (instead of previous index.tsx files).\n\n2) Update callsites and prop contracts affected by the dropdown refactor\n- Where ProjectDropdown’s renderCondition was previously (project: TProject) => boolean, update usages to (projectId: string) => boolean. Update at least in:\n  - apps/web/core/components/cycles/form.tsx\n  - apps/web/core/components/modules/form.tsx\n  - apps/web/core/components/issues/issue-modal/components/project-select.tsx\n- Ensure any consumer relying on previous project obj receives projectId and uses injected getProjectById when needed internally (now handled by ProjectDropdownBase).\n\n3) Issue modal context and behavior adjustments\n- In apps/web/core/components/issues/issue-modal/context/issue-modal-context.tsx:\n  - Add TCreateSubWorkItemProps with workspaceSlug, projectId, parentId.\n  - Extend TIssueModalContext with handleCreateSubWorkItem(props: TCreateSubWorkItemProps) => Promise<void>.\n  - Update THandleProjectEntitiesFetchProps to accept workItemProjectId: string|null|undefined and workItemTypeId: string|undefined; remove templateId from this type.\n- In apps/web/ce/components/issues/issue-modal/provider.tsx (or the applicable provider), add handleCreateSubWorkItem to the value with a default no-op Promise.resolve() to match the context type.\n- In apps/web/core/components/issues/issue-modal/base.tsx, after successful issue creation in create flow, invoke handleCreateSubWorkItem with workspaceSlug, response.project_id, and response.id to initialize sub-work item creation flows.\n\n4) Replace CE additional properties with new work item component\n- Remove the CE IssueAdditionalProperties component and its export from apps/web/ce/components/issues/issue-modal/index.ts.\n- Add WorkItemModalAdditionalProperties in apps/web/ce/components/issues/issue-modal/modal-additional-properties.tsx that accepts: isDraft?: boolean, projectId: string|null, workItemId: string|undefined, workspaceSlug: string; it should return null by default (placeholder for future EE/CE customizations).\n- In apps/web/core/components/issues/issue-modal/form.tsx, replace usage of IssueAdditionalProperties with WorkItemModalAdditionalProperties. Ensure it is rendered under the header with the same layout intent and toggle the footer shadow only when there are active additional properties.\n\n5) Label selection refactor and label creation injection\n- Split label select into base and wrapper:\n  - Create WorkItemLabelSelectBase in apps/web/core/components/issues/select/base.tsx that accepts getLabelById(labelId) -> IIssueLabel|null, labelIds: string[], onDropdownOpen?: () => void, and existing UI props. Do not access store or router. Derive labelsList from labelIds and filter based on query. Call onDropdownOpen on open. Use labelsList for displaying and filtering; pass value to IssueLabelsList correctly.\n  - Create IssueLabelSelect wrapper in apps/web/core/components/issues/select/dropdown.tsx that uses useLabel to get getProjectLabelIds, getLabelById, and fetchProjectLabels; derive project label IDs; and fetch on open if needed based on workspaceSlug and projectId.\n  - Update the index barrel at apps/web/core/components/issues/select/index.ts to export from ./dropdown.\n- Update CreateLabelModal in apps/web/core/components/labels/create-label-modal.tsx to accept a createLabel prop: (data: Partial<IIssueLabel>) => Promise<IIssueLabel>. Remove its internal store import/useParams. On submit, call the injected createLabel(formData) then close modal and trigger onSuccess. Keep UI and validations intact.\n- Update issue modal form to pass a bound createLabel function from useLabel that captures workspaceSlug and projectId (createLabel.bind(...)) and remove passing projectId to the modal. Ensure newly created label is added into the form’s label_ids array and triggers handleFormChange.\n\n6) Dropdown behavior consistency adjustments\n- In all base components using Combobox, pass the multiple prop directly in comboboxProps rather than conditionally adding it.\n- Ensure onDropdownOpen handlers (where provided) are called whenever isOpen becomes true and the fetch conditions are unmet (e.g., ids undefined), and that input is focused on desktop.\n\n7) react-hook-form helper addition\n- Add apps/web/helpers/react-hook-form.helper.ts with a getNestedError(errors, path) function that traverses a react-hook-form errors object by dot path to return a FieldError or undefined.\n\n8) URL utility normalization update\n- Update joinUrlPath in packages/utils/src/string.ts to normalize all segments by removing leading slashes on every segment and removing trailing slashes on every segment, regardless of their position. Preserve existing behavior for joining segments and skipping empty segments without changing function signature or exports.\n\nAcceptance criteria:\n- All dropdown components compile, with base components free of store/router usage and wrappers responsible for data injection and lazy fetching on open.\n- ProjectDropdown renderCondition is consistently typed to receive projectId string across callsites.\n- Issue creation flow triggers handleCreateSubWorkItem after creating a new issue; context type and provider expose this method.\n- WorkItemModalAdditionalProperties replaces IssueAdditionalProperties and renders as a no-op; UI layout around it remains stable.\n- Label selection works as before with lazy fetching on open; CreateLabelModal creates labels via injected function and updates the form as expected.\n- getNestedError helper is available and type-safe.\n- joinUrlPath trims leading and trailing slashes on all segments; existing consumers work unchanged.\n",
      "prompt": "Refactor the web app’s dropdown and issue modal stack to decouple UI from MobX stores and align APIs across components.\n\nGoals:\n- Split each dropdown into a pure base component that only receives data (IDs and getters) and a thin wrapper that wires store hooks and lazy fetching on open. Apply this to member, module, project, state, and label selection dropdowns, and update the barrel exports to point at the new wrapper components.\n- Standardize Project selection’s renderCondition to accept a projectId string rather than a full project object, and update callsites accordingly.\n- Update the issue modal context to add a handler for creating sub-work items and adjust the project entities fetch signature. After successful issue creation, invoke the new sub-work item handler.\n- Replace the old additional properties component with a new work-item modal additional properties placeholder and update the form to use it.\n- Change label selection to the base/wrapper pattern and inject label creation into CreateLabelModal rather than reading from stores directly. Ensure newly created labels are added to the form’s state.\n- Add a utility to get nested react-hook-form errors by path.\n- Normalize URL path joining to strip leading and trailing slashes from every segment.\n\nMaintain existing UX and accessibility, preserve current visual styles, and ensure lazy data fetching occurs on dropdown open only when needed.",
      "supplementalFiles": [
        "apps/web/core/components/dropdowns/buttons.tsx",
        "apps/web/core/components/dropdowns/constants.ts",
        "apps/web/core/components/dropdowns/types.ts",
        "apps/web/core/components/issues/issue-modal/components/default-properties.tsx",
        "apps/web/core/hooks/use-dropdown.ts",
        "apps/web/core/hooks/use-platform-os.tsx",
        "apps/web/core/components/settings/sidebar/nav-item.tsx"
      ],
      "fileDiffs": [
        {
          "path": "apps/web/ce/components/issues/issue-modal/additional-properties.tsx",
          "status": "deleted",
          "diff": "Index: apps/web/ce/components/issues/issue-modal/additional-properties.tsx\n===================================================================\n--- apps/web/ce/components/issues/issue-modal/additional-properties.tsx\t5660b28 (parent)\n+++ apps/web/ce/components/issues/issue-modal/additional-properties.tsx\tf3daac6 (commit)\n@@ -1,9 +0,0 @@\n-type TIssueAdditionalPropertiesProps = {\n-  issueId: string | undefined;\n-  issueTypeId: string | null;\n-  projectId: string;\n-  workspaceSlug: string;\n-  isDraft?: boolean;\n-};\n-\n-export const IssueAdditionalProperties: React.FC<TIssueAdditionalPropertiesProps> = () => <></>;\n"
        },
        {
          "path": "apps/web/ce/components/issues/issue-modal/index.ts",
          "status": "modified",
          "diff": "Index: apps/web/ce/components/issues/issue-modal/index.ts\n===================================================================\n--- apps/web/ce/components/issues/issue-modal/index.ts\t5660b28 (parent)\n+++ apps/web/ce/components/issues/issue-modal/index.ts\tf3daac6 (commit)\n@@ -1,4 +1,3 @@\n export * from \"./provider\";\n export * from \"./issue-type-select\";\n-export * from \"./additional-properties\";\n export * from \"./template-select\";\n"
        },
        {
          "path": "apps/web/ce/components/issues/issue-modal/modal-additional-properties.tsx",
          "status": "added",
          "diff": "Index: apps/web/ce/components/issues/issue-modal/modal-additional-properties.tsx\n===================================================================\n--- apps/web/ce/components/issues/issue-modal/modal-additional-properties.tsx\t5660b28 (parent)\n+++ apps/web/ce/components/issues/issue-modal/modal-additional-properties.tsx\tf3daac6 (commit)\n@@ -0,0 +1,10 @@\n+import React from \"react\";\n+\n+export type TWorkItemModalAdditionalPropertiesProps = {\n+  isDraft?: boolean;\n+  projectId: string | null;\n+  workItemId: string | undefined;\n+  workspaceSlug: string;\n+};\n+\n+export const WorkItemModalAdditionalProperties: React.FC<TWorkItemModalAdditionalPropertiesProps> = () => null;\n"
        },
        {
          "path": "apps/web/ce/components/issues/issue-modal/provider.tsx",
          "status": "modified",
          "diff": "Index: apps/web/ce/components/issues/issue-modal/provider.tsx\n===================================================================\n--- apps/web/ce/components/issues/issue-modal/provider.tsx\t5660b28 (parent)\n+++ apps/web/ce/components/issues/issue-modal/provider.tsx\tf3daac6 (commit)\n@@ -43,8 +43,9 @@\n         handleCreateUpdatePropertyValues: () => Promise.resolve(),\n         handleProjectEntitiesFetch: () => Promise.resolve(),\n         handleTemplateChange: () => Promise.resolve(),\n         handleConvert: () => Promise.resolve(),\n+        handleCreateSubWorkItem: () => Promise.resolve(),\n       }}\n     >\n       {children}\n     </IssueModalContext.Provider>\n"
        },
        {
          "path": "apps/web/core/components/cycles/form.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/cycles/form.tsx\n===================================================================\n--- apps/web/core/components/cycles/form.tsx\t5660b28 (parent)\n+++ apps/web/core/components/cycles/form.tsx\tf3daac6 (commit)\n@@ -82,9 +82,9 @@\n                       }\n                     }}\n                     multiple={false}\n                     buttonVariant=\"border-with-text\"\n-                    renderCondition={(project) => !!projectsWithCreatePermissions?.[project.id]}\n+                    renderCondition={(projectId) => !!projectsWithCreatePermissions?.[projectId]}\n                     tabIndex={getIndex(\"cover_image\")}\n                   />\n                 </div>\n               )}\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/index.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/components/dropdowns/index.ts\n===================================================================\n--- apps/web/core/components/dropdowns/index.ts\t5660b28 (parent)\n+++ apps/web/core/components/dropdowns/index.ts\tf3daac6 (commit)\n@@ -1,10 +1,10 @@\n-export * from \"./member\";\n+export * from \"./member/dropdown\";\n export * from \"./cycle\";\n export * from \"./date-range\";\n export * from \"./date\";\n export * from \"./estimate\";\n export * from \"./merged-date\";\n-export * from \"./module\";\n+export * from \"./module/dropdown\";\n export * from \"./priority\";\n-export * from \"./project\";\n-export * from \"./state\";\n+export * from \"./project/dropdown\";\n+export * from \"./state/dropdown\";\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/member/base.tsx",
          "status": "renamed",
          "oldPath": "apps/web/core/components/dropdowns/member/index.tsx",
          "diff": "===================================================================\n--- apps/web/core/components/dropdowns/member/index.tsx\t5660b28 (parent)\n+++ apps/web/core/components/dropdowns/member/base.tsx\tf3daac6 (commit)\n@@ -1,34 +1,33 @@\n import { useRef, useState } from \"react\";\n import { observer } from \"mobx-react\";\n import { ChevronDown, LucideIcon } from \"lucide-react\";\n+// plane imports\n import { useTranslation } from \"@plane/i18n\";\n-// ui\n+import { IUserLite } from \"@plane/types\";\n import { ComboDropDown } from \"@plane/ui\";\n // helpers\n import { cn } from \"@plane/utils\";\n // hooks\n-import { useMember } from \"@/hooks/store\";\n import { useDropdown } from \"@/hooks/use-dropdown\";\n-// components\n+// local imports\n import { DropdownButton } from \"../buttons\";\n import { BUTTON_VARIANTS_WITH_TEXT } from \"../constants\";\n import { ButtonAvatars } from \"./avatar\";\n-// constants\n import { MemberOptions } from \"./member-options\";\n-// types\n import { MemberDropdownProps } from \"./types\";\n \n-type Props = {\n-  projectId?: string;\n+type TMemberDropdownBaseProps = {\n+  getUserDetails: (userId: string) => IUserLite | undefined;\n   icon?: LucideIcon;\n+  memberIds?: string[];\n   onClose?: () => void;\n-  renderByDefault?: boolean;\n+  onDropdownOpen?: () => void;\n   optionsClassName?: string;\n-  memberIds?: string[];\n+  renderByDefault?: boolean;\n } & MemberDropdownProps;\n \n-export const MemberDropdown: React.FC<Props> = observer((props) => {\n+export const MemberDropdownBase: React.FC<TMemberDropdownBaseProps> = observer((props) => {\n   const { t } = useTranslation();\n   const {\n     button,\n     buttonClassName,\n@@ -37,41 +36,39 @@\n     className = \"\",\n     disabled = false,\n     dropdownArrow = false,\n     dropdownArrowClassName = \"\",\n-    optionsClassName = \"\",\n+    getUserDetails,\n     hideIcon = false,\n+    icon,\n+    memberIds,\n     multiple,\n     onChange,\n     onClose,\n+    onDropdownOpen,\n+    optionsClassName = \"\",\n     placeholder = t(\"members\"),\n-    tooltipContent,\n     placement,\n-    projectId,\n+    renderByDefault = true,\n     showTooltip = false,\n     showUserDetails = false,\n     tabIndex,\n+    tooltipContent,\n     value,\n-    icon,\n-    renderByDefault = true,\n-    memberIds,\n   } = props;\n-  // states\n-  const [isOpen, setIsOpen] = useState(false);\n   // refs\n   const dropdownRef = useRef<HTMLDivElement | null>(null);\n   // popper-js refs\n   const [referenceElement, setReferenceElement] = useState<HTMLButtonElement | null>(null);\n+  // states\n+  const [isOpen, setIsOpen] = useState(false);\n \n-  const { getUserDetails } = useMember();\n-\n-  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n-  const comboboxProps: any = {\n+  const comboboxProps = {\n     value,\n     onChange,\n     disabled,\n+    multiple,\n   };\n-  if (multiple) comboboxProps.multiple = true;\n \n   const { handleClose, handleKeyDown, handleOnClick } = useDropdown({\n     dropdownRef,\n     isOpen,\n@@ -162,21 +159,22 @@\n   return (\n     <ComboDropDown\n       as=\"div\"\n       ref={dropdownRef}\n+      {...comboboxProps}\n       className={cn(\"h-full\", className)}\n       onChange={dropdownOnChange}\n       onKeyDown={handleKeyDown}\n       button={comboButton}\n       renderByDefault={renderByDefault}\n-      {...comboboxProps}\n     >\n       {isOpen && (\n         <MemberOptions\n+          getUserDetails={getUserDetails}\n+          isOpen={isOpen}\n           memberIds={memberIds}\n+          onDropdownOpen={onDropdownOpen}\n           optionsClassName={optionsClassName}\n-          isOpen={isOpen}\n-          projectId={projectId}\n           placement={placement}\n           referenceElement={referenceElement}\n         />\n       )}\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/member/dropdown.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/dropdowns/member/dropdown.tsx\n===================================================================\n--- apps/web/core/components/dropdowns/member/dropdown.tsx\t5660b28 (parent)\n+++ apps/web/core/components/dropdowns/member/dropdown.tsx\tf3daac6 (commit)\n@@ -0,0 +1,48 @@\n+import { observer } from \"mobx-react\";\n+import { useParams } from \"next/navigation\";\n+import { LucideIcon } from \"lucide-react\";\n+// hooks\n+import { useMember } from \"@/hooks/store\";\n+// local imports\n+import { MemberDropdownBase } from \"./base\";\n+import { MemberDropdownProps } from \"./types\";\n+\n+type TMemberDropdownProps = {\n+  icon?: LucideIcon;\n+  memberIds?: string[];\n+  onClose?: () => void;\n+  optionsClassName?: string;\n+  projectId?: string;\n+  renderByDefault?: boolean;\n+} & MemberDropdownProps;\n+\n+export const MemberDropdown: React.FC<TMemberDropdownProps> = observer((props) => {\n+  const { memberIds: propsMemberIds, projectId } = props;\n+  // router params\n+  const { workspaceSlug } = useParams();\n+  // store hooks\n+  const {\n+    getUserDetails,\n+    project: { getProjectMemberIds, fetchProjectMembers },\n+    workspace: { workspaceMemberIds },\n+  } = useMember();\n+\n+  const memberIds = propsMemberIds\n+    ? propsMemberIds\n+    : projectId\n+      ? getProjectMemberIds(projectId, false)\n+      : workspaceMemberIds;\n+\n+  const onDropdownOpen = () => {\n+    if (!memberIds && projectId && workspaceSlug) fetchProjectMembers(workspaceSlug.toString(), projectId);\n+  };\n+\n+  return (\n+    <MemberDropdownBase\n+      {...props}\n+      getUserDetails={getUserDetails}\n+      memberIds={memberIds ?? []}\n+      onDropdownOpen={onDropdownOpen}\n+    />\n+  );\n+});\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/member/member-options.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/dropdowns/member/member-options.tsx\n===================================================================\n--- apps/web/core/components/dropdowns/member/member-options.tsx\t5660b28 (parent)\n+++ apps/web/core/components/dropdowns/member/member-options.tsx\tf3daac6 (commit)\n@@ -2,48 +2,50 @@\n \n import { useEffect, useRef, useState } from \"react\";\n import { Placement } from \"@popperjs/core\";\n import { observer } from \"mobx-react\";\n-import { useParams } from \"next/navigation\";\n import { createPortal } from \"react-dom\";\n import { usePopper } from \"react-popper\";\n import { Check, Search } from \"lucide-react\";\n import { Combobox } from \"@headlessui/react\";\n-import { EUserPermissions } from \"@plane/constants\";\n+// plane imports\n import { useTranslation } from \"@plane/i18n\";\n-// plane ui\n import { Avatar } from \"@plane/ui\";\n import { cn, getFileURL } from \"@plane/utils\";\n-// helpers\n // hooks\n-import { useUser, useMember } from \"@/hooks/store\";\n+import { useUser } from \"@/hooks/store\";\n import { usePlatformOS } from \"@/hooks/use-platform-os\";\n+import { IUserLite } from \"@plane/types\";\n \n interface Props {\n-  memberIds?: string[];\n   className?: string;\n+  getUserDetails: (userId: string) => IUserLite | undefined;\n+  isOpen: boolean;\n+  memberIds?: string[];\n+  onDropdownOpen?: () => void;\n   optionsClassName?: string;\n-  projectId?: string;\n-  referenceElement: HTMLButtonElement | null;\n   placement: Placement | undefined;\n-  isOpen: boolean;\n+  referenceElement: HTMLButtonElement | null;\n }\n \n export const MemberOptions: React.FC<Props> = observer((props: Props) => {\n-  const { memberIds: propsMemberIds, projectId, referenceElement, placement, isOpen, optionsClassName = \"\" } = props;\n+  const {\n+    getUserDetails,\n+    isOpen,\n+    memberIds,\n+    onDropdownOpen,\n+    optionsClassName = \"\",\n+    placement,\n+    referenceElement,\n+  } = props;\n+  // refs\n+  const inputRef = useRef<HTMLInputElement | null>(null);\n   // states\n   const [query, setQuery] = useState(\"\");\n   const [popperElement, setPopperElement] = useState<HTMLDivElement | null>(null);\n-  // refs\n-  const inputRef = useRef<HTMLInputElement | null>(null);\n-  // store hooks\n+  // plane hooks\n   const { t } = useTranslation();\n-  const { workspaceSlug } = useParams();\n-  const {\n-    getUserDetails,\n-    project: { getProjectMemberIds, fetchProjectMembers, getProjectMemberDetails },\n-    workspace: { workspaceMemberIds },\n-  } = useMember();\n+  // store hooks\n   const { data: currentUser } = useUser();\n   const { isMobile } = usePlatformOS();\n   // popper-js init\n   const { styles, attributes } = usePopper(referenceElement, popperElement, {\n@@ -59,24 +61,15 @@\n   });\n \n   useEffect(() => {\n     if (isOpen) {\n-      onOpen();\n+      onDropdownOpen?.();\n       if (!isMobile) {\n         inputRef.current && inputRef.current.focus();\n       }\n     }\n   }, [isOpen, isMobile]);\n \n-  const memberIds = propsMemberIds\n-    ? propsMemberIds\n-    : projectId\n-      ? getProjectMemberIds(projectId, true)\n-      : workspaceMemberIds;\n-  const onOpen = () => {\n-    if (!memberIds && workspaceSlug && projectId) fetchProjectMembers(workspaceSlug.toString(), projectId);\n-  };\n-\n   const searchInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n     if (query !== \"\" && e.key === \"Escape\") {\n       e.stopPropagation();\n       setQuery(\"\");\n@@ -85,14 +78,8 @@\n \n   const options = memberIds\n     ?.map((userId) => {\n       const userDetails = getUserDetails(userId);\n-      if (projectId) {\n-        const role = getProjectMemberDetails(userId, projectId)?.role;\n-        const isGuest = role === EUserPermissions.GUEST;\n-        if (isGuest) return;\n-      }\n-\n       return {\n         value: userId,\n         query: `${userDetails?.display_name} ${userDetails?.first_name} ${userDetails?.last_name}`,\n         content: (\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/module/base.tsx",
          "status": "renamed",
          "oldPath": "apps/web/core/components/dropdowns/module/index.tsx",
          "diff": "===================================================================\n--- apps/web/core/components/dropdowns/module/index.tsx\t5660b28 (parent)\n+++ apps/web/core/components/dropdowns/module/base.tsx\tf3daac6 (commit)\n@@ -1,36 +1,35 @@\n \"use client\";\n \n import { ReactNode, useEffect, useRef, useState } from \"react\";\n import { observer } from \"mobx-react\";\n-import { ChevronDown, X } from \"lucide-react\";\n-// i18n\n+// plane imports\n import { useTranslation } from \"@plane/i18n\";\n-// ui\n-import { ComboDropDown, DiceIcon, Tooltip } from \"@plane/ui\";\n-// helpers\n+import { IModule } from \"@plane/types\";\n+import { ComboDropDown } from \"@plane/ui\";\n import { cn } from \"@plane/utils\";\n // hooks\n-import { useModule } from \"@/hooks/store\";\n import { useDropdown } from \"@/hooks/use-dropdown\";\n import { usePlatformOS } from \"@/hooks/use-platform-os\";\n-// components\n+// local imports\n import { DropdownButton } from \"../buttons\";\n import { BUTTON_VARIANTS_WITHOUT_TEXT } from \"../constants\";\n-// types\n import { TDropdownProps } from \"../types\";\n-// constants\n+import { ModuleButtonContent } from \"./button-content\";\n import { ModuleOptions } from \"./module-options\";\n \n-type Props = TDropdownProps & {\n+type TModuleDropdownBaseProps = TDropdownProps & {\n   button?: ReactNode;\n   dropdownArrow?: boolean;\n   dropdownArrowClassName?: string;\n-  projectId: string | undefined;\n-  showCount?: boolean;\n+  getModuleById: (moduleId: string) => IModule | null;\n+  itemClassName?: string;\n+  moduleIds?: string[];\n   onClose?: () => void;\n+  onDropdownOpen?: () => void;\n+  projectId: string | undefined;\n   renderByDefault?: boolean;\n-  itemClassName?: string;\n+  showCount?: boolean;\n } & (\n     | {\n         multiple: false;\n         onChange: (val: string | null) => void;\n@@ -42,151 +41,33 @@\n         value: string[] | null;\n       }\n   );\n \n-type ButtonContentProps = {\n-  disabled: boolean;\n-  dropdownArrow: boolean;\n-  dropdownArrowClassName: string;\n-  hideIcon: boolean;\n-  hideText: boolean;\n-  onChange: (moduleIds: string[]) => void;\n-  placeholder?: string;\n-  showCount: boolean;\n-  showTooltip?: boolean;\n-  value: string | string[] | null;\n-  className?: string;\n-};\n-\n-const ButtonContent: React.FC<ButtonContentProps> = (props) => {\n+export const ModuleDropdownBase: React.FC<TModuleDropdownBaseProps> = observer((props) => {\n   const {\n-    disabled,\n-    dropdownArrow,\n-    dropdownArrowClassName,\n-    hideIcon,\n-    hideText,\n-    onChange,\n-    placeholder,\n-    showCount,\n-    showTooltip = false,\n-    value,\n-    className,\n-  } = props;\n-  // store hooks\n-  const { getModuleById } = useModule();\n-  const { isMobile } = usePlatformOS();\n-\n-  if (Array.isArray(value))\n-    return (\n-      <>\n-        {showCount ? (\n-          <div className=\"relative flex items-center max-w-full gap-1\">\n-            {!hideIcon && <DiceIcon className=\"h-3 w-3 flex-shrink-0\" />}\n-            {(value.length > 0 || !!placeholder) && (\n-              <div className=\"max-w-40 flex-grow truncate\">\n-                {value.length > 0\n-                  ? value.length === 1\n-                    ? `${getModuleById(value[0])?.name || \"module\"}`\n-                    : `${value.length} Module${value.length === 1 ? \"\" : \"s\"}`\n-                  : placeholder}\n-              </div>\n-            )}\n-          </div>\n-        ) : value.length > 0 ? (\n-          <div className=\"flex max-w-full flex-grow flex-wrap items-center gap-2 truncate py-0.5 \">\n-            {value.map((moduleId) => {\n-              const moduleDetails = getModuleById(moduleId);\n-              return (\n-                <div\n-                  key={moduleId}\n-                  className={cn(\n-                    \"flex max-w-full items-center gap-1 rounded bg-custom-background-80 py-1 text-custom-text-200\",\n-                    className\n-                  )}\n-                >\n-                  {!hideIcon && <DiceIcon className=\"h-2.5 w-2.5 flex-shrink-0\" />}\n-                  {!hideText && (\n-                    <Tooltip\n-                      tooltipHeading=\"Title\"\n-                      tooltipContent={moduleDetails?.name}\n-                      disabled={!showTooltip}\n-                      isMobile={isMobile}\n-                      renderByDefault={false}\n-                    >\n-                      <span className=\"max-w-40 flex-grow truncate text-xs font-medium\">{moduleDetails?.name}</span>\n-                    </Tooltip>\n-                  )}\n-                  {!disabled && (\n-                    <Tooltip\n-                      tooltipContent=\"Remove\"\n-                      disabled={!showTooltip}\n-                      isMobile={isMobile}\n-                      renderByDefault={false}\n-                    >\n-                      <button\n-                        type=\"button\"\n-                        className=\"flex-shrink-0\"\n-                        onClick={() => {\n-                          const newModuleIds = value.filter((m) => m !== moduleId);\n-                          onChange(newModuleIds);\n-                        }}\n-                      >\n-                        <X className=\"h-2.5 w-2.5 text-custom-text-300 hover:text-red-500\" />\n-                      </button>\n-                    </Tooltip>\n-                  )}\n-                </div>\n-              );\n-            })}\n-          </div>\n-        ) : (\n-          <>\n-            {!hideIcon && <DiceIcon className=\"h-3 w-3 flex-shrink-0\" />}\n-            <span className=\"flex-grow truncate text-left\">{placeholder}</span>\n-          </>\n-        )}\n-        {dropdownArrow && (\n-          <ChevronDown className={cn(\"h-2.5 w-2.5 flex-shrink-0\", dropdownArrowClassName)} aria-hidden=\"true\" />\n-        )}\n-      </>\n-    );\n-  else\n-    return (\n-      <>\n-        {!hideIcon && <DiceIcon className=\"h-3 w-3 flex-shrink-0\" />}\n-        {!hideText && (\n-          <span className=\"flex-grow truncate text-left\">{value ? getModuleById(value)?.name : placeholder}</span>\n-        )}\n-        {dropdownArrow && (\n-          <ChevronDown className={cn(\"h-2.5 w-2.5 flex-shrink-0\", dropdownArrowClassName)} aria-hidden=\"true\" />\n-        )}\n-      </>\n-    );\n-};\n-\n-export const ModuleDropdown: React.FC<Props> = observer((props) => {\n-  const {\n     button,\n     buttonClassName,\n-    itemClassName = \"\",\n     buttonContainerClassName,\n     buttonVariant,\n     className = \"\",\n     disabled = false,\n     dropdownArrow = false,\n     dropdownArrowClassName = \"\",\n+    getModuleById,\n     hideIcon = false,\n+    itemClassName = \"\",\n+    moduleIds,\n     multiple,\n     onChange,\n     onClose,\n     placeholder = \"\",\n     placement,\n     projectId,\n+    renderByDefault = true,\n     showCount = false,\n     showTooltip = false,\n     tabIndex,\n     value,\n-    renderByDefault = true,\n   } = props;\n   // i18n\n   const { t } = useTranslation();\n   // states\n@@ -198,10 +79,8 @@\n   const [referenceElement, setReferenceElement] = useState<HTMLButtonElement | null>(null);\n   // store hooks\n   const { isMobile } = usePlatformOS();\n \n-  const { getModuleNameById } = useModule();\n-\n   const { handleClose, handleKeyDown, handleOnClick } = useDropdown({\n     dropdownRef,\n     inputRef,\n     isOpen,\n@@ -213,14 +92,14 @@\n     onChange(val);\n     if (!multiple) handleClose();\n   };\n \n-  const comboboxProps: any = {\n+  const comboboxProps = {\n     value,\n     onChange: dropdownOnChange,\n     disabled,\n+    multiple,\n   };\n-  if (multiple) comboboxProps.multiple = true;\n \n   useEffect(() => {\n     if (isOpen && inputRef.current && !isMobile) {\n       inputRef.current.focus();\n@@ -265,18 +144,18 @@\n             tooltipHeading={t(\"common.module\")}\n             tooltipContent={\n               Array.isArray(value)\n                 ? `${value\n-                    .map((moduleId) => getModuleNameById(moduleId))\n+                    .map((moduleId) => getModuleById(moduleId)?.name)\n                     .toString()\n                     .replaceAll(\",\", \", \")}`\n                 : \"\"\n             }\n             showTooltip={showTooltip}\n             variant={buttonVariant}\n             renderToolTipByDefault={renderByDefault}\n           >\n-            <ButtonContent\n+            <ModuleButtonContent\n               disabled={disabled}\n               dropdownArrow={dropdownArrow}\n               dropdownArrowClassName={dropdownArrowClassName}\n               hideIcon={hideIcon}\n@@ -306,12 +185,13 @@\n     >\n       {isOpen && projectId && (\n         <ModuleOptions\n           isOpen={isOpen}\n-          projectId={projectId}\n           placement={placement}\n           referenceElement={referenceElement}\n           multiple={multiple}\n+          getModuleById={getModuleById}\n+          moduleIds={moduleIds}\n         />\n       )}\n     </ComboDropDown>\n   );\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/module/button-content.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/dropdowns/module/button-content.tsx\n===================================================================\n--- apps/web/core/components/dropdowns/module/button-content.tsx\t5660b28 (parent)\n+++ apps/web/core/components/dropdowns/module/button-content.tsx\tf3daac6 (commit)\n@@ -0,0 +1,129 @@\n+\"use client\";\n+\n+import { ChevronDown, X } from \"lucide-react\";\n+// plane imports\n+import { DiceIcon, Tooltip } from \"@plane/ui\";\n+import { cn } from \"@plane/utils\";\n+// hooks\n+import { useModule } from \"@/hooks/store\";\n+import { usePlatformOS } from \"@/hooks/use-platform-os\";\n+\n+type ModuleButtonContentProps = {\n+  disabled: boolean;\n+  dropdownArrow: boolean;\n+  dropdownArrowClassName: string;\n+  hideIcon: boolean;\n+  hideText: boolean;\n+  onChange: (moduleIds: string[]) => void;\n+  placeholder?: string;\n+  showCount: boolean;\n+  showTooltip?: boolean;\n+  value: string | string[] | null;\n+  className?: string;\n+};\n+\n+export const ModuleButtonContent: React.FC<ModuleButtonContentProps> = (props) => {\n+  const {\n+    disabled,\n+    dropdownArrow,\n+    dropdownArrowClassName,\n+    hideIcon,\n+    hideText,\n+    onChange,\n+    placeholder,\n+    showCount,\n+    showTooltip = false,\n+    value,\n+    className,\n+  } = props;\n+  // store hooks\n+  const { getModuleById } = useModule();\n+  const { isMobile } = usePlatformOS();\n+\n+  if (Array.isArray(value))\n+    return (\n+      <>\n+        {showCount ? (\n+          <div className=\"relative flex items-center max-w-full gap-1\">\n+            {!hideIcon && <DiceIcon className=\"h-3 w-3 flex-shrink-0\" />}\n+            {(value.length > 0 || !!placeholder) && (\n+              <div className=\"max-w-40 flex-grow truncate\">\n+                {value.length > 0\n+                  ? value.length === 1\n+                    ? `${getModuleById(value[0])?.name || \"module\"}`\n+                    : `${value.length} Module${value.length === 1 ? \"\" : \"s\"}`\n+                  : placeholder}\n+              </div>\n+            )}\n+          </div>\n+        ) : value.length > 0 ? (\n+          <div className=\"flex max-w-full flex-grow flex-wrap items-center gap-2 truncate py-0.5 \">\n+            {value.map((moduleId) => {\n+              const moduleDetails = getModuleById(moduleId);\n+              return (\n+                <div\n+                  key={moduleId}\n+                  className={cn(\n+                    \"flex max-w-full items-center gap-1 rounded bg-custom-background-80 py-1 text-custom-text-200\",\n+                    className\n+                  )}\n+                >\n+                  {!hideIcon && <DiceIcon className=\"h-2.5 w-2.5 flex-shrink-0\" />}\n+                  {!hideText && (\n+                    <Tooltip\n+                      tooltipHeading=\"Title\"\n+                      tooltipContent={moduleDetails?.name}\n+                      disabled={!showTooltip}\n+                      isMobile={isMobile}\n+                      renderByDefault={false}\n+                    >\n+                      <span className=\"max-w-40 flex-grow truncate text-xs font-medium\">{moduleDetails?.name}</span>\n+                    </Tooltip>\n+                  )}\n+                  {!disabled && (\n+                    <Tooltip\n+                      tooltipContent=\"Remove\"\n+                      disabled={!showTooltip}\n+                      isMobile={isMobile}\n+                      renderByDefault={false}\n+                    >\n+                      <button\n+                        type=\"button\"\n+                        className=\"flex-shrink-0\"\n+                        onClick={() => {\n+                          const newModuleIds = value.filter((m) => m !== moduleId);\n+                          onChange(newModuleIds);\n+                        }}\n+                      >\n+                        <X className=\"h-2.5 w-2.5 text-custom-text-300 hover:text-red-500\" />\n+                      </button>\n+                    </Tooltip>\n+                  )}\n+                </div>\n+              );\n+            })}\n+          </div>\n+        ) : (\n+          <>\n+            {!hideIcon && <DiceIcon className=\"h-3 w-3 flex-shrink-0\" />}\n+            <span className=\"flex-grow truncate text-left\">{placeholder}</span>\n+          </>\n+        )}\n+        {dropdownArrow && (\n+          <ChevronDown className={cn(\"h-2.5 w-2.5 flex-shrink-0\", dropdownArrowClassName)} aria-hidden=\"true\" />\n+        )}\n+      </>\n+    );\n+  else\n+    return (\n+      <>\n+        {!hideIcon && <DiceIcon className=\"h-3 w-3 flex-shrink-0\" />}\n+        {!hideText && (\n+          <span className=\"flex-grow truncate text-left\">{value ? getModuleById(value)?.name : placeholder}</span>\n+        )}\n+        {dropdownArrow && (\n+          <ChevronDown className={cn(\"h-2.5 w-2.5 flex-shrink-0\", dropdownArrowClassName)} aria-hidden=\"true\" />\n+        )}\n+      </>\n+    );\n+};\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/module/dropdown.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/dropdowns/module/dropdown.tsx\n===================================================================\n--- apps/web/core/components/dropdowns/module/dropdown.tsx\t5660b28 (parent)\n+++ apps/web/core/components/dropdowns/module/dropdown.tsx\tf3daac6 (commit)\n@@ -0,0 +1,56 @@\n+\"use client\";\n+\n+import { ReactNode } from \"react\";\n+import { observer } from \"mobx-react\";\n+import { useParams } from \"next/navigation\";\n+// hooks\n+import { useModule } from \"@/hooks/store\";\n+// types\n+import { TDropdownProps } from \"../types\";\n+// local imports\n+import { ModuleDropdownBase } from \"./base\";\n+\n+type TModuleDropdownProps = TDropdownProps & {\n+  button?: ReactNode;\n+  dropdownArrow?: boolean;\n+  dropdownArrowClassName?: string;\n+  projectId: string | undefined;\n+  showCount?: boolean;\n+  onClose?: () => void;\n+  renderByDefault?: boolean;\n+  itemClassName?: string;\n+} & (\n+    | {\n+        multiple: false;\n+        onChange: (val: string | null) => void;\n+        value: string | null;\n+      }\n+    | {\n+        multiple: true;\n+        onChange: (val: string[]) => void;\n+        value: string[] | null;\n+      }\n+  );\n+\n+export const ModuleDropdown: React.FC<TModuleDropdownProps> = observer((props) => {\n+  const { projectId } = props;\n+  // router\n+  const { workspaceSlug } = useParams();\n+  // store hooks\n+  const { getModuleById, getProjectModuleIds, fetchModules } = useModule();\n+  // derived values\n+  const moduleIds = projectId ? getProjectModuleIds(projectId) : [];\n+\n+  const onDropdownOpen = () => {\n+    if (!moduleIds && projectId && workspaceSlug) fetchModules(workspaceSlug.toString(), projectId);\n+  };\n+\n+  return (\n+    <ModuleDropdownBase\n+      {...props}\n+      getModuleById={getModuleById}\n+      moduleIds={moduleIds ?? []}\n+      onDropdownOpen={onDropdownOpen}\n+    />\n+  );\n+});\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/module/module-options.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/dropdowns/module/module-options.tsx\n===================================================================\n--- apps/web/core/components/dropdowns/module/module-options.tsx\t5660b28 (parent)\n+++ apps/web/core/components/dropdowns/module/module-options.tsx\tf3daac6 (commit)\n@@ -2,23 +2,18 @@\n \n import { useEffect, useRef, useState } from \"react\";\n import { Placement } from \"@popperjs/core\";\n import { observer } from \"mobx-react\";\n-import { useParams } from \"next/navigation\";\n import { usePopper } from \"react-popper\";\n import { Check, Search } from \"lucide-react\";\n import { Combobox } from \"@headlessui/react\";\n-// i18n\n+// plane imports\n import { useTranslation } from \"@plane/i18n\";\n-//components\n+import { IModule } from \"@plane/types\";\n import { DiceIcon } from \"@plane/ui\";\n-//store\n import { cn } from \"@plane/utils\";\n-import { useModule } from \"@/hooks/store\";\n+// hooks\n import { usePlatformOS } from \"@/hooks/use-platform-os\";\n-//hooks\n-//icon\n-//types\n \n type DropdownOptions =\n   | {\n       value: string | null;\n@@ -27,27 +22,27 @@\n     }[]\n   | undefined;\n \n interface Props {\n-  projectId: string;\n-  referenceElement: HTMLButtonElement | null;\n-  placement: Placement | undefined;\n+  getModuleById: (moduleId: string) => IModule | null;\n   isOpen: boolean;\n+  moduleIds?: string[];\n   multiple: boolean;\n+  onDropdownOpen?: () => void;\n+  placement: Placement | undefined;\n+  referenceElement: HTMLButtonElement | null;\n }\n \n export const ModuleOptions = observer((props: Props) => {\n-  const { projectId, isOpen, referenceElement, placement, multiple } = props;\n-  // i18n\n-  const { t } = useTranslation();\n+  const { getModuleById, isOpen, moduleIds, multiple, onDropdownOpen, placement, referenceElement } = props;\n+  // refs\n+  const inputRef = useRef<HTMLInputElement | null>(null);\n   // states\n   const [query, setQuery] = useState(\"\");\n   const [popperElement, setPopperElement] = useState<HTMLDivElement | null>(null);\n-  // refs\n-  const inputRef = useRef<HTMLInputElement | null>(null);\n+  // plane hooks\n+  const { t } = useTranslation();\n   // store hooks\n-  const { workspaceSlug } = useParams();\n-  const { getProjectModuleIds, fetchModules, getModuleById } = useModule();\n   const { isMobile } = usePlatformOS();\n \n   useEffect(() => {\n     if (isOpen) {\n@@ -71,12 +66,10 @@\n       },\n     ],\n   });\n \n-  const moduleIds = getProjectModuleIds(projectId);\n-\n   const onOpen = () => {\n-    if (workspaceSlug && !moduleIds) fetchModules(workspaceSlug.toString(), projectId);\n+    onDropdownOpen?.();\n   };\n \n   const searchInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n     if (query !== \"\" && e.key === \"Escape\") {\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/project/base.tsx",
          "status": "renamed",
          "oldPath": "apps/web/core/components/dropdowns/project.tsx",
          "diff": "===================================================================\n--- apps/web/core/components/dropdowns/project.tsx\t5660b28 (parent)\n+++ apps/web/core/components/dropdowns/project/base.tsx\tf3daac6 (commit)\n@@ -2,35 +2,33 @@\n import { observer } from \"mobx-react\";\n import { usePopper } from \"react-popper\";\n import { Briefcase, Check, ChevronDown, Search } from \"lucide-react\";\n import { Combobox } from \"@headlessui/react\";\n-// ui\n+// plane imports\n import { useTranslation } from \"@plane/i18n\";\n import { ComboDropDown } from \"@plane/ui\";\n-// components\n import { cn } from \"@plane/utils\";\n+// components\n import { Logo } from \"@/components/common\";\n-// helpers\n // hooks\n-import { useProject } from \"@/hooks/store\";\n import { useDropdown } from \"@/hooks/use-dropdown\";\n-// plane web types\n+// plane web imports\n import { TProject } from \"@/plane-web/types\";\n-// components\n-import { DropdownButton } from \"./buttons\";\n-// constants\n-import { BUTTON_VARIANTS_WITH_TEXT } from \"./constants\";\n-// types\n-import { TDropdownProps } from \"./types\";\n+// local imports\n+import { DropdownButton } from \"../buttons\";\n+import { BUTTON_VARIANTS_WITH_TEXT } from \"../constants\";\n+import { TDropdownProps } from \"../types\";\n \n type Props = TDropdownProps & {\n   button?: ReactNode;\n+  currentProjectId?: string;\n   dropdownArrow?: boolean;\n   dropdownArrowClassName?: string;\n+  getProjectById: (projectId: string | null | undefined) => Partial<TProject> | undefined;\n   onClose?: () => void;\n-  renderCondition?: (project: TProject) => boolean;\n+  projectIds: string[];\n   renderByDefault?: boolean;\n-  currentProjectId?: string;\n+  renderCondition?: (projectId: string) => boolean;\n } & (\n     | {\n         multiple: false;\n         onChange: (val: string) => void;\n@@ -42,40 +40,44 @@\n         value: string[];\n       }\n   );\n \n-export const ProjectDropdown: React.FC<Props> = observer((props) => {\n+export const ProjectDropdownBase: React.FC<Props> = observer((props) => {\n   const {\n     button,\n     buttonClassName,\n     buttonContainerClassName,\n     buttonVariant,\n     className = \"\",\n+    currentProjectId,\n     disabled = false,\n     dropdownArrow = false,\n     dropdownArrowClassName = \"\",\n+    getProjectById,\n     hideIcon = false,\n     multiple,\n     onChange,\n     onClose,\n     placeholder = \"Project\",\n     placement,\n+    projectIds,\n+    renderByDefault = true,\n     renderCondition,\n     showTooltip = false,\n     tabIndex,\n     value,\n-    renderByDefault = true,\n-    currentProjectId,\n   } = props;\n-  // states\n-  const [query, setQuery] = useState(\"\");\n-  const [isOpen, setIsOpen] = useState(false);\n   // refs\n   const dropdownRef = useRef<HTMLDivElement | null>(null);\n   const inputRef = useRef<HTMLInputElement | null>(null);\n   // popper-js refs\n   const [referenceElement, setReferenceElement] = useState<HTMLButtonElement | null>(null);\n   const [popperElement, setPopperElement] = useState<HTMLDivElement | null>(null);\n+  // states\n+  const [query, setQuery] = useState(\"\");\n+  const [isOpen, setIsOpen] = useState(false);\n+  // plane hooks\n+  const { t } = useTranslation();\n   // popper-js init\n   const { styles, attributes } = usePopper(referenceElement, popperElement, {\n     placement: placement ?? \"bottom-start\",\n     modifiers: [\n@@ -87,19 +89,17 @@\n       },\n     ],\n   });\n   // store hooks\n-  const { joinedProjectIds, getProjectById } = useProject();\n-  const { t } = useTranslation();\n-  const options = joinedProjectIds?.map((projectId) => {\n+  const options = projectIds?.map((projectId) => {\n     const projectDetails = getProjectById(projectId);\n-    if (renderCondition && projectDetails && !renderCondition(projectDetails)) return;\n+    if (renderCondition && !renderCondition(projectId)) return;\n     return {\n       value: projectId,\n       query: `${projectDetails?.name}`,\n       content: (\n         <div className=\"flex items-center gap-2\">\n-          {projectDetails && (\n+          {projectDetails?.logo_props && (\n             <span className=\"grid place-items-center flex-shrink-0 h-4 w-4\">\n               <Logo logo={projectDetails?.logo_props} size={12} />\n             </span>\n           )}\n@@ -138,11 +138,11 @@\n     }\n   };\n \n   const getProjectIcon = (value: string | string[] | null) => {\n-    const renderIcon = (projectDetails: TProject) => (\n+    const renderIcon = (logoProps: TProject[\"logo_props\"]) => (\n       <span className=\"grid place-items-center flex-shrink-0 h-4 w-4\">\n-        <Logo logo={projectDetails.logo_props} size={14} />\n+        <Logo logo={logoProps} size={14} />\n       </span>\n     );\n \n     if (Array.isArray(value)) {\n@@ -150,18 +150,18 @@\n         <div className=\"flex items-center gap-0.5\">\n           {value.length > 0 ? (\n             value.map((projectId) => {\n               const projectDetails = getProjectById(projectId);\n-              return projectDetails ? renderIcon(projectDetails) : null;\n+              return projectDetails?.logo_props ? renderIcon(projectDetails.logo_props) : null;\n             })\n           ) : (\n             <Briefcase className=\"size-3 text-custom-text-300\" />\n           )}\n         </div>\n       );\n     } else {\n       const projectDetails = getProjectById(value);\n-      return projectDetails ? renderIcon(projectDetails) : null;\n+      return projectDetails?.logo_props ? renderIcon(projectDetails.logo_props) : null;\n     }\n   };\n \n   const comboButton = (\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/project/dropdown.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/dropdowns/project/dropdown.tsx\n===================================================================\n--- apps/web/core/components/dropdowns/project/dropdown.tsx\t5660b28 (parent)\n+++ apps/web/core/components/dropdowns/project/dropdown.tsx\tf3daac6 (commit)\n@@ -0,0 +1,35 @@\n+import { ReactNode } from \"react\";\n+import { observer } from \"mobx-react\";\n+// hooks\n+import { useProject } from \"@/hooks/store\";\n+// local imports\n+import { TDropdownProps } from \"../types\";\n+import { ProjectDropdownBase } from \"./base\";\n+\n+type Props = TDropdownProps & {\n+  button?: ReactNode;\n+  dropdownArrow?: boolean;\n+  dropdownArrowClassName?: string;\n+  onClose?: () => void;\n+  renderCondition?: (projectId: string) => boolean;\n+  renderByDefault?: boolean;\n+  currentProjectId?: string;\n+} & (\n+    | {\n+        multiple: false;\n+        onChange: (val: string) => void;\n+        value: string | null;\n+      }\n+    | {\n+        multiple: true;\n+        onChange: (val: string[]) => void;\n+        value: string[];\n+      }\n+  );\n+\n+export const ProjectDropdown: React.FC<Props> = observer((props) => {\n+  // store hooks\n+  const { joinedProjectIds, getProjectById } = useProject();\n+\n+  return <ProjectDropdownBase {...props} getProjectById={getProjectById} projectIds={joinedProjectIds} />;\n+});\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/state/base.tsx",
          "status": "renamed",
          "oldPath": "apps/web/core/components/dropdowns/state.tsx",
          "diff": "===================================================================\n--- apps/web/core/components/dropdowns/state.tsx\t5660b28 (parent)\n+++ apps/web/core/components/dropdowns/state/base.tsx\tf3daac6 (commit)\n@@ -1,47 +1,46 @@\n \"use client\";\n \n import { ReactNode, useRef, useState } from \"react\";\n import { observer } from \"mobx-react\";\n-import { useParams } from \"next/navigation\";\n import { usePopper } from \"react-popper\";\n import { ChevronDown, Search } from \"lucide-react\";\n import { Combobox } from \"@headlessui/react\";\n+// plane imports\n import { useTranslation } from \"@plane/i18n\";\n-// ui\n+import { IState } from \"@plane/types\";\n import { ComboDropDown, Spinner, StateGroupIcon } from \"@plane/ui\";\n-// helpers\n import { cn } from \"@plane/utils\";\n+// components\n+import { DropdownButton } from \"@/components/dropdowns/buttons\";\n+import { BUTTON_VARIANTS_WITH_TEXT } from \"@/components/dropdowns/constants\";\n+import { TDropdownProps } from \"@/components/dropdowns/types\";\n // hooks\n-import { useProjectState } from \"@/hooks/store\";\n import { useDropdown } from \"@/hooks/use-dropdown\";\n-// Plane-web\n+// plane web imports\n import { StateOption } from \"@/plane-web/components/workflow\";\n-// components\n-import { DropdownButton } from \"./buttons\";\n-// constants\n-import { BUTTON_VARIANTS_WITH_TEXT } from \"./constants\";\n-// types\n-import { TDropdownProps } from \"./types\";\n \n-type Props = TDropdownProps & {\n+export type TWorkItemStateDropdownBaseProps = TDropdownProps & {\n+  alwaysAllowStateChange?: boolean;\n   button?: ReactNode;\n   dropdownArrow?: boolean;\n   dropdownArrowClassName?: string;\n+  filterAvailableStateIds?: boolean;\n+  getStateById: (stateId: string | null | undefined) => IState | undefined;\n+  iconSize?: string;\n+  isForWorkItemCreation?: boolean;\n+  isInitializing?: boolean;\n   onChange: (val: string) => void;\n   onClose?: () => void;\n+  onDropdownOpen?: () => void;\n   projectId: string | undefined;\n+  renderByDefault?: boolean;\n   showDefaultState?: boolean;\n+  stateIds: string[];\n   value: string | undefined | null;\n-  renderByDefault?: boolean;\n-  stateIds?: string[];\n-  filterAvailableStateIds?: boolean;\n-  isForWorkItemCreation?: boolean;\n-  alwaysAllowStateChange?: boolean;\n-  iconSize?: string;\n };\n \n-export const StateDropdown: React.FC<Props> = observer((props) => {\n+export const WorkItemStateDropdownBase: React.FC<TWorkItemStateDropdownBaseProps> = observer((props) => {\n   const {\n     button,\n     buttonClassName,\n     buttonContainerClassName,\n@@ -49,31 +48,37 @@\n     className = \"\",\n     disabled = false,\n     dropdownArrow = false,\n     dropdownArrowClassName = \"\",\n+    getStateById,\n     hideIcon = false,\n+    iconSize = \"size-4\",\n+    isInitializing = false,\n     onChange,\n     onClose,\n+    onDropdownOpen,\n     placement,\n-    projectId,\n+    renderByDefault = true,\n     showDefaultState = true,\n     showTooltip = false,\n+    stateIds,\n     tabIndex,\n     value,\n-    renderByDefault = true,\n-    stateIds,\n-    iconSize = \"size-4\",\n   } = props;\n-  // states\n-  const [query, setQuery] = useState(\"\");\n-  const [isOpen, setIsOpen] = useState(false);\n-  const [stateLoader, setStateLoader] = useState(false);\n   // refs\n   const dropdownRef = useRef<HTMLDivElement | null>(null);\n   const inputRef = useRef<HTMLInputElement | null>(null);\n   // popper-js refs\n   const [referenceElement, setReferenceElement] = useState<HTMLButtonElement | null>(null);\n   const [popperElement, setPopperElement] = useState<HTMLDivElement | null>(null);\n+  // states\n+  const [query, setQuery] = useState(\"\");\n+  const [isOpen, setIsOpen] = useState(false);\n+  // store hooks\n+  const { t } = useTranslation();\n+  const statesList = stateIds.map((stateId) => getStateById(stateId)).filter((state) => !!state);\n+  const defaultState = statesList?.find((state) => state?.default);\n+  const stateValue = !!value ? value : showDefaultState ? defaultState?.id : undefined;\n   // popper-js init\n   const { styles, attributes } = usePopper(referenceElement, popperElement, {\n     placement: placement ?? \"bottom-start\",\n     modifiers: [\n@@ -84,18 +89,21 @@\n         },\n       },\n     ],\n   });\n-  // store hooks\n-  const { t } = useTranslation();\n-  const { workspaceSlug } = useParams();\n-  const { fetchProjectStates, getProjectStates, getStateById } = useProjectState();\n-  const statesList = stateIds\n-    ? stateIds.map((stateId) => getStateById(stateId)).filter((state) => !!state)\n-    : getProjectStates(projectId);\n-  const defaultState = statesList?.find((state) => state?.default);\n-  const stateValue = !!value ? value : showDefaultState ? defaultState?.id : undefined;\n+  // dropdown init\n+  const { handleClose, handleKeyDown, handleOnClick, searchInputKeyDown } = useDropdown({\n+    dropdownRef,\n+    inputRef,\n+    isOpen,\n+    onClose,\n+    onOpen: onDropdownOpen,\n+    query,\n+    setIsOpen,\n+    setQuery,\n+  });\n \n+  // derived values\n   const options = statesList?.map((state) => ({\n     value: state?.id,\n     query: `${state?.name}`,\n     content: (\n@@ -115,27 +123,8 @@\n     query === \"\" ? options : options?.filter((o) => o.query.toLowerCase().includes(query.toLowerCase()));\n \n   const selectedState = stateValue ? getStateById(stateValue) : undefined;\n \n-  const onOpen = async () => {\n-    if (!statesList && workspaceSlug && projectId) {\n-      setStateLoader(true);\n-      await fetchProjectStates(workspaceSlug.toString(), projectId);\n-      setStateLoader(false);\n-    }\n-  };\n-\n-  const { handleClose, handleKeyDown, handleOnClick, searchInputKeyDown } = useDropdown({\n-    dropdownRef,\n-    inputRef,\n-    isOpen,\n-    onClose,\n-    onOpen,\n-    query,\n-    setIsOpen,\n-    setQuery,\n-  });\n-\n   const dropdownOnChange = (val: string) => {\n     onChange(val);\n     handleClose();\n   };\n@@ -177,9 +166,9 @@\n             showTooltip={showTooltip}\n             variant={buttonVariant}\n             renderToolTipByDefault={renderByDefault}\n           >\n-            {stateLoader ? (\n+            {isInitializing ? (\n               <Spinner className=\"h-3.5 w-3.5\" />\n             ) : (\n               <>\n                 {!hideIcon && (\n"
        },
        {
          "path": "apps/web/core/components/dropdowns/state/dropdown.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/dropdowns/state/dropdown.tsx\n===================================================================\n--- apps/web/core/components/dropdowns/state/dropdown.tsx\t5660b28 (parent)\n+++ apps/web/core/components/dropdowns/state/dropdown.tsx\tf3daac6 (commit)\n@@ -0,0 +1,47 @@\n+\"use client\";\n+\n+import { useState } from \"react\";\n+import { observer } from \"mobx-react\";\n+import { useParams } from \"next/navigation\";\n+// hooks\n+import { useProjectState } from \"@/hooks/store\";\n+// local imports\n+import { WorkItemStateDropdownBase, TWorkItemStateDropdownBaseProps } from \"./base\";\n+\n+type TWorkItemStateDropdownProps = Omit<\n+  TWorkItemStateDropdownBaseProps,\n+  \"stateIds\" | \"getStateById\" | \"onDropdownOpen\" | \"isInitializing\"\n+> & {\n+  stateIds?: string[];\n+};\n+\n+export const StateDropdown: React.FC<TWorkItemStateDropdownProps> = observer((props) => {\n+  const { projectId, stateIds: propsStateIds } = props;\n+  // router params\n+  const { workspaceSlug } = useParams();\n+  // states\n+  const [stateLoader, setStateLoader] = useState(false);\n+  // store hooks\n+  const { fetchProjectStates, getProjectStateIds, getStateById } = useProjectState();\n+  // derived values\n+  const stateIds = propsStateIds ?? getProjectStateIds(projectId);\n+\n+  // fetch states if not provided\n+  const onDropdownOpen = async () => {\n+    if (stateIds === undefined && workspaceSlug && projectId) {\n+      setStateLoader(true);\n+      await fetchProjectStates(workspaceSlug.toString(), projectId);\n+      setStateLoader(false);\n+    }\n+  };\n+\n+  return (\n+    <WorkItemStateDropdownBase\n+      {...props}\n+      getStateById={getStateById}\n+      isInitializing={stateLoader}\n+      stateIds={stateIds ?? []}\n+      onDropdownOpen={onDropdownOpen}\n+    />\n+  );\n+});\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-modal/base.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-modal/base.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-modal/base.tsx\t5660b28 (parent)\n+++ apps/web/core/components/issues/issue-modal/base.tsx\tf3daac6 (commit)\n@@ -67,9 +67,9 @@\n   const { issues } = useIssues(storeType);\n   const { issues: projectIssues } = useIssues(EIssuesStoreType.PROJECT);\n   const { issues: draftIssues } = useIssues(EIssuesStoreType.WORKSPACE_DRAFT);\n   const { fetchIssue } = useIssueDetail();\n-  const { allowedProjectIds, handleCreateUpdatePropertyValues } = useIssueModal();\n+  const { allowedProjectIds, handleCreateUpdatePropertyValues, handleCreateSubWorkItem } = useIssueModal();\n   const { getProjectByIdentifier } = useProject();\n   // current store details\n   const { createIssue, updateIssue } = useIssuesActions(storeType);\n   // derived values\n@@ -221,8 +221,15 @@\n           projectId: response.project_id,\n           workspaceSlug: workspaceSlug?.toString(),\n           isDraft: is_draft_issue,\n         });\n+\n+        // create sub work item\n+        await handleCreateSubWorkItem({\n+          workspaceSlug: workspaceSlug?.toString(),\n+          projectId: response.project_id,\n+          parentId: response.id,\n+        });\n       }\n \n       setToast({\n         type: TOAST_TYPE.SUCCESS,\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-modal/components/project-select.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-modal/components/project-select.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-modal/components/project-select.tsx\t5660b28 (parent)\n+++ apps/web/core/components/issues/issue-modal/components/project-select.tsx\tf3daac6 (commit)\n@@ -45,9 +45,9 @@\n               handleFormChange();\n             }}\n             multiple={false}\n             buttonVariant=\"border-with-text\"\n-            renderCondition={(project) => allowedProjectIds.includes(project.id)}\n+            renderCondition={(projectId) => allowedProjectIds.includes(projectId)}\n             tabIndex={getIndex(\"project_id\")}\n             disabled={disabled}\n           />\n         </div>\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-modal/context/issue-modal-context.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-modal/context/issue-modal-context.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-modal/context/issue-modal-context.tsx\t5660b28 (parent)\n+++ apps/web/core/components/issues/issue-modal/context/issue-modal-context.tsx\tf3daac6 (commit)\n@@ -1,13 +1,13 @@\n import { createContext } from \"react\";\n // ce imports\n // react-hook-form\n+import { TIssueFields } from \"ce/components/issues\";\n import { UseFormReset, UseFormWatch } from \"react-hook-form\";\n // plane imports\n import { EditorRefApi } from \"@plane/editor\";\n import { ISearchIssueResponse, TIssue } from \"@plane/types\";\n import { TIssuePropertyValues, TIssuePropertyValueErrors } from \"@/plane-web/types/issue-types\";\n-import { TIssueFields } from \"ce/components/issues\";\n \n export type TPropertyValuesValidationProps = {\n   projectId: string | null;\n   workspaceSlug: string;\n@@ -27,17 +27,24 @@\n   issueTypeId: string | null | undefined;\n   isDraft?: boolean;\n };\n \n+export type TCreateSubWorkItemProps = {\n+  workspaceSlug: string;\n+  projectId: string;\n+  parentId: string;\n+};\n+\n export type THandleTemplateChangeProps = {\n   workspaceSlug: string;\n   reset: UseFormReset<TIssue>;\n   editorRef: React.MutableRefObject<EditorRefApi | null>;\n };\n \n export type THandleProjectEntitiesFetchProps = {\n+  workItemProjectId: string | null | undefined;\n+  workItemTypeId: string | undefined;\n   workspaceSlug: string;\n-  templateId: string;\n };\n \n export type THandleParentWorkItemDetailsProps = {\n   workspaceSlug: string;\n@@ -64,7 +71,8 @@\n   handleCreateUpdatePropertyValues: (props: TCreateUpdatePropertyValuesProps) => Promise<void>;\n   handleProjectEntitiesFetch: (props: THandleProjectEntitiesFetchProps) => Promise<void>;\n   handleTemplateChange: (props: THandleTemplateChangeProps) => Promise<void>;\n   handleConvert: (workspaceSlug: string, data: Partial<TIssue>) => Promise<void>;\n+  handleCreateSubWorkItem: (props: TCreateSubWorkItemProps) => Promise<void>;\n };\n \n export const IssueModalContext = createContext<TIssueModalContext | undefined>(undefined);\n"
        },
        {
          "path": "apps/web/core/components/issues/issue-modal/form.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/issue-modal/form.tsx\n===================================================================\n--- apps/web/core/components/issues/issue-modal/form.tsx\t5660b28 (parent)\n+++ apps/web/core/components/issues/issue-modal/form.tsx\tf3daac6 (commit)\n@@ -31,18 +31,15 @@\n import { CreateLabelModal } from \"@/components/labels\";\n // helpers\n // hooks\n import { useIssueModal } from \"@/hooks/context/use-issue-modal\";\n-import { useIssueDetail, useProject, useProjectState, useWorkspaceDraftIssues } from \"@/hooks/store\";\n+import { useIssueDetail, useLabel, useProject, useProjectState, useWorkspaceDraftIssues } from \"@/hooks/store\";\n import { usePlatformOS } from \"@/hooks/use-platform-os\";\n import { useProjectIssueProperties } from \"@/hooks/use-project-issue-properties\";\n // plane web imports\n import { DeDupeButtonRoot, DuplicateModalRoot } from \"@/plane-web/components/de-dupe\";\n-import {\n-  IssueAdditionalProperties,\n-  IssueTypeSelect,\n-  WorkItemTemplateSelect,\n-} from \"@/plane-web/components/issues/issue-modal\";\n+import { IssueTypeSelect, WorkItemTemplateSelect } from \"@/plane-web/components/issues/issue-modal\";\n+import { WorkItemModalAdditionalProperties } from \"@/plane-web/components/issues/issue-modal/modal-additional-properties\";\n import { useDebouncedDuplicateIssues } from \"@/plane-web/hooks/use-debounced-duplicate-issues\";\n \n export interface IssueFormProps {\n   data?: Partial<TIssue>;\n@@ -123,8 +120,9 @@\n     handleTemplateChange,\n   } = useIssueModal();\n   const { isMobile } = usePlatformOS();\n   const { moveIssue } = useWorkspaceDraftIssues();\n+  const { createLabel } = useLabel();\n \n   const {\n     issue: { getIssueById },\n   } = useIssueDetail();\n@@ -361,11 +359,11 @@\n   return (\n     <FormProvider {...methods}>\n       {projectId && (\n         <CreateLabelModal\n+          createLabel={createLabel.bind(createLabel, workspaceSlug?.toString(), projectId)}\n           isOpen={labelModal}\n           handleClose={() => setLabelModal(false)}\n-          projectId={projectId}\n           onSuccess={(response) => {\n             setValue<\"label_ids\">(\"label_ids\", [...watch(\"label_ids\"), response.id]);\n             handleFormChange();\n           }}\n@@ -473,27 +471,21 @@\n                   onAssetUpload={onAssetUpload}\n                   onClose={onClose}\n                 />\n               </div>\n-              <div\n-                className={cn(\n-                  \"px-5\",\n-                  activeAdditionalPropertiesLength <= 4 &&\n-                    \"max-h-[25vh] overflow-hidden overflow-y-auto vertical-scrollbar scrollbar-sm\"\n-                )}\n-              >\n-                {projectId && (\n-                  <IssueAdditionalProperties\n-                    issueId={data?.id ?? data?.sourceIssueId}\n-                    issueTypeId={watch(\"type_id\")}\n-                    projectId={projectId}\n-                    workspaceSlug={workspaceSlug?.toString()}\n-                    isDraft={isDraft}\n-                  />\n-                )}\n-              </div>\n+              <WorkItemModalAdditionalProperties\n+                isDraft={isDraft}\n+                workItemId={data?.id ?? data?.sourceIssueId}\n+                projectId={projectId}\n+                workspaceSlug={workspaceSlug?.toString()}\n+              />\n             </div>\n-            <div className=\"px-4 py-3 border-t-[0.5px] border-custom-border-200 shadow-custom-shadow-xs rounded-b-lg bg-custom-background-100\">\n+            <div\n+              className={cn(\n+                \"px-4 py-3 border-t-[0.5px] border-custom-border-200 rounded-b-lg bg-custom-background-100\",\n+                activeAdditionalPropertiesLength > 0 && \"shadow-custom-shadow-xs\"\n+              )}\n+            >\n               <div className=\"pb-3 border-b-[0.5px] border-custom-border-200\">\n                 <IssueDefaultProperties\n                   control={control}\n                   id={data?.id}\n"
        },
        {
          "path": "apps/web/core/components/issues/select/base.tsx",
          "status": "renamed",
          "oldPath": "apps/web/core/components/issues/select/label.tsx",
          "diff": "===================================================================\n--- apps/web/core/components/issues/select/label.tsx\t5660b28 (parent)\n+++ apps/web/core/components/issues/select/base.tsx\tf3daac6 (commit)\n@@ -1,78 +1,77 @@\n-import React, { Fragment, useEffect, useRef, useState } from \"react\";\n+import React, { useEffect, useRef, useState } from \"react\";\n import { Placement } from \"@popperjs/core\";\n import { observer } from \"mobx-react\";\n-import { useParams } from \"next/navigation\";\n import { usePopper } from \"react-popper\";\n import { Check, Component, Plus, Search, Tag } from \"lucide-react\";\n import { Combobox } from \"@headlessui/react\";\n import { useOutsideClickDetector } from \"@plane/hooks\";\n import { useTranslation } from \"@plane/i18n\";\n-// components\n+// plane imports\n+import { IIssueLabel } from \"@plane/types\";\n import { cn } from \"@plane/utils\";\n+// components\n import { IssueLabelsList } from \"@/components/ui\";\n-// helpers\n // hooks\n-import { useLabel } from \"@/hooks/store\";\n import { useDropdownKeyDown } from \"@/hooks/use-dropdown-key-down\";\n import { usePlatformOS } from \"@/hooks/use-platform-os\";\n \n-type Props = {\n-  setIsOpen: React.Dispatch<React.SetStateAction<boolean>>;\n-  value: string[];\n-  onChange: (value: string[]) => void;\n-  projectId: string | undefined;\n-  label?: JSX.Element;\n-  disabled?: boolean;\n-  tabIndex?: number;\n-  createLabelEnabled?: boolean;\n-  buttonContainerClassName?: string;\n+export type TWorkItemLabelSelectBaseProps = {\n   buttonClassName?: string;\n+  buttonContainerClassName?: string;\n+  createLabelEnabled?: boolean;\n+  disabled?: boolean;\n+  getLabelById: (labelId: string) => IIssueLabel | null;\n+  label?: JSX.Element;\n+  labelIds: string[];\n+  onChange: (value: string[]) => void;\n+  onDropdownOpen?: () => void;\n   placement?: Placement;\n+  setIsOpen: React.Dispatch<React.SetStateAction<boolean>>;\n+  tabIndex?: number;\n+  value: string[];\n };\n \n-export const IssueLabelSelect: React.FC<Props> = observer((props) => {\n+export const WorkItemLabelSelectBase: React.FC<TWorkItemLabelSelectBaseProps> = observer((props) => {\n   const {\n-    setIsOpen,\n-    value,\n-    onChange,\n-    projectId,\n-    label,\n-    disabled = false,\n-    tabIndex,\n-    createLabelEnabled = false,\n-    buttonContainerClassName,\n     buttonClassName,\n+    buttonContainerClassName,\n+    createLabelEnabled = false,\n+    disabled = false,\n+    getLabelById,\n+    label,\n+    labelIds,\n+    onChange,\n+    onDropdownOpen,\n     placement,\n+    setIsOpen,\n+    tabIndex,\n+    value,\n   } = props;\n-  const { t } = useTranslation();\n-  // router\n-  const { workspaceSlug } = useParams();\n-  // store hooks\n-  const { getProjectLabels, fetchProjectLabels } = useLabel();\n-  const { isMobile } = usePlatformOS();\n+  // refs\n+  const dropdownRef = useRef<HTMLDivElement | null>(null);\n+  const inputRef = useRef<HTMLInputElement | null>(null);\n   // states\n   const [query, setQuery] = useState(\"\");\n   const [referenceElement, setReferenceElement] = useState<HTMLButtonElement | null>(null);\n   const [popperElement, setPopperElement] = useState<HTMLDivElement | null>(null);\n   const [isDropdownOpen, setIsDropdownOpen] = useState(false);\n-  // refs\n-  const dropdownRef = useRef<HTMLDivElement | null>(null);\n-  const inputRef = useRef<HTMLInputElement | null>(null);\n-  // popper\n+  // plane hooks\n+  const { t } = useTranslation();\n+  // store hooks\n+  const { isMobile } = usePlatformOS();\n+  // popper-js init\n   const { styles, attributes } = usePopper(referenceElement, popperElement, {\n     placement: placement ?? \"bottom-start\",\n   });\n-\n-  const projectLabels = getProjectLabels(projectId);\n-\n   // derived values\n+  const labelsList = labelIds.map((labelId) => getLabelById(labelId)).filter((label) => !!label);\n   const filteredOptions =\n-    query === \"\" ? projectLabels : projectLabels?.filter((l) => l.name.toLowerCase().includes(query.toLowerCase()));\n+    query === \"\" ? labelsList : labelsList?.filter((l) => l.name.toLowerCase().includes(query.toLowerCase()));\n \n   const onOpen = () => {\n-    if (!projectLabels && workspaceSlug && projectId) fetchProjectLabels(workspaceSlug.toString(), projectId);\n     if (referenceElement) referenceElement.focus();\n+    onDropdownOpen?.();\n   };\n \n   const handleClose = () => {\n     if (isDropdownOpen) setIsDropdownOpen(false);\n@@ -130,9 +129,9 @@\n           label\n         ) : value && value.length > 0 ? (\n           <span className={cn(\"flex items-center justify-center gap-2 text-xs h-full\", buttonClassName)}>\n             <IssueLabelsList\n-              labels={value.map((v) => projectLabels?.find((l) => l.id === v)) ?? []}\n+              labels={value.map((v) => labelsList?.find((l) => l.id === v)) ?? []}\n               length={3}\n               showLength\n             />\n           </span>\n@@ -168,12 +167,12 @@\n                 displayValue={(assigned: any) => assigned?.name}\n               />\n             </div>\n             <div className=\"mt-2 max-h-48 space-y-1 overflow-y-scroll\">\n-              {projectLabels && filteredOptions ? (\n+              {labelsList && filteredOptions ? (\n                 filteredOptions.length > 0 ? (\n                   filteredOptions.map((label) => {\n-                    const children = projectLabels?.filter((l) => l.parent === label.id);\n+                    const children = labelsList?.filter((l) => l.parent === label.id);\n \n                     if (children.length === 0) {\n                       if (!label.parent)\n                         return (\n"
        },
        {
          "path": "apps/web/core/components/issues/select/dropdown.tsx",
          "status": "added",
          "diff": "Index: apps/web/core/components/issues/select/dropdown.tsx\n===================================================================\n--- apps/web/core/components/issues/select/dropdown.tsx\t5660b28 (parent)\n+++ apps/web/core/components/issues/select/dropdown.tsx\tf3daac6 (commit)\n@@ -0,0 +1,35 @@\n+import React from \"react\";\n+import { observer } from \"mobx-react\";\n+import { useParams } from \"next/navigation\";\n+// hooks\n+import { useLabel } from \"@/hooks/store\";\n+// local imports\n+import { TWorkItemLabelSelectBaseProps, WorkItemLabelSelectBase } from \"./base\";\n+\n+type TWorkItemLabelSelectProps = Omit<TWorkItemLabelSelectBaseProps, \"labelIds\" | \"getLabelById\" | \"onDropdownOpen\"> & {\n+  projectId: string | undefined;\n+};\n+\n+export const IssueLabelSelect: React.FC<TWorkItemLabelSelectProps> = observer((props) => {\n+  const { projectId } = props;\n+  // router\n+  const { workspaceSlug } = useParams();\n+  // store hooks\n+  const { getProjectLabelIds, getLabelById, fetchProjectLabels } = useLabel();\n+  // derived values\n+  const projectLabelIds = getProjectLabelIds(projectId);\n+\n+  const onDropdownOpen = () => {\n+    if (projectLabelIds === undefined && workspaceSlug && projectId)\n+      fetchProjectLabels(workspaceSlug.toString(), projectId);\n+  };\n+\n+  return (\n+    <WorkItemLabelSelectBase\n+      {...props}\n+      getLabelById={getLabelById}\n+      labelIds={projectLabelIds ?? []}\n+      onDropdownOpen={onDropdownOpen}\n+    />\n+  );\n+});\n"
        },
        {
          "path": "apps/web/core/components/issues/select/index.ts",
          "status": "modified",
          "diff": "Index: apps/web/core/components/issues/select/index.ts\n===================================================================\n--- apps/web/core/components/issues/select/index.ts\t5660b28 (parent)\n+++ apps/web/core/components/issues/select/index.ts\tf3daac6 (commit)\n@@ -1,1 +1,1 @@\n-export * from \"./label\";\n+export * from \"./dropdown\";\n"
        },
        {
          "path": "apps/web/core/components/labels/create-label-modal.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/labels/create-label-modal.tsx\n===================================================================\n--- apps/web/core/components/labels/create-label-modal.tsx\t5660b28 (parent)\n+++ apps/web/core/components/labels/create-label-modal.tsx\tf3daac6 (commit)\n@@ -1,9 +1,8 @@\n \"use client\";\n \n import React, { useEffect } from \"react\";\n import { observer } from \"mobx-react\";\n-import { useParams } from \"next/navigation\";\n import { TwitterPicker } from \"react-color\";\n import { Controller, useForm } from \"react-hook-form\";\n import { ChevronDown } from \"lucide-react\";\n import { Dialog, Popover, Transition } from \"@headlessui/react\";\n@@ -15,16 +14,16 @@\n import { Button, Input, TOAST_TYPE, setToast } from \"@plane/ui\";\n // helpers\n import { getTabIndex } from \"@plane/utils\";\n // hooks\n-import { useLabel } from \"@/hooks/store\";\n+\n import { usePlatformOS } from \"@/hooks/use-platform-os\";\n \n // types\n type Props = {\n-  isOpen: boolean;\n-  projectId: string;\n+  createLabel: (data: Partial<IIssueLabel>) => Promise<IIssueLabel>;\n   handleClose: () => void;\n+  isOpen: boolean;\n   onSuccess?: (response: IIssueLabel) => void;\n };\n \n const defaultValues: Partial<IState> = {\n@@ -32,13 +31,10 @@\n   color: \"rgb(var(--color-text-200))\",\n };\n \n export const CreateLabelModal: React.FC<Props> = observer((props) => {\n-  const { isOpen, projectId, handleClose, onSuccess } = props;\n-  // router\n-  const { workspaceSlug } = useParams();\n+  const { createLabel, handleClose, isOpen, onSuccess } = props;\n   // store hooks\n-  const { createLabel } = useLabel();\n   const { isMobile } = usePlatformOS();\n   // form info\n   const {\n     formState: { errors, isSubmitting },\n@@ -70,11 +66,9 @@\n     reset(defaultValues);\n   };\n \n   const onSubmit = async (formData: IIssueLabel) => {\n-    if (!workspaceSlug) return;\n-\n-    await createLabel(workspaceSlug.toString(), projectId.toString(), formData)\n+    await createLabel(formData)\n       .then((res) => {\n         onClose();\n         if (onSuccess) onSuccess(res);\n       })\n"
        },
        {
          "path": "apps/web/core/components/modules/form.tsx",
          "status": "modified",
          "diff": "Index: apps/web/core/components/modules/form.tsx\n===================================================================\n--- apps/web/core/components/modules/form.tsx\t5660b28 (parent)\n+++ apps/web/core/components/modules/form.tsx\tf3daac6 (commit)\n@@ -92,9 +92,9 @@\n                       }\n                     }}\n                     multiple={false}\n                     buttonVariant=\"border-with-text\"\n-                    renderCondition={(project) => !!projectsWithCreatePermissions?.[project.id]}\n+                    renderCondition={(projectId) => !!projectsWithCreatePermissions?.[projectId]}\n                     tabIndex={getIndex(\"cover_image\")}\n                   />\n                 </div>\n               )}\n"
        },
        {
          "path": "apps/web/helpers/react-hook-form.helper.ts",
          "status": "added",
          "diff": "Index: apps/web/helpers/react-hook-form.helper.ts\n===================================================================\n--- apps/web/helpers/react-hook-form.helper.ts\t5660b28 (parent)\n+++ apps/web/helpers/react-hook-form.helper.ts\tf3daac6 (commit)\n@@ -0,0 +1,27 @@\n+import { FieldError, FieldValues } from \"react-hook-form\";\n+\n+/**\n+ * Get a nested error from a form's errors object\n+ * @param errors - The form's errors object\n+ * @param path - The path to the error\n+ * @returns The error or undefined if not found\n+ */\n+export const getNestedError = <T extends FieldValues>(errors: T, path: string): FieldError | undefined => {\n+  const keys = path.split(\".\");\n+  let current: unknown = errors;\n+\n+  for (const key of keys) {\n+    if (current && typeof current === \"object\" && key in current) {\n+      current = (current as Record<string, unknown>)[key];\n+    } else {\n+      return undefined;\n+    }\n+  }\n+\n+  // Check if the final value is a FieldError\n+  if (current && typeof current === \"object\" && \"message\" in current) {\n+    return current as FieldError;\n+  }\n+\n+  return undefined;\n+};\n"
        },
        {
          "path": "packages/utils/src/string.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/string.ts\n===================================================================\n--- packages/utils/src/string.ts\t5660b28 (parent)\n+++ packages/utils/src/string.ts\tf3daac6 (commit)\n@@ -336,23 +336,19 @@\n   const validSegments = segments.filter((segment) => segment !== \"\");\n   if (validSegments.length === 0) return \"\";\n \n   // Process segments to normalize slashes\n-  const processedSegments = validSegments.map((segment, index) => {\n+  const processedSegments = validSegments.map((segment) => {\n     let processed = segment;\n \n     // Remove leading slashes from all segments except the first\n-    if (index > 0) {\n-      while (processed.startsWith(\"/\")) {\n-        processed = processed.substring(1);\n-      }\n+    while (processed.startsWith(\"/\")) {\n+      processed = processed.substring(1);\n     }\n \n     // Remove trailing slashes from all segments except the last\n-    if (index < validSegments.length - 1) {\n-      while (processed.endsWith(\"/\")) {\n-        processed = processed.substring(0, processed.length - 1);\n-      }\n+    while (processed.endsWith(\"/\")) {\n+      processed = processed.substring(0, processed.length - 1);\n     }\n \n     return processed;\n   });\n"
        }
      ]
    },
    {
      "id": "fix-emoji-fallback",
      "sha": "ab79a5da10f2d116e393b32ec9efb2bac02fda5a",
      "parentSha": "a2a62e2731728f2954259d002a090d310f17a6a2",
      "spec": "Implement a local Emoji extension and integrate it across the editor and read-only editor with controlled fallback behavior.\n\n1) Add a local Emoji Node extension\n- File: packages/editor/src/core/extensions/emoji/emoji.ts (new)\n- Create a TipTap Node extension named \"emoji\" with the following observable behavior:\n  - Node characteristics: inline, group inline, not selectable; single attribute \"name\" persisted via data-name and data-type attributes on a span.\n  - Rendering: produce a span[data-type=\"emoji\"][data-name=\"...\"] and render the unicode emoji if available; otherwise render \":shortcode:\" as text. Do not render fallback images in HTML output (explicitly avoid using fallback image rendering here).\n  - Text rendering: render unicode emoji if available; otherwise \":shortcode:\".\n  - Storage: expose storage with two keys:\n    - emojis: EmojiItem[] populated from extension options\n    - isSupported: function that determines whether a given emoji is natively supported on the current platform using is-emoji-supported against a representative emoji for each unicode version (precompute a support map by emoji version).\n  - Options defaults: use the emoji list from @tiptap/extension-emoji (emojis), set enableEmoticons=false, forceFallbackImages=false, and provide a suggestion config (char \":\") using a PluginKey(\"emojiSuggestion\"). Command should insert the emoji node and a trailing space, preserving marks.\n  - Commands: add setEmoji(shortcode) to insert an emoji node by shortcode and preserve marks.\n  - Input rules: convert :shortcode: typed at the end of a word into an emoji node; optionally convert emoticons into emoji nodes when enableEmoticons is true.\n  - Paste rules: convert :shortcode: on paste into emoji nodes without changing selection.\n  - ProseMirror plugins:\n    - Integrate the Suggestion plugin with the provided suggestion options.\n    - Add a plugin to simulate double-click selection for emoji nodes.\n    - Append transaction logic: on every doc change, find unicode emojis in changed text ranges (skip within code blocks) using emoji-regex, convert them to emoji nodes by mapping unicode to a shortcode, and preserve marks.\n\n2) Update the Emoji extension wiring and markdown serialization\n- File: packages/editor/src/core/extensions/emoji/extension.ts\n- Import { Emoji } from \"./emoji\" and only import gitHubEmojis, shortcodeToEmoji from @tiptap/extension-emoji.\n- Extend the local Emoji to override storage to include a markdown serializer that:\n  - Writes the unicode emoji if available.\n  - Else, if a fallbackImage exists, write a markdown image on its own line with alt text \"{name}-{firstShortcode}\" and the fallback image URL.\n  - Else, write the shortcode form :name:.\n- Configure the extension with emojis: gitHubEmojis, suggestion: local suggestion import, enableEmoticons: true.\n\n3) Filter emoji suggestions to avoid fallback images\n- File: packages/editor/src/core/extensions/emoji/suggestion.ts\n- In items(), retrieve emojis and isSupported from getExtensionStorage(editor, CORE_EXTENSIONS.EMOJI) and derive a filteredEmojis list that excludes any emoji that would render via a fallback image (no unicode support or no unicode value but has fallbackImage). Use this filteredEmojis list for both:\n  - default suggestions when query is empty (map DEFAULT_EMOJIS to existing items, limit to 5)\n  - search results when query is non-empty (filter by shortcode or tag startsWith query, limit to 5)\n- Keep the dropbar tracking and ReactRenderer logic unchanged.\n\n4) Include Emoji extension in the read-only editor\n- File: packages/editor/src/core/extensions/read-only-extensions.ts\n- Import { EmojiExtension } from \"./emoji/extension\".\n- Add EmojiExtension to the extensions array (in the same section as core extensions right after StarterKit.configure), so that read-only mode correctly parses and renders emoji nodes.\n\n5) Update storage type mapping to the local Emoji storage\n- File: packages/editor/src/ce/types/storage.ts\n- Update the EmojiStorage type import to the local type exported from packages/editor/src/core/extensions/emoji/emoji.ts so that editor.storage[CORE_EXTENSIONS.EMOJI] reflects the new storage shape (emojis and isSupported), avoiding type mismatches where getExtensionStorage is used.\n\nNotes:\n- Use CORE_EXTENSIONS and getExtensionStorage to access the emoji storage consistently.\n- Ensure the suggestion char remains ':' and that insertion preserves marks and inserts a trailing space.\n- Avoid rendering fallback images in the node’s HTML output; the markdown serializer remains responsible for emitting fallback images when unicode is unavailable.",
      "prompt": "Add a local emoji extension to the editor that prefers unicode rendering and avoids showing fallback-image emojis in the suggestion list. The extension should expose storage that includes the emoji list and a function to detect platform support, convert :shortcode: and emoticons via input/paste rules, and replace unicode emoji characters with emoji nodes on document changes (except inside code blocks). Update serialization to output unicode if available, otherwise a markdown image using the emoji’s fallback asset, and fall back to :shortcode: if neither applies. Integrate this emoji extension into both the full editor and the read-only editor, and update the emoji suggestion logic to only display emojis that won’t render as fallback images, keeping the rest of the suggestion behavior the same.",
      "supplementalFiles": [
        "packages/editor/src/core/extensions/extensions.ts",
        "packages/editor/src/core/constants/extension.ts",
        "packages/editor/src/core/helpers/get-extension-storage.ts",
        "packages/editor/src/core/extensions/emoji/components/emojis-list.tsx",
        "packages/editor/src/core/hooks/use-editor.ts",
        "packages/editor/src/core/hooks/use-read-only-editor.ts"
      ],
      "fileDiffs": [
        {
          "path": "packages/editor/src/core/extensions/emoji/emoji.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/emoji/emoji.ts\n===================================================================\n--- packages/editor/src/core/extensions/emoji/emoji.ts\ta2a62e2 (parent)\n+++ packages/editor/src/core/extensions/emoji/emoji.ts\tab79a5d (commit)\n@@ -0,0 +1,444 @@\n+import {\n+  combineTransactionSteps,\n+  escapeForRegEx,\n+  findChildrenInRange,\n+  getChangedRanges,\n+  InputRule,\n+  mergeAttributes,\n+  Node,\n+  nodeInputRule,\n+  PasteRule,\n+  removeDuplicates,\n+} from \"@tiptap/core\";\n+import { emojis, emojiToShortcode, shortcodeToEmoji } from \"@tiptap/extension-emoji\";\n+import { Plugin, PluginKey, Transaction } from \"@tiptap/pm/state\";\n+import Suggestion, { SuggestionOptions } from \"@tiptap/suggestion\";\n+import emojiRegex from \"emoji-regex\";\n+import { isEmojiSupported } from \"is-emoji-supported\";\n+\n+declare module \"@tiptap/core\" {\n+  interface Commands<ReturnType> {\n+    emoji: {\n+      /**\n+       * Add an emoji\n+       */\n+      setEmoji: (shortcode: string) => ReturnType;\n+    };\n+  }\n+}\n+\n+export type EmojiItem = {\n+  /**\n+   * A unique name of the emoji which will be stored as attribute\n+   */\n+  name: string;\n+  /**\n+   * The emoji unicode character\n+   */\n+  emoji?: string;\n+  /**\n+   * A list of unique shortcodes that are used by input rules to find the emoji\n+   */\n+  shortcodes: string[];\n+  /**\n+   * A list of tags that can help for searching emojis\n+   */\n+  tags: string[];\n+  /**\n+   * A name that can help to group emojis\n+   */\n+  group?: string;\n+  /**\n+   * A list of unique emoticons\n+   */\n+  emoticons?: string[];\n+  /**\n+   * The unicode version the emoji was introduced\n+   */\n+  version?: number;\n+  /**\n+   * A fallback image if the current system doesn't support the emoji or for custom emojis\n+   */\n+  fallbackImage?: string;\n+  /**\n+   * Store some custom data\n+   */\n+  [key: string]: any;\n+};\n+\n+export type EmojiOptions = {\n+  HTMLAttributes: Record<string, any>;\n+  emojis: EmojiItem[];\n+  enableEmoticons: boolean;\n+  forceFallbackImages: boolean;\n+  suggestion: Omit<SuggestionOptions, \"editor\">;\n+};\n+\n+export type EmojiStorage = {\n+  emojis: EmojiItem[];\n+  isSupported: (item: EmojiItem) => boolean;\n+};\n+\n+export const EmojiSuggestionPluginKey = new PluginKey(\"emojiSuggestion\");\n+\n+export const inputRegex = /:([a-zA-Z0-9_+-]+):$/;\n+\n+export const pasteRegex = /:([a-zA-Z0-9_+-]+):/g;\n+\n+export const Emoji = Node.create<EmojiOptions, EmojiStorage>({\n+  name: \"emoji\",\n+\n+  inline: true,\n+\n+  group: \"inline\",\n+\n+  selectable: false,\n+\n+  addOptions() {\n+    return {\n+      HTMLAttributes: {},\n+      // emojis: ,\n+      emojis: emojis,\n+      enableEmoticons: false,\n+      forceFallbackImages: false,\n+      suggestion: {\n+        char: \":\",\n+        pluginKey: EmojiSuggestionPluginKey,\n+        command: ({ editor, range, props }) => {\n+          // increase range.to by one when the next node is of type \"text\"\n+          // and starts with a space character\n+          const nodeAfter = editor.view.state.selection.$to.nodeAfter;\n+          const overrideSpace = nodeAfter?.text?.startsWith(\" \");\n+\n+          if (overrideSpace) {\n+            range.to += 1;\n+          }\n+\n+          editor\n+            .chain()\n+            .focus()\n+            .insertContentAt(range, [\n+              {\n+                type: this.name,\n+                attrs: props,\n+              },\n+              {\n+                type: \"text\",\n+                text: \" \",\n+              },\n+            ])\n+            .command(({ tr, state }) => {\n+              tr.setStoredMarks(state.doc.resolve(state.selection.to - 2).marks());\n+              return true;\n+            })\n+            .run();\n+        },\n+        allow: ({ state, range }) => {\n+          const $from = state.doc.resolve(range.from);\n+          const type = state.schema.nodes[this.name];\n+          const allow = !!$from.parent.type.contentMatch.matchType(type);\n+\n+          return allow;\n+        },\n+      },\n+    };\n+  },\n+\n+  addStorage() {\n+    const { emojis } = this.options;\n+    const supportMap: Record<number, boolean> = removeDuplicates(emojis.map((item) => item.version))\n+      .filter((version) => typeof version === \"number\")\n+      .reduce((versions, version) => {\n+        const emoji = emojis.find((item) => item.version === version && item.emoji);\n+\n+        return {\n+          ...versions,\n+          [version as number]: emoji ? isEmojiSupported(emoji.emoji as string) : false,\n+        };\n+      }, {});\n+\n+    return {\n+      emojis: this.options.emojis,\n+      isSupported: (emojiItem) => (emojiItem.version ? supportMap[emojiItem.version] : false),\n+    };\n+  },\n+\n+  addAttributes() {\n+    return {\n+      name: {\n+        default: null,\n+        parseHTML: (element) => element.dataset.name,\n+        renderHTML: (attributes) => ({\n+          \"data-name\": attributes.name,\n+        }),\n+      },\n+    };\n+  },\n+\n+  parseHTML() {\n+    return [\n+      {\n+        tag: `span[data-type=\"${this.name}\"]`,\n+      },\n+    ];\n+  },\n+\n+  renderHTML({ HTMLAttributes, node }) {\n+    const emojiItem = shortcodeToEmoji(node.attrs.name, this.options.emojis);\n+    const attributes = mergeAttributes(HTMLAttributes, this.options.HTMLAttributes, { \"data-type\": this.name });\n+\n+    if (!emojiItem) {\n+      return [\"span\", attributes, `:${node.attrs.name}:`];\n+    }\n+\n+    const renderFallbackImage = false;\n+\n+    return [\n+      \"span\",\n+      attributes,\n+      renderFallbackImage\n+        ? [\n+            \"img\",\n+            {\n+              src: emojiItem.fallbackImage,\n+              draggable: \"false\",\n+              loading: \"lazy\",\n+              align: \"absmiddle\",\n+            },\n+          ]\n+        : emojiItem.emoji || `:${emojiItem.shortcodes[0]}:`,\n+    ];\n+  },\n+\n+  renderText({ node }) {\n+    const emojiItem = shortcodeToEmoji(node.attrs.name, this.options.emojis);\n+\n+    return emojiItem?.emoji || `:${node.attrs.name}:`;\n+  },\n+\n+  addCommands() {\n+    return {\n+      setEmoji:\n+        (shortcode) =>\n+        ({ chain }) => {\n+          const emojiItem = shortcodeToEmoji(shortcode, this.options.emojis);\n+\n+          if (!emojiItem) {\n+            return false;\n+          }\n+\n+          chain()\n+            .insertContent({\n+              type: this.name,\n+              attrs: {\n+                name: emojiItem.name,\n+              },\n+            })\n+            .command(({ tr, state }) => {\n+              tr.setStoredMarks(state.doc.resolve(state.selection.to - 1).marks());\n+              return true;\n+            })\n+            .run();\n+\n+          return true;\n+        },\n+    };\n+  },\n+\n+  addInputRules() {\n+    const inputRules: InputRule[] = [];\n+\n+    inputRules.push(\n+      new InputRule({\n+        find: inputRegex,\n+        handler: ({ range, match, chain }) => {\n+          const name = match[1];\n+\n+          if (!shortcodeToEmoji(name, this.options.emojis)) {\n+            return;\n+          }\n+\n+          chain()\n+            .insertContentAt(range, {\n+              type: this.name,\n+              attrs: {\n+                name,\n+              },\n+            })\n+            .command(({ tr, state }) => {\n+              tr.setStoredMarks(state.doc.resolve(state.selection.to - 1).marks());\n+              return true;\n+            })\n+            .run();\n+        },\n+      })\n+    );\n+\n+    if (this.options.enableEmoticons) {\n+      // get the list of supported emoticons\n+      const emoticons = this.options.emojis\n+        .map((item) => item.emoticons)\n+        .flat()\n+        .filter((item) => item) as string[];\n+\n+      const emoticonRegex = new RegExp(`(?:^|\\\\s)(${emoticons.map((item) => escapeForRegEx(item)).join(\"|\")}) $`);\n+\n+      inputRules.push(\n+        nodeInputRule({\n+          find: emoticonRegex,\n+          type: this.type,\n+          getAttributes: (match) => {\n+            const emoji = this.options.emojis.find((item) => item.emoticons?.includes(match[1]));\n+\n+            if (!emoji) {\n+              return;\n+            }\n+\n+            return {\n+              name: emoji.name,\n+            };\n+          },\n+        })\n+      );\n+    }\n+\n+    return inputRules;\n+  },\n+\n+  addPasteRules() {\n+    return [\n+      new PasteRule({\n+        find: pasteRegex,\n+        handler: ({ range, match, chain }) => {\n+          const name = match[1];\n+\n+          if (!shortcodeToEmoji(name, this.options.emojis)) {\n+            return;\n+          }\n+\n+          chain()\n+            .insertContentAt(\n+              range,\n+              {\n+                type: this.name,\n+                attrs: {\n+                  name,\n+                },\n+              },\n+              {\n+                updateSelection: false,\n+              }\n+            )\n+            .command(({ tr, state }) => {\n+              tr.setStoredMarks(state.doc.resolve(state.selection.to - 1).marks());\n+              return true;\n+            })\n+            .run();\n+        },\n+      }),\n+    ];\n+  },\n+\n+  addProseMirrorPlugins() {\n+    return [\n+      Suggestion({\n+        editor: this.editor,\n+        ...this.options.suggestion,\n+      }),\n+\n+      new Plugin({\n+        key: new PluginKey(\"emoji\"),\n+        props: {\n+          // double click to select emoji doesn’t work by default\n+          // that’s why we simulate this behavior\n+          handleDoubleClickOn: (view, pos, node) => {\n+            if (node.type !== this.type) {\n+              return false;\n+            }\n+\n+            const from = pos;\n+            const to = from + node.nodeSize;\n+\n+            this.editor.commands.setTextSelection({\n+              from,\n+              to,\n+            });\n+\n+            return true;\n+          },\n+        },\n+\n+        // replace text emojis with emoji node on any change\n+        appendTransaction: (transactions, oldState, newState) => {\n+          const docChanges =\n+            transactions.some((transaction) => transaction.docChanged) && !oldState.doc.eq(newState.doc);\n+\n+          if (!docChanges) {\n+            return;\n+          }\n+\n+          const { tr } = newState;\n+          const transform = combineTransactionSteps(oldState.doc, transactions as Transaction[]);\n+          const changes = getChangedRanges(transform);\n+\n+          changes.forEach(({ newRange }) => {\n+            // We don’t want to add emoji inline nodes within code blocks.\n+            // Because this would split the code block.\n+\n+            // This only works if the range of changes is within a code node.\n+            // For all other cases (e.g. the whole document is set/pasted and the parent of the range is `doc`)\n+            // it doesn't and we have to double check later.\n+            if (newState.doc.resolve(newRange.from).parent.type.spec.code) {\n+              return;\n+            }\n+\n+            const textNodes = findChildrenInRange(newState.doc, newRange, (node) => node.type.isText);\n+\n+            textNodes.forEach(({ node, pos }) => {\n+              if (!node.text) {\n+                return;\n+              }\n+\n+              const matches = [...node.text.matchAll(emojiRegex())];\n+\n+              matches.forEach((match) => {\n+                if (match.index === undefined) {\n+                  return;\n+                }\n+\n+                const emoji = match[0];\n+                const name = emojiToShortcode(emoji, this.options.emojis);\n+\n+                if (!name) {\n+                  return;\n+                }\n+\n+                const from = tr.mapping.map(pos + match.index);\n+\n+                // Double check parent node is not a code block.\n+                if (newState.doc.resolve(from).parent.type.spec.code) {\n+                  return;\n+                }\n+\n+                const to = from + emoji.length;\n+                const emojiNode = this.type.create({\n+                  name,\n+                });\n+\n+                tr.replaceRangeWith(from, to, emojiNode);\n+\n+                tr.setStoredMarks(newState.doc.resolve(from).marks());\n+              });\n+            });\n+          });\n+\n+          if (!tr.steps.length) {\n+            return;\n+          }\n+\n+          return tr;\n+        },\n+      }),\n+    ];\n+  },\n+});\n"
        },
        {
          "path": "packages/editor/src/core/extensions/emoji/extension.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/emoji/extension.ts\n===================================================================\n--- packages/editor/src/core/extensions/emoji/extension.ts\ta2a62e2 (parent)\n+++ packages/editor/src/core/extensions/emoji/extension.ts\tab79a5d (commit)\n@@ -1,27 +1,27 @@\n-import Emoji, { EmojiItem, gitHubEmojis, shortcodeToEmoji } from \"@tiptap/extension-emoji\";\n // local imports\n+import { gitHubEmojis, shortcodeToEmoji } from \"@tiptap/extension-emoji\";\n import { MarkdownSerializerState } from \"@tiptap/pm/markdown\";\n import { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\n+import { Emoji } from \"./emoji\";\n import suggestion from \"./suggestion\";\n \n export const EmojiExtension = Emoji.extend({\n   addStorage() {\n     return {\n       ...this.parent?.(),\n       markdown: {\n         serialize(state: MarkdownSerializerState, node: ProseMirrorNode) {\n-          const emojiItem = shortcodeToEmoji(node.attrs.name, this.options.emojis)\n-          if(emojiItem?.emoji) {\n+          const emojiItem = shortcodeToEmoji(node.attrs.name, this.options.emojis);\n+          if (emojiItem?.emoji) {\n             state.write(emojiItem?.emoji);\n-          } else if(emojiItem?.fallbackImage) {\n+          } else if (emojiItem?.fallbackImage) {\n             state.write(`\\n![${emojiItem.name}-${emojiItem.shortcodes[0]}](${emojiItem?.fallbackImage})\\n`);\n           } else {\n             state.write(`:${node.attrs.name}:`);\n           }\n         },\n       },\n-\n     };\n   },\n }).configure({\n   emojis: gitHubEmojis,\n"
        },
        {
          "path": "packages/editor/src/core/extensions/emoji/suggestion.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/emoji/suggestion.ts\n===================================================================\n--- packages/editor/src/core/extensions/emoji/suggestion.ts\ta2a62e2 (parent)\n+++ packages/editor/src/core/extensions/emoji/suggestion.ts\tab79a5d (commit)\n@@ -11,19 +11,31 @@\n const DEFAULT_EMOJIS = [\"+1\", \"-1\", \"smile\", \"orange_heart\", \"eyes\"];\n \n const emojiSuggestion: EmojiOptions[\"suggestion\"] = {\n   items: ({ editor, query }: { editor: Editor; query: string }): EmojiItem[] => {\n+    const { emojis } = getExtensionStorage(editor, CORE_EXTENSIONS.EMOJI);\n+    const { isSupported } = getExtensionStorage(editor, CORE_EXTENSIONS.EMOJI);\n+    const filteredEmojis = emojis.filter((emoji) => {\n+      const hasEmoji = !!emoji?.emoji;\n+      const hasFallbackImage = !!emoji?.fallbackImage;\n+      const renderFallbackImage =\n+        (emoji.forceFallbackImages && !hasEmoji) ||\n+        (emoji.forceFallbackImages && hasFallbackImage) ||\n+        (emoji.forceFallbackImages && !isSupported(emoji) && hasFallbackImage) ||\n+        ((!isSupported(emoji) || !hasEmoji) && hasFallbackImage);\n+      return !renderFallbackImage;\n+    });\n+\n     if (query.trim() === \"\") {\n-      const { emojis } = getExtensionStorage(editor, CORE_EXTENSIONS.EMOJI);\n       const defaultEmojis = DEFAULT_EMOJIS.map((name) =>\n-        emojis.find((emoji: EmojiItem) => emoji.shortcodes.includes(name) || emoji.name === name)\n+        filteredEmojis.find((emoji: EmojiItem) => emoji.shortcodes.includes(name) || emoji.name === name)\n       )\n         .filter(Boolean)\n         .slice(0, 5);\n       return defaultEmojis as EmojiItem[];\n     }\n-    return getExtensionStorage(editor, CORE_EXTENSIONS.EMOJI)\n-      .emojis.filter(({ shortcodes, tags }) => {\n+    return filteredEmojis\n+      .filter(({ shortcodes, tags }) => {\n         const lowerQuery = query.toLowerCase();\n         return (\n           shortcodes.find((shortcode: string) => shortcode.startsWith(lowerQuery)) ||\n           tags.find((tag: string) => tag.startsWith(lowerQuery))\n"
        },
        {
          "path": "packages/editor/src/core/extensions/read-only-extensions.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/read-only-extensions.ts\n===================================================================\n--- packages/editor/src/core/extensions/read-only-extensions.ts\ta2a62e2 (parent)\n+++ packages/editor/src/core/extensions/read-only-extensions.ts\tab79a5d (commit)\n@@ -32,8 +32,9 @@\n // types\n import type { IReadOnlyEditorProps } from \"@/types\";\n // local imports\n import { CustomImageExtension } from \"./custom-image/extension\";\n+import { EmojiExtension } from \"./emoji/extension\";\n \n type Props = Pick<IReadOnlyEditorProps, \"disabledExtensions\" | \"flaggedExtensions\" | \"fileHandler\" | \"mentionHandler\">;\n \n export const CoreReadOnlyEditorExtensions = (props: Props): Extensions => {\n@@ -72,8 +73,9 @@\n       },\n       dropcursor: false,\n       gapcursor: false,\n     }),\n+    EmojiExtension,\n     CustomQuoteExtension,\n     CustomHorizontalRule.configure({\n       HTMLAttributes: {\n         class: \"py-4 border-custom-border-400\",\n"
        }
      ]
    },
    {
      "id": "optimize-issue-listing",
      "sha": "b8043f92b13d0b14747baea8bc7411d6643b9acf",
      "parentSha": "0e91feacc3b0ea4c2b2bf1c4c3795b2708d1620a",
      "spec": "Implement performant issue list retrieval, ordering, and pagination across workspace and project views by making the following changes:\n\n1) Add a lightweight issue list serializer for project views\n- File: apiserver/plane/app/serializers/issue.py\n- Create IssueListDetailSerializer (DRF serializers.Serializer) that:\n  - Accepts expand and fields in __init__ and stores them on the instance.\n  - Returns a dict with basic fields: id, name, state_id, sort_order, completed_at, estimate_point, priority, start_date, target_date, sequence_id, project_id, parent_id, created_at, updated_at, created_by, updated_by, is_draft, archived_at.\n  - Returns computed fields: cycle_id (pre-annotated in queryset), module_ids, label_ids, assignee_ids (read from prefetched relations issue_module, label_issue, issue_assignee), sub_issues_count, attachment_count, link_count.\n  - Supports expand options issue_relation and issue_related by including arrays of related issues with id, project_id, sequence_id, name, relation_type, state_id, priority, created_by, created_at, updated_at, updated_by; skip any null related issues.\n- Do not rely on ArrayAgg; expect relations to be prefetched.\n\n2) Add a lightweight issue list serializer for workspace views\n- File: apiserver/plane/app/serializers/view.py\n- Create ViewIssueListSerializer (DRF serializers.Serializer) that returns a minimal issue representation:\n  - Fields: id, name, state_id, sort_order, completed_at, estimate_point, priority, start_date, target_date, sequence_id, project_id, parent_id, cycle_id (pre-annotated in queryset), sub_issues_count, created_at, updated_at, created_by, updated_by, attachment_count, link_count, is_draft, archived_at.\n  - Include state__group as instance.state.group if instance.state is present, else None.\n  - Include assignee_ids, label_ids, module_ids computed from prefetched issue_assignee, label_issue, issue_module.\n\n3) Export new serializers\n- File: apiserver/plane/app/serializers/__init__.py\n- Export IssueListDetailSerializer from .issue and ViewIssueListSerializer from .view alongside existing serializers.\n\n4) Optimize IssueDetailEndpoint to use permission subquery, prefetch relations, and new serializer\n- File: apiserver/plane/app/views/issue/base.py\n- Replace the prior project_member_subquery and ArrayAgg annotations with:\n  - A permission_subquery on Issue that enforces:\n    - Members with role > GUEST can access all issues in the project.\n    - GUEST members can access all issues only if guest_view_all_features is True; otherwise only issues created_by the current user.\n  - Main queryset filtered by Exists(permission_subquery).\n  - Prefetch relations for issue_assignee (IssueAssignee), label_issue (IssueLabel), and issue_module (ModuleIssue) using Prefetch.\n  - Annotate cycle_id via Subquery(CycleIssue), plus sub_issues_count, attachment_count, link_count as already established in the view.\n  - Conditionally prefetch issue_relation with related_issue and issue_related with issue only if requested in expand.\n  - Use IssueListDetailSerializer in pagination on_results, passing fields and expand through.\n\n5) Optimize workspace view issue list to prefetch and paginate efficiently\n- File: apiserver/plane/app/views/view/base.py\n- Update imports to remove unused Postgres-specific array aggregation utilities and include Prefetch and the new serializers.\n- In WorkspaceViewIssuesViewSet:\n  - Add a helper method _get_project_permission_filters that returns a Q object enforcing:\n    - For role=GUEST (role=5): show all if guest_view_all_features=True; otherwise only created_by current user.\n    - For roles > GUEST (role > 5): show all issues.\n    - All conditions must also match current user’s active project membership.\n  - In get_queryset(), select_related('state') and prefetch issue_assignee (IssueAssignee), label_issue (IssueLabel), issue_module (ModuleIssue). Do not use ArrayAgg annotations.\n  - Annotate cycle_id via Subquery(CycleIssue) and maintain existing counts (sub_issues_count, attachment_count, link_count) as previously done.\n  - In the list handler, apply issue_filters; then apply the permission filters from _get_project_permission_filters to both the main issue queryset and to a separate total_issue_count queryset (filtered by workspace and the same filters); call order_issue_queryset; paginate with ViewIssueListSerializer and pass total_count_queryset to the paginator.\n\n6) Ensure stable ordering behavior with a created_at tie-breaker\n- File: apiserver/plane/utils/order_queryset.py\n- When ordering by priority group, by state order, or by aggregate min/max values, always append '-created_at' as a secondary ordering key for deterministic results.\n- If ordering directly by created_at, do not add an extra created_at tie-breaker; otherwise for all other fields, append '-created_at' as a secondary sort key.\n\n7) Update offset paginator to support total count queryset and correct offset math\n- File: apiserver/plane/utils/paginator.py\n- OffsetPaginator: accept total_count_queryset in the constructor and store it.\n- In get_result():\n  - Compute offset as page * limit, independent of cursor.value.\n  - Use stop = offset + limit + 1.\n  - Only slice from the end when navigating backwards (cursor.is_prev true) and the page size differs.\n  - Set total_count from total_count_queryset.count() if provided; otherwise fall back to results.count().\n  - Set has_next based on whether len(results) > limit.\n  - Use total_count for overall count; compute max_hits from this count.\n- GroupedOffsetPaginator and SubGroupedOffsetPaginator: accept and forward total_count_queryset to the base class.\n- BasePaginator.paginate: accept total_count_queryset and forward it to the paginator instance, in addition to existing args.\n\n8) Adjust imports\n- Ensure all modified modules update imports to remove unused Postgres ArrayAgg/ArrayField/Coalesce utilities and add Prefetch and required model classes (IssueAssignee, IssueLabel, ModuleIssue, IssueRelation) as used.\n\n9) Behavior expectations\n- Workspace and project issue list endpoints must return consistent list payloads using the new serializers.\n- Expanded fields issue_relation and issue_related are only included when requested via expand, and null related issues are skipped.\n- Ordering by priority, state, or numeric aggregations is deterministic due to '-created_at' tie-breaker; raw created_at ordering remains unchanged.\n- Pagination must report counts efficiently using a separate total_count queryset and use correct offset math based on limit.",
      "prompt": "Optimize issue listing performance and consistency across workspace and project views.\n\n- Add lightweight serializers that build assignee, label, and module ID arrays from prefetched relations. Include a variant for project issue details that supports optional relation expansion.\n- Refactor the issue endpoints to replace heavy aggregations with prefetch, apply unified permission filters for guests and members, and use the new serializers for list responses.\n- Ensure list ordering is deterministic with created_at as a tie-breaker except when directly ordering by created_at.\n- Improve pagination to accept an optional total count queryset, compute offsets using the limit, and correctly determine if a next page exists.\n- Update imports accordingly and keep the responses backward compatible where possible.\n\nFocus on correctness, security of permission filtering, and measurable reductions in query complexity.",
      "supplementalFiles": [
        "apiserver/plane/app/permissions.py",
        "apiserver/plane/utils/issue_filters.py",
        "apiserver/plane/utils/grouper.py",
        "apiserver/plane/utils/global_paginator.py"
      ],
      "fileDiffs": [
        {
          "path": "apiserver/plane/app/serializers/__init__.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/serializers/__init__.py\n===================================================================\n--- apiserver/plane/app/serializers/__init__.py\t0e91fea (parent)\n+++ apiserver/plane/app/serializers/__init__.py\tb8043f9 (commit)\n@@ -38,9 +38,9 @@\n     ProjectPublicMemberSerializer,\n     ProjectMemberRoleSerializer,\n )\n from .state import StateSerializer, StateLiteSerializer\n-from .view import IssueViewSerializer\n+from .view import IssueViewSerializer, ViewIssueListSerializer\n from .cycle import (\n     CycleSerializer,\n     CycleIssueSerializer,\n     CycleWriteSerializer,\n@@ -73,8 +73,9 @@\n     IssueAttachmentLiteSerializer,\n     IssueLinkLiteSerializer,\n     IssueVersionDetailSerializer,\n     IssueDescriptionVersionDetailSerializer,\n+    IssueListDetailSerializer,\n )\n \n from .module import (\n     ModuleDetailSerializer,\n"
        },
        {
          "path": "apiserver/plane/app/serializers/issue.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/serializers/issue.py\n===================================================================\n--- apiserver/plane/app/serializers/issue.py\t0e91fea (parent)\n+++ apiserver/plane/app/serializers/issue.py\tb8043f9 (commit)\n@@ -724,8 +724,112 @@\n         ]\n         read_only_fields = fields\n \n \n+class IssueListDetailSerializer(serializers.Serializer):\n+\n+    def __init__(self, *args, **kwargs):\n+        # Extract expand parameter and store it as instance variable\n+        self.expand = kwargs.pop(\"expand\", []) or []\n+        # Extract fields parameter and store it as instance variable\n+        self.fields = kwargs.pop(\"fields\", []) or []\n+        super().__init__(*args, **kwargs)\n+\n+    def get_module_ids(self, obj):\n+        return [module.module_id for module in obj.issue_module.all()]\n+\n+    def get_label_ids(self, obj):\n+        return [label.label_id for label in obj.label_issue.all()]\n+\n+    def get_assignee_ids(self, obj):\n+        return [assignee.assignee_id for assignee in obj.issue_assignee.all()]\n+\n+    def to_representation(self, instance):\n+        data = {\n+            # Basic fields\n+            \"id\": instance.id,\n+            \"name\": instance.name,\n+            \"state_id\": instance.state_id,\n+            \"sort_order\": instance.sort_order,\n+            \"completed_at\": instance.completed_at,\n+            \"estimate_point\": instance.estimate_point_id,\n+            \"priority\": instance.priority,\n+            \"start_date\": instance.start_date,\n+            \"target_date\": instance.target_date,\n+            \"sequence_id\": instance.sequence_id,\n+            \"project_id\": instance.project_id,\n+            \"parent_id\": instance.parent_id,\n+            \"created_at\": instance.created_at,\n+            \"updated_at\": instance.updated_at,\n+            \"created_by\": instance.created_by_id,\n+            \"updated_by\": instance.updated_by_id,\n+            \"is_draft\": instance.is_draft,\n+            \"archived_at\": instance.archived_at,\n+            # Computed fields\n+            \"cycle_id\": instance.cycle_id,\n+            \"module_ids\": self.get_module_ids(instance),\n+            \"label_ids\": self.get_label_ids(instance),\n+            \"assignee_ids\": self.get_assignee_ids(instance),\n+            \"sub_issues_count\": instance.sub_issues_count,\n+            \"attachment_count\": instance.attachment_count,\n+            \"link_count\": instance.link_count,\n+        }\n+\n+        # Handle expanded fields only when requested - using direct field access\n+        if self.expand:\n+            if \"issue_relation\" in self.expand:\n+                relations = []\n+                for relation in instance.issue_relation.all():\n+                    related_issue = relation.related_issue\n+                    # If the related issue is deleted, skip it\n+                    if not related_issue:\n+                        continue\n+                    # Add the related issue to the relations list\n+                    relations.append(\n+                        {\n+                            \"id\": related_issue.id,\n+                            \"project_id\": related_issue.project_id,\n+                            \"sequence_id\": related_issue.sequence_id,\n+                            \"name\": related_issue.name,\n+                            \"relation_type\": relation.relation_type,\n+                            \"state_id\": related_issue.state_id,\n+                            \"priority\": related_issue.priority,\n+                            \"created_by\": related_issue.created_by_id,\n+                            \"created_at\": related_issue.created_at,\n+                            \"updated_at\": related_issue.updated_at,\n+                            \"updated_by\": related_issue.updated_by_id,\n+                        }\n+                    )\n+                data[\"issue_relation\"] = relations\n+\n+            if \"issue_related\" in self.expand:\n+                related = []\n+                for relation in instance.issue_related.all():\n+                    issue = relation.issue\n+                    # If the related issue is deleted, skip it\n+                    if not issue:\n+                        continue\n+                    # Add the related issue to the related list\n+                    related.append(\n+                        {\n+                            \"id\": issue.id,\n+                            \"project_id\": issue.project_id,\n+                            \"sequence_id\": issue.sequence_id,\n+                            \"name\": issue.name,\n+                            \"relation_type\": relation.relation_type,\n+                            \"state_id\": issue.state_id,\n+                            \"priority\": issue.priority,\n+                            \"created_by\": issue.created_by_id,\n+                            \"created_at\": issue.created_at,\n+                            \"updated_at\": issue.updated_at,\n+                            \"updated_by\": issue.updated_by_id,\n+                        }\n+                    )\n+                data[\"issue_related\"] = related\n+\n+        return data\n+\n+\n class IssueLiteSerializer(DynamicBaseSerializer):\n     class Meta:\n         model = Issue\n         fields = [\"id\", \"sequence_id\", \"project_id\"]\n"
        },
        {
          "path": "apiserver/plane/app/serializers/view.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/serializers/view.py\n===================================================================\n--- apiserver/plane/app/serializers/view.py\t0e91fea (parent)\n+++ apiserver/plane/app/serializers/view.py\tb8043f9 (commit)\n@@ -6,8 +6,51 @@\n from plane.db.models import IssueView\n from plane.utils.issue_filters import issue_filters\n \n \n+class ViewIssueListSerializer(serializers.Serializer):\n+\n+    def get_assignee_ids(self, instance):\n+        return [assignee.assignee_id for assignee in instance.issue_assignee.all()]\n+\n+    def get_label_ids(self, instance):\n+        return [label.label_id for label in instance.label_issue.all()]\n+\n+    def get_module_ids(self, instance):\n+        return [module.module_id for module in instance.issue_module.all()]\n+\n+    def to_representation(self, instance):\n+        data = {\n+            \"id\": instance.id,\n+            \"name\": instance.name,\n+            \"state_id\": instance.state_id,\n+            \"sort_order\": instance.sort_order,\n+            \"completed_at\": instance.completed_at,\n+            \"estimate_point\": instance.estimate_point_id,\n+            \"priority\": instance.priority,\n+            \"start_date\": instance.start_date,\n+            \"target_date\": instance.target_date,\n+            \"sequence_id\": instance.sequence_id,\n+            \"project_id\": instance.project_id,\n+            \"parent_id\": instance.parent_id,\n+            \"cycle_id\": instance.cycle_id,\n+            \"sub_issues_count\": instance.sub_issues_count,\n+            \"created_at\": instance.created_at,\n+            \"updated_at\": instance.updated_at,\n+            \"created_by\": instance.created_by_id,\n+            \"updated_by\": instance.updated_by_id,\n+            \"attachment_count\": instance.attachment_count,\n+            \"link_count\": instance.link_count,\n+            \"is_draft\": instance.is_draft,\n+            \"archived_at\": instance.archived_at,\n+            \"state__group\": instance.state.group if instance.state else None,\n+            \"assignee_ids\": self.get_assignee_ids(instance),\n+            \"label_ids\": self.get_label_ids(instance),\n+            \"module_ids\": self.get_module_ids(instance),\n+        }\n+        return data\n+\n+\n class IssueViewSerializer(DynamicBaseSerializer):\n     is_favorite = serializers.BooleanField(read_only=True)\n \n     class Meta:\n"
        },
        {
          "path": "apiserver/plane/app/views/issue/base.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/views/issue/base.py\n===================================================================\n--- apiserver/plane/app/views/issue/base.py\t0e91fea (parent)\n+++ apiserver/plane/app/views/issue/base.py\tb8043f9 (commit)\n@@ -31,8 +31,9 @@\n     IssueCreateSerializer,\n     IssueDetailSerializer,\n     IssueUserPropertySerializer,\n     IssueSerializer,\n+    IssueListDetailSerializer,\n )\n from plane.bgtasks.issue_activities_task import issue_activity\n from plane.db.models import (\n     Issue,\n@@ -45,8 +46,11 @@\n     ProjectMember,\n     CycleIssue,\n     UserRecentVisit,\n     ModuleIssue,\n+    IssueRelation,\n+    IssueAssignee,\n+    IssueLabel,\n )\n from plane.utils.grouper import (\n     issue_group_values,\n     issue_on_results,\n@@ -946,78 +950,64 @@\n         filters = issue_filters(request.query_params, \"GET\")\n \n         # check for the project member role, if the role is 5 then check for the guest_view_all_features\n         #  if it is true then show all the issues else show only the issues created by the user\n-        project_member_subquery = ProjectMember.objects.filter(\n-            project_id=OuterRef(\"project_id\"),\n-            member=self.request.user,\n-            is_active=True,\n-        ).filter(\n-            Q(role__gt=ROLE.GUEST.value) \n-            | Q(\n-                role=ROLE.GUEST.value, project__guest_view_all_features=True\n+        permission_subquery = (\n+            Issue.issue_objects.filter(\n+                workspace__slug=slug, project_id=project_id, id=OuterRef(\"id\")\n             )\n-        )\n-\n-        # Main issue query\n-        issue = (\n-            Issue.issue_objects.filter(workspace__slug=slug, project_id=project_id)\n             .filter(\n-                Q(Exists(project_member_subquery))\n+                Q(\n+                    project__project_projectmember__member=self.request.user,\n+                    project__project_projectmember__is_active=True,\n+                    project__project_projectmember__role__gt=ROLE.GUEST.value,\n+                )\n                 | Q(\n                     project__project_projectmember__member=self.request.user,\n                     project__project_projectmember__is_active=True,\n                     project__project_projectmember__role=ROLE.GUEST.value,\n+                    project__guest_view_all_features=True,\n+                )\n+                | Q(\n+                    project__project_projectmember__member=self.request.user,\n+                    project__project_projectmember__is_active=True,\n+                    project__project_projectmember__role=ROLE.GUEST.value,\n                     project__guest_view_all_features=False,\n                     created_by=self.request.user,\n                 )\n             )\n-            .prefetch_related(\"assignees\", \"labels\", \"issue_module__module\")\n+            .values(\"id\")\n+        )\n+        # Main issue query\n+        issue = (\n+            Issue.issue_objects.filter(workspace__slug=slug, project_id=project_id)\n+            .filter(Exists(permission_subquery))\n+            .prefetch_related(\n+                Prefetch(\n+                    \"issue_assignee\",\n+                    queryset=IssueAssignee.objects.all(),\n+                )\n+            )\n+            .prefetch_related(\n+                Prefetch(\n+                    \"label_issue\",\n+                    queryset=IssueLabel.objects.all(),\n+                )\n+            )\n+            .prefetch_related(\n+                Prefetch(\n+                    \"issue_module\",\n+                    queryset=ModuleIssue.objects.all(),\n+                )\n+            )\n             .annotate(\n                 cycle_id=Subquery(\n                     CycleIssue.objects.filter(\n                         issue=OuterRef(\"id\"), deleted_at__isnull=True\n                     ).values(\"cycle_id\")[:1]\n                 )\n             )\n             .annotate(\n-                label_ids=Coalesce(\n-                    ArrayAgg(\n-                        \"labels__id\",\n-                        distinct=True,\n-                        filter=Q(\n-                            ~Q(labels__id__isnull=True)\n-                            & Q(label_issue__deleted_at__isnull=True)\n-                        ),\n-                    ),\n-                    Value([], output_field=ArrayField(UUIDField())),\n-                ),\n-                assignee_ids=Coalesce(\n-                    ArrayAgg(\n-                        \"assignees__id\",\n-                        distinct=True,\n-                        filter=Q(\n-                            ~Q(assignees__id__isnull=True)\n-                            & Q(assignees__member_project__is_active=True)\n-                            & Q(issue_assignee__deleted_at__isnull=True)\n-                        ),\n-                    ),\n-                    Value([], output_field=ArrayField(UUIDField())),\n-                ),\n-                module_ids=Coalesce(\n-                    ArrayAgg(\n-                        \"issue_module__module_id\",\n-                        distinct=True,\n-                        filter=Q(\n-                            ~Q(issue_module__module_id__isnull=True)\n-                            & Q(issue_module__module__archived_at__isnull=True)\n-                            & Q(issue_module__deleted_at__isnull=True)\n-                        ),\n-                    ),\n-                    Value([], output_field=ArrayField(UUIDField())),\n-                ),\n-            )\n-            .annotate(\n                 link_count=IssueLink.objects.filter(issue=OuterRef(\"id\"))\n                 .order_by()\n                 .annotate(count=Func(F(\"id\"), function=\"Count\"))\n                 .values(\"count\")\n@@ -1038,8 +1028,25 @@\n                 .values(\"count\")\n             )\n         )\n \n+        # Add additional prefetch based on expand parameter\n+        if self.expand:\n+            if \"issue_relation\" in self.expand:\n+                issue = issue.prefetch_related(\n+                    Prefetch(\n+                        \"issue_relation\",\n+                        queryset=IssueRelation.objects.select_related(\"related_issue\"),\n+                    )\n+                )\n+            if \"issue_related\" in self.expand:\n+                issue = issue.prefetch_related(\n+                    Prefetch(\n+                        \"issue_related\",\n+                        queryset=IssueRelation.objects.select_related(\"issue\"),\n+                    )\n+                )\n+\n         issue = issue.filter(**filters)\n         order_by_param = request.GET.get(\"order_by\", \"-created_at\")\n         # Issue queryset\n         issue, order_by_param = order_issue_queryset(\n@@ -1048,9 +1055,9 @@\n         return self.paginate(\n             request=request,\n             order_by=order_by_param,\n             queryset=(issue),\n-            on_results=lambda issue: IssueSerializer(\n+            on_results=lambda issue: IssueListDetailSerializer(\n                 issue, many=True, fields=self.fields, expand=self.expand\n             ).data,\n         )\n \n"
        },
        {
          "path": "apiserver/plane/app/views/view/base.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/views/view/base.py\n===================================================================\n--- apiserver/plane/app/views/view/base.py\t0e91fea (parent)\n+++ apiserver/plane/app/views/view/base.py\tb8043f9 (commit)\n@@ -1,9 +1,14 @@\n # Django imports\n-from django.contrib.postgres.aggregates import ArrayAgg\n-from django.contrib.postgres.fields import ArrayField\n-from django.db.models import Exists, F, Func, OuterRef, Q, UUIDField, Value, Subquery\n-from django.db.models.functions import Coalesce\n+from django.db.models import (\n+    Exists,\n+    F,\n+    Func,\n+    OuterRef,\n+    Q,\n+    Subquery,\n+    Prefetch,\n+)\n from django.utils.decorators import method_decorator\n from django.views.decorators.gzip import gzip_page\n from django.db import transaction\n \n@@ -12,9 +17,9 @@\n from rest_framework.response import Response\n \n # Module imports\n from plane.app.permissions import allow_permission, ROLE\n-from plane.app.serializers import IssueViewSerializer\n+from plane.app.serializers import IssueViewSerializer, ViewIssueListSerializer\n from plane.db.models import (\n     Issue,\n     FileAsset,\n     IssueLink,\n@@ -24,17 +29,14 @@\n     ProjectMember,\n     Project,\n     CycleIssue,\n     UserRecentVisit,\n+    IssueAssignee,\n+    IssueLabel,\n+    ModuleIssue,\n )\n-from plane.utils.grouper import (\n-    issue_group_values,\n-    issue_on_results,\n-    issue_queryset_grouper,\n-)\n from plane.utils.issue_filters import issue_filters\n from plane.utils.order_queryset import order_issue_queryset\n-from plane.utils.paginator import GroupedOffsetPaginator, SubGroupedOffsetPaginator\n from plane.bgtasks.recent_visited_task import recent_visited_task\n from .. import BaseViewSet\n from plane.db.models import UserFavorite\n \n@@ -142,8 +144,30 @@\n         return Response(status=status.HTTP_204_NO_CONTENT)\n \n \n class WorkspaceViewIssuesViewSet(BaseViewSet):\n+    def _get_project_permission_filters(self):\n+        \"\"\"\n+        Get common project permission filters for guest users and role-based access control.\n+        Returns Q object for filtering issues based on user role and project settings.\n+        \"\"\"\n+        return Q(\n+            Q(\n+                project__project_projectmember__role=5,\n+                project__guest_view_all_features=True,\n+            )\n+            | Q(\n+                project__project_projectmember__role=5,\n+                project__guest_view_all_features=False,\n+                created_by=self.request.user,\n+            )\n+            |\n+            # For other roles (role > 5), show all issues\n+            Q(project__project_projectmember__role__gt=5),\n+            project__project_projectmember__member=self.request.user,\n+            project__project_projectmember__is_active=True,\n+        )\n+\n     def get_queryset(self):\n         return (\n             Issue.issue_objects.annotate(\n                 sub_issues_count=Issue.issue_objects.filter(parent=OuterRef(\"id\"))\n@@ -151,14 +175,27 @@\n                 .annotate(count=Func(F(\"id\"), function=\"Count\"))\n                 .values(\"count\")\n             )\n             .filter(workspace__slug=self.kwargs.get(\"slug\"))\n-            .filter(\n-                project__project_projectmember__member=self.request.user,\n-                project__project_projectmember__is_active=True,\n+            .select_related(\"state\")\n+            .prefetch_related(\n+                Prefetch(\n+                    \"issue_assignee\",\n+                    queryset=IssueAssignee.objects.all(),\n+                )\n             )\n-            .select_related(\"workspace\", \"project\", \"state\", \"parent\")\n-            .prefetch_related(\"assignees\", \"labels\", \"issue_module__module\")\n+            .prefetch_related(\n+                Prefetch(\n+                    \"label_issue\",\n+                    queryset=IssueLabel.objects.all(),\n+                )\n+            )\n+            .prefetch_related(\n+                Prefetch(\n+                    \"issue_module\",\n+                    queryset=ModuleIssue.objects.all(),\n+                )\n+            )\n             .annotate(\n                 cycle_id=Subquery(\n                     CycleIssue.objects.filter(\n                         issue=OuterRef(\"id\"), deleted_at__isnull=True\n@@ -185,45 +222,8 @@\n                 .order_by()\n                 .annotate(count=Func(F(\"id\"), function=\"Count\"))\n                 .values(\"count\")\n             )\n-            .annotate(\n-                label_ids=Coalesce(\n-                    ArrayAgg(\n-                        \"labels__id\",\n-                        distinct=True,\n-                        filter=Q(\n-                            ~Q(labels__id__isnull=True)\n-                            & Q(label_issue__deleted_at__isnull=True)\n-                        ),\n-                    ),\n-                    Value([], output_field=ArrayField(UUIDField())),\n-                ),\n-                assignee_ids=Coalesce(\n-                    ArrayAgg(\n-                        \"assignees__id\",\n-                        distinct=True,\n-                        filter=Q(\n-                            ~Q(assignees__id__isnull=True)\n-                            & Q(assignees__member_project__is_active=True)\n-                            & Q(issue_assignee__deleted_at__isnull=True)\n-                        ),\n-                    ),\n-                    Value([], output_field=ArrayField(UUIDField())),\n-                ),\n-                module_ids=Coalesce(\n-                    ArrayAgg(\n-                        \"issue_module__module_id\",\n-                        distinct=True,\n-                        filter=Q(\n-                            ~Q(issue_module__module_id__isnull=True)\n-                            & Q(issue_module__module__archived_at__isnull=True)\n-                            & Q(issue_module__deleted_at__isnull=True)\n-                        ),\n-                    ),\n-                    Value([], output_field=ArrayField(UUIDField())),\n-                ),\n-            )\n         )\n \n     @method_decorator(gzip_page)\n     @allow_permission(\n@@ -232,129 +232,39 @@\n     def list(self, request, slug):\n         filters = issue_filters(request.query_params, \"GET\")\n         order_by_param = request.GET.get(\"order_by\", \"-created_at\")\n \n-        issue_queryset = (\n-            self.get_queryset()\n-            .filter(**filters)\n-            .annotate(\n-                cycle_id=Subquery(\n-                    CycleIssue.objects.filter(\n-                        issue=OuterRef(\"id\"), deleted_at__isnull=True\n-                    ).values(\"cycle_id\")[:1]\n-                )\n-            )\n-        )\n+        issue_queryset = self.get_queryset().filter(**filters)\n \n-        # check for the project member role, if the role is 5 then check for the guest_view_all_features if it is true then show all the issues else show only the issues created by the user\n+        # Get common project permission filters\n+        permission_filters = self._get_project_permission_filters()\n \n-        issue_queryset = issue_queryset.filter(\n-            Q(\n-                project__project_projectmember__role=5,\n-                project__guest_view_all_features=True,\n-            )\n-            | Q(\n-                project__project_projectmember__role=5,\n-                project__guest_view_all_features=False,\n-                created_by=self.request.user,\n-            )\n-            |\n-            # For other roles (role < 5), show all issues\n-            Q(project__project_projectmember__role__gt=5),\n-            project__project_projectmember__member=self.request.user,\n-            project__project_projectmember__is_active=True,\n+        # Base query for the counts\n+        total_issue_count = (\n+            Issue.issue_objects.filter(**filters)\n+            .filter(workspace__slug=slug)\n+            .filter(permission_filters)\n+            .only(\"id\")\n         )\n \n+        # Apply project permission filters to the issue queryset\n+        issue_queryset = issue_queryset.filter(permission_filters)\n+\n         # Issue queryset\n         issue_queryset, order_by_param = order_issue_queryset(\n             issue_queryset=issue_queryset, order_by_param=order_by_param\n         )\n \n-        # Group by\n-        group_by = request.GET.get(\"group_by\", False)\n-        sub_group_by = request.GET.get(\"sub_group_by\", False)\n-\n-        # issue queryset\n-        issue_queryset = issue_queryset_grouper(\n-            queryset=issue_queryset, group_by=group_by, sub_group_by=sub_group_by\n+        # List Paginate\n+        return self.paginate(\n+            order_by=order_by_param,\n+            request=request,\n+            queryset=issue_queryset,\n+            on_results=lambda issues: ViewIssueListSerializer(issues, many=True).data,\n+            total_count_queryset=total_issue_count,\n         )\n \n-        if group_by:\n-            # Check group and sub group value paginate\n-            if sub_group_by:\n-                if group_by == sub_group_by:\n-                    return Response(\n-                        {\n-                            \"error\": \"Group by and sub group by cannot have same parameters\"\n-                        },\n-                        status=status.HTTP_400_BAD_REQUEST,\n-                    )\n-                else:\n-                    # group and sub group pagination\n-                    return self.paginate(\n-                        request=request,\n-                        order_by=order_by_param,\n-                        queryset=issue_queryset,\n-                        on_results=lambda issues: issue_on_results(\n-                            group_by=group_by, issues=issues, sub_group_by=sub_group_by\n-                        ),\n-                        paginator_cls=SubGroupedOffsetPaginator,\n-                        group_by_fields=issue_group_values(\n-                            field=group_by, slug=slug, project_id=None, filters=filters\n-                        ),\n-                        sub_group_by_fields=issue_group_values(\n-                            field=sub_group_by,\n-                            slug=slug,\n-                            project_id=None,\n-                            filters=filters,\n-                        ),\n-                        group_by_field_name=group_by,\n-                        sub_group_by_field_name=sub_group_by,\n-                        count_filter=Q(\n-                            Q(issue_intake__status=1)\n-                            | Q(issue_intake__status=-1)\n-                            | Q(issue_intake__status=2)\n-                            | Q(issue_intake__isnull=True),\n-                            archived_at__isnull=True,\n-                            is_draft=False,\n-                        ),\n-                    )\n-            # Group Paginate\n-            else:\n-                # Group paginate\n-                return self.paginate(\n-                    request=request,\n-                    order_by=order_by_param,\n-                    queryset=issue_queryset,\n-                    on_results=lambda issues: issue_on_results(\n-                        group_by=group_by, issues=issues, sub_group_by=sub_group_by\n-                    ),\n-                    paginator_cls=GroupedOffsetPaginator,\n-                    group_by_fields=issue_group_values(\n-                        field=group_by, slug=slug, project_id=None, filters=filters\n-                    ),\n-                    group_by_field_name=group_by,\n-                    count_filter=Q(\n-                        Q(issue_intake__status=1)\n-                        | Q(issue_intake__status=-1)\n-                        | Q(issue_intake__status=2)\n-                        | Q(issue_intake__isnull=True),\n-                        archived_at__isnull=True,\n-                        is_draft=False,\n-                    ),\n-                )\n-        else:\n-            # List Paginate\n-            return self.paginate(\n-                order_by=order_by_param,\n-                request=request,\n-                queryset=issue_queryset,\n-                on_results=lambda issues: issue_on_results(\n-                    group_by=group_by, issues=issues, sub_group_by=sub_group_by\n-                ),\n-            )\n \n-\n class IssueViewViewSet(BaseViewSet):\n     serializer_class = IssueViewSerializer\n     model = IssueView\n \n"
        },
        {
          "path": "apiserver/plane/utils/order_queryset.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/utils/order_queryset.py\n===================================================================\n--- apiserver/plane/utils/order_queryset.py\t0e91fea (parent)\n+++ apiserver/plane/utils/order_queryset.py\tb8043f9 (commit)\n@@ -15,9 +15,9 @@\n                     for i, p in enumerate(PRIORITY_ORDER)\n                 ],\n                 output_field=CharField(),\n             )\n-        ).order_by(\"priority_order\")\n+        ).order_by(\"priority_order\", \"-created_at\")\n         order_by_param = (\n             \"priority_order\" if order_by_param.startswith(\"-\") else \"-priority_order\"\n         )\n     # State Ordering\n@@ -35,9 +35,9 @@\n                 ],\n                 default=Value(len(state_order)),\n                 output_field=CharField(),\n             )\n-        ).order_by(\"state_order\")\n+        ).order_by(\"state_order\", \"-created_at\")\n         order_by_param = (\n             \"-state_order\" if order_by_param.startswith(\"-\") else \"state_order\"\n         )\n     # assignee and label ordering\n@@ -54,12 +54,19 @@\n                 order_by_param[1::]\n                 if order_by_param.startswith(\"-\")\n                 else order_by_param\n             )\n-        ).order_by(\"-min_values\" if order_by_param.startswith(\"-\") else \"min_values\")\n+        ).order_by(\n+            \"-min_values\" if order_by_param.startswith(\"-\") else \"min_values\",\n+            \"-created_at\",\n+        )\n         order_by_param = (\n             \"-min_values\" if order_by_param.startswith(\"-\") else \"min_values\"\n         )\n     else:\n-        issue_queryset = issue_queryset.order_by(order_by_param)\n+        # If the order_by_param is created_at, then don't add the -created_at\n+        if \"created_at\" in order_by_param:\n+            issue_queryset = issue_queryset.order_by(order_by_param)\n+        else:\n+            issue_queryset = issue_queryset.order_by(order_by_param, \"-created_at\")\n         order_by_param = order_by_param\n     return issue_queryset, order_by_param\n"
        },
        {
          "path": "apiserver/plane/utils/paginator.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/utils/paginator.py\n===================================================================\n--- apiserver/plane/utils/paginator.py\t0e91fea (parent)\n+++ apiserver/plane/utils/paginator.py\tb8043f9 (commit)\n@@ -101,8 +101,9 @@\n         order_by=None,\n         max_limit=MAX_LIMIT,\n         max_offset=None,\n         on_results=None,\n+        total_count_queryset=None,\n     ):\n         # Key tuple and remove `-` if descending order by\n         self.key = (\n             order_by\n@@ -114,8 +115,9 @@\n         self.queryset = queryset\n         self.max_limit = max_limit\n         self.max_offset = max_offset\n         self.on_results = on_results\n+        self.total_count_queryset = total_count_queryset\n \n     def get_result(self, limit=1000, cursor=None):\n         # offset is page #\n         # value is page limit\n@@ -137,23 +139,33 @@\n                 \"-created_at\",\n             )\n         # The current page\n         page = cursor.offset\n-        # The offset\n-        offset = cursor.offset * cursor.value\n-        stop = offset + (cursor.value or limit) + 1\n+        # The offset - use limit instead of cursor.value for consistent pagination\n+        offset = cursor.offset * limit\n+        stop = offset + limit + 1\n \n         if self.max_offset is not None and offset >= self.max_offset:\n             raise BadPaginationError(\"Pagination offset too large\")\n         if offset < 0:\n             raise BadPaginationError(\"Pagination offset cannot be negative\")\n \n         results = queryset[offset:stop]\n-        if cursor.value != limit:\n+\n+        # Only slice from the end if we're going backwards (previous page)\n+        if cursor.value != limit and cursor.is_prev:\n             results = results[-(limit + 1) :]\n \n+        total_count = (\n+            self.total_count_queryset.count()\n+            if self.total_count_queryset\n+            else results.count()\n+        )\n+\n+        # Check if there are more results available after the current page\n+\n         # Adjust cursors based on the results for pagination\n-        next_cursor = Cursor(limit, page + 1, False, results.count() > limit)\n+        next_cursor = Cursor(limit, page + 1, False, len(results) > limit)\n         # If the page is greater than 0, then set the previous cursor\n         prev_cursor = Cursor(limit, page - 1, True, page > 0)\n \n         # Process the results\n@@ -163,9 +175,9 @@\n         if self.on_results:\n             results = self.on_results(results)\n \n         # Count the queryset\n-        count = queryset.count()\n+        count = total_count\n \n         # Optionally, calculate the total count and max_hits if needed\n         max_hits = math.ceil(count / limit)\n \n@@ -195,8 +207,9 @@\n         queryset,\n         group_by_field_name,\n         group_by_fields,\n         count_filter,\n+        total_count_queryset=None,\n         *args,\n         **kwargs,\n     ):\n         # Initiate the parent class for all the parameters\n@@ -403,8 +416,9 @@\n         sub_group_by_field_name,\n         group_by_fields,\n         sub_group_by_fields,\n         count_filter,\n+        total_count_queryset=None,\n         *args,\n         **kwargs,\n     ):\n         # Initiate the parent class for all the parameters\n@@ -693,8 +707,9 @@\n         group_by_fields=None,\n         sub_group_by_field_name=None,\n         sub_group_by_fields=None,\n         count_filter=None,\n+        total_count_queryset=None,\n         **paginator_kwargs,\n     ):\n         \"\"\"Paginate the request\"\"\"\n         per_page = self.get_per_page(request, default_per_page, max_per_page)\n@@ -718,8 +733,10 @@\n                         sub_group_by_field_name\n                     )\n                     paginator_kwargs[\"sub_group_by_fields\"] = sub_group_by_fields\n \n+            paginator_kwargs[\"total_count_queryset\"] = total_count_queryset\n+\n             paginator = paginator_cls(**paginator_kwargs)\n \n         try:\n             cursor_result = paginator.get_result(limit=per_page, cursor=input_cursor)\n"
        }
      ]
    },
    {
      "id": "refactor-notifications",
      "sha": "07e937cd8ec16fc9ce84a8535ea2f32d1b445af2",
      "parentSha": "1f1b4217352aeedd80320780efff315ec5a2f56c",
      "spec": "Implement a workspace notifications refactor and shared work-item preview typing across web and types packages.\n\n1) Shared work item preview type\n- File: packages/types/src/issues/issue.d.ts\n  - Import EIssueServiceType and EIssuesStoreType from @plane/constants.\n  - Define and export interface IWorkItemPeekOverview with optional props:\n    - embedIssue?: boolean\n    - embedRemoveCurrentNotification?: () => void\n    - is_draft?: boolean\n    - storeType?: EIssuesStoreType\n\n2) Use shared type in IssuePeekOverview\n- File: web/core/components/issues/peek-overview/root.tsx\n  - Replace the local IIssuePeekOverview interface with imported IWorkItemPeekOverview from @plane/types.\n  - Update component signature to FC<IWorkItemPeekOverview>.\n  - Do not change runtime behavior; only the type use and any imports.\n\n3) Thread serviceType through issue subscriptions\n- File: web/core/components/issues/issue-detail/subscription.tsx\n  - Extend TIssueSubscription with optional serviceType?: EIssueServiceType, defaulting to ISSUES.\n  - Call useIssueDetail(serviceType) instead of useIssueDetail().\n  - Disable the button when loading (disabled={!isEditable || loading}).\n  - Update error toast key from t(\"commons.error.message\") to t(\"common.error.message\").\n\n- File: web/core/store/issue/issue-details/root.store.ts\n  - When constructing IssueSubscriptionStore, pass serviceType: new IssueSubscriptionStore(this, serviceType).\n\n- File: web/core/store/issue/issue-details/subscription.store.ts\n  - Update constructor to accept (rootStore: IIssueDetail, serviceType: EIssueServiceType).\n  - Construct IssueService with the provided serviceType.\n\n4) Refactor workspace notifications into sidebar + content\n- Page entry\n  - File: web/app/(all)/[workspaceSlug]/(projects)/notifications/page.tsx\n    - Replace ad-hoc fetching and detail rendering with a single <NotificationsRoot workspaceSlug={workspaceSlug?.toString()} />.\n\n- Content area (main view)\n  - File: web/core/components/workspace-notifications/root.tsx\n    - Convert from the old sidebar renderer into the content panel.\n    - Imports/Dependencies:\n      - SWR: useSWR\n      - ENotificationLoader, ENotificationQueryParamType from @plane/constants\n      - cn from @plane/utils\n      - LogoSpinner, SimpleEmptyState, InboxContentRoot components\n      - Hooks: useWorkspace, useWorkspaceNotifications, useUserPermissions, useResolvedAssetPath, useWorkspaceIssueProperties, and new useNotificationPreview (from @/plane-web/hooks/use-notification-preview)\n    - Props: accept optional workspaceSlug?: string.\n    - Data flow:\n      - Use useWorkspaceIssueProperties(workspaceSlug) to prefetch workspace issue properties.\n      - Determine loader behavior based on whether there are existing notification IDs for the current workspace; fetch notifications via getNotifications with INIT or MUTATION loader and INIT or CURRENT query param.\n      - Fetch user project permission info (fetchUserProjectInfo) if the selected notification is an inbox issue.\n      - Define embedRemoveCurrentNotification to clear the selected notification via setCurrentSelectedNotificationId(undefined).\n      - Use useNotificationPreview() to obtain:\n        - isWorkItem (boolean), PeekOverviewComponent (IssuePeekOverview), setPeekWorkItem\n      - On unmount, clear preview by calling setPeekWorkItem(undefined).\n    - Rendering:\n      - If no currentSelectedNotificationId: show SimpleEmptyState with asset path \"/empty-state/intake/issue-detail\".\n      - Else, if selected notification is inbox_issue with workspace_slug/project_id/issue_id present:\n        - Show LogoSpinner while project permissions load.\n        - Otherwise, render <InboxContentRoot ... isNotificationEmbed embedRemoveCurrentNotification={...} />\n      - Else render <PeekOverviewComponent embedIssue embedRemoveCurrentNotification={...} />\n      - Wrap with a container that sets overflow-y-auto only when isWorkItem.\n\n- Sidebar area (list and filters)\n  - File: web/core/components/workspace-notifications/sidebar/root.tsx (new)\n    - Move existing sidebar list UI from the old web/core/components/workspace-notifications/root.tsx here.\n    - Keep: header row (NotificationSidebarHeader), tab switching (NOTIFICATION_TABS), unread counters, AppliedFilters, loaders, empty state, and ContentWrapper with list.\n    - Use getWorkspaceBySlug + notificationIdsByWorkspaceId to generate the list.\n    - Import NotificationListRoot from @/plane-web/components/workspace-notifications/list-root.\n    - Preserve width behavior reacting to currentSelectedNotificationId.\n\n  - File: web/core/components/workspace-notifications/sidebar/index.ts\n    - Export from \"./root\" in addition to existing exports.\n\n  - File: web/core/components/workspace-notifications/sidebar/header/root.tsx\n    - Add className=\"my-auto bg-custom-background-100\" to Header to fix header color.\n\n5) Bridge CE list component and export\n- File: web/ce/components/workspace-notifications/index.ts\n  - Export * from \"./list-root\".\n\n- File: web/ce/components/workspace-notifications/list-root.tsx (new)\n  - Create NotificationListRoot wrapper that forwards props to NotificationCardListRoot, with props:\n    - workspaceSlug: string\n    - workspaceId: string\n\n6) Notification preview hook (CE)\n- File: web/ce/hooks/use-notification-preview.tsx (new)\n  - Implement hook returning:\n    - isWorkItem: boolean (true if useIssueDetail(EIssueServiceType.ISSUES).peekIssue is truthy)\n    - PeekOverviewComponent: IssuePeekOverview\n    - setPeekWorkItem: setPeekIssue from useIssueDetail(EIssueServiceType.ISSUES)\n  - Type the component as React.ComponentType<IWorkItemPeekOverview>.\n\n7) Import alignment\n- In files where relevant (e.g., new content root), use cn from @plane/utils instead of local helpers.\n- Ensure imports for EIssueServiceType and IWorkItemPeekOverview line up with the updates above.\n\nObservable outcomes to validate\n- Navigating to the workspace notifications route shows a sidebar (list with filters/tabs) and a content area.\n- Clicking a notification that references a non-inbox work item opens an IssuePeekOverview in the content area; clicking inbox notifications mounts InboxContentRoot.\n- The empty state is shown when nothing is selected.\n- Subscribing/unsubscribing from an issue works across service types (issues/epics/work-items) and the button disables while loading.\n- IssuePeekOverview props are typed via the shared interface in @plane/types.\n- Header background in the notifications sidebar is corrected.",
      "prompt": "Refactor the workspace notifications experience into a two-pane layout with a sidebar for the list and a content area for the preview. Introduce a shared props type for the work-item peek component, and make issue notification subscriptions work across different work item service types.\n\nSpecifically, create a sidebar component for notifications with tabs, filters, counts, pagination and empty state; and a content component that shows either an inbox issue view or a work-item peek depending on the selected notification. Update the notifications page to render the new content root. Centralize the work-item peek props in the shared types package and switch the peek component to use them. Ensure the subscription UI in issue detail threads the appropriate service type to the underlying APIs and disables its button while loading. Keep imports consistent with project conventions.\n\nAim for no behavioral regressions and ensure empty states, loading states, and permission checks still work.",
      "supplementalFiles": [
        "web/core/services/issue/issue.service.ts",
        "web/core/components/workspace-notifications/sidebar/notification-card/item.tsx",
        "web/ce/components/workspace-notifications/notification-card/root.tsx",
        "web/core/hooks/use-workspace-issue-properties.ts",
        "packages/constants/src/index.ts",
        "web/core/hooks/store/index.ts"
      ],
      "fileDiffs": [
        {
          "path": "packages/types/src/issues/issue.d.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/issues/issue.d.ts\n===================================================================\n--- packages/types/src/issues/issue.d.ts\t1f1b421 (parent)\n+++ packages/types/src/issues/issue.d.ts\t07e937c (commit)\n@@ -1,5 +1,5 @@\n-import { EIssueServiceType } from \"@plane/constants\";\n+import { EIssueServiceType, EIssuesStoreType } from \"@plane/constants\";\n import { TIssuePriorities } from \"../issues\";\n import { TIssueAttachment } from \"./issue_attachment\";\n import { TIssueLink } from \"./issue_link\";\n import { TIssueReaction, IIssuePublicReaction, IPublicVote } from \"./issue_reaction\";\n@@ -180,4 +180,11 @@\n   total_pages: number;\n   extra_stats: null;\n   results: TPublicIssueResponseResults;\n };\n+\n+export interface IWorkItemPeekOverview {\n+  embedIssue?: boolean;\n+  embedRemoveCurrentNotification?: () => void;\n+  is_draft?: boolean;\n+  storeType?: EIssuesStoreType;\n+}\n\\ No newline at end of file\n"
        },
        {
          "path": "web/app/(all)/[workspaceSlug]/(projects)/notifications/page.tsx",
          "status": "modified",
          "diff": "Index: web/app/(all)/[workspaceSlug]/(projects)/notifications/page.tsx\n===================================================================\n--- web/app/(all)/[workspaceSlug]/(projects)/notifications/page.tsx\t1f1b421 (parent)\n+++ web/app/(all)/[workspaceSlug]/(projects)/notifications/page.tsx\t07e937c (commit)\n@@ -1,122 +1,31 @@\n \"use client\";\n \n-import { useCallback, useEffect } from \"react\";\n import { observer } from \"mobx-react\";\n import { useParams } from \"next/navigation\";\n-import useSWR from \"swr\";\n // plane imports\n-import { ENotificationLoader, ENotificationQueryParamType } from \"@plane/constants\";\n import { useTranslation } from \"@plane/i18n\";\n // components\n-import { LogoSpinner } from \"@/components/common\";\n import { PageHead } from \"@/components/core\";\n-import { SimpleEmptyState } from \"@/components/empty-state\";\n-import { InboxContentRoot } from \"@/components/inbox\";\n-import { IssuePeekOverview } from \"@/components/issues\";\n+import { NotificationsRoot } from \"@/components/workspace-notifications\";\n // hooks\n-import { useIssueDetail, useUserPermissions, useWorkspace, useWorkspaceNotifications } from \"@/hooks/store\";\n-import { useResolvedAssetPath } from \"@/hooks/use-resolved-asset-path\";\n-import { useWorkspaceIssueProperties } from \"@/hooks/use-workspace-issue-properties\";\n+import { useWorkspace } from \"@/hooks/store\";\n \n const WorkspaceDashboardPage = observer(() => {\n   const { workspaceSlug } = useParams();\n   // plane hooks\n   const { t } = useTranslation();\n   // hooks\n   const { currentWorkspace } = useWorkspace();\n-  const {\n-    currentSelectedNotificationId,\n-    setCurrentSelectedNotificationId,\n-    notificationLiteByNotificationId,\n-    notificationIdsByWorkspaceId,\n-    getNotifications,\n-  } = useWorkspaceNotifications();\n-  const { fetchUserProjectInfo } = useUserPermissions();\n-  const { setPeekIssue } = useIssueDetail();\n   // derived values\n   const pageTitle = currentWorkspace?.name\n     ? t(\"notification.page_label\", { workspace: currentWorkspace?.name })\n     : undefined;\n-  const { workspace_slug, project_id, issue_id, is_inbox_issue } =\n-    notificationLiteByNotificationId(currentSelectedNotificationId);\n-  const resolvedPath = useResolvedAssetPath({ basePath: \"/empty-state/intake/issue-detail\" });\n \n-  // fetching workspace work item properties\n-  useWorkspaceIssueProperties(workspaceSlug);\n-\n-  // fetch workspace notifications\n-  const notificationMutation =\n-    currentWorkspace && notificationIdsByWorkspaceId(currentWorkspace.id)\n-      ? ENotificationLoader.MUTATION_LOADER\n-      : ENotificationLoader.INIT_LOADER;\n-  const notificationLoader =\n-    currentWorkspace && notificationIdsByWorkspaceId(currentWorkspace.id)\n-      ? ENotificationQueryParamType.CURRENT\n-      : ENotificationQueryParamType.INIT;\n-  useSWR(\n-    currentWorkspace?.slug ? `WORKSPACE_NOTIFICATION` : null,\n-    currentWorkspace?.slug\n-      ? () => getNotifications(currentWorkspace?.slug, notificationMutation, notificationLoader)\n-      : null\n-  );\n-\n-  // fetching user project member info\n-  const { isLoading: projectMemberInfoLoader } = useSWR(\n-    workspace_slug && project_id && is_inbox_issue\n-      ? `PROJECT_MEMBER_PERMISSION_INFO_${workspace_slug}_${project_id}`\n-      : null,\n-    workspace_slug && project_id && is_inbox_issue ? () => fetchUserProjectInfo(workspace_slug, project_id) : null\n-  );\n-\n-  const embedRemoveCurrentNotification = useCallback(\n-    () => setCurrentSelectedNotificationId(undefined),\n-    [setCurrentSelectedNotificationId]\n-  );\n-\n-  // clearing up the selected notifications when unmounting the page\n-  useEffect(\n-    () => () => {\n-      setCurrentSelectedNotificationId(undefined);\n-      setPeekIssue(undefined);\n-    },\n-    [setCurrentSelectedNotificationId, setPeekIssue]\n-  );\n-\n   return (\n     <>\n       <PageHead title={pageTitle} />\n-      <div className=\"w-full h-full overflow-hidden overflow-y-auto\">\n-        {!currentSelectedNotificationId ? (\n-          <div className=\"w-full h-screen flex justify-center items-center\">\n-            <SimpleEmptyState title={t(\"notification.empty_state.detail.title\")} assetPath={resolvedPath} />\n-          </div>\n-        ) : (\n-          <>\n-            {is_inbox_issue === true && workspace_slug && project_id && issue_id ? (\n-              <>\n-                {projectMemberInfoLoader ? (\n-                  <div className=\"w-full h-full flex justify-center items-center\">\n-                    <LogoSpinner />\n-                  </div>\n-                ) : (\n-                  <InboxContentRoot\n-                    setIsMobileSidebar={() => {}}\n-                    isMobileSidebar={false}\n-                    workspaceSlug={workspace_slug}\n-                    projectId={project_id}\n-                    inboxIssueId={issue_id}\n-                    isNotificationEmbed\n-                    embedRemoveCurrentNotification={embedRemoveCurrentNotification}\n-                  />\n-                )}\n-              </>\n-            ) : (\n-              <IssuePeekOverview embedIssue embedRemoveCurrentNotification={embedRemoveCurrentNotification} />\n-            )}\n-          </>\n-        )}\n-      </div>\n+      <NotificationsRoot workspaceSlug={workspaceSlug?.toString()} />\n     </>\n   );\n });\n \n"
        },
        {
          "path": "web/ce/components/workspace-notifications/index.ts",
          "status": "modified",
          "diff": "Index: web/ce/components/workspace-notifications/index.ts\n===================================================================\n--- web/ce/components/workspace-notifications/index.ts\t1f1b421 (parent)\n+++ web/ce/components/workspace-notifications/index.ts\t07e937c (commit)\n@@ -1,1 +1,2 @@\n export * from \"./notification-card/root\";\n+export * from \"./list-root\";\n"
        },
        {
          "path": "web/ce/components/workspace-notifications/list-root.tsx",
          "status": "added",
          "diff": "Index: web/ce/components/workspace-notifications/list-root.tsx\n===================================================================\n--- web/ce/components/workspace-notifications/list-root.tsx\t1f1b421 (parent)\n+++ web/ce/components/workspace-notifications/list-root.tsx\t07e937c (commit)\n@@ -0,0 +1,8 @@\n+import { NotificationCardListRoot } from \"./notification-card/root\";\n+\n+export type TNotificationListRoot = {\n+  workspaceSlug: string;\n+  workspaceId: string;\n+};\n+\n+export const NotificationListRoot = (props: TNotificationListRoot) => <NotificationCardListRoot {...props} />;\n"
        },
        {
          "path": "web/ce/hooks/use-notification-preview.tsx",
          "status": "added",
          "diff": "Index: web/ce/hooks/use-notification-preview.tsx\n===================================================================\n--- web/ce/hooks/use-notification-preview.tsx\t1f1b421 (parent)\n+++ web/ce/hooks/use-notification-preview.tsx\t07e937c (commit)\n@@ -0,0 +1,25 @@\n+import { EIssueServiceType } from \"@plane/constants\";\n+import { IWorkItemPeekOverview } from \"@plane/types\";\n+import { IssuePeekOverview } from \"@/components/issues\";\n+import { useIssueDetail } from \"@/hooks/store\";\n+import { TPeekIssue } from \"@/store/issue/issue-details/root.store\";\n+\n+export type TNotificationPreview = {\n+  isWorkItem: boolean;\n+  PeekOverviewComponent: React.ComponentType<IWorkItemPeekOverview>;\n+  setPeekWorkItem: (peekIssue: TPeekIssue | undefined) => void;\n+};\n+\n+/**\n+ * This function returns if the current active notification is related to work item or an epic.\n+ * @returns isWorkItem: boolean, peekOverviewComponent: IWorkItemPeekOverview, setPeekWorkItem\n+ */\n+export const useNotificationPreview = (): TNotificationPreview => {\n+  const { peekIssue, setPeekIssue } = useIssueDetail(EIssueServiceType.ISSUES);\n+\n+  return {\n+    isWorkItem: Boolean(peekIssue),\n+    PeekOverviewComponent: IssuePeekOverview,\n+    setPeekWorkItem: setPeekIssue,\n+  };\n+};\n"
        },
        {
          "path": "web/core/components/issues/issue-detail/subscription.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-detail/subscription.tsx\n===================================================================\n--- web/core/components/issues/issue-detail/subscription.tsx\t1f1b421 (parent)\n+++ web/core/components/issues/issue-detail/subscription.tsx\t07e937c (commit)\n@@ -4,9 +4,9 @@\n import isNil from \"lodash/isNil\";\n import { observer } from \"mobx-react\";\n import { Bell, BellOff } from \"lucide-react\";\n // plane-i18n\n-import { EUserPermissions, EUserPermissionsLevel } from \"@plane/constants\";\n+import { EUserPermissions, EUserPermissionsLevel, EIssueServiceType } from \"@plane/constants\";\n import { useTranslation } from \"@plane/i18n\";\n // UI\n import { Button, Loader, TOAST_TYPE, setToast } from \"@plane/ui\";\n // hooks\n@@ -15,19 +15,20 @@\n export type TIssueSubscription = {\n   workspaceSlug: string;\n   projectId: string;\n   issueId: string;\n+  serviceType?: EIssueServiceType;\n };\n \n export const IssueSubscription: FC<TIssueSubscription> = observer((props) => {\n-  const { workspaceSlug, projectId, issueId } = props;\n+  const { workspaceSlug, projectId, issueId, serviceType = EIssueServiceType.ISSUES } = props;\n   const { t } = useTranslation();\n   // hooks\n   const {\n     subscription: { getSubscriptionByIssueId },\n     createSubscription,\n     removeSubscription,\n-  } = useIssueDetail();\n+  } = useIssueDetail(serviceType);\n   // state\n   const [loading, setLoading] = useState(false);\n   // hooks\n   const { allowPermissions } = useUserPermissions();\n@@ -52,14 +53,14 @@\n           ? t(\"issue.subscription.actions.unsubscribed\")\n           : t(\"issue.subscription.actions.subscribed\"),\n       });\n       setLoading(false);\n-    } catch (error) {\n+    } catch {\n       setLoading(false);\n       setToast({\n         type: TOAST_TYPE.ERROR,\n         title: t(\"toast.error\"),\n-        message: t(\"commons.error.message\"),\n+        message: t(\"common.error.message\"),\n       });\n     }\n   };\n \n@@ -77,9 +78,9 @@\n         prependIcon={isSubscribed ? <BellOff /> : <Bell className=\"h-3 w-3\" />}\n         variant=\"outline-primary\"\n         className=\"hover:!bg-custom-primary-100/20\"\n         onClick={handleSubscription}\n-        disabled={!isEditable}\n+        disabled={!isEditable || loading}\n       >\n         {loading ? (\n           <span>\n             <span className=\"hidden sm:block\">{t(\"common.loading\")}</span>\n"
        },
        {
          "path": "web/core/components/issues/peek-overview/root.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/peek-overview/root.tsx\n===================================================================\n--- web/core/components/issues/peek-overview/root.tsx\t1f1b421 (parent)\n+++ web/core/components/issues/peek-overview/root.tsx\t07e937c (commit)\n@@ -13,9 +13,9 @@\n   EUserPermissions,\n   EUserPermissionsLevel,\n } from \"@plane/constants\";\n import { useTranslation } from \"@plane/i18n\";\n-import { TIssue } from \"@plane/types\";\n+import { TIssue, IWorkItemPeekOverview } from \"@plane/types\";\n // plane ui\n import { TOAST_TYPE, setPromiseToast, setToast } from \"@plane/ui\";\n // components\n import { IssueView, TIssueOperations } from \"@/components/issues\";\n@@ -23,16 +23,10 @@\n // hooks\n import { useEventTracker, useIssueDetail, useIssues, useUserPermissions } from \"@/hooks/store\";\n import { useIssueStoreType } from \"@/hooks/use-issue-layout-store\";\n \n-interface IIssuePeekOverview {\n-  embedIssue?: boolean;\n-  embedRemoveCurrentNotification?: () => void;\n-  is_draft?: boolean;\n-  storeType?: EIssuesStoreType;\n-}\n \n-export const IssuePeekOverview: FC<IIssuePeekOverview> = observer((props) => {\n+export const IssuePeekOverview: FC<IWorkItemPeekOverview> = observer((props) => {\n   const {\n     embedIssue = false,\n     embedRemoveCurrentNotification,\n     is_draft = false,\n"
        },
        {
          "path": "web/core/components/workspace-notifications/root.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/workspace-notifications/root.tsx\n===================================================================\n--- web/core/components/workspace-notifications/root.tsx\t1f1b421 (parent)\n+++ web/core/components/workspace-notifications/root.tsx\t07e937c (commit)\n@@ -1,116 +1,116 @@\n \"use client\";\n \n-import { FC, useCallback } from \"react\";\n+import { useCallback, useEffect } from \"react\";\n import { observer } from \"mobx-react\";\n-import { useParams } from \"next/navigation\";\n+import useSWR from \"swr\";\n // plane imports\n-import { NOTIFICATION_TABS, TNotificationTab } from \"@plane/constants\";\n+import { ENotificationLoader, ENotificationQueryParamType } from \"@plane/constants\";\n import { useTranslation } from \"@plane/i18n\";\n // components\n-import { Header, Row, ERowVariant, EHeaderVariant, ContentWrapper } from \"@plane/ui\";\n-import { CountChip } from \"@/components/common\";\n-import {\n-  NotificationsLoader,\n-  NotificationEmptyState,\n-  NotificationSidebarHeader,\n-  AppliedFilters,\n-} from \"@/components/workspace-notifications\";\n-// helpers\n-import { cn } from \"@/helpers/common.helper\";\n-import { getNumberCount } from \"@/helpers/string.helper\";\n+import { cn } from \"@plane/utils\";\n+import { LogoSpinner } from \"@/components/common\";\n+import { SimpleEmptyState } from \"@/components/empty-state\";\n+import { InboxContentRoot } from \"@/components/inbox\";\n // hooks\n-import { useWorkspace, useWorkspaceNotifications } from \"@/hooks/store\";\n-import { NotificationCardListRoot } from \"@/plane-web/components/workspace-notifications\";\n-export const NotificationsSidebarRoot: FC = observer(() => {\n-  const { workspaceSlug } = useParams();\n+import { useUserPermissions, useWorkspace, useWorkspaceNotifications } from \"@/hooks/store\";\n+import { useResolvedAssetPath } from \"@/hooks/use-resolved-asset-path\";\n+import { useWorkspaceIssueProperties } from \"@/hooks/use-workspace-issue-properties\";\n+import { useNotificationPreview } from \"@/plane-web/hooks/use-notification-preview\";\n+\n+type NotificationsRootProps = {\n+  workspaceSlug?: string;\n+};\n+\n+export const NotificationsRoot = observer(({ workspaceSlug }: NotificationsRootProps) => {\n+  // plane hooks\n+  const { t } = useTranslation();\n   // hooks\n-  const { getWorkspaceBySlug } = useWorkspace();\n+  const { currentWorkspace } = useWorkspace();\n   const {\n     currentSelectedNotificationId,\n-    unreadNotificationsCount,\n-    loader,\n+    setCurrentSelectedNotificationId,\n+    notificationLiteByNotificationId,\n     notificationIdsByWorkspaceId,\n-    currentNotificationTab,\n-    setCurrentNotificationTab,\n+    getNotifications,\n   } = useWorkspaceNotifications();\n-\n-  const { t } = useTranslation();\n+  const { fetchUserProjectInfo } = useUserPermissions();\n+  const { isWorkItem, PeekOverviewComponent, setPeekWorkItem } = useNotificationPreview();\n   // derived values\n-  const workspace = workspaceSlug ? getWorkspaceBySlug(workspaceSlug.toString()) : undefined;\n-  const notificationIds = workspace ? notificationIdsByWorkspaceId(workspace.id) : undefined;\n+  const { workspace_slug, project_id, issue_id, is_inbox_issue } =\n+    notificationLiteByNotificationId(currentSelectedNotificationId);\n+  const resolvedPath = useResolvedAssetPath({ basePath: \"/empty-state/intake/issue-detail\" });\n \n-  const handleTabClick = useCallback(\n-    (tabValue: TNotificationTab) => {\n-      if (currentNotificationTab !== tabValue) {\n-        setCurrentNotificationTab(tabValue);\n-      }\n-    },\n-    [currentNotificationTab, setCurrentNotificationTab]\n+  // fetching workspace work item properties\n+  useWorkspaceIssueProperties(workspaceSlug);\n+\n+  // fetch workspace notifications\n+  const notificationMutation =\n+    currentWorkspace && notificationIdsByWorkspaceId(currentWorkspace.id)\n+      ? ENotificationLoader.MUTATION_LOADER\n+      : ENotificationLoader.INIT_LOADER;\n+  const notificationLoader =\n+    currentWorkspace && notificationIdsByWorkspaceId(currentWorkspace.id)\n+      ? ENotificationQueryParamType.CURRENT\n+      : ENotificationQueryParamType.INIT;\n+  useSWR(\n+    currentWorkspace?.slug ? `WORKSPACE_NOTIFICATION_${currentWorkspace?.slug}` : null,\n+    currentWorkspace?.slug\n+      ? () => getNotifications(currentWorkspace?.slug, notificationMutation, notificationLoader)\n+      : null\n   );\n \n-  if (!workspaceSlug || !workspace) return <></>;\n+  // fetching user project member info\n+  const { isLoading: projectMemberInfoLoader } = useSWR(\n+    workspace_slug && project_id && is_inbox_issue\n+      ? `PROJECT_MEMBER_PERMISSION_INFO_${workspace_slug}_${project_id}`\n+      : null,\n+    workspace_slug && project_id && is_inbox_issue ? () => fetchUserProjectInfo(workspace_slug, project_id) : null\n+  );\n \n-  return (\n-    <div\n-      className={cn(\n-        \"relative border-0 md:border-r border-custom-border-200 z-[10] flex-shrink-0 bg-custom-background-100 h-full transition-all overflow-hidden\",\n-        currentSelectedNotificationId ? \"w-0 md:w-2/6\" : \"w-full md:w-2/6\"\n-      )}\n-    >\n-      <div className=\"relative w-full h-full overflow-hidden flex flex-col\">\n-        <Row className=\"h-[3.75rem] border-b border-custom-border-200 flex\">\n-          <NotificationSidebarHeader workspaceSlug={workspaceSlug.toString()} />\n-        </Row>\n+  const embedRemoveCurrentNotification = useCallback(\n+    () => setCurrentSelectedNotificationId(undefined),\n+    [setCurrentSelectedNotificationId]\n+  );\n \n-        <Header variant={EHeaderVariant.SECONDARY} className=\"justify-start\">\n-          {NOTIFICATION_TABS.map((tab) => (\n-            <div\n-              key={tab.value}\n-              className=\"h-full px-3 relative cursor-pointer\"\n-              onClick={() => handleTabClick(tab.value)}\n-            >\n-              <div\n-                className={cn(\n-                  `relative h-full flex justify-center items-center gap-1 text-sm transition-all`,\n-                  currentNotificationTab === tab.value\n-                    ? \"text-custom-primary-100\"\n-                    : \"text-custom-text-100 hover:text-custom-text-200\"\n-                )}\n-              >\n-                <div className=\"font-medium\">{t(tab.i18n_label)}</div>\n-                {tab.count(unreadNotificationsCount) > 0 && (\n-                  <CountChip count={getNumberCount(tab.count(unreadNotificationsCount))} />\n-                )}\n-              </div>\n-              {currentNotificationTab === tab.value && (\n-                <div className=\"border absolute bottom-0 right-0 left-0 rounded-t-md border-custom-primary-100\" />\n-              )}\n-            </div>\n-          ))}\n-        </Header>\n+  // clearing up the selected notifications when unmounting the page\n+  useEffect(\n+    () => () => {\n+      setPeekWorkItem(undefined);\n+    },\n+    [setCurrentSelectedNotificationId, setPeekWorkItem]\n+  );\n \n-        {/* applied filters */}\n-        <AppliedFilters workspaceSlug={workspaceSlug.toString()} />\n-\n-        {/* rendering notifications */}\n-        {loader === \"init-loader\" ? (\n-          <div className=\"relative w-full h-full overflow-hidden\">\n-            <NotificationsLoader />\n-          </div>\n-        ) : (\n-          <>\n-            {notificationIds && notificationIds.length > 0 ? (\n-              <ContentWrapper variant={ERowVariant.HUGGING}>\n-                <NotificationCardListRoot workspaceSlug={workspaceSlug.toString()} workspaceId={workspace?.id} />\n-              </ContentWrapper>\n-            ) : (\n-              <div className=\"relative w-full h-full flex justify-center items-center\">\n-                <NotificationEmptyState />\n-              </div>\n-            )}\n-          </>\n-        )}\n-      </div>\n+  return (\n+    <div className={cn(\"w-full h-full overflow-hidden \", isWorkItem && \"overflow-y-auto\")}>\n+      {!currentSelectedNotificationId ? (\n+        <div className=\"w-full h-screen flex justify-center items-center\">\n+          <SimpleEmptyState title={t(\"notification.empty_state.detail.title\")} assetPath={resolvedPath} />\n+        </div>\n+      ) : (\n+        <>\n+          {is_inbox_issue === true && workspace_slug && project_id && issue_id ? (\n+            <>\n+              {projectMemberInfoLoader ? (\n+                <div className=\"w-full h-full flex justify-center items-center\">\n+                  <LogoSpinner />\n+                </div>\n+              ) : (\n+                <InboxContentRoot\n+                  setIsMobileSidebar={() => {}}\n+                  isMobileSidebar={false}\n+                  workspaceSlug={workspace_slug}\n+                  projectId={project_id}\n+                  inboxIssueId={issue_id}\n+                  isNotificationEmbed\n+                  embedRemoveCurrentNotification={embedRemoveCurrentNotification}\n+                />\n+              )}\n+            </>\n+          ) : (\n+            <PeekOverviewComponent embedIssue embedRemoveCurrentNotification={embedRemoveCurrentNotification} />\n+          )}\n+        </>\n+      )}\n     </div>\n   );\n });\n"
        },
        {
          "path": "web/core/components/workspace-notifications/sidebar/header/root.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/workspace-notifications/sidebar/header/root.tsx\n===================================================================\n--- web/core/components/workspace-notifications/sidebar/header/root.tsx\t1f1b421 (parent)\n+++ web/core/components/workspace-notifications/sidebar/header/root.tsx\t07e937c (commit)\n@@ -19,9 +19,9 @@\n   const { t } = useTranslation();\n \n   if (!workspaceSlug) return <></>;\n   return (\n-    <Header className=\"my-auto\">\n+    <Header className=\"my-auto bg-custom-background-100\">\n       <Header.LeftItem>\n         <div className=\"block bg-custom-sidebar-background-100 md:hidden\">\n           <SidebarHamburgerToggle />\n         </div>\n"
        },
        {
          "path": "web/core/components/workspace-notifications/sidebar/index.ts",
          "status": "modified",
          "diff": "Index: web/core/components/workspace-notifications/sidebar/index.ts\n===================================================================\n--- web/core/components/workspace-notifications/sidebar/index.ts\t1f1b421 (parent)\n+++ web/core/components/workspace-notifications/sidebar/index.ts\t07e937c (commit)\n@@ -5,4 +5,6 @@\n \n export * from \"./filters\";\n \n export * from \"./notification-card\";\n+\n+export * from \"./root\";\n"
        },
        {
          "path": "web/core/components/workspace-notifications/sidebar/root.tsx",
          "status": "added",
          "diff": "Index: web/core/components/workspace-notifications/sidebar/root.tsx\n===================================================================\n--- web/core/components/workspace-notifications/sidebar/root.tsx\t1f1b421 (parent)\n+++ web/core/components/workspace-notifications/sidebar/root.tsx\t07e937c (commit)\n@@ -0,0 +1,118 @@\n+\"use client\";\n+import { FC, useCallback } from \"react\";\n+\n+import { observer } from \"mobx-react\";\n+import { useParams } from \"next/navigation\";\n+// plane imports\n+import { NOTIFICATION_TABS, TNotificationTab } from \"@plane/constants\";\n+import { useTranslation } from \"@plane/i18n\";\n+// components\n+import { Header, Row, ERowVariant, EHeaderVariant, ContentWrapper } from \"@plane/ui\";\n+import { CountChip } from \"@/components/common\";\n+import {\n+  NotificationsLoader,\n+  NotificationEmptyState,\n+  NotificationSidebarHeader,\n+  AppliedFilters,\n+} from \"@/components/workspace-notifications\";\n+// helpers\n+import { cn } from \"@/helpers/common.helper\";\n+import { getNumberCount } from \"@/helpers/string.helper\";\n+// hooks\n+import { useWorkspace, useWorkspaceNotifications } from \"@/hooks/store\";\n+\n+import { NotificationListRoot } from \"@/plane-web/components/workspace-notifications/list-root\";\n+\n+export const NotificationsSidebarRoot: FC = observer(() => {\n+  const { workspaceSlug } = useParams();\n+  // hooks\n+  const { getWorkspaceBySlug } = useWorkspace();\n+  const {\n+    currentSelectedNotificationId,\n+    unreadNotificationsCount,\n+    loader,\n+    notificationIdsByWorkspaceId,\n+    currentNotificationTab,\n+    setCurrentNotificationTab,\n+  } = useWorkspaceNotifications();\n+\n+  const { t } = useTranslation();\n+  // derived values\n+  const workspace = workspaceSlug ? getWorkspaceBySlug(workspaceSlug.toString()) : undefined;\n+  const notificationIds = workspace ? notificationIdsByWorkspaceId(workspace.id) : undefined;\n+\n+  const handleTabClick = useCallback(\n+    (tabValue: TNotificationTab) => {\n+      if (currentNotificationTab !== tabValue) {\n+        setCurrentNotificationTab(tabValue);\n+      }\n+    },\n+    [currentNotificationTab, setCurrentNotificationTab]\n+  );\n+\n+  if (!workspaceSlug || !workspace) return <></>;\n+\n+  return (\n+    <div\n+      className={cn(\n+        \"relative border-0 md:border-r border-custom-border-200 z-[10] flex-shrink-0 bg-custom-background-100 h-full transition-all max-md:overflow-hidden\",\n+        currentSelectedNotificationId ? \"w-0 md:w-2/6\" : \"w-full md:w-2/6\"\n+      )}\n+    >\n+      <div className=\"relative w-full h-full flex flex-col\">\n+        <Row className=\"h-[3.75rem] border-b border-custom-border-200 flex\">\n+          <NotificationSidebarHeader workspaceSlug={workspaceSlug.toString()} />\n+        </Row>\n+\n+        <Header variant={EHeaderVariant.SECONDARY} className=\"justify-start\">\n+          {NOTIFICATION_TABS.map((tab) => (\n+            <div\n+              key={tab.value}\n+              className=\"h-full px-3 relative cursor-pointer\"\n+              onClick={() => handleTabClick(tab.value)}\n+            >\n+              <div\n+                className={cn(\n+                  `relative h-full flex justify-center items-center gap-1 text-sm transition-all`,\n+                  currentNotificationTab === tab.value\n+                    ? \"text-custom-primary-100\"\n+                    : \"text-custom-text-100 hover:text-custom-text-200\"\n+                )}\n+              >\n+                <div className=\"font-medium\">{t(tab.i18n_label)}</div>\n+                {tab.count(unreadNotificationsCount) > 0 && (\n+                  <CountChip count={getNumberCount(tab.count(unreadNotificationsCount))} />\n+                )}\n+              </div>\n+              {currentNotificationTab === tab.value && (\n+                <div className=\"border absolute bottom-0 right-0 left-0 rounded-t-md border-custom-primary-100\" />\n+              )}\n+            </div>\n+          ))}\n+        </Header>\n+\n+        {/* applied filters */}\n+        <AppliedFilters workspaceSlug={workspaceSlug.toString()} />\n+\n+        {/* rendering notifications */}\n+        {loader === \"init-loader\" ? (\n+          <div className=\"relative w-full h-full overflow-hidden\">\n+            <NotificationsLoader />\n+          </div>\n+        ) : (\n+          <>\n+            {notificationIds && notificationIds.length > 0 ? (\n+              <ContentWrapper variant={ERowVariant.HUGGING}>\n+                <NotificationListRoot workspaceSlug={workspaceSlug.toString()} workspaceId={workspace?.id} />\n+              </ContentWrapper>\n+            ) : (\n+              <div className=\"relative w-full h-full flex justify-center items-center\">\n+                <NotificationEmptyState />\n+              </div>\n+            )}\n+          </>\n+        )}\n+      </div>\n+    </div>\n+  );\n+});\n"
        },
        {
          "path": "web/core/store/issue/issue-details/root.store.ts",
          "status": "modified",
          "diff": "Index: web/core/store/issue/issue-details/root.store.ts\n===================================================================\n--- web/core/store/issue/issue-details/root.store.ts\t1f1b421 (parent)\n+++ web/core/store/issue/issue-details/root.store.ts\t07e937c (commit)\n@@ -203,9 +203,9 @@\n     this.comment = new IssueCommentStore(this, serviceType);\n     this.commentReaction = new IssueCommentReactionStore(this);\n     this.subIssues = new IssueSubIssuesStore(this, serviceType);\n     this.link = new IssueLinkStore(this, serviceType);\n-    this.subscription = new IssueSubscriptionStore(this);\n+    this.subscription = new IssueSubscriptionStore(this, serviceType);\n     this.relation = new IssueRelationStore(this);\n   }\n \n   // computed\n"
        },
        {
          "path": "web/core/store/issue/issue-details/subscription.store.ts",
          "status": "modified",
          "diff": "Index: web/core/store/issue/issue-details/subscription.store.ts\n===================================================================\n--- web/core/store/issue/issue-details/subscription.store.ts\t1f1b421 (parent)\n+++ web/core/store/issue/issue-details/subscription.store.ts\t07e937c (commit)\n@@ -1,11 +1,11 @@\n import set from \"lodash/set\";\n import { action, makeObservable, observable, runInAction } from \"mobx\";\n // services\n+import { EIssueServiceType } from \"@plane/constants\";\n import { IssueService } from \"@/services/issue/issue.service\";\n // types\n import { IIssueDetail } from \"./root.store\";\n-\n export interface IIssueSubscriptionStoreActions {\n   addSubscription: (issueId: string, isSubscribed: boolean | undefined | null) => void;\n   fetchSubscriptions: (workspaceSlug: string, projectId: string, issueId: string) => Promise<boolean>;\n   createSubscription: (workspaceSlug: string, projectId: string, issueId: string) => Promise<void>;\n@@ -26,9 +26,9 @@\n   rootIssueDetail: IIssueDetail;\n   // services\n   issueService;\n \n-  constructor(rootStore: IIssueDetail) {\n+  constructor(rootStore: IIssueDetail, serviceType: EIssueServiceType) {\n     makeObservable(this, {\n       // observables\n       subscriptionMap: observable,\n       // actions\n@@ -39,9 +39,9 @@\n     });\n     // root store\n     this.rootIssueDetail = rootStore;\n     // services\n-    this.issueService = new IssueService();\n+    this.issueService = new IssueService(serviceType);\n   }\n \n   // helper methods\n   getSubscriptionByIssueId = (issueId: string) => {\n"
        }
      ]
    },
    {
      "id": "refactor-image-extension",
      "sha": "c1fa372c8403e340c3bfee6ea25d70fd46fbab56",
      "parentSha": "7045a1f2af11b1fc89d0ab87671a2312c37d7b5c",
      "spec": "Implement a refactor of the image and custom-image TipTap extensions in the editor package to decouple configuration from behavior, unify editable/read-only variants, and migrate component/node-view logic to use extension-provided options instead of editor.commands.\n\nScope and required changes:\n\n1) Introduce typed config and utils for custom-image\n- Create packages/editor/src/core/extensions/custom-image/types.ts with:\n  - ECustomImageAttributeNames enum for id, width, height, aspectRatio, src\n  - Pixel, PixelAttribute, TCustomImageSize, TCustomImageAttributes\n  - UploadEntity, InsertImageComponentProps types\n  - CustomImageExtensionOptions with getImageSource, restoreImage, optional uploadImage\n  - CustomImageExtensionStorage (fileMap, deletedImageSet, maxFileSize)\n  - CustomImageExtension type alias for the node\n- Create packages/editor/src/core/extensions/custom-image/utils.ts with:\n  - DEFAULT_CUSTOM_IMAGE_ATTRIBUTES mapping for defaults\n  - getImageComponentImageFileMap(editor) using getExtensionStorage(editor, CORE_EXTENSIONS.CUSTOM_IMAGE)\n  - ensurePixelString utility\n\n2) Split custom-image extension into config and behavior\n- Add packages/editor/src/core/extensions/custom-image/extension-config.ts defining the base node (name imageComponent) with:\n  - addAttributes via ECustomImageAttributeNames and DEFAULT_CUSTOM_IMAGE_ATTRIBUTES\n  - parseHTML for <image-component>\n  - renderHTML returning image-component tag with merged attributes\n  - No editable/read-only logic here\n- Add packages/editor/src/core/extensions/custom-image/extension.ts exporting CustomImageExtension(props) with:\n  - Props: { fileHandler: TFileHandler | TReadOnlyFileHandler; isEditable: boolean }\n  - Extend CustomImageExtensionConfig and wire:\n    - selectable/draggable based on isEditable\n    - addOptions: expose getImageSource, restoreImage, and optional uploadImage from fileHandler\n    - addStorage: include fileMap, deletedImageSet, maxFileSize (if present on fileHandler)\n    - addCommands: insertImageComponent only (generate UUID id, validate file via ACCEPTED_IMAGE_MIME_TYPES, populate fileMap for insert/drop, insert node with id at pos or selection)\n    - addKeyboardShortcuts ArrowUp/ArrowDown to insert empty paragraph at node boundaries\n    - addNodeView to use the new CustomImageNodeView\n- Delete old custom-image variant files:\n  - packages/editor/src/core/extensions/custom-image/custom-image.ts\n  - packages/editor/src/core/extensions/custom-image/read-only-custom-image.ts\n  - packages/editor/src/core/extensions/custom-image/components/index.ts (adjust imports elsewhere accordingly)\n\n3) Update custom image node view and components\n- Rename components:\n  - components/image-node.tsx -> components/node-view.tsx\n  - components/image-block.tsx -> components/block.tsx\n  - components/image-uploader.tsx -> components/uploader.tsx\n- Update node view and components to:\n  - Use a new prop type CustomImageNodeViewProps (Omit<NodeViewProps, \"extension\" | \"updateAttributes\"> plus explicit extension: CustomImageExtension; updateAttributes typed with TCustomImageAttributes)\n  - Replace all editor.commands.getImageSource/restoreImage/uploadImage calls with extension.options.getImageSource/restoreImage/uploadImage\n  - On image load error, gate restore attempts on extension.options.restoreImage existence and prevent repeated attempts\n  - Use ensurePixelString and types from custom-image/utils and types.ts\n  - Maintain behavior for drag/resize, initial sizing, and toolbar\n  - Ensure uploader uses uploadImage from extension options and respects maxFileSize from extension storage\n  - Adjust React hook dependencies accordingly (e.g., include extension.options where needed)\n- Update toolbar components to accept reordered image props (width, height, aspectRatio, src) without changing UI behavior\n\n4) Refactor generic image extension similarly\n- Create packages/editor/src/core/extensions/image/extension-config.tsx to extend BaseImage with shared attributes; type addOptions to include getImageSource only; use ImageExtensionStorage from ./extension\n- Update packages/editor/src/core/extensions/image/extension.tsx to:\n  - Accept { fileHandler: TFileHandler | TReadOnlyFileHandler }\n  - Extend ImageExtensionConfig and set addOptions.getImageSource from fileHandler\n  - addStorage: set deletedImageSet and maxFileSize (read if available)\n  - addKeyboardShortcuts as before\n  - addNodeView to use CustomImageNodeView (unified node view)\n- Remove unused files:\n  - packages/editor/src/core/extensions/image/image-component-without-props.tsx\n  - packages/editor/src/core/extensions/image/read-only-image.tsx\n- Update packages/editor/src/core/extensions/image/index.ts exports to export extension and extension-config only\n\n5) Update extension registration and exports\n- packages/editor/src/core/extensions/core-without-props.ts\n  - Replace ImageExtensionWithoutProps and CustomImageComponentWithoutProps with ImageExtensionConfig and CustomImageExtensionConfig in CoreEditorExtensionsWithoutProps array\n- packages/editor/src/core/extensions/extensions.ts (editable)\n  - When image is enabled, register:\n    - ImageExtension({ fileHandler }) (configure HTML attributes via ImageExtensionConfig if needed at config layer)\n    - CustomImageExtension({ fileHandler, isEditable: editable })\n- packages/editor/src/core/extensions/read-only-extensions.ts (read-only)\n  - When image is enabled, register:\n    - ImageExtension({ fileHandler })\n    - CustomImageExtension({ fileHandler, isEditable: false })\n- packages/editor/src/core/extensions/index.ts\n  - Remove export of ./custom-image index and ensure image export points to extension-config and extension\n\n6) Align types and imports across the codebase\n- packages/editor/src/ce/types/storage.ts\n  - Change import of CustomImageExtensionStorage to import from \"@/extensions/custom-image/types\"\n  - Keep ImageExtensionStorage from \"@/extensions/image\"\n- packages/editor/src/core/helpers/editor-commands.ts\n  - Update InsertImageComponentProps import path to \"@/extensions/custom-image/types\"\n\n7) Preserve existing behavior across integrations\n- Drag-and-drop and paste handlers must continue inserting custom image nodes via insertImageComponent (see packages/editor/src/core/plugins/drop.ts)\n- Menus, bubble menu, block menu must still detect image and custom-image active states via CORE_EXTENSIONS.IMAGE and CORE_EXTENSIONS.CUSTOM_IMAGE (no changes to the constants)\n- Public image restoration helper must continue iterating both nodes and call restore on src that start with http\n\nAcceptance criteria:\n- The editor works identically for image blocks in both editable and read-only modes, including:\n  - Inserting images by upload or drag/drop\n  - Upload progress and status tracked via fileMap and assetsUploadStatus\n  - Resolving final src via getImageSource\n  - Restoring public images via restoreImage\n  - Resizing image blocks and opening full-screen toolbar\n- No imports reference the removed files; all component paths match the new structure\n- All editor.commands calls formerly used by custom-image uploader/node-view are removed in favor of extension.options wiring\n- Type imports for CustomImageExtensionStorage and InsertImageComponentProps reference the new custom-image/types.ts\n- Core extension assemblers (editable and read-only) register image and custom-image correctly with the new factories\n",
      "prompt": "Refactor the editor’s image handling to separate configuration from behavior, unify editable and read-only flows, and move component logic to use extension-provided options rather than editor commands. Create a typed definition layer for custom image attributes/options/storage, split the custom-image extension into a base config and an extension that wires file handler functions (get image source, restore, optional upload) into options, and unify node views for image/custom-image. Update uploader and node-view components to rely on the extension’s options and storage, maintain drag/resize behavior, and keep public image restoration working. Replace old read-only and without-props variants with a single config + extension approach, and ensure editor assembly registers the correct extensions in editable and read-only modes. Align imports/types across the codebase accordingly.",
      "supplementalFiles": [
        "packages/editor/src/core/plugins/drop.ts",
        "packages/editor/src/core/helpers/image-helpers.ts",
        "packages/editor/src/core/components/menus/bubble-menu/root.tsx",
        "packages/editor/src/core/components/menus/block-menu.tsx",
        "packages/editor/src/core/components/menus/menu-items.ts",
        "packages/editor/src/core/constants/extension.ts",
        "packages/editor/src/core/constants/config.ts",
        "packages/editor/src/core/helpers/get-extension-storage.ts",
        "packages/editor/src/core/types/config.ts"
      ],
      "fileDiffs": [
        {
          "path": "packages/editor/src/ce/types/storage.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/ce/types/storage.ts\n===================================================================\n--- packages/editor/src/ce/types/storage.ts\t7045a1f (parent)\n+++ packages/editor/src/ce/types/storage.ts\tc1fa372 (commit)\n@@ -1,9 +1,9 @@\n // constants\n import { CORE_EXTENSIONS } from \"@/constants/extension\";\n // extensions\n import { type HeadingExtensionStorage } from \"@/extensions\";\n-import { type CustomImageExtensionStorage } from \"@/extensions/custom-image\";\n+import { type CustomImageExtensionStorage } from \"@/extensions/custom-image/types\";\n import { type CustomLinkStorage } from \"@/extensions/custom-link\";\n import { type ImageExtensionStorage } from \"@/extensions/image\";\n import { type MentionExtensionStorage } from \"@/extensions/mentions\";\n import { type UtilityExtensionStorage } from \"@/extensions/utility\";\n"
        },
        {
          "path": "packages/editor/src/core/extensions/core-without-props.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/core-without-props.ts\n===================================================================\n--- packages/editor/src/core/extensions/core-without-props.ts\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/core-without-props.ts\tc1fa372 (commit)\n@@ -11,12 +11,12 @@\n import { CustomCalloutExtensionConfig } from \"./callout/extension-config\";\n import { CustomCodeBlockExtensionWithoutProps } from \"./code/without-props\";\n import { CustomCodeInlineExtension } from \"./code-inline\";\n import { CustomColorExtension } from \"./custom-color\";\n+import { CustomImageExtensionConfig } from \"./custom-image/extension-config\";\n import { CustomLinkExtension } from \"./custom-link\";\n import { CustomHorizontalRule } from \"./horizontal-rule\";\n-import { ImageExtensionWithoutProps } from \"./image\";\n-import { CustomImageComponentWithoutProps } from \"./image/image-component-without-props\";\n+import { ImageExtensionConfig } from \"./image\";\n import { CustomMentionExtensionConfig } from \"./mentions/extension-config\";\n import { CustomQuoteExtension } from \"./quote\";\n import { TableHeader, TableCell, TableRow, Table } from \"./table\";\n import { CustomTextAlignExtension } from \"./text-align\";\n@@ -71,14 +71,10 @@\n       class:\n         \"text-custom-primary-300 underline underline-offset-[3px] hover:text-custom-primary-500 transition-colors cursor-pointer\",\n     },\n   }),\n-  ImageExtensionWithoutProps.configure({\n-    HTMLAttributes: {\n-      class: \"rounded-md\",\n-    },\n-  }),\n-  CustomImageComponentWithoutProps,\n+  ImageExtensionConfig,\n+  CustomImageExtensionConfig,\n   TiptapUnderline,\n   TextStyle,\n   TaskList.configure({\n     HTMLAttributes: {\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/block.tsx",
          "status": "renamed",
          "oldPath": "packages/editor/src/core/extensions/custom-image/components/image-block.tsx",
          "diff": "===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/image-block.tsx\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/block.tsx\tc1fa372 (commit)\n@@ -1,69 +1,43 @@\n import { NodeSelection } from \"@tiptap/pm/state\";\n import React, { useRef, useState, useCallback, useLayoutEffect, useEffect } from \"react\";\n-// plane utils\n+// plane imports\n import { cn } from \"@plane/utils\";\n-// extensions\n-import { CustomBaseImageNodeViewProps, ImageToolbarRoot } from \"@/extensions/custom-image\";\n+// local imports\n+import { Pixel, TCustomImageAttributes, TCustomImageSize } from \"../types\";\n+import { ensurePixelString } from \"../utils\";\n+import type { CustomImageNodeViewProps } from \"./node-view\";\n+import { ImageToolbarRoot } from \"./toolbar\";\n import { ImageUploadStatus } from \"./upload-status\";\n \n const MIN_SIZE = 100;\n \n-type Pixel = `${number}px`;\n-\n-type PixelAttribute<TDefault> = Pixel | TDefault;\n-\n-export type ImageAttributes = {\n-  src: string | null;\n-  width: PixelAttribute<\"35%\" | number>;\n-  height: PixelAttribute<\"auto\" | number>;\n-  aspectRatio: number | null;\n-  id: string | null;\n-};\n-\n-type Size = {\n-  width: PixelAttribute<\"35%\">;\n-  height: PixelAttribute<\"auto\">;\n-  aspectRatio: number | null;\n-};\n-\n-const ensurePixelString = <TDefault,>(value: Pixel | TDefault | number | undefined | null, defaultValue?: TDefault) => {\n-  if (!value || value === defaultValue) {\n-    return defaultValue;\n-  }\n-\n-  if (typeof value === \"number\") {\n-    return `${value}px` satisfies Pixel;\n-  }\n-\n-  return value;\n-};\n-\n-type CustomImageBlockProps = CustomBaseImageNodeViewProps & {\n-  imageFromFileSystem: string | undefined;\n-  setFailedToLoadImage: (isError: boolean) => void;\n+type CustomImageBlockProps = CustomImageNodeViewProps & {\n   editorContainer: HTMLDivElement | null;\n+  imageFromFileSystem: string | undefined;\n   setEditorContainer: (editorContainer: HTMLDivElement | null) => void;\n+  setFailedToLoadImage: (isError: boolean) => void;\n   src: string | undefined;\n };\n \n export const CustomImageBlock: React.FC<CustomImageBlockProps> = (props) => {\n   // props\n   const {\n-    node,\n-    updateAttributes,\n-    setFailedToLoadImage,\n-    imageFromFileSystem,\n-    selected,\n-    getPos,\n     editor,\n     editorContainer,\n-    src: resolvedImageSrc,\n+    extension,\n+    getPos,\n+    imageFromFileSystem,\n+    node,\n+    selected,\n     setEditorContainer,\n+    setFailedToLoadImage,\n+    src: resolvedImageSrc,\n+    updateAttributes,\n   } = props;\n   const { width: nodeWidth, height: nodeHeight, aspectRatio: nodeAspectRatio, src: imgNodeSrc } = node.attrs;\n   // states\n-  const [size, setSize] = useState<Size>({\n+  const [size, setSize] = useState<TCustomImageSize>({\n     width: ensurePixelString(nodeWidth, \"35%\") ?? \"35%\",\n     height: ensurePixelString(nodeHeight, \"auto\") ?? \"auto\",\n     aspectRatio: nodeAspectRatio || null,\n   });\n@@ -76,9 +50,9 @@\n   const [hasErroredOnFirstLoad, setHasErroredOnFirstLoad] = useState(false);\n   const [hasTriedRestoringImageOnce, setHasTriedRestoringImageOnce] = useState(false);\n \n   const updateAttributesSafely = useCallback(\n-    (attributes: Partial<ImageAttributes>, errorMessage: string) => {\n+    (attributes: Partial<TCustomImageAttributes>, errorMessage: string) => {\n       try {\n         updateAttributes(attributes);\n       } catch (error) {\n         console.error(`${errorMessage}:`, error);\n@@ -113,9 +87,9 @@\n       const editorWidth = closestEditorContainer.clientWidth;\n       const initialWidth = Math.max(editorWidth * 0.35, MIN_SIZE);\n       const initialHeight = initialWidth / aspectRatioCalculated;\n \n-      const initialComputedSize = {\n+      const initialComputedSize: TCustomImageSize = {\n         width: `${Math.round(initialWidth)}px` satisfies Pixel,\n         height: `${Math.round(initialHeight)}px` satisfies Pixel,\n         aspectRatio: aspectRatioCalculated,\n       };\n@@ -138,9 +112,9 @@\n         });\n       }\n     }\n     setInitialResizeComplete(true);\n-  }, [nodeWidth, updateAttributes, editorContainer, nodeAspectRatio]);\n+  }, [nodeWidth, updateAttributesSafely, editorContainer, nodeAspectRatio, setEditorContainer]);\n \n   // for real time resizing\n   useLayoutEffect(() => {\n     setSize((prevSize) => ({\n@@ -167,9 +141,9 @@\n \n   const handleResizeEnd = useCallback(() => {\n     setIsResizing(false);\n     updateAttributesSafely(size, \"Failed to update attributes at the end of resizing:\");\n-  }, [size, updateAttributes]);\n+  }, [size, updateAttributesSafely]);\n \n   const handleResizeStart = useCallback((e: React.MouseEvent | React.TouchEvent) => {\n     e.preventDefault();\n     e.stopPropagation();\n@@ -241,9 +215,9 @@\n         src={displayedImageSrc}\n         onLoad={handleImageLoad}\n         onError={async (e) => {\n           // for old image extension this command doesn't exist or if the image failed to load for the first time\n-          if (!editor?.commands.restoreImage || hasTriedRestoringImageOnce) {\n+          if (!extension.options.restoreImage || hasTriedRestoringImageOnce) {\n             setFailedToLoadImage(true);\n             return;\n           }\n \n@@ -252,9 +226,9 @@\n             // this is a type error from tiptap, don't remove await until it's fixed\n             if (!imgNodeSrc) {\n               throw new Error(\"No source image to restore from\");\n             }\n-            await editor?.commands.restoreImage?.(imgNodeSrc);\n+            await extension.options.restoreImage?.(imgNodeSrc);\n             if (!imageRef.current) {\n               throw new Error(\"Image reference not found\");\n             }\n             if (!resolvedImageSrc) {\n@@ -288,12 +262,12 @@\n           containerClassName={\n             \"absolute top-1 right-1 z-20 bg-black/40 rounded opacity-0 pointer-events-none group-hover/image-component:opacity-100 group-hover/image-component:pointer-events-auto transition-opacity\"\n           }\n           image={{\n-            src: resolvedImageSrc,\n-            aspectRatio: size.aspectRatio === null ? 1 : size.aspectRatio,\n-            height: size.height,\n             width: size.width,\n+            height: size.height,\n+            aspectRatio: size.aspectRatio === null ? 1 : size.aspectRatio,\n+            src: resolvedImageSrc,\n           }}\n         />\n       )}\n       {selected && displayedImageSrc === resolvedImageSrc && (\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/index.ts",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/index.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/index.ts\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/index.ts\tc1fa372 (commit)\n@@ -1,4 +0,0 @@\n-export * from \"./toolbar\";\n-export * from \"./image-block\";\n-export * from \"./image-node\";\n-export * from \"./image-uploader\";\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/node-view.tsx",
          "status": "renamed",
          "oldPath": "packages/editor/src/core/extensions/custom-image/components/image-node.tsx",
          "diff": "===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/image-node.tsx\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/node-view.tsx\tc1fa372 (commit)\n@@ -1,27 +1,28 @@\n import { Editor, NodeViewProps, NodeViewWrapper } from \"@tiptap/react\";\n import { useEffect, useRef, useState } from \"react\";\n // constants\n import { CORE_EXTENSIONS } from \"@/constants/extension\";\n-// extensions\n-import { CustomImageBlock, CustomImageUploader, ImageAttributes } from \"@/extensions/custom-image\";\n // helpers\n import { getExtensionStorage } from \"@/helpers/get-extension-storage\";\n+// local imports\n+import type { CustomImageExtension, TCustomImageAttributes } from \"../types\";\n+import { CustomImageBlock } from \"./block\";\n+import { CustomImageUploader } from \"./uploader\";\n \n-export type CustomBaseImageNodeViewProps = {\n+export type CustomImageNodeViewProps = Omit<NodeViewProps, \"extension\" | \"updateAttributes\"> & {\n+  extension: CustomImageExtension;\n   getPos: () => number;\n   editor: Editor;\n   node: NodeViewProps[\"node\"] & {\n-    attrs: ImageAttributes;\n+    attrs: TCustomImageAttributes;\n   };\n-  updateAttributes: (attrs: Partial<ImageAttributes>) => void;\n+  updateAttributes: (attrs: Partial<TCustomImageAttributes>) => void;\n   selected: boolean;\n };\n \n-export type CustomImageNodeProps = NodeViewProps & CustomBaseImageNodeViewProps;\n-\n-export const CustomImageNode = (props: CustomImageNodeProps) => {\n-  const { getPos, editor, node, updateAttributes, selected } = props;\n+export const CustomImageNodeView: React.FC<CustomImageNodeViewProps> = (props) => {\n+  const { editor, extension, node } = props;\n   const { src: imgNodeSrc } = node.attrs;\n \n   const [isUploaded, setIsUploaded] = useState(false);\n   const [resolvedSrc, setResolvedSrc] = useState<string | undefined>(undefined);\n@@ -49,43 +50,39 @@\n     }\n   }, [resolvedSrc]);\n \n   useEffect(() => {\n+    if (!imgNodeSrc) {\n+      setResolvedSrc(undefined);\n+      return;\n+    }\n+\n     const getImageSource = async () => {\n-      // @ts-expect-error function not expected here, but will still work and don't remove await\n-      const url: string = await editor?.commands?.getImageSource?.(imgNodeSrc);\n-      setResolvedSrc(url as string);\n+      const url = await extension.options.getImageSource?.(imgNodeSrc);\n+      setResolvedSrc(url);\n     };\n     getImageSource();\n-  }, [imgNodeSrc]);\n+  }, [imgNodeSrc, extension.options]);\n \n   return (\n     <NodeViewWrapper>\n       <div className=\"p-0 mx-0 my-2\" data-drag-handle ref={imageComponentRef}>\n         {(isUploaded || imageFromFileSystem) && !failedToLoadImage ? (\n           <CustomImageBlock\n-            imageFromFileSystem={imageFromFileSystem}\n             editorContainer={editorContainer}\n-            editor={editor}\n-            src={resolvedSrc}\n-            getPos={getPos}\n-            node={node}\n+            imageFromFileSystem={imageFromFileSystem}\n             setEditorContainer={setEditorContainer}\n             setFailedToLoadImage={setFailedToLoadImage}\n-            selected={selected}\n-            updateAttributes={updateAttributes}\n+            src={resolvedSrc}\n+            {...props}\n           />\n         ) : (\n           <CustomImageUploader\n-            editor={editor}\n             failedToLoadImage={failedToLoadImage}\n-            getPos={getPos}\n             loadImageFromFileSystem={setImageFromFileSystem}\n             maxFileSize={getExtensionStorage(editor, CORE_EXTENSIONS.CUSTOM_IMAGE).maxFileSize}\n-            node={node}\n             setIsUploaded={setIsUploaded}\n-            selected={selected}\n-            updateAttributes={updateAttributes}\n+            {...props}\n           />\n         )}\n       </div>\n     </NodeViewWrapper>\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen.tsx\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen.tsx\tc1fa372 (commit)\n@@ -1,15 +1,15 @@\n import { ExternalLink, Maximize, Minus, Plus, X } from \"lucide-react\";\n import { useCallback, useEffect, useMemo, useState, useRef } from \"react\";\n-// plane utils\n+// plane imports\n import { cn } from \"@plane/utils\";\n \n type Props = {\n   image: {\n-    src: string;\n-    height: string;\n     width: string;\n+    height: string;\n     aspectRatio: number;\n+    src: string;\n   };\n   isOpen: boolean;\n   toggleFullScreenMode: (val: boolean) => void;\n };\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/toolbar/root.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/toolbar/root.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/toolbar/root.tsx\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/toolbar/root.tsx\tc1fa372 (commit)\n@@ -1,17 +1,17 @@\n import { useState } from \"react\";\n-// plane utils\n+// plane imports\n import { cn } from \"@plane/utils\";\n-// components\n+// local imports\n import { ImageFullScreenAction } from \"./full-screen\";\n \n type Props = {\n   containerClassName?: string;\n   image: {\n-    src: string;\n-    height: string;\n     width: string;\n+    height: string;\n     aspectRatio: number;\n+    src: string;\n   };\n };\n \n export const ImageToolbarRoot: React.FC<Props> = (props) => {\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/uploader.tsx",
          "status": "renamed",
          "oldPath": "packages/editor/src/core/extensions/custom-image/components/image-uploader.tsx",
          "diff": "===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/image-uploader.tsx\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/uploader.tsx\tc1fa372 (commit)\n@@ -1,29 +1,31 @@\n import { ImageIcon } from \"lucide-react\";\n import { ChangeEvent, useCallback, useEffect, useMemo, useRef } from \"react\";\n-// plane utils\n+// plane imports\n import { cn } from \"@plane/utils\";\n // constants\n import { ACCEPTED_IMAGE_MIME_TYPES } from \"@/constants/config\";\n import { CORE_EXTENSIONS } from \"@/constants/extension\";\n-// extensions\n-import { CustomBaseImageNodeViewProps, getImageComponentImageFileMap } from \"@/extensions/custom-image\";\n // helpers\n import { EFileError } from \"@/helpers/file\";\n import { getExtensionStorage } from \"@/helpers/get-extension-storage\";\n // hooks\n import { useUploader, useDropZone, uploadFirstFileAndInsertRemaining } from \"@/hooks/use-file-upload\";\n+// local imports\n+import { getImageComponentImageFileMap } from \"../utils\";\n+import type { CustomImageNodeViewProps } from \"./node-view\";\n \n-type CustomImageUploaderProps = CustomBaseImageNodeViewProps & {\n-  maxFileSize: number;\n-  loadImageFromFileSystem: (file: string) => void;\n+type CustomImageUploaderProps = CustomImageNodeViewProps & {\n   failedToLoadImage: boolean;\n+  loadImageFromFileSystem: (file: string) => void;\n+  maxFileSize: number;\n   setIsUploaded: (isUploaded: boolean) => void;\n };\n \n export const CustomImageUploader = (props: CustomImageUploaderProps) => {\n   const {\n     editor,\n+    extension,\n     failedToLoadImage,\n     getPos,\n     loadImageFromFileSystem,\n     maxFileSize,\n@@ -70,14 +72,15 @@\n           }\n         }\n       }\n     },\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n     [imageComponentImageFileMap, imageEntityId, updateAttributes, getPos]\n   );\n \n   const uploadImageEditorCommand = useCallback(\n-    async (file: File) => await editor?.commands.uploadImage(imageEntityId ?? \"\", file),\n-    [editor, imageEntityId]\n+    async (file: File) => await extension.options.uploadImage?.(imageEntityId ?? \"\", file),\n+    [extension.options, imageEntityId]\n   );\n \n   const handleProgressStatus = useCallback(\n     (isUploading: boolean) => {\n@@ -92,9 +95,8 @@\n \n   // hooks\n   const { isUploading: isImageBeingUploaded, uploadFile } = useUploader({\n     acceptedMimeTypes: ACCEPTED_IMAGE_MIME_TYPES,\n-    // @ts-expect-error - TODO: fix typings, and don't remove await from here for now\n     editorCommand: uploadImageEditorCommand,\n     handleProgressStatus,\n     loadFileFromFileSystem: loadImageFromFileSystem,\n     maxFileSize,\n@@ -127,9 +129,9 @@\n         hasTriggeredFilePickerRef.current = true;\n         imageComponentImageFileMap?.set(imageEntityId ?? \"\", { ...meta, hasOpenedFileInputOnce: true });\n       }\n     }\n-  }, [meta, uploadFile, imageComponentImageFileMap]);\n+  }, [meta, uploadFile, imageComponentImageFileMap, imageEntityId]);\n \n   const onFileChange = useCallback(\n     async (e: ChangeEvent<HTMLInputElement>) => {\n       e.preventDefault();\n@@ -162,9 +164,9 @@\n       return \"Drop image here\";\n     }\n \n     return \"Add an image\";\n-  }, [draggedInside, failedToLoadImage, isImageBeingUploaded]);\n+  }, [draggedInside, failedToLoadImage, isImageBeingUploaded, editor.isEditable]);\n \n   return (\n     <div\n       className={cn(\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/custom-image.ts",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/custom-image.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/custom-image.ts\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/custom-image/custom-image.ts\tc1fa372 (commit)\n@@ -1,180 +0,0 @@\n-import { Editor, mergeAttributes } from \"@tiptap/core\";\n-import { Image as BaseImageExtension } from \"@tiptap/extension-image\";\n-import { ReactNodeViewRenderer } from \"@tiptap/react\";\n-import { v4 as uuidv4 } from \"uuid\";\n-// constants\n-import { ACCEPTED_IMAGE_MIME_TYPES } from \"@/constants/config\";\n-import { CORE_EXTENSIONS } from \"@/constants/extension\";\n-// extensions\n-import { CustomImageNode } from \"@/extensions/custom-image\";\n-// helpers\n-import { isFileValid } from \"@/helpers/file\";\n-import { getExtensionStorage } from \"@/helpers/get-extension-storage\";\n-import { insertEmptyParagraphAtNodeBoundaries } from \"@/helpers/insert-empty-paragraph-at-node-boundary\";\n-// types\n-import { TFileHandler } from \"@/types\";\n-\n-export type InsertImageComponentProps = {\n-  file?: File;\n-  pos?: number;\n-  event: \"insert\" | \"drop\";\n-};\n-\n-declare module \"@tiptap/core\" {\n-  interface Commands<ReturnType> {\n-    [CORE_EXTENSIONS.CUSTOM_IMAGE]: {\n-      insertImageComponent: ({ file, pos, event }: InsertImageComponentProps) => ReturnType;\n-      uploadImage: (blockId: string, file: File) => () => Promise<string> | undefined;\n-      getImageSource?: (path: string) => () => Promise<string>;\n-      restoreImage: (src: string) => () => Promise<void>;\n-    };\n-  }\n-}\n-\n-export const getImageComponentImageFileMap = (editor: Editor) =>\n-  getExtensionStorage(editor, CORE_EXTENSIONS.CUSTOM_IMAGE)?.fileMap;\n-\n-export interface CustomImageExtensionStorage {\n-  fileMap: Map<string, UploadEntity>;\n-  deletedImageSet: Map<string, boolean>;\n-  maxFileSize: number;\n-}\n-\n-export type UploadEntity = ({ event: \"insert\" } | { event: \"drop\"; file: File }) & { hasOpenedFileInputOnce?: boolean };\n-\n-export const CustomImageExtension = (props: TFileHandler) => {\n-  const {\n-    getAssetSrc,\n-    upload,\n-    restore: restoreImageFn,\n-    validation: { maxFileSize },\n-  } = props;\n-\n-  return BaseImageExtension.extend<Record<string, unknown>, CustomImageExtensionStorage>({\n-    name: CORE_EXTENSIONS.CUSTOM_IMAGE,\n-    selectable: true,\n-    group: \"block\",\n-    atom: true,\n-    draggable: true,\n-\n-    addAttributes() {\n-      return {\n-        ...this.parent?.(),\n-        width: {\n-          default: \"35%\",\n-        },\n-        src: {\n-          default: null,\n-        },\n-        height: {\n-          default: \"auto\",\n-        },\n-        [\"id\"]: {\n-          default: null,\n-        },\n-        aspectRatio: {\n-          default: null,\n-        },\n-      };\n-    },\n-\n-    parseHTML() {\n-      return [\n-        {\n-          tag: \"image-component\",\n-        },\n-      ];\n-    },\n-\n-    renderHTML({ HTMLAttributes }) {\n-      return [\"image-component\", mergeAttributes(HTMLAttributes)];\n-    },\n-\n-    addKeyboardShortcuts() {\n-      return {\n-        ArrowDown: insertEmptyParagraphAtNodeBoundaries(\"down\", this.name),\n-        ArrowUp: insertEmptyParagraphAtNodeBoundaries(\"up\", this.name),\n-      };\n-    },\n-\n-    addStorage() {\n-      return {\n-        fileMap: new Map(),\n-        deletedImageSet: new Map<string, boolean>(),\n-        maxFileSize,\n-        // escape markdown for images\n-        markdown: {\n-          serialize() {},\n-        },\n-      };\n-    },\n-\n-    addCommands() {\n-      return {\n-        insertImageComponent:\n-          (props) =>\n-          ({ commands }) => {\n-            // Early return if there's an invalid file being dropped\n-            if (\n-              props?.file &&\n-              !isFileValid({\n-                acceptedMimeTypes: ACCEPTED_IMAGE_MIME_TYPES,\n-                file: props.file,\n-                maxFileSize,\n-                onError: (_error, message) => alert(message),\n-              })\n-            ) {\n-              return false;\n-            }\n-\n-            // generate a unique id for the image to keep track of dropped\n-            // files' file data\n-            const fileId = uuidv4();\n-\n-            const imageComponentImageFileMap = getImageComponentImageFileMap(this.editor);\n-\n-            if (imageComponentImageFileMap) {\n-              if (props?.event === \"drop\" && props.file) {\n-                imageComponentImageFileMap.set(fileId, {\n-                  file: props.file,\n-                  event: props.event,\n-                });\n-              } else if (props.event === \"insert\") {\n-                imageComponentImageFileMap.set(fileId, {\n-                  event: props.event,\n-                  hasOpenedFileInputOnce: false,\n-                });\n-              }\n-            }\n-\n-            const attributes = {\n-              id: fileId,\n-            };\n-\n-            if (props.pos) {\n-              return commands.insertContentAt(props.pos, {\n-                type: this.name,\n-                attrs: attributes,\n-              });\n-            }\n-            return commands.insertContent({\n-              type: this.name,\n-              attrs: attributes,\n-            });\n-          },\n-        uploadImage: (blockId, file) => async () => {\n-          const fileUrl = await upload(blockId, file);\n-          return fileUrl;\n-        },\n-        getImageSource: (path) => async () => await getAssetSrc(path),\n-        restoreImage: (src) => async () => {\n-          await restoreImageFn(src);\n-        },\n-      };\n-    },\n-\n-    addNodeView() {\n-      return ReactNodeViewRenderer(CustomImageNode);\n-    },\n-  });\n-};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/extension-config.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/extension-config.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/extension-config.ts\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/custom-image/extension-config.ts\tc1fa372 (commit)\n@@ -0,0 +1,47 @@\n+import { mergeAttributes } from \"@tiptap/core\";\n+import { Image as BaseImageExtension } from \"@tiptap/extension-image\";\n+// constants\n+import { CORE_EXTENSIONS } from \"@/constants/extension\";\n+// local imports\n+import { type CustomImageExtension, ECustomImageAttributeNames, type InsertImageComponentProps } from \"./types\";\n+import { DEFAULT_CUSTOM_IMAGE_ATTRIBUTES } from \"./utils\";\n+\n+declare module \"@tiptap/core\" {\n+  interface Commands<ReturnType> {\n+    [CORE_EXTENSIONS.CUSTOM_IMAGE]: {\n+      insertImageComponent: ({ file, pos, event }: InsertImageComponentProps) => ReturnType;\n+    };\n+  }\n+}\n+\n+export const CustomImageExtensionConfig: CustomImageExtension = BaseImageExtension.extend({\n+  name: CORE_EXTENSIONS.CUSTOM_IMAGE,\n+  group: \"block\",\n+  atom: true,\n+\n+  addAttributes() {\n+    const attributes = {\n+      ...this.parent?.(),\n+      ...Object.values(ECustomImageAttributeNames).reduce((acc, value) => {\n+        acc[value] = {\n+          default: DEFAULT_CUSTOM_IMAGE_ATTRIBUTES[value],\n+        };\n+        return acc;\n+      }, {}),\n+    };\n+\n+    return attributes;\n+  },\n+\n+  parseHTML() {\n+    return [\n+      {\n+        tag: \"image-component\",\n+      },\n+    ];\n+  },\n+\n+  renderHTML({ HTMLAttributes }) {\n+    return [\"image-component\", mergeAttributes(HTMLAttributes)];\n+  },\n+});\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/extension.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/extension.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/extension.ts\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/custom-image/extension.ts\tc1fa372 (commit)\n@@ -0,0 +1,121 @@\n+import { ReactNodeViewRenderer } from \"@tiptap/react\";\n+import { v4 as uuidv4 } from \"uuid\";\n+// constants\n+import { ACCEPTED_IMAGE_MIME_TYPES } from \"@/constants/config\";\n+// helpers\n+import { isFileValid } from \"@/helpers/file\";\n+import { insertEmptyParagraphAtNodeBoundaries } from \"@/helpers/insert-empty-paragraph-at-node-boundary\";\n+// types\n+import type { TFileHandler, TReadOnlyFileHandler } from \"@/types\";\n+// local imports\n+import { CustomImageNodeView } from \"./components/node-view\";\n+import { CustomImageExtensionConfig } from \"./extension-config\";\n+import { getImageComponentImageFileMap } from \"./utils\";\n+\n+type Props = {\n+  fileHandler: TFileHandler | TReadOnlyFileHandler;\n+  isEditable: boolean;\n+};\n+\n+export const CustomImageExtension = (props: Props) => {\n+  const { fileHandler, isEditable } = props;\n+  // derived values\n+  const { getAssetSrc, restore: restoreImageFn } = fileHandler;\n+\n+  return CustomImageExtensionConfig.extend({\n+    selectable: isEditable,\n+    draggable: isEditable,\n+\n+    addOptions() {\n+      const upload = \"upload\" in fileHandler ? fileHandler.upload : undefined;\n+\n+      return {\n+        ...this.parent?.(),\n+        getImageSource: getAssetSrc,\n+        restoreImage: restoreImageFn,\n+        uploadImage: upload,\n+      };\n+    },\n+\n+    addStorage() {\n+      const maxFileSize = \"validation\" in fileHandler ? fileHandler.validation?.maxFileSize : 0;\n+\n+      return {\n+        fileMap: new Map(),\n+        deletedImageSet: new Map<string, boolean>(),\n+        maxFileSize,\n+        // escape markdown for images\n+        markdown: {\n+          serialize() {},\n+        },\n+      };\n+    },\n+\n+    addCommands() {\n+      return {\n+        insertImageComponent:\n+          (props) =>\n+          ({ commands }) => {\n+            // Early return if there's an invalid file being dropped\n+            if (\n+              props?.file &&\n+              !isFileValid({\n+                acceptedMimeTypes: ACCEPTED_IMAGE_MIME_TYPES,\n+                file: props.file,\n+                maxFileSize: this.storage.maxFileSize,\n+                onError: (_error, message) => alert(message),\n+              })\n+            ) {\n+              return false;\n+            }\n+\n+            // generate a unique id for the image to keep track of dropped\n+            // files' file data\n+            const fileId = uuidv4();\n+\n+            const imageComponentImageFileMap = getImageComponentImageFileMap(this.editor);\n+\n+            if (imageComponentImageFileMap) {\n+              if (props?.event === \"drop\" && props.file) {\n+                imageComponentImageFileMap.set(fileId, {\n+                  file: props.file,\n+                  event: props.event,\n+                });\n+              } else if (props.event === \"insert\") {\n+                imageComponentImageFileMap.set(fileId, {\n+                  event: props.event,\n+                  hasOpenedFileInputOnce: false,\n+                });\n+              }\n+            }\n+\n+            const attributes = {\n+              id: fileId,\n+            };\n+\n+            if (props.pos) {\n+              return commands.insertContentAt(props.pos, {\n+                type: this.name,\n+                attrs: attributes,\n+              });\n+            }\n+            return commands.insertContent({\n+              type: this.name,\n+              attrs: attributes,\n+            });\n+          },\n+      };\n+    },\n+\n+    addKeyboardShortcuts() {\n+      return {\n+        ArrowDown: insertEmptyParagraphAtNodeBoundaries(\"down\", this.name),\n+        ArrowUp: insertEmptyParagraphAtNodeBoundaries(\"up\", this.name),\n+      };\n+    },\n+\n+    addNodeView() {\n+      return ReactNodeViewRenderer(CustomImageNodeView);\n+    },\n+  });\n+};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/index.ts",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/index.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/index.ts\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/custom-image/index.ts\tc1fa372 (commit)\n@@ -1,3 +0,0 @@\n-export * from \"./components\";\n-export * from \"./custom-image\";\n-export * from \"./read-only-custom-image\";\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/read-only-custom-image.ts",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/read-only-custom-image.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/read-only-custom-image.ts\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/custom-image/read-only-custom-image.ts\tc1fa372 (commit)\n@@ -1,79 +0,0 @@\n-import { mergeAttributes } from \"@tiptap/core\";\n-import { Image as BaseImageExtension } from \"@tiptap/extension-image\";\n-import { ReactNodeViewRenderer } from \"@tiptap/react\";\n-// constants\n-import { CORE_EXTENSIONS } from \"@/constants/extension\";\n-// components\n-import { CustomImageNode, CustomImageExtensionStorage } from \"@/extensions/custom-image\";\n-// types\n-import { TReadOnlyFileHandler } from \"@/types\";\n-\n-export const CustomReadOnlyImageExtension = (props: TReadOnlyFileHandler) => {\n-  const { getAssetSrc, restore: restoreImageFn } = props;\n-\n-  return BaseImageExtension.extend<Record<string, unknown>, CustomImageExtensionStorage>({\n-    name: CORE_EXTENSIONS.CUSTOM_IMAGE,\n-    selectable: false,\n-    group: \"block\",\n-    atom: true,\n-    draggable: false,\n-\n-    addAttributes() {\n-      return {\n-        ...this.parent?.(),\n-        width: {\n-          default: \"35%\",\n-        },\n-        src: {\n-          default: null,\n-        },\n-        height: {\n-          default: \"auto\",\n-        },\n-        [\"id\"]: {\n-          default: null,\n-        },\n-        aspectRatio: {\n-          default: null,\n-        },\n-      };\n-    },\n-\n-    parseHTML() {\n-      return [\n-        {\n-          tag: \"image-component\",\n-        },\n-      ];\n-    },\n-\n-    renderHTML({ HTMLAttributes }) {\n-      return [\"image-component\", mergeAttributes(HTMLAttributes)];\n-    },\n-\n-    addStorage() {\n-      return {\n-        fileMap: new Map(),\n-        deletedImageSet: new Map<string, boolean>(),\n-        maxFileSize: 0,\n-        // escape markdown for images\n-        markdown: {\n-          serialize() {},\n-        },\n-      };\n-    },\n-\n-    addCommands() {\n-      return {\n-        getImageSource: (path: string) => async () => await getAssetSrc(path),\n-        restoreImage: (src) => async () => {\n-          await restoreImageFn(src);\n-        },\n-      };\n-    },\n-\n-    addNodeView() {\n-      return ReactNodeViewRenderer(CustomImageNode);\n-    },\n-  });\n-};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/types.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/types.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/types.ts\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/custom-image/types.ts\tc1fa372 (commit)\n@@ -0,0 +1,51 @@\n+import type { Node } from \"@tiptap/core\";\n+// types\n+import type { TFileHandler } from \"@/types\";\n+\n+export enum ECustomImageAttributeNames {\n+  ID = \"id\",\n+  WIDTH = \"width\",\n+  HEIGHT = \"height\",\n+  ASPECT_RATIO = \"aspectRatio\",\n+  SOURCE = \"src\",\n+}\n+\n+export type Pixel = `${number}px`;\n+\n+export type PixelAttribute<TDefault> = Pixel | TDefault;\n+\n+export type TCustomImageSize = {\n+  width: PixelAttribute<\"35%\">;\n+  height: PixelAttribute<\"auto\">;\n+  aspectRatio: number | null;\n+};\n+\n+export type TCustomImageAttributes = {\n+  [ECustomImageAttributeNames.ID]: string | null;\n+  [ECustomImageAttributeNames.WIDTH]: PixelAttribute<\"35%\" | number> | null;\n+  [ECustomImageAttributeNames.HEIGHT]: PixelAttribute<\"auto\" | number> | null;\n+  [ECustomImageAttributeNames.ASPECT_RATIO]: number | null;\n+  [ECustomImageAttributeNames.SOURCE]: string | null;\n+};\n+\n+export type UploadEntity = ({ event: \"insert\" } | { event: \"drop\"; file: File }) & { hasOpenedFileInputOnce?: boolean };\n+\n+export type InsertImageComponentProps = {\n+  file?: File;\n+  pos?: number;\n+  event: \"insert\" | \"drop\";\n+};\n+\n+export type CustomImageExtensionOptions = {\n+  getImageSource: TFileHandler[\"getAssetSrc\"];\n+  restoreImage: TFileHandler[\"restore\"];\n+  uploadImage?: TFileHandler[\"upload\"];\n+};\n+\n+export type CustomImageExtensionStorage = {\n+  fileMap: Map<string, UploadEntity>;\n+  deletedImageSet: Map<string, boolean>;\n+  maxFileSize: number;\n+};\n+\n+export type CustomImageExtension = Node<CustomImageExtensionOptions, CustomImageExtensionStorage>;\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/utils.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/utils.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/utils.ts\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/custom-image/utils.ts\tc1fa372 (commit)\n@@ -0,0 +1,33 @@\n+import type { Editor } from \"@tiptap/core\";\n+// constants\n+import { CORE_EXTENSIONS } from \"@/constants/extension\";\n+// helpers\n+import { getExtensionStorage } from \"@/helpers/get-extension-storage\";\n+// local imports\n+import { ECustomImageAttributeNames, type Pixel, type TCustomImageAttributes } from \"./types\";\n+\n+export const DEFAULT_CUSTOM_IMAGE_ATTRIBUTES: TCustomImageAttributes = {\n+  [ECustomImageAttributeNames.SOURCE]: null,\n+  [ECustomImageAttributeNames.ID]: null,\n+  [ECustomImageAttributeNames.WIDTH]: \"35%\",\n+  [ECustomImageAttributeNames.HEIGHT]: \"auto\",\n+  [ECustomImageAttributeNames.ASPECT_RATIO]: null,\n+};\n+\n+export const getImageComponentImageFileMap = (editor: Editor) =>\n+  getExtensionStorage(editor, CORE_EXTENSIONS.CUSTOM_IMAGE)?.fileMap;\n+\n+export const ensurePixelString = <TDefault>(\n+  value: Pixel | TDefault | number | undefined | null,\n+  defaultValue?: TDefault\n+) => {\n+  if (!value || value === defaultValue) {\n+    return defaultValue;\n+  }\n+\n+  if (typeof value === \"number\") {\n+    return `${value}px` satisfies Pixel;\n+  }\n+\n+  return value;\n+};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/extensions.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/extensions.ts\n===================================================================\n--- packages/editor/src/core/extensions/extensions.ts\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/extensions.ts\tc1fa372 (commit)\n@@ -15,9 +15,8 @@\n   CustomCodeBlockExtension,\n   CustomCodeInlineExtension,\n   CustomColorExtension,\n   CustomHorizontalRule,\n-  CustomImageExtension,\n   CustomKeymap,\n   CustomLinkExtension,\n   CustomMentionExtension,\n   CustomQuoteExtension,\n@@ -37,8 +36,10 @@\n // plane editor extensions\n import { CoreEditorAdditionalExtensions } from \"@/plane-editor/extensions\";\n // types\n import type { IEditorProps } from \"@/types\";\n+// local imports\n+import { CustomImageExtension } from \"./custom-image/extension\";\n \n type TArguments = Pick<\n   IEditorProps,\n   \"disabledExtensions\" | \"flaggedExtensions\" | \"fileHandler\" | \"mentionHandler\" | \"placeholder\" | \"tabIndex\"\n@@ -190,14 +191,15 @@\n   ];\n \n   if (!disabledExtensions.includes(\"image\")) {\n     extensions.push(\n-      ImageExtension(fileHandler).configure({\n-        HTMLAttributes: {\n-          class: \"rounded-md\",\n-        },\n+      ImageExtension({\n+        fileHandler,\n       }),\n-      CustomImageExtension(fileHandler)\n+      CustomImageExtension({\n+        fileHandler,\n+        isEditable: editable,\n+      })\n     );\n   }\n \n   // @ts-expect-error tiptap types are incorrect\n"
        },
        {
          "path": "packages/editor/src/core/extensions/image/extension-config.tsx",
          "status": "renamed",
          "oldPath": "packages/editor/src/core/extensions/image/image-extension-without-props.tsx",
          "diff": "===================================================================\n--- packages/editor/src/core/extensions/image/image-extension-without-props.tsx\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/image/extension-config.tsx\tc1fa372 (commit)\n@@ -1,7 +1,13 @@\n import { Image as BaseImageExtension } from \"@tiptap/extension-image\";\n+// local imports\n+import { CustomImageExtensionOptions } from \"../custom-image/types\";\n+import { ImageExtensionStorage } from \"./extension\";\n \n-export const ImageExtensionWithoutProps = BaseImageExtension.extend({\n+export const ImageExtensionConfig = BaseImageExtension.extend<\n+  Pick<CustomImageExtensionOptions, \"getImageSource\">,\n+  ImageExtensionStorage\n+>({\n   addAttributes() {\n     return {\n       ...this.parent?.(),\n       width: {\n"
        },
        {
          "path": "packages/editor/src/core/extensions/image/extension.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/image/extension.tsx\n===================================================================\n--- packages/editor/src/core/extensions/image/extension.tsx\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/image/extension.tsx\tc1fa372 (commit)\n@@ -1,24 +1,34 @@\n-import { Image as BaseImageExtension } from \"@tiptap/extension-image\";\n import { ReactNodeViewRenderer } from \"@tiptap/react\";\n-// extensions\n-import { CustomImageNode } from \"@/extensions\";\n // helpers\n import { insertEmptyParagraphAtNodeBoundaries } from \"@/helpers/insert-empty-paragraph-at-node-boundary\";\n // types\n-import { TFileHandler } from \"@/types\";\n+import type { TFileHandler, TReadOnlyFileHandler } from \"@/types\";\n+// local imports\n+import { CustomImageNodeView } from \"../custom-image/components/node-view\";\n+import { ImageExtensionConfig } from \"./extension-config\";\n \n export type ImageExtensionStorage = {\n   deletedImageSet: Map<string, boolean>;\n };\n \n-export const ImageExtension = (fileHandler: TFileHandler) => {\n-  const {\n-    getAssetSrc,\n-    validation: { maxFileSize },\n-  } = fileHandler;\n+type Props = {\n+  fileHandler: TFileHandler | TReadOnlyFileHandler;\n+};\n \n-  return BaseImageExtension.extend<unknown, ImageExtensionStorage>({\n+export const ImageExtension = (props: Props) => {\n+  const { fileHandler } = props;\n+  // derived values\n+  const { getAssetSrc } = fileHandler;\n+\n+  return ImageExtensionConfig.extend({\n+    addOptions() {\n+      return {\n+        ...this.parent?.(),\n+        getImageSource: getAssetSrc,\n+      };\n+    },\n+\n     addKeyboardShortcuts() {\n       return {\n         ArrowDown: insertEmptyParagraphAtNodeBoundaries(\"down\", this.name),\n         ArrowUp: insertEmptyParagraphAtNodeBoundaries(\"up\", this.name),\n@@ -26,37 +36,18 @@\n     },\n \n     // storage to keep track of image states Map<src, isDeleted>\n     addStorage() {\n+      const maxFileSize = \"validation\" in fileHandler ? fileHandler.validation?.maxFileSize : 0;\n+\n       return {\n         deletedImageSet: new Map<string, boolean>(),\n         maxFileSize,\n       };\n     },\n \n-    addAttributes() {\n-      return {\n-        ...this.parent?.(),\n-        width: {\n-          default: \"35%\",\n-        },\n-        height: {\n-          default: null,\n-        },\n-        aspectRatio: {\n-          default: null,\n-        },\n-      };\n-    },\n-\n-    addCommands() {\n-      return {\n-        getImageSource: (path: string) => async () => await getAssetSrc(path),\n-      };\n-    },\n-\n     // render custom image node\n     addNodeView() {\n-      return ReactNodeViewRenderer(CustomImageNode);\n+      return ReactNodeViewRenderer(CustomImageNodeView);\n     },\n   });\n };\n"
        },
        {
          "path": "packages/editor/src/core/extensions/image/image-component-without-props.tsx",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/extensions/image/image-component-without-props.tsx\n===================================================================\n--- packages/editor/src/core/extensions/image/image-component-without-props.tsx\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/image/image-component-without-props.tsx\tc1fa372 (commit)\n@@ -1,56 +0,0 @@\n-import { mergeAttributes } from \"@tiptap/core\";\n-import { Image as BaseImageExtension } from \"@tiptap/extension-image\";\n-// local imports\n-import { ImageExtensionStorage } from \"./extension\";\n-\n-export const CustomImageComponentWithoutProps = BaseImageExtension.extend<\n-  Record<string, unknown>,\n-  ImageExtensionStorage\n->({\n-  name: \"imageComponent\",\n-  selectable: true,\n-  group: \"block\",\n-  atom: true,\n-  draggable: true,\n-\n-  addAttributes() {\n-    return {\n-      ...this.parent?.(),\n-      width: {\n-        default: \"35%\",\n-      },\n-      src: {\n-        default: null,\n-      },\n-      height: {\n-        default: \"auto\",\n-      },\n-      [\"id\"]: {\n-        default: null,\n-      },\n-      aspectRatio: {\n-        default: null,\n-      },\n-    };\n-  },\n-\n-  parseHTML() {\n-    return [\n-      {\n-        tag: \"image-component\",\n-      },\n-    ];\n-  },\n-\n-  renderHTML({ HTMLAttributes }) {\n-    return [\"image-component\", mergeAttributes(HTMLAttributes)];\n-  },\n-\n-  addStorage() {\n-    return {\n-      fileMap: new Map(),\n-      deletedImageSet: new Map<string, boolean>(),\n-      maxFileSize: 0,\n-    };\n-  },\n-});\n"
        },
        {
          "path": "packages/editor/src/core/extensions/image/index.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/image/index.ts\n===================================================================\n--- packages/editor/src/core/extensions/image/index.ts\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/image/index.ts\tc1fa372 (commit)\n@@ -1,3 +1,2 @@\n export * from \"./extension\";\n-export * from \"./image-extension-without-props\";\n-export * from \"./read-only-image\";\n+export * from \"./extension-config\";\n"
        },
        {
          "path": "packages/editor/src/core/extensions/image/read-only-image.tsx",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/extensions/image/read-only-image.tsx\n===================================================================\n--- packages/editor/src/core/extensions/image/read-only-image.tsx\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/image/read-only-image.tsx\tc1fa372 (commit)\n@@ -1,37 +0,0 @@\n-import { Image as BaseImageExtension } from \"@tiptap/extension-image\";\n-import { ReactNodeViewRenderer } from \"@tiptap/react\";\n-// extensions\n-import { CustomImageNode } from \"@/extensions\";\n-// types\n-import { TReadOnlyFileHandler } from \"@/types\";\n-\n-export const ReadOnlyImageExtension = (props: TReadOnlyFileHandler) => {\n-  const { getAssetSrc } = props;\n-\n-  return BaseImageExtension.extend({\n-    addAttributes() {\n-      return {\n-        ...this.parent?.(),\n-        width: {\n-          default: \"35%\",\n-        },\n-        height: {\n-          default: null,\n-        },\n-        aspectRatio: {\n-          default: null,\n-        },\n-      };\n-    },\n-\n-    addCommands() {\n-      return {\n-        getImageSource: (path: string) => async () => await getAssetSrc(path),\n-      };\n-    },\n-\n-    addNodeView() {\n-      return ReactNodeViewRenderer(CustomImageNode);\n-    },\n-  });\n-};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/index.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/index.ts\n===================================================================\n--- packages/editor/src/core/extensions/index.ts\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/index.ts\tc1fa372 (commit)\n@@ -1,8 +1,7 @@\n export * from \"./callout\";\n export * from \"./code\";\n export * from \"./code-inline\";\n-export * from \"./custom-image\";\n export * from \"./custom-link\";\n export * from \"./custom-list-keymap\";\n export * from \"./image\";\n export * from \"./mentions\";\n"
        },
        {
          "path": "packages/editor/src/core/extensions/read-only-extensions.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/read-only-extensions.ts\n===================================================================\n--- packages/editor/src/core/extensions/read-only-extensions.ts\t7045a1f (parent)\n+++ packages/editor/src/core/extensions/read-only-extensions.ts\tc1fa372 (commit)\n@@ -11,28 +11,29 @@\n   CustomQuoteExtension,\n   CustomHorizontalRule,\n   CustomLinkExtension,\n   CustomTypographyExtension,\n-  ReadOnlyImageExtension,\n   CustomCodeBlockExtension,\n   CustomCodeInlineExtension,\n   TableHeader,\n   TableCell,\n   TableRow,\n   Table,\n   CustomMentionExtension,\n-  CustomReadOnlyImageExtension,\n   CustomTextAlignExtension,\n   CustomCalloutReadOnlyExtension,\n   CustomColorExtension,\n   UtilityExtension,\n+  ImageExtension,\n } from \"@/extensions\";\n // helpers\n import { isValidHttpUrl } from \"@/helpers/common\";\n // plane editor extensions\n import { CoreReadOnlyEditorAdditionalExtensions } from \"@/plane-editor/extensions\";\n // types\n import type { IReadOnlyEditorProps } from \"@/types\";\n+// local imports\n+import { CustomImageExtension } from \"./custom-image/extension\";\n \n type Props = Pick<IReadOnlyEditorProps, \"disabledExtensions\" | \"flaggedExtensions\" | \"fileHandler\" | \"mentionHandler\">;\n \n export const CoreReadOnlyEditorExtensions = (props: Props): Extensions => {\n@@ -134,14 +135,15 @@\n   ];\n \n   if (!disabledExtensions.includes(\"image\")) {\n     extensions.push(\n-      ReadOnlyImageExtension(fileHandler).configure({\n-        HTMLAttributes: {\n-          class: \"rounded-md\",\n-        },\n+      ImageExtension({\n+        fileHandler,\n       }),\n-      CustomReadOnlyImageExtension(fileHandler)\n+      CustomImageExtension({\n+        fileHandler,\n+        isEditable: false,\n+      })\n     );\n   }\n \n   // @ts-expect-error tiptap types are incorrect\n"
        },
        {
          "path": "packages/editor/src/core/helpers/editor-commands.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/helpers/editor-commands.ts\n===================================================================\n--- packages/editor/src/core/helpers/editor-commands.ts\t7045a1f (parent)\n+++ packages/editor/src/core/helpers/editor-commands.ts\tc1fa372 (commit)\n@@ -1,10 +1,10 @@\n import { Editor, Range } from \"@tiptap/core\";\n // constants\n import { CORE_EXTENSIONS } from \"@/constants/extension\";\n // extensions\n-import { InsertImageComponentProps } from \"@/extensions\";\n import { replaceCodeWithText } from \"@/extensions/code/utils/replace-code-block-with-text\";\n+import type { InsertImageComponentProps } from \"@/extensions/custom-image/types\";\n // helpers\n import { findTableAncestor } from \"@/helpers/common\";\n \n export const setText = (editor: Editor, range?: Range) => {\n"
        }
      ]
    },
    {
      "id": "image-download-alignment",
      "sha": "f679628365e78889755ea81c039b57994f1a595a",
      "parentSha": "ba6b822f607af7621cf5977f3a4e6a889022cf07",
      "spec": "Implement image download and alignment options for editor image blocks, and render the image fullscreen viewer in a dedicated portal, with the following changes:\n\n1) Custom image block UI and behavior\n- In packages/editor/src/core/extensions/custom-image/components/block.tsx:\n  - Accept a new prop downloadSrc and read alignment from node.attrs.\n  - Adjust the outer container to align the image based on node.attrs.alignment:\n    - left: no shift\n    - center: add classes \"ml-[50%] -translate-x-1/2\"\n    - right: add classes \"ml-[100%] -translate-x-full\"\n  - Show the image toolbar only when the remote image src and a download src are both resolved and the initial resize has completed.\n  - Render the new ImageToolbarRoot and pass: alignment, width, height, aspectRatio, src, downloadSrc, and a handler that updates the node attribute alignment via updateAttributesSafely.\n  - Update the resize behavior to account for alignment:\n    - If alignment is right, compute new width from the container’s right edge; move the resize handle to the left bottom with \"cursor-nesw-resize\".\n    - Otherwise, compute new width from the left edge; place the resize handle on the right bottom with \"cursor-nwse-resize\".\n  - Keep selection overlay non-interactive by adding pointer-events-none.\n\n2) Node view resolves both display and download sources\n- In packages/editor/src/core/extensions/custom-image/components/node-view.tsx:\n  - Add resolvedDownloadSrc state.\n  - When imgNodeSrc changes, call extension.options.getImageSource and getImageDownloadSource, and set both resolvedSrc and resolvedDownloadSrc.\n  - Pass downloadSrc to the block component.\n\n3) Image toolbar components\n- Add an alignment dropdown action:\n  - packages/editor/src/core/extensions/custom-image/components/toolbar/alignment.tsx\n  - Uses @plane/hooks useOutsideClickDetector to close on outside click.\n  - Presents IMAGE_ALIGNMENT_OPTIONS and calls handleChange(option.value), while toggling toolbar visibility via toggleToolbarViewStatus when open.\n- Add a download action button:\n  - packages/editor/src/core/extensions/custom-image/components/toolbar/download.tsx\n  - Clicking opens the downloadSrc in a new tab.\n- Split fullscreen into modal and root action:\n  - packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/modal.tsx\n    - Render a fullscreen image viewer inside a portal element #editor-portal if present, otherwise inline with a console warning.\n    - Props: aspectRatio, isFullScreenEnabled, downloadSrc, src, toggleFullScreenMode, width.\n    - Support zoom (MIN_ZOOM=0.5 to MAX_ZOOM=2) with +/- buttons, mouse wheel with ctrlKey or metaKey, and dragging when larger than viewport; provide accessible aria labels.\n  - packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/root.tsx\n    - Manage isFullScreenEnabled state and toggleToolbarViewStatus when modal is open.\n    - Render the modal and a launcher button with tooltip.\n  - packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/index.ts should export from ./root.\n- Replace old toolbar root with a new composition:\n  - packages/editor/src/core/extensions/custom-image/components/toolbar/root.tsx\n    - Render a persistent toolbar wrapper that becomes visible on hover or when any child UI is active.\n    - Include ImageDownloadAction, ImageAlignmentAction, and ImageFullScreenActionRoot.\n\n4) Alignment attribute and defaults\n- Add a new alignment attribute (default \"left\") to images:\n  - packages/editor/src/core/extensions/image/extension-config.tsx: add attribute alignment with default \"left\".\n  - packages/editor/src/core/extensions/custom-image/types.ts: add ECustomImageAttributeNames.ALIGNMENT and type TCustomImageAlignment (\"left\" | \"center\" | \"right\"); include alignment in TCustomImageAttributes.\n  - packages/editor/src/core/extensions/custom-image/utils.ts: include ALIGNMENT in DEFAULT_CUSTOM_IMAGE_ATTRIBUTES and export IMAGE_ALIGNMENT_OPTIONS with lucide-react icons AlignLeft, AlignCenter, AlignRight.\n\n5) File handler contract and wiring for download URLs\n- Extend the read-only file handler:\n  - packages/editor/src/core/types/config.ts: in TReadOnlyFileHandler add getAssetDownloadSrc(path: string) => Promise<string>.\n- Propagate the new option into the custom image extension:\n  - packages/editor/src/core/extensions/custom-image/extension.ts: read getAssetDownloadSrc from fileHandler and expose it to the extension as getImageDownloadSource alongside getImageSource and restoreImage.\n- In the web app, implement getAssetDownloadSrc using utils:\n  - web/core/hooks/editor/use-editor-config.ts: import getEditorAssetDownloadSrc from @plane/utils; return full download URLs for project/workspace or the original URL if it already starts with http.\n\n6) Portal container in app layouts\n- Render a portal container in both apps so the fullscreen modal can mount into it:\n  - space/app/layout.tsx: add <div id=\"editor-portal\" /> inside <body>.\n  - web/app/layout.tsx: add <div id=\"editor-portal\" /> alongside existing context menu portal.\n\n7) Editor package dependency\n- packages/editor/package.json: add @plane/hooks to dependencies because the alignment dropdown uses useOutsideClickDetector.\n\nAcceptance criteria\n- For any inserted image (custom image block):\n  - A toolbar appears on hover with buttons for Download, Align, and Fullscreen.\n  - Download opens a proper download URL in a new tab.\n  - Align toggles left/center/right and persists via node attrs; visual position updates accordingly; resize handle flips for right alignment and resizing calculates from the correct edge.\n  - Fullscreen opens a modal rendered via #editor-portal; supports zoom via +/- buttons and ctrl/meta wheel, drag when zoomed, and includes accessible aria labels; includes download and open-in-new-tab actions inside the modal.\n- The base image extension also supports the alignment attribute with default \"left\".\n- No runtime errors if #editor-portal does not exist; the modal renders inline with a console warning.\n- Type contracts updated so getAssetDownloadSrc is available in read-only handlers and used to resolve downloadSrc.",
      "prompt": "Add image download and alignment controls to the editor’s image block and update the fullscreen viewer to render via a dedicated portal. The toolbar should let users download the image, change its alignment (left/center/right), and open a fullscreen viewer. Alignment should affect both the on-page layout and how resizing works for right-aligned images. The fullscreen modal should render into a body-level portal, support zoom (keyboard and trackpad with ctrl/meta), panning when zoomed, and provide download and open-in-new-tab actions. Update the editor’s file handler contract to provide a download URL generator and wire it through to the image node so the toolbar and modal receive a valid downloadSrc. Ensure both the web and space apps include the portal container in their layouts.",
      "supplementalFiles": [
        "packages/utils/src/editor.ts",
        "packages/editor/src/core/constants/extension.ts",
        "packages/editor/src/core/helpers/get-extension-storage.ts",
        "packages/editor/src/core/extensions/image/extension.tsx",
        "web/core/components/pages/navigation-pane/tab-panels/assets.tsx",
        "packages/editor/src/core/types/editor.ts"
      ],
      "fileDiffs": [
        {
          "path": "packages/editor/package.json",
          "status": "modified",
          "diff": "Index: packages/editor/package.json\n===================================================================\n--- packages/editor/package.json\tba6b822 (parent)\n+++ packages/editor/package.json\tf679628 (commit)\n@@ -38,8 +38,9 @@\n     \"@floating-ui/react\": \"^0.26.4\",\n     \"@headlessui/react\": \"^1.7.3\",\n     \"@hocuspocus/provider\": \"^2.15.0\",\n     \"@plane/constants\": \"*\",\n+    \"@plane/hooks\": \"*\",\n     \"@plane/types\": \"*\",\n     \"@plane/ui\": \"*\",\n     \"@plane/utils\": \"*\",\n     \"@tiptap/core\": \"2.10.4\",\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/block.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/block.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/block.tsx\tba6b822 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/block.tsx\tf679628 (commit)\n@@ -16,8 +16,9 @@\n   imageFromFileSystem: string | undefined;\n   setEditorContainer: (editorContainer: HTMLDivElement | null) => void;\n   setFailedToLoadImage: (isError: boolean) => void;\n   src: string | undefined;\n+  downloadSrc: string | undefined;\n };\n \n export const CustomImageBlock: React.FC<CustomImageBlockProps> = (props) => {\n   // props\n@@ -31,11 +32,18 @@\n     selected,\n     setEditorContainer,\n     setFailedToLoadImage,\n     src: resolvedImageSrc,\n+    downloadSrc: resolvedDownloadSrc,\n     updateAttributes,\n   } = props;\n-  const { width: nodeWidth, height: nodeHeight, aspectRatio: nodeAspectRatio, src: imgNodeSrc } = node.attrs;\n+  const {\n+    width: nodeWidth,\n+    height: nodeHeight,\n+    aspectRatio: nodeAspectRatio,\n+    src: imgNodeSrc,\n+    alignment: nodeAlignment,\n+  } = node.attrs;\n   // states\n   const [size, setSize] = useState<TCustomImageSize>({\n     width: ensurePixelString(nodeWidth, \"35%\") ?? \"35%\",\n     height: ensurePixelString(nodeHeight, \"auto\") ?? \"auto\",\n@@ -130,14 +138,19 @@\n       if (!containerRef.current || !containerRect.current || !size.aspectRatio) return;\n \n       const clientX = \"touches\" in e ? e.touches[0].clientX : e.clientX;\n \n-      const newWidth = Math.max(clientX - containerRect.current.left, MIN_SIZE);\n-      const newHeight = newWidth / size.aspectRatio;\n-\n-      setSize((prevSize) => ({ ...prevSize, width: `${newWidth}px`, height: `${newHeight}px` }));\n+      if (nodeAlignment === \"right\") {\n+        const newWidth = Math.max(containerRect.current.right - clientX, MIN_SIZE);\n+        const newHeight = newWidth / size.aspectRatio;\n+        setSize((prevSize) => ({ ...prevSize, width: `${newWidth}px`, height: `${newHeight}px` }));\n+      } else {\n+        const newWidth = Math.max(clientX - containerRect.current.left, MIN_SIZE);\n+        const newHeight = newWidth / size.aspectRatio;\n+        setSize((prevSize) => ({ ...prevSize, width: `${newWidth}px`, height: `${newHeight}px` }));\n+      }\n     },\n-    [size.aspectRatio]\n+    [nodeAlignment, size.aspectRatio]\n   );\n \n   const handleResizeEnd = useCallback(() => {\n     setIsResizing(false);\n@@ -187,118 +200,127 @@\n   const showImageLoader = !(resolvedImageSrc || imageFromFileSystem) || !initialResizeComplete || hasErroredOnFirstLoad;\n   // show the image upload status only when the resolvedImageSrc is not ready\n   const showUploadStatus = !resolvedImageSrc;\n   // show the image utils only if the remote image's (post upload) src is set and the initial resize is complete (but not while we're showing the preview imageFromFileSystem)\n-  const showImageUtils = resolvedImageSrc && initialResizeComplete;\n+  const showImageToolbar = resolvedImageSrc && resolvedDownloadSrc && initialResizeComplete;\n   // show the image resizer only if the editor is editable, the remote image's (post upload) src is set and the initial resize is complete (but not while we're showing the preview imageFromFileSystem)\n   const showImageResizer = editor.isEditable && resolvedImageSrc && initialResizeComplete;\n   // show the preview image from the file system if the remote image's src is not set\n   const displayedImageSrc = resolvedImageSrc || imageFromFileSystem;\n \n   return (\n     <div\n       id={getImageBlockId(node.attrs.id ?? \"\")}\n-      ref={containerRef}\n-      className=\"group/image-component relative inline-block max-w-full\"\n-      onMouseDown={handleImageMouseDown}\n-      style={{\n-        width: size.width,\n-        ...(size.aspectRatio && { aspectRatio: size.aspectRatio }),\n-      }}\n+      className={cn(\"w-fit max-w-full transition-all\", {\n+        \"ml-[50%] -translate-x-1/2\": nodeAlignment === \"center\",\n+        \"ml-[100%] -translate-x-full\": nodeAlignment === \"right\",\n+      })}\n     >\n-      {showImageLoader && (\n-        <div\n-          className=\"animate-pulse bg-custom-background-80 rounded-md\"\n-          style={{ width: size.width, height: size.height }}\n-        />\n-      )}\n-      <img\n-        ref={imageRef}\n-        src={displayedImageSrc}\n-        onLoad={handleImageLoad}\n-        onError={async (e) => {\n-          // for old image extension this command doesn't exist or if the image failed to load for the first time\n-          if (!extension.options.restoreImage || hasTriedRestoringImageOnce) {\n-            setFailedToLoadImage(true);\n-            return;\n-          }\n-\n-          try {\n-            setHasErroredOnFirstLoad(true);\n-            // this is a type error from tiptap, don't remove await until it's fixed\n-            if (!imgNodeSrc) {\n-              throw new Error(\"No source image to restore from\");\n-            }\n-            await extension.options.restoreImage?.(imgNodeSrc);\n-            if (!imageRef.current) {\n-              throw new Error(\"Image reference not found\");\n-            }\n-            if (!resolvedImageSrc) {\n-              throw new Error(\"No resolved image source available\");\n-            }\n-            imageRef.current.src = resolvedImageSrc;\n-          } catch {\n-            // if the image failed to even restore, then show the error state\n-            setFailedToLoadImage(true);\n-            console.error(\"Error while loading image\", e);\n-          } finally {\n-            setHasErroredOnFirstLoad(false);\n-            setHasTriedRestoringImageOnce(true);\n-          }\n-        }}\n-        width={size.width}\n-        className={cn(\"image-component block rounded-md\", {\n-          // hide the image while the background calculations of the image loader are in progress (to avoid flickering) and show the loader until then\n-          hidden: showImageLoader,\n-          \"read-only-image\": !editor.isEditable,\n-          \"blur-sm opacity-80 loading-image\": !resolvedImageSrc,\n-        })}\n+      <div\n+        ref={containerRef}\n+        className=\"group/image-component relative inline-block max-w-full\"\n+        onMouseDown={handleImageMouseDown}\n         style={{\n           width: size.width,\n           ...(size.aspectRatio && { aspectRatio: size.aspectRatio }),\n         }}\n-      />\n-      {showUploadStatus && node.attrs.id && <ImageUploadStatus editor={editor} nodeId={node.attrs.id} />}\n-      {showImageUtils && (\n-        <ImageToolbarRoot\n-          containerClassName={\n-            \"absolute top-1 right-1 z-20 bg-black/40 rounded opacity-0 pointer-events-none group-hover/image-component:opacity-100 group-hover/image-component:pointer-events-auto transition-opacity\"\n-          }\n-          image={{\n+      >\n+        {showImageLoader && (\n+          <div\n+            className=\"animate-pulse bg-custom-background-80 rounded-md\"\n+            style={{ width: size.width, height: size.height }}\n+          />\n+        )}\n+        <img\n+          ref={imageRef}\n+          src={displayedImageSrc}\n+          onLoad={handleImageLoad}\n+          onError={async (e) => {\n+            // for old image extension this command doesn't exist or if the image failed to load for the first time\n+            if (!extension.options.restoreImage || hasTriedRestoringImageOnce) {\n+              setFailedToLoadImage(true);\n+              return;\n+            }\n+\n+            try {\n+              setHasErroredOnFirstLoad(true);\n+              // this is a type error from tiptap, don't remove await until it's fixed\n+              if (!imgNodeSrc) {\n+                throw new Error(\"No source image to restore from\");\n+              }\n+              await extension.options.restoreImage?.(imgNodeSrc);\n+              if (!imageRef.current) {\n+                throw new Error(\"Image reference not found\");\n+              }\n+              if (!resolvedImageSrc) {\n+                throw new Error(\"No resolved image source available\");\n+              }\n+              imageRef.current.src = resolvedImageSrc;\n+            } catch {\n+              // if the image failed to even restore, then show the error state\n+              setFailedToLoadImage(true);\n+              console.error(\"Error while loading image\", e);\n+            } finally {\n+              setHasErroredOnFirstLoad(false);\n+              setHasTriedRestoringImageOnce(true);\n+            }\n+          }}\n+          width={size.width}\n+          className={cn(\"image-component block rounded-md\", {\n+            // hide the image while the background calculations of the image loader are in progress (to avoid flickering) and show the loader until then\n+            hidden: showImageLoader,\n+            \"read-only-image\": !editor.isEditable,\n+            \"blur-sm opacity-80 loading-image\": !resolvedImageSrc,\n+          })}\n+          style={{\n             width: size.width,\n-            height: size.height,\n-            aspectRatio: size.aspectRatio === null ? 1 : size.aspectRatio,\n-            src: resolvedImageSrc,\n+            ...(size.aspectRatio && { aspectRatio: size.aspectRatio }),\n           }}\n         />\n-      )}\n-      {selected && displayedImageSrc === resolvedImageSrc && (\n-        <div className=\"absolute inset-0 size-full bg-custom-primary-500/30\" />\n-      )}\n-      {showImageResizer && (\n-        <>\n-          <div\n-            className={cn(\n-              \"absolute inset-0 border-2 border-custom-primary-100 pointer-events-none rounded-md transition-opacity duration-100 ease-in-out\",\n-              {\n-                \"opacity-100\": isResizing,\n-                \"opacity-0 group-hover/image-component:opacity-100\": !isResizing,\n-              }\n-            )}\n+        {showUploadStatus && node.attrs.id && <ImageUploadStatus editor={editor} nodeId={node.attrs.id} />}\n+        {showImageToolbar && (\n+          <ImageToolbarRoot\n+            alignment={nodeAlignment ?? \"left\"}\n+            width={size.width}\n+            height={size.height}\n+            aspectRatio={size.aspectRatio === null ? 1 : size.aspectRatio}\n+            src={resolvedImageSrc}\n+            downloadSrc={resolvedDownloadSrc}\n+            handleAlignmentChange={(alignment) =>\n+              updateAttributesSafely({ alignment }, \"Failed to update attributes while changing alignment:\")\n+            }\n           />\n-          <div\n-            className={cn(\n-              \"absolute bottom-0 right-0 translate-y-1/2 translate-x-1/2 size-4 rounded-full bg-custom-primary-100 border-2 border-white cursor-nwse-resize transition-opacity duration-100 ease-in-out\",\n-              {\n-                \"opacity-100 pointer-events-auto\": isResizing,\n-                \"opacity-0 pointer-events-none group-hover/image-component:opacity-100 group-hover/image-component:pointer-events-auto\":\n-                  !isResizing,\n-              }\n-            )}\n-            onMouseDown={handleResizeStart}\n-            onTouchStart={handleResizeStart}\n-          />\n-        </>\n-      )}\n+        )}\n+        {selected && displayedImageSrc === resolvedImageSrc && (\n+          <div className=\"absolute inset-0 size-full bg-custom-primary-500/30 pointer-events-none\" />\n+        )}\n+        {showImageResizer && (\n+          <>\n+            <div\n+              className={cn(\n+                \"absolute inset-0 border-2 border-custom-primary-100 pointer-events-none rounded-md transition-opacity duration-100 ease-in-out\",\n+                {\n+                  \"opacity-100\": isResizing,\n+                  \"opacity-0 group-hover/image-component:opacity-100\": !isResizing,\n+                }\n+              )}\n+            />\n+            <div\n+              className={cn(\n+                \"absolute bottom-0 translate-y-1/2 size-4 rounded-full bg-custom-primary-100 border-2 border-white transition-opacity duration-100 ease-in-out\",\n+                {\n+                  \"opacity-100 pointer-events-auto\": isResizing,\n+                  \"opacity-0 pointer-events-none group-hover/image-component:opacity-100 group-hover/image-component:pointer-events-auto\":\n+                    !isResizing,\n+                  \"left-0 -translate-x-1/2 cursor-nesw-resize\": nodeAlignment === \"right\",\n+                  \"right-0 translate-x-1/2 cursor-nwse-resize\": nodeAlignment !== \"right\",\n+                }\n+              )}\n+              onMouseDown={handleResizeStart}\n+              onTouchStart={handleResizeStart}\n+            />\n+          </>\n+        )}\n+      </div>\n     </div>\n   );\n };\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/node-view.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/node-view.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/node-view.tsx\tba6b822 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/node-view.tsx\tf679628 (commit)\n@@ -25,8 +25,9 @@\n   const { src: imgNodeSrc } = node.attrs;\n \n   const [isUploaded, setIsUploaded] = useState(false);\n   const [resolvedSrc, setResolvedSrc] = useState<string | undefined>(undefined);\n+  const [resolvedDownloadSrc, setResolvedDownloadSrc] = useState<string | undefined>(undefined);\n   const [imageFromFileSystem, setImageFromFileSystem] = useState<string | undefined>(undefined);\n   const [failedToLoadImage, setFailedToLoadImage] = useState(false);\n \n   const [editorContainer, setEditorContainer] = useState<HTMLDivElement | null>(null);\n@@ -52,14 +53,17 @@\n \n   useEffect(() => {\n     if (!imgNodeSrc) {\n       setResolvedSrc(undefined);\n+      setResolvedDownloadSrc(undefined);\n       return;\n     }\n \n     const getImageSource = async () => {\n       const url = await extension.options.getImageSource?.(imgNodeSrc);\n       setResolvedSrc(url);\n+      const downloadUrl = await extension.options.getImageDownloadSource?.(imgNodeSrc);\n+      setResolvedDownloadSrc(downloadUrl);\n     };\n     getImageSource();\n   }, [imgNodeSrc, extension.options]);\n \n@@ -72,8 +76,9 @@\n             imageFromFileSystem={imageFromFileSystem}\n             setEditorContainer={setEditorContainer}\n             setFailedToLoadImage={setFailedToLoadImage}\n             src={resolvedSrc}\n+            downloadSrc={resolvedDownloadSrc}\n             {...props}\n           />\n         ) : (\n           <CustomImageUploader\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/toolbar/alignment.tsx",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/toolbar/alignment.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/toolbar/alignment.tsx\tba6b822 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/toolbar/alignment.tsx\tf679628 (commit)\n@@ -0,0 +1,63 @@\n+import { ChevronDown } from \"lucide-react\";\n+import { useEffect, useRef, useState } from \"react\";\n+// plane imports\n+import { useOutsideClickDetector } from \"@plane/hooks\";\n+import { Tooltip } from \"@plane/ui\";\n+// local imports\n+import type { TCustomImageAlignment } from \"../../types\";\n+import { IMAGE_ALIGNMENT_OPTIONS } from \"../../utils\";\n+\n+type Props = {\n+  activeAlignment: TCustomImageAlignment;\n+  handleChange: (alignment: TCustomImageAlignment) => void;\n+  toggleToolbarViewStatus: (val: boolean) => void;\n+};\n+\n+export const ImageAlignmentAction: React.FC<Props> = (props) => {\n+  const { activeAlignment, handleChange, toggleToolbarViewStatus } = props;\n+  // states\n+  const [isDropdownOpen, setIsDropdownOpen] = useState(false);\n+  // refs\n+  const dropdownRef = useRef<HTMLDivElement>(null);\n+  // derived values\n+  const activeAlignmentDetails = IMAGE_ALIGNMENT_OPTIONS.find((option) => option.value === activeAlignment);\n+\n+  useOutsideClickDetector(dropdownRef, () => setIsDropdownOpen(false));\n+\n+  useEffect(() => {\n+    toggleToolbarViewStatus(isDropdownOpen);\n+  }, [isDropdownOpen, toggleToolbarViewStatus]);\n+\n+  return (\n+    <div ref={dropdownRef} className=\"h-full relative\">\n+      <Tooltip tooltipContent=\"Align\">\n+        <button\n+          type=\"button\"\n+          className=\"h-full flex items-center gap-1 text-white/60 hover:text-white transition-colors\"\n+          onClick={() => setIsDropdownOpen((prev) => !prev)}\n+        >\n+          {activeAlignmentDetails && <activeAlignmentDetails.icon className=\"flex-shrink-0 size-3\" />}\n+          <ChevronDown className=\"flex-shrink-0 size-2\" />\n+        </button>\n+      </Tooltip>\n+      {isDropdownOpen && (\n+        <div className=\"absolute top-full left-1/2 -translate-x-1/2 mt-0.5 h-7 bg-black/80 flex items-center gap-2 px-2 rounded\">\n+          {IMAGE_ALIGNMENT_OPTIONS.map((option) => (\n+            <Tooltip key={option.value} tooltipContent={option.label}>\n+              <button\n+                type=\"button\"\n+                className=\"flex-shrink-0 h-full grid place-items-center text-white/60 hover:text-white transition-colors\"\n+                onClick={() => {\n+                  handleChange(option.value);\n+                  setIsDropdownOpen(false);\n+                }}\n+              >\n+                <option.icon className=\"size-3\" />\n+              </button>\n+            </Tooltip>\n+          ))}\n+        </div>\n+      )}\n+    </div>\n+  );\n+};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/toolbar/download.tsx",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/toolbar/download.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/toolbar/download.tsx\tba6b822 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/toolbar/download.tsx\tf679628 (commit)\n@@ -0,0 +1,24 @@\n+import { Download } from \"lucide-react\";\n+// plane imports\n+import { Tooltip } from \"@plane/ui\";\n+\n+type Props = {\n+  src: string;\n+};\n+\n+export const ImageDownloadAction: React.FC<Props> = (props) => {\n+  const { src } = props;\n+\n+  return (\n+    <Tooltip tooltipContent=\"Download\">\n+      <button\n+        type=\"button\"\n+        onClick={() => window.open(src, \"_blank\")}\n+        className=\"flex-shrink-0 h-full grid place-items-center text-white/60 hover:text-white transition-colors\"\n+        aria-label=\"Download image\"\n+      >\n+        <Download className=\"size-3\" />\n+      </button>\n+    </Tooltip>\n+  );\n+};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/index.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/index.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/index.ts\tba6b822 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/index.ts\tf679628 (commit)\n@@ -0,0 +1,1 @@\n+export * from \"./root\";\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/modal.tsx",
          "status": "renamed",
          "oldPath": "packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen.tsx",
          "diff": "===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen.tsx\tba6b822 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/modal.tsx\tf679628 (commit)\n@@ -1,38 +1,40 @@\n-import { ExternalLink, Maximize, Minus, Plus, X } from \"lucide-react\";\n-import { useCallback, useEffect, useMemo, useState, useRef } from \"react\";\n+import { Download, ExternalLink, Minus, Plus, X } from \"lucide-react\";\n+import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\n+import ReactDOM from \"react-dom\";\n // plane imports\n import { cn } from \"@plane/utils\";\n \n-type Props = {\n-  image: {\n-    width: string;\n-    height: string;\n-    aspectRatio: number;\n-    src: string;\n-  };\n-  isOpen: boolean;\n-  toggleFullScreenMode: (val: boolean) => void;\n-};\n-\n const MIN_ZOOM = 0.5;\n const MAX_ZOOM = 2;\n const ZOOM_SPEED = 0.05;\n const ZOOM_STEPS = [0.5, 1, 1.5, 2];\n \n-export const ImageFullScreenAction: React.FC<Props> = (props) => {\n-  const { image, isOpen: isFullScreenEnabled, toggleFullScreenMode } = props;\n-  const { src, width, aspectRatio } = image;\n+type Props = {\n+  aspectRatio: number;\n+  isFullScreenEnabled: boolean;\n+  downloadSrc: string;\n+  src: string;\n+  toggleFullScreenMode: (val: boolean) => void;\n+  width: string;\n+};\n \n+const ImageFullScreenModalWithoutPortal = (props: Props) => {\n+  const { aspectRatio, isFullScreenEnabled, downloadSrc, src, toggleFullScreenMode, width } = props;\n+  // refs\n+  const dragStart = useRef({ x: 0, y: 0 });\n+  const dragOffset = useRef({ x: 0, y: 0 });\n+\n   const [magnification, setMagnification] = useState<number>(1);\n   const [initialMagnification, setInitialMagnification] = useState(1);\n   const [isDragging, setIsDragging] = useState(false);\n-  const dragStart = useRef({ x: 0, y: 0 });\n-  const dragOffset = useRef({ x: 0, y: 0 });\n   const modalRef = useRef<HTMLDivElement>(null);\n   const imgRef = useRef<HTMLImageElement | null>(null);\n \n-  const widthInNumber = useMemo(() => Number(width?.replace(\"px\", \"\")), [width]);\n+  const widthInNumber = useMemo(() => {\n+    if (!width) return 0;\n+    return Number(width.replace(\"px\", \"\"));\n+  }, [width]);\n \n   const setImageRef = useCallback(\n     (node: HTMLImageElement | null) => {\n       if (!node || !isFullScreenEnabled) return;\n@@ -147,9 +149,9 @@\n \n       e.preventDefault();\n \n       // Handle pinch-to-zoom\n-      if (e.ctrlKey) {\n+      if (e.ctrlKey || e.metaKey) {\n         const delta = e.deltaY;\n         setMagnification((prev) => {\n           const newZoom = prev * (1 - delta * ZOOM_SPEED);\n           const clampedZoom = Math.min(Math.max(newZoom, MIN_ZOOM), MAX_ZOOM);\n@@ -164,9 +166,9 @@\n         });\n         return;\n       }\n     },\n-    [isFullScreenEnabled, magnification]\n+    [isFullScreenEnabled]\n   );\n \n   // Event listeners\n   useEffect(() => {\n@@ -184,85 +186,100 @@\n       window.removeEventListener(\"wheel\", handleWheel);\n     };\n   }, [isFullScreenEnabled, handleKeyDown, handleMouseMove, handleMouseUp, handleWheel]);\n \n+  if (!isFullScreenEnabled) return null;\n+\n   return (\n-    <>\n+    <div\n+      className={cn(\"fixed inset-0 size-full z-30 bg-black/90 opacity-0 pointer-events-none transition-opacity\", {\n+        \"opacity-100 pointer-events-auto editor-image-full-screen-modal\": isFullScreenEnabled,\n+        \"cursor-default\": !isDragging,\n+        \"cursor-grabbing\": isDragging,\n+      })}\n+      role=\"dialog\"\n+      aria-modal=\"true\"\n+      aria-label=\"Fullscreen image viewer\"\n+    >\n       <div\n-        className={cn(\"fixed inset-0 size-full z-20 bg-black/90 opacity-0 pointer-events-none transition-opacity\", {\n-          \"opacity-100 pointer-events-auto editor-image-full-screen-modal\": isFullScreenEnabled,\n-          \"cursor-default\": !isDragging,\n-          \"cursor-grabbing\": isDragging,\n-        })}\n+        ref={modalRef}\n+        onMouseDown={(e) => e.target === modalRef.current && handleClose()}\n+        className=\"relative size-full grid place-items-center overflow-hidden\"\n       >\n-        <div\n-          ref={modalRef}\n-          onMouseDown={(e) => e.target === modalRef.current && handleClose()}\n-          className=\"relative size-full grid place-items-center overflow-hidden\"\n+        <button\n+          type=\"button\"\n+          onClick={handleClose}\n+          className=\"absolute top-10 right-10 size-8 grid place-items-center\"\n+          aria-label=\"Close image viewer\"\n         >\n-          <button\n-            type=\"button\"\n-            onClick={handleClose}\n-            className=\"absolute top-10 right-10 size-8 grid place-items-center\"\n-          >\n-            <X className=\"size-8 text-white/60 hover:text-white transition-colors\" />\n-          </button>\n-          <img\n-            ref={setImageRef}\n-            src={src}\n-            className=\"read-only-image rounded-lg\"\n-            style={{\n-              width: `${widthInNumber * initialMagnification}px`,\n-              maxWidth: \"none\",\n-              maxHeight: \"none\",\n-              aspectRatio,\n-              position: \"relative\",\n-              transform: `scale(${magnification})`,\n-              transformOrigin: \"center\",\n-              transition: \"width 0.2s ease, transform 0.2s ease\",\n-            }}\n-            onMouseDown={handleMouseDown}\n-          />\n-          <div className=\"fixed bottom-10 left-1/2 -translate-x-1/2 flex items-center justify-center gap-1 rounded-md border border-white/20 py-2 divide-x divide-white/20 bg-black\">\n-            <div className=\"flex items-center\">\n-              <button\n-                type=\"button\"\n-                onClick={() => handleMagnification(\"decrease\")}\n-                className=\"size-6 grid place-items-center text-white/60 hover:text-white disabled:text-white/30 transition-colors duration-200\"\n-                disabled={magnification <= MIN_ZOOM}\n-              >\n-                <Minus className=\"size-4\" />\n-              </button>\n-              <span className=\"text-sm w-12 text-center text-white\">{Math.round(100 * magnification)}%</span>\n-              <button\n-                type=\"button\"\n-                onClick={() => handleMagnification(\"increase\")}\n-                className=\"size-6 grid place-items-center text-white/60 hover:text-white disabled:text-white/30 transition-colors duration-200\"\n-                disabled={magnification >= MAX_ZOOM}\n-              >\n-                <Plus className=\"size-4\" />\n-              </button>\n-            </div>\n+          <X className=\"size-8 text-white/60 hover:text-white transition-colors\" />\n+        </button>\n+        <img\n+          ref={setImageRef}\n+          src={src}\n+          className=\"read-only-image rounded-lg\"\n+          style={{\n+            width: `${widthInNumber * initialMagnification}px`,\n+            maxWidth: \"none\",\n+            maxHeight: \"none\",\n+            aspectRatio,\n+            position: \"relative\",\n+            transform: `scale(${magnification})`,\n+            transformOrigin: \"center\",\n+            transition: \"width 0.2s ease, transform 0.2s ease\",\n+          }}\n+          onMouseDown={handleMouseDown}\n+        />\n+        <div className=\"fixed bottom-10 left-1/2 -translate-x-1/2 flex items-center justify-center gap-1 rounded-md border border-white/20 py-2 divide-x divide-white/20 bg-black\">\n+          <div className=\"flex items-center\">\n             <button\n               type=\"button\"\n-              onClick={() => window.open(src, \"_blank\")}\n-              className=\"flex-shrink-0 size-8 grid place-items-center text-white/60 hover:text-white transition-colors duration-200\"\n+              onClick={() => handleMagnification(\"decrease\")}\n+              className=\"size-6 grid place-items-center text-white/60 hover:text-white disabled:text-white/30 transition-colors duration-200\"\n+              disabled={magnification <= MIN_ZOOM}\n+              aria-label=\"Zoom out\"\n             >\n-              <ExternalLink className=\"size-4\" />\n+              <Minus className=\"size-4\" />\n             </button>\n+            <span className=\"text-sm w-12 text-center text-white\">{Math.round(100 * magnification)}%</span>\n+            <button\n+              type=\"button\"\n+              onClick={() => handleMagnification(\"increase\")}\n+              className=\"size-6 grid place-items-center text-white/60 hover:text-white disabled:text-white/30 transition-colors duration-200\"\n+              disabled={magnification >= MAX_ZOOM}\n+              aria-label=\"Zoom in\"\n+            >\n+              <Plus className=\"size-4\" />\n+            </button>\n           </div>\n+          <button\n+            type=\"button\"\n+            onClick={() => window.open(downloadSrc, \"_blank\")}\n+            className=\"flex-shrink-0 size-8 grid place-items-center text-white/60 hover:text-white transition-colors duration-200\"\n+            aria-label=\"Download image\"\n+          >\n+            <Download className=\"size-4\" />\n+          </button>\n+          <button\n+            type=\"button\"\n+            onClick={() => window.open(src, \"_blank\")}\n+            className=\"flex-shrink-0 size-8 grid place-items-center text-white/60 hover:text-white transition-colors duration-200\"\n+            aria-label=\"Open image in new tab\"\n+          >\n+            <ExternalLink className=\"size-4\" />\n+          </button>\n         </div>\n       </div>\n-      <button\n-        type=\"button\"\n-        onClick={(e) => {\n-          e.preventDefault();\n-          e.stopPropagation();\n-          toggleFullScreenMode(true);\n-        }}\n-        className=\"size-5 grid place-items-center hover:bg-black/40 text-white rounded transition-colors\"\n-      >\n-        <Maximize className=\"size-3\" />\n-      </button>\n-    </>\n+    </div>\n   );\n };\n+\n+export const ImageFullScreenModal: React.FC<Props> = (props) => {\n+  let modal = <ImageFullScreenModalWithoutPortal {...props} />;\n+  const portal = document.querySelector(\"#editor-portal\");\n+  if (portal) {\n+    modal = ReactDOM.createPortal(modal, portal);\n+  } else {\n+    console.warn(\"Portal element #editor-portal not found. Rendering inline.\");\n+  }\n+  return modal;\n+};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/root.tsx",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/root.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/root.tsx\tba6b822 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/toolbar/full-screen/root.tsx\tf679628 (commit)\n@@ -0,0 +1,56 @@\n+import { Maximize } from \"lucide-react\";\n+import { useEffect, useState } from \"react\";\n+// plane imports\n+import { Tooltip } from \"@plane/ui\";\n+// local imports\n+import { ImageFullScreenModal } from \"./modal\";\n+\n+type Props = {\n+  image: {\n+    downloadSrc: string;\n+    src: string;\n+    height: string;\n+    width: string;\n+    aspectRatio: number;\n+  };\n+  toggleToolbarViewStatus: (val: boolean) => void;\n+};\n+\n+export const ImageFullScreenActionRoot: React.FC<Props> = (props) => {\n+  const { image, toggleToolbarViewStatus } = props;\n+  // states\n+  const [isFullScreenEnabled, setIsFullScreenEnabled] = useState(false);\n+  // derived values\n+  const { downloadSrc, src, width, aspectRatio } = image;\n+\n+  useEffect(() => {\n+    toggleToolbarViewStatus(isFullScreenEnabled);\n+  }, [isFullScreenEnabled, toggleToolbarViewStatus]);\n+\n+  return (\n+    <>\n+      <ImageFullScreenModal\n+        aspectRatio={aspectRatio}\n+        isFullScreenEnabled={isFullScreenEnabled}\n+        src={src}\n+        downloadSrc={downloadSrc}\n+        width={width}\n+        toggleFullScreenMode={setIsFullScreenEnabled}\n+      />\n+      <Tooltip tooltipContent=\"View in full screen\">\n+        <button\n+          type=\"button\"\n+          onClick={(e) => {\n+            e.preventDefault();\n+            e.stopPropagation();\n+            setIsFullScreenEnabled(true);\n+          }}\n+          className=\"flex-shrink-0 h-full grid place-items-center text-white/60 hover:text-white transition-colors\"\n+          aria-label=\"View image in full screen\"\n+        >\n+          <Maximize className=\"size-3\" />\n+        </button>\n+      </Tooltip>\n+    </>\n+  );\n+};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/toolbar/root.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/toolbar/root.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/toolbar/root.tsx\tba6b822 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/toolbar/root.tsx\tf679628 (commit)\n@@ -1,37 +1,45 @@\n import { useState } from \"react\";\n // plane imports\n import { cn } from \"@plane/utils\";\n // local imports\n-import { ImageFullScreenAction } from \"./full-screen\";\n+import type { TCustomImageAlignment } from \"../../types\";\n+import { ImageAlignmentAction } from \"./alignment\";\n+import { ImageDownloadAction } from \"./download\";\n+import { ImageFullScreenActionRoot } from \"./full-screen\";\n \n type Props = {\n-  containerClassName?: string;\n-  image: {\n-    width: string;\n-    height: string;\n-    aspectRatio: number;\n-    src: string;\n-  };\n+  alignment: TCustomImageAlignment;\n+  width: string;\n+  height: string;\n+  aspectRatio: number;\n+  src: string;\n+  downloadSrc: string;\n+  handleAlignmentChange: (alignment: TCustomImageAlignment) => void;\n };\n \n export const ImageToolbarRoot: React.FC<Props> = (props) => {\n-  const { containerClassName, image } = props;\n-  // state\n-  const [isFullScreenEnabled, setIsFullScreenEnabled] = useState(false);\n+  const { alignment, downloadSrc, handleAlignmentChange } = props;\n+  // states\n+  const [shouldShowToolbar, setShouldShowToolbar] = useState(false);\n \n   return (\n     <>\n       <div\n-        className={cn(containerClassName, {\n-          \"opacity-100 pointer-events-auto\": isFullScreenEnabled,\n-        })}\n+        className={cn(\n+          \"absolute top-1 right-1 h-7 z-20 bg-black/80 rounded flex items-center gap-2 px-2 opacity-0 pointer-events-none group-hover/image-component:opacity-100 group-hover/image-component:pointer-events-auto transition-opacity\",\n+          {\n+            \"opacity-100 pointer-events-auto\": shouldShowToolbar,\n+          }\n+        )}\n       >\n-        <ImageFullScreenAction\n-          image={image}\n-          isOpen={isFullScreenEnabled}\n-          toggleFullScreenMode={(val) => setIsFullScreenEnabled(val)}\n+        <ImageDownloadAction src={downloadSrc} />\n+        <ImageAlignmentAction\n+          activeAlignment={alignment}\n+          handleChange={handleAlignmentChange}\n+          toggleToolbarViewStatus={setShouldShowToolbar}\n         />\n+        <ImageFullScreenActionRoot image={props} toggleToolbarViewStatus={setShouldShowToolbar} />\n       </div>\n     </>\n   );\n };\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/extension.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/extension.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/extension.ts\tba6b822 (parent)\n+++ packages/editor/src/core/extensions/custom-image/extension.ts\tf679628 (commit)\n@@ -19,9 +19,9 @@\n \n export const CustomImageExtension = (props: Props) => {\n   const { fileHandler, isEditable } = props;\n   // derived values\n-  const { getAssetSrc, restore: restoreImageFn } = fileHandler;\n+  const { getAssetSrc, getAssetDownloadSrc, restore: restoreImageFn } = fileHandler;\n \n   return CustomImageExtensionConfig.extend({\n     selectable: isEditable,\n     draggable: isEditable,\n@@ -30,8 +30,9 @@\n       const upload = \"upload\" in fileHandler ? fileHandler.upload : undefined;\n \n       return {\n         ...this.parent?.(),\n+        getImageDownloadSource: getAssetDownloadSrc,\n         getImageSource: getAssetSrc,\n         restoreImage: restoreImageFn,\n         uploadImage: upload,\n       };\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/types.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/types.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/types.ts\tba6b822 (parent)\n+++ packages/editor/src/core/extensions/custom-image/types.ts\tf679628 (commit)\n@@ -7,8 +7,9 @@\n   WIDTH = \"width\",\n   HEIGHT = \"height\",\n   ASPECT_RATIO = \"aspectRatio\",\n   SOURCE = \"src\",\n+  ALIGNMENT = \"alignment\",\n }\n \n export type Pixel = `${number}px`;\n \n@@ -19,14 +20,17 @@\n   height: PixelAttribute<\"auto\">;\n   aspectRatio: number | null;\n };\n \n+export type TCustomImageAlignment = \"left\" | \"center\" | \"right\";\n+\n export type TCustomImageAttributes = {\n   [ECustomImageAttributeNames.ID]: string | null;\n   [ECustomImageAttributeNames.WIDTH]: PixelAttribute<\"35%\" | number> | null;\n   [ECustomImageAttributeNames.HEIGHT]: PixelAttribute<\"auto\" | number> | null;\n   [ECustomImageAttributeNames.ASPECT_RATIO]: number | null;\n   [ECustomImageAttributeNames.SOURCE]: string | null;\n+  [ECustomImageAttributeNames.ALIGNMENT]: TCustomImageAlignment;\n };\n \n export type UploadEntity = ({ event: \"insert\" } | { event: \"drop\"; file: File }) & { hasOpenedFileInputOnce?: boolean };\n \n@@ -36,8 +40,9 @@\n   event: \"insert\" | \"drop\";\n };\n \n export type CustomImageExtensionOptions = {\n+  getImageDownloadSource: TFileHandler[\"getAssetDownloadSrc\"];\n   getImageSource: TFileHandler[\"getAssetSrc\"];\n   restoreImage: TFileHandler[\"restore\"];\n   uploadImage?: TFileHandler[\"upload\"];\n };\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/utils.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/utils.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/utils.ts\tba6b822 (parent)\n+++ packages/editor/src/core/extensions/custom-image/utils.ts\tf679628 (commit)\n@@ -1,18 +1,20 @@\n import type { Editor } from \"@tiptap/core\";\n+import { AlignCenter, AlignLeft, AlignRight, type LucideIcon } from \"lucide-react\";\n // constants\n import { CORE_EXTENSIONS } from \"@/constants/extension\";\n // helpers\n import { getExtensionStorage } from \"@/helpers/get-extension-storage\";\n // local imports\n-import { ECustomImageAttributeNames, type Pixel, type TCustomImageAttributes } from \"./types\";\n+import { ECustomImageAttributeNames, TCustomImageAlignment, type Pixel, type TCustomImageAttributes } from \"./types\";\n \n export const DEFAULT_CUSTOM_IMAGE_ATTRIBUTES: TCustomImageAttributes = {\n   [ECustomImageAttributeNames.SOURCE]: null,\n   [ECustomImageAttributeNames.ID]: null,\n   [ECustomImageAttributeNames.WIDTH]: \"35%\",\n   [ECustomImageAttributeNames.HEIGHT]: \"auto\",\n   [ECustomImageAttributeNames.ASPECT_RATIO]: null,\n+  [ECustomImageAttributeNames.ALIGNMENT]: \"left\",\n };\n \n export const getImageComponentImageFileMap = (editor: Editor) =>\n   getExtensionStorage(editor, CORE_EXTENSIONS.CUSTOM_IMAGE)?.fileMap;\n@@ -31,5 +33,26 @@\n \n   return value;\n };\n \n+export const IMAGE_ALIGNMENT_OPTIONS: {\n+  label: string;\n+  value: TCustomImageAlignment;\n+  icon: LucideIcon;\n+}[] = [\n+  {\n+    label: \"Left\",\n+    value: \"left\",\n+    icon: AlignLeft,\n+  },\n+  {\n+    label: \"Center\",\n+    value: \"center\",\n+    icon: AlignCenter,\n+  },\n+  {\n+    label: \"Right\",\n+    value: \"right\",\n+    icon: AlignRight,\n+  },\n+];\n export const getImageBlockId = (id: string) => `editor-image-block-${id}`;\n"
        },
        {
          "path": "packages/editor/src/core/extensions/image/extension-config.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/image/extension-config.tsx\n===================================================================\n--- packages/editor/src/core/extensions/image/extension-config.tsx\tba6b822 (parent)\n+++ packages/editor/src/core/extensions/image/extension-config.tsx\tf679628 (commit)\n@@ -18,7 +18,10 @@\n       },\n       aspectRatio: {\n         default: null,\n       },\n+      alignment: {\n+        default: \"left\",\n+      },\n     };\n   },\n });\n"
        },
        {
          "path": "packages/editor/src/core/types/config.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/types/config.ts\n===================================================================\n--- packages/editor/src/core/types/config.ts\tba6b822 (parent)\n+++ packages/editor/src/core/types/config.ts\tf679628 (commit)\n@@ -2,8 +2,9 @@\n import { TWebhookConnectionQueryParams } from \"@plane/types\";\n \n export type TReadOnlyFileHandler = {\n   checkIfAssetExists: (assetId: string) => Promise<boolean>;\n+  getAssetDownloadSrc: (path: string) => Promise<string>;\n   getAssetSrc: (path: string) => Promise<string>;\n   restore: (assetSrc: string) => Promise<void>;\n };\n \n"
        },
        {
          "path": "space/app/layout.tsx",
          "status": "modified",
          "diff": "Index: space/app/layout.tsx\n===================================================================\n--- space/app/layout.tsx\tba6b822 (parent)\n+++ space/app/layout.tsx\tf679628 (commit)\n@@ -32,8 +32,9 @@\n         <link rel=\"shortcut icon\" href={`${SPACE_BASE_PATH}/favicon/favicon.ico`} />\n         <meta name=\"robots\" content=\"noindex, nofollow\" />\n       </head>\n       <body>\n+        <div id=\"editor-portal\" />\n         <AppProvider>\n           <>{children}</>\n         </AppProvider>\n       </body>\n"
        },
        {
          "path": "web/app/layout.tsx",
          "status": "modified",
          "diff": "Index: web/app/layout.tsx\n===================================================================\n--- web/app/layout.tsx\tba6b822 (parent)\n+++ web/app/layout.tsx\tf679628 (commit)\n@@ -79,8 +79,9 @@\n         <link rel=\"manifest\" href=\"/manifest.json\" />\n       </head>\n       <body>\n         <div id=\"context-menu-portal\" />\n+        <div id=\"editor-portal\" />\n         <AppProvider>\n           <div\n             className={cn(\n               \"h-screen w-full overflow-hidden bg-custom-background-100 relative flex flex-col\",\n"
        },
        {
          "path": "web/core/hooks/editor/use-editor-config.ts",
          "status": "modified",
          "diff": "Index: web/core/hooks/editor/use-editor-config.ts\n===================================================================\n--- web/core/hooks/editor/use-editor-config.ts\tba6b822 (parent)\n+++ web/core/hooks/editor/use-editor-config.ts\tf679628 (commit)\n@@ -1,9 +1,9 @@\n import { useCallback } from \"react\";\n // plane editor\n import { TFileHandler, TReadOnlyFileHandler } from \"@plane/editor\";\n // helpers\n-import { getEditorAssetSrc } from \"@plane/utils\";\n+import { getEditorAssetDownloadSrc, getEditorAssetSrc } from \"@plane/utils\";\n // hooks\n import { useEditorAsset } from \"@/hooks/store\";\n // plane web hooks\n import { useFileSize } from \"@/plane-web/hooks/use-file-size\";\n@@ -32,8 +32,22 @@\n         checkIfAssetExists: async (assetId: string) => {\n           const res = await fileService.checkIfAssetExists(workspaceSlug, assetId);\n           return res?.exists ?? false;\n         },\n+        getAssetDownloadSrc: async (path) => {\n+          if (!path) return \"\";\n+          if (path?.startsWith(\"http\")) {\n+            return path;\n+          } else {\n+            return (\n+              getEditorAssetDownloadSrc({\n+                assetId: path,\n+                projectId,\n+                workspaceSlug,\n+              }) ?? \"\"\n+            );\n+          }\n+        },\n         getAssetSrc: async (path) => {\n           if (!path) return \"\";\n           if (path?.startsWith(\"http\")) {\n             return path;\n"
        }
      ]
    },
    {
      "id": "refactor-workspace-views",
      "sha": "64fd0b2830952c172cd1022db577589e04892573",
      "parentSha": "8988cf9a85d9f263901401ccacb876bd63cc8f32",
      "spec": "Implement a workspace views refactor and Gantt dependency gating across backend and frontend.\n\nBackend\n1) Issue detail permission filtering (workspace issues-detail):\n- In apiserver/plane/app/views/issue/base.py, in IssueDetailEndpoint.get(), constrain the base queryset to project membership and project guest settings:\n  - Build a ProjectMember subquery for the current user where is_active=True and (role > GUEST) OR (role == GUEST AND project.guest_view_all_features == True).\n  - Filter the Issue.issue_objects queryset by Exists(project_member_subquery) OR, for guests with project.guest_view_all_features == False, only where created_by == request.user.\n  - Preserve existing select_related, prefetch_related, annotations, and subsequent .filter(**filters) and ordering behavior.\n- This should ensure: admins/members see all issues; guests see all only if project.guest_view_all_features is true; otherwise guests see only issues they created.\n\nFrontend: Types and Utilities\n2) Extend Gantt block and update data types to carry project identifiers:\n- In packages/types/src/layout/gantt.d.ts:\n  - IGanttBlock: add a project_id: string | undefined field.\n  - IBlockUpdateDependencyData: add an optional project_id?: string field.\n- In packages/utils/src/work-item/base.ts:\n  - getIssueBlocksStructure(): include project_id from the TIssue (block.project_id ?? undefined) in the returned structure.\n  - getComputedDisplayFilters(): treat an empty displayFilters object as unset; return defaultValues when displayFilters is empty (use a non-empty guard rather than truthiness).\n\nFrontend: Gantt dependency toggling\n3) Introduce an enableDependency flag to control rendering of dependency drag handles:\n- Thread a new prop enableDependency: boolean | ((blockId: string) => boolean) through the Gantt components:\n  - web/core/components/gantt-chart/root.tsx (default false), pass to chart/root.\n  - web/core/components/gantt-chart/chart/root.tsx, pass to chart/main-content.\n  - web/core/components/gantt-chart/chart/main-content.tsx, pass to blocks-list.\n  - web/core/components/gantt-chart/blocks/blocks-list.tsx, pass to block.\n  - web/core/components/gantt-chart/blocks/block.tsx, pass to helpers/draggable.\n  - web/core/components/gantt-chart/helpers/draggable.tsx: conditionally render LeftDependencyDraggable and RightDependencyDraggable only when enableDependency resolves truthy for the block (support both boolean and function forms).\n- Ensure existing move/resize behavior is unchanged.\n\nFrontend: Timeline store block project_id\n4) Store and position data for timeline blocks must carry project_id:\n- In web/ce/store/timeline/base-timeline.store.ts:\n  - Extend internal BlockData type to include project_id?: string | undefined | null.\n  - When building block objects, set block.project_id from incoming blockData.project_id and keep position calculation unchanged.\n\nFrontend: Workspace views header and layout selection\n5) Add layout selection and layout-specific filter options to workspace global issues header:\n- In web/app/(all)/[workspaceSlug]/(projects)/workspace-views/header.tsx:\n  - Import EIssueLayoutTypes and a GlobalViewLayoutSelection component from the plane-web helper.\n  - Read activeLayout from issueFilters.displayFilters.layout; default to EIssueLayoutTypes.SPREADSHEET.\n  - Add handleLayoutChange that updates display filters (EIssueFilterType.DISPLAY_FILTERS) with the selected layout for the current globalViewId.\n  - Compute currentLayoutFilters = ISSUE_DISPLAY_FILTERS_BY_PAGE.my_issues[activeLayout] with a useMemo.\n  - Render GlobalViewLayoutSelection and pass onChange, selectedLayout, and workspaceSlug.\n  - Use currentLayoutFilters for both FilterSelection and DisplayFiltersSelection instead of hard-coded spreadsheet filters.\n\nFrontend: Workspace active layout splitter\n6) Split spreadsheet layout into a dedicated root and route by layout:\n- Create web/core/components/views/helper.tsx that exports WorkspaceActiveLayout(props) and TWorkspaceLayoutProps. Default to EIssueLayoutTypes.SPREADSHEET; for spreadsheet, render a new WorkspaceSpreadsheetRoot with the provided props; for other layouts, delegate to WorkspaceAdditionalLayouts imported from @/plane-web/components/views/helper.\n- Add web/core/components/issues/issue-layouts/spreadsheet/roots/workspace-root.tsx that encapsulates the prior spreadsheet view behavior for global (workspace) views:\n  - Use useWorkspaceIssueProperties(workspaceSlug).\n  - Consume global issues store (EIssuesStoreType.GLOBAL) to read filters, pagination, groupedIssueIds, and loader state.\n  - Provide handleDisplayFiltersUpdate to update display filters for the current global view.\n  - Compute canEditProperties via useUserPermissions (ADMIN or MEMBER at project scope for a given projectId).\n  - Provide quick actions (AllIssueQuickActions) with update, archive, delete wired to issues actions.\n  - Render SpreadsheetView with display properties/filters, issueIds from groupedIssueIds[ALL_ISSUES], canLoadMore, loadMore, and isWorkspaceLevel true. Show SpreadsheetLayoutLoader during initial load.\n  - Include IssuePeekOverview within the IssueLayoutHOC layout wrapper.\n- Refactor web/core/components/issues/issue-layouts/roots/all-issue-layout-root.tsx to:\n  - Move spreadsheet-specific logic to WorkspaceSpreadsheetRoot.\n  - Use WorkspaceActiveLayout to render the active layout per current issueFilters.displayFilters.layout.\n  - Keep route filter propagation and data fetching (fetchAllGlobalViews, fetchFilters, fetchIssues) but remove spreadsheet-specific rendering from this file.\n\nFrontend: CE stubs for EE-only components\n7) Provide CE no-op exports to satisfy imports from @/plane-web/components/views/helper:\n- Add web/ce/components/views/helper.tsx exporting:\n  - GlobalViewLayoutSelection: a component that renders nothing in CE.\n  - WorkspaceAdditionalLayouts: a component that renders nothing in CE.\n- Add web/ce/store/issue/workspace/issue.store.ts re-exporting from @/store/issue/workspace/issue.store to align CE/EE imports.\n\nFrontend: API selection for expanded relations\n8) Choose issues vs issues-detail endpoint based on expand parameter:\n- In web/core/services/workspace.service.ts getViewIssues(workspaceSlug, params, config):\n  - If params.expand includes \"issue_relation\", GET /api/workspaces/{workspaceSlug}/issues-detail/; else GET /api/workspaces/{workspaceSlug}/issues/.\n  - Pass through existing params and config.\n\nFrontend: Issue date updates signature and callers\n9) Reorder and relax parameters for updating issue dates:\n- In web/core/store/issue/helpers/base-issues.store.ts:\n  - Change updateIssueDates signature to (workspaceSlug: string, updates: IBlockUpdateDependencyData[], projectId?: string) and early-return if projectId is not provided.\n  - Keep prior behavior of optimistic state update and API call; maintain rollbacks on failure.\n- Update all callers to match the new signature; in particular, in web/core/components/issues/issue-layouts/gantt/base-gantt-root.tsx, call issues.updateIssueDates(workspaceSlug, updates, projectId).\n\nFrontend: Issue relations and labels minor fixes\n10) Use issue-derived project_id for relations:\n- In web/core/store/issue/issue-details/relation.store.ts, when creating a relation, derive projectId from this.rootIssueDetailStore.issue.getIssueById(issueId)?.project_id instead of relying on a root store projectId.\n\n11) Always render labels property editor:\n- In web/core/components/issues/issue-layouts/properties/labels.tsx, remove the early return that prevented rendering when no value is present so the labels field can be edited from empty.\n\nFrontend: Workspace filters fetching simplification\n12) Simplify and standardize workspace filter fetching:\n- In web/core/store/issue/workspace/filter.store.ts fetchFilters():\n  - Read any locally cached filters via handleIssuesLocalFilters; compute displayFilters using computedDisplayFilters with defaults { layout: SPREADSHEET, order_by: \"-created_at\" }; compute displayProperties and kanbanFilters from local values if present.\n  - For viewId in [\"all-issues\", \"assigned\", \"created\", \"subscribed\"], compute filters from currentUserId using getComputedFiltersBasedOnViews; otherwise fetch view details from the issueFilterService and compute filters/display filters/properties.\n  - If displayFilters.order_by === \"sort_order\" then override to \"-created_at\".\n  - Write filters, displayFilters, displayProperties, and kanbanFilters to the store via runInAction.\n\nFrontend: Imports alignment for workspace issues store\n13) Align imports to use the CE/EE re-export:\n- In web/core/hooks/store/use-issues.ts and web/core/store/issue/root.store.ts, import IWorkspaceIssues from @/plane-web/store/issue/workspace/issue.store (with CE re-export provided) and remove direct imports from @/store/issue/workspace/issue.store where replaced.\n\nExpected behavior summary\n- Guests in projects with guest_view_all_features disabled see only issues they created in the workspace issues-detail view; otherwise they see all permitted issues.\n- Workspace views header shows a layout selector and applies layout-specific filters; spreadsheet remains default.\n- Spreadsheet behavior moves to a dedicated workspace root; other layouts can be provided by EE via WorkspaceAdditionalLayouts.\n- Gantt dependency handles render only when enableDependency is set; blocks carry project_id end-to-end and update dates using the new parameter order.\n- Choosing expand=issue_relation uses the issues-detail endpoint.\n- Labels property is always editable, even when initially empty.",
      "prompt": "Refactor workspace views to support selectable layouts and gated gantt dependencies, and tighten backend visibility for guest users.\n\nObjectives:\n- Add a layout selector to the workspace global issues header and route rendering to the appropriate layout. Spreadsheet should be the default; other layouts should be delegated to an EE-provided hook. Use layout-specific display filters in the header dropdowns.\n- Move spreadsheet-specific logic into its own workspace root component and have the main root choose which layout to render.\n- Make gantt dependency handles optional and disabled by default; only render the left/right dependency draggables when explicitly enabled.\n- Ensure gantt blocks and issue-date update payloads include the project id; update the update-issue-dates call sites to use the revised parameters.\n- When requesting workspace view issues with expanded relations, call the issues-detail endpoint; otherwise call the standard issues endpoint.\n- On the backend, limit the issues returned by the workspace issue detail endpoint so that guests only see their own issues unless the project allows guests to view all features.\n- Minor UX fixes: allow editing labels even when none are set; derive the project id for creating relations from the issue in context; simplify fetching/storing workspace view filters from local or server with sane defaults.\n\nDeliver a cohesive change that satisfies these behaviors across backend and frontend.",
      "supplementalFiles": [
        "packages/constants/src/issue/filter.ts",
        "packages/constants/src/issue/layout.ts",
        "packages/constants/src/endpoints.ts",
        "web/core/services/issue/issue.service.ts",
        "web/core/hooks/store/use-issue-layout-store.ts",
        "web/core/components/ui/index.ts",
        "apiserver/plane/web/urls.py"
      ],
      "fileDiffs": [
        {
          "path": "apiserver/plane/app/views/issue/base.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/views/issue/base.py\n===================================================================\n--- apiserver/plane/app/views/issue/base.py\t8988cf9 (parent)\n+++ apiserver/plane/app/views/issue/base.py\t64fd0b2 (commit)\n@@ -943,11 +943,35 @@\n class IssueDetailEndpoint(BaseAPIView):\n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n     def get(self, request, slug, project_id):\n         filters = issue_filters(request.query_params, \"GET\")\n+\n+        # check for the project member role, if the role is 5 then check for the guest_view_all_features\n+        #  if it is true then show all the issues else show only the issues created by the user\n+        project_member_subquery = ProjectMember.objects.filter(\n+            project_id=OuterRef(\"project_id\"),\n+            member=self.request.user,\n+            is_active=True,\n+        ).filter(\n+            Q(role__gt=ROLE.GUEST.value) \n+            | Q(\n+                role=ROLE.GUEST.value, project__guest_view_all_features=True\n+            )\n+        )\n+\n+        # Main issue query\n         issue = (\n             Issue.issue_objects.filter(workspace__slug=slug, project_id=project_id)\n-            .select_related(\"workspace\", \"project\", \"state\", \"parent\")\n+            .filter(\n+                Q(Exists(project_member_subquery))\n+                | Q(\n+                    project__project_projectmember__member=self.request.user,\n+                    project__project_projectmember__is_active=True,\n+                    project__project_projectmember__role=ROLE.GUEST.value,\n+                    project__guest_view_all_features=False,\n+                    created_by=self.request.user,\n+                )\n+            )\n             .prefetch_related(\"assignees\", \"labels\", \"issue_module__module\")\n             .annotate(\n                 cycle_id=Subquery(\n                     CycleIssue.objects.filter(\n@@ -1013,8 +1037,9 @@\n                 .annotate(count=Func(F(\"id\"), function=\"Count\"))\n                 .values(\"count\")\n             )\n         )\n+\n         issue = issue.filter(**filters)\n         order_by_param = request.GET.get(\"order_by\", \"-created_at\")\n         # Issue queryset\n         issue, order_by_param = order_issue_queryset(\n"
        },
        {
          "path": "packages/types/src/layout/gantt.d.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/layout/gantt.d.ts\n===================================================================\n--- packages/types/src/layout/gantt.d.ts\t8988cf9 (parent)\n+++ packages/types/src/layout/gantt.d.ts\t64fd0b2 (commit)\n@@ -8,8 +8,9 @@\n   };\n   sort_order: number | undefined;\n   start_date: string | undefined;\n   target_date: string | undefined;\n+  project_id: string | undefined;\n }\n \n export interface IBlockUpdateData {\n   sort_order?: {\n@@ -24,8 +25,9 @@\n export interface IBlockUpdateDependencyData {\n   id: string;\n   start_date?: string;\n   target_date?: string;\n+  project_id?: string;\n }\n \n export type TGanttViews = \"week\" | \"month\" | \"quarter\";\n \n"
        },
        {
          "path": "packages/utils/src/work-item/base.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/work-item/base.ts\n===================================================================\n--- packages/utils/src/work-item/base.ts\t8988cf9 (parent)\n+++ packages/utils/src/work-item/base.ts\t64fd0b2 (commit)\n@@ -184,8 +184,9 @@\n   name: block?.name,\n   sort_order: block?.sort_order,\n   start_date: block?.start_date ?? undefined,\n   target_date: block?.target_date ?? undefined,\n+  project_id: block?.project_id ?? undefined,\n });\n \n export const formatTextList = (TextArray: string[]): string => {\n   const count = TextArray.length;\n@@ -259,9 +260,9 @@\n export const getComputedDisplayFilters = (\n   displayFilters: IIssueDisplayFilterOptions = {},\n   defaultValues?: IIssueDisplayFilterOptions\n ): IIssueDisplayFilterOptions => {\n-  const filters = displayFilters || defaultValues;\n+  const filters = !isEmpty(displayFilters) ? displayFilters : defaultValues;\n \n   return {\n     calendar: {\n       show_weekends: filters?.calendar?.show_weekends || false,\n"
        },
        {
          "path": "web/app/(all)/[workspaceSlug]/(projects)/workspace-views/header.tsx",
          "status": "modified",
          "diff": "Index: web/app/(all)/[workspaceSlug]/(projects)/workspace-views/header.tsx\n===================================================================\n--- web/app/(all)/[workspaceSlug]/(projects)/workspace-views/header.tsx\t8988cf9 (parent)\n+++ web/app/(all)/[workspaceSlug]/(projects)/workspace-views/header.tsx\t64fd0b2 (commit)\n@@ -1,12 +1,12 @@\n \"use client\";\n \n-import { useCallback, useState } from \"react\";\n+import { useCallback, useMemo, useState } from \"react\";\n import { observer } from \"mobx-react\";\n import { useParams } from \"next/navigation\";\n import { Layers } from \"lucide-react\";\n // plane constants\n-import { EIssueFilterType, EIssuesStoreType, ISSUE_DISPLAY_FILTERS_BY_PAGE } from \"@plane/constants\";\n+import { EIssueFilterType, EIssueLayoutTypes, EIssuesStoreType, ISSUE_DISPLAY_FILTERS_BY_PAGE } from \"@plane/constants\";\n import { useTranslation } from \"@plane/i18n\";\n // types\n import { IIssueDisplayFilterOptions, IIssueDisplayProperties, IIssueFilterOptions } from \"@plane/types\";\n // ui\n@@ -18,8 +18,9 @@\n import { CreateUpdateWorkspaceViewModal } from \"@/components/workspace\";\n // helpers\n // hooks\n import { useLabel, useMember, useIssues, useGlobalView } from \"@/hooks/store\";\n+import { GlobalViewLayoutSelection } from \"@/plane-web/components/views/helper\";\n \n export const GlobalIssuesHeader = observer(() => {\n   // states\n   const [createViewModal, setCreateViewModal] = useState(false);\n@@ -37,8 +38,9 @@\n   const { t } = useTranslation();\n \n   const issueFilters = globalViewId ? filters[globalViewId.toString()] : undefined;\n \n+  const activeLayout = issueFilters?.displayFilters?.layout;\n   const viewDetails = getViewDetailsById(globalViewId.toString());\n \n   const handleFiltersUpdate = useCallback(\n     (key: keyof IIssueFilterOptions, value: string | string[]) => {\n@@ -94,10 +96,29 @@\n     },\n     [workspaceSlug, updateFilters, globalViewId]\n   );\n \n+  const handleLayoutChange = useCallback(\n+    (layout: EIssueLayoutTypes) => {\n+      if (!workspaceSlug || !globalViewId) return;\n+      updateFilters(\n+        workspaceSlug.toString(),\n+        undefined,\n+        EIssueFilterType.DISPLAY_FILTERS,\n+        { layout: layout },\n+        globalViewId.toString()\n+      );\n+    },\n+    [workspaceSlug, updateFilters, globalViewId]\n+  );\n+\n   const isLocked = viewDetails?.is_locked;\n \n+  const currentLayoutFilters = useMemo(() => {\n+    const layout = activeLayout ?? EIssueLayoutTypes.SPREADSHEET;\n+    return ISSUE_DISPLAY_FILTERS_BY_PAGE.my_issues[layout];\n+  }, [activeLayout]);\n+\n   return (\n     <>\n       <CreateUpdateWorkspaceViewModal isOpen={createViewModal} onClose={() => setCreateViewModal(false)} />\n       <Header>\n@@ -112,15 +133,20 @@\n \n         <Header.RightItem>\n           {!isLocked ? (\n             <>\n+              <GlobalViewLayoutSelection\n+                onChange={handleLayoutChange}\n+                selectedLayout={activeLayout ?? EIssueLayoutTypes.SPREADSHEET}\n+                workspaceSlug={workspaceSlug.toString()}\n+              />\n               <FiltersDropdown\n                 title={t(\"common.filters\")}\n                 placement=\"bottom-end\"\n                 isFiltersApplied={isIssueFilterActive(issueFilters)}\n               >\n                 <FilterSelection\n-                  layoutDisplayFiltersOptions={ISSUE_DISPLAY_FILTERS_BY_PAGE.my_issues.spreadsheet}\n+                  layoutDisplayFiltersOptions={currentLayoutFilters}\n                   filters={issueFilters?.filters ?? {}}\n                   handleFiltersUpdate={handleFiltersUpdate}\n                   displayFilters={issueFilters?.displayFilters ?? {}}\n                   handleDisplayFiltersUpdate={handleDisplayFilters}\n@@ -129,9 +155,9 @@\n                 />\n               </FiltersDropdown>\n               <FiltersDropdown title={t(\"common.display\")} placement=\"bottom-end\">\n                 <DisplayFiltersSelection\n-                  layoutDisplayFiltersOptions={ISSUE_DISPLAY_FILTERS_BY_PAGE.my_issues.spreadsheet}\n+                  layoutDisplayFiltersOptions={currentLayoutFilters}\n                   displayFilters={issueFilters?.displayFilters ?? {}}\n                   handleDisplayFiltersUpdate={handleDisplayFilters}\n                   displayProperties={issueFilters?.displayProperties ?? {}}\n                   handleDisplayPropertiesUpdate={handleDisplayProperties}\n"
        },
        {
          "path": "web/ce/components/views/helper.tsx",
          "status": "added",
          "diff": "Index: web/ce/components/views/helper.tsx\n===================================================================\n--- web/ce/components/views/helper.tsx\t8988cf9 (parent)\n+++ web/ce/components/views/helper.tsx\t64fd0b2 (commit)\n@@ -0,0 +1,12 @@\n+import { EIssueLayoutTypes } from \"@plane/constants\";\n+import { TWorkspaceLayoutProps } from \"@/components/views/helper\";\n+\n+export type TLayoutSelectionProps = {\n+  onChange: (layout: EIssueLayoutTypes) => void;\n+  selectedLayout: EIssueLayoutTypes;\n+  workspaceSlug: string;\n+};\n+\n+export const GlobalViewLayoutSelection = (props: TLayoutSelectionProps) => <></>;\n+\n+export const WorkspaceAdditionalLayouts = (props: TWorkspaceLayoutProps) => <></>;\n"
        },
        {
          "path": "web/ce/store/issue/workspace/issue.store.ts",
          "status": "added",
          "diff": "Index: web/ce/store/issue/workspace/issue.store.ts\n===================================================================\n--- web/ce/store/issue/workspace/issue.store.ts\t8988cf9 (parent)\n+++ web/ce/store/issue/workspace/issue.store.ts\t64fd0b2 (commit)\n@@ -0,0 +1,1 @@\n+export * from \"@/store/issue/workspace/issue.store\";\n"
        },
        {
          "path": "web/ce/store/timeline/base-timeline.store.ts",
          "status": "modified",
          "diff": "Index: web/ce/store/timeline/base-timeline.store.ts\n===================================================================\n--- web/ce/store/timeline/base-timeline.store.ts\t8988cf9 (parent)\n+++ web/ce/store/timeline/base-timeline.store.ts\t64fd0b2 (commit)\n@@ -21,8 +21,9 @@\n   name: string;\n   sort_order: number | null;\n   start_date?: string | undefined | null;\n   target_date?: string | undefined | null;\n+  project_id?: string | undefined | null;\n };\n \n export interface IBaseTimelineStore {\n   // observables\n@@ -193,8 +194,9 @@\n         name: blockData.name,\n         sort_order: blockData?.sort_order ?? undefined,\n         start_date: blockData?.start_date ?? undefined,\n         target_date: blockData?.target_date ?? undefined,\n+        project_id: blockData?.project_id ?? undefined,\n       };\n       if (this.currentViewData && (this.currentViewData?.data?.startDate || this.currentViewData?.data?.dayWidth)) {\n         block.position = getItemPositionWidth(this.currentViewData, block);\n       }\n"
        },
        {
          "path": "web/core/components/gantt-chart/blocks/block.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/gantt-chart/blocks/block.tsx\n===================================================================\n--- web/core/components/gantt-chart/blocks/block.tsx\t8988cf9 (parent)\n+++ web/core/components/gantt-chart/blocks/block.tsx\t64fd0b2 (commit)\n@@ -19,8 +19,9 @@\n   blockToRender: (data: any) => React.ReactNode;\n   enableBlockLeftResize: boolean;\n   enableBlockRightResize: boolean;\n   enableBlockMove: boolean;\n+  enableDependency: boolean;\n   ganttContainerRef: RefObject<HTMLDivElement>;\n   updateBlockDates?: (updates: IBlockUpdateDependencyData[]) => Promise<void>;\n };\n \n@@ -32,8 +33,9 @@\n     enableBlockLeftResize,\n     enableBlockRightResize,\n     enableBlockMove,\n     ganttContainerRef,\n+    enableDependency,\n     updateBlockDates,\n   } = props;\n   // store hooks\n   const { updateActiveBlockId, getBlockById, getIsCurrentDependencyDragging, currentView } = useTimeLineChartStore();\n@@ -89,8 +91,9 @@\n               handleBlockDrag={handleBlockDrag}\n               enableBlockLeftResize={enableBlockLeftResize}\n               enableBlockRightResize={enableBlockRightResize}\n               enableBlockMove={enableBlockMove && !!isBlockComplete}\n+              enableDependency={enableDependency}\n               isMoving={isMoving}\n               ganttContainerRef={ganttContainerRef}\n             />\n           </div>\n"
        },
        {
          "path": "web/core/components/gantt-chart/blocks/blocks-list.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/gantt-chart/blocks/blocks-list.tsx\n===================================================================\n--- web/core/components/gantt-chart/blocks/blocks-list.tsx\t8988cf9 (parent)\n+++ web/core/components/gantt-chart/blocks/blocks-list.tsx\t64fd0b2 (commit)\n@@ -11,8 +11,9 @@\n   enableBlockMove: boolean | ((blockId: string) => boolean);\n   ganttContainerRef: React.RefObject<HTMLDivElement>;\n   showAllBlocks: boolean;\n   updateBlockDates?: (updates: IBlockUpdateDependencyData[]) => Promise<void>;\n+  enableDependency: boolean | ((blockId: string) => boolean);\n };\n \n export const GanttChartBlocksList: FC<GanttChartBlocksProps> = (props) => {\n   const {\n@@ -23,8 +24,9 @@\n     enableBlockMove,\n     ganttContainerRef,\n     showAllBlocks,\n     updateBlockDates,\n+    enableDependency,\n   } = props;\n \n   return (\n     <>\n@@ -40,8 +42,9 @@\n           enableBlockRightResize={\n             typeof enableBlockRightResize === \"function\" ? enableBlockRightResize(blockId) : enableBlockRightResize\n           }\n           enableBlockMove={typeof enableBlockMove === \"function\" ? enableBlockMove(blockId) : enableBlockMove}\n+          enableDependency={typeof enableDependency === \"function\" ? enableDependency(blockId) : enableDependency}\n           ganttContainerRef={ganttContainerRef}\n           updateBlockDates={updateBlockDates}\n         />\n       ))}\n"
        },
        {
          "path": "web/core/components/gantt-chart/chart/main-content.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/gantt-chart/chart/main-content.tsx\n===================================================================\n--- web/core/components/gantt-chart/chart/main-content.tsx\t8988cf9 (parent)\n+++ web/core/components/gantt-chart/chart/main-content.tsx\t64fd0b2 (commit)\n@@ -40,8 +40,9 @@\n   enableBlockRightResize: boolean | ((blockId: string) => boolean);\n   enableReorder: boolean | ((blockId: string) => boolean);\n   enableSelection: boolean | ((blockId: string) => boolean);\n   enableAddBlock: boolean | ((blockId: string) => boolean);\n+  enableDependency: boolean | ((blockId: string) => boolean);\n   itemsContainerWidth: number;\n   showAllBlocks: boolean;\n   sidebarToRender: (props: any) => React.ReactNode;\n   title: string;\n@@ -66,8 +67,9 @@\n     enableBlockRightResize,\n     enableReorder,\n     enableAddBlock,\n     enableSelection,\n+    enableDependency,\n     itemsContainerWidth,\n     showAllBlocks,\n     sidebarToRender,\n     title,\n@@ -214,8 +216,9 @@\n                       enableBlockLeftResize={enableBlockLeftResize}\n                       enableBlockRightResize={enableBlockRightResize}\n                       enableBlockMove={enableBlockMove}\n                       ganttContainerRef={ganttContainerRef}\n+                      enableDependency={enableDependency}\n                       showAllBlocks={showAllBlocks}\n                       updateBlockDates={updateBlockDates}\n                     />\n                   </div>\n"
        },
        {
          "path": "web/core/components/gantt-chart/chart/root.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/gantt-chart/chart/root.tsx\n===================================================================\n--- web/core/components/gantt-chart/chart/root.tsx\t8988cf9 (parent)\n+++ web/core/components/gantt-chart/chart/root.tsx\t64fd0b2 (commit)\n@@ -36,8 +36,9 @@\n   enableBlockMove: boolean | ((blockId: string) => boolean);\n   enableReorder: boolean | ((blockId: string) => boolean);\n   enableAddBlock: boolean | ((blockId: string) => boolean);\n   enableSelection: boolean | ((blockId: string) => boolean);\n+  enableDependency: boolean | ((blockId: string) => boolean);\n   bottomSpacing: boolean;\n   showAllBlocks: boolean;\n   loadMoreBlocks?: () => void;\n   updateBlockDates?: (updates: IBlockUpdateDependencyData[]) => Promise<void>;\n@@ -69,8 +70,9 @@\n     enableBlockMove,\n     enableReorder,\n     enableAddBlock,\n     enableSelection,\n+    enableDependency,\n     bottomSpacing,\n     showAllBlocks,\n     quickAdd,\n     showToday,\n@@ -203,8 +205,9 @@\n         enableBlockRightResize={enableBlockRightResize}\n         enableReorder={enableReorder}\n         enableSelection={enableSelection}\n         enableAddBlock={enableAddBlock}\n+        enableDependency={enableDependency}\n         itemsContainerWidth={itemsContainerWidth}\n         showAllBlocks={showAllBlocks}\n         sidebarToRender={sidebarToRender}\n         title={title}\n"
        },
        {
          "path": "web/core/components/gantt-chart/helpers/draggable.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/gantt-chart/helpers/draggable.tsx\n===================================================================\n--- web/core/components/gantt-chart/helpers/draggable.tsx\t8988cf9 (parent)\n+++ web/core/components/gantt-chart/helpers/draggable.tsx\t64fd0b2 (commit)\n@@ -17,8 +17,9 @@\n   isMoving: \"left\" | \"right\" | \"move\" | undefined;\n   enableBlockLeftResize: boolean;\n   enableBlockRightResize: boolean;\n   enableBlockMove: boolean;\n+  enableDependency: boolean | ((blockId: string) => boolean);\n   ganttContainerRef: RefObject<HTMLDivElement>;\n };\n \n export const ChartDraggable: React.FC<Props> = observer((props) => {\n@@ -28,16 +29,19 @@\n     handleBlockDrag,\n     enableBlockLeftResize,\n     enableBlockRightResize,\n     enableBlockMove,\n+    enableDependency,\n     isMoving,\n     ganttContainerRef,\n   } = props;\n \n   return (\n     <div className=\"group w-full z-[5] relative inline-flex h-full cursor-pointer items-center font-medium transition-all\">\n       {/* left resize drag handle */}\n-      <LeftDependencyDraggable block={block} ganttContainerRef={ganttContainerRef} />\n+      {(typeof enableDependency === \"function\" ? enableDependency(block.id) : enableDependency) && (\n+        <LeftDependencyDraggable block={block} ganttContainerRef={ganttContainerRef} />\n+      )}\n       <LeftResizable\n         enableBlockLeftResize={enableBlockLeftResize}\n         handleBlockDrag={handleBlockDrag}\n         isMoving={isMoving}\n@@ -57,8 +61,10 @@\n         handleBlockDrag={handleBlockDrag}\n         isMoving={isMoving}\n         position={block.position}\n       />\n-      <RightDependencyDraggable block={block} ganttContainerRef={ganttContainerRef} />\n+      {(typeof enableDependency === \"function\" ? enableDependency(block.id) : enableDependency) && (\n+        <RightDependencyDraggable block={block} ganttContainerRef={ganttContainerRef} />\n+      )}\n     </div>\n   );\n });\n"
        },
        {
          "path": "web/core/components/gantt-chart/root.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/gantt-chart/root.tsx\n===================================================================\n--- web/core/components/gantt-chart/root.tsx\t8988cf9 (parent)\n+++ web/core/components/gantt-chart/root.tsx\t64fd0b2 (commit)\n@@ -23,8 +23,9 @@\n   enableBlockMove?: boolean | ((blockId: string) => boolean);\n   enableReorder?: boolean | ((blockId: string) => boolean);\n   enableAddBlock?: boolean | ((blockId: string) => boolean);\n   enableSelection?: boolean | ((blockId: string) => boolean);\n+  enableDependency?: boolean | ((blockId: string) => boolean);\n   bottomSpacing?: boolean;\n   showAllBlocks?: boolean;\n   showToday?: boolean;\n   isEpic?: boolean;\n@@ -46,8 +47,9 @@\n     enableBlockMove = false,\n     enableReorder = false,\n     enableAddBlock = false,\n     enableSelection = false,\n+    enableDependency = false,\n     bottomSpacing = false,\n     showAllBlocks = false,\n     showToday = true,\n     quickAdd,\n@@ -78,8 +80,9 @@\n       enableBlockMove={enableBlockMove}\n       enableReorder={enableReorder}\n       enableAddBlock={enableAddBlock}\n       enableSelection={enableSelection}\n+      enableDependency={enableDependency}\n       bottomSpacing={bottomSpacing}\n       showAllBlocks={showAllBlocks}\n       quickAdd={quickAdd}\n       showToday={showToday}\n"
        },
        {
          "path": "web/core/components/issues/issue-layouts/gantt/base-gantt-root.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-layouts/gantt/base-gantt-root.tsx\n===================================================================\n--- web/core/components/issues/issue-layouts/gantt/base-gantt-root.tsx\t8988cf9 (parent)\n+++ web/core/components/issues/issue-layouts/gantt/base-gantt-root.tsx\t64fd0b2 (commit)\n@@ -97,16 +97,16 @@\n         start_date?: string;\n         target_date?: string;\n       }[]\n     ) =>\n-      issues.updateIssueDates(workspaceSlug.toString(), projectId.toString(), updates).catch(() => {\n+      issues.updateIssueDates(workspaceSlug.toString(), updates, projectId.toString()).catch(() => {\n         setToast({\n           type: TOAST_TYPE.ERROR,\n           title: t(\"toast.error\"),\n           message: \"Error while updating work item dates, Please try again Later\",\n         });\n       }),\n-    [issues]\n+    [issues, projectId, workspaceSlug]\n   );\n \n   const quickAdd =\n     enableIssueCreation && isAllowed && !isCompletedCycle ? (\n"
        },
        {
          "path": "web/core/components/issues/issue-layouts/properties/labels.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-layouts/properties/labels.tsx\n===================================================================\n--- web/core/components/issues/issue-layouts/properties/labels.tsx\t8988cf9 (parent)\n+++ web/core/components/issues/issue-layouts/properties/labels.tsx\t64fd0b2 (commit)\n@@ -81,10 +81,8 @@\n       inputRef.current.focus();\n     }\n   }, [isOpen, isMobile]);\n \n-  if (!value) return null;\n-\n   let projectLabels: IIssueLabel[] = defaultOptions as IIssueLabel[];\n   if (storeLabels && storeLabels.length > 0) projectLabels = storeLabels;\n \n   const NoLabel = useMemo(\n"
        },
        {
          "path": "web/core/components/issues/issue-layouts/roots/all-issue-layout-root.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-layouts/roots/all-issue-layout-root.tsx\n===================================================================\n--- web/core/components/issues/issue-layouts/roots/all-issue-layout-root.tsx\t8988cf9 (parent)\n+++ web/core/components/issues/issue-layouts/roots/all-issue-layout-root.tsx\t64fd0b2 (commit)\n@@ -1,35 +1,21 @@\n import React, { useCallback } from \"react\";\n-import isEmpty from \"lodash/isEmpty\";\n+import { isEmpty } from \"lodash\";\n import { observer } from \"mobx-react\";\n import { useParams, useSearchParams } from \"next/navigation\";\n-import useSWR from \"swr\";\n // plane constants\n-import {\n-  ALL_ISSUES,\n-  EIssueLayoutTypes,\n-  EIssueFilterType,\n-  EIssuesStoreType,\n-  ISSUE_DISPLAY_FILTERS_BY_PAGE\n-,EUserPermissions, EUserPermissionsLevel } from \"@plane/constants\";\n-import { IIssueDisplayFilterOptions } from \"@plane/types\";\n+import useSWR from \"swr\";\n+import { EIssueFilterType, EIssueLayoutTypes, EIssuesStoreType, ISSUE_DISPLAY_FILTERS_BY_PAGE } from \"@plane/constants\";\n // hooks\n // components\n-import { EmptyState } from \"@/components/common\";\n-import { SpreadsheetView } from \"@/components/issues/issue-layouts\";\n-import { AllIssueQuickActions } from \"@/components/issues/issue-layouts/quick-action-dropdowns\";\n-import { SpreadsheetLayoutLoader } from \"@/components/ui\";\n // hooks\n-import { useGlobalView, useIssues, useUserPermissions } from \"@/hooks/store\";\n+import { EmptyState } from \"@/components/common\";\n+import { WorkspaceActiveLayout } from \"@/components/views/helper\";\n+import { useGlobalView, useIssues } from \"@/hooks/store\";\n import { useAppRouter } from \"@/hooks/use-app-router\";\n-import { IssuesStoreContext } from \"@/hooks/use-issue-layout-store\";\n-import { useIssuesActions } from \"@/hooks/use-issues-actions\";\n import { useWorkspaceIssueProperties } from \"@/hooks/use-workspace-issue-properties\";\n // store\n import emptyView from \"@/public/empty-state/view.svg\";\n-import { IssuePeekOverview } from \"../../peek-overview\";\n-import { IssueLayoutHOC } from \"../issue-layout-HOC\";\n-import { TRenderQuickActions } from \"../list/list-view-types\";\n \n type Props = {\n   isDefaultView: boolean;\n   isLoading?: boolean;\n@@ -37,34 +23,36 @@\n };\n \n export const AllIssueLayoutRoot: React.FC<Props> = observer((props: Props) => {\n   const { isDefaultView, isLoading = false, toggleLoading } = props;\n-  // router\n-  const { workspaceSlug, globalViewId } = useParams();\n+\n+  // Router hooks\n   const router = useAppRouter();\n+  const { workspaceSlug, globalViewId } = useParams();\n   const searchParams = useSearchParams();\n-  const routeFilters: {\n-    [key: string]: string;\n-  } = {};\n-  searchParams.forEach((value: string, key: string) => {\n-    routeFilters[key] = value;\n-  });\n-  //swr hook for fetching issue properties\n-  useWorkspaceIssueProperties(workspaceSlug);\n-  // store\n+\n+  // Store hooks\n   const {\n     issuesFilter: { filters, fetchFilters, updateFilters },\n-    issues: { clear, getIssueLoader, getPaginationData, groupedIssueIds, fetchIssues, fetchNextIssues },\n+    issues: { clear, groupedIssueIds, fetchIssues, fetchNextIssues },\n   } = useIssues(EIssuesStoreType.GLOBAL);\n-  const { updateIssue, removeIssue, archiveIssue } = useIssuesActions(EIssuesStoreType.GLOBAL);\n-\n-  const { allowPermissions } = useUserPermissions();\n-\n   const { fetchAllGlobalViews, getViewDetailsById } = useGlobalView();\n \n+  // Custom hooks\n+  useWorkspaceIssueProperties(workspaceSlug);\n+\n+  // Derived values\n   const viewDetails = getViewDetailsById(globalViewId?.toString());\n-  // filter init from the query params\n+  const issueFilters = globalViewId ? filters?.[globalViewId.toString()] : undefined;\n+  const activeLayout: EIssueLayoutTypes | undefined = issueFilters?.displayFilters?.layout;\n \n+  // Route filters\n+  const routeFilters: { [key: string]: string } = {};\n+  searchParams.forEach((value: string, key: string) => {\n+    routeFilters[key] = value;\n+  });\n+\n+  // Apply route filters to store\n   const routerFilterParams = () => {\n     if (\n       workspaceSlug &&\n       globalViewId &&\n@@ -88,12 +76,14 @@\n         );\n     }\n   };\n \n+  // Fetch next pages callback\n   const fetchNextPages = useCallback(() => {\n     if (workspaceSlug && globalViewId) fetchNextIssues(workspaceSlug.toString(), globalViewId.toString());\n   }, [fetchNextIssues, workspaceSlug, globalViewId]);\n \n+  // Fetch global views\n   const { isLoading: globalViewsLoading } = useSWR(\n     workspaceSlug ? `WORKSPACE_GLOBAL_VIEWS_${workspaceSlug}` : null,\n     async () => {\n       if (workspaceSlug) {\n@@ -102,8 +92,9 @@\n     },\n     { revalidateIfStale: false, revalidateOnFocus: false }\n   );\n \n+  // Fetch issues\n   const { isLoading: issuesLoading } = useSWR(\n     workspaceSlug && globalViewId ? `WORKSPACE_GLOBAL_VIEW_ISSUES_${workspaceSlug}_${globalViewId}` : null,\n     async () => {\n       if (workspaceSlug && globalViewId) {\n@@ -125,56 +116,9 @@\n     },\n     { revalidateIfStale: false, revalidateOnFocus: false }\n   );\n \n-  const canEditProperties = useCallback(\n-    (projectId: string | undefined) => {\n-      if (!projectId) return false;\n-      return allowPermissions(\n-        [EUserPermissions.ADMIN, EUserPermissions.MEMBER],\n-        EUserPermissionsLevel.PROJECT,\n-        workspaceSlug.toString(),\n-        projectId\n-      );\n-    },\n-    [workspaceSlug]\n-  );\n-\n-  const issueFilters = globalViewId ? filters?.[globalViewId.toString()] : undefined;\n-\n-  const handleDisplayFiltersUpdate = useCallback(\n-    (updatedDisplayFilter: Partial<IIssueDisplayFilterOptions>) => {\n-      if (!workspaceSlug || !globalViewId) return;\n-\n-      updateFilters(\n-        workspaceSlug.toString(),\n-        undefined,\n-        EIssueFilterType.DISPLAY_FILTERS,\n-        { ...updatedDisplayFilter },\n-        globalViewId.toString()\n-      );\n-    },\n-    [updateFilters, workspaceSlug, globalViewId]\n-  );\n-\n-  const renderQuickActions: TRenderQuickActions = useCallback(\n-    ({ issue, parentRef, customActionButton, placement, portalElement }) => (\n-      <AllIssueQuickActions\n-        parentRef={parentRef}\n-        customActionButton={customActionButton}\n-        issue={issue}\n-        handleDelete={async () => removeIssue(issue.project_id, issue.id)}\n-        handleUpdate={async (data) => updateIssue && updateIssue(issue.project_id, issue.id, data)}\n-        handleArchive={async () => archiveIssue && archiveIssue(issue.project_id, issue.id)}\n-        portalElement={portalElement}\n-        readOnly={!canEditProperties(issue.project_id ?? undefined)}\n-        placements={placement}\n-      />\n-    ),\n-    [canEditProperties, removeIssue, updateIssue, archiveIssue]\n-  );\n-\n-  // when the call is not loading and the view does not exist and the view is not a default view, show empty state\n+  // Empty state\n   if (!isLoading && !globalViewsLoading && !issuesLoading && !viewDetails && !isDefaultView) {\n     return (\n       <EmptyState\n         image={emptyView}\n@@ -187,32 +131,19 @@\n       />\n     );\n   }\n \n-  if ((isLoading && issuesLoading && getIssueLoader() === \"init-loader\") || !globalViewId || !groupedIssueIds) {\n-    return <SpreadsheetLayoutLoader />;\n-  }\n-\n-  const issueIds = groupedIssueIds[ALL_ISSUES];\n-  const nextPageResults = getPaginationData(ALL_ISSUES, undefined)?.nextPageResults;\n-\n   return (\n-    <IssuesStoreContext.Provider value={EIssuesStoreType.GLOBAL}>\n-      <IssueLayoutHOC layout={EIssueLayoutTypes.SPREADSHEET}>\n-        <SpreadsheetView\n-          displayProperties={issueFilters?.displayProperties ?? {}}\n-          displayFilters={issueFilters?.displayFilters ?? {}}\n-          handleDisplayFilterUpdate={handleDisplayFiltersUpdate}\n-          issueIds={Array.isArray(issueIds) ? issueIds : []}\n-          quickActions={renderQuickActions}\n-          updateIssue={updateIssue}\n-          canEditProperties={canEditProperties}\n-          canLoadMoreIssues={!!nextPageResults}\n-          loadMoreIssues={fetchNextPages}\n-          isWorkspaceLevel\n-        />\n-        {/* peek overview */}\n-        <IssuePeekOverview />\n-      </IssueLayoutHOC>\n-    </IssuesStoreContext.Provider>\n+    <WorkspaceActiveLayout\n+      activeLayout={activeLayout}\n+      isDefaultView={isDefaultView}\n+      isLoading={isLoading}\n+      toggleLoading={toggleLoading}\n+      workspaceSlug={workspaceSlug?.toString()}\n+      globalViewId={globalViewId?.toString()}\n+      routeFilters={routeFilters}\n+      fetchNextPages={fetchNextPages}\n+      globalViewsLoading={globalViewsLoading}\n+      issuesLoading={issuesLoading}\n+    />\n   );\n });\n"
        },
        {
          "path": "web/core/components/issues/issue-layouts/spreadsheet/roots/workspace-root.tsx",
          "status": "added",
          "diff": "Index: web/core/components/issues/issue-layouts/spreadsheet/roots/workspace-root.tsx\n===================================================================\n--- web/core/components/issues/issue-layouts/spreadsheet/roots/workspace-root.tsx\t8988cf9 (parent)\n+++ web/core/components/issues/issue-layouts/spreadsheet/roots/workspace-root.tsx\t64fd0b2 (commit)\n@@ -0,0 +1,137 @@\n+import React, { useCallback } from \"react\";\n+import { observer } from \"mobx-react\";\n+// plane constants\n+import {\n+  ALL_ISSUES,\n+  EIssueLayoutTypes,\n+  EIssueFilterType,\n+  EIssuesStoreType,\n+  EUserPermissions,\n+  EUserPermissionsLevel,\n+} from \"@plane/constants\";\n+import { IIssueDisplayFilterOptions } from \"@plane/types\";\n+// hooks\n+// components\n+import { SpreadsheetView } from \"@/components/issues/issue-layouts\";\n+import { AllIssueQuickActions } from \"@/components/issues/issue-layouts/quick-action-dropdowns\";\n+import { SpreadsheetLayoutLoader } from \"@/components/ui\";\n+// hooks\n+import { useIssues, useUserPermissions } from \"@/hooks/store\";\n+import { IssuesStoreContext } from \"@/hooks/use-issue-layout-store\";\n+import { useIssuesActions } from \"@/hooks/use-issues-actions\";\n+import { useWorkspaceIssueProperties } from \"@/hooks/use-workspace-issue-properties\";\n+// store\n+import { IssuePeekOverview } from \"../../../peek-overview\";\n+import { IssueLayoutHOC } from \"../../issue-layout-HOC\";\n+import { TRenderQuickActions } from \"../../list/list-view-types\";\n+\n+type Props = {\n+  isDefaultView: boolean;\n+  isLoading?: boolean;\n+  toggleLoading: (value: boolean) => void;\n+  workspaceSlug: string;\n+  globalViewId: string;\n+  routeFilters: {\n+    [key: string]: string;\n+  };\n+  fetchNextPages: () => void;\n+  globalViewsLoading: boolean;\n+  issuesLoading: boolean;\n+};\n+\n+export const WorkspaceSpreadsheetRoot: React.FC<Props> = observer((props: Props) => {\n+  const { isLoading = false, workspaceSlug, globalViewId, fetchNextPages, issuesLoading } = props;\n+\n+  // Custom hooks\n+  useWorkspaceIssueProperties(workspaceSlug);\n+\n+  // Store hooks\n+  const {\n+    issuesFilter: { filters, updateFilters },\n+    issues: { getIssueLoader, getPaginationData, groupedIssueIds },\n+  } = useIssues(EIssuesStoreType.GLOBAL);\n+  const { updateIssue, removeIssue, archiveIssue } = useIssuesActions(EIssuesStoreType.GLOBAL);\n+  const { allowPermissions } = useUserPermissions();\n+\n+  // Derived values\n+  const issueFilters = globalViewId ? filters?.[globalViewId.toString()] : undefined;\n+\n+  // Permission checker\n+  const canEditProperties = useCallback(\n+    (projectId: string | undefined) => {\n+      if (!projectId) return false;\n+      return allowPermissions(\n+        [EUserPermissions.ADMIN, EUserPermissions.MEMBER],\n+        EUserPermissionsLevel.PROJECT,\n+        workspaceSlug.toString(),\n+        projectId\n+      );\n+    },\n+    [allowPermissions, workspaceSlug]\n+  );\n+\n+  // Display filters handler\n+  const handleDisplayFiltersUpdate = useCallback(\n+    (updatedDisplayFilter: Partial<IIssueDisplayFilterOptions>) => {\n+      if (!workspaceSlug || !globalViewId) return;\n+\n+      updateFilters(\n+        workspaceSlug.toString(),\n+        undefined,\n+        EIssueFilterType.DISPLAY_FILTERS,\n+        { ...updatedDisplayFilter },\n+        globalViewId.toString()\n+      );\n+    },\n+    [updateFilters, workspaceSlug, globalViewId]\n+  );\n+\n+  // Quick actions renderer\n+  const renderQuickActions: TRenderQuickActions = useCallback(\n+    ({ issue, parentRef, customActionButton, placement, portalElement }) => (\n+      <AllIssueQuickActions\n+        parentRef={parentRef}\n+        customActionButton={customActionButton}\n+        issue={issue}\n+        handleDelete={async () => removeIssue(issue.project_id, issue.id)}\n+        handleUpdate={async (data) => updateIssue && updateIssue(issue.project_id, issue.id, data)}\n+        handleArchive={async () => archiveIssue && archiveIssue(issue.project_id, issue.id)}\n+        portalElement={portalElement}\n+        readOnly={!canEditProperties(issue.project_id ?? undefined)}\n+        placements={placement}\n+      />\n+    ),\n+    [canEditProperties, removeIssue, updateIssue, archiveIssue]\n+  );\n+\n+  // Loading state\n+  if ((isLoading && issuesLoading && getIssueLoader() === \"init-loader\") || !globalViewId || !groupedIssueIds) {\n+    return <SpreadsheetLayoutLoader />;\n+  }\n+\n+  // Computed values\n+  const issueIds = groupedIssueIds[ALL_ISSUES];\n+  const nextPageResults = getPaginationData(ALL_ISSUES, undefined)?.nextPageResults;\n+\n+  // Render spreadsheet\n+  return (\n+    <IssuesStoreContext.Provider value={EIssuesStoreType.GLOBAL}>\n+      <IssueLayoutHOC layout={EIssueLayoutTypes.SPREADSHEET}>\n+        <SpreadsheetView\n+          displayProperties={issueFilters?.displayProperties ?? {}}\n+          displayFilters={issueFilters?.displayFilters ?? {}}\n+          handleDisplayFilterUpdate={handleDisplayFiltersUpdate}\n+          issueIds={Array.isArray(issueIds) ? issueIds : []}\n+          quickActions={renderQuickActions}\n+          updateIssue={updateIssue}\n+          canEditProperties={canEditProperties}\n+          canLoadMoreIssues={!!nextPageResults}\n+          loadMoreIssues={fetchNextPages}\n+          isWorkspaceLevel\n+        />\n+        {/* peek overview */}\n+        <IssuePeekOverview />\n+      </IssueLayoutHOC>\n+    </IssuesStoreContext.Provider>\n+  );\n+});\n"
        },
        {
          "path": "web/core/components/views/helper.tsx",
          "status": "added",
          "diff": "Index: web/core/components/views/helper.tsx\n===================================================================\n--- web/core/components/views/helper.tsx\t8988cf9 (parent)\n+++ web/core/components/views/helper.tsx\t64fd0b2 (commit)\n@@ -0,0 +1,51 @@\n+import { EIssueLayoutTypes } from \"@plane/constants\";\n+import { WorkspaceAdditionalLayouts } from \"@/plane-web/components/views/helper\";\n+import { WorkspaceSpreadsheetRoot } from \"../issues/issue-layouts/spreadsheet/roots/workspace-root\";\n+\n+export type TWorkspaceLayoutProps = {\n+  activeLayout: EIssueLayoutTypes | undefined;\n+  isDefaultView: boolean;\n+  isLoading?: boolean;\n+  toggleLoading: (value: boolean) => void;\n+  workspaceSlug: string;\n+  globalViewId: string;\n+  routeFilters: {\n+    [key: string]: string;\n+  };\n+  fetchNextPages: () => void;\n+  globalViewsLoading: boolean;\n+  issuesLoading: boolean;\n+};\n+\n+export const WorkspaceActiveLayout = (props: TWorkspaceLayoutProps) => {\n+  const {\n+    activeLayout = EIssueLayoutTypes.SPREADSHEET,\n+    isDefaultView,\n+    isLoading,\n+    toggleLoading,\n+    workspaceSlug,\n+    globalViewId,\n+    routeFilters,\n+    fetchNextPages,\n+    globalViewsLoading,\n+    issuesLoading,\n+  } = props;\n+  switch (activeLayout) {\n+    case EIssueLayoutTypes.SPREADSHEET:\n+      return (\n+        <WorkspaceSpreadsheetRoot\n+          isDefaultView={isDefaultView}\n+          isLoading={isLoading}\n+          toggleLoading={toggleLoading}\n+          workspaceSlug={workspaceSlug}\n+          globalViewId={globalViewId}\n+          routeFilters={routeFilters}\n+          fetchNextPages={fetchNextPages}\n+          globalViewsLoading={globalViewsLoading}\n+          issuesLoading={issuesLoading}\n+        />\n+      );\n+    default:\n+      return <WorkspaceAdditionalLayouts {...props} />;\n+  }\n+};\n"
        },
        {
          "path": "web/core/hooks/store/use-issues.ts",
          "status": "modified",
          "diff": "Index: web/core/hooks/store/use-issues.ts\n===================================================================\n--- web/core/hooks/store/use-issues.ts\t8988cf9 (parent)\n+++ web/core/hooks/store/use-issues.ts\t64fd0b2 (commit)\n@@ -8,16 +8,17 @@\n import { IProjectEpics, IProjectEpicsFilter } from \"@/plane-web/store/issue/epic\";\n // types\n import { ITeamIssues, ITeamIssuesFilter } from \"@/plane-web/store/issue/team\";\n import { ITeamViewIssues, ITeamViewIssuesFilter } from \"@/plane-web/store/issue/team-views\";\n+import { IWorkspaceIssues } from \"@/plane-web/store/issue/workspace/issue.store\";\n import { IArchivedIssues, IArchivedIssuesFilter } from \"@/store/issue/archived\";\n import { ICycleIssues, ICycleIssuesFilter } from \"@/store/issue/cycle\";\n import { IDraftIssues, IDraftIssuesFilter } from \"@/store/issue/draft\";\n import { IModuleIssues, IModuleIssuesFilter } from \"@/store/issue/module\";\n import { IProfileIssues, IProfileIssuesFilter } from \"@/store/issue/profile\";\n import { IProjectIssues, IProjectIssuesFilter } from \"@/store/issue/project\";\n import { IProjectViewIssues, IProjectViewIssuesFilter } from \"@/store/issue/project-views\";\n-import { IWorkspaceIssues, IWorkspaceIssuesFilter } from \"@/store/issue/workspace\";\n+import { IWorkspaceIssuesFilter } from \"@/store/issue/workspace\";\n import { IWorkspaceDraftIssues, IWorkspaceDraftIssuesFilter } from \"@/store/issue/workspace-draft\";\n // constants\n \n type defaultIssueStore = {\n"
        },
        {
          "path": "web/core/services/workspace.service.ts",
          "status": "modified",
          "diff": "Index: web/core/services/workspace.service.ts\n===================================================================\n--- web/core/services/workspace.service.ts\t8988cf9 (parent)\n+++ web/core/services/workspace.service.ts\t64fd0b2 (commit)\n@@ -262,10 +262,13 @@\n       });\n   }\n \n   async getViewIssues(workspaceSlug: string, params: any, config = {}): Promise<TIssuesResponse> {\n+    const path = params.expand?.includes(\"issue_relation\")\n+      ? `/api/workspaces/${workspaceSlug}/issues-detail/`\n+      : `/api/workspaces/${workspaceSlug}/issues/`;\n     return this.get(\n-      `/api/workspaces/${workspaceSlug}/issues/`,\n+      path,\n       {\n         params,\n       },\n       config\n"
        },
        {
          "path": "web/core/store/issue/helpers/base-issues.store.ts",
          "status": "modified",
          "diff": "Index: web/core/store/issue/helpers/base-issues.store.ts\n===================================================================\n--- web/core/store/issue/helpers/base-issues.store.ts\t8988cf9 (parent)\n+++ web/core/store/issue/helpers/base-issues.store.ts\t64fd0b2 (commit)\n@@ -112,9 +112,9 @@\n     issueId: string,\n     addModuleIds: string[],\n     removeModuleIds: string[]\n   ): Promise<void>;\n-  updateIssueDates(workspaceSlug: string, projectId: string, updates: IBlockUpdateDependencyData[]): Promise<void>;\n+  updateIssueDates(workspaceSlug: string, updates: IBlockUpdateDependencyData[], projectId?: string): Promise<void>;\n }\n \n // This constant maps the group by keys to the respective issue property that the key relies on\n export const ISSUE_GROUP_BY_KEY: Record<TIssueDisplayFilterOptions, keyof TIssue> = {\n@@ -825,11 +825,12 @@\n   };\n \n   async updateIssueDates(\n     workspaceSlug: string,\n-    projectId: string,\n-    updates: { id: string; start_date?: string; target_date?: string }[]\n+    updates: { id: string; start_date?: string; target_date?: string }[],\n+    projectId?: string\n   ) {\n+    if(!projectId) return;\n     const issueDatesBeforeChange: { id: string; start_date?: string; target_date?: string }[] = [];\n     try {\n       const getIssueById = this.rootIssueStore.issues.getIssueById;\n       runInAction(() => {\n"
        },
        {
          "path": "web/core/store/issue/issue-details/relation.store.ts",
          "status": "modified",
          "diff": "Index: web/core/store/issue/issue-details/relation.store.ts\n===================================================================\n--- web/core/store/issue/issue-details/relation.store.ts\t8988cf9 (parent)\n+++ web/core/store/issue/issue-details/relation.store.ts\t64fd0b2 (commit)\n@@ -181,9 +181,9 @@\n    * @returns\n    */\n   createCurrentRelation = async (issueId: string, relationType: TIssueRelationTypes, relatedIssueId: string) => {\n     const workspaceSlug = this.rootIssueDetailStore.rootIssueStore.workspaceSlug;\n-    const projectId = this.rootIssueDetailStore.rootIssueStore.projectId;\n+    const projectId = this.rootIssueDetailStore.issue.getIssueById(issueId)?.project_id;\n \n     if (!workspaceSlug || !projectId) return;\n \n     const reverseRelatedType = REVERSE_RELATIONS[relationType];\n"
        },
        {
          "path": "web/core/store/issue/root.store.ts",
          "status": "modified",
          "diff": "Index: web/core/store/issue/root.store.ts\n===================================================================\n--- web/core/store/issue/root.store.ts\t8988cf9 (parent)\n+++ web/core/store/issue/root.store.ts\t64fd0b2 (commit)\n@@ -13,8 +13,9 @@\n   TeamViewIssues,\n   TeamViewIssuesFilter,\n } from \"@/plane-web/store/issue/team-views\";\n // root store\n+import { IWorkspaceIssues, WorkspaceIssues } from \"@/plane-web/store/issue/workspace/issue.store\";\n import { RootStore } from \"@/plane-web/store/root.store\";\n import { IWorkspaceMembership } from \"@/store/member/workspace-member.store\";\n // issues data store\n import { IArchivedIssuesFilter, ArchivedIssuesFilter, IArchivedIssues, ArchivedIssues } from \"./archived\";\n@@ -31,9 +32,9 @@\n   ProjectViewIssuesFilter,\n   IProjectViewIssues,\n   ProjectViewIssues,\n } from \"./project-views\";\n-import { WorkspaceIssuesFilter, IWorkspaceIssues, WorkspaceIssues, IWorkspaceIssuesFilter } from \"./workspace\";\n+import { WorkspaceIssuesFilter, IWorkspaceIssuesFilter } from \"./workspace\";\n import {\n   IWorkspaceDraftIssues,\n   IWorkspaceDraftIssuesFilter,\n   WorkspaceDraftIssues,\n"
        },
        {
          "path": "web/core/store/issue/workspace/filter.store.ts",
          "status": "modified",
          "diff": "Index: web/core/store/issue/workspace/filter.store.ts\n===================================================================\n--- web/core/store/issue/workspace/filter.store.ts\t8988cf9 (parent)\n+++ web/core/store/issue/workspace/filter.store.ts\t64fd0b2 (commit)\n@@ -131,55 +131,51 @@\n     }\n   );\n \n   fetchFilters = async (workspaceSlug: string, viewId: TWorkspaceFilters) => {\n-    try {\n-      let filters: IIssueFilterOptions;\n-      let displayFilters: IIssueDisplayFilterOptions;\n-      let displayProperties: IIssueDisplayProperties;\n-      let kanbanFilters: TIssueKanbanFilters = {\n-        group_by: [],\n-        sub_group_by: [],\n-      };\n+    let filters: IIssueFilterOptions;\n+    let displayFilters: IIssueDisplayFilterOptions;\n+    let displayProperties: IIssueDisplayProperties;\n+    let kanbanFilters: TIssueKanbanFilters = {\n+      group_by: [],\n+      sub_group_by: [],\n+    };\n \n-      const _filters = this.handleIssuesLocalFilters.get(EIssuesStoreType.GLOBAL, workspaceSlug, undefined, viewId);\n+    const _filters = this.handleIssuesLocalFilters.get(EIssuesStoreType.GLOBAL, workspaceSlug, undefined, viewId);\n+    displayFilters = this.computedDisplayFilters(_filters?.display_filters, {\n+      layout: EIssueLayoutTypes.SPREADSHEET,\n+      order_by: \"-created_at\",\n+    });\n+    displayProperties = this.computedDisplayProperties(_filters?.display_properties);\n+    kanbanFilters = {\n+      group_by: _filters?.kanban_filters?.group_by || [],\n+      sub_group_by: _filters?.kanban_filters?.sub_group_by || [],\n+    };\n+\n+    if ([\"all-issues\", \"assigned\", \"created\", \"subscribed\"].includes(viewId)) {\n+      const currentUserId = this.rootIssueStore.currentUserId;\n+      filters = this.getComputedFiltersBasedOnViews(currentUserId, viewId as TStaticViewTypes);\n+    } else {\n+      const _filters = await this.issueFilterService.getViewDetails(workspaceSlug, viewId);\n+      filters = this.computedFilters(_filters?.filters);\n       displayFilters = this.computedDisplayFilters(_filters?.display_filters, {\n         layout: EIssueLayoutTypes.SPREADSHEET,\n         order_by: \"-created_at\",\n       });\n       displayProperties = this.computedDisplayProperties(_filters?.display_properties);\n-      kanbanFilters = {\n-        group_by: _filters?.kanban_filters?.group_by || [],\n-        sub_group_by: _filters?.kanban_filters?.sub_group_by || [],\n-      };\n+    }\n \n-      if ([\"all-issues\", \"assigned\", \"created\", \"subscribed\"].includes(viewId)) {\n-        const currentUserId = this.rootIssueStore.currentUserId;\n-        filters = this.getComputedFiltersBasedOnViews(currentUserId, viewId as TStaticViewTypes);\n-      } else {\n-        const _filters = await this.issueFilterService.getViewDetails(workspaceSlug, viewId);\n-        filters = this.computedFilters(_filters?.filters);\n-        displayFilters = this.computedDisplayFilters(_filters?.display_filters, {\n-          layout: EIssueLayoutTypes.SPREADSHEET,\n-          order_by: \"-created_at\",\n-        });\n-        displayProperties = this.computedDisplayProperties(_filters?.display_properties);\n-      }\n-\n-      // override existing order by if ordered by manual sort_order\n-      if (displayFilters.order_by === \"sort_order\") {\n-        displayFilters.order_by = \"-created_at\";\n-      }\n-\n-      runInAction(() => {\n-        set(this.filters, [viewId, \"filters\"], filters);\n-        set(this.filters, [viewId, \"displayFilters\"], displayFilters);\n-        set(this.filters, [viewId, \"displayProperties\"], displayProperties);\n-        set(this.filters, [viewId, \"kanbanFilters\"], kanbanFilters);\n-      });\n-    } catch (error) {\n-      throw error;\n+    // override existing order by if ordered by manual sort_order\n+    if (displayFilters.order_by === \"sort_order\") {\n+      displayFilters.order_by = \"-created_at\";\n     }\n+\n+    runInAction(() => {\n+      set(this.filters, [viewId, \"filters\"], filters);\n+      set(this.filters, [viewId, \"displayFilters\"], displayFilters);\n+      set(this.filters, [viewId, \"displayProperties\"], displayProperties);\n+      set(this.filters, [viewId, \"kanbanFilters\"], kanbanFilters);\n+    });\n   };\n \n   updateFilters = async (\n     workspaceSlug: string,\n"
        }
      ]
    },
    {
      "id": "project-peek-analytics",
      "sha": "9812129ad3cb4ac972794786e1c9f3147d1929da",
      "parentSha": "5226b17f90e25db01f387a41fa0c067e4af75c93",
      "spec": "Implement project-scoped analytics and update workspace analytics and client routing.\n\nBackend:\n1) Add project-scoped analytics routes\n- File: apiserver/plane/app/urls/analytic.py\n- Add URL patterns:\n  - workspaces/<str:slug>/projects/<uuid:project_id>/advance-analytics/ → ProjectAdvanceAnalyticsEndpoint (name: project-advance-analytics)\n  - workspaces/<str:slug>/projects/<uuid:project_id>/advance-analytics-stats/ → ProjectAdvanceAnalyticsStatsEndpoint (name: project-advance-analytics-stats)\n  - workspaces/<str:slug>/projects/<uuid:project_id>/advance-analytics-charts/ → ProjectAdvanceAnalyticsChartEndpoint (name: project-advance-analytics-chart)\n\n2) Register project analytics views\n- File: apiserver/plane/app/views/__init__.py\n- Import and expose ProjectAdvanceAnalyticsEndpoint, ProjectAdvanceAnalyticsStatsEndpoint, ProjectAdvanceAnalyticsChartEndpoint alongside existing analytics views.\n\n3) Add project-scoped analytics views\n- File: apiserver/plane/app/views/analytic/project_analytics.py (new)\n- Base: ProjectAdvanceAnalyticsBaseView that sets self.filters via get_analytics_filters(slug, type, user, date_filter, project_ids).\n- ProjectAdvanceAnalyticsEndpoint (GET):\n  - Path params: slug, project_id. Optional query: cycle_id, module_id.\n  - Permissions: ADMIN, MEMBER.\n  - Return counts for total_work_items, started_work_items, backlog_work_items, un_started_work_items, completed_work_items for the specified project. If cycle_id or module_id provided, filter issues via CycleIssue/ModuleIssue; honor analytics_date_range.\n- ProjectAdvanceAnalyticsStatsEndpoint (GET):\n  - Path params: slug, project_id. Query: type=work-items. Optional: cycle_id, module_id.\n  - Permissions: ADMIN, MEMBER.\n  - For type=work-items, return assignee-level aggregation scoped to the project: fields display_name, assignee_id, avatar_url, and distinct counts per state group (cancelled, completed, backlog, unstarted, started). Apply base_filters and chart_period_range when present. Return 400 for unsupported types.\n- ProjectAdvanceAnalyticsChartEndpoint (GET):\n  - Path params: slug, project_id. Query: type in {custom-work-items, work-items}; optional group_by, x_axis; optional cycle_id, module_id for work-items.\n  - Permissions: ADMIN, MEMBER, GUEST.\n  - For type=custom-work-items: build and return build_analytics_chart on project-filtered issues; respect chart_period_range.\n  - For type=work-items: if cycle_id/module_id provided, compute a daily series within the cycle/module date range; otherwise compute a monthly series starting from project.created_at (first day of month) to current month. Each data item must include key, name (date string), count, completed_issues, created_issues. Respect chart_period_range when applicable. Return { data, schema }.\n\n4) Simplify workspace analytics views\n- File: apiserver/plane/app/views/analytic/advance.py\n- AdvanceAnalyticsEndpoint: remove cycle_id/module_id/peek_view handling. get_work_items_stats() should aggregate across workspace using filters[base_filters] and analytics_date_range; GET handler for tab=work-items returns these stats without cycle/module/peek params.\n- AdvanceAnalyticsStatsEndpoint: provide two methods:\n  - get_project_issues_stats(): values(project_id, project__name) with Count annotations for state groups; respect chart_period_range; order by project_id.\n  - get_work_items_stats(): same grouped aggregation across projects (no cycle/module/peek), used by GET when type=work-items.\n- AdvanceAnalyticsChartEndpoint:\n  - work_item_completion_chart(): remove cycle/module/peek logic. Aggregate monthly via TruncMonth(created_at) with created_count and completed_count, filtered by chart_period_range if present; otherwise start at Workspace.created_at (first day of month). Create items with key, name, count (created_count), completed_issues, created_issues.\n  - GET handler: for custom-work-items, do not apply cycle/module filters; only base_filters and optional chart_period_range.\n\nFrontend:\n5) Update analytics service to support peek routing\n- File: web/core/services/analytics-v2.service.ts\n- Update method signatures to accept isPeekView?: boolean:\n  - getAdvanceAnalytics(workspaceSlug, tab, params?, isPeekView?)\n  - getAdvanceAnalyticsStats(workspaceSlug, tab, params?, isPeekView?)\n  - getAdvanceAnalyticsCharts(workspaceSlug, tab, params?, isPeekView?)\n- Implement processUrl(endpoint, workspaceSlug, tab, params?, isPeekView?):\n  - Base URL: /api/workspaces/{workspaceSlug}\n  - If isPeekView is true AND tab === \"work-items\": append /projects/{firstProjectIdFrom(params.project_ids)} before /{endpoint}.\n  - Return the composed URL; do not include a peek_view query parameter.\n\n6) Update analytics components to pass the peek flag and remove peek_view param\n- Files:\n  - web/core/components/analytics-v2/overview/project-insights.tsx\n  - web/core/components/analytics-v2/total-insights.tsx\n  - web/core/components/analytics-v2/work-items/created-vs-resolved.tsx\n  - web/core/components/analytics-v2/work-items/priority-chart.tsx\n  - web/core/components/analytics-v2/work-items/workitems-insight-table.tsx\n- For each call to analyticsV2Service.* methods, pass isPeekView as the new final argument and remove peek_view from the params object. Preserve other params (project_ids, cycle_id, module_id, x_axis/group_by as applicable).\n\nAcceptance criteria:\n- Workspace endpoints no longer accept cycle_id/module_id/peek_view and return workspace-wide aggregations and monthly charts.\n- Project endpoints return project-scoped totals, assignee stats, and created-vs-resolved charts; daily series when cycle/module is specified and monthly otherwise.\n- Frontend sends requests to project URLs only when in peek view for work-items and no longer includes peek_view as a query parameter.\n- All responses respect configured base_filters and date windows (analytics_date_range or chart_period_range).",
      "prompt": "Add project-scoped analytics for peek view and simplify workspace analytics. Create project-level endpoints that return work item totals, assignee stats, and created vs resolved charts for a single project, with optional cycle/module filtering. Adjust workspace analytics to remain workspace-wide only and remove cycle/module/peek handling. On the frontend, update the analytics service to accept a peek flag and automatically route work-items requests in peek view to the project endpoints using the first selected project. Update analytics components to pass this flag and stop sending a peek_view query. Ensure chart aggregations switch between daily (cycle/module) and monthly (project/workspace) and honor date filters.",
      "supplementalFiles": [
        "apiserver/plane/app/views/base.py",
        "apiserver/plane/app/permissions.py",
        "apiserver/plane/utils/build_chart.py",
        "apiserver/plane/utils/date_utils.py",
        "web/core/services/api.service.ts",
        "web/core/hooks/store/use-analytics-v2.ts"
      ],
      "fileDiffs": [
        {
          "path": "apiserver/plane/app/urls/analytic.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/urls/analytic.py\n===================================================================\n--- apiserver/plane/app/urls/analytic.py\t5226b17 (parent)\n+++ apiserver/plane/app/urls/analytic.py\t9812129 (commit)\n@@ -10,8 +10,11 @@\n     AdvanceAnalyticsStatsEndpoint,\n     AdvanceAnalyticsChartEndpoint,\n     DefaultAnalyticsEndpoint,\n     ProjectStatsEndpoint,\n+    ProjectAdvanceAnalyticsEndpoint,\n+    ProjectAdvanceAnalyticsStatsEndpoint,\n+    ProjectAdvanceAnalyticsChartEndpoint,\n )\n \n \n urlpatterns = [\n@@ -66,5 +69,20 @@\n         \"workspaces/<str:slug>/advance-analytics-charts/\",\n         AdvanceAnalyticsChartEndpoint.as_view(),\n         name=\"advance-analytics-chart\",\n     ),\n+    path(\n+        \"workspaces/<str:slug>/projects/<uuid:project_id>/advance-analytics/\",\n+        ProjectAdvanceAnalyticsEndpoint.as_view(),\n+        name=\"project-advance-analytics\",\n+    ),\n+    path(\n+        \"workspaces/<str:slug>/projects/<uuid:project_id>/advance-analytics-stats/\",\n+        ProjectAdvanceAnalyticsStatsEndpoint.as_view(),\n+        name=\"project-advance-analytics-stats\",\n+    ),\n+    path(\n+        \"workspaces/<str:slug>/projects/<uuid:project_id>/advance-analytics-charts/\",\n+        ProjectAdvanceAnalyticsChartEndpoint.as_view(),\n+        name=\"project-advance-analytics-chart\",\n+    ),\n ]\n"
        },
        {
          "path": "apiserver/plane/app/views/__init__.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/views/__init__.py\n===================================================================\n--- apiserver/plane/app/views/__init__.py\t5226b17 (parent)\n+++ apiserver/plane/app/views/__init__.py\t9812129 (commit)\n@@ -204,8 +204,14 @@\n     AdvanceAnalyticsStatsEndpoint,\n     AdvanceAnalyticsChartEndpoint,\n )\n \n+from .analytic.project_analytics import (\n+    ProjectAdvanceAnalyticsEndpoint,\n+    ProjectAdvanceAnalyticsStatsEndpoint,\n+    ProjectAdvanceAnalyticsChartEndpoint,\n+)\n+\n from .notification.base import (\n     NotificationViewSet,\n     UnreadNotificationEndpoint,\n     UserNotificationPreferenceEndpoint,\n"
        },
        {
          "path": "apiserver/plane/app/views/analytic/advance.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/views/analytic/advance.py\n===================================================================\n--- apiserver/plane/app/views/analytic/advance.py\t5226b17 (parent)\n+++ apiserver/plane/app/views/analytic/advance.py\t9812129 (commit)\n@@ -4,9 +4,8 @@\n from django.db.models import QuerySet, Q, Count\n from django.http import HttpRequest\n from django.db.models.functions import TruncMonth\n from django.utils import timezone\n-from datetime import timedelta\n from plane.app.views.base import BaseAPIView\n from plane.app.permissions import ROLE, allow_permission\n from plane.db.models import (\n     WorkspaceMember,\n@@ -16,14 +15,9 @@\n     Module,\n     IssueView,\n     ProjectPage,\n     Workspace,\n-    CycleIssue,\n-    ModuleIssue,\n )\n-from django.db import models\n-from django.db.models import F, Case, When, Value\n-from django.db.models.functions import Concat\n from plane.utils.build_chart import build_analytics_chart\n from plane.utils.date_utils import (\n     get_analytics_filters,\n )\n@@ -117,27 +111,10 @@\n                 )\n             ),\n         }\n \n-    def get_work_items_stats(\n-        self, cycle_id=None, module_id=None\n-    ) -> Dict[str, Dict[str, int]]:\n-        \"\"\"\n-        Returns work item stats for the workspace, or filtered by cycle_id or module_id if provided.\n-        \"\"\"\n-        base_queryset = None\n-        if cycle_id is not None:\n-            cycle_issues = CycleIssue.objects.filter(\n-                **self.filters[\"base_filters\"], cycle_id=cycle_id\n-            ).values_list(\"issue_id\", flat=True)\n-            base_queryset = Issue.issue_objects.filter(id__in=cycle_issues)\n-        elif module_id is not None:\n-            module_issues = ModuleIssue.objects.filter(\n-                **self.filters[\"base_filters\"], module_id=module_id\n-            ).values_list(\"issue_id\", flat=True)\n-            base_queryset = Issue.issue_objects.filter(id__in=module_issues)\n-        else:\n-            base_queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n+    def get_work_items_stats(self) -> Dict[str, Dict[str, int]]:\n+        base_queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n \n         return {\n             \"total_work_items\": self.get_filtered_counts(base_queryset),\n             \"started_work_items\": self.get_filtered_counts(\n@@ -164,13 +141,10 @@\n                 self.get_overview_data(),\n                 status=status.HTTP_200_OK,\n             )\n         elif tab == \"work-items\":\n-            # Optionally accept cycle_id or module_id as query params\n-            cycle_id = request.GET.get(\"cycle_id\", None)\n-            module_id = request.GET.get(\"module_id\", None)\n             return Response(\n-                self.get_work_items_stats(cycle_id=cycle_id, module_id=module_id),\n+                self.get_work_items_stats(),\n                 status=status.HTTP_200_OK,\n             )\n         return Response({\"message\": \"Invalid tab\"}, status=status.HTTP_400_BAD_REQUEST)\n \n@@ -187,10 +161,9 @@\n                 created_at__date__gte=start_date, created_at__date__lte=end_date\n             )\n \n         return (\n-            base_queryset.values(\"project_id\", \"project__name\")\n-            .annotate(\n+            base_queryset.values(\"project_id\", \"project__name\").annotate(\n                 cancelled_work_items=Count(\"id\", filter=Q(state__group=\"cancelled\")),\n                 completed_work_items=Count(\"id\", filter=Q(state__group=\"completed\")),\n                 backlog_work_items=Count(\"id\", filter=Q(state__group=\"backlog\")),\n                 un_started_work_items=Count(\"id\", filter=Q(state__group=\"unstarted\")),\n@@ -198,102 +171,31 @@\n             )\n             .order_by(\"project_id\")\n         )\n \n-    def get_work_items_stats(\n-        self, cycle_id=None, module_id=None, peek_view=False\n-    ) -> Dict[str, Dict[str, int]]:\n-        base_queryset = None\n-        if cycle_id is not None:\n-            cycle_issues = CycleIssue.objects.filter(\n-                **self.filters[\"base_filters\"], cycle_id=cycle_id\n-            ).values_list(\"issue_id\", flat=True)\n-            base_queryset = Issue.issue_objects.filter(id__in=cycle_issues)\n-        elif module_id is not None:\n-            module_issues = ModuleIssue.objects.filter(\n-                **self.filters[\"base_filters\"], module_id=module_id\n-            ).values_list(\"issue_id\", flat=True)\n-            base_queryset = Issue.issue_objects.filter(id__in=module_issues)\n-        elif peek_view:\n-            base_queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n-        else:\n-            base_queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n-            return (\n-                base_queryset.values(\"project_id\", \"project__name\")\n-                .annotate(\n-                    cancelled_work_items=Count(\n-                        \"id\", filter=Q(state__group=\"cancelled\")\n-                    ),\n-                    completed_work_items=Count(\n-                        \"id\", filter=Q(state__group=\"completed\")\n-                    ),\n-                    backlog_work_items=Count(\"id\", filter=Q(state__group=\"backlog\")),\n-                    un_started_work_items=Count(\n-                        \"id\", filter=Q(state__group=\"unstarted\")\n-                    ),\n-                    started_work_items=Count(\"id\", filter=Q(state__group=\"started\")),\n-                )\n-                .order_by(\"project_id\")\n-            )\n-\n+    def get_work_items_stats(self) -> Dict[str, Dict[str, int]]:\n+        base_queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n         return (\n-            base_queryset.annotate(display_name=F(\"assignees__display_name\"))\n-            .annotate(assignee_id=F(\"assignees__id\"))\n-            .annotate(avatar=F(\"assignees__avatar\"))\n+            base_queryset\n+            .values(\"project_id\", \"project__name\")\n             .annotate(\n-                avatar_url=Case(\n-                    # If `avatar_asset` exists, use it to generate the asset URL\n-                    When(\n-                        assignees__avatar_asset__isnull=False,\n-                        then=Concat(\n-                            Value(\"/api/assets/v2/static/\"),\n-                            \"assignees__avatar_asset\",  # Assuming avatar_asset has an id or relevant field\n-                            Value(\"/\"),\n-                        ),\n-                    ),\n-                    # If `avatar_asset` is None, fall back to using `avatar` field directly\n-                    When(\n-                        assignees__avatar_asset__isnull=True, then=\"assignees__avatar\"\n-                    ),\n-                    default=Value(None),\n-                    output_field=models.CharField(),\n-                )\n+                cancelled_work_items=Count(\"id\", filter=Q(state__group=\"cancelled\")),\n+                completed_work_items=Count(\"id\", filter=Q(state__group=\"completed\")),\n+                backlog_work_items=Count(\"id\", filter=Q(state__group=\"backlog\")),\n+                un_started_work_items=Count(\"id\", filter=Q(state__group=\"unstarted\")),\n+                started_work_items=Count(\"id\", filter=Q(state__group=\"started\")),\n             )\n-            .values(\"display_name\", \"assignee_id\", \"avatar_url\")\n-            .annotate(\n-                cancelled_work_items=Count(\n-                    \"id\", filter=Q(state__group=\"cancelled\"), distinct=True\n-                ),\n-                completed_work_items=Count(\n-                    \"id\", filter=Q(state__group=\"completed\"), distinct=True\n-                ),\n-                backlog_work_items=Count(\n-                    \"id\", filter=Q(state__group=\"backlog\"), distinct=True\n-                ),\n-                un_started_work_items=Count(\n-                    \"id\", filter=Q(state__group=\"unstarted\"), distinct=True\n-                ),\n-                started_work_items=Count(\n-                    \"id\", filter=Q(state__group=\"started\"), distinct=True\n-                ),\n-            )\n-            .order_by(\"display_name\")\n+            .order_by(\"project_id\")\n         )\n \n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER], level=\"WORKSPACE\")\n     def get(self, request: HttpRequest, slug: str) -> Response:\n         self.initialize_workspace(slug, type=\"chart\")\n         type = request.GET.get(\"type\", \"work-items\")\n \n         if type == \"work-items\":\n-            # Optionally accept cycle_id or module_id as query params\n-            cycle_id = request.GET.get(\"cycle_id\", None)\n-            module_id = request.GET.get(\"module_id\", None)\n-            peek_view = request.GET.get(\"peek_view\", False)\n             return Response(\n-                self.get_work_items_stats(\n-                    cycle_id=cycle_id, module_id=module_id, peek_view=peek_view\n-                ),\n+                self.get_work_items_stats(),\n                 status=status.HTTP_200_OK,\n             )\n \n         return Response({\"message\": \"Invalid type\"}, status=status.HTTP_400_BAD_REQUEST)\n@@ -351,11 +253,9 @@\n             }\n             for key, value in data.items()\n         ]\n \n-    def work_item_completion_chart(\n-        self, cycle_id=None, module_id=None, peek_view=False\n-    ) -> Dict[str, Any]:\n+    def work_item_completion_chart(self) -> Dict[str, Any]:\n         # Get the base queryset\n         queryset = (\n             Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n             .select_related(\"workspace\", \"state\", \"parent\")\n@@ -363,145 +263,64 @@\n                 \"assignees\", \"labels\", \"issue_module__module\", \"issue_cycle__cycle\"\n             )\n         )\n \n-        if cycle_id is not None and peek_view:\n-            cycle_issues = CycleIssue.objects.filter(\n-                **self.filters[\"base_filters\"], cycle_id=cycle_id\n-            ).values_list(\"issue_id\", flat=True)\n-            cycle = Cycle.objects.filter(id=cycle_id).first()\n-            if cycle and cycle.start_date:\n-                start_date = cycle.start_date.date()\n-                end_date = cycle.end_date.date()\n-            else:\n-                return {\"data\": [], \"schema\": {}}\n-            queryset = cycle_issues\n-        elif module_id is not None and peek_view:\n-            module_issues = ModuleIssue.objects.filter(\n-                **self.filters[\"base_filters\"], module_id=module_id\n-            ).values_list(\"issue_id\", flat=True)\n-            module = Module.objects.filter(id=module_id).first()\n-            if module and module.start_date:\n-                start_date = module.start_date\n-                end_date = module.target_date\n-            else:\n-                return {\"data\": [], \"schema\": {}}\n-            queryset = module_issues\n-        elif peek_view:\n-            project_ids_str = self.request.GET.get(\"project_ids\")\n-            if project_ids_str:\n-                project_id_list = [\n-                    pid.strip() for pid in project_ids_str.split(\",\") if pid.strip()\n-                ]\n-            else:\n-                project_id_list = []\n-                return {\"data\": [], \"schema\": {}}\n-            project_id = project_id_list[0]\n-            project = Project.objects.filter(id=project_id).first()\n-            if project.created_at:\n-                start_date = project.created_at.date().replace(day=1)\n-            else:\n-                return {\"data\": [], \"schema\": {}}\n-        else:\n-            workspace = Workspace.objects.get(slug=self._workspace_slug)\n-            start_date = workspace.created_at.date().replace(day=1)\n+        workspace = Workspace.objects.get(slug=self._workspace_slug)\n+        start_date = workspace.created_at.date().replace(day=1)\n \n-        if cycle_id or module_id:\n-            # Get daily stats with optimized query\n-            daily_stats = (\n-                queryset.values(\"created_at__date\")\n-                .annotate(\n-                    created_count=Count(\"id\"),\n-                    completed_count=Count(\n-                        \"id\", filter=Q(issue__state__group=\"completed\")\n-                    ),\n-                )\n-                .order_by(\"created_at__date\")\n+        # Apply date range filter if available\n+        if self.filters[\"chart_period_range\"]:\n+            start_date, end_date = self.filters[\"chart_period_range\"]\n+            queryset = queryset.filter(\n+                created_at__date__gte=start_date, created_at__date__lte=end_date\n             )\n \n-            # Create a dictionary of existing stats with summed counts\n-            stats_dict = {\n-                stat[\"created_at__date\"].strftime(\"%Y-%m-%d\"): {\n-                    \"created_count\": stat[\"created_count\"],\n-                    \"completed_count\": stat[\"completed_count\"],\n-                }\n-                for stat in daily_stats\n-            }\n-\n-            # Generate data for all days in the range\n-            data = []\n-            current_date = start_date\n-            while current_date <= end_date:\n-                date_str = current_date.strftime(\"%Y-%m-%d\")\n-                stats = stats_dict.get(\n-                    date_str, {\"created_count\": 0, \"completed_count\": 0}\n-                )\n-                data.append(\n-                    {\n-                        \"key\": date_str,\n-                        \"name\": date_str,\n-                        \"count\": stats[\"created_count\"] + stats[\"completed_count\"],\n-                        \"completed_issues\": stats[\"completed_count\"],\n-                        \"created_issues\": stats[\"created_count\"],\n-                    }\n-                )\n-                current_date += timedelta(days=1)\n-        else:\n-            # Apply date range filter if available\n-            if self.filters[\"chart_period_range\"]:\n-                start_date, end_date = self.filters[\"chart_period_range\"]\n-                queryset = queryset.filter(\n-                    created_at__date__gte=start_date, created_at__date__lte=end_date\n-                )\n-\n-            # Annotate by month and count\n-            monthly_stats = (\n-                queryset.annotate(month=TruncMonth(\"created_at\"))\n-                .values(\"month\")\n-                .annotate(\n-                    created_count=Count(\"id\"),\n-                    completed_count=Count(\"id\", filter=Q(state__group=\"completed\")),\n-                )\n-                .order_by(\"month\")\n+        # Annotate by month and count\n+        monthly_stats = (\n+            queryset.annotate(month=TruncMonth(\"created_at\"))\n+            .values(\"month\")\n+            .annotate(\n+                created_count=Count(\"id\"),\n+                completed_count=Count(\"id\", filter=Q(state__group=\"completed\")),\n             )\n+            .order_by(\"month\")\n+        )\n \n-            # Create dictionary of month -> counts\n-            stats_dict = {\n-                stat[\"month\"].strftime(\"%Y-%m-%d\"): {\n-                    \"created_count\": stat[\"created_count\"],\n-                    \"completed_count\": stat[\"completed_count\"],\n-                }\n-                for stat in monthly_stats\n+        # Create dictionary of month -> counts\n+        stats_dict = {\n+            stat[\"month\"].strftime(\"%Y-%m-%d\"): {\n+                \"created_count\": stat[\"created_count\"],\n+                \"completed_count\": stat[\"completed_count\"],\n             }\n+            for stat in monthly_stats\n+        }\n \n-            # Generate monthly data (ensure months with 0 count are included)\n-            data = []\n-            # include the current date at the end\n-            end_date = timezone.now().date()\n-            last_month = end_date.replace(day=1)\n-            current_month = start_date\n+        # Generate monthly data (ensure months with 0 count are included)\n+        data = []\n+        # include the current date at the end\n+        end_date = timezone.now().date()\n+        last_month = end_date.replace(day=1)\n+        current_month = start_date\n \n-            while current_month <= last_month:\n-                date_str = current_month.strftime(\"%Y-%m-%d\")\n-                stats = stats_dict.get(\n-                    date_str, {\"created_count\": 0, \"completed_count\": 0}\n+        while current_month <= last_month:\n+            date_str = current_month.strftime(\"%Y-%m-%d\")\n+            stats = stats_dict.get(date_str, {\"created_count\": 0, \"completed_count\": 0})\n+            data.append(\n+                {\n+                    \"key\": date_str,\n+                    \"name\": date_str,\n+                    \"count\": stats[\"created_count\"],\n+                    \"completed_issues\": stats[\"completed_count\"],\n+                    \"created_issues\": stats[\"created_count\"],\n+                }\n+            )\n+            # Move to next month\n+            if current_month.month == 12:\n+                current_month = current_month.replace(\n+                    year=current_month.year + 1, month=1\n                 )\n-                data.append(\n-                    {\n-                        \"key\": date_str,\n-                        \"name\": date_str,\n-                        \"count\": stats[\"created_count\"],\n-                        \"completed_issues\": stats[\"completed_count\"],\n-                        \"created_issues\": stats[\"created_count\"],\n-                    }\n-                )\n-                # Move to next month\n-                if current_month.month == 12:\n-                    current_month = current_month.replace(\n-                        year=current_month.year + 1, month=1\n-                    )\n-                else:\n-                    current_month = current_month.replace(month=current_month.month + 1)\n+            else:\n+                current_month = current_month.replace(month=current_month.month + 1)\n \n         schema = {\n             \"completed_issues\": \"completed_issues\",\n             \"created_issues\": \"created_issues\",\n@@ -514,10 +333,8 @@\n         self.initialize_workspace(slug, type=\"chart\")\n         type = request.GET.get(\"type\", \"projects\")\n         group_by = request.GET.get(\"group_by\", None)\n         x_axis = request.GET.get(\"x_axis\", \"PRIORITY\")\n-        cycle_id = request.GET.get(\"cycle_id\", None)\n-        module_id = request.GET.get(\"module_id\", None)\n \n         if type == \"projects\":\n             return Response(self.project_chart(), status=status.HTTP_200_OK)\n \n@@ -529,21 +346,8 @@\n                     \"assignees\", \"labels\", \"issue_module__module\", \"issue_cycle__cycle\"\n                 )\n             )\n \n-            # Apply cycle/module filters if present\n-            if cycle_id is not None:\n-                cycle_issues = CycleIssue.objects.filter(\n-                    **self.filters[\"base_filters\"], cycle_id=cycle_id\n-                ).values_list(\"issue_id\", flat=True)\n-                queryset = queryset.filter(id__in=cycle_issues)\n-\n-            elif module_id is not None:\n-                module_issues = ModuleIssue.objects.filter(\n-                    **self.filters[\"base_filters\"], module_id=module_id\n-                ).values_list(\"issue_id\", flat=True)\n-                queryset = queryset.filter(id__in=module_issues)\n-\n             # Apply date range filter if available\n             if self.filters[\"chart_period_range\"]:\n                 start_date, end_date = self.filters[\"chart_period_range\"]\n                 queryset = queryset.filter(\n@@ -555,16 +359,10 @@\n                 status=status.HTTP_200_OK,\n             )\n \n         elif type == \"work-items\":\n-            # Optionally accept cycle_id or module_id as query params\n-            cycle_id = request.GET.get(\"cycle_id\", None)\n-            module_id = request.GET.get(\"module_id\", None)\n-            peek_view = request.GET.get(\"peek_view\", False)\n             return Response(\n-                self.work_item_completion_chart(\n-                    cycle_id=cycle_id, module_id=module_id, peek_view=peek_view\n-                ),\n+                self.work_item_completion_chart(),\n                 status=status.HTTP_200_OK,\n             )\n \n         return Response({\"message\": \"Invalid type\"}, status=status.HTTP_400_BAD_REQUEST)\n"
        },
        {
          "path": "apiserver/plane/app/views/analytic/project_analytics.py",
          "status": "added",
          "diff": "Index: apiserver/plane/app/views/analytic/project_analytics.py\n===================================================================\n--- apiserver/plane/app/views/analytic/project_analytics.py\t5226b17 (parent)\n+++ apiserver/plane/app/views/analytic/project_analytics.py\t9812129 (commit)\n@@ -0,0 +1,421 @@\n+from rest_framework.response import Response\n+from rest_framework import status\n+from typing import Dict, Any\n+from django.db.models import QuerySet, Q, Count\n+from django.http import HttpRequest\n+from django.db.models.functions import TruncMonth\n+from django.utils import timezone\n+from datetime import timedelta\n+from plane.app.views.base import BaseAPIView\n+from plane.app.permissions import ROLE, allow_permission\n+from plane.db.models import (\n+    Project,\n+    Issue,\n+    Cycle,\n+    Module,\n+    CycleIssue,\n+    ModuleIssue,\n+)\n+from django.db import models\n+from django.db.models import F, Case, When, Value\n+from django.db.models.functions import Concat\n+from plane.utils.build_chart import build_analytics_chart\n+from plane.utils.date_utils import (\n+    get_analytics_filters,\n+)\n+\n+\n+class ProjectAdvanceAnalyticsBaseView(BaseAPIView):\n+    def initialize_workspace(self, slug: str, type: str) -> None:\n+        self._workspace_slug = slug\n+        self.filters = get_analytics_filters(\n+            slug=slug,\n+            type=type,\n+            user=self.request.user,\n+            date_filter=self.request.GET.get(\"date_filter\", None),\n+            project_ids=self.request.GET.get(\"project_ids\", None),\n+        )\n+\n+\n+class ProjectAdvanceAnalyticsEndpoint(ProjectAdvanceAnalyticsBaseView):\n+    def get_filtered_counts(self, queryset: QuerySet) -> Dict[str, int]:\n+        def get_filtered_count() -> int:\n+            if self.filters[\"analytics_date_range\"]:\n+                return queryset.filter(\n+                    created_at__gte=self.filters[\"analytics_date_range\"][\"current\"][\n+                        \"gte\"\n+                    ],\n+                    created_at__lte=self.filters[\"analytics_date_range\"][\"current\"][\n+                        \"lte\"\n+                    ],\n+                ).count()\n+            return queryset.count()\n+\n+        return {\n+            \"count\": get_filtered_count(),\n+        }\n+\n+    def get_work_items_stats(\n+        self, project_id, cycle_id=None, module_id=None\n+    ) -> Dict[str, Dict[str, int]]:\n+        \"\"\"\n+        Returns work item stats for the workspace, or filtered by cycle_id or module_id if provided.\n+        \"\"\"\n+        base_queryset = None\n+        if cycle_id is not None:\n+            cycle_issues = CycleIssue.objects.filter(\n+                **self.filters[\"base_filters\"], cycle_id=cycle_id\n+            ).values_list(\"issue_id\", flat=True)\n+            base_queryset = Issue.issue_objects.filter(id__in=cycle_issues)\n+        elif module_id is not None:\n+            module_issues = ModuleIssue.objects.filter(\n+                **self.filters[\"base_filters\"], module_id=module_id\n+            ).values_list(\"issue_id\", flat=True)\n+            base_queryset = Issue.issue_objects.filter(id__in=module_issues)\n+        else:\n+            base_queryset = Issue.issue_objects.filter(\n+                **self.filters[\"base_filters\"], project_id=project_id\n+            )\n+\n+        return {\n+            \"total_work_items\": self.get_filtered_counts(base_queryset),\n+            \"started_work_items\": self.get_filtered_counts(\n+                base_queryset.filter(state__group=\"started\")\n+            ),\n+            \"backlog_work_items\": self.get_filtered_counts(\n+                base_queryset.filter(state__group=\"backlog\")\n+            ),\n+            \"un_started_work_items\": self.get_filtered_counts(\n+                base_queryset.filter(state__group=\"unstarted\")\n+            ),\n+            \"completed_work_items\": self.get_filtered_counts(\n+                base_queryset.filter(state__group=\"completed\")\n+            ),\n+        }\n+\n+    @allow_permission([ROLE.ADMIN, ROLE.MEMBER])\n+    def get(self, request: HttpRequest, slug: str, project_id: str) -> Response:\n+        self.initialize_workspace(slug, type=\"analytics\")\n+\n+        # Optionally accept cycle_id or module_id as query params\n+        cycle_id = request.GET.get(\"cycle_id\", None)\n+        module_id = request.GET.get(\"module_id\", None)\n+        return Response(\n+            self.get_work_items_stats(\n+                cycle_id=cycle_id, module_id=module_id, project_id=project_id\n+            ),\n+            status=status.HTTP_200_OK,\n+        )\n+\n+\n+class ProjectAdvanceAnalyticsStatsEndpoint(ProjectAdvanceAnalyticsBaseView):\n+    def get_project_issues_stats(self) -> QuerySet:\n+        # Get the base queryset with workspace and project filters\n+        base_queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n+\n+        # Apply date range filter if available\n+        if self.filters[\"chart_period_range\"]:\n+            start_date, end_date = self.filters[\"chart_period_range\"]\n+            base_queryset = base_queryset.filter(\n+                created_at__date__gte=start_date, created_at__date__lte=end_date\n+            )\n+\n+        return (\n+            base_queryset.values(\"project_id\", \"project__name\")\n+            .annotate(\n+                cancelled_work_items=Count(\"id\", filter=Q(state__group=\"cancelled\")),\n+                completed_work_items=Count(\"id\", filter=Q(state__group=\"completed\")),\n+                backlog_work_items=Count(\"id\", filter=Q(state__group=\"backlog\")),\n+                un_started_work_items=Count(\"id\", filter=Q(state__group=\"unstarted\")),\n+                started_work_items=Count(\"id\", filter=Q(state__group=\"started\")),\n+            )\n+            .order_by(\"project_id\")\n+        )\n+\n+    def get_work_items_stats(\n+        self, project_id, cycle_id=None, module_id=None\n+    ) -> Dict[str, Dict[str, int]]:\n+        base_queryset = None\n+        if cycle_id is not None:\n+            cycle_issues = CycleIssue.objects.filter(\n+                **self.filters[\"base_filters\"], cycle_id=cycle_id\n+            ).values_list(\"issue_id\", flat=True)\n+            base_queryset = Issue.issue_objects.filter(id__in=cycle_issues)\n+        elif module_id is not None:\n+            module_issues = ModuleIssue.objects.filter(\n+                **self.filters[\"base_filters\"], module_id=module_id\n+            ).values_list(\"issue_id\", flat=True)\n+            base_queryset = Issue.issue_objects.filter(id__in=module_issues)\n+        else:\n+            base_queryset = Issue.issue_objects.filter(\n+                **self.filters[\"base_filters\"], project_id=project_id\n+            )\n+        return (\n+            base_queryset.annotate(display_name=F(\"assignees__display_name\"))\n+            .annotate(assignee_id=F(\"assignees__id\"))\n+            .annotate(avatar=F(\"assignees__avatar\"))\n+            .annotate(\n+                avatar_url=Case(\n+                    # If `avatar_asset` exists, use it to generate the asset URL\n+                    When(\n+                        assignees__avatar_asset__isnull=False,\n+                        then=Concat(\n+                            Value(\"/api/assets/v2/static/\"),\n+                            \"assignees__avatar_asset\",  # Assuming avatar_asset has an id or relevant field\n+                            Value(\"/\"),\n+                        ),\n+                    ),\n+                    # If `avatar_asset` is None, fall back to using `avatar` field directly\n+                    When(\n+                        assignees__avatar_asset__isnull=True, then=\"assignees__avatar\"\n+                    ),\n+                    default=Value(None),\n+                    output_field=models.CharField(),\n+                )\n+            )\n+            .values(\"display_name\", \"assignee_id\", \"avatar_url\")\n+            .annotate(\n+                cancelled_work_items=Count(\n+                    \"id\", filter=Q(state__group=\"cancelled\"), distinct=True\n+                ),\n+                completed_work_items=Count(\n+                    \"id\", filter=Q(state__group=\"completed\"), distinct=True\n+                ),\n+                backlog_work_items=Count(\n+                    \"id\", filter=Q(state__group=\"backlog\"), distinct=True\n+                ),\n+                un_started_work_items=Count(\n+                    \"id\", filter=Q(state__group=\"unstarted\"), distinct=True\n+                ),\n+                started_work_items=Count(\n+                    \"id\", filter=Q(state__group=\"started\"), distinct=True\n+                ),\n+            )\n+            .order_by(\"display_name\")\n+        )\n+\n+    @allow_permission([ROLE.ADMIN, ROLE.MEMBER])\n+    def get(self, request: HttpRequest, slug: str, project_id: str) -> Response:\n+        self.initialize_workspace(slug, type=\"chart\")\n+        type = request.GET.get(\"type\", \"work-items\")\n+\n+        if type == \"work-items\":\n+            # Optionally accept cycle_id or module_id as query params\n+            cycle_id = request.GET.get(\"cycle_id\", None)\n+            module_id = request.GET.get(\"module_id\", None)\n+            return Response(\n+                self.get_work_items_stats(\n+                    project_id=project_id, cycle_id=cycle_id, module_id=module_id\n+                ),\n+                status=status.HTTP_200_OK,\n+            )\n+\n+        return Response({\"message\": \"Invalid type\"}, status=status.HTTP_400_BAD_REQUEST)\n+\n+\n+class ProjectAdvanceAnalyticsChartEndpoint(ProjectAdvanceAnalyticsBaseView):\n+    def work_item_completion_chart(\n+        self, project_id, cycle_id=None, module_id=None\n+    ) -> Dict[str, Any]:\n+        # Get the base queryset\n+        queryset = (\n+            Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n+            .filter(project_id=project_id)\n+            .select_related(\"workspace\", \"state\", \"parent\")\n+            .prefetch_related(\n+                \"assignees\", \"labels\", \"issue_module__module\", \"issue_cycle__cycle\"\n+            )\n+        )\n+\n+        if cycle_id is not None:\n+            cycle_issues = CycleIssue.objects.filter(\n+                **self.filters[\"base_filters\"], cycle_id=cycle_id\n+            ).values_list(\"issue_id\", flat=True)\n+            cycle = Cycle.objects.filter(id=cycle_id).first()\n+            if cycle and cycle.start_date:\n+                start_date = cycle.start_date.date()\n+                end_date = cycle.end_date.date()\n+            else:\n+                return {\"data\": [], \"schema\": {}}\n+            queryset = cycle_issues\n+\n+        elif module_id is not None:\n+            module_issues = ModuleIssue.objects.filter(\n+                **self.filters[\"base_filters\"], module_id=module_id\n+            ).values_list(\"issue_id\", flat=True)\n+            module = Module.objects.filter(id=module_id).first()\n+            if module and module.start_date:\n+                start_date = module.start_date\n+                end_date = module.target_date\n+            else:\n+                return {\"data\": [], \"schema\": {}}\n+            queryset = module_issues\n+\n+        else:\n+            project = Project.objects.filter(id=project_id).first()\n+            if project.created_at:\n+                start_date = project.created_at.date().replace(day=1)\n+            else:\n+                return {\"data\": [], \"schema\": {}}\n+\n+        if cycle_id or module_id:\n+            # Get daily stats with optimized query\n+            daily_stats = (\n+                queryset.values(\"created_at__date\")\n+                .annotate(\n+                    created_count=Count(\"id\"),\n+                    completed_count=Count(\n+                        \"id\", filter=Q(issue__state__group=\"completed\")\n+                    ),\n+                )\n+                .order_by(\"created_at__date\")\n+            )\n+\n+            # Create a dictionary of existing stats with summed counts\n+            stats_dict = {\n+                stat[\"created_at__date\"].strftime(\"%Y-%m-%d\"): {\n+                    \"created_count\": stat[\"created_count\"],\n+                    \"completed_count\": stat[\"completed_count\"],\n+                }\n+                for stat in daily_stats\n+            }\n+\n+            # Generate data for all days in the range\n+            data = []\n+            current_date = start_date\n+            while current_date <= end_date:\n+                date_str = current_date.strftime(\"%Y-%m-%d\")\n+                stats = stats_dict.get(\n+                    date_str, {\"created_count\": 0, \"completed_count\": 0}\n+                )\n+                data.append(\n+                    {\n+                        \"key\": date_str,\n+                        \"name\": date_str,\n+                        \"count\": stats[\"created_count\"] + stats[\"completed_count\"],\n+                        \"completed_issues\": stats[\"completed_count\"],\n+                        \"created_issues\": stats[\"created_count\"],\n+                    }\n+                )\n+                current_date += timedelta(days=1)\n+        else:\n+            # Apply date range filter if available\n+            if self.filters[\"chart_period_range\"]:\n+                start_date, end_date = self.filters[\"chart_period_range\"]\n+                queryset = queryset.filter(\n+                    created_at__date__gte=start_date, created_at__date__lte=end_date\n+                )\n+\n+            # Annotate by month and count\n+            monthly_stats = (\n+                queryset.annotate(month=TruncMonth(\"created_at\"))\n+                .values(\"month\")\n+                .annotate(\n+                    created_count=Count(\"id\"),\n+                    completed_count=Count(\"id\", filter=Q(state__group=\"completed\")),\n+                )\n+                .order_by(\"month\")\n+            )\n+\n+            # Create dictionary of month -> counts\n+            stats_dict = {\n+                stat[\"month\"].strftime(\"%Y-%m-%d\"): {\n+                    \"created_count\": stat[\"created_count\"],\n+                    \"completed_count\": stat[\"completed_count\"],\n+                }\n+                for stat in monthly_stats\n+            }\n+\n+            # Generate monthly data (ensure months with 0 count are included)\n+            data = []\n+            # include the current date at the end\n+            end_date = timezone.now().date()\n+            last_month = end_date.replace(day=1)\n+            current_month = start_date\n+\n+            while current_month <= last_month:\n+                date_str = current_month.strftime(\"%Y-%m-%d\")\n+                stats = stats_dict.get(\n+                    date_str, {\"created_count\": 0, \"completed_count\": 0}\n+                )\n+                data.append(\n+                    {\n+                        \"key\": date_str,\n+                        \"name\": date_str,\n+                        \"count\": stats[\"created_count\"],\n+                        \"completed_issues\": stats[\"completed_count\"],\n+                        \"created_issues\": stats[\"created_count\"],\n+                    }\n+                )\n+                # Move to next month\n+                if current_month.month == 12:\n+                    current_month = current_month.replace(\n+                        year=current_month.year + 1, month=1\n+                    )\n+                else:\n+                    current_month = current_month.replace(month=current_month.month + 1)\n+\n+        schema = {\n+            \"completed_issues\": \"completed_issues\",\n+            \"created_issues\": \"created_issues\",\n+        }\n+\n+        return {\"data\": data, \"schema\": schema}\n+\n+    @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n+    def get(self, request: HttpRequest, slug: str, project_id: str) -> Response:\n+        self.initialize_workspace(slug, type=\"chart\")\n+        type = request.GET.get(\"type\", \"projects\")\n+        group_by = request.GET.get(\"group_by\", None)\n+        x_axis = request.GET.get(\"x_axis\", \"PRIORITY\")\n+        cycle_id = request.GET.get(\"cycle_id\", None)\n+        module_id = request.GET.get(\"module_id\", None)\n+\n+        if type == \"custom-work-items\":\n+            queryset = (\n+                Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n+                .filter(project_id=project_id)\n+                .select_related(\"workspace\", \"state\", \"parent\")\n+                .prefetch_related(\n+                    \"assignees\", \"labels\", \"issue_module__module\", \"issue_cycle__cycle\"\n+                )\n+            )\n+\n+            # Apply cycle/module filters if present\n+            if cycle_id is not None:\n+                cycle_issues = CycleIssue.objects.filter(\n+                    **self.filters[\"base_filters\"], cycle_id=cycle_id\n+                ).values_list(\"issue_id\", flat=True)\n+                queryset = queryset.filter(id__in=cycle_issues)\n+\n+            elif module_id is not None:\n+                module_issues = ModuleIssue.objects.filter(\n+                    **self.filters[\"base_filters\"], module_id=module_id\n+                ).values_list(\"issue_id\", flat=True)\n+                queryset = queryset.filter(id__in=module_issues)\n+\n+            # Apply date range filter if available\n+            if self.filters[\"chart_period_range\"]:\n+                start_date, end_date = self.filters[\"chart_period_range\"]\n+                queryset = queryset.filter(\n+                    created_at__date__gte=start_date, created_at__date__lte=end_date\n+                )\n+\n+            return Response(\n+                build_analytics_chart(queryset, x_axis, group_by),\n+                status=status.HTTP_200_OK,\n+            )\n+\n+        elif type == \"work-items\":\n+            # Optionally accept cycle_id or module_id as query params\n+            cycle_id = request.GET.get(\"cycle_id\", None)\n+            module_id = request.GET.get(\"module_id\", None)\n+\n+            return Response(\n+                self.work_item_completion_chart(\n+                    project_id=project_id, cycle_id=cycle_id, module_id=module_id\n+                ),\n+                status=status.HTTP_200_OK,\n+            )\n+\n+        return Response({\"message\": \"Invalid type\"}, status=status.HTTP_400_BAD_REQUEST)\n"
        },
        {
          "path": "web/core/components/analytics-v2/overview/project-insights.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/overview/project-insights.tsx\n===================================================================\n--- web/core/components/analytics-v2/overview/project-insights.tsx\t5226b17 (parent)\n+++ web/core/components/analytics-v2/overview/project-insights.tsx\t9812129 (commit)\n@@ -38,10 +38,11 @@\n         // date_filter: selectedDuration,\n         ...(selectedProjects?.length > 0 && { project_ids: selectedProjects?.join(\",\") }),\n         ...(selectedCycle ? { cycle_id: selectedCycle } : {}),\n         ...(selectedModule ? { module_id: selectedModule } : {}),\n-        ...(isPeekView ? { peek_view: true } : {}),\n-      })\n+      },\n+        isPeekView\n+      )\n   );\n \n   return (\n     <AnalyticsSectionWrapper\n"
        },
        {
          "path": "web/core/components/analytics-v2/total-insights.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/total-insights.tsx\n===================================================================\n--- web/core/components/analytics-v2/total-insights.tsx\t5226b17 (parent)\n+++ web/core/components/analytics-v2/total-insights.tsx\t9812129 (commit)\n@@ -25,15 +25,19 @@\n \n     const { data: totalInsightsData, isLoading } = useSWR(\n       `total-insights-${analyticsType}-${selectedDuration}-${selectedProjects}-${selectedCycle}-${selectedModule}-${isPeekView}`,\n       () =>\n-        analyticsV2Service.getAdvanceAnalytics<IAnalyticsResponseV2>(workspaceSlug, analyticsType, {\n-          // date_filter: selectedDuration,\n-          ...(selectedProjects?.length > 0 ? { project_ids: selectedProjects.join(\",\") } : {}),\n-          ...(selectedCycle ? { cycle_id: selectedCycle } : {}),\n-          ...(selectedModule ? { module_id: selectedModule } : {}),\n-          ...(isPeekView ? { peek_view: true } : {}),\n-        })\n+        analyticsV2Service.getAdvanceAnalytics<IAnalyticsResponseV2>(\n+          workspaceSlug,\n+          analyticsType,\n+          {\n+            // date_filter: selectedDuration,\n+            ...(selectedProjects?.length > 0 ? { project_ids: selectedProjects.join(\",\") } : {}),\n+            ...(selectedCycle ? { cycle_id: selectedCycle } : {}),\n+            ...(selectedModule ? { module_id: selectedModule } : {}),\n+          },\n+          isPeekView\n+        )\n     );\n     return (\n       <div\n         className={cn(\n"
        },
        {
          "path": "web/core/components/analytics-v2/work-items/created-vs-resolved.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/work-items/created-vs-resolved.tsx\n===================================================================\n--- web/core/components/analytics-v2/work-items/created-vs-resolved.tsx\t5226b17 (parent)\n+++ web/core/components/analytics-v2/work-items/created-vs-resolved.tsx\t9812129 (commit)\n@@ -32,10 +32,11 @@\n         // date_filter: selectedDuration,\n         ...(selectedProjects?.length > 0 && { project_ids: selectedProjects?.join(\",\") }),\n         ...(selectedCycle ? { cycle_id: selectedCycle } : {}),\n         ...(selectedModule ? { module_id: selectedModule } : {}),\n-        ...(isPeekView ? { peek_view: true } : {}),\n-      })\n+      },\n+        isPeekView\n+      )\n   );\n   const parsedData: TChartData<string, string>[] = useMemo(() => {\n     if (!createdVsResolvedData?.data) return [];\n     return createdVsResolvedData.data.map((datum) => ({\n"
        },
        {
          "path": "web/core/components/analytics-v2/work-items/priority-chart.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/work-items/priority-chart.tsx\n===================================================================\n--- web/core/components/analytics-v2/work-items/priority-chart.tsx\t5226b17 (parent)\n+++ web/core/components/analytics-v2/work-items/priority-chart.tsx\t9812129 (commit)\n@@ -56,16 +56,20 @@\n   const { data: priorityChartData, isLoading: priorityChartLoading } = useSWR(\n     `customized-insights-chart-${workspaceSlug}-${selectedDuration}-\n     ${selectedProjects}-${selectedCycle}-${selectedModule}-${props.x_axis}-${props.y_axis}-${props.group_by}-${isPeekView}`,\n     () =>\n-      analyticsV2Service.getAdvanceAnalyticsCharts<TChart>(workspaceSlug, \"custom-work-items\", {\n-        // date_filter: selectedDuration,\n-        ...(selectedProjects?.length > 0 && { project_ids: selectedProjects?.join(\",\") }),\n-        ...(selectedCycle ? { cycle_id: selectedCycle } : {}),\n-        ...(selectedModule ? { module_id: selectedModule } : {}),\n-        ...(isPeekView ? { peek_view: true } : {}),\n-        ...props,\n-      })\n+      analyticsV2Service.getAdvanceAnalyticsCharts<TChart>(\n+        workspaceSlug,\n+        \"custom-work-items\",\n+        {\n+          // date_filter: selectedDuration,\n+          ...(selectedProjects?.length > 0 && { project_ids: selectedProjects?.join(\",\") }),\n+          ...(selectedCycle ? { cycle_id: selectedCycle } : {}),\n+          ...(selectedModule ? { module_id: selectedModule } : {}),\n+          ...props,\n+        },\n+        isPeekView\n+      )\n   );\n   const parsedData = useMemo(\n     () =>\n       priorityChartData && parseChartData(priorityChartData, props.x_axis, props.group_by, props.x_axis_date_grouping),\n"
        },
        {
          "path": "web/core/components/analytics-v2/work-items/workitems-insight-table.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/work-items/workitems-insight-table.tsx\n===================================================================\n--- web/core/components/analytics-v2/work-items/workitems-insight-table.tsx\t5226b17 (parent)\n+++ web/core/components/analytics-v2/work-items/workitems-insight-table.tsx\t9812129 (commit)\n@@ -30,15 +30,19 @@\n   const { selectedDuration, selectedProjects, selectedCycle, selectedModule, isPeekView } = useAnalyticsV2();\n   const { data: workItemsData, isLoading } = useSWR(\n     `insights-table-work-items-${workspaceSlug}-${selectedDuration}-${selectedProjects}-${selectedCycle}-${selectedModule}-${isPeekView}`,\n     () =>\n-      analyticsV2Service.getAdvanceAnalyticsStats<WorkItemInsightColumns[]>(workspaceSlug, \"work-items\", {\n-        // date_filter: selectedDuration,\n-        ...(selectedProjects?.length > 0 ? { project_ids: selectedProjects.join(\",\") } : {}),\n-        ...(selectedCycle ? { cycle_id: selectedCycle } : {}),\n-        ...(selectedModule ? { module_id: selectedModule } : {}),\n-        ...(isPeekView ? { peek_view: true } : {}),\n-      })\n+      analyticsV2Service.getAdvanceAnalyticsStats<WorkItemInsightColumns[]>(\n+        workspaceSlug,\n+        \"work-items\",\n+        {\n+          // date_filter: selectedDuration,\n+          ...(selectedProjects?.length > 0 ? { project_ids: selectedProjects.join(\",\") } : {}),\n+          ...(selectedCycle ? { cycle_id: selectedCycle } : {}),\n+          ...(selectedModule ? { module_id: selectedModule } : {}),\n+        },\n+        isPeekView\n+      )\n   );\n   // derived values\n   const columnsLabels = useMemo(\n     () => ({\n"
        },
        {
          "path": "web/core/services/analytics-v2.service.ts",
          "status": "modified",
          "diff": "Index: web/core/services/analytics-v2.service.ts\n===================================================================\n--- web/core/services/analytics-v2.service.ts\t5226b17 (parent)\n+++ web/core/services/analytics-v2.service.ts\t9812129 (commit)\n@@ -9,16 +9,20 @@\n \n   async getAdvanceAnalytics<T extends IAnalyticsResponseV2>(\n     workspaceSlug: string,\n     tab: TAnalyticsTabsV2Base,\n-    params?: Record<string, any>\n+    params?: Record<string, any>,\n+    isPeekView?: boolean\n   ): Promise<T> {\n-    return this.get(`/api/workspaces/${workspaceSlug}/advance-analytics/`, {\n-      params: {\n-        tab,\n-        ...params,\n-      },\n-    })\n+    return this.get(\n+      this.processUrl<TAnalyticsTabsV2Base>(\"advance-analytics\", workspaceSlug, tab, params, isPeekView),\n+      {\n+        params: {\n+          tab,\n+          ...params,\n+        },\n+      }\n+    )\n       .then((res) => res?.data)\n       .catch((err) => {\n         throw err?.response?.data;\n       });\n@@ -26,11 +30,19 @@\n \n   async getAdvanceAnalyticsStats<T>(\n     workspaceSlug: string,\n     tab: Exclude<TAnalyticsTabsV2Base, \"overview\">,\n-    params?: Record<string, any>\n+    params?: Record<string, any>,\n+    isPeekView?: boolean\n   ): Promise<T> {\n-    return this.get(`/api/workspaces/${workspaceSlug}/advance-analytics-stats/`, {\n+    const processedUrl = this.processUrl<Exclude<TAnalyticsTabsV2Base, \"overview\">>(\n+      \"advance-analytics-stats\",\n+      workspaceSlug,\n+      tab,\n+      params,\n+      isPeekView\n+    );\n+    return this.get(processedUrl, {\n       params: {\n         type: tab,\n         ...params,\n       },\n@@ -43,11 +55,19 @@\n \n   async getAdvanceAnalyticsCharts<T>(\n     workspaceSlug: string,\n     tab: TAnalyticsGraphsV2Base,\n-    params?: Record<string, any>\n+    params?: Record<string, any>,\n+    isPeekView?: boolean\n   ): Promise<T> {\n-    return this.get(`/api/workspaces/${workspaceSlug}/advance-analytics-charts/`, {\n+    const processedUrl = this.processUrl<TAnalyticsGraphsV2Base>(\n+      \"advance-analytics-charts\",\n+      workspaceSlug,\n+      tab,\n+      params,\n+      isPeekView\n+    );\n+    return this.get(processedUrl, {\n       params: {\n         type: tab,\n         ...params,\n       },\n@@ -56,5 +76,20 @@\n       .catch((err) => {\n         throw err?.response?.data;\n       });\n   }\n+\n+  processUrl<T extends string>(\n+    endpoint: string,\n+    workspaceSlug: string,\n+    tab: T,\n+    params?: Record<string, any>,\n+    isPeekView?: boolean\n+  ) {\n+    let processedUrl = `/api/workspaces/${workspaceSlug}`;\n+    if (isPeekView && tab === \"work-items\") {\n+      const projectId = params?.project_ids.split(\",\")[0];\n+      processedUrl += `/projects/${projectId}`;\n+    }\n+    return `${processedUrl}/${endpoint}`;\n+  }\n }\n"
        }
      ]
    },
    {
      "id": "add-advanced-analytics",
      "sha": "b435ceedfc0b028576d65f358d28592540ab66b9",
      "parentSha": "13c46e0fdf660cc0439a4f9610baa2f0aba3a7a0",
      "spec": "Implement advanced analytics for workspaces by adding four endpoints, a CSV export task, and utilities for chart building and date filtering.\n\n1) Routes: Update apiserver/plane/app/urls/analytic.py to define the following new HTTP endpoints under workspaces/<slug>:\n- GET /advance-analytics/ -> name: \"advance-analytics\"\n- GET /advance-analytics-stats/ -> name: \"advance-analytics-stats\"\n- GET /advance-analytics-charts/ -> name: \"advance-analytics-chart\"\n- POST /advance-analytics-export/ -> name: \"advance-analytics-export\"\nThese are in addition to existing analytics routes. Ensure imports reference the new view classes.\n\n2) Views export: Update apiserver/plane/app/views/__init__.py to export the new view classes so they can be imported from plane.app.views:\n- AdvanceAnalyticsEndpoint\n- AdvanceAnalyticsStatsEndpoint\n- AdvanceAnalyticsChartEndpoint\n- AdvanceAnalyticsExportEndpoint\n\n3) Implement new view module apiserver/plane/app/views/analytic/advance.py providing four endpoints. All endpoints must:\n- Subclass BaseAPIView.\n- Use @allow_permission([ROLE.ADMIN, ROLE.MEMBER], level=\"WORKSPACE\").\n- Accept workspace slug in the path. Enforce user membership filters as in existing analytics.\n- Respect optional query params: date_filter (supported: \"yesterday\", \"last_7_days\", \"last_30_days\", \"last_3_months\"; if unsupported or omitted, charts that depend on a date range must respond with 400 or handle defaults), and project_ids (comma-separated strings), which narrow scope to specific projects the user is an active member of.\n\n3a) Shared base for filters:\n- Provide a base view (e.g., AdvanceAnalyticsBaseView) with a method initialize_workspace(slug, type) that resolves and stores filters by calling a new utility function (see #5) get_analytics_filters(...) using:\n  - slug (workspace slug),\n  - user (request.user),\n  - type (either \"analytics\" for KPI/overview or \"chart\" for charts/time series),\n  - date_filter (from request as-is),\n  - project_ids (optional, from request as-is).\n- The returned filters must include:\n  - base_filters: used for Issue/Cycle/Module/IssueView/ProjectPage queries, containing workspace slug and project membership for the user.\n  - project_filters: used for Project queries.\n  - analytics_date_range: date dict for created_at when type=\"analytics\" (with current and optional previous ranges).\n  - chart_period_range: date range for chart visualization when type=\"chart\".\n\n3b) AdvanceAnalyticsEndpoint (GET /advance-analytics/):\n- Query param tab values:\n  - tab=overview: return counts for the current period and (if available) the previous comparison period, shaped as:\n    {\n      total_users: {count, filter_count},\n      total_admins: {count, filter_count},\n      total_members: {count, filter_count},\n      total_guests: {count, filter_count},\n      total_projects: {count, filter_count},\n      total_work_items: {count, filter_count},\n      total_cycles: {count, filter_count},\n      total_intake: {count, filter_count}\n    }\n    - total_* queries:\n      - Users/Members/Admins/Guests: WorkspaceMember filtered by workspace slug, is_active true, and role matching; apply created_at range if analytics_date_range is present.\n      - Projects: Project filtered by project_filters; apply created_at range if analytics_date_range present.\n      - Work items: Issue.issue_objects filtered by base_filters and created_at range if present.\n      - Cycles: Cycle filtered by base_filters and created_at range if present.\n      - Intake: Issue filtered by base_filters and issue_intake__isnull=False; apply created_at range if present.\n  - tab=work-items: return grouped counts for work items by state groups with same {count, filter_count} shape for:\n    total_work_items, started_work_items, backlog_work_items, un_started_work_items, completed_work_items.\n- Any other tab -> 400 with JSON {\"message\": \"Invalid tab\"}.\n\n3c) AdvanceAnalyticsStatsEndpoint (GET /advance-analytics-stats/):\n- Query param type=work-items (default) returns project-level grouped stats for work items within chart_period_range if provided:\n  A list of objects [{project_id, project__name, cancelled_work_items, completed_work_items, backlog_work_items, un_started_work_items, started_work_items}], ordered by project_id. Use Issue.issue_objects filtered by base_filters, annotate per state__group counts with Count and Q filters, and limit to created_at__date within (start_date, end_date) when chart_period_range is present.\n- Any other type -> 400 with JSON {\"message\": \"Invalid type\"}.\n\n3d) AdvanceAnalyticsChartEndpoint (GET /advance-analytics-charts/):\n- Query params:\n  - type: one of [\"projects\", \"custom-work-items\", \"work-items\"].\n  - x_axis: when type=\"custom-work-items\", default to \"PRIORITY\".\n  - group_by: optional grouping dimension when type=\"custom-work-items\".\n- Behavior:\n  - type=projects: return a list of summary KPI objects for the chart period (if provided) using base_filters and created_at__date window: [{key, name, count}] across [work_items, cycles, modules, intake, members, pages, views]. Keys represent categories; names title-cased; count is zero when none.\n  - type=custom-work-items: compute a distribution on Issue.issue_objects filtered by base_filters and optional chart_period_range using a utility build_analytics_chart(queryset, x_axis, group_by) returning {data: [...], schema: {...}}. Accept x_axis and group_by from a fixed set and reject invalid values with 400.\n  - type=work-items: return a day-by-day time series for the chart_period_range, with each day present and zero-filled, shaped as {data: [{key (YYYY-MM-DD), name (YYYY-MM-DD), count, completed_issues, created_issues}, ...], schema: {completed_issues: \"completed_issues\", created_issues: \"created_issues\"}}. Requires chart_period_range to be present; respond 400 if no date_filter is supplied.\n- Any other type -> 400 with JSON {\"message\": \"Invalid type\"}.\n\n3e) AdvanceAnalyticsExportEndpoint (POST /advance-analytics-export/):\n- Accept date_filter and project_ids similar to charts.\n- Compute the same per-project work item stats as in AdvanceAnalyticsStatsEndpoint (type=work-items) for the chart_period_range and trigger a background CSV export email task.\n- Generate headers and keys arrays mapping fields to CSV columns in the order: [\"Projects\", \"Completed Issues\", \"Backlog Issues\", \"Unstarted Issues\", \"Started Issues\"] mapped to [\"project__name\", \"completed_work_items\", \"backlog_work_items\", \"un_started_work_items\", \"started_work_items\"].\n- Enqueue Celery task with the serialized list of dict rows, headers, keys, recipient email (request.user.email), and slug.\n- Respond 200 with a message indicating the email address where results will be sent.\n\n4) CSV export task: Extend apiserver/plane/bgtasks/analytic_plot_export.py with a shared Celery task export_analytics_to_csv_email(data, headers, keys, email, slug) that:\n- Constructs row arrays: first row is headers; subsequent rows derive values by keys from each item in data (missing values as empty string).\n- Uses the existing generate_csv_from_rows(rows) to create a CSV buffer string.\n- Calls existing send_export_email(email, slug, csv_buffer, rows) to send the attachment named \"<slug>-analytics.csv\".\n- Logs exceptions via log_exception and returns gracefully on failure.\n\n5) Utility modules:\n- Create apiserver/plane/utils/build_chart.py exporting build_analytics_chart(queryset, x_axis, group_by=None, date_filter=None) that:\n  - Validates x_axis and group_by against a fixed mapper, otherwise raises DRF ValidationError.\n  - Supports the following x-axis keys: STATES, STATE_GROUPS, LABELS, ASSIGNEES, ESTIMATE_POINTS, CYCLES, MODULES, PRIORITY, START_DATE, TARGET_DATE, CREATED_AT, COMPLETED_AT, CREATED_BY.\n  - Applies additional join filters for labels, assignees, cycles, and modules to ignore deleted relations where needed.\n  - Aggregates distinct Issue IDs and returns:\n    - Without group_by: a list of {key, name, count} sorted by key.\n    - With group_by: returns {data, schema} where data is a list of grouped objects summing counts per group_key alongside a total count per row, and schema maps group_key to group display names. Ensure stable ordering by count desc for grouped entries.\n\n- Create apiserver/plane/utils/date_utils.py implementing:\n  - get_analytics_date_range(date_filter, start_date=None, end_date=None): for analytics tab comparisons, returning {current: {gte, lte}, previous: {gte, lte} (when applicable)} for the supported date_filter keys; support \"custom\" only when both start_date and end_date are valid; return None on invalid or missing.\n  - get_chart_period_range(date_filter): returns (start_date, end_date) dates for the same supported date_filter keys, or None if absent/invalid.\n  - get_analytics_filters(slug, user, type, date_filter=None, project_ids=None): returns a dict with base_filters (workspace slug, project membership by user, active), project_filters (similarly scoped), analytics_date_range when type=\"analytics\", and chart_period_range when type=\"chart\". Accept project_ids as CSV string or list, applying to both base_filters and project_filters.\n\n6) Validation and error handling:\n- Any invalid tab/type/x_axis/group_by must yield 400 with a clear JSON error message. Build-time ValidationErrors should be surfaced as 400 by BaseAPIView.\n- Time series chart requires a valid chart_period_range; respond 400 if missing.\n\n7) Data access and constraints:\n- All Issue/Cycle/Module/IssueView/ProjectPage queries must use base_filters to enforce workspace slug and membership against request.user with is_active constraints consistent with existing analytics endpoints.\n- Use Issue.issue_objects where existing analytics use it for permission-aware access.\n\n8) Performance expectations:\n- Apply date filters efficiently using created_at__date bounded by chart_period_range for chart endpoints.\n- Prefer values(...).annotate(Count(..., filter=Q(...))) style grouping and avoid N+1 queries; prefetch/ select_related where helpful for chart computations.\n\n9) Responses:\n- Overview and work item stats endpoints return simple JSON objects as specified.\n- Stats endpoint returns a list of per-project objects.\n- Charts endpoint returns either a list of KPI objects or {data, schema} for distributions and time series.\n- Export endpoint returns a JSON message, not file content.\n",
      "prompt": "Add a new set of advanced analytics APIs under the workspace scope that expose overview KPIs, work item stats, project-level grouped stats, configurable charts, and a CSV export. Reuse the existing BaseAPIView, permission utilities, Issue manager, and background export infrastructure. Define new GET endpoints for overview/stats/charts and a POST endpoint to trigger an export email. Support date filtering via a small set of named ranges and optional project filters. For charts, allow selecting a primary x-axis and optional group-by from a predefined set of dimensions and return both data and a schema map for legend labels. Include a time series chart of created vs completed work items per day over the selected period with zero-filled missing days. Implement a small utility to standardize chart aggregation for both simple and grouped responses, and another utility to generate consistent date filters and base filter objects. Connect the new view classes to URL routes and export them via the module’s __init__.py. The export endpoint should enqueue a background task that prepares a CSV with headers and sends it to the requester’s email address.",
      "supplementalFiles": [
        "apiserver/plane/app/views/analytic/base.py",
        "apiserver/plane/app/views/base.py",
        "apiserver/plane/app/views/workspace/base.py",
        "apiserver/plane/utils/analytics_plot.py",
        "apiserver/plane/utils/issue_filters.py"
      ],
      "fileDiffs": [
        {
          "path": "apiserver/plane/app/urls/analytic.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/urls/analytic.py\n===================================================================\n--- apiserver/plane/app/urls/analytic.py\t13c46e0 (parent)\n+++ apiserver/plane/app/urls/analytic.py\tb435cee (commit)\n@@ -5,10 +5,14 @@\n     AnalyticsEndpoint,\n     AnalyticViewViewset,\n     SavedAnalyticEndpoint,\n     ExportAnalyticsEndpoint,\n+    AdvanceAnalyticsEndpoint,\n+    AdvanceAnalyticsStatsEndpoint,\n+    AdvanceAnalyticsChartEndpoint,\n     DefaultAnalyticsEndpoint,\n     ProjectStatsEndpoint,\n+    AdvanceAnalyticsExportEndpoint,\n )\n \n \n urlpatterns = [\n@@ -48,5 +52,25 @@\n         \"workspaces/<str:slug>/project-stats/\",\n         ProjectStatsEndpoint.as_view(),\n         name=\"project-analytics\",\n     ),\n+    path(\n+        \"workspaces/<str:slug>/advance-analytics/\",\n+        AdvanceAnalyticsEndpoint.as_view(),\n+        name=\"advance-analytics\",\n+    ),\n+    path(\n+        \"workspaces/<str:slug>/advance-analytics-stats/\",\n+        AdvanceAnalyticsStatsEndpoint.as_view(),\n+        name=\"advance-analytics-stats\",\n+    ),\n+    path(\n+        \"workspaces/<str:slug>/advance-analytics-charts/\",\n+        AdvanceAnalyticsChartEndpoint.as_view(),\n+        name=\"advance-analytics-chart\",\n+    ),\n+    path(\n+        \"workspaces/<str:slug>/advance-analytics-export/\",\n+        AdvanceAnalyticsExportEndpoint.as_view(),\n+        name=\"advance-analytics-export\",\n+    ),\n ]\n"
        },
        {
          "path": "apiserver/plane/app/views/__init__.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/views/__init__.py\n===================================================================\n--- apiserver/plane/app/views/__init__.py\t13c46e0 (parent)\n+++ apiserver/plane/app/views/__init__.py\tb435cee (commit)\n@@ -198,8 +198,15 @@\n     DefaultAnalyticsEndpoint,\n     ProjectStatsEndpoint,\n )\n \n+from .analytic.advance import (\n+    AdvanceAnalyticsEndpoint,\n+    AdvanceAnalyticsStatsEndpoint,\n+    AdvanceAnalyticsChartEndpoint,\n+    AdvanceAnalyticsExportEndpoint,\n+)\n+\n from .notification.base import (\n     NotificationViewSet,\n     UnreadNotificationEndpoint,\n     UserNotificationPreferenceEndpoint,\n"
        },
        {
          "path": "apiserver/plane/app/views/analytic/advance.py",
          "status": "added",
          "diff": "Index: apiserver/plane/app/views/analytic/advance.py\n===================================================================\n--- apiserver/plane/app/views/analytic/advance.py\t13c46e0 (parent)\n+++ apiserver/plane/app/views/analytic/advance.py\tb435cee (commit)\n@@ -0,0 +1,397 @@\n+from rest_framework.response import Response\n+from rest_framework import status\n+from typing import Dict, List, Any\n+from datetime import timedelta\n+from django.db.models import QuerySet, Q, Count\n+from django.http import HttpRequest\n+\n+from plane.app.views.base import BaseAPIView\n+from plane.app.permissions import ROLE, allow_permission\n+from plane.db.models import (\n+    WorkspaceMember,\n+    Project,\n+    Issue,\n+    Cycle,\n+    Module,\n+    IssueView,\n+    ProjectPage,\n+)\n+\n+from plane.utils.build_chart import build_analytics_chart\n+from plane.bgtasks.analytic_plot_export import export_analytics_to_csv_email\n+from plane.utils.date_utils import get_analytics_filters\n+\n+\n+class AdvanceAnalyticsBaseView(BaseAPIView):\n+    def initialize_workspace(self, slug: str, type: str) -> None:\n+        self._workspace_slug = slug\n+        self.filters = get_analytics_filters(\n+            slug=slug,\n+            type=type,\n+            user=self.request.user,\n+            date_filter=self.request.GET.get(\"date_filter\", None),\n+            project_ids=self.request.GET.get(\"project_ids\", None),\n+        )\n+\n+\n+class AdvanceAnalyticsEndpoint(AdvanceAnalyticsBaseView):\n+    def get_filtered_counts(self, queryset: QuerySet) -> Dict[str, int]:\n+        def get_filtered_count() -> int:\n+            if self.filters[\"analytics_date_range\"]:\n+                return queryset.filter(\n+                    created_at__gte=self.filters[\"analytics_date_range\"][\"current\"][\n+                        \"gte\"\n+                    ],\n+                    created_at__lte=self.filters[\"analytics_date_range\"][\"current\"][\n+                        \"lte\"\n+                    ],\n+                ).count()\n+            return queryset.count()\n+\n+        def get_previous_count() -> int:\n+            if self.filters[\"analytics_date_range\"] and self.filters[\n+                \"analytics_date_range\"\n+            ].get(\"previous\"):\n+                return queryset.filter(\n+                    created_at__gte=self.filters[\"analytics_date_range\"][\"previous\"][\n+                        \"gte\"\n+                    ],\n+                    created_at__lte=self.filters[\"analytics_date_range\"][\"previous\"][\n+                        \"lte\"\n+                    ],\n+                ).count()\n+            return 0\n+\n+        return {\n+            \"count\": get_filtered_count(),\n+            \"filter_count\": get_previous_count(),\n+        }\n+\n+    def get_overview_data(self) -> Dict[str, Dict[str, int]]:\n+        return {\n+            \"total_users\": self.get_filtered_counts(\n+                WorkspaceMember.objects.filter(\n+                    workspace__slug=self._workspace_slug, is_active=True\n+                )\n+            ),\n+            \"total_admins\": self.get_filtered_counts(\n+                WorkspaceMember.objects.filter(\n+                    workspace__slug=self._workspace_slug,\n+                    role=ROLE.ADMIN.value,\n+                    is_active=True,\n+                )\n+            ),\n+            \"total_members\": self.get_filtered_counts(\n+                WorkspaceMember.objects.filter(\n+                    workspace__slug=self._workspace_slug,\n+                    role=ROLE.MEMBER.value,\n+                    is_active=True,\n+                )\n+            ),\n+            \"total_guests\": self.get_filtered_counts(\n+                WorkspaceMember.objects.filter(\n+                    workspace__slug=self._workspace_slug,\n+                    role=ROLE.GUEST.value,\n+                    is_active=True,\n+                )\n+            ),\n+            \"total_projects\": self.get_filtered_counts(\n+                Project.objects.filter(**self.filters[\"project_filters\"])\n+            ),\n+            \"total_work_items\": self.get_filtered_counts(\n+                Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n+            ),\n+            \"total_cycles\": self.get_filtered_counts(\n+                Cycle.objects.filter(**self.filters[\"base_filters\"])\n+            ),\n+            \"total_intake\": self.get_filtered_counts(\n+                Issue.objects.filter(**self.filters[\"base_filters\"]).filter(\n+                    issue_intake__isnull=False\n+                )\n+            ),\n+        }\n+\n+    def get_work_items_stats(self) -> Dict[str, Dict[str, int]]:\n+        base_queryset = Issue.objects.filter(**self.filters[\"base_filters\"])\n+\n+        return {\n+            \"total_work_items\": self.get_filtered_counts(base_queryset),\n+            \"started_work_items\": self.get_filtered_counts(\n+                base_queryset.filter(state__group=\"started\")\n+            ),\n+            \"backlog_work_items\": self.get_filtered_counts(\n+                base_queryset.filter(state__group=\"backlog\")\n+            ),\n+            \"un_started_work_items\": self.get_filtered_counts(\n+                base_queryset.filter(state__group=\"unstarted\")\n+            ),\n+            \"completed_work_items\": self.get_filtered_counts(\n+                base_queryset.filter(state__group=\"completed\")\n+            ),\n+        }\n+\n+    @allow_permission([ROLE.ADMIN, ROLE.MEMBER], level=\"WORKSPACE\")\n+    def get(self, request: HttpRequest, slug: str) -> Response:\n+        self.initialize_workspace(slug, type=\"analytics\")\n+        tab = request.GET.get(\"tab\", \"overview\")\n+\n+        if tab == \"overview\":\n+            return Response(\n+                self.get_overview_data(),\n+                status=status.HTTP_200_OK,\n+            )\n+\n+        elif tab == \"work-items\":\n+            return Response(\n+                self.get_work_items_stats(),\n+                status=status.HTTP_200_OK,\n+            )\n+\n+        return Response({\"message\": \"Invalid tab\"}, status=status.HTTP_400_BAD_REQUEST)\n+\n+\n+class AdvanceAnalyticsStatsEndpoint(AdvanceAnalyticsBaseView):\n+    def get_project_issues_stats(self) -> QuerySet:\n+        # Get the base queryset with workspace and project filters\n+        base_queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n+\n+        # Apply date range filter if available\n+        if self.filters[\"chart_period_range\"]:\n+            start_date, end_date = self.filters[\"chart_period_range\"]\n+            base_queryset = base_queryset.filter(\n+                created_at__date__gte=start_date, created_at__date__lte=end_date\n+            )\n+\n+        return (\n+            base_queryset.values(\"project_id\", \"project__name\")\n+            .annotate(\n+                cancelled_work_items=Count(\"id\", filter=Q(state__group=\"cancelled\")),\n+                completed_work_items=Count(\"id\", filter=Q(state__group=\"completed\")),\n+                backlog_work_items=Count(\"id\", filter=Q(state__group=\"backlog\")),\n+                un_started_work_items=Count(\"id\", filter=Q(state__group=\"unstarted\")),\n+                started_work_items=Count(\"id\", filter=Q(state__group=\"started\")),\n+            )\n+            .order_by(\"project_id\")\n+        )\n+\n+    @allow_permission([ROLE.ADMIN, ROLE.MEMBER], level=\"WORKSPACE\")\n+    def get(self, request: HttpRequest, slug: str) -> Response:\n+        self.initialize_workspace(slug, type=\"chart\")\n+        type = request.GET.get(\"type\", \"work-items\")\n+\n+        if type == \"work-items\":\n+            return Response(\n+                self.get_project_issues_stats(),\n+                status=status.HTTP_200_OK,\n+            )\n+\n+        return Response({\"message\": \"Invalid type\"}, status=status.HTTP_400_BAD_REQUEST)\n+\n+\n+class AdvanceAnalyticsChartEndpoint(AdvanceAnalyticsBaseView):\n+    def project_chart(self) -> List[Dict[str, Any]]:\n+        # Get the base queryset with workspace and project filters\n+        base_queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n+        date_filter = {}\n+        # Apply date range filter if available\n+        if self.filters[\"chart_period_range\"]:\n+            start_date, end_date = self.filters[\"chart_period_range\"]\n+            date_filter = {\n+                \"created_at__date__gte\": start_date,\n+                \"created_at__date__lte\": end_date,\n+            }\n+\n+        total_work_items = base_queryset.filter(**date_filter).count()\n+        total_cycles = Cycle.objects.filter(\n+            **self.filters[\"base_filters\"], **date_filter\n+        ).count()\n+        total_modules = Module.objects.filter(\n+            **self.filters[\"base_filters\"], **date_filter\n+        ).count()\n+        total_intake = Issue.objects.filter(\n+            issue_intake__isnull=False, **self.filters[\"base_filters\"], **date_filter\n+        ).count()\n+        total_members = WorkspaceMember.objects.filter(\n+            workspace__slug=self._workspace_slug, is_active=True, **date_filter\n+        ).count()\n+        total_pages = ProjectPage.objects.filter(\n+            **self.filters[\"base_filters\"], **date_filter\n+        ).count()\n+        total_views = IssueView.objects.filter(\n+            **self.filters[\"base_filters\"], **date_filter\n+        ).count()\n+\n+        data = {\n+            \"work_items\": total_work_items,\n+            \"cycles\": total_cycles,\n+            \"modules\": total_modules,\n+            \"intake\": total_intake,\n+            \"members\": total_members,\n+            \"pages\": total_pages,\n+            \"views\": total_views,\n+        }\n+\n+        return [\n+            {\n+                \"key\": key,\n+                \"name\": key.replace(\"_\", \" \").title(),\n+                \"count\": value or 0,\n+            }\n+            for key, value in data.items()\n+        ]\n+\n+    def work_item_completion_chart(self) -> Dict[str, Any]:\n+        # Get the base queryset\n+        queryset = (\n+            Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n+            .select_related(\"workspace\", \"state\", \"parent\")\n+            .prefetch_related(\n+                \"assignees\", \"labels\", \"issue_module__module\", \"issue_cycle__cycle\"\n+            )\n+        )\n+        # Apply date range filter if available\n+        if self.filters[\"chart_period_range\"]:\n+            start_date, end_date = self.filters[\"chart_period_range\"]\n+            queryset = queryset.filter(\n+                created_at__date__gte=start_date, created_at__date__lte=end_date\n+            )\n+\n+        # Get daily stats with optimized query\n+        daily_stats = (\n+            queryset.values(\"created_at__date\")\n+            .annotate(\n+                created_count=Count(\"id\"),\n+                completed_count=Count(\"id\", filter=Q(completed_at__isnull=False)),\n+            )\n+            .order_by(\"created_at__date\")\n+        )\n+\n+        # Create a dictionary of existing stats with summed counts\n+        stats_dict = {\n+            stat[\"created_at__date\"].strftime(\"%Y-%m-%d\"): {\n+                \"created_count\": stat[\"created_count\"],\n+                \"completed_count\": stat[\"completed_count\"],\n+            }\n+            for stat in daily_stats\n+        }\n+\n+        # Generate data for all days in the range\n+        data = []\n+        current_date = start_date\n+        while current_date <= end_date:\n+            date_str = current_date.strftime(\"%Y-%m-%d\")\n+            stats = stats_dict.get(date_str, {\"created_count\": 0, \"completed_count\": 0})\n+            data.append(\n+                {\n+                    \"key\": date_str,\n+                    \"name\": date_str,\n+                    \"count\": stats[\"created_count\"] + stats[\"completed_count\"],\n+                    \"completed_issues\": stats[\"completed_count\"],\n+                    \"created_issues\": stats[\"created_count\"],\n+                }\n+            )\n+            current_date += timedelta(days=1)\n+\n+        schema = {\n+            \"completed_issues\": \"completed_issues\",\n+            \"created_issues\": \"created_issues\",\n+        }\n+\n+        return {\"data\": data, \"schema\": schema}\n+\n+    @allow_permission([ROLE.ADMIN, ROLE.MEMBER], level=\"WORKSPACE\")\n+    def get(self, request: HttpRequest, slug: str) -> Response:\n+        self.initialize_workspace(slug, type=\"chart\")\n+        type = request.GET.get(\"type\", \"projects\")\n+        group_by = request.GET.get(\"group_by\", None)\n+        x_axis = request.GET.get(\"x_axis\", \"PRIORITY\")\n+\n+        if type == \"projects\":\n+            return Response(self.project_chart(), status=status.HTTP_200_OK)\n+\n+        elif type == \"custom-work-items\":\n+            # Get the base queryset\n+            queryset = (\n+                Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n+                .select_related(\"workspace\", \"state\", \"parent\")\n+                .prefetch_related(\n+                    \"assignees\", \"labels\", \"issue_module__module\", \"issue_cycle__cycle\"\n+                )\n+            )\n+\n+            # Apply date range filter if available\n+            if self.filters[\"chart_period_range\"]:\n+                start_date, end_date = self.filters[\"chart_period_range\"]\n+                queryset = queryset.filter(\n+                    created_at__date__gte=start_date, created_at__date__lte=end_date\n+                )\n+\n+            return Response(\n+                build_analytics_chart(queryset, x_axis, group_by),\n+                status=status.HTTP_200_OK,\n+            )\n+\n+        elif type == \"work-items\":\n+            return Response(\n+                self.work_item_completion_chart(),\n+                status=status.HTTP_200_OK,\n+            )\n+\n+        return Response({\"message\": \"Invalid type\"}, status=status.HTTP_400_BAD_REQUEST)\n+\n+\n+class AdvanceAnalyticsExportEndpoint(AdvanceAnalyticsBaseView):\n+    @allow_permission([ROLE.ADMIN, ROLE.MEMBER], level=\"WORKSPACE\")\n+    def post(self, request: HttpRequest, slug: str) -> Response:\n+        self.initialize_workspace(slug, type=\"chart\")\n+        queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n+\n+        # Apply date range filter if available\n+        if self.filters[\"chart_period_range\"]:\n+            start_date, end_date = self.filters[\"chart_period_range\"]\n+            queryset = queryset.filter(\n+                created_at__date__gte=start_date, created_at__date__lte=end_date\n+            )\n+\n+        queryset = (\n+            queryset.values(\"project_id\", \"project__name\")\n+            .annotate(\n+                cancelled_work_items=Count(\"id\", filter=Q(state__group=\"cancelled\")),\n+                completed_work_items=Count(\"id\", filter=Q(state__group=\"completed\")),\n+                backlog_work_items=Count(\"id\", filter=Q(state__group=\"backlog\")),\n+                un_started_work_items=Count(\"id\", filter=Q(state__group=\"unstarted\")),\n+                started_work_items=Count(\"id\", filter=Q(state__group=\"started\")),\n+            )\n+            .order_by(\"project_id\")\n+        )\n+\n+        # Convert QuerySet to list of dictionaries for serialization\n+        serialized_data = list(queryset)\n+\n+        headers = [\n+            \"Projects\",\n+            \"Completed Issues\",\n+            \"Backlog Issues\",\n+            \"Unstarted Issues\",\n+            \"Started Issues\",\n+        ]\n+\n+        keys = [\n+            \"project__name\",\n+            \"completed_work_items\",\n+            \"backlog_work_items\",\n+            \"un_started_work_items\",\n+            \"started_work_items\",\n+        ]\n+\n+        email = request.user.email\n+\n+        # Send serialized data to background task\n+        export_analytics_to_csv_email.delay(serialized_data, headers, keys, email, slug)\n+\n+        return Response(\n+            {\n+                \"message\": f\"Once the export is ready it will be emailed to you at {str(email)}\"\n+            },\n+            status=status.HTTP_200_OK,\n+        )\n"
        },
        {
          "path": "apiserver/plane/bgtasks/analytic_plot_export.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/bgtasks/analytic_plot_export.py\n===================================================================\n--- apiserver/plane/bgtasks/analytic_plot_export.py\t13c46e0 (parent)\n+++ apiserver/plane/bgtasks/analytic_plot_export.py\tb435cee (commit)\n@@ -463,4 +463,33 @@\n         return\n     except Exception as e:\n         log_exception(e)\n         return\n+\n+\n+@shared_task\n+def export_analytics_to_csv_email(data, headers, keys, email, slug):\n+    try:\n+        \"\"\"\n+        Prepares a CSV from data and sends it as an email attachment.\n+\n+        Parameters:\n+        - data: List of dictionaries (e.g. from .values())\n+        - headers: List of CSV column headers\n+        - keys: Keys to extract from each data item (dict)\n+        - email: Email address to send to\n+        - slug: Used for the filename\n+        \"\"\"\n+        # Prepare rows: header + data rows\n+        rows = [headers]\n+        for item in data:\n+            row = [item.get(key, \"\") for key in keys]\n+            rows.append(row)\n+\n+        # Generate CSV buffer\n+        csv_buffer = generate_csv_from_rows(rows)\n+\n+        # Send email with CSV attachment\n+        send_export_email(email=email, slug=slug, csv_buffer=csv_buffer, rows=rows)\n+    except Exception as e:\n+        log_exception(e)\n+        return\n"
        },
        {
          "path": "apiserver/plane/utils/build_chart.py",
          "status": "added",
          "diff": "Index: apiserver/plane/utils/build_chart.py\n===================================================================\n--- apiserver/plane/utils/build_chart.py\t13c46e0 (parent)\n+++ apiserver/plane/utils/build_chart.py\tb435cee (commit)\n@@ -0,0 +1,205 @@\n+from typing import Dict, Any, Tuple, Optional, List, Union\n+\n+\n+# Django imports\n+from django.db.models import (\n+    Count,\n+    F,\n+    QuerySet,\n+    Aggregate,\n+)\n+\n+from plane.db.models import Issue\n+from rest_framework.exceptions import ValidationError\n+\n+\n+x_axis_mapper = {\n+    \"STATES\": \"STATES\",\n+    \"STATE_GROUPS\": \"STATE_GROUPS\",\n+    \"LABELS\": \"LABELS\",\n+    \"ASSIGNEES\": \"ASSIGNEES\",\n+    \"ESTIMATE_POINTS\": \"ESTIMATE_POINTS\",\n+    \"CYCLES\": \"CYCLES\",\n+    \"MODULES\": \"MODULES\",\n+    \"PRIORITY\": \"PRIORITY\",\n+    \"START_DATE\": \"START_DATE\",\n+    \"TARGET_DATE\": \"TARGET_DATE\",\n+    \"CREATED_AT\": \"CREATED_AT\",\n+    \"COMPLETED_AT\": \"COMPLETED_AT\",\n+    \"CREATED_BY\": \"CREATED_BY\",\n+}\n+\n+\n+def get_y_axis_filter(y_axis: str) -> Dict[str, Any]:\n+    filter_mapping = {\n+        \"WORK_ITEM_COUNT\": {\"id\": F(\"id\")},\n+    }\n+    return filter_mapping.get(y_axis, {})\n+\n+\n+def get_x_axis_field() -> Dict[str, Tuple[str, str, Optional[Dict[str, Any]]]]:\n+    return {\n+        \"STATES\": (\"state__id\", \"state__name\", None),\n+        \"STATE_GROUPS\": (\"state__group\", \"state__group\", None),\n+        \"LABELS\": (\n+            \"labels__id\",\n+            \"labels__name\",\n+            {\"label_issue__deleted_at__isnull\": True},\n+        ),\n+        \"ASSIGNEES\": (\n+            \"assignees__id\",\n+            \"assignees__display_name\",\n+            {\"issue_assignee__deleted_at__isnull\": True},\n+        ),\n+        \"ESTIMATE_POINTS\": (\"estimate_point__value\", \"estimate_point__key\", None),\n+        \"CYCLES\": (\n+            \"issue_cycle__cycle_id\",\n+            \"issue_cycle__cycle__name\",\n+            {\"issue_cycle__deleted_at__isnull\": True},\n+        ),\n+        \"MODULES\": (\n+            \"issue_module__module_id\",\n+            \"issue_module__module__name\",\n+            {\"issue_module__deleted_at__isnull\": True},\n+        ),\n+        \"PRIORITY\": (\"priority\", \"priority\", None),\n+        \"START_DATE\": (\"start_date\", \"start_date\", None),\n+        \"TARGET_DATE\": (\"target_date\", \"target_date\", None),\n+        \"CREATED_AT\": (\"created_at__date\", \"created_at__date\", None),\n+        \"COMPLETED_AT\": (\"completed_at__date\", \"completed_at__date\", None),\n+        \"CREATED_BY\": (\"created_by_id\", \"created_by__display_name\", None),\n+    }\n+\n+\n+def process_grouped_data(\n+    data: List[Dict[str, Any]],\n+) -> Tuple[List[Dict[str, Any]], Dict[str, str]]:\n+    response = {}\n+    schema = {}\n+\n+    for item in data:\n+        key = item[\"key\"]\n+        if key not in response:\n+            response[key] = {\n+                \"key\": key if key else \"none\",\n+                \"name\": (\n+                    item.get(\"display_name\", key)\n+                    if item.get(\"display_name\", key)\n+                    else \"None\"\n+                ),\n+                \"count\": 0,\n+            }\n+        group_key = str(item[\"group_key\"]) if item[\"group_key\"] else \"none\"\n+        schema[group_key] = item.get(\"group_name\", item[\"group_key\"])\n+        schema[group_key] = schema[group_key] if schema[group_key] else \"None\"\n+        response[key][group_key] = response[key].get(group_key, 0) + item[\"count\"]\n+        response[key][\"count\"] += item[\"count\"]\n+\n+    return list(response.values()), schema\n+\n+\n+def build_number_chart_response(\n+    queryset: QuerySet[Issue],\n+    y_axis_filter: Dict[str, Any],\n+    y_axis: str,\n+    aggregate_func: Aggregate,\n+) -> List[Dict[str, Any]]:\n+    count = (\n+        queryset.filter(**y_axis_filter).aggregate(total=aggregate_func).get(\"total\", 0)\n+    )\n+    return [{\"key\": y_axis, \"name\": y_axis, \"count\": count}]\n+\n+\n+def build_grouped_chart_response(\n+    queryset: QuerySet[Issue],\n+    id_field: str,\n+    name_field: str,\n+    group_field: str,\n+    group_name_field: str,\n+    aggregate_func: Aggregate,\n+) -> Tuple[List[Dict[str, Any]], Dict[str, str]]:\n+    data = (\n+        queryset.annotate(\n+            key=F(id_field),\n+            group_key=F(group_field),\n+            group_name=F(group_name_field),\n+            display_name=F(name_field) if name_field else F(id_field),\n+        )\n+        .values(\"key\", \"group_key\", \"group_name\", \"display_name\")\n+        .annotate(count=aggregate_func)\n+        .order_by(\"-count\")\n+    )\n+    return process_grouped_data(data)\n+\n+\n+def build_simple_chart_response(\n+    queryset: QuerySet, id_field: str, name_field: str, aggregate_func: Aggregate\n+) -> List[Dict[str, Any]]:\n+    data = (\n+        queryset.annotate(\n+            key=F(id_field), display_name=F(name_field) if name_field else F(id_field)\n+        )\n+        .values(\"key\", \"display_name\")\n+        .annotate(count=aggregate_func)\n+        .order_by(\"key\")\n+    )\n+\n+    return [\n+        {\n+            \"key\": item[\"key\"] if item[\"key\"] else \"None\",\n+            \"name\": item[\"display_name\"] if item[\"display_name\"] else \"None\",\n+            \"count\": item[\"count\"],\n+        }\n+        for item in data\n+    ]\n+\n+\n+def build_analytics_chart(\n+    queryset: QuerySet[Issue],\n+    x_axis: str,\n+    group_by: Optional[str] = None,\n+    date_filter: Optional[str] = None,\n+) -> Dict[str, Union[List[Dict[str, Any]], Dict[str, str]]]:\n+\n+    # Validate x_axis\n+    if x_axis not in x_axis_mapper:\n+        raise ValidationError(f\"Invalid x_axis field: {x_axis}\")\n+\n+    # Validate group_by\n+    if group_by and group_by not in x_axis_mapper:\n+        raise ValidationError(f\"Invalid group_by field: {group_by}\")\n+\n+    field_mapping = get_x_axis_field()\n+\n+    id_field, name_field, additional_filter = field_mapping.get(\n+        x_axis, (None, None, {})\n+    )\n+    group_field, group_name_field, group_additional_filter = field_mapping.get(\n+        group_by, (None, None, {})\n+    )\n+\n+    # Apply additional filters if they exist\n+    if additional_filter or {}:\n+        queryset = queryset.filter(**additional_filter)\n+\n+    if group_additional_filter or {}:\n+        queryset = queryset.filter(**group_additional_filter)\n+\n+    aggregate_func = Count(\"id\", distinct=True)\n+\n+    if group_field:\n+        response, schema = build_grouped_chart_response(\n+            queryset,\n+            id_field,\n+            name_field,\n+            group_field,\n+            group_name_field,\n+            aggregate_func,\n+        )\n+    else:\n+        response = build_simple_chart_response(\n+            queryset, id_field, name_field, aggregate_func\n+        )\n+        schema = {}\n+\n+    return {\"data\": response, \"schema\": schema}\n"
        },
        {
          "path": "apiserver/plane/utils/date_utils.py",
          "status": "added",
          "diff": "Index: apiserver/plane/utils/date_utils.py\n===================================================================\n--- apiserver/plane/utils/date_utils.py\t13c46e0 (parent)\n+++ apiserver/plane/utils/date_utils.py\tb435cee (commit)\n@@ -0,0 +1,197 @@\n+from datetime import datetime, timedelta, date\n+from django.utils import timezone\n+from typing import Dict, Optional, List, Union, Tuple, Any\n+\n+from plane.db.models import User\n+\n+\n+def get_analytics_date_range(\n+    date_filter: Optional[str] = None,\n+    start_date: Optional[str] = None,\n+    end_date: Optional[str] = None,\n+) -> Optional[Dict[str, Dict[str, datetime]]]:\n+    \"\"\"\n+    Get date range for analytics with current and previous periods for comparison.\n+    Returns a dictionary with current and previous date ranges.\n+\n+    Args:\n+        date_filter (str): The type of date filter to apply\n+        start_date (str): Start date for custom range (format: YYYY-MM-DD)\n+        end_date (str): End date for custom range (format: YYYY-MM-DD)\n+\n+    Returns:\n+        dict: Dictionary containing current and previous date ranges\n+    \"\"\"\n+    if not date_filter:\n+        return None\n+\n+    today = timezone.now().date()\n+\n+    if date_filter == \"yesterday\":\n+        yesterday = today - timedelta(days=1)\n+        return {\n+            \"current\": {\n+                \"gte\": datetime.combine(yesterday, datetime.min.time()),\n+                \"lte\": datetime.combine(yesterday, datetime.max.time()),\n+            }\n+        }\n+    elif date_filter == \"last_7_days\":\n+        return {\n+            \"current\": {\n+                \"gte\": datetime.combine(today - timedelta(days=7), datetime.min.time()),\n+                \"lte\": datetime.combine(today, datetime.max.time()),\n+            },\n+            \"previous\": {\n+                \"gte\": datetime.combine(\n+                    today - timedelta(days=14), datetime.min.time()\n+                ),\n+                \"lte\": datetime.combine(today - timedelta(days=8), datetime.max.time()),\n+            },\n+        }\n+    elif date_filter == \"last_30_days\":\n+        return {\n+            \"current\": {\n+                \"gte\": datetime.combine(\n+                    today - timedelta(days=30), datetime.min.time()\n+                ),\n+                \"lte\": datetime.combine(today, datetime.max.time()),\n+            },\n+            \"previous\": {\n+                \"gte\": datetime.combine(\n+                    today - timedelta(days=60), datetime.min.time()\n+                ),\n+                \"lte\": datetime.combine(\n+                    today - timedelta(days=31), datetime.max.time()\n+                ),\n+            },\n+        }\n+    elif date_filter == \"last_3_months\":\n+        return {\n+            \"current\": {\n+                \"gte\": datetime.combine(\n+                    today - timedelta(days=90), datetime.min.time()\n+                ),\n+                \"lte\": datetime.combine(today, datetime.max.time()),\n+            },\n+            \"previous\": {\n+                \"gte\": datetime.combine(\n+                    today - timedelta(days=180), datetime.min.time()\n+                ),\n+                \"lte\": datetime.combine(\n+                    today - timedelta(days=91), datetime.max.time()\n+                ),\n+            },\n+        }\n+    elif date_filter == \"custom\" and start_date and end_date:\n+        try:\n+            start = datetime.strptime(start_date, \"%Y-%m-%d\").date()\n+            end = datetime.strptime(end_date, \"%Y-%m-%d\").date()\n+            return {\n+                \"current\": {\n+                    \"gte\": datetime.combine(start, datetime.min.time()),\n+                    \"lte\": datetime.combine(end, datetime.max.time()),\n+                }\n+            }\n+        except (ValueError, TypeError):\n+            return None\n+    return None\n+\n+\n+def get_chart_period_range(\n+    date_filter: Optional[str] = None,\n+) -> Optional[Tuple[date, date]]:\n+    \"\"\"\n+    Get date range for chart visualization.\n+    Returns a tuple of (start_date, end_date) for the specified period.\n+\n+    Args:\n+        date_filter (str): The type of date filter to apply. Options are:\n+            - \"yesterday\": Yesterday's date\n+            - \"last_7_days\": Last 7 days\n+            - \"last_30_days\": Last 30 days\n+            - \"last_3_months\": Last 90 days\n+            Defaults to \"last_7_days\" if not specified or invalid.\n+\n+    Returns:\n+        tuple: A tuple containing (start_date, end_date) as date objects\n+    \"\"\"\n+    if not date_filter:\n+        return None\n+\n+    today = timezone.now().date()\n+    period_ranges = {\n+        \"yesterday\": (\n+            today - timedelta(days=1),\n+            today - timedelta(days=1),\n+        ),\n+        \"last_7_days\": (today - timedelta(days=7), today),\n+        \"last_30_days\": (today - timedelta(days=30), today),\n+        \"last_3_months\": (today - timedelta(days=90), today),\n+    }\n+\n+    return period_ranges.get(date_filter, period_ranges[\"last_7_days\"])\n+\n+\n+def get_analytics_filters(\n+    slug: str,\n+    user: User,\n+    type: str,\n+    date_filter: Optional[str] = None,\n+    project_ids: Optional[Union[str, List[str]]] = None,\n+) -> Dict[str, Any]:\n+    \"\"\"\n+    Get combined project and date filters for analytics endpoints\n+\n+    Args:\n+        slug: The workspace slug\n+        user: The current user\n+        type: The type of filter (\"analytics\" or \"chart\")\n+        date_filter: Optional date filter string\n+        project_ids: Optional list of project IDs or comma-separated string of project IDs\n+\n+    Returns:\n+        dict: A dictionary containing:\n+            - base_filters: Base filters for the workspace and user\n+            - project_filters: Project-specific filters\n+            - analytics_date_range: Date range filters for analytics comparison\n+            - chart_period_range: Date range for chart visualization\n+    \"\"\"\n+    # Get project IDs from request\n+    if project_ids and isinstance(project_ids, str):\n+        project_ids = [str(project_id) for project_id in project_ids.split(\",\")]\n+\n+    # Base filters for workspace and user\n+    base_filters = {\n+        \"workspace__slug\": slug,\n+        \"project__project_projectmember__member\": user,\n+        \"project__project_projectmember__is_active\": True,\n+    }\n+\n+    # Project filters\n+    project_filters = {\n+        \"workspace__slug\": slug,\n+        \"project_projectmember__member\": user,\n+        \"project_projectmember__is_active\": True,\n+    }\n+\n+    # Add project IDs to filters if provided\n+    if project_ids:\n+        base_filters[\"project_id__in\"] = project_ids\n+        project_filters[\"id__in\"] = project_ids\n+\n+    # Initialize date range variables\n+    analytics_date_range = None\n+    chart_period_range = None\n+\n+    # Get date range filters based on type\n+    if type == \"analytics\":\n+        analytics_date_range = get_analytics_date_range(date_filter)\n+    elif type == \"chart\":\n+        chart_period_range = get_chart_period_range(date_filter)\n+\n+    return {\n+        \"base_filters\": base_filters,\n+        \"project_filters\": project_filters,\n+        \"analytics_date_range\": analytics_date_range,\n+        \"chart_period_range\": chart_period_range,\n+    }\n"
        }
      ]
    },
    {
      "id": "refactor-file-handling",
      "sha": "dc16f2862e749373e4ffa1604d8eb5cb11755957",
      "parentSha": "e68d3444103ccd7768129816ef12175b606c1940",
      "spec": "Implement generic file handling across the editor with the following changes:\n\n1) Constants: split accepted MIME types and drop extensions mapping\n- File: packages/editor/src/core/constants/config.ts\n  - Replace ACCEPTED_FILE_MIME_TYPES with:\n    - ACCEPTED_IMAGE_MIME_TYPES: [\"image/jpeg\", \"image/jpg\", \"image/png\", \"image/webp\", \"image/gif\"]\n    - ACCEPTED_ATTACHMENT_MIME_TYPES: include common image, document, audio, video, archive, model, font, and text mime types exactly as in the diff.\n  - Remove ACCEPTED_FILE_EXTENSIONS and any related usage.\n\n2) Validation helper: move and generalize isFileValid\n- Create/rename file to packages/editor/src/core/helpers/file.ts\n  - Export isFileValid(args) with signature: { acceptedMimeTypes: string[]; file: File; maxFileSize: number } -> boolean\n  - Remove dependency on constants inside the helper; instead, require acceptedMimeTypes passed in.\n- Update imports to this helper:\n  - packages/editor/src/core/extensions/custom-image/custom-image.ts: import isFileValid from \"@/helpers/file\".\n  - packages/editor/src/core/hooks/use-file-upload.ts: import isFileValid from \"@/helpers/file\".\n  - Remove any imports from @/plugins/image/utils or @/plugins/image/constants related to validation.\n\n3) Drop/paste handling: generic extension for files\n- Replace the old drop handler component with a TypeScript module:\n  - Delete packages/editor/src/core/extensions/drop.tsx\n  - Add packages/editor/src/core/extensions/drop.ts with Extension.create that registers a PM plugin handling both paste and drop events:\n    - Filter event.clipboardData.files or event.dataTransfer.files by ACCEPTED_IMAGE_MIME_TYPES and ACCEPTED_ATTACHMENT_MIME_TYPES.\n    - Insert files at the correct position using a new helper insertFilesSafely(args): determines type (image|attachment) based on MIME, then:\n      - For image: editor.commands.insertImageComponent({ file, pos, event })\n      - For attachment: keep a stub branch (no-op) for now, but structure should support adding attachment logic later.\n    - Ensure positions are clamped within doc size and increment pos for multiple files.\n- Ensure packages/editor/src/core/extensions/index.ts still re-exports from \"./drop\".\n\n4) Generic upload and drop zone hooks\n- File: packages/editor/src/core/hooks/use-file-upload.ts\n  - Update TUploaderArgs to:\n    - acceptedMimeTypes: string[]\n    - editorCommand: (file: File) => Promise<string>\n    - handleProgressStatus?: (isUploading: boolean) => void\n    - loadFileFromFileSystem?: (fileBase64: string) => void\n    - maxFileSize: number\n    - onUpload: (url: string, file: File) => void\n  - Update implementation:\n    - Rename uploading state to isUploading; return { isUploading, uploadFile }.\n    - Validate with isFileValid({ acceptedMimeTypes, file, maxFileSize }).\n    - If loadFileFromFileSystem is provided, read with FileReader and call it before upload.\n    - Use editorCommand(file) to perform the upload; on success, call onUpload(url, file).\n    - Call handleProgressStatus(true/false) to set upload status (e.g., editor.storage.imageComponent.uploadInProgress).\n  - Update dropzone:\n    - useDropZone args: { acceptedMimeTypes, editor, maxFileSize, pos, type: \"image\"|\"attachment\", uploader }\n    - onDrop uses uploadFirstFileAndInsertRemaining (see below).\n    - Return { isDragging, draggedInside, onDragEnter, onDragLeave, onDrop } with memoized handlers.\n  - Replace uploadFirstImageAndInsertRemaining with uploadFirstFileAndInsertRemaining(args):\n    - Filter files by isFileValid({ acceptedMimeTypes, file, maxFileSize }).\n    - Upload the first file via uploader(firstFile).\n    - Insert remaining files using insertFilesSafely({ editor, files: remainingFiles, initialPos: pos+1 clamped, event: \"drop\", type }).\n\n5) Image uploader component: adopt generic hooks and constants\n- File: packages/editor/src/core/extensions/custom-image/components/image-uploader.tsx\n  - Import ACCEPTED_IMAGE_MIME_TYPES from constants.\n  - Replace useUploader args with: acceptedMimeTypes: ACCEPTED_IMAGE_MIME_TYPES; editorCommand: async (file) => await editor?.commands.uploadImage(imageEntityId, file); handleProgressStatus: (isUploading) => { editor.storage.imageComponent.uploadInProgress = isUploading; }; loadFileFromFileSystem: loadImageFromFileSystem; maxFileSize; onUpload.\n  - Update returned state var to isImageBeingUploaded from isUploading.\n  - Replace useDropZone with acceptedMimeTypes: ACCEPTED_IMAGE_MIME_TYPES and type: \"image\".\n  - Replace uploadFirstImageAndInsertRemaining with uploadFirstFileAndInsertRemaining, passing acceptedMimeTypes and type.\n  - Update onUpload signature to (url, file) and ensure it sets node attrs via updateAttributes({ src: url }) and cursor behavior remains consistent; use node.type.name instead of hard-coded string comparison.\n  - Update input accept to ACCEPTED_IMAGE_MIME_TYPES.join(\",\").\n\n6) Custom image extension: use generic validator and pass accepted MIME types\n- File: packages/editor/src/core/extensions/custom-image/custom-image.ts\n  - Import ACCEPTED_IMAGE_MIME_TYPES from constants and isFileValid from helpers/file.\n  - In insertImageComponent command, when validating dropped file, call isFileValid({ acceptedMimeTypes: ACCEPTED_IMAGE_MIME_TYPES, file, maxFileSize }).\n  - Remove references to @/plugins/image/utils and constants.\n\n7) Core extensions composition: pass file handler into CE additional extensions\n- File: packages/editor/src/core/extensions/extensions.tsx\n  - When spreading CoreEditorAdditionalExtensions, pass fileHandler alongside disabledExtensions.\n- File: packages/editor/src/ce/extensions/core/extensions.ts\n  - Update Props to { disabledExtensions: TExtensions[]; fileHandler: TFileHandler }\n  - Import TFileHandler and thread the prop (even if not used yet) to maintain a consistent API with core.\n\n8) Drag handle plugin DOM selectors: align with new StarterKit classes\n- File: packages/editor/src/core/plugins/drag-handle.ts\n  - Update generalSelectors list to:\n    - \"li\"\n    - \"p.editor-paragraph-block:not(:first-child)\"\n    - \".code-block\"\n    - \"blockquote\"\n    - \"h1.editor-heading-block, h2.editor-heading-block, h3.editor-heading-block, h4.editor-heading-block, h5.editor-heading-block, h6.editor-heading-block\"\n    - \"[data-type=horizontalRule]\"\n    - \".table-wrapper\"\n    - \".issue-embed\"\n    - \".image-component\"\n    - \".image-upload-component\"\n    - \".editor-callout-component\"\n\n9) Image plugins cleanups\n- File: packages/editor/src/core/plugins/image/delete-image.ts\n  - When tracking deletions, set editor.storage[nodeType].deletedImageSet?.set(src, true), then try { await deleteImage(src) } catch { console.error(...) } without a separate helper function.\n- File: packages/editor/src/core/plugins/image/index.ts\n  - Stop exporting \"./utils\" and \"./constants\"; only export types, delete-image, restore-image. Remove packages/editor/src/core/plugins/image/constants.ts and packages/editor/src/core/plugins/image/utils/index.ts from the module.\n\n10) Shared utils: new attachment helpers\n- File: packages/utils/src/attachment.ts (new)\n  - Implement generateFileName(fileName), getFileExtension(filename), getFileName(fileName), convertBytesToSize(bytes) exactly as in the diff.\n- File: packages/utils/src/index.ts\n  - Export all from \"./attachment\".\n\n11) Types\n- If not already present in \"@/types\", ensure TEditorCommands includes at least the union literals \"attachment\" | \"image\", and that TFileHandler is available to pass to extensions. Ensure build and path resolution for \"@/types\" remain consistent.\n\nBehavioral acceptance:\n- Pasting/dropping images inserts imageComponent nodes at cursor or drop position; multiple files are inserted safely in order.\n- Non-image attachments are filtered/recognized but no-op insert (stub) for now without breaking.\n- Image uploads validate against ACCEPTED_IMAGE_MIME_TYPES and maxFileSize via new helper; input accept uses MIME list.\n- Image uploading updates editor.storage.imageComponent.uploadInProgress and hides placeholder during upload.\n- Drag handle continues to work with updated selectors.\n- No remaining references to ACCEPTED_FILE_EXTENSIONS or old image-only utilities.\n",
      "prompt": "Refactor the editor’s file handling to be generic and MIME-type driven. Support image and non-image attachments consistently across paste and drag-and-drop. Introduce separate accepted MIME lists for images and attachments. Centralize file validation in a new helper that accepts a list of allowed MIME types. Update the upload and drop hooks to be generic, returning a consistent upload state and taking an abstract editor command to perform the upload. Update the image uploader component to use the new hooks and constants, and ensure it sets upload state on the editor for correct placeholder behavior. Replace the old drop handler with a new implementation that filters files by accepted MIME types and safely inserts images at the correct positions; leave a stub path for future attachment insertion. Align the drag handle selectors with the classes used by the StarterKit paragraph/heading nodes. Also add shared utility functions for attachment file naming and size formatting and export them from the utils package.",
      "supplementalFiles": [
        "packages/editor/src/core/extensions/index.ts",
        "packages/editor/src/core/extensions/custom-image/read-only-custom-image.ts",
        "packages/editor/src/core/plugins/image/restore-image.ts",
        "packages/editor/src/core/extensions/code/utils/replace-code-block-with-text.ts"
      ],
      "fileDiffs": [
        {
          "path": "packages/editor/src/ce/extensions/core/extensions.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/ce/extensions/core/extensions.ts\n===================================================================\n--- packages/editor/src/ce/extensions/core/extensions.ts\te68d344 (parent)\n+++ packages/editor/src/ce/extensions/core/extensions.ts\tdc16f28 (commit)\n@@ -1,10 +1,11 @@\n import { Extensions } from \"@tiptap/core\";\n // types\n-import { TExtensions } from \"@/types\";\n+import { TExtensions, TFileHandler } from \"@/types\";\n \n type Props = {\n   disabledExtensions: TExtensions[];\n+  fileHandler: TFileHandler;\n };\n \n export const CoreEditorAdditionalExtensions = (props: Props): Extensions => {\n   const {} = props;\n"
        },
        {
          "path": "packages/editor/src/core/constants/config.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/constants/config.ts\n===================================================================\n--- packages/editor/src/core/constants/config.ts\te68d344 (parent)\n+++ packages/editor/src/core/constants/config.ts\tdc16f28 (commit)\n@@ -7,6 +7,56 @@\n   lineSpacing: \"regular\",\n   wideLayout: false,\n };\n \n-export const ACCEPTED_FILE_MIME_TYPES = [\"image/jpeg\", \"image/jpg\", \"image/png\", \"image/webp\", \"image/gif\"];\n-export const ACCEPTED_FILE_EXTENSIONS = ACCEPTED_FILE_MIME_TYPES.map((type) => `.${type.split(\"/\")[1]}`);\n+export const ACCEPTED_IMAGE_MIME_TYPES = [\"image/jpeg\", \"image/jpg\", \"image/png\", \"image/webp\", \"image/gif\"];\n+\n+export const ACCEPTED_ATTACHMENT_MIME_TYPES = [\n+  \"image/jpeg\",\n+  \"image/png\",\n+  \"image/gif\",\n+  \"image/svg+xml\",\n+  \"image/webp\",\n+  \"image/tiff\",\n+  \"image/bmp\",\n+  \"application/pdf\",\n+  \"application/msword\",\n+  \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n+  \"application/vnd.ms-excel\",\n+  \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n+  \"application/vnd.ms-powerpoint\",\n+  \"application/vnd.openxmlformats-officedocument.presentationml.presentation\",\n+  \"text/plain\",\n+  \"application/rtf\",\n+  \"audio/mpeg\",\n+  \"audio/wav\",\n+  \"audio/ogg\",\n+  \"audio/midi\",\n+  \"audio/x-midi\",\n+  \"audio/aac\",\n+  \"audio/flac\",\n+  \"audio/x-m4a\",\n+  \"video/mp4\",\n+  \"video/mpeg\",\n+  \"video/ogg\",\n+  \"video/webm\",\n+  \"video/quicktime\",\n+  \"video/x-msvideo\",\n+  \"video/x-ms-wmv\",\n+  \"application/zip\",\n+  \"application/x-rar-compressed\",\n+  \"application/x-tar\",\n+  \"application/gzip\",\n+  \"model/gltf-binary\",\n+  \"model/gltf+json\",\n+  \"application/octet-stream\",\n+  \"font/ttf\",\n+  \"font/otf\",\n+  \"font/woff\",\n+  \"font/woff2\",\n+  \"text/css\",\n+  \"text/javascript\",\n+  \"application/json\",\n+  \"text/xml\",\n+  \"text/csv\",\n+  \"application/xml\",\n+];\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/components/image-uploader.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/components/image-uploader.tsx\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/components/image-uploader.tsx\te68d344 (parent)\n+++ packages/editor/src/core/extensions/custom-image/components/image-uploader.tsx\tdc16f28 (commit)\n@@ -2,13 +2,13 @@\n import { ChangeEvent, useCallback, useEffect, useMemo, useRef } from \"react\";\n // plane utils\n import { cn } from \"@plane/utils\";\n // constants\n-import { ACCEPTED_FILE_EXTENSIONS } from \"@/constants/config\";\n+import { ACCEPTED_IMAGE_MIME_TYPES } from \"@/constants/config\";\n // extensions\n import { CustoBaseImageNodeViewProps, getImageComponentImageFileMap } from \"@/extensions/custom-image\";\n // hooks\n-import { useUploader, useDropZone, uploadFirstImageAndInsertRemaining } from \"@/hooks/use-file-upload\";\n+import { useUploader, useDropZone, uploadFirstFileAndInsertRemaining } from \"@/hooks/use-file-upload\";\n \n type CustomImageUploaderProps = CustoBaseImageNodeViewProps & {\n   maxFileSize: number;\n   loadImageFromFileSystem: (file: string) => void;\n@@ -40,9 +40,11 @@\n       if (url) {\n         if (!imageEntityId) return;\n         setIsUploaded(true);\n         // Update the node view's src attribute post upload\n-        updateAttributes({ src: url });\n+        updateAttributes({\n+          src: url,\n+        });\n         imageComponentImageFileMap?.delete(imageEntityId);\n \n         const pos = getPos();\n         // get current node\n@@ -50,9 +52,9 @@\n         const currentNode = editor.state.doc.nodeAt(getCurrentSelection.from);\n \n         // only if the cursor is at the current image component, manipulate\n         // the cursor position\n-        if (currentNode && currentNode.type.name === \"imageComponent\" && currentNode.attrs.src === url) {\n+        if (currentNode && currentNode.type.name === node.type.name && currentNode.attrs.src === url) {\n           // control cursor position after upload\n           const nextNode = editor.state.doc.nodeAt(pos + 1);\n \n           if (nextNode && nextNode.type.name === \"paragraph\") {\n@@ -67,19 +69,25 @@\n     },\n     [imageComponentImageFileMap, imageEntityId, updateAttributes, getPos]\n   );\n   // hooks\n-  const { uploading: isImageBeingUploaded, uploadFile } = useUploader({\n-    blockId: imageEntityId ?? \"\",\n-    editor,\n-    loadImageFromFileSystem,\n+  const { isUploading: isImageBeingUploaded, uploadFile } = useUploader({\n+    acceptedMimeTypes: ACCEPTED_IMAGE_MIME_TYPES,\n+    // @ts-expect-error - TODO: fix typings, and don't remove await from here for now\n+    editorCommand: async (file) => await editor?.commands.uploadImage(imageEntityId, file),\n+    handleProgressStatus: (isUploading) => {\n+      editor.storage.imageComponent.uploadInProgress = isUploading;\n+    },\n+    loadFileFromFileSystem: loadImageFromFileSystem,\n     maxFileSize,\n     onUpload,\n   });\n   const { draggedInside, onDrop, onDragEnter, onDragLeave } = useDropZone({\n+    acceptedMimeTypes: ACCEPTED_IMAGE_MIME_TYPES,\n     editor,\n     maxFileSize,\n     pos: getPos(),\n+    type: \"image\",\n     uploader: uploadFile,\n   });\n \n   // the meta data of the image component\n@@ -109,13 +117,15 @@\n       const filesList = e.target.files;\n       if (!filesList) {\n         return;\n       }\n-      await uploadFirstImageAndInsertRemaining({\n+      await uploadFirstFileAndInsertRemaining({\n+        acceptedMimeTypes: ACCEPTED_IMAGE_MIME_TYPES,\n         editor,\n         filesList,\n         maxFileSize,\n         pos: getPos(),\n+        type: \"image\",\n         uploader: uploadFile,\n       });\n     },\n     [uploadFile, editor, getPos]\n@@ -169,9 +179,9 @@\n         className=\"size-0 overflow-hidden\"\n         ref={fileInputRef}\n         hidden\n         type=\"file\"\n-        accept={ACCEPTED_FILE_EXTENSIONS.join(\",\")}\n+        accept={ACCEPTED_IMAGE_MIME_TYPES.join(\",\")}\n         onChange={onFileChange}\n         multiple\n       />\n     </div>\n"
        },
        {
          "path": "packages/editor/src/core/extensions/custom-image/custom-image.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/custom-image/custom-image.ts\n===================================================================\n--- packages/editor/src/core/extensions/custom-image/custom-image.ts\te68d344 (parent)\n+++ packages/editor/src/core/extensions/custom-image/custom-image.ts\tdc16f28 (commit)\n@@ -1,14 +1,17 @@\n import { Editor, mergeAttributes } from \"@tiptap/core\";\n import { Image } from \"@tiptap/extension-image\";\n import { ReactNodeViewRenderer } from \"@tiptap/react\";\n import { v4 as uuidv4 } from \"uuid\";\n+// constants\n+import { ACCEPTED_IMAGE_MIME_TYPES } from \"@/constants/config\";\n // extensions\n import { CustomImageNode } from \"@/extensions/custom-image\";\n // helpers\n+import { isFileValid } from \"@/helpers/file\";\n import { insertEmptyParagraphAtNodeBoundaries } from \"@/helpers/insert-empty-paragraph-at-node-boundary\";\n // plugins\n-import { TrackImageDeletionPlugin, TrackImageRestorationPlugin, isFileValid } from \"@/plugins/image\";\n+import { TrackImageDeletionPlugin, TrackImageRestorationPlugin } from \"@/plugins/image\";\n // types\n import { TFileHandler } from \"@/types\";\n \n export type InsertImageComponentProps = {\n@@ -145,8 +148,9 @@\n             // Early return if there's an invalid file being dropped\n             if (\n               props?.file &&\n               !isFileValid({\n+                acceptedMimeTypes: ACCEPTED_IMAGE_MIME_TYPES,\n                 file: props.file,\n                 maxFileSize,\n               })\n             ) {\n"
        },
        {
          "path": "packages/editor/src/core/extensions/drop.ts",
          "status": "added",
          "diff": "Index: packages/editor/src/core/extensions/drop.ts\n===================================================================\n--- packages/editor/src/core/extensions/drop.ts\te68d344 (parent)\n+++ packages/editor/src/core/extensions/drop.ts\tdc16f28 (commit)\n@@ -0,0 +1,127 @@\n+import { Extension, Editor } from \"@tiptap/core\";\n+import { Plugin, PluginKey } from \"@tiptap/pm/state\";\n+// constants\n+import { ACCEPTED_ATTACHMENT_MIME_TYPES, ACCEPTED_IMAGE_MIME_TYPES } from \"@/constants/config\";\n+// types\n+import { TEditorCommands } from \"@/types\";\n+\n+export const DropHandlerExtension = Extension.create({\n+  name: \"dropHandler\",\n+  priority: 1000,\n+\n+  addProseMirrorPlugins() {\n+    const editor = this.editor;\n+    return [\n+      new Plugin({\n+        key: new PluginKey(\"drop-handler-plugin\"),\n+        props: {\n+          handlePaste: (view, event) => {\n+            if (\n+              editor.isEditable &&\n+              event.clipboardData &&\n+              event.clipboardData.files &&\n+              event.clipboardData.files.length > 0\n+            ) {\n+              event.preventDefault();\n+              const files = Array.from(event.clipboardData.files);\n+              const acceptedFiles = files.filter(\n+                (f) => ACCEPTED_IMAGE_MIME_TYPES.includes(f.type) || ACCEPTED_ATTACHMENT_MIME_TYPES.includes(f.type)\n+              );\n+\n+              if (acceptedFiles.length) {\n+                const pos = view.state.selection.from;\n+                insertFilesSafely({\n+                  editor,\n+                  files: acceptedFiles,\n+                  initialPos: pos,\n+                  event: \"drop\",\n+                });\n+              }\n+              return true;\n+            }\n+            return false;\n+          },\n+          handleDrop: (view, event, _slice, moved) => {\n+            if (\n+              editor.isEditable &&\n+              !moved &&\n+              event.dataTransfer &&\n+              event.dataTransfer.files &&\n+              event.dataTransfer.files.length > 0\n+            ) {\n+              event.preventDefault();\n+              const files = Array.from(event.dataTransfer.files);\n+              const acceptedFiles = files.filter(\n+                (f) => ACCEPTED_IMAGE_MIME_TYPES.includes(f.type) || ACCEPTED_ATTACHMENT_MIME_TYPES.includes(f.type)\n+              );\n+\n+              if (acceptedFiles.length) {\n+                const coordinates = view.posAtCoords({\n+                  left: event.clientX,\n+                  top: event.clientY,\n+                });\n+\n+                if (coordinates) {\n+                  const pos = coordinates.pos;\n+                  insertFilesSafely({\n+                    editor,\n+                    files: acceptedFiles,\n+                    initialPos: pos,\n+                    event: \"drop\",\n+                  });\n+                }\n+                return true;\n+              }\n+            }\n+            return false;\n+          },\n+        },\n+      }),\n+    ];\n+  },\n+});\n+\n+type InsertFilesSafelyArgs = {\n+  editor: Editor;\n+  event: \"insert\" | \"drop\";\n+  files: File[];\n+  initialPos: number;\n+  type?: Extract<TEditorCommands, \"attachment\" | \"image\">;\n+};\n+\n+export const insertFilesSafely = async (args: InsertFilesSafelyArgs) => {\n+  const { editor, event, files, initialPos, type } = args;\n+  let pos = initialPos;\n+\n+  for (const file of files) {\n+    // safe insertion\n+    const docSize = editor.state.doc.content.size;\n+    pos = Math.min(pos, docSize);\n+\n+    let fileType: \"image\" | \"attachment\" | null = null;\n+\n+    try {\n+      if (type) {\n+        if ([\"image\", \"attachment\"].includes(type)) fileType = type;\n+        else throw new Error(\"Wrong file type passed\");\n+      } else {\n+        if (ACCEPTED_IMAGE_MIME_TYPES.includes(file.type)) fileType = \"image\";\n+        else if (ACCEPTED_ATTACHMENT_MIME_TYPES.includes(file.type)) fileType = \"attachment\";\n+      }\n+      // insert file depending on the type at the current position\n+      if (fileType === \"image\") {\n+        editor.commands.insertImageComponent({\n+          file,\n+          pos,\n+          event,\n+        });\n+      } else if (fileType === \"attachment\") {\n+      }\n+    } catch (error) {\n+      console.error(`Error while ${event}ing file:`, error);\n+    }\n+\n+    // Move to the next position\n+    pos += 1;\n+  }\n+};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/drop.tsx",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/extensions/drop.tsx\n===================================================================\n--- packages/editor/src/core/extensions/drop.tsx\te68d344 (parent)\n+++ packages/editor/src/core/extensions/drop.tsx\tdc16f28 (commit)\n@@ -1,94 +0,0 @@\n-import { Extension, Editor } from \"@tiptap/core\";\n-import { Plugin, PluginKey } from \"@tiptap/pm/state\";\n-import { EditorView } from \"@tiptap/pm/view\";\n-\n-export const DropHandlerExtension = Extension.create({\n-  name: \"dropHandler\",\n-  priority: 1000,\n-\n-  addProseMirrorPlugins() {\n-    const editor = this.editor;\n-    return [\n-      new Plugin({\n-        key: new PluginKey(\"drop-handler-plugin\"),\n-        props: {\n-          handlePaste: (view: EditorView, event: ClipboardEvent) => {\n-            if (\n-              editor.isEditable &&\n-              event.clipboardData &&\n-              event.clipboardData.files &&\n-              event.clipboardData.files.length > 0\n-            ) {\n-              event.preventDefault();\n-              const files = Array.from(event.clipboardData.files);\n-              const imageFiles = files.filter((file) => file.type.startsWith(\"image\"));\n-\n-              if (imageFiles.length > 0) {\n-                const pos = view.state.selection.from;\n-                insertImagesSafely({ editor, files: imageFiles, initialPos: pos, event: \"drop\" });\n-              }\n-              return true;\n-            }\n-            return false;\n-          },\n-          handleDrop: (view: EditorView, event: DragEvent, _slice: any, moved: boolean) => {\n-            if (\n-              editor.isEditable &&\n-              !moved &&\n-              event.dataTransfer &&\n-              event.dataTransfer.files &&\n-              event.dataTransfer.files.length > 0\n-            ) {\n-              event.preventDefault();\n-              const files = Array.from(event.dataTransfer.files);\n-              const imageFiles = files.filter((file) => file.type.startsWith(\"image\"));\n-\n-              if (imageFiles.length > 0) {\n-                const coordinates = view.posAtCoords({\n-                  left: event.clientX,\n-                  top: event.clientY,\n-                });\n-\n-                if (coordinates) {\n-                  const pos = coordinates.pos;\n-                  insertImagesSafely({ editor, files: imageFiles, initialPos: pos, event: \"drop\" });\n-                }\n-                return true;\n-              }\n-            }\n-            return false;\n-          },\n-        },\n-      }),\n-    ];\n-  },\n-});\n-export const insertImagesSafely = async ({\n-  editor,\n-  files,\n-  initialPos,\n-  event,\n-}: {\n-  editor: Editor;\n-  files: File[];\n-  initialPos: number;\n-  event: \"insert\" | \"drop\";\n-}) => {\n-  let pos = initialPos;\n-\n-  for (const file of files) {\n-    // safe insertion\n-    const docSize = editor.state.doc.content.size;\n-    pos = Math.min(pos, docSize);\n-\n-    try {\n-      // Insert the image at the current position\n-      editor.commands.insertImageComponent({ file, pos, event });\n-    } catch (error) {\n-      console.error(`Error while ${event}ing image:`, error);\n-    }\n-\n-    // Move to the next position\n-    pos += 1;\n-  }\n-};\n"
        },
        {
          "path": "packages/editor/src/core/extensions/extensions.tsx",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/extensions/extensions.tsx\n===================================================================\n--- packages/editor/src/core/extensions/extensions.tsx\te68d344 (parent)\n+++ packages/editor/src/core/extensions/extensions.tsx\tdc16f28 (commit)\n@@ -171,8 +171,9 @@\n     CustomCalloutExtension,\n     CustomColorExtension,\n     ...CoreEditorAdditionalExtensions({\n       disabledExtensions,\n+      fileHandler,\n     }),\n   ];\n \n   if (!disabledExtensions.includes(\"image\")) {\n"
        },
        {
          "path": "packages/editor/src/core/helpers/editor-commands.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/helpers/editor-commands.ts\n===================================================================\n--- packages/editor/src/core/helpers/editor-commands.ts\te68d344 (parent)\n+++ packages/editor/src/core/helpers/editor-commands.ts\tdc16f28 (commit)\n@@ -1,8 +1,7 @@\n import { Editor, Range } from \"@tiptap/core\";\n-// types\n-import { InsertImageComponentProps } from \"@/extensions\";\n // extensions\n+import { InsertImageComponentProps } from \"@/extensions\";\n import { replaceCodeWithText } from \"@/extensions/code/utils/replace-code-block-with-text\";\n // helpers\n import { findTableAncestor } from \"@/helpers/common\";\n \n@@ -205,8 +204,9 @@\n export const insertHorizontalRule = (editor: Editor, range?: Range) => {\n   if (range) editor.chain().focus().deleteRange(range).setHorizontalRule().run();\n   else editor.chain().focus().setHorizontalRule().run();\n };\n+\n export const insertCallout = (editor: Editor, range?: Range) => {\n   if (range) editor.chain().focus().deleteRange(range).insertCallout().run();\n   else editor.chain().focus().insertCallout().run();\n };\n"
        },
        {
          "path": "packages/editor/src/core/helpers/file.ts",
          "status": "renamed",
          "oldPath": "packages/editor/src/core/plugins/image/utils/validate-file.ts",
          "diff": "===================================================================\n--- packages/editor/src/core/plugins/image/utils/validate-file.ts\te68d344 (parent)\n+++ packages/editor/src/core/helpers/file.ts\tdc16f28 (commit)\n@@ -1,21 +1,19 @@\n-// constants\n-import { ACCEPTED_FILE_MIME_TYPES } from \"@/constants/config\";\n-\n type TArgs = {\n+  acceptedMimeTypes: string[];\n   file: File;\n   maxFileSize: number;\n };\n \n export const isFileValid = (args: TArgs): boolean => {\n-  const { file, maxFileSize } = args;\n+  const { acceptedMimeTypes, file, maxFileSize } = args;\n \n   if (!file) {\n     alert(\"No file selected. Please select a file to upload.\");\n     return false;\n   }\n \n-  if (!ACCEPTED_FILE_MIME_TYPES.includes(file.type)) {\n+  if (!acceptedMimeTypes.includes(file.type)) {\n     alert(\"Invalid file type. Please select a JPEG, JPG, PNG, WEBP or GIF file.\");\n     return false;\n   }\n \n"
        },
        {
          "path": "packages/editor/src/core/hooks/use-file-upload.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/hooks/use-file-upload.ts\n===================================================================\n--- packages/editor/src/core/hooks/use-file-upload.ts\te68d344 (parent)\n+++ packages/editor/src/core/hooks/use-file-upload.ts\tdc16f28 (commit)\n@@ -1,88 +1,88 @@\n-import { DragEvent, useCallback, useEffect, useState } from \"react\";\n import { Editor } from \"@tiptap/core\";\n+import { DragEvent, useCallback, useEffect, useState } from \"react\";\n // extensions\n-import { insertImagesSafely } from \"@/extensions/drop\";\n+import { insertFilesSafely } from \"@/extensions/drop\";\n // plugins\n-import { isFileValid } from \"@/plugins/image\";\n+import { isFileValid } from \"@/helpers/file\";\n+// types\n+import { TEditorCommands } from \"@/types\";\n \n type TUploaderArgs = {\n-  blockId: string;\n-  editor: Editor;\n-  loadImageFromFileSystem: (file: string) => void;\n+  acceptedMimeTypes: string[];\n+  editorCommand: (file: File) => Promise<string>;\n+  handleProgressStatus?: (isUploading: boolean) => void;\n+  loadFileFromFileSystem?: (file: string) => void;\n   maxFileSize: number;\n-  onUpload: (url: string) => void;\n+  onUpload: (url: string, file: File) => void;\n };\n \n export const useUploader = (args: TUploaderArgs) => {\n-  const { blockId, editor, loadImageFromFileSystem, maxFileSize, onUpload } = args;\n+  const { acceptedMimeTypes, editorCommand, handleProgressStatus, loadFileFromFileSystem, maxFileSize, onUpload } =\n+    args;\n   // states\n-  const [uploading, setUploading] = useState(false);\n+  const [isUploading, setIsUploading] = useState(false);\n \n   const uploadFile = useCallback(\n     async (file: File) => {\n-      const setImageUploadInProgress = (isUploading: boolean) => {\n-        if (editor.storage.imageComponent) {\n-          editor.storage.imageComponent.uploadInProgress = isUploading;\n-        }\n-      };\n-      setImageUploadInProgress(true);\n-      setUploading(true);\n-      const fileNameTrimmed = trimFileName(file.name);\n-      const fileWithTrimmedName = new File([file], fileNameTrimmed, { type: file.type });\n+      handleProgressStatus?.(true);\n+      setIsUploading(true);\n       const isValid = isFileValid({\n-        file: fileWithTrimmedName,\n+        acceptedMimeTypes,\n+        file,\n         maxFileSize,\n       });\n       if (!isValid) {\n-        setImageUploadInProgress(false);\n+        handleProgressStatus?.(false);\n+        setIsUploading(false);\n         return;\n       }\n       try {\n-        const reader = new FileReader();\n-        reader.onload = () => {\n-          if (reader.result) {\n-            loadImageFromFileSystem(reader.result as string);\n-          } else {\n-            console.error(\"Failed to read the file: reader.result is null\");\n-          }\n-        };\n-        reader.onerror = () => {\n-          console.error(\"Error reading file\");\n-        };\n-        reader.readAsDataURL(fileWithTrimmedName);\n-        // @ts-expect-error - TODO: fix typings, and don't remove await from\n-        // here for now\n-        const url: string = await editor?.commands.uploadImage(blockId, fileWithTrimmedName);\n+        if (loadFileFromFileSystem) {\n+          const reader = new FileReader();\n+          reader.onload = () => {\n+            if (reader.result) {\n+              loadFileFromFileSystem(reader.result as string);\n+            } else {\n+              console.error(\"Failed to read the file: reader.result is null\");\n+            }\n+          };\n+          reader.onerror = () => {\n+            console.error(\"Error reading file\");\n+          };\n+          reader.readAsDataURL(file);\n+        }\n+        const url: string = await editorCommand(file);\n \n         if (!url) {\n-          throw new Error(\"Something went wrong while uploading the image\");\n+          throw new Error(\"Something went wrong while uploading the file.\");\n         }\n-        onUpload(url);\n-      } catch (errPayload: any) {\n-        console.log(errPayload);\n+        onUpload(url, file);\n+      } catch (errPayload) {\n         const error = errPayload?.response?.data?.error || \"Something went wrong\";\n         console.error(error);\n       } finally {\n-        setImageUploadInProgress(false);\n-        setUploading(false);\n+        handleProgressStatus?.(false);\n+        setIsUploading(false);\n       }\n     },\n-    [onUpload]\n+    [acceptedMimeTypes, editorCommand, handleProgressStatus, loadFileFromFileSystem, maxFileSize, onUpload]\n   );\n \n-  return { uploading, uploadFile };\n+  return { isUploading, uploadFile };\n };\n \n type TDropzoneArgs = {\n+  acceptedMimeTypes: string[];\n   editor: Editor;\n   maxFileSize: number;\n   pos: number;\n+  type: Extract<TEditorCommands, \"attachment\" | \"image\">;\n   uploader: (file: File) => Promise<void>;\n };\n \n export const useDropZone = (args: TDropzoneArgs) => {\n-  const { editor, maxFileSize, pos, uploader } = args;\n+  const { acceptedMimeTypes, editor, maxFileSize, pos, type, uploader } = args;\n   // states\n   const [isDragging, setIsDragging] = useState<boolean>(false);\n   const [draggedInside, setDraggedInside] = useState<boolean>(false);\n \n@@ -111,84 +111,80 @@\n       if (e.dataTransfer.files.length === 0 || !editor.isEditable) {\n         return;\n       }\n       const filesList = e.dataTransfer.files;\n-      await uploadFirstImageAndInsertRemaining({\n+      await uploadFirstFileAndInsertRemaining({\n+        acceptedMimeTypes,\n         editor,\n         filesList,\n         maxFileSize,\n         pos,\n+        type,\n         uploader,\n       });\n     },\n-    [uploader, editor, pos]\n+    [acceptedMimeTypes, editor, maxFileSize, pos, type, uploader]\n   );\n+  const onDragEnter = useCallback(() => setDraggedInside(true), []);\n+  const onDragLeave = useCallback(() => setDraggedInside(false), []);\n \n-  const onDragEnter = () => {\n-    setDraggedInside(true);\n+  return {\n+    isDragging,\n+    draggedInside,\n+    onDragEnter,\n+    onDragLeave,\n+    onDrop,\n   };\n-\n-  const onDragLeave = () => {\n-    setDraggedInside(false);\n-  };\n-\n-  return { isDragging, draggedInside, onDragEnter, onDragLeave, onDrop };\n };\n \n-function trimFileName(fileName: string, maxLength = 100) {\n-  if (fileName.length > maxLength) {\n-    const extension = fileName.split(\".\").pop();\n-    const nameWithoutExtension = fileName.slice(0, -(extension?.length ?? 0 + 1));\n-    const allowedNameLength = maxLength - (extension?.length ?? 0) - 1; // -1 for the dot\n-    return `${nameWithoutExtension.slice(0, allowedNameLength)}.${extension}`;\n-  }\n-\n-  return fileName;\n-}\n-\n-type TMultipleImagesArgs = {\n+type TMultipleFileArgs = {\n+  acceptedMimeTypes: string[];\n   editor: Editor;\n   filesList: FileList;\n   maxFileSize: number;\n   pos: number;\n+  type: Extract<TEditorCommands, \"attachment\" | \"image\">;\n   uploader: (file: File) => Promise<void>;\n };\n \n-// Upload the first image and insert the remaining images for uploading multiple image\n-// post insertion of image-component\n-export async function uploadFirstImageAndInsertRemaining(args: TMultipleImagesArgs) {\n-  const { editor, filesList, maxFileSize, pos, uploader } = args;\n+// Upload the first file and insert the remaining ones for uploading multiple files\n+export const uploadFirstFileAndInsertRemaining = async (args: TMultipleFileArgs) => {\n+  const { acceptedMimeTypes, editor, filesList, maxFileSize, pos, type, uploader } = args;\n   const filteredFiles: File[] = [];\n   for (let i = 0; i < filesList.length; i += 1) {\n-    const item = filesList.item(i);\n+    const file = filesList.item(i);\n     if (\n-      item &&\n-      item.type.indexOf(\"image\") !== -1 &&\n+      file &&\n       isFileValid({\n-        file: item,\n+        acceptedMimeTypes,\n+        file,\n         maxFileSize,\n       })\n     ) {\n-      filteredFiles.push(item);\n+      filteredFiles.push(file);\n     }\n   }\n   if (filteredFiles.length !== filesList.length) {\n-    console.warn(\"Some files were not images and have been ignored.\");\n+    console.warn(\"Some files were invalid and have been ignored.\");\n   }\n   if (filteredFiles.length === 0) {\n-    console.error(\"No image files found to upload\");\n+    console.error(\"No files found to upload.\");\n     return;\n   }\n \n-  // Upload the first image\n+  // Upload the first file\n   const firstFile = filteredFiles[0];\n   uploader(firstFile);\n-\n-  // Insert the remaining images\n+  // Insert the remaining files\n   const remainingFiles = filteredFiles.slice(1);\n-\n   if (remainingFiles.length > 0) {\n     const docSize = editor.state.doc.content.size;\n-    const posOfNextImageToBeInserted = Math.min(pos + 1, docSize);\n-    insertImagesSafely({ editor, files: remainingFiles, initialPos: posOfNextImageToBeInserted, event: \"drop\" });\n+    const posOfNextFileToBeInserted = Math.min(pos + 1, docSize);\n+    insertFilesSafely({\n+      editor,\n+      files: remainingFiles,\n+      initialPos: posOfNextFileToBeInserted,\n+      event: \"drop\",\n+      type,\n+    });\n   }\n-}\n+};\n"
        },
        {
          "path": "packages/editor/src/core/plugins/drag-handle.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/plugins/drag-handle.ts\n===================================================================\n--- packages/editor/src/core/plugins/drag-handle.ts\te68d344 (parent)\n+++ packages/editor/src/core/plugins/drag-handle.ts\tdc16f28 (commit)\n@@ -9,12 +9,12 @@\n   '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-ellipsis-vertical\"><circle cx=\"12\" cy=\"12\" r=\"1\"/><circle cx=\"12\" cy=\"5\" r=\"1\"/><circle cx=\"12\" cy=\"19\" r=\"1\"/></svg>';\n \n const generalSelectors = [\n   \"li\",\n-  \"p:not(:first-child)\",\n+  \"p.editor-paragraph-block:not(:first-child)\",\n   \".code-block\",\n   \"blockquote\",\n-  \"h1, h2, h3, h4, h5, h6\",\n+  \"h1.editor-heading-block, h2.editor-heading-block, h3.editor-heading-block, h4.editor-heading-block, h5.editor-heading-block, h6.editor-heading-block\",\n   \"[data-type=horizontalRule]\",\n   \".table-wrapper\",\n   \".issue-embed\",\n   \".image-component\",\n"
        },
        {
          "path": "packages/editor/src/core/plugins/image/constants.ts",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/plugins/image/constants.ts\n===================================================================\n--- packages/editor/src/core/plugins/image/constants.ts\te68d344 (parent)\n+++ packages/editor/src/core/plugins/image/constants.ts\tdc16f28 (commit)\n@@ -1,7 +0,0 @@\n-import { PluginKey } from \"@tiptap/pm/state\";\n-\n-export const uploadKey = new PluginKey(\"upload-image\");\n-export const deleteKey = new PluginKey(\"delete-image\");\n-export const restoreKey = new PluginKey(\"restore-image\");\n-\n-export const IMAGE_NODE_TYPE = \"image\";\n"
        },
        {
          "path": "packages/editor/src/core/plugins/image/delete-image.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/plugins/image/delete-image.ts\n===================================================================\n--- packages/editor/src/core/plugins/image/delete-image.ts\te68d344 (parent)\n+++ packages/editor/src/core/plugins/image/delete-image.ts\tdc16f28 (commit)\n@@ -36,21 +36,17 @@\n         });\n \n         removedImages.forEach(async (node) => {\n           const src = node.attrs.src;\n-          editor.storage[nodeType].deletedImageSet.set(src, true);\n-          await onNodeDeleted(src, deleteImage);\n+          editor.storage[nodeType].deletedImageSet?.set(src, true);\n+          if (!src) return;\n+          try {\n+            await deleteImage(src);\n+          } catch (error) {\n+            console.error(\"Error deleting image:\", error);\n+          }\n         });\n       });\n \n       return null;\n     },\n   });\n-\n-async function onNodeDeleted(src: string, deleteImage: DeleteImage): Promise<void> {\n-  if (!src) return;\n-  try {\n-    await deleteImage(src);\n-  } catch (error) {\n-    console.error(\"Error deleting image: \", error);\n-  }\n-}\n"
        },
        {
          "path": "packages/editor/src/core/plugins/image/index.ts",
          "status": "modified",
          "diff": "Index: packages/editor/src/core/plugins/image/index.ts\n===================================================================\n--- packages/editor/src/core/plugins/image/index.ts\te68d344 (parent)\n+++ packages/editor/src/core/plugins/image/index.ts\tdc16f28 (commit)\n@@ -1,5 +1,3 @@\n export * from \"./types\";\n-export * from \"./utils\";\n-export * from \"./constants\";\n export * from \"./delete-image\";\n export * from \"./restore-image\";\n"
        },
        {
          "path": "packages/editor/src/core/plugins/image/utils/index.ts",
          "status": "deleted",
          "diff": "Index: packages/editor/src/core/plugins/image/utils/index.ts\n===================================================================\n--- packages/editor/src/core/plugins/image/utils/index.ts\te68d344 (parent)\n+++ packages/editor/src/core/plugins/image/utils/index.ts\tdc16f28 (commit)\n@@ -1,1 +0,0 @@\n-export * from \"./validate-file\";\n"
        },
        {
          "path": "packages/utils/src/attachment.ts",
          "status": "added",
          "diff": "Index: packages/utils/src/attachment.ts\n===================================================================\n--- packages/utils/src/attachment.ts\te68d344 (parent)\n+++ packages/utils/src/attachment.ts\tdc16f28 (commit)\n@@ -0,0 +1,32 @@\n+export const generateFileName = (fileName: string) => {\n+  const date = new Date();\n+  const timestamp = date.getTime();\n+\n+  const _fileName = getFileName(fileName);\n+  const nameWithoutExtension = _fileName.length > 80 ? _fileName.substring(0, 80) : _fileName;\n+  const extension = getFileExtension(fileName);\n+\n+  return `${nameWithoutExtension}-${timestamp}.${extension}`;\n+};\n+\n+export const getFileExtension = (filename: string) => filename.slice(((filename.lastIndexOf(\".\") - 1) >>> 0) + 2);\n+\n+export const getFileName = (fileName: string) => {\n+  const dotIndex = fileName.lastIndexOf(\".\");\n+\n+  const nameWithoutExtension = fileName.substring(0, dotIndex);\n+\n+  return nameWithoutExtension;\n+};\n+\n+export const convertBytesToSize = (bytes: number) => {\n+  let size;\n+\n+  if (bytes < 1024 * 1024) {\n+    size = Math.round(bytes / 1024) + \" KB\";\n+  } else {\n+    size = Math.round(bytes / (1024 * 1024)) + \" MB\";\n+  }\n+\n+  return size;\n+};\n"
        },
        {
          "path": "packages/utils/src/index.ts",
          "status": "modified",
          "diff": "Index: packages/utils/src/index.ts\n===================================================================\n--- packages/utils/src/index.ts\te68d344 (parent)\n+++ packages/utils/src/index.ts\tdc16f28 (commit)\n@@ -1,5 +1,6 @@\n export * from \"./array\";\n+export * from \"./attachment\";\n export * from \"./auth\";\n export * from \"./datetime\";\n export * from \"./color\";\n export * from \"./common\";\n@@ -15,5 +16,4 @@\n \n export * from \"./get-icon-for-link\";\n \n export * from \"./subscription\";\n-\n"
        }
      ]
    },
    {
      "id": "sub-filters-grouping",
      "sha": "e401c9d6e4d9ec1142ef78775eb1a270b3b375fd",
      "parentSha": "39b5736c83aa517aa835378bc2a3bcd89f74097b",
      "spec": "Implement sub-work item filters and grouping in the issue detail sub-issues widget with purely front-end logic.\n\n1) Constants and types\n- In packages/constants/src/issue/common.ts, add a filter key to issue property key map: FILTER_TO_ISSUE_MAP mapping IIssueFilterOptions keys (assignees, created_by, labels, priority, cycle, module, project, state, issue_type, state_group) to their corresponding TIssue keys (assignee_ids, created_by, label_ids, priority, cycle_id, module_ids, project_id, state_id, type_id, state__group).\n- In packages/types/src/issues/issue.d.ts, extend TIssue with an optional state__group: string | null field used by state group grouping.\n- In packages/constants/src/issue/filter.ts, for ISSUE_DISPLAY_FILTERS_BY_PAGE.sub_work_items.list:\n  - Set filters to [\"priority\", \"state\", \"project\", \"issue_type\", \"assignees\", \"start_date\", \"target_date\"].\n  - Add display_filters.group_by options [\"state\", \"priority\", \"assignees\", null].\n  - Keep existing order_by options intact.\n\n2) Shared UI enhancements\n- In packages/ui/src/collapsible/collapsible-button.tsx, add an optional ChevronIcon: React.FC<ISvgIcons> prop to allow custom chevrons; default to DropdownIcon.\n- In web/core/components/empty-state/section-empty-state-root.tsx, add customClassName prop and merge it into the container with cn().\n\n3) Sub-issues widget UI changes\n- web/core/components/issues/issue-detail-widgets/sub-issues/content.tsx: when rendering SubIssuesListRoot, pass storeType={EIssuesStoreType.PROJECT}.\n- web/core/components/issues/issue-detail-widgets/sub-issues/display-filters.tsx:\n  - Replace the old menu button with a SlidersHorizontal icon inside a highlighted badge when any display filters are applied.\n  - Use isDisplayFiltersApplied({ displayProperties, displayFilters }) to decide highlighting.\n  - Add a \"Group by\" section using FilterGroupBy with options from layoutDisplayFiltersOptions.display_filters.group_by and call handleDisplayFiltersUpdate({ group_by: val }).\n- web/core/components/issues/issue-detail-widgets/sub-issues/filters.tsx (new):\n  - Render a FiltersDropdown that provides:\n    - Priority (FilterPriority)\n    - State group (FilterStateGroup)\n    - State (FilterState) with project states option\n    - Project (FilterProjects)\n    - Issue types (FilterIssueTypes)\n    - Assignees (FilterAssignees) with project member IDs\n    - Start date (FilterStartDate)\n    - Target date (FilterDueDate)\n  - Include search within filters (Search/X controls).\n  - Highlight the filter button when any filters are applied using isFiltersApplied(filters).\n  - Expose handleFiltersUpdate on click; toggle membership for clicked values and support multi-value date filter tokens.\n- web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/list-group.tsx (new):\n  - Render a collapsible group section header (name, icon, count) and list of SubIssuesListItem for each workItemId.\n  - Default the first \"All Issues\" pseudo-group open.\n- web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/list-item.tsx:\n  - Add an optional storeType?: EIssuesStoreType prop (default PROJECT) and pass it to nested SubIssuesListRoot when rendering grandchildren.\n  - Guard displayProperties with optional chaining when reading from sub-issue filters.\n- web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/properties.tsx:\n  - Reorder so State and Priority properties appear earlier before date and assignee UI, and keep functionality to update state_id and priority using updateSubIssue.\n- web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/root.tsx:\n  - Wire computed filters from the store: getSubIssueFilters, getGroupedSubWorkItems, getFilteredSubWorkItems, and resetFilters.\n  - Determine if at the root level (rootIssueId === parentIssueId). Only allow grouping at root.\n  - Compute group_by from display filters when at root; otherwise null.\n  - Use getGroupByColumns to build the visual group headers based on group_by, storeType (workspace vs project level) and projectId; allow \"All Issues\" when unset.\n  - Derive grouped lists via getGroupedSubWorkItems(parentIssueId) or fall back to ungrouped subIssueIds.\n  - If no filtered results, display SectionEmptyState with a Clear filters action (resetFilters(rootIssueId)).\n- web/core/components/issues/issue-detail-widgets/sub-issues/title-actions.tsx:\n  - Replace updateSubIssueFilters with updateSubWorkItemFilters.\n  - Provide handleFiltersUpdate(key, value) that toggles array values and manages multi-token date filters.\n  - Load project states and member IDs via hooks and pass to SubIssueFilters.\n  - Include both SubIssueDisplayFilters and SubIssueFilters next to the action button.\n- web/core/components/issues/issue-detail-widgets/sub-issues/title.tsx:\n  - Remove workspaceSlug from SubWorkItemTitleActions props; adjust usage accordingly.\n\n4) Issue layout utilities\n- web/core/components/issues/issue-layouts/utils.tsx:\n  - Update getGroupByColumns signature to accept ({ isWorkspaceLevel, projectId }) and pass these into column builders.\n  - Update getStateColumns to optionally use project-specific states via store.state.getProjectStates(projectId).\n  - Update getAssigneeColumns to support workspace-level and project-level member sets.\n  - Add isDisplayFiltersApplied(filters: Partial<IIssueFilters>): boolean to check deviations from default display properties and from default display filters (i.e., order_by !== -created_at).\n  - Add isFiltersApplied(filters: IIssueFilterOptions): boolean to detect any applied filter values.\n\n5) Sub-issue store and filters store\n- web/core/store/issue/issue-details/sub_issues.store.ts:\n  - Remove persisted groupedSubIssues state held from the server; no longer request backend grouping or filters.\n  - Add loader transitions (init-loader -> undefined) around fetchSubIssues.\n  - Keep subIssuesByIssueId as a computedFn and maintain subIssuesStateDistribution.\n- web/core/store/issue/issue-details/sub_issues_filter.store.ts:\n  - Maintain subIssueFilters: Record<workItemId, Partial<IIssueFilters>> with three branches: filters, displayFilters, displayProperties.\n  - Initialize per-work-item filters with defaults (DEFAULT_DISPLAY_PROPERTIES and empty filters/displayFilters).\n  - Provide updateSubWorkItemFilters(filterType, payload, workItemId) that updates the branch in subIssueFilters without triggering a new fetch.\n  - Provide computed functions:\n    - getFilteredSubWorkItems(workItemId, filters) returning TIssue[] filtered from the main issue map using in-memory criteria.\n    - getGroupedSubWorkItems(workItemId) returning Record<groupId, string[]> of ordered issue IDs based on group_by/order_by from displayFilters.\n  - Provide resetFilters(workItemId) to restore defaults.\n\n6) Base issues utilities for client-side filtering and grouping\n- web/core/store/issue/helpers/base-issues-utils.ts:\n  - Add checkIssueDateFilter(issue, 'start_date'|'target_date', dateFilters) combining parsed filter operations with checkDateCriteria.\n  - Add getFilteredWorkItems(workItems, filters) to evaluate all IIssueFilterOptions keys using FILTER_TO_ISSUE_MAP and date filters; perform AND across distinct filters and OR within multi-value selections for array fields.\n  - Add getOrderedWorkItems(workItems, orderByKey) and getGroupedWorkItemIds(workItems, groupByKey, orderByKey) to return group->ordered IDs (with ALL_ISSUES when ungrouped), using ISSUE_GROUP_BY_KEY mapping for grouping.\n  - Add updateFilters(filtersMap, filterType, filters, workItemId) utility to mutate the store’s subIssueFilters branches.\n- web/core/store/issue/helpers/base-issues.store.ts:\n  - Export ISSUE_GROUP_BY_KEY and map \"state_detail.group\" to the new TIssue key \"state__group\".\n\n7) Date helper utilities\n- web/helpers/date-time.helper.ts:\n  - Implement processRelativeDate, parseDateFilter, and checkDateCriteria to support relative and absolute date comparisons used by start_date/target_date filters.\n\n8) Visual and behavior polish\n- Use SlidersHorizontal/ListFilter icons to indicate active filters with a small badge; apply bg-custom-primary-60/20 highlight when filters are applied.\n- Ensure SectionEmptyState in grouped list uses customClassName to drop borders in non-epic contexts.\n\nFunctional acceptance criteria:\n- In sub-issues section of issue detail, a Filters menu (display filters) and a separate filters menu are available.\n- Group-by (state/priority/assignees or None) works at the root level; nested sub-issue trees remain ungrouped.\n- Filters (priority, state group, state, project, issue type, assignees, start/target date) narrow results; indicators show when any filter is applied; a clear filters action restores defaults.\n- Ordering respects selected order_by (default -created_at) for sub-work items.\n- All computations occur client-side without backend grouped responses.",
      "prompt": "Add client-side filtering and grouping for sub-work items in the issue detail view.\n\n- Provide two menus in the sub-work items header: one for display settings (including group-by options) and one for filters.\n- Group sub-work items by state, priority, or assignees (or show all), only at the root sub-items level; nested sub-items remain ungrouped.\n- Offer filters for priority, state group, state, project, issue type, assignees, start date, and target date. Support both relative and absolute dates for start/target date filters.\n- Compute filters, grouping, and ordering entirely on the client by reading from the existing issue map. Do not rely on the server to return grouped results.\n- Show an empty state with a clear-filters action when no sub-work items match the applied filters.\n- Update utility functions and types to support a mapping from filter keys to issue properties and a state__group field on issues.\n- Ensure the UI surfaces an active-filter badge and uses a consistent dropdown menu pattern already used elsewhere in the app.\n- Keep sub-work item properties editable (e.g., state and priority) and reflect changes immediately within the filtered/grouped list.",
      "supplementalFiles": [
        "web/core/components/issues/issue-layouts/filters/header/display-filters/group-by.tsx",
        "web/core/components/issues/issue-layouts/filters/header/helpers/dropdown.tsx",
        "web/core/components/issues/issue-layouts/filters/header/filters/priority.tsx",
        "web/core/components/issues/issue-layouts/filters/header/filters/state.tsx",
        "web/core/components/issues/issue-layouts/filters/header/filters/state-group.tsx",
        "web/core/components/issues/issue-layouts/filters/header/filters/assignee.tsx",
        "web/core/components/issues/issue-layouts/filters/header/filters/project.tsx",
        "web/core/components/issues/issue-layouts/filters/header/filters/start-date.tsx",
        "web/core/components/issues/issue-layouts/filters/header/filters/due-date.tsx",
        "web/ce/components/issues/filters/issue-types.tsx"
      ],
      "fileDiffs": [
        {
          "path": "packages/constants/src/issue/common.ts",
          "status": "modified",
          "diff": "Index: packages/constants/src/issue/common.ts\n===================================================================\n--- packages/constants/src/issue/common.ts\t39b5736 (parent)\n+++ packages/constants/src/issue/common.ts\te401c9d (commit)\n@@ -1,5 +1,11 @@\n-import { TIssueGroupByOptions, TIssueOrderByOptions, IIssueDisplayProperties } from \"@plane/types\";\n+import {\n+  TIssueGroupByOptions,\n+  TIssueOrderByOptions,\n+  IIssueDisplayProperties,\n+  IIssueFilterOptions,\n+  TIssue,\n+} from \"@plane/types\";\n \n export const ALL_ISSUES = \"All Issues\";\n \n export type TIssuePriorities = \"urgent\" | \"high\" | \"medium\" | \"low\" | \"none\";\n@@ -360,4 +366,18 @@\n     descendingOrderTitle: \"Least\",\n     icon: \"LayersIcon\",\n   },\n };\n+\n+// Map filter keys to their corresponding issue property keys\n+export const FILTER_TO_ISSUE_MAP: Partial<Record<keyof IIssueFilterOptions, keyof TIssue>> = {\n+  assignees: \"assignee_ids\",\n+  created_by: \"created_by\",\n+  labels: \"label_ids\",\n+  priority: \"priority\",\n+  cycle: \"cycle_id\",\n+  module: \"module_ids\",\n+  project: \"project_id\",\n+  state: \"state_id\",\n+  issue_type: \"type_id\",\n+  state_group: \"state__group\",\n+} as const;\n"
        },
        {
          "path": "packages/constants/src/issue/filter.ts",
          "status": "modified",
          "diff": "Index: packages/constants/src/issue/filter.ts\n===================================================================\n--- packages/constants/src/issue/filter.ts\t39b5736 (parent)\n+++ packages/constants/src/issue/filter.ts\te401c9d (commit)\n@@ -1,9 +1,6 @@\n+import { ILayoutDisplayFiltersOptions, TIssueActivityComment } from \"@plane/types\";\n import {\n-  ILayoutDisplayFiltersOptions,\n-  TIssueActivityComment,\n-} from \"@plane/types\";\n-import {\n   TIssueFilterPriorityObject,\n   ISSUE_DISPLAY_PROPERTIES_KEYS,\n   EIssuesStoreType,\n   SUB_ISSUES_DISPLAY_PROPERTIES_KEYS,\n@@ -357,11 +354,12 @@\n   },\n   sub_work_items: {\n     list: {\n       display_properties: SUB_ISSUES_DISPLAY_PROPERTIES_KEYS,\n-      filters: [],\n+      filters: [\"priority\", \"state\", \"project\", \"issue_type\", \"assignees\", \"start_date\", \"target_date\"],\n       display_filters: {\n         order_by: [\"-created_at\", \"-updated_at\", \"start_date\", \"-priority\"],\n+        group_by: [\"state\", \"priority\", \"assignees\", null],\n       },\n       extra_options: {\n         access: true,\n         values: [\"sub_issue\"],\n@@ -369,11 +367,9 @@\n     },\n   },\n };\n \n-export const ISSUE_STORE_TO_FILTERS_MAP: Partial<\n-  Record<EIssuesStoreType, TFiltersByLayout>\n-> = {\n+export const ISSUE_STORE_TO_FILTERS_MAP: Partial<Record<EIssuesStoreType, TFiltersByLayout>> = {\n   [EIssuesStoreType.PROJECT]: ISSUE_DISPLAY_FILTERS_BY_PAGE.issues,\n };\n \n export enum EActivityFilterType {\n@@ -382,12 +378,9 @@\n }\n \n export type TActivityFilters = EActivityFilterType;\n \n-export const ACTIVITY_FILTER_TYPE_OPTIONS: Record<\n-  TActivityFilters,\n-  { labelTranslationKey: string }\n-> = {\n+export const ACTIVITY_FILTER_TYPE_OPTIONS: Record<TActivityFilters, { labelTranslationKey: string }> = {\n   [EActivityFilterType.ACTIVITY]: {\n     labelTranslationKey: \"common.updates\",\n   },\n   [EActivityFilterType.COMMENT]: {\n@@ -401,18 +394,13 @@\n   isSelected: boolean;\n   onClick: () => void;\n };\n \n-export const defaultActivityFilters: TActivityFilters[] = [\n-  EActivityFilterType.ACTIVITY,\n-  EActivityFilterType.COMMENT,\n-];\n+export const defaultActivityFilters: TActivityFilters[] = [EActivityFilterType.ACTIVITY, EActivityFilterType.COMMENT];\n \n export const filterActivityOnSelectedFilters = (\n   activity: TIssueActivityComment[],\n   filters: TActivityFilters[]\n ): TIssueActivityComment[] =>\n-  activity.filter((activity) =>\n-    filters.includes(activity.activity_type as TActivityFilters)\n-  );\n+  activity.filter((activity) => filters.includes(activity.activity_type as TActivityFilters));\n \n export const ENABLE_ISSUE_DEPENDENCIES = false;\n"
        },
        {
          "path": "packages/types/src/issues/issue.d.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/issues/issue.d.ts\n===================================================================\n--- packages/types/src/issues/issue.d.ts\t39b5736 (parent)\n+++ packages/types/src/issues/issue.d.ts\te401c9d (commit)\n@@ -63,8 +63,9 @@\n   // tempId is used for optimistic updates. It is not a part of the API response.\n   tempId?: string;\n   // sourceIssueId is used to store the original issue id when creating a copy of an issue. Used in cloning property values. It is not a part of the API response.\n   sourceIssueId?: string;\n+  state__group?: string | null;\n };\n \n export type TIssueMap = {\n   [issue_id: string]: TIssue;\n"
        },
        {
          "path": "packages/ui/src/collapsible/collapsible-button.tsx",
          "status": "modified",
          "diff": "Index: packages/ui/src/collapsible/collapsible-button.tsx\n===================================================================\n--- packages/ui/src/collapsible/collapsible-button.tsx\t39b5736 (parent)\n+++ packages/ui/src/collapsible/collapsible-button.tsx\te401c9d (commit)\n@@ -1,7 +1,7 @@\n import React, { FC } from \"react\";\n import { cn } from \"../../helpers\";\n-import { DropdownIcon } from \"../icons\";\n+import { DropdownIcon, ISvgIcons } from \"../icons\";\n \n type Props = {\n   isOpen: boolean;\n   title: React.ReactNode;\n@@ -9,8 +9,9 @@\n   indicatorElement?: React.ReactNode;\n   actionItemElement?: React.ReactNode;\n   className?: string;\n   titleClassName?: string;\n+  ChevronIcon?: React.FC<ISvgIcons>;\n };\n \n export const CollapsibleButton: FC<Props> = (props) => {\n   const {\n@@ -20,8 +21,9 @@\n     indicatorElement,\n     actionItemElement,\n     className = \"\",\n     titleClassName = \"\",\n+    ChevronIcon = DropdownIcon,\n   } = props;\n   return (\n     <div\n       className={cn(\n@@ -31,9 +33,9 @@\n     >\n       <div className=\"flex items-center gap-3.5\">\n         <div className=\"flex items-center gap-3\">\n           {!hideChevron && (\n-            <DropdownIcon\n+            <ChevronIcon\n               className={cn(\"size-2 text-custom-text-300 hover:text-custom-text-200 duration-300\", {\n                 \"-rotate-90\": !isOpen,\n               })}\n             />\n"
        },
        {
          "path": "web/core/components/empty-state/section-empty-state-root.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/empty-state/section-empty-state-root.tsx\n===================================================================\n--- web/core/components/empty-state/section-empty-state-root.tsx\t39b5736 (parent)\n+++ web/core/components/empty-state/section-empty-state-root.tsx\te401c9d (commit)\n@@ -1,19 +1,26 @@\n \"use client\";\n \n import { FC } from \"react\";\n+import { cn } from \"@plane/utils\";\n \n type Props = {\n   icon: React.ReactNode;\n   title: string;\n   description?: string;\n   actionElement?: React.ReactNode;\n+  customClassName?: string;\n };\n \n export const SectionEmptyState: FC<Props> = (props) => {\n-  const { title, description, icon, actionElement } = props;\n+  const { title, description, icon, actionElement, customClassName } = props;\n   return (\n-    <div className=\"flex flex-col gap-4 items-center justify-center rounded-md border border-custom-border-200 p-10\">\n+    <div\n+      className={cn(\n+        \"flex flex-col gap-4 items-center justify-center rounded-md border border-custom-border-200 p-10\",\n+        customClassName\n+      )}\n+    >\n       <div className=\"flex flex-col items-center gap-2\">\n         <div className=\"flex items-center justify-center size-8 bg-custom-background-80 rounded\">{icon}</div>\n         <span className=\"text-sm font-medium\">{title}</span>\n         {description && <span className=\"text-xs text-custom-text-300\">{description}</span>}\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/content.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/content.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/content.tsx\t39b5736 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/content.tsx\te401c9d (commit)\n@@ -1,8 +1,8 @@\n \"use client\";\n import React, { FC, useEffect, useState, useCallback } from \"react\";\n import { observer } from \"mobx-react\";\n-import { EIssueServiceType } from \"@plane/constants\";\n+import { EIssueServiceType, EIssuesStoreType } from \"@plane/constants\";\n import { TIssue, TIssueServiceType } from \"@plane/types\";\n // components\n import { DeleteIssueModal } from \"@/components/issues/delete-issue-modal\";\n import { CreateUpdateIssueModal } from \"@/components/issues/issue-modal\";\n@@ -116,8 +116,9 @@\n   return (\n     <>\n       {subIssueHelpers.issue_visibility.includes(parentIssueId) && (\n         <SubIssuesListRoot\n+          storeType={EIssuesStoreType.PROJECT}\n           workspaceSlug={workspaceSlug}\n           projectId={projectId}\n           parentIssueId={parentIssueId}\n           rootIssueId={parentIssueId}\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/display-filters.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/display-filters.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/display-filters.tsx\t39b5736 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/display-filters.tsx\te401c9d (commit)\n@@ -1,10 +1,12 @@\n-import { FC } from \"react\";\n+import { FC, useMemo } from \"react\";\n import isEmpty from \"lodash/isEmpty\";\n import { observer } from \"mobx-react\";\n+import { SlidersHorizontal } from \"lucide-react\";\n import { IIssueDisplayFilterOptions, ILayoutDisplayFiltersOptions, IIssueDisplayProperties } from \"@plane/types\";\n-import { DisplayPropertiesIcon } from \"@plane/ui\";\n-import { FilterDisplayProperties, FilterOrderBy, FiltersDropdown } from \"@/components/issues\";\n+import { cn } from \"@plane/utils\";\n+import { FilterDisplayProperties, FilterGroupBy, FilterOrderBy, FiltersDropdown } from \"@/components/issues\";\n+import { isDisplayFiltersApplied } from \"@/components/issues/issue-layouts/utils\";\n \n type TSubIssueDisplayFiltersProps = {\n   displayProperties: IIssueDisplayProperties;\n   displayFilters: IIssueDisplayFilterOptions;\n@@ -23,22 +25,31 @@\n     handleDisplayFiltersUpdate,\n     displayFilters,\n   } = props;\n \n+  const isFilterApplied = useMemo(\n+    () => isDisplayFiltersApplied({ displayProperties, displayFilters }),\n+    [displayProperties, displayFilters]\n+  );\n+\n   return (\n     <>\n       {layoutDisplayFiltersOptions?.display_filters && layoutDisplayFiltersOptions?.display_properties.length > 0 && (\n         <FiltersDropdown\n           placement=\"bottom-end\"\n-          menuButton={<DisplayPropertiesIcon className=\"h-3.5 w-3.5 text-custom-text-100\" />}\n+          menuButton={\n+            <div\n+              className={cn(\n+                \"p-1 rounded  relative transition-all duration-200\",\n+                isFilterApplied && \"bg-custom-primary-60/20\"\n+              )}\n+            >\n+              {isFilterApplied && <span className=\"p-1 rounded-full bg-custom-primary-100 absolute -top-1 -right-1\" />}\n+              <SlidersHorizontal className=\"h-3.5 w-3.5 text-custom-text-100\" />\n+            </div>\n+          }\n         >\n-          <div\n-            onClick={(e) => {\n-              e.stopPropagation();\n-              e.preventDefault();\n-            }}\n-            className=\"vertical-scrollbar scrollbar-sm relative h-full w-full divide-y divide-custom-border-200 overflow-hidden overflow-y-auto px-2.5 max-h-[25rem] text-left\"\n-          >\n+          <div className=\"vertical-scrollbar scrollbar-sm relative h-full w-full divide-y divide-custom-border-200 overflow-hidden overflow-y-auto px-2.5 max-h-[25rem] text-left\">\n             {/* display properties */}\n             <div className=\"py-2\">\n               <FilterDisplayProperties\n                 displayProperties={displayProperties}\n@@ -47,8 +58,22 @@\n                 isEpic={isEpic}\n               />\n             </div>\n \n+            {/* group by */}\n+            <div className=\"py-2\">\n+              <FilterGroupBy\n+                displayFilters={displayFilters}\n+                groupByOptions={layoutDisplayFiltersOptions?.display_filters.group_by ?? []}\n+                handleUpdate={(val) =>\n+                  handleDisplayFiltersUpdate({\n+                    group_by: val,\n+                  })\n+                }\n+                ignoreGroupedFilters={[]}\n+              />\n+            </div>\n+\n             {/* order by */}\n             {!isEmpty(layoutDisplayFiltersOptions?.display_filters?.order_by) && (\n               <div className=\"py-2\">\n                 <FilterOrderBy\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/filters.tsx",
          "status": "added",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/filters.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/filters.tsx\t39b5736 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/filters.tsx\te401c9d (commit)\n@@ -0,0 +1,169 @@\n+import { FC, useMemo, useState } from \"react\";\n+import { observer } from \"mobx-react\";\n+import { ListFilter, Search, X } from \"lucide-react\";\n+import { useTranslation } from \"@plane/i18n\";\n+import { IIssueFilterOptions, ILayoutDisplayFiltersOptions, IState } from \"@plane/types\";\n+import { cn } from \"@plane/utils\";\n+import {\n+  FilterAssignees,\n+  FilterDueDate,\n+  FilterPriority,\n+  FilterProjects,\n+  FiltersDropdown,\n+  FilterStartDate,\n+  FilterState,\n+  FilterStateGroup,\n+} from \"@/components/issues\";\n+import { isFiltersApplied } from \"@/components/issues/issue-layouts/utils\";\n+import { FilterIssueTypes } from \"@/plane-web/components/issues/filters/issue-types\";\n+\n+type TSubIssueFiltersProps = {\n+  handleFiltersUpdate: (key: keyof IIssueFilterOptions, value: string | string[]) => void;\n+  filters: IIssueFilterOptions;\n+  memberIds: string[] | undefined;\n+  states?: IState[];\n+  layoutDisplayFiltersOptions: ILayoutDisplayFiltersOptions | undefined;\n+};\n+\n+export const SubIssueFilters: FC<TSubIssueFiltersProps> = observer((props) => {\n+  const { handleFiltersUpdate, filters, memberIds, states, layoutDisplayFiltersOptions } = props;\n+\n+  // states\n+  const [filtersSearchQuery, setFiltersSearchQuery] = useState(\"\");\n+\n+  const isFilterEnabled = (filter: keyof IIssueFilterOptions) =>\n+    !!layoutDisplayFiltersOptions?.filters.includes(filter);\n+  const isFilterApplied = useMemo(() => isFiltersApplied(filters), [filters]);\n+  // hooks\n+  const { t } = useTranslation();\n+\n+  return (\n+    <>\n+      <FiltersDropdown\n+        placement=\"bottom-end\"\n+        menuButton={\n+          <div\n+            className={cn(\n+              \"p-1 rounded  relative transition-all duration-200\",\n+              isFilterApplied && \"bg-custom-primary-60/20\"\n+            )}\n+          >\n+            {isFilterApplied && <span className=\"p-1 rounded-full bg-custom-primary-100 absolute -top-1 -right-1\" />}\n+            <ListFilter className=\"h-3.5 w-3.5 text-custom-text-100\" />\n+          </div>\n+        }\n+      >\n+        <div className=\"flex max-h-[350px] flex-col overflow-hidden\">\n+          <div className=\"bg-custom-background-100 p-2.5 pb-0\">\n+            <div className=\"flex items-center gap-1.5 rounded border-[0.5px] border-custom-border-200 bg-custom-background-90 px-1.5 py-1 text-xs\">\n+              <Search className=\"text-custom-text-400\" size={12} strokeWidth={2} />\n+              <input\n+                type=\"text\"\n+                className=\"w-full bg-custom-background-90 outline-none placeholder:text-custom-text-400\"\n+                placeholder={t(\"common.search.label\")}\n+                value={filtersSearchQuery}\n+                onChange={(e) => setFiltersSearchQuery(e.target.value)}\n+              />\n+              {filtersSearchQuery !== \"\" && (\n+                <button type=\"button\" className=\"grid place-items-center\" onClick={() => setFiltersSearchQuery(\"\")}>\n+                  <X className=\"text-custom-text-300\" size={12} strokeWidth={2} />\n+                </button>\n+              )}\n+            </div>\n+          </div>\n+          <div className=\"vertical-scrollbar scrollbar-sm h-full w-full divide-y divide-custom-border-200 overflow-y-auto px-2.5 text-left\">\n+            {/* Priority */}\n+            {isFilterEnabled(\"priority\") && (\n+              <div className=\"py-2\">\n+                <FilterPriority\n+                  appliedFilters={filters.priority ?? null}\n+                  handleUpdate={(val) => handleFiltersUpdate(\"priority\", val)}\n+                  searchQuery={filtersSearchQuery}\n+                />\n+              </div>\n+            )}\n+\n+            {/* state group */}\n+            {isFilterEnabled(\"state_group\") && (\n+              <div className=\"py-2\">\n+                <FilterStateGroup\n+                  appliedFilters={filters.state_group ?? null}\n+                  handleUpdate={(val) => handleFiltersUpdate(\"state_group\", val)}\n+                  searchQuery={filtersSearchQuery}\n+                />\n+              </div>\n+            )}\n+\n+            {/* State */}\n+            {isFilterEnabled(\"state\") && (\n+              <div className=\"py-2\">\n+                <FilterState\n+                  appliedFilters={filters.state ?? null}\n+                  handleUpdate={(val) => handleFiltersUpdate(\"state\", val)}\n+                  searchQuery={filtersSearchQuery}\n+                  states={states}\n+                />\n+              </div>\n+            )}\n+\n+            {/* Projects */}\n+            {isFilterEnabled(\"project\") && (\n+              <div className=\"py-2\">\n+                <FilterProjects\n+                  appliedFilters={filters.project ?? null}\n+                  handleUpdate={(val) => handleFiltersUpdate(\"project\", val)}\n+                  searchQuery={filtersSearchQuery}\n+                />\n+              </div>\n+            )}\n+\n+            {/* work item types */}\n+            {isFilterEnabled(\"issue_type\") && (\n+              <div className=\"py-2\">\n+                <FilterIssueTypes\n+                  appliedFilters={filters.issue_type ?? null}\n+                  handleUpdate={(val) => handleFiltersUpdate(\"issue_type\", val)}\n+                  searchQuery={filtersSearchQuery}\n+                />\n+              </div>\n+            )}\n+\n+            {/* Assignees */}\n+            {isFilterEnabled(\"assignees\") && (\n+              <div className=\"py-2\">\n+                <FilterAssignees\n+                  appliedFilters={filters.assignees ?? null}\n+                  handleUpdate={(val) => handleFiltersUpdate(\"assignees\", val)}\n+                  memberIds={memberIds}\n+                  searchQuery={filtersSearchQuery}\n+                />\n+              </div>\n+            )}\n+\n+            {/* Start Date */}\n+            {isFilterEnabled(\"start_date\") && (\n+              <div className=\"py-2\">\n+                <FilterStartDate\n+                  appliedFilters={filters.start_date ?? null}\n+                  handleUpdate={(val) => handleFiltersUpdate(\"start_date\", val)}\n+                  searchQuery={filtersSearchQuery}\n+                />\n+              </div>\n+            )}\n+\n+            {/* Target Date */}\n+            {isFilterEnabled(\"target_date\") && (\n+              <div className=\"py-2\">\n+                <FilterDueDate\n+                  appliedFilters={filters.target_date ?? null}\n+                  handleUpdate={(val) => handleFiltersUpdate(\"target_date\", val)}\n+                  searchQuery={filtersSearchQuery}\n+                />\n+              </div>\n+            )}\n+          </div>\n+        </div>\n+      </FiltersDropdown>\n+    </>\n+  );\n+});\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/list-group.tsx",
          "status": "added",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/list-group.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/list-group.tsx\t39b5736 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/list-group.tsx\te401c9d (commit)\n@@ -0,0 +1,96 @@\n+import { FC, useState } from \"react\";\n+import { observer } from \"mobx-react\";\n+import { ChevronRight, CircleDashed } from \"lucide-react\";\n+import { ALL_ISSUES, EIssuesStoreType } from \"@plane/constants\";\n+import { IGroupByColumn, TIssue, TIssueServiceType, TSubIssueOperations } from \"@plane/types\";\n+import { Collapsible } from \"@plane/ui\";\n+import { cn } from \"@plane/utils\";\n+import { SubIssuesListItem } from \"./list-item\";\n+\n+interface TSubIssuesListGroupProps {\n+  workItemIds: string[];\n+  projectId: string;\n+  workspaceSlug: string;\n+  group: IGroupByColumn;\n+  serviceType: TIssueServiceType;\n+  disabled: boolean;\n+  parentIssueId: string;\n+  handleIssueCrudState: (\n+    key: \"create\" | \"existing\" | \"update\" | \"delete\",\n+    issueId: string,\n+    issue?: TIssue | null\n+  ) => void;\n+  subIssueOperations: TSubIssueOperations;\n+  storeType?: EIssuesStoreType;\n+  spacingLeft?: number;\n+}\n+\n+export const SubIssuesListGroup: FC<TSubIssuesListGroupProps> = observer((props) => {\n+  const {\n+    group,\n+    serviceType,\n+    disabled,\n+    parentIssueId,\n+    projectId,\n+    workspaceSlug,\n+    handleIssueCrudState,\n+    subIssueOperations,\n+    workItemIds,\n+    storeType = EIssuesStoreType.PROJECT,\n+    spacingLeft = 0,\n+  } = props;\n+\n+  const isAllIssues = group.id === ALL_ISSUES;\n+\n+  // states\n+  const [isCollapsibleOpen, setIsCollapsibleOpen] = useState(isAllIssues);\n+\n+  if (!workItemIds.length) return null;\n+\n+  return (\n+    <>\n+      <Collapsible\n+        isOpen={isCollapsibleOpen}\n+        onToggle={() => setIsCollapsibleOpen(!isCollapsibleOpen)}\n+        title={\n+          !isAllIssues && (\n+            <div className=\"flex items-center gap-2 p-3\">\n+              <ChevronRight\n+                className={cn(\"size-3.5 transition-all text-custom-text-400\", {\n+                  \"rotate-90\": isCollapsibleOpen,\n+                })}\n+                strokeWidth={2.5}\n+              />\n+              <div className=\"flex-shrink-0 grid place-items-center overflow-hidden\">\n+                {group.icon ?? <CircleDashed className=\"size-3.5\" strokeWidth={2} />}\n+              </div>\n+              <span className=\"text-sm text-custom-text-100 font-medium\">{group.name}</span>\n+              <span className=\"text-sm text-custom-text-400\">{workItemIds.length}</span>\n+            </div>\n+          )\n+        }\n+        buttonClassName={cn(\"hidden\", !isAllIssues && \"block\")}\n+      >\n+        {/* Work items list */}\n+        <div className=\"pl-2\">\n+          {workItemIds?.map((workItemId) => (\n+            <SubIssuesListItem\n+              key={workItemId}\n+              workspaceSlug={workspaceSlug}\n+              projectId={projectId}\n+              parentIssueId={parentIssueId}\n+              rootIssueId={parentIssueId}\n+              issueId={workItemId}\n+              disabled={disabled}\n+              handleIssueCrudState={handleIssueCrudState}\n+              subIssueOperations={subIssueOperations}\n+              issueServiceType={serviceType}\n+              spacingLeft={spacingLeft}\n+              storeType={storeType}\n+            />\n+          ))}\n+        </div>\n+      </Collapsible>\n+    </>\n+  );\n+});\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/list-item.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/list-item.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/list-item.tsx\t39b5736 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/list-item.tsx\te401c9d (commit)\n@@ -2,9 +2,9 @@\n \n import { observer } from \"mobx-react\";\n import { ChevronRight, X, Pencil, Trash, Link as LinkIcon, Loader } from \"lucide-react\";\n // plane imports\n-import { EIssueServiceType } from \"@plane/constants\";\n+import { EIssueServiceType, EIssuesStoreType } from \"@plane/constants\";\n import { useTranslation } from \"@plane/i18n\";\n import { TIssue, TIssueServiceType, TSubIssueOperations } from \"@plane/types\";\n import { ControlLink, CustomMenu, Tooltip } from \"@plane/ui\";\n // helpers\n@@ -36,8 +36,9 @@\n   ) => void;\n   subIssueOperations: TSubIssueOperations;\n   issueId: string;\n   issueServiceType?: TIssueServiceType;\n+  storeType?: EIssuesStoreType;\n };\n \n export const SubIssuesListItem: React.FC<Props> = observer((props) => {\n   const {\n@@ -50,8 +51,9 @@\n     disabled,\n     handleIssueCrudState,\n     subIssueOperations,\n     issueServiceType = EIssueServiceType.ISSUES,\n+    storeType = EIssuesStoreType.PROJECT,\n   } = props;\n   const { t } = useTranslation();\n   const {\n     issue: { getIssueById },\n@@ -80,9 +82,9 @@\n   const subIssueCount = issue?.sub_issues_count ?? 0;\n \n   // derived values\n   const subIssueFilters = getSubIssueFilters(parentIssueId);\n-  const displayProperties = subIssueFilters.displayProperties ?? {};\n+  const displayProperties = subIssueFilters?.displayProperties ?? {};\n \n   //\n   const handleIssuePeekOverview = (issue: TIssue) => handleRedirection(workspaceSlug, issue, isMobile);\n \n@@ -264,8 +266,9 @@\n         issue.project_id &&\n         subIssueCount > 0 &&\n         !isCurrentIssueRoot && (\n           <SubIssuesListRoot\n+            storeType={storeType}\n             workspaceSlug={workspaceSlug}\n             projectId={issue.project_id}\n             parentIssueId={issue.id}\n             rootIssueId={rootIssueId}\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/properties.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/properties.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/properties.tsx\t39b5736 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/properties.tsx\te401c9d (commit)\n@@ -42,103 +42,103 @@\n   const maxDate = getDate(issue.target_date);\n   maxDate?.setDate(maxDate.getDate());\n   return (\n     <div className=\"relative flex items-center gap-2\">\n-      <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"start_date\">\n-        <div className=\"h-5 flex-shrink-0\" onFocus={handleEventPropagation} onClick={handleEventPropagation}>\n-          <DateDropdown\n-            value={issue.start_date ?? null}\n+      <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"state\">\n+        <div className=\"h-5 flex-shrink-0\">\n+          <StateDropdown\n+            value={issue.state_id}\n+            projectId={issue.project_id ?? undefined}\n             onChange={(val) =>\n               issue.project_id &&\n               updateSubIssue(\n                 workspaceSlug,\n                 issue.project_id,\n                 parentIssueId,\n                 issueId,\n                 {\n-                  start_date: val ? renderFormattedPayloadDate(val) : null,\n+                  state_id: val,\n                 },\n                 { ...issue }\n               )\n             }\n-            maxDate={maxDate}\n-            placeholder={t(\"common.order_by.start_date\")}\n-            icon={<CalendarClock className=\"h-3 w-3 flex-shrink-0\" />}\n-            buttonVariant={issue.start_date ? \"border-with-text\" : \"border-without-text\"}\n-            optionsClassName=\"z-30\"\n             disabled={!disabled}\n+            buttonVariant=\"border-with-text\"\n           />\n         </div>\n       </WithDisplayPropertiesHOC>\n \n-      <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"due_date\">\n+      <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"priority\">\n+        <div className=\"h-5 flex-shrink-0\">\n+          <PriorityDropdown\n+            value={issue.priority}\n+            onChange={(val) =>\n+              issue.project_id &&\n+              updateSubIssue(workspaceSlug, issue.project_id, parentIssueId, issueId, {\n+                priority: val,\n+              })\n+            }\n+            disabled={!disabled}\n+            buttonVariant=\"border-without-text\"\n+            buttonClassName=\"border\"\n+          />\n+        </div>\n+      </WithDisplayPropertiesHOC>\n+\n+      <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"start_date\">\n         <div className=\"h-5 flex-shrink-0\" onFocus={handleEventPropagation} onClick={handleEventPropagation}>\n           <DateDropdown\n-            value={issue.target_date ?? null}\n+            value={issue.start_date ?? null}\n             onChange={(val) =>\n               issue.project_id &&\n               updateSubIssue(\n                 workspaceSlug,\n                 issue.project_id,\n                 parentIssueId,\n                 issueId,\n                 {\n-                  target_date: val ? renderFormattedPayloadDate(val) : null,\n+                  start_date: val ? renderFormattedPayloadDate(val) : null,\n                 },\n                 { ...issue }\n               )\n             }\n             maxDate={maxDate}\n-            placeholder={t(\"common.order_by.due_date\")}\n+            placeholder={t(\"common.order_by.start_date\")}\n             icon={<CalendarClock className=\"h-3 w-3 flex-shrink-0\" />}\n-            buttonVariant={issue.target_date ? \"border-with-text\" : \"border-without-text\"}\n+            buttonVariant={issue.start_date ? \"border-with-text\" : \"border-without-text\"}\n             optionsClassName=\"z-30\"\n             disabled={!disabled}\n           />\n         </div>\n       </WithDisplayPropertiesHOC>\n \n-      <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"state\">\n-        <div className=\"h-5 flex-shrink-0\">\n-          <StateDropdown\n-            value={issue.state_id}\n-            projectId={issue.project_id ?? undefined}\n+      <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"due_date\">\n+        <div className=\"h-5 flex-shrink-0\" onFocus={handleEventPropagation} onClick={handleEventPropagation}>\n+          <DateDropdown\n+            value={issue.target_date ?? null}\n             onChange={(val) =>\n               issue.project_id &&\n               updateSubIssue(\n                 workspaceSlug,\n                 issue.project_id,\n                 parentIssueId,\n                 issueId,\n                 {\n-                  state_id: val,\n+                  target_date: val ? renderFormattedPayloadDate(val) : null,\n                 },\n                 { ...issue }\n               )\n             }\n+            maxDate={maxDate}\n+            placeholder={t(\"common.order_by.due_date\")}\n+            icon={<CalendarClock className=\"h-3 w-3 flex-shrink-0\" />}\n+            buttonVariant={issue.target_date ? \"border-with-text\" : \"border-without-text\"}\n+            optionsClassName=\"z-30\"\n             disabled={!disabled}\n-            buttonVariant=\"border-with-text\"\n           />\n         </div>\n       </WithDisplayPropertiesHOC>\n \n-      <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"priority\">\n-        <div className=\"h-5 flex-shrink-0\">\n-          <PriorityDropdown\n-            value={issue.priority}\n-            onChange={(val) =>\n-              issue.project_id &&\n-              updateSubIssue(workspaceSlug, issue.project_id, parentIssueId, issueId, {\n-                priority: val,\n-              })\n-            }\n-            disabled={!disabled}\n-            buttonVariant=\"border-without-text\"\n-            buttonClassName=\"border\"\n-          />\n-        </div>\n-      </WithDisplayPropertiesHOC>\n-\n       <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"assignee\">\n         <div className=\"h-5 flex-shrink-0\">\n           <MemberDropdown\n             value={issue.assignee_ids}\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/root.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/root.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/root.tsx\t39b5736 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/root.tsx\te401c9d (commit)\n@@ -1,13 +1,17 @@\n+import { useCallback, useMemo } from \"react\";\n import { observer } from \"mobx-react\";\n // plane imports\n-import { EIssueServiceType } from \"@plane/constants\";\n-import { TIssue, TIssueServiceType, TSubIssueOperations } from \"@plane/types\";\n+import { ListFilter } from \"lucide-react\";\n+import { EIssueServiceType, EIssuesStoreType } from \"@plane/constants\";\n+import { GroupByColumnTypes, TIssue, TIssueServiceType, TSubIssueOperations } from \"@plane/types\";\n // hooks\n+import { Button } from \"@plane/ui\";\n+import { SectionEmptyState } from \"@/components/empty-state\";\n+import { getGroupByColumns, isWorkspaceLevel } from \"@/components/issues/issue-layouts/utils\";\n import { useIssueDetail } from \"@/hooks/store\";\n-// local imports\n-import { SubIssuesListItem } from \"./list-item\";\n \n+import { SubIssuesListGroup } from \"./list-group\";\n type Props = {\n   workspaceSlug: string;\n   projectId: string;\n   parentIssueId: string;\n@@ -20,45 +24,99 @@\n     issue?: TIssue | null\n   ) => void;\n   subIssueOperations: TSubIssueOperations;\n   issueServiceType?: TIssueServiceType;\n+  storeType: EIssuesStoreType;\n };\n \n export const SubIssuesListRoot: React.FC<Props> = observer((props) => {\n   const {\n     workspaceSlug,\n     projectId,\n     parentIssueId,\n     rootIssueId,\n-    spacingLeft = 10,\n     disabled,\n     handleIssueCrudState,\n     subIssueOperations,\n     issueServiceType = EIssueServiceType.ISSUES,\n+    storeType = EIssuesStoreType.PROJECT,\n+    spacingLeft = 0,\n   } = props;\n   // store hooks\n   const {\n-    subIssues: { subIssuesByIssueId },\n+    subIssues: {\n+      subIssuesByIssueId,\n+      filters: { getSubIssueFilters, getGroupedSubWorkItems, getFilteredSubWorkItems, resetFilters },\n+    },\n   } = useIssueDetail(issueServiceType);\n+\n   // derived values\n-  const subIssueIds = subIssuesByIssueId(parentIssueId);\n+  const filters = getSubIssueFilters(parentIssueId);\n+  const isRootLevel = useMemo(() => rootIssueId === parentIssueId, [rootIssueId, parentIssueId]);\n+  const group_by = isRootLevel ? (filters?.displayFilters?.group_by ?? null) : null;\n+  const filteredSubWorkItemsCount = (getFilteredSubWorkItems(rootIssueId, filters.filters ?? {}) ?? []).length;\n \n+  const groups = getGroupByColumns({\n+    groupBy: group_by as GroupByColumnTypes,\n+    includeNone: true,\n+    isWorkspaceLevel: isWorkspaceLevel(storeType),\n+    isEpic: issueServiceType === EIssueServiceType.EPICS,\n+    projectId,\n+  });\n+\n+  const getWorkItemIds = useCallback(\n+    (groupId: string) => {\n+      if (isRootLevel) {\n+        const groupedSubIssues = getGroupedSubWorkItems(parentIssueId);\n+        return groupedSubIssues?.[groupId] ?? [];\n+      }\n+      const subIssueIds = subIssuesByIssueId(parentIssueId);\n+      return subIssueIds ?? [];\n+    },\n+    [isRootLevel, subIssuesByIssueId, parentIssueId, getGroupedSubWorkItems]\n+  );\n+\n+  const isSubWorkItems = issueServiceType === EIssueServiceType.ISSUES;\n+\n   return (\n     <div className=\"relative\">\n-      {subIssueIds?.map((issueId) => (\n-        <SubIssuesListItem\n-          key={issueId}\n-          workspaceSlug={workspaceSlug}\n-          projectId={projectId}\n-          parentIssueId={parentIssueId}\n-          rootIssueId={rootIssueId}\n-          issueId={issueId}\n-          spacingLeft={spacingLeft}\n-          disabled={disabled}\n-          handleIssueCrudState={handleIssueCrudState}\n-          subIssueOperations={subIssueOperations}\n-          issueServiceType={issueServiceType}\n+      {filteredSubWorkItemsCount > 0 ? (\n+        groups?.map((group) => (\n+          <SubIssuesListGroup\n+            key={group.id}\n+            workItemIds={getWorkItemIds(group.id)}\n+            projectId={projectId}\n+            workspaceSlug={workspaceSlug}\n+            group={group}\n+            serviceType={issueServiceType}\n+            disabled={disabled}\n+            parentIssueId={parentIssueId}\n+            handleIssueCrudState={handleIssueCrudState}\n+            subIssueOperations={subIssueOperations}\n+            storeType={storeType}\n+            spacingLeft={spacingLeft}\n+          />\n+        ))\n+      ) : (\n+        <SectionEmptyState\n+          title={\n+            !isSubWorkItems\n+              ? \"You don't have work items that match the filters you've applied.\"\n+              : \"You don't have sub-work items that match the filters you've applied.\"\n+          }\n+          description={\n+            !isSubWorkItems\n+              ? \"To see all work items, clear all applied filters.\"\n+              : \"To see all sub-work items, clear all applied filters.\"\n+          }\n+          icon={<ListFilter />}\n+          customClassName={storeType !== EIssuesStoreType.EPIC ? \"border-none\" : \"\"}\n+          actionElement={\n+            <Button variant=\"neutral-primary\" size=\"sm\" onClick={() => resetFilters(rootIssueId)}>\n+              Clear filters\n+            </Button>\n+          }\n         />\n-      ))}\n+      )}\n     </div>\n   );\n });\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/title-actions.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/title-actions.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/title-actions.tsx\t39b5736 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/title-actions.tsx\te401c9d (commit)\n@@ -1,67 +1,105 @@\n import { FC, useCallback } from \"react\";\n+import cloneDeep from \"lodash/cloneDeep\";\n import { observer } from \"mobx-react\";\n import { EIssueFilterType, EIssueServiceType, ISSUE_DISPLAY_FILTERS_BY_PAGE } from \"@plane/constants\";\n-import { IIssueDisplayFilterOptions, IIssueDisplayProperties, TIssueServiceType } from \"@plane/types\";\n-import { useIssueDetail } from \"@/hooks/store\";\n+import {\n+  IIssueDisplayFilterOptions,\n+  IIssueDisplayProperties,\n+  IIssueFilterOptions,\n+  TIssueServiceType,\n+} from \"@plane/types\";\n+import { useIssueDetail, useMember, useProjectState } from \"@/hooks/store\";\n import { SubIssueDisplayFilters } from \"./display-filters\";\n+import { SubIssueFilters } from \"./filters\";\n import { SubIssuesActionButton } from \"./quick-action-button\";\n \n type TSubWorkItemTitleActionsProps = {\n   disabled: boolean;\n   issueServiceType?: TIssueServiceType;\n   parentId: string;\n-  workspaceSlug: string;\n   projectId: string;\n };\n \n export const SubWorkItemTitleActions: FC<TSubWorkItemTitleActionsProps> = observer((props) => {\n-  const { disabled, issueServiceType = EIssueServiceType.ISSUES, parentId, workspaceSlug, projectId } = props;\n+  const { disabled, issueServiceType = EIssueServiceType.ISSUES, parentId, projectId } = props;\n \n   // store hooks\n   const {\n     subIssues: {\n-      filters: { getSubIssueFilters, updateSubIssueFilters },\n+      filters: { getSubIssueFilters, updateSubWorkItemFilters },\n     },\n   } = useIssueDetail(issueServiceType);\n+  const { getProjectStates } = useProjectState();\n+  const {\n+    project: { getProjectMemberIds },\n+  } = useMember();\n \n   // derived values\n   const subIssueFilters = getSubIssueFilters(parentId);\n+  const projectStates = getProjectStates(projectId);\n+  const projectMemberIds = getProjectMemberIds(projectId, false);\n \n   const layoutDisplayFiltersOptions = ISSUE_DISPLAY_FILTERS_BY_PAGE[\"sub_work_items\"].list;\n \n   const handleDisplayFilters = useCallback(\n     (updatedDisplayFilter: Partial<IIssueDisplayFilterOptions>) => {\n-      if (!workspaceSlug || !projectId) return;\n-      updateSubIssueFilters(workspaceSlug, projectId, EIssueFilterType.DISPLAY_FILTERS, updatedDisplayFilter, parentId);\n+      updateSubWorkItemFilters(EIssueFilterType.DISPLAY_FILTERS, updatedDisplayFilter, parentId);\n     },\n-    [workspaceSlug, projectId, parentId, updateSubIssueFilters]\n+    [updateSubWorkItemFilters, parentId]\n   );\n \n   const handleDisplayPropertiesUpdate = useCallback(\n     (updatedDisplayProperties: Partial<IIssueDisplayProperties>) => {\n-      if (!workspaceSlug || !projectId) return;\n-      updateSubIssueFilters(\n-        workspaceSlug,\n-        projectId,\n-        EIssueFilterType.DISPLAY_PROPERTIES,\n-        updatedDisplayProperties,\n-        parentId\n-      );\n+      updateSubWorkItemFilters(EIssueFilterType.DISPLAY_PROPERTIES, updatedDisplayProperties, parentId);\n     },\n-    [workspaceSlug, projectId, parentId, updateSubIssueFilters]\n+    [updateSubWorkItemFilters, parentId]\n   );\n \n+  const handleFiltersUpdate = useCallback(\n+    (key: keyof IIssueFilterOptions, value: string | string[]) => {\n+      const newValues = cloneDeep(subIssueFilters?.filters?.[key]) ?? [];\n+\n+      if (Array.isArray(value)) {\n+        // this validation is majorly for the filter start_date, target_date custom\n+        value.forEach((val) => {\n+          if (!newValues.includes(val)) newValues.push(val);\n+          else newValues.splice(newValues.indexOf(val), 1);\n+        });\n+      } else {\n+        if (subIssueFilters?.filters?.[key]?.includes(value)) newValues.splice(newValues.indexOf(value), 1);\n+        else newValues.push(value);\n+      }\n+\n+      updateSubWorkItemFilters(EIssueFilterType.FILTERS, { [key]: newValues }, parentId);\n+    },\n+    [subIssueFilters?.filters, updateSubWorkItemFilters, parentId]\n+  );\n+\n   return (\n-    <div className=\"flex items-center gap-2\">\n+    // prevent click everywhere\n+    <div\n+      className=\"flex gap-2 items-center\"\n+      onClick={(e) => {\n+        e.stopPropagation();\n+        e.preventDefault();\n+      }}\n+    >\n       <SubIssueDisplayFilters\n         isEpic={issueServiceType === EIssueServiceType.EPICS}\n         layoutDisplayFiltersOptions={layoutDisplayFiltersOptions}\n         displayProperties={subIssueFilters?.displayProperties ?? {}}\n         displayFilters={subIssueFilters?.displayFilters ?? {}}\n         handleDisplayPropertiesUpdate={handleDisplayPropertiesUpdate}\n         handleDisplayFiltersUpdate={handleDisplayFilters}\n       />\n+      <SubIssueFilters\n+        handleFiltersUpdate={handleFiltersUpdate}\n+        filters={subIssueFilters?.filters ?? {}}\n+        memberIds={projectMemberIds ?? undefined}\n+        states={projectStates}\n+        layoutDisplayFiltersOptions={layoutDisplayFiltersOptions}\n+      />\n       {!disabled && (\n         <SubIssuesActionButton issueId={parentId} disabled={disabled} issueServiceType={issueServiceType} />\n       )}\n     </div>\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/title.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/title.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/title.tsx\t39b5736 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/title.tsx\te401c9d (commit)\n@@ -32,12 +32,9 @@\n   // translation\n   const { t } = useTranslation();\n   // store hooks\n   const {\n-    subIssues: {\n-      subIssuesByIssueId,\n-      stateDistributionByIssueId,\n-    },\n+    subIssues: { subIssuesByIssueId, stateDistributionByIssueId },\n   } = useIssueDetail(issueServiceType);\n   // derived values\n   const subIssuesDistribution = stateDistributionByIssueId(parentIssueId);\n   const subIssues = subIssuesByIssueId(parentIssueId);\n@@ -62,9 +59,8 @@\n         </div>\n       }\n       actionItemElement={\n         <SubWorkItemTitleActions\n-          workspaceSlug={workspaceSlug}\n           projectId={projectId}\n           parentId={parentIssueId}\n           disabled={disabled}\n           issueServiceType={issueServiceType}\n"
        },
        {
          "path": "web/core/components/issues/issue-layouts/utils.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-layouts/utils.tsx\n===================================================================\n--- web/core/components/issues/issue-layouts/utils.tsx\t39b5736 (parent)\n+++ web/core/components/issues/issue-layouts/utils.tsx\te401c9d (commit)\n@@ -1,8 +1,9 @@\n \"use client\";\n \n import { CSSProperties, FC } from \"react\";\n import { extractInstruction } from \"@atlaskit/pragmatic-drag-and-drop-hitbox/tree-item\";\n+import { isEmpty } from \"lodash\";\n import clone from \"lodash/clone\";\n import concat from \"lodash/concat\";\n import isEqual from \"lodash/isEqual\";\n import isNil from \"lodash/isNil\";\n@@ -24,8 +25,9 @@\n   IIssueFilters,\n   IProjectView,\n   TGroupedIssues,\n   IWorkspaceView,\n+  IIssueDisplayFilterOptions,\n } from \"@plane/types\";\n // plane ui\n import { Avatar, CycleGroupIcon, DiceIcon, ISvgIcons, PriorityIcon, StateGroupIcon } from \"@plane/ui\";\n // components\n@@ -38,8 +40,9 @@\n // plane web store\n import { getTeamProjectColumns, SpreadSheetPropertyIconMap } from \"@/plane-web/components/issues/issue-layouts/utils\";\n // store\n import { ISSUE_FILTER_DEFAULT_DATA } from \"@/store/issue/helpers/base-issues.store\";\n+import { DEFAULT_DISPLAY_PROPERTIES } from \"@/store/issue/issue-details/sub_issues_filter.store\";\n \n export const HIGHLIGHT_CLASS = \"highlight\";\n export const HIGHLIGHT_WITH_LINE = \"highlight-with-line\";\n \n@@ -57,16 +60,22 @@\n     REMOVE: string[];\n   };\n };\n \n+type TGetColumns = {\n+  isWorkspaceLevel?: boolean;\n+  projectId?: string;\n+};\n+\n export const isWorkspaceLevel = (type: EIssuesStoreType) =>\n   [EIssuesStoreType.PROFILE, EIssuesStoreType.GLOBAL].includes(type) ? true : false;\n \n type TGetGroupByColumns = {\n   groupBy: GroupByColumnTypes | null;\n   includeNone: boolean;\n   isWorkspaceLevel: boolean;\n   isEpic?: boolean;\n+  projectId?: string;\n };\n \n // NOTE: Type of groupBy is different compared to what's being passed from the components.\n // We are using `as` to typecast it to the expected type.\n@@ -75,8 +84,9 @@\n   groupBy,\n   includeNone,\n   isWorkspaceLevel,\n   isEpic = false,\n+  projectId,\n }: TGetGroupByColumns): IGroupByColumn[] | undefined => {\n   // If no groupBy is specified and includeNone is true, return \"All Issues\" group\n   if (!groupBy && includeNone) {\n     return [\n@@ -92,23 +102,26 @@\n   // Return undefined if no valid groupBy\n   if (!groupBy) return undefined;\n \n   // Map of group by options to their corresponding column getter functions\n-  const groupByColumnMap: Record<GroupByColumnTypes, () => IGroupByColumn[] | undefined> = {\n+  const groupByColumnMap: Record<\n+    GroupByColumnTypes,\n+    ({ isWorkspaceLevel, projectId }: TGetColumns) => IGroupByColumn[] | undefined\n+  > = {\n     project: getProjectColumns,\n     cycle: getCycleColumns,\n     module: getModuleColumns,\n     state: getStateColumns,\n     \"state_detail.group\": getStateGroupColumns,\n     priority: getPriorityColumns,\n-    labels: () => getLabelsColumns(isWorkspaceLevel),\n+    labels: getLabelsColumns,\n     assignees: getAssigneeColumns,\n     created_by: getCreatedByColumns,\n     team_project: getTeamProjectColumns,\n   };\n \n   // Get and return the columns for the specified group by option\n-  return groupByColumnMap[groupBy]?.();\n+  return groupByColumnMap[groupBy]?.({ isWorkspaceLevel, projectId });\n };\n \n const getProjectColumns = (): IGroupByColumn[] | undefined => {\n   const { joinedProjectIds: projectIds, projectMap } = store.projectRoot.project;\n@@ -189,13 +202,14 @@\n   });\n   return modules;\n };\n \n-const getStateColumns = (): IGroupByColumn[] | undefined => {\n-  const { projectStates } = store.state;\n-  if (!projectStates) return;\n+const getStateColumns = ({ projectId }: TGetColumns): IGroupByColumn[] | undefined => {\n+  const { getProjectStates, projectStates } = store.state;\n+  const _states = projectId ? getProjectStates(projectId) : projectStates;\n+  if (!_states) return;\n   // map project states to group by columns\n-  return projectStates.map((state) => ({\n+  return _states.map((state) => ({\n     id: state.id,\n     name: state.name,\n     icon: (\n       <div className=\"size-4 rounded-full\">\n@@ -231,9 +245,9 @@\n     payload: { priority: priority.key },\n   }));\n };\n \n-const getLabelsColumns = (isWorkspaceLevel: boolean = false): IGroupByColumn[] => {\n+const getLabelsColumns = ({ isWorkspaceLevel }: TGetColumns): IGroupByColumn[] => {\n   const { workspaceLabels, projectLabels } = store.label;\n   // map labels to group by columns\n   const labels = [\n     ...(isWorkspaceLevel ? workspaceLabels || [] : projectLabels || []),\n@@ -249,24 +263,42 @@\n     payload: label?.id === \"None\" ? {} : { label_ids: [label.id] },\n   }));\n };\n \n-const getAssigneeColumns = (): IGroupByColumn[] | undefined => {\n+const getAssigneeColumns = ({ isWorkspaceLevel, projectId }: TGetColumns): IGroupByColumn[] | undefined => {\n+  const assigneeColumns: IGroupByColumn[] = [];\n   const {\n-    project: { projectMemberIds },\n+    project: { projectMemberIds, getProjectMemberIds },\n     getUserDetails,\n   } = store.memberRoot;\n-  if (!projectMemberIds) return;\n-  // Map project member ids to group by assignee columns\n-  const assigneeColumns: IGroupByColumn[] = projectMemberIds.map((memberId) => {\n-    const member = getUserDetails(memberId);\n-    return {\n-      id: memberId,\n-      name: member?.display_name || \"\",\n-      icon: <Avatar name={member?.display_name} src={getFileURL(member?.avatar_url ?? \"\")} size=\"md\" />,\n-      payload: { assignee_ids: [memberId] },\n-    };\n-  });\n+  // if workspace level\n+  if (isWorkspaceLevel) {\n+    const { workspaceMemberIds } = store.memberRoot.workspace;\n+    if (!workspaceMemberIds) return;\n+    workspaceMemberIds.forEach((memberId) => {\n+      const member = getUserDetails(memberId);\n+      assigneeColumns.push({\n+        id: memberId,\n+        name: member?.display_name || \"\",\n+        icon: <Avatar name={member?.display_name} src={getFileURL(member?.avatar_url ?? \"\")} size=\"md\" />,\n+        payload: { assignee_ids: [memberId] },\n+      });\n+    });\n+  } else {\n+    // if project level\n+    const _projectMemberIds = projectId ? getProjectMemberIds(projectId, false) : projectMemberIds;\n+    if (!_projectMemberIds) return;\n+    // Map project member ids to group by assignee columns\n+    _projectMemberIds.forEach((memberId) => {\n+      const member = getUserDetails(memberId);\n+      assigneeColumns.push({\n+        id: memberId,\n+        name: member?.display_name || \"\",\n+        icon: <Avatar name={member?.display_name} src={getFileURL(member?.avatar_url ?? \"\")} size=\"md\" />,\n+        payload: { assignee_ids: [memberId] },\n+      });\n+    });\n+  }\n   assigneeColumns.push({ id: \"None\", name: \"None\", icon: <Avatar size=\"md\" />, payload: {} });\n   return assigneeColumns;\n };\n \n@@ -718,4 +750,38 @@\n   const Icon = SpreadSheetPropertyIconMap[iconKey];\n   if (!Icon) return null;\n   return <Icon {...props} />;\n };\n+\n+/**\n+ * This method returns if the filters are applied\n+ * @param filters\n+ * @returns\n+ */\n+export const isDisplayFiltersApplied = (filters: Partial<IIssueFilters>): boolean => {\n+  const isDisplayPropertiesApplied = Object.keys(DEFAULT_DISPLAY_PROPERTIES).some(\n+    (key) => !filters.displayProperties?.[key as keyof IIssueDisplayProperties]\n+  );\n+\n+  const isDisplayFiltersApplied = Object.keys(filters.displayFilters ?? {}).some((key) => {\n+    const value = filters.displayFilters?.[key as keyof IIssueDisplayFilterOptions];\n+    if (!value) return false;\n+    // -create_at is the default order\n+    if (key === \"order_by\") {\n+      return value !== \"-created_at\";\n+    }\n+    return true;\n+  });\n+\n+  return isDisplayPropertiesApplied || isDisplayFiltersApplied;\n+};\n+\n+/**\n+ * This method returns if the filters are applied\n+ * @param filters\n+ * @returns\n+ */\n+export const isFiltersApplied = (filters: IIssueFilterOptions): boolean =>\n+  Object.values(filters).some((value) => {\n+    if (Array.isArray(value)) return value.length > 0;\n+    return value !== undefined && value !== null && value !== \"\";\n+  });\n"
        },
        {
          "path": "web/core/store/issue/helpers/base-issues-utils.ts",
          "status": "modified",
          "diff": "Index: web/core/store/issue/helpers/base-issues-utils.ts\n===================================================================\n--- web/core/store/issue/helpers/base-issues-utils.ts\t39b5736 (parent)\n+++ web/core/store/issue/helpers/base-issues-utils.ts\te401c9d (commit)\n@@ -1,9 +1,25 @@\n+import cloneDeep from \"lodash/cloneDeep\";\n+import groupBy from \"lodash/groupBy\";\n+import indexOf from \"lodash/indexOf\";\n import isEmpty from \"lodash/isEmpty\";\n+import orderBy from \"lodash/orderBy\";\n+import set from \"lodash/set\";\n import uniq from \"lodash/uniq\";\n-import { ALL_ISSUES } from \"@plane/constants\";\n-import { TIssue } from \"@plane/types\";\n-import { EIssueGroupedAction } from \"./base-issues.store\";\n+import { runInAction } from \"mobx\";\n+import { ALL_ISSUES, EIssueFilterType, FILTER_TO_ISSUE_MAP, ISSUE_PRIORITIES } from \"@plane/constants\";\n+import {\n+  IIssueDisplayFilterOptions,\n+  IIssueDisplayProperties,\n+  IIssueFilterOptions,\n+  IIssueFilters,\n+  TIssue,\n+  TIssueGroupByOptions,\n+  TIssueOrderByOptions,\n+} from \"@plane/types\";\n+import { checkDateCriteria, convertToISODateString, parseDateFilter } from \"@/helpers/date-time.helper\";\n+import { store } from \"@/lib/store-context\";\n+import { EIssueGroupedAction, ISSUE_GROUP_BY_KEY } from \"./base-issues.store\";\n \n /**\n  * returns,\n  * A compound key, if both groupId & subGroupId are defined\n@@ -172,4 +188,193 @@\n };\n \n // get IssueIds from Issue data List\n export const getIssueIds = (issues: TIssue[]) => issues.map((issue) => issue?.id);\n+\n+/**\n+ * Checks if an issue meets the date filter criteria\n+ * @param issue The issue to check\n+ * @param filterKey The date field to check ('start_date' or 'target_date')\n+ * @param dateFilters Array of date filter strings\n+ * @returns boolean indicating if the issue meets the date criteria\n+ */\n+export const checkIssueDateFilter = (\n+  issue: TIssue,\n+  filterKey: \"start_date\" | \"target_date\",\n+  dateFilters: string[]\n+): boolean => {\n+  if (!dateFilters || dateFilters.length === 0) return true;\n+\n+  const issueDate = issue[filterKey];\n+  if (!issueDate) return false;\n+\n+  // Issue should match all the date filters (AND operation)\n+  return dateFilters.every((filterValue) => {\n+    const parsed = parseDateFilter(filterValue);\n+    if (!parsed?.date || !parsed?.type) {\n+      // ignore invalid filter instead of failing the whole evaluation\n+      console.warn(`[filters] Ignoring unparsable date filter \"${filterValue}\"`);\n+      return true;\n+    }\n+    return checkDateCriteria(new Date(issueDate), parsed.date, parsed.type);\n+  });\n+};\n+\n+/**\n+ * Helper method to get previous issues state\n+ * @param issues - The array of issues to get the previous state for.\n+ * @returns The previous state of the issues.\n+ */\n+export const getPreviousIssuesState = (issues: TIssue[]) => {\n+  const issueIds = issues.map((issue) => issue.id);\n+  const issuesPreviousState: Record<string, TIssue> = {};\n+  issueIds.forEach((issueId) => {\n+    if (store.issue.issues.issuesMap[issueId]) {\n+      issuesPreviousState[issueId] = cloneDeep(store.issue.issues.issuesMap[issueId]);\n+    }\n+  });\n+  return issuesPreviousState;\n+};\n+\n+/**\n+ * Filters the given work items based on the provided filters and display filters.\n+ * @param work items - The array of work items to be filtered.\n+ * @param filters - The filters to be applied to the issues.\n+ * @param displayFilters - The display filters to be applied to the issues.\n+ * @returns The filtered array of issues.\n+ */\n+export const getFilteredWorkItems = (workItems: TIssue[], filters: IIssueFilterOptions | undefined): TIssue[] => {\n+  if (!filters) return workItems;\n+  // Get all active filters\n+  const activeFilters = Object.entries(filters).filter(([, value]) => value && value.length > 0);\n+  // If no active filters, return all issues\n+  if (activeFilters.length === 0) {\n+    return workItems;\n+  }\n+\n+  return workItems.filter((workItem) =>\n+    // Check all filter conditions (AND operation between different filters)\n+    activeFilters.every(([filterKey, filterValues]) => {\n+      // Handle date filters separately\n+      if (filterKey === \"start_date\" || filterKey === \"target_date\") {\n+        return checkIssueDateFilter(workItem, filterKey as \"start_date\" | \"target_date\", filterValues as string[]);\n+      }\n+      // Handle regular filters\n+      const issueKey = FILTER_TO_ISSUE_MAP[filterKey as keyof IIssueFilterOptions];\n+      if (!issueKey) return true; // Skip if no mapping exists\n+      const issueValue = workItem[issueKey as keyof TIssue];\n+      // Handle array-based properties vs single value properties\n+      if (Array.isArray(issueValue)) {\n+        return filterValues!.some((filterValue: any) => issueValue.includes(filterValue));\n+      } else {\n+        return filterValues!.includes(issueValue as string);\n+      }\n+    })\n+  );\n+};\n+\n+/**\n+ * Orders the given work items based on the provided order by key.\n+ * @param workItems - The array of work items to be ordered.\n+ * @param orderByKey - The key to order the issues by.\n+ * @returns The ordered array of work items.\n+ */\n+export const getOrderedWorkItems = (workItems: TIssue[], orderByKey: TIssueOrderByOptions): string[] => {\n+  switch (orderByKey) {\n+    case \"-updated_at\":\n+      return getIssueIds(orderBy(workItems, (item) => convertToISODateString(item[\"updated_at\"]), [\"desc\"]));\n+\n+    case \"-created_at\":\n+      return getIssueIds(orderBy(workItems, (item) => convertToISODateString(item[\"created_at\"]), [\"desc\"]));\n+\n+    case \"-start_date\":\n+      return getIssueIds(\n+        orderBy(\n+          workItems,\n+          [getSortOrderToFilterEmptyValues.bind(null, \"start_date\"), \"start_date\"], //preferring sorting based on empty values to always keep the empty values below\n+          [\"asc\", \"desc\"]\n+        )\n+      );\n+\n+    case \"-priority\": {\n+      const sortArray = ISSUE_PRIORITIES.map((i) => i.key);\n+      return getIssueIds(\n+        orderBy(workItems, (currentIssue: TIssue) => indexOf(sortArray, currentIssue?.priority), [\"asc\"])\n+      );\n+    }\n+    default:\n+      return getIssueIds(workItems);\n+  }\n+};\n+\n+export const getGroupedWorkItemIds = (\n+  workItems: TIssue[],\n+  groupByKey?: TIssueGroupByOptions,\n+  orderByKey: TIssueOrderByOptions = \"-created_at\"\n+): Record<string, string[]> => {\n+  // If group by is not set set default as ALL ISSUES\n+  if (!groupByKey) {\n+    return {\n+      [ALL_ISSUES]: getOrderedWorkItems(workItems, orderByKey),\n+    };\n+  }\n+\n+  // Group work items\n+  const groupKey = ISSUE_GROUP_BY_KEY[groupByKey];\n+  const groupedWorkItems = groupBy(workItems, (item) => {\n+    const value = item[groupKey];\n+    if (Array.isArray(value)) {\n+      if (value.length === 0) return \"None\";\n+      // Sort & join to build deterministic set-like key\n+      return value.slice().sort().join(\",\");\n+    }\n+    return value ?? \"None\";\n+  });\n+\n+  // Convert to Record type\n+  const groupedWorkItemsRecord: Record<string, string[]> = {};\n+  Object.entries(groupedWorkItems).forEach(([key, items]) => {\n+    groupedWorkItemsRecord[key] = getOrderedWorkItems(items as TIssue[], orderByKey);\n+  });\n+\n+  return groupedWorkItemsRecord;\n+};\n+\n+/**\n+ * Updates the filters for a given work item.\n+ * @param filtersMap - The map of filters for the work item.\n+ * @param filterType - The type of filter to update.\n+ * @param filters - The filters to update.\n+ * @param workItemId - The ID of the work item to update.\n+ */\n+export const updateFilters = (\n+  filtersMap: Record<string, Partial<IIssueFilters>>,\n+  filterType: EIssueFilterType,\n+  filters: IIssueDisplayFilterOptions | IIssueDisplayProperties | IIssueFilterOptions,\n+  workItemId: string\n+) => {\n+  const existingFilters = filtersMap[workItemId] ?? {};\n+  const _filters = {\n+    filters: existingFilters.filters,\n+    displayFilters: existingFilters.displayFilters,\n+    displayProperties: existingFilters.displayProperties,\n+  };\n+\n+  switch (filterType) {\n+    case EIssueFilterType.FILTERS: {\n+      const updatedFilters = filters as IIssueFilterOptions;\n+      _filters.filters = { ..._filters.filters, ...updatedFilters };\n+      set(filtersMap, [workItemId, \"filters\"], { ..._filters.filters, ...updatedFilters });\n+      break;\n+    }\n+    case EIssueFilterType.DISPLAY_FILTERS: {\n+      set(filtersMap, [workItemId, \"displayFilters\"], { ..._filters.displayFilters, ...filters });\n+      break;\n+    }\n+    case EIssueFilterType.DISPLAY_PROPERTIES:\n+      set(filtersMap, [workItemId, \"displayProperties\"], {\n+        ..._filters.displayProperties,\n+        ...filters,\n+      });\n+      break;\n+  }\n+};\n"
        },
        {
          "path": "web/core/store/issue/helpers/base-issues.store.ts",
          "status": "modified",
          "diff": "Index: web/core/store/issue/helpers/base-issues.store.ts\n===================================================================\n--- web/core/store/issue/helpers/base-issues.store.ts\t39b5736 (parent)\n+++ web/core/store/issue/helpers/base-issues.store.ts\te401c9d (commit)\n@@ -117,12 +117,12 @@\n   updateIssueDates(workspaceSlug: string, projectId: string, updates: IBlockUpdateDependencyData[]): Promise<void>;\n }\n \n // This constant maps the group by keys to the respective issue property that the key relies on\n-const ISSUE_GROUP_BY_KEY: Record<TIssueDisplayFilterOptions, keyof TIssue> = {\n+export const ISSUE_GROUP_BY_KEY: Record<TIssueDisplayFilterOptions, keyof TIssue> = {\n   project: \"project_id\",\n   state: \"state_id\",\n-  \"state_detail.group\": \"state_id\" as keyof TIssue, // state_detail.group is only being used for state_group display,\n+  \"state_detail.group\": \"state__group\" as keyof TIssue, // state_detail.group is only being used for state_group display,\n   priority: \"priority\",\n   labels: \"label_ids\",\n   created_by: \"created_by\",\n   assignees: \"assignee_ids\",\n"
        },
        {
          "path": "web/core/store/issue/issue-details/sub_issues.store.ts",
          "status": "modified",
          "diff": "Index: web/core/store/issue/issue-details/sub_issues.store.ts\n===================================================================\n--- web/core/store/issue/issue-details/sub_issues.store.ts\t39b5736 (parent)\n+++ web/core/store/issue/issue-details/sub_issues.store.ts\te401c9d (commit)\n@@ -3,8 +3,9 @@\n import set from \"lodash/set\";\n import uniq from \"lodash/uniq\";\n import update from \"lodash/update\";\n import { action, makeObservable, observable, runInAction } from \"mobx\";\n+import { computedFn } from \"mobx-utils\";\n import { EIssueServiceType } from \"@plane/constants\";\n // types\n import {\n   TIssue,\n@@ -13,10 +14,8 @@\n   TIssueSubIssuesIdMap,\n   TSubIssuesStateDistribution,\n   TIssueServiceType,\n   TLoader,\n-  TGroupedIssues,\n-  TGroupedIssueCount,\n } from \"@plane/types\";\n // services\n import { updatePersistentLayer } from \"@/local-db/utils/utils\";\n import { IssueService } from \"@/services/issue\";\n@@ -50,18 +49,15 @@\n export interface IIssueSubIssuesStore extends IIssueSubIssuesStoreActions {\n   // observables\n   subIssuesStateDistribution: TIssueSubIssuesStateDistributionMap;\n   subIssues: TIssueSubIssuesIdMap;\n-  groupedSubIssuesMap: Record<string, TGroupedIssues>;\n-  groupedSubIssuesCount: TGroupedIssueCount;\n   subIssueHelpers: Record<string, TSubIssueHelpers>; // parent_issue_id -> TSubIssueHelpers\n   loader: TLoader;\n   filters: IWorkItemSubIssueFiltersStore;\n   // helper methods\n   stateDistributionByIssueId: (issueId: string) => TSubIssuesStateDistribution | undefined;\n   subIssuesByIssueId: (issueId: string) => string[] | undefined;\n   subIssueHelpersByIssueId: (issueId: string) => TSubIssueHelpers;\n-  groupedSubIssuesByIssueId: (issueId: string) => TGroupedIssues | undefined;\n   // actions\n   fetchOtherProjectProperties: (workspaceSlug: string, projectIds: string[]) => Promise<void>;\n   setSubIssueHelpers: (parentIssueId: string, key: TSubIssueHelpersKeys, value: string) => void;\n }\n@@ -69,10 +65,8 @@\n export class IssueSubIssuesStore implements IIssueSubIssuesStore {\n   // observables\n   subIssuesStateDistribution: TIssueSubIssuesStateDistributionMap = {};\n   subIssues: TIssueSubIssuesIdMap = {};\n-  groupedSubIssuesMap: Record<string, TGroupedIssues> = {};\n-  groupedSubIssuesCount: TGroupedIssueCount = {};\n   subIssueHelpers: Record<string, TSubIssueHelpers> = {};\n   loader: TLoader = undefined;\n \n   filters: IWorkItemSubIssueFiltersStore;\n@@ -87,9 +81,8 @@\n       // observables\n       subIssuesStateDistribution: observable,\n       subIssues: observable,\n       subIssueHelpers: observable,\n-      groupedSubIssuesMap: observable,\n       loader: observable.ref,\n       // actions\n       setSubIssueHelpers: action,\n       fetchSubIssues: action,\n@@ -97,9 +90,8 @@\n       updateSubIssue: action,\n       removeSubIssue: action,\n       deleteSubIssue: action,\n       fetchOtherProjectProperties: action,\n-      groupedSubIssuesByIssueId: action,\n     });\n     this.filters = new WorkItemSubIssueFiltersStore(this);\n     // root store\n     this.rootIssueDetailStore = rootStore;\n@@ -113,15 +105,10 @@\n     if (!issueId) return undefined;\n     return this.subIssuesStateDistribution[issueId] ?? undefined;\n   };\n \n-  subIssuesByIssueId = (issueId: string) => {\n-    if (!issueId) return undefined;\n-    return this.subIssues[issueId] ?? undefined;\n-  };\n+  subIssuesByIssueId = computedFn((issueId: string) => this.subIssues[issueId]);\n \n-  groupedSubIssuesByIssueId = (issueId: string) => this.groupedSubIssuesMap[issueId] ?? undefined;\n-\n   subIssueHelpersByIssueId = (issueId: string) => ({\n     preview_loader: this.subIssueHelpers?.[issueId]?.preview_loader || [],\n     issue_visibility: this.subIssueHelpers?.[issueId]?.issue_visibility || [],\n     issue_loader: this.subIssueHelpers?.[issueId]?.issue_loader || [],\n@@ -137,22 +124,19 @@\n     });\n   };\n \n   fetchSubIssues = async (workspaceSlug: string, projectId: string, parentIssueId: string) => {\n-    // get filter params\n-    const filterParams = this.filters.computedFilterParams(parentIssueId);\n-    const response = await this.issueService.subIssues(workspaceSlug, projectId, parentIssueId, filterParams);\n+    this.loader = \"init-loader\";\n \n+    const response = await this.issueService.subIssues(workspaceSlug, projectId, parentIssueId);\n+\n     const subIssuesStateDistribution = response?.state_distribution ?? {};\n \n-    // process sub issues response\n-    const { issueList, groupedIssues } = this.filters.processSubIssueResponse(response.sub_issues);\n+    const issueList = (response.sub_issues ?? []) as TIssue[];\n \n-    // set grouped issues count\n-    set(this.groupedSubIssuesMap, [parentIssueId], groupedIssues);\n-\n     this.rootIssueDetailStore.rootIssueStore.issues.addIssue(issueList);\n \n+    // fetch other issues states and members when sub-issues are from different project\n     if (issueList && issueList.length > 0) {\n       const otherProjectIds = uniq(\n         issueList.map((issue) => issue.project_id).filter((id) => !!id && id !== projectId)\n       ) as string[];\n@@ -162,16 +146,19 @@\n       this.rootIssueDetailStore.rootIssueStore.issues.updateIssue(parentIssueId, {\n         sub_issues_count: issueList.length,\n       });\n     }\n+\n     runInAction(() => {\n       set(this.subIssuesStateDistribution, parentIssueId, subIssuesStateDistribution);\n       set(\n         this.subIssues,\n         parentIssueId,\n         issueList.map((issue) => issue.id)\n       );\n     });\n+\n+    this.loader = undefined;\n     return response;\n   };\n \n   createSubIssues = async (workspaceSlug: string, projectId: string, parentIssueId: string, issueIds: string[]) => {\n"
        },
        {
          "path": "web/core/store/issue/issue-details/sub_issues_filter.store.ts",
          "status": "modified",
          "diff": "Index: web/core/store/issue/issue-details/sub_issues_filter.store.ts\n===================================================================\n--- web/core/store/issue/issue-details/sub_issues_filter.store.ts\t39b5736 (parent)\n+++ web/core/store/issue/issue-details/sub_issues_filter.store.ts\te401c9d (commit)\n@@ -1,202 +1,139 @@\n import set from \"lodash/set\";\n-import { action, makeObservable, observable } from \"mobx\";\n-import { ALL_ISSUES, EIssueFilterType, EIssueGroupByToServerOptions } from \"@plane/constants\";\n+import { action, makeObservable, observable, runInAction } from \"mobx\";\n+import { computedFn } from \"mobx-utils\";\n+import { EIssueFilterType } from \"@plane/constants\";\n import {\n   IIssueDisplayFilterOptions,\n   IIssueDisplayProperties,\n+  IIssueFilterOptions,\n   IIssueFilters,\n-  TGroupedIssueCount,\n   TGroupedIssues,\n   TIssue,\n-  TIssueParams,\n-  TIssues,\n-  TSubGroupedIssues,\n-  TSubIssueResponse,\n } from \"@plane/types\";\n-import { IIssueSubIssuesStore } from \"./sub_issues.store\";\n+import { getFilteredWorkItems, getGroupedWorkItemIds, updateFilters } from \"../helpers/base-issues-utils\";\n+import { IssueSubIssuesStore } from \"./sub_issues.store\";\n \n+export const DEFAULT_DISPLAY_PROPERTIES = {\n+  key: true,\n+  issue_type: true,\n+  assignee: true,\n+  start_date: true,\n+  due_date: true,\n+  labels: true,\n+  priority: true,\n+  state: true,\n+};\n+\n export interface IWorkItemSubIssueFiltersStore {\n-  subIssueFiltersMap: Record<string, Partial<IIssueFilters>>;\n+  subIssueFilters: Record<string, Partial<IIssueFilters>>;\n   // helpers methods\n-  updateSubIssueFilters: (\n-    workspaceSlug: string,\n-    projectId: string,\n+  updateSubWorkItemFilters: (\n     filterType: EIssueFilterType,\n-    filters: IIssueDisplayFilterOptions | IIssueDisplayProperties,\n-    parentId: string\n-  ) => Promise<void>;\n-  getSubIssueFilters: (parentId: string) => Partial<IIssueFilters>;\n-  computedFilterParams: (parentId: string) => Partial<Record<TIssueParams, string | boolean>>;\n-  processSubIssueResponse: (issueResponse: TSubIssueResponse) => {\n-    issueList: TIssue[];\n-    groupedIssues: TIssues;\n-    groupedIssueCount: TGroupedIssueCount;\n-  };\n+    filters: IIssueDisplayFilterOptions | IIssueDisplayProperties | IIssueFilterOptions,\n+    workItemId: string\n+  ) => void;\n+  getGroupedSubWorkItems: (workItemId: string) => TGroupedIssues;\n+  getFilteredSubWorkItems: (workItemId: string, filters: IIssueFilterOptions) => TIssue[];\n+  getSubIssueFilters: (workItemId: string) => Partial<IIssueFilters>;\n+  resetFilters: (workItemId: string) => void;\n }\n \n export class WorkItemSubIssueFiltersStore implements IWorkItemSubIssueFiltersStore {\n   // observables\n-  subIssueFiltersMap: Record<string, Partial<IIssueFilters>> = {};\n+  subIssueFilters: Record<string, Partial<IIssueFilters>> = {};\n \n-  subIssueStore: IIssueSubIssuesStore;\n+  // root store\n+  subIssueStore: IssueSubIssuesStore;\n \n-  constructor(subIssueStore: IIssueSubIssuesStore) {\n+  constructor(subIssueStore: IssueSubIssuesStore) {\n     makeObservable(this, {\n-      subIssueFiltersMap: observable,\n-      updateSubIssueFilters: action,\n+      subIssueFilters: observable,\n+      updateSubWorkItemFilters: action,\n       getSubIssueFilters: action,\n     });\n-    // sub issue store\n+\n+    // root store\n     this.subIssueStore = subIssueStore;\n   }\n \n   /**\n+   * @description This method is used to get the sub issue filters\n+   * @param workItemId\n+   * @returns\n+   */\n+  getSubIssueFilters = (workItemId: string) => {\n+    if (!this.subIssueFilters[workItemId]) {\n+      this.initializeFilters(workItemId);\n+    }\n+    return this.subIssueFilters[workItemId];\n+  };\n+\n+  /**\n    * @description This method is used to initialize the sub issue filters\n-   * @param parentId\n+   * @param workItemId\n    */\n-  initSubIssueFilters = (parentId: string) => {\n-    set(this.subIssueFiltersMap, [parentId], {\n-      displayFilters: {},\n-      displayProperties: {\n-        key: true,\n-        issue_type: true,\n-        assignee: true,\n-        start_date: true,\n-        due_date: true,\n-        labels: true,\n-        priority: true,\n-        state: true,\n-      },\n+  initializeFilters = (workItemId: string) => {\n+    set(this.subIssueFilters, [workItemId, \"displayProperties\"], DEFAULT_DISPLAY_PROPERTIES);\n+    set(this.subIssueFilters, [workItemId, \"filters\"], {});\n+    set(this.subIssueFilters, [workItemId, \"displayFilters\"], {});\n+  };\n+\n+  /**\n+   * @description This method updates filters for sub issues.\n+   * @param filterType\n+   * @param filters\n+   */\n+  updateSubWorkItemFilters = (\n+    filterType: EIssueFilterType,\n+    filters: IIssueDisplayFilterOptions | IIssueDisplayProperties | IIssueFilterOptions,\n+    workItemId: string\n+  ) => {\n+    runInAction(() => {\n+      updateFilters(this.subIssueFilters, filterType, filters, workItemId);\n     });\n   };\n \n   /**\n-   * @description This method is used to process the sub issue response to provide the data to update the store\n-   * @param issueResponse\n-   * @returns issueList, list of issues data\n-   * @returns groupedIssues, grouped issue ids\n-   * @returns groupedIssueCount, object containing issue counts of individual groups\n+   * @description This method is used to get the grouped sub work items\n+   * @param parentWorkItemId\n+   * @returns\n    */\n-  processSubIssueResponse = (\n-    issueResponse: TSubIssueResponse\n-  ): {\n-    issueList: TIssue[];\n-    groupedIssues: TIssues;\n-    groupedIssueCount: TGroupedIssueCount;\n-  } => {\n-    const issueResult = issueResponse;\n+  getGroupedSubWorkItems = computedFn((parentWorkItemId: string) => {\n+    const subIssueFilters = this.getSubIssueFilters(parentWorkItemId);\n \n-    if (!issueResult) {\n-      return {\n-        issueList: [],\n-        groupedIssues: {},\n-        groupedIssueCount: {},\n-      };\n-    }\n+    const filteredWorkItems = this.getFilteredSubWorkItems(parentWorkItemId, subIssueFilters.filters ?? {});\n \n-    //if is an array then it's an ungrouped response. return values with groupId as ALL_ISSUES\n-    if (Array.isArray(issueResult)) {\n-      return {\n-        issueList: issueResult,\n-        groupedIssues: {\n-          [ALL_ISSUES]: issueResult.map((issue) => issue.id),\n-        },\n-        groupedIssueCount: {\n-          [ALL_ISSUES]: issueResult.length,\n-        },\n-      };\n-    }\n+    // get group by and order by\n+    const groupByKey = subIssueFilters.displayFilters?.group_by;\n+    const orderByKey = subIssueFilters.displayFilters?.order_by;\n \n-    const issueList: TIssue[] = [];\n-    const groupedIssues: TGroupedIssues | TSubGroupedIssues = {};\n-    const groupedIssueCount: TGroupedIssueCount = {};\n+    const groupedWorkItemIds = getGroupedWorkItemIds(filteredWorkItems, groupByKey, orderByKey);\n \n-    // update total issue count to ALL_ISSUES\n-    set(groupedIssueCount, [ALL_ISSUES], issueResult.length);\n+    return groupedWorkItemIds;\n+  });\n \n-    // loop through all the groupIds from issue Result\n-    for (const groupId in issueResult) {\n-      const groupIssueResult = issueResult[groupId];\n-\n-      // if groupIssueResult is undefined then continue the loop\n-      if (!groupIssueResult) continue;\n-\n-      // set grouped Issue count of the current groupId\n-      set(groupedIssueCount, [groupId], groupIssueResult.length);\n-\n-      // add the result to issueList\n-      issueList.push(...groupIssueResult);\n-      // set the issue Ids to the groupId path\n-      set(\n-        groupedIssues,\n-        [groupId],\n-        groupIssueResult.map((issue) => issue.id)\n-      );\n-    }\n-\n-    return { issueList, groupedIssues, groupedIssueCount };\n-  };\n-\n   /**\n-   * @description This method is used to get the sub issue filters\n-   * @param parentId\n-   * @returns IIssueFilters\n+   * @description This method is used to get the filtered sub work items\n+   * @param workItemId\n+   * @returns\n    */\n-  getSubIssueFilters = (parentId: string) => {\n-    if (!this.subIssueFiltersMap[parentId]) {\n-      this.initSubIssueFilters(parentId);\n-    }\n-    return this.subIssueFiltersMap[parentId];\n-  };\n+  getFilteredSubWorkItems = computedFn((workItemId: string, filters: IIssueFilterOptions) => {\n+    const subIssueIds = this.subIssueStore.subIssuesByIssueId(workItemId);\n+    const workItems = this.subIssueStore.rootIssueDetailStore.rootIssueStore.issues.getIssuesByIds(\n+      subIssueIds,\n+      \"un-archived\"\n+    );\n \n-  computedFilterParams = (parentId: string) => {\n-    const displayFilters = this.getSubIssueFilters(parentId).displayFilters;\n+    const filteredWorkItems = getFilteredWorkItems(workItems, filters);\n \n-    const computedFilters: Partial<Record<TIssueParams, undefined | string[] | boolean | string>> = {\n-      order_by: displayFilters?.order_by || undefined,\n-      group_by: displayFilters?.group_by ? EIssueGroupByToServerOptions[displayFilters.group_by] : undefined,\n-    };\n+    return filteredWorkItems;\n+  });\n \n-    const issueFiltersParams: Partial<Record<TIssueParams, boolean | string>> = {};\n-    Object.keys(computedFilters).forEach((key) => {\n-      const _key = key as TIssueParams;\n-      const _value: string | boolean | string[] | undefined = computedFilters[_key];\n-      const nonEmptyArrayValue = Array.isArray(_value) && _value.length === 0 ? undefined : _value;\n-      if (nonEmptyArrayValue != undefined)\n-        issueFiltersParams[_key] = Array.isArray(nonEmptyArrayValue)\n-          ? nonEmptyArrayValue.join(\",\")\n-          : nonEmptyArrayValue;\n-    });\n-\n-    return issueFiltersParams;\n-  };\n-\n   /**\n-   * @description This method is used to update the sub issue filters\n-   * @param projectId\n-   * @param filterType\n-   * @param filters\n+   * @description This method is used to reset the filters\n+   * @param workItemId\n    */\n-  updateSubIssueFilters = async (\n-    workspaceSlug: string,\n-    projectId: string,\n-    filterType: EIssueFilterType,\n-    filters: IIssueDisplayFilterOptions | IIssueDisplayProperties,\n-    parentId: string\n-  ) => {\n-    const _filters = this.getSubIssueFilters(parentId);\n-    switch (filterType) {\n-      case EIssueFilterType.DISPLAY_FILTERS: {\n-        set(this.subIssueFiltersMap, [parentId, \"displayFilters\"], { ..._filters.displayFilters, ...filters });\n-        this.subIssueStore.fetchSubIssues(workspaceSlug, projectId, parentId);\n-        break;\n-      }\n-      case EIssueFilterType.DISPLAY_PROPERTIES:\n-        set(this.subIssueFiltersMap, [parentId, \"displayProperties\"], {\n-          ..._filters.displayProperties,\n-          ...filters,\n-        });\n-        break;\n-    }\n+  resetFilters = (workItemId: string) => {\n+    this.initializeFilters(workItemId);\n   };\n }\n"
        },
        {
          "path": "web/helpers/date-time.helper.ts",
          "status": "modified",
          "diff": "Index: web/helpers/date-time.helper.ts\n===================================================================\n--- web/helpers/date-time.helper.ts\t39b5736 (parent)\n+++ web/helpers/date-time.helper.ts\te401c9d (commit)\n@@ -404,4 +404,74 @@\n   }\n \n   return dateArray;\n };\n+\n+/**\n+ * Processes relative date strings like \"1_weeks\", \"2_months\" etc and returns a Date\n+ * @param value The relative date string (e.g., \"1_weeks\", \"2_months\")\n+ * @returns Date object representing the calculated date\n+ */\n+export const processRelativeDate = (value: string): Date => {\n+  const [amountStr, unit] = value.split(\"_\");\n+  const amount = parseInt(amountStr, 10);\n+  if (isNaN(amount)) {\n+    throw new Error(`Invalid relative amount: ${amountStr}`);\n+  }\n+  const date = new Date();\n+\n+  switch (unit) {\n+    case \"days\":\n+      date.setDate(date.getDate() + amount);\n+      break;\n+    case \"weeks\":\n+      date.setDate(date.getDate() + amount * 7);\n+      break;\n+    case \"months\":\n+      date.setMonth(date.getMonth() + amount);\n+      break;\n+    default:\n+      throw new Error(`Unsupported time unit: ${unit}`);\n+  }\n+\n+  return date;\n+};\n+\n+/**\n+ * Parses a date filter string and returns the comparison type and date\n+ * @param filterValue The date filter string (e.g., \"1_weeks;after;fromnow\" or \"2024-12-01;after\")\n+ * @returns Object containing the comparison type and target date\n+ */\n+export const parseDateFilter = (filterValue: string): { type: \"after\" | \"before\"; date: Date } => {\n+  const parts = filterValue.split(\";\");\n+  const dateStr = parts[0];\n+  const type = parts[1] as \"after\" | \"before\";\n+\n+  let date: Date;\n+  if (dateStr.includes(\"_\")) {\n+    // Handle relative dates (e.g., \"1_weeks;after;fromnow\")\n+    date = processRelativeDate(dateStr);\n+  } else {\n+    // Handle absolute dates (e.g., \"2024-12-01;after\")\n+    date = new Date(dateStr);\n+  }\n+\n+  return { type, date };\n+};\n+\n+/**\n+ * Checks if a date meets the filter criteria\n+ * @param dateToCheck The date to check\n+ * @param filterDate The filter date to compare against\n+ * @param type The type of comparison ('after' or 'before')\n+ * @returns boolean indicating if the date meets the criteria\n+ */\n+export const checkDateCriteria = (dateToCheck: Date | null, filterDate: Date, type: \"after\" | \"before\"): boolean => {\n+  if (!dateToCheck) return false;\n+\n+  const checkDate = new Date(dateToCheck);\n+  const normalizedCheck = new Date(checkDate.setHours(0, 0, 0, 0));\n+  const normalizedFilter = new Date(filterDate.getTime());\n+  normalizedFilter.setHours(0, 0, 0, 0);\n+\n+  return type === \"after\" ? normalizedCheck >= normalizedFilter : normalizedCheck <= normalizedFilter;\n+};\n"
        }
      ]
    },
    {
      "id": "add-peek-analytics",
      "sha": "5b776392bd60c01f224b73e3254b25103460ec27",
      "parentSha": "ba158d5d6eec0fad036411d19b02d5732d640a91",
      "spec": "Implement cycle/module-aware analytics peek view for work items and remove unused export endpoint across API and web.\n\nBackend (apiserver):\n1) Remove server-side export endpoint\n- apiserver/plane/app/urls/analytic.py: Remove route for advance-analytics-export (path \"workspaces/<str:slug>/advance-analytics-export/\").\n- apiserver/plane/app/views/__init__.py: Remove import/export of AdvanceAnalyticsExportEndpoint from the analytic.advance module.\n- apiserver/plane/app/views/analytic/advance.py: Remove the AdvanceAnalyticsExportEndpoint class entirely and remove any import of export_analytics_to_csv_email.\n\n2) Extend analytics endpoints to support cycles, modules, and peek view\n- apiserver/plane/app/views/analytic/advance.py:\n  a) AdvanceAnalyticsEndpoint\n    - Modify get_work_items_stats to accept optional cycle_id and module_id (as query params) and restrict Issue queryset accordingly:\n      • If cycle_id is provided: Derive issue IDs from CycleIssue filtered by base_filters and cycle_id; restrict Issue.issue_objects to id__in.\n      • Else if module_id is provided: Derive issue IDs from ModuleIssue filtered by base_filters and module_id; restrict Issue.issue_objects to id__in.\n      • Else: use Issue.issue_objects filtered by base_filters.\n    - get() handler: For tab=\"work-items\", read query params cycle_id and module_id and pass to get_work_items_stats.\n    - Comment out filter_count from the returned counts object in the work items tab (do not include previous period comparison).\n\n  b) AdvanceAnalyticsStatsEndpoint\n    - Introduce get_work_items_stats(cycle_id=None, module_id=None, peek_view=False) replacing the project-only breakdown:\n      • When cycle_id or module_id (or peek_view) is provided, return assignee-level stats:\n        - Base queryset: issues in the selected cycle/module, or workspace base_filters when peek_view is true.\n        - Values included: display_name (assignees__display_name), assignee_id (assignees__id), and avatar_url computed as: if avatar_asset exists, \"/api/assets/v2/static/{assignees__avatar_asset}/\" else use assignees__avatar; output avatar_url as string; include state-group counts (cancelled/completed/backlog/unstarted/started) with distinct=True to avoid double counting from joins.\n        - Order by display_name.\n      • Otherwise (no cycle/module/peek_view): return the original project breakdown (values(\"project_id\", \"project__name\") + annotated state-group counts) ordered by project_id.\n    - get() handler: For type=\"work-items\", read cycle_id, module_id, and peek_view (boolean-like) and return get_work_items_stats(...) accordingly.\n\n  c) AdvanceAnalyticsChartEndpoint\n    - work_item_completion_chart should accept cycle_id, module_id, peek_view and produce:\n      • For cycle_id+peek_view: day-wise series between cycle.start_date and cycle.end_date, counting issues created and issues completed each day for issues in that cycle.\n      • For module_id+peek_view: day-wise series between module.start_date and module.target_date, for issues in that module.\n      • For peek_view without cycle/module: if project_ids is provided, anchor the chart period to the project’s created_at month; otherwise return empty data/schema.\n      • Default workspace view: keep monthly series logic across months since workspace created_at (respect chart_period_range if present), with created and completed counts.\n      • Response schema includes keys: completed_issues and created_issues.\n    - get() handler:\n      • For type=\"custom-work-items\": if cycle_id provided, filter queryset to id__in CycleIssue; if module_id provided, filter to id__in ModuleIssue; otherwise unchanged.\n      • For type=\"work-items\": read cycle_id, module_id, peek_view and return work_item_completion_chart with those params.\n\n3) Fix analytics filter consistency\n- apiserver/plane/utils/date_utils.py: In get_analytics_filters, update project_filters to use deletion/archive flags on the current model instead of on the nested project object:\n  • Replace project_filters keys: \"project__deleted_at__isnull\": True -> \"deleted_at__isnull\": True, and \"project__archived_at__isnull\": True -> \"archived_at__isnull\": True. Leave other keys intact.\n\nFrontend (web):\n4) Update analytics types to support peek view output\n- packages/types/src/analytics-v2.d.ts:\n  • Ensure TAnalyticsTabsV2Base and TAnalyticsGraphsV2Base are defined (format not important).\n  • In WorkItemInsightColumns, make project_id and project__name optional and add optional fields display_name, avatar_url, assignee_id to support assignee-row table in peek view.\n  • Keep IAnalyticsResponseV2/IChartResponseV2/IAnalyticsV2Params structure intact.\n\n5) Replace project analytics modal with work-items modal in cycle/module headers\n- web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/header.tsx and mobile-header.tsx:\n  • Replace import of ProjectAnalyticsModal with WorkItemsModal from \"@/components/analytics-v2/work-items/modal\".\n  • When rendering the modal, pass projectDetails={currentProjectDetails} and cycleDetails.\n- web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/header.tsx and mobile-header.tsx:\n  • Replace ProjectAnalyticsModal with WorkItemsModal.\n  • Pass moduleDetails and projectDetails.\n\n6) Forward cycle/module and peek flags and adjust SWR keys\n- web/core/components/analytics-v2/overview/project-insights.tsx, total-insights.tsx, work-items/created-vs-resolved.tsx, work-items/priority-chart.tsx, insight-table/root.tsx, work-items/workitems-insight-table.tsx:\n  • Use const workspaceSlug = params.workspaceSlug.toString().\n  • Update SWR keys to include selectedCycle, selectedModule, and isPeekView so caches are segregated accordingly.\n  • When calling analyticsV2Service.getAdvanceAnalytics or getAdvanceAnalyticsCharts, forward query params if present: cycle_id, module_id, and peek_view.\n  • In priority chart CSV export, omit hidden fields like key, avatar_url, assignee_id, and project_id, and include dynamic series columns by mapping via parsedData.schema.\n  • In insight-table root CSV export, also omit avatar_url and assignee_id.\n\n7) Work items insight table shows assignee column in peek view\n- web/core/components/analytics-v2/work-items/workitems-insight-table.tsx:\n  • When isPeekView is false (default), keep the first column as project__name showing project logo or briefcase icon.\n  • When isPeekView is true, replace the first column with assignee display (display_name), including Avatar component if avatar_url present (resolve URL via getFileURL), else show initial or a user icon; label this column as \"Assignee\".\n  • Keep state-group columns and their labels unchanged.\n\n8) Work items modal\n- web/core/components/analytics-v2/work-items/modal/header.tsx:\n  • Update header title to optionally append \"in {cycle.name}\" or \"in {module.name}\" when cycle/module is provided.\n- web/core/components/analytics-v2/work-items/modal/content.tsx:\n  • On mount, set isPeekView true in the analytics store.\n  • If provided, seed the store with project id (selectedProjects), cycle id (selectedCycle), and module id (selectedModule).\n  • Show a spinner until initial configuration is complete, then render.\n  • On unmount, reset selectedProjects to [], selectedCycle to \"\", selectedModule to \"\", and isPeekView to false.\n- web/core/components/analytics-v2/work-items/modal/index.tsx:\n  • Accept and forward cycleDetails and moduleDetails props to header/content.\n\n9) Analytics store changes\n- web/core/store/analytics-v2.store.ts:\n  • Add observables: selectedCycle (string), selectedModule (string), isPeekView (boolean), and actions updateSelectedCycle, updateSelectedModule, updateIsPeekView.\n  • Fix selectedProjects type to string[].\n  • Remove dependency on CoreRootStore in the constructor; construct with no params; mark new observables/actions with makeObservable.\n- web/core/store/root.store.ts:\n  • Initialize analyticsV2 with new constructor: new AnalyticsStoreV2().\n\n10) Legacy analytics page shim (web)\n- Add web/core/components/analytics/old-page.tsx: A client component rendering the prior analytics tabs UI (ScopeAndDemand and CustomAnalytics). It should use existing hooks and components, respect permissions, and show an onboarding empty state when no projects exist. The component is only needed as a stand-in for the old page and should not replace the new peek-view behavior.\n\nBehavioral outcomes to verify:\n- GET /api/workspaces/{slug}/advance-analytics/?tab=work-items accepts cycle_id/module_id and returns workspace counts restricted to that subset.\n- GET /api/workspaces/{slug}/advance-analytics-stats/?type=work-items respects cycle_id/module_id/peek_view and returns either project-level or assignee-level rows consistent with the updated types (and includes avatar_url when available).\n- GET /api/workspaces/{slug}/advance-analytics-charts/?type=work-items respects cycle_id/module_id/peek_view and returns day-wise for cycle/module or monthly otherwise.\n- GET /api/workspaces/{slug}/advance-analytics-charts/?type=custom-work-items respects cycle_id/module_id by narrowing the issue queryset.\n- No URL exists at /advance-analytics-export/ and there are no imports/usages of AdvanceAnalyticsExportEndpoint or export_analytics_to_csv_email.\n- WorkItemsModal opens from cycle/module headers, shows analytics for that project in the given cycle/module, uses peek view, and toggles back to normal when closed.\n- Insight table switches first column from project to assignee in peek view and CSV exports omit hidden fields.",
      "prompt": "Add cycle- and module-scoped analytics to the workspace analytics experience, including a \"peek view\" that switches the work items insight table to show assignees instead of projects and renders day-wise created vs resolved charts for the selected cycle/module. Remove the server-side CSV export endpoint and rely on client-side CSV exports. Update the analytics state to track the selected project(s), cycle, module, and a boolean peek-view flag, and forward these params through the analytics service to the backend so charts and stats are filtered appropriately. Update the cycle/module issue headers to open a work-items analytics modal configured for the current project and the selected cycle or module. Ensure the backend returns assignee-level stats (including display name and avatar URL) when in peek view, and returns project-level stats otherwise. Adjust filters to consistently ignore archived/deleted records, ensure M2M aggregations are distinct, and keep chart schemas consistent with created/completed series.",
      "supplementalFiles": [
        "apiserver/plane/utils/build_chart.py",
        "apiserver/plane/db/models/cycle.py",
        "apiserver/plane/db/models/module.py",
        "apiserver/plane/db/models/issue.py",
        "apiserver/plane/db/models/user.py",
        "web/core/services/analytics-v2.service.ts",
        "web/core/hooks/store/use-analytics-v2.ts",
        "web/core/components/analytics/project-modal/modal.tsx",
        "web/core/components/analytics/project-modal/header.tsx",
        "web/core/components/analytics/project-modal/main-content.tsx"
      ],
      "fileDiffs": [
        {
          "path": "apiserver/plane/app/urls/analytic.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/urls/analytic.py\n===================================================================\n--- apiserver/plane/app/urls/analytic.py\tba158d5 (parent)\n+++ apiserver/plane/app/urls/analytic.py\t5b77639 (commit)\n@@ -10,9 +10,8 @@\n     AdvanceAnalyticsStatsEndpoint,\n     AdvanceAnalyticsChartEndpoint,\n     DefaultAnalyticsEndpoint,\n     ProjectStatsEndpoint,\n-    AdvanceAnalyticsExportEndpoint,\n )\n \n \n urlpatterns = [\n@@ -67,10 +66,5 @@\n         \"workspaces/<str:slug>/advance-analytics-charts/\",\n         AdvanceAnalyticsChartEndpoint.as_view(),\n         name=\"advance-analytics-chart\",\n     ),\n-    path(\n-        \"workspaces/<str:slug>/advance-analytics-export/\",\n-        AdvanceAnalyticsExportEndpoint.as_view(),\n-        name=\"advance-analytics-export\",\n-    ),\n ]\n"
        },
        {
          "path": "apiserver/plane/app/views/__init__.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/views/__init__.py\n===================================================================\n--- apiserver/plane/app/views/__init__.py\tba158d5 (parent)\n+++ apiserver/plane/app/views/__init__.py\t5b77639 (commit)\n@@ -202,9 +202,8 @@\n from .analytic.advance import (\n     AdvanceAnalyticsEndpoint,\n     AdvanceAnalyticsStatsEndpoint,\n     AdvanceAnalyticsChartEndpoint,\n-    AdvanceAnalyticsExportEndpoint,\n )\n \n from .notification.base import (\n     NotificationViewSet,\n"
        },
        {
          "path": "apiserver/plane/app/views/analytic/advance.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/views/analytic/advance.py\n===================================================================\n--- apiserver/plane/app/views/analytic/advance.py\tba158d5 (parent)\n+++ apiserver/plane/app/views/analytic/advance.py\t5b77639 (commit)\n@@ -4,9 +4,9 @@\n from django.db.models import QuerySet, Q, Count\n from django.http import HttpRequest\n from django.db.models.functions import TruncMonth\n from django.utils import timezone\n-\n+from datetime import timedelta\n from plane.app.views.base import BaseAPIView\n from plane.app.permissions import ROLE, allow_permission\n from plane.db.models import (\n     WorkspaceMember,\n@@ -15,22 +15,21 @@\n     Cycle,\n     Module,\n     IssueView,\n     ProjectPage,\n-    Workspace\n+    Workspace,\n+    CycleIssue,\n+    ModuleIssue,\n )\n-\n+from django.db import models\n+from django.db.models import F, Case, When, Value\n+from django.db.models.functions import Concat\n from plane.utils.build_chart import build_analytics_chart\n-from plane.bgtasks.analytic_plot_export import export_analytics_to_csv_email\n from plane.utils.date_utils import (\n     get_analytics_filters,\n )\n \n-from plane.utils.build_chart import build_analytics_chart\n-from plane.bgtasks.analytic_plot_export import export_analytics_to_csv_email\n-from plane.utils.date_utils import get_analytics_filters\n \n-\n class AdvanceAnalyticsBaseView(BaseAPIView):\n     def initialize_workspace(self, slug: str, type: str) -> None:\n         self._workspace_slug = slug\n         self.filters = get_analytics_filters(\n@@ -72,9 +71,9 @@\n             return 0\n \n         return {\n             \"count\": get_filtered_count(),\n-            \"filter_count\": get_previous_count(),\n+            # \"filter_count\": get_previous_count(),\n         }\n \n     def get_overview_data(self) -> Dict[str, Dict[str, int]]:\n         return {\n@@ -119,12 +118,28 @@\n                 )\n             ),\n         }\n \n+    def get_work_items_stats(\n+        self, cycle_id=None, module_id=None\n+    ) -> Dict[str, Dict[str, int]]:\n+        \"\"\"\n+        Returns work item stats for the workspace, or filtered by cycle_id or module_id if provided.\n+        \"\"\"\n+        base_queryset = None\n+        if cycle_id is not None:\n+            cycle_issues = CycleIssue.objects.filter(\n+                **self.filters[\"base_filters\"], cycle_id=cycle_id\n+            ).values_list(\"issue_id\", flat=True)\n+            base_queryset = Issue.issue_objects.filter(id__in=cycle_issues)\n+        elif module_id is not None:\n+            module_issues = ModuleIssue.objects.filter(\n+                **self.filters[\"base_filters\"], module_id=module_id\n+            ).values_list(\"issue_id\", flat=True)\n+            base_queryset = Issue.issue_objects.filter(id__in=module_issues)\n+        else:\n+            base_queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n \n-    def get_work_items_stats(self) -> Dict[str, Dict[str, int]]:\n-        base_queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n-\n         return {\n             \"total_work_items\": self.get_filtered_counts(base_queryset),\n             \"started_work_items\": self.get_filtered_counts(\n                 base_queryset.filter(state__group=\"started\")\n@@ -149,15 +164,16 @@\n             return Response(\n                 self.get_overview_data(),\n                 status=status.HTTP_200_OK,\n             )\n-\n         elif tab == \"work-items\":\n+            # Optionally accept cycle_id or module_id as query params\n+            cycle_id = request.GET.get(\"cycle_id\", None)\n+            module_id = request.GET.get(\"module_id\", None)\n             return Response(\n-                self.get_work_items_stats(),\n+                self.get_work_items_stats(cycle_id=cycle_id, module_id=module_id),\n                 status=status.HTTP_200_OK,\n             )\n-\n         return Response({\"message\": \"Invalid tab\"}, status=status.HTTP_400_BAD_REQUEST)\n \n \n class AdvanceAnalyticsStatsEndpoint(AdvanceAnalyticsBaseView):\n@@ -183,16 +199,102 @@\n             )\n             .order_by(\"project_id\")\n         )\n \n+    def get_work_items_stats(\n+        self, cycle_id=None, module_id=None, peek_view=False\n+    ) -> Dict[str, Dict[str, int]]:\n+        base_queryset = None\n+        if cycle_id is not None:\n+            cycle_issues = CycleIssue.objects.filter(\n+                **self.filters[\"base_filters\"], cycle_id=cycle_id\n+            ).values_list(\"issue_id\", flat=True)\n+            base_queryset = Issue.issue_objects.filter(id__in=cycle_issues)\n+        elif module_id is not None:\n+            module_issues = ModuleIssue.objects.filter(\n+                **self.filters[\"base_filters\"], module_id=module_id\n+            ).values_list(\"issue_id\", flat=True)\n+            base_queryset = Issue.issue_objects.filter(id__in=module_issues)\n+        elif peek_view:\n+            base_queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n+        else:\n+            base_queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n+            return (\n+                base_queryset.values(\"project_id\", \"project__name\")\n+                .annotate(\n+                    cancelled_work_items=Count(\n+                        \"id\", filter=Q(state__group=\"cancelled\")\n+                    ),\n+                    completed_work_items=Count(\n+                        \"id\", filter=Q(state__group=\"completed\")\n+                    ),\n+                    backlog_work_items=Count(\"id\", filter=Q(state__group=\"backlog\")),\n+                    un_started_work_items=Count(\n+                        \"id\", filter=Q(state__group=\"unstarted\")\n+                    ),\n+                    started_work_items=Count(\"id\", filter=Q(state__group=\"started\")),\n+                )\n+                .order_by(\"project_id\")\n+            )\n+\n+        return (\n+            base_queryset.annotate(display_name=F(\"assignees__display_name\"))\n+            .annotate(assignee_id=F(\"assignees__id\"))\n+            .annotate(avatar=F(\"assignees__avatar\"))\n+            .annotate(\n+                avatar_url=Case(\n+                    # If `avatar_asset` exists, use it to generate the asset URL\n+                    When(\n+                        assignees__avatar_asset__isnull=False,\n+                        then=Concat(\n+                            Value(\"/api/assets/v2/static/\"),\n+                            \"assignees__avatar_asset\",  # Assuming avatar_asset has an id or relevant field\n+                            Value(\"/\"),\n+                        ),\n+                    ),\n+                    # If `avatar_asset` is None, fall back to using `avatar` field directly\n+                    When(\n+                        assignees__avatar_asset__isnull=True, then=\"assignees__avatar\"\n+                    ),\n+                    default=Value(None),\n+                    output_field=models.CharField(),\n+                )\n+            )\n+            .values(\"display_name\", \"assignee_id\", \"avatar_url\")\n+            .annotate(\n+                cancelled_work_items=Count(\n+                    \"id\", filter=Q(state__group=\"cancelled\"), distinct=True\n+                ),\n+                completed_work_items=Count(\n+                    \"id\", filter=Q(state__group=\"completed\"), distinct=True\n+                ),\n+                backlog_work_items=Count(\n+                    \"id\", filter=Q(state__group=\"backlog\"), distinct=True\n+                ),\n+                un_started_work_items=Count(\n+                    \"id\", filter=Q(state__group=\"unstarted\"), distinct=True\n+                ),\n+                started_work_items=Count(\n+                    \"id\", filter=Q(state__group=\"started\"), distinct=True\n+                ),\n+            )\n+            .order_by(\"display_name\")\n+        )\n+\n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER], level=\"WORKSPACE\")\n     def get(self, request: HttpRequest, slug: str) -> Response:\n         self.initialize_workspace(slug, type=\"chart\")\n         type = request.GET.get(\"type\", \"work-items\")\n \n         if type == \"work-items\":\n+            # Optionally accept cycle_id or module_id as query params\n+            cycle_id = request.GET.get(\"cycle_id\", None)\n+            module_id = request.GET.get(\"module_id\", None)\n+            peek_view = request.GET.get(\"peek_view\", False)\n             return Response(\n-                self.get_project_issues_stats(),\n+                self.get_work_items_stats(\n+                    cycle_id=cycle_id, module_id=module_id, peek_view=peek_view\n+                ),\n                 status=status.HTTP_200_OK,\n             )\n \n         return Response({\"message\": \"Invalid type\"}, status=status.HTTP_400_BAD_REQUEST)\n@@ -250,9 +352,11 @@\n             }\n             for key, value in data.items()\n         ]\n \n-    def work_item_completion_chart(self) -> Dict[str, Any]:\n+    def work_item_completion_chart(\n+        self, cycle_id=None, module_id=None, peek_view=False\n+    ) -> Dict[str, Any]:\n         # Get the base queryset\n         queryset = (\n             Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n             .select_related(\"workspace\", \"state\", \"parent\")\n@@ -260,64 +364,146 @@\n                 \"assignees\", \"labels\", \"issue_module__module\", \"issue_cycle__cycle\"\n             )\n         )\n \n-        # Apply date range filter if available\n-        if self.filters[\"chart_period_range\"]:\n-            start_date, end_date = self.filters[\"chart_period_range\"]\n-            queryset = queryset.filter(\n-                created_at__date__gte=start_date, created_at__date__lte=end_date\n-            )\n+        if cycle_id is not None and peek_view:\n+            cycle_issues = CycleIssue.objects.filter(\n+                **self.filters[\"base_filters\"], cycle_id=cycle_id\n+            ).values_list(\"issue_id\", flat=True)\n+            cycle = Cycle.objects.filter(id=cycle_id).first()\n+            if cycle and cycle.start_date:\n+                start_date = cycle.start_date.date()\n+                end_date = cycle.end_date.date()\n+            else:\n+                return {\"data\": [], \"schema\": {}}\n+            queryset = cycle_issues\n+        elif module_id is not None and peek_view:\n+            module_issues = ModuleIssue.objects.filter(\n+                **self.filters[\"base_filters\"], module_id=module_id\n+            ).values_list(\"issue_id\", flat=True)\n+            module = Module.objects.filter(id=module_id).first()\n+            if module and module.start_date:\n+                start_date = module.start_date\n+                end_date = module.target_date\n+            else:\n+                return {\"data\": [], \"schema\": {}}\n+            queryset = module_issues\n+        elif peek_view:\n+            project_ids_str = self.request.GET.get(\"project_ids\")\n+            if project_ids_str:\n+                project_id_list = [\n+                    pid.strip() for pid in project_ids_str.split(\",\") if pid.strip()\n+                ]\n+            else:\n+                project_id_list = []\n+                return {\"data\": [], \"schema\": {}}\n+            project_id = project_id_list[0]\n+            project = Project.objects.filter(id=project_id).first()\n+            if project.created_at:\n+                start_date = project.created_at.date().replace(day=1)\n+            else:\n+                return {\"data\": [], \"schema\": {}}\n+        else:\n+            workspace = Workspace.objects.get(slug=self._workspace_slug)\n+            start_date = workspace.created_at.date().replace(day=1)\n \n-        # Annotate by month and count\n-        monthly_stats = (\n-            queryset.annotate(month=TruncMonth(\"created_at\"))\n-            .values(\"month\")\n-            .annotate(\n-                created_count=Count(\"id\"),\n-                completed_count=Count(\"id\", filter=Q(completed_at__isnull=False)),\n+        if cycle_id or module_id:\n+            # Get daily stats with optimized query\n+            daily_stats = (\n+                queryset.values(\"created_at__date\")\n+                .annotate(\n+                    created_count=Count(\"id\"),\n+                    completed_count=Count(\n+                        \"id\", filter=Q(issue__state__group=\"completed\")\n+                    ),\n+                )\n+                .order_by(\"created_at__date\")\n             )\n-            .order_by(\"month\")\n-        )\n \n-        # Create dictionary of month -> counts\n-        stats_dict = {\n-            stat[\"month\"].strftime(\"%Y-%m-%d\"): {\n-                \"created_count\": stat[\"created_count\"],\n-                \"completed_count\": stat[\"completed_count\"],\n+            # Create a dictionary of existing stats with summed counts\n+            stats_dict = {\n+                stat[\"created_at__date\"].strftime(\"%Y-%m-%d\"): {\n+                    \"created_count\": stat[\"created_count\"],\n+                    \"completed_count\": stat[\"completed_count\"],\n+                }\n+                for stat in daily_stats\n             }\n-            for stat in monthly_stats\n-        }\n \n-        # Generate monthly data (ensure months with 0 count are included)\n-        data = []\n-        workspace = Workspace.objects.get(slug=self._workspace_slug)\n-        start_date = workspace.created_at.date().replace(day=1)\n-        # include the current date at the end\n-        end_date = timezone.now().date()\n-        last_month = end_date.replace(day=1)\n-        current_month = start_date\n+            # Generate data for all days in the range\n+            data = []\n+            current_date = start_date\n+            while current_date <= end_date:\n+                date_str = current_date.strftime(\"%Y-%m-%d\")\n+                stats = stats_dict.get(\n+                    date_str, {\"created_count\": 0, \"completed_count\": 0}\n+                )\n+                data.append(\n+                    {\n+                        \"key\": date_str,\n+                        \"name\": date_str,\n+                        \"count\": stats[\"created_count\"] + stats[\"completed_count\"],\n+                        \"completed_issues\": stats[\"completed_count\"],\n+                        \"created_issues\": stats[\"created_count\"],\n+                    }\n+                )\n+                current_date += timedelta(days=1)\n+        else:\n+            # Apply date range filter if available\n+            if self.filters[\"chart_period_range\"]:\n+                start_date, end_date = self.filters[\"chart_period_range\"]\n+                queryset = queryset.filter(\n+                    created_at__date__gte=start_date, created_at__date__lte=end_date\n+                )\n \n-        while current_month <= last_month:\n-            date_str = current_month.strftime(\"%Y-%m-%d\")\n-            stats = stats_dict.get(date_str, {\"created_count\": 0, \"completed_count\": 0})\n-            data.append(\n-                {\n-                    \"key\": date_str,\n-                    \"name\": date_str,\n-                    \"count\": stats[\n-                        \"created_count\"\n-                    ],  # <- Total created issues in that month\n-                    \"completed_issues\": stats[\"completed_count\"],\n-                    \"created_issues\": stats[\"created_count\"],\n-                }\n+            # Annotate by month and count\n+            monthly_stats = (\n+                queryset.annotate(month=TruncMonth(\"created_at\"))\n+                .values(\"month\")\n+                .annotate(\n+                    created_count=Count(\"id\"),\n+                    completed_count=Count(\"id\", filter=Q(state__group=\"completed\")),\n+                )\n+                .order_by(\"month\")\n             )\n-            # Move to next month\n-            if current_month.month == 12:\n-                current_month = current_month.replace(year=current_month.year + 1, month=1)\n-            else:\n-                current_month = current_month.replace(month=current_month.month + 1)\n \n+            # Create dictionary of month -> counts\n+            stats_dict = {\n+                stat[\"month\"].strftime(\"%Y-%m-%d\"): {\n+                    \"created_count\": stat[\"created_count\"],\n+                    \"completed_count\": stat[\"completed_count\"],\n+                }\n+                for stat in monthly_stats\n+            }\n+\n+            # Generate monthly data (ensure months with 0 count are included)\n+            data = []\n+            # include the current date at the end\n+            end_date = timezone.now().date()\n+            last_month = end_date.replace(day=1)\n+            current_month = start_date\n+\n+            while current_month <= last_month:\n+                date_str = current_month.strftime(\"%Y-%m-%d\")\n+                stats = stats_dict.get(\n+                    date_str, {\"created_count\": 0, \"completed_count\": 0}\n+                )\n+                data.append(\n+                    {\n+                        \"key\": date_str,\n+                        \"name\": date_str,\n+                        \"count\": stats[\"created_count\"],\n+                        \"completed_issues\": stats[\"completed_count\"],\n+                        \"created_issues\": stats[\"created_count\"],\n+                    }\n+                )\n+                # Move to next month\n+                if current_month.month == 12:\n+                    current_month = current_month.replace(\n+                        year=current_month.year + 1, month=1\n+                    )\n+                else:\n+                    current_month = current_month.replace(month=current_month.month + 1)\n+\n         schema = {\n             \"completed_issues\": \"completed_issues\",\n             \"created_issues\": \"created_issues\",\n         }\n@@ -329,22 +515,36 @@\n         self.initialize_workspace(slug, type=\"chart\")\n         type = request.GET.get(\"type\", \"projects\")\n         group_by = request.GET.get(\"group_by\", None)\n         x_axis = request.GET.get(\"x_axis\", \"PRIORITY\")\n+        cycle_id = request.GET.get(\"cycle_id\", None)\n+        module_id = request.GET.get(\"module_id\", None)\n \n         if type == \"projects\":\n             return Response(self.project_chart(), status=status.HTTP_200_OK)\n \n         elif type == \"custom-work-items\":\n-            # Get the base queryset\n             queryset = (\n                 Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n                 .select_related(\"workspace\", \"state\", \"parent\")\n                 .prefetch_related(\n                     \"assignees\", \"labels\", \"issue_module__module\", \"issue_cycle__cycle\"\n                 )\n             )\n \n+            # Apply cycle/module filters if present\n+            if cycle_id is not None:\n+                cycle_issues = CycleIssue.objects.filter(\n+                    **self.filters[\"base_filters\"], cycle_id=cycle_id\n+                ).values_list(\"issue_id\", flat=True)\n+                queryset = queryset.filter(id__in=cycle_issues)\n+\n+            elif module_id is not None:\n+                module_issues = ModuleIssue.objects.filter(\n+                    **self.filters[\"base_filters\"], module_id=module_id\n+                ).values_list(\"issue_id\", flat=True)\n+                queryset = queryset.filter(id__in=module_issues)\n+\n             # Apply date range filter if available\n             if self.filters[\"chart_period_range\"]:\n                 start_date, end_date = self.filters[\"chart_period_range\"]\n                 queryset = queryset.filter(\n@@ -356,67 +556,16 @@\n                 status=status.HTTP_200_OK,\n             )\n \n         elif type == \"work-items\":\n+            # Optionally accept cycle_id or module_id as query params\n+            cycle_id = request.GET.get(\"cycle_id\", None)\n+            module_id = request.GET.get(\"module_id\", None)\n+            peek_view = request.GET.get(\"peek_view\", False)\n             return Response(\n-                self.work_item_completion_chart(),\n+                self.work_item_completion_chart(\n+                    cycle_id=cycle_id, module_id=module_id, peek_view=peek_view\n+                ),\n                 status=status.HTTP_200_OK,\n             )\n \n         return Response({\"message\": \"Invalid type\"}, status=status.HTTP_400_BAD_REQUEST)\n-\n-\n-class AdvanceAnalyticsExportEndpoint(AdvanceAnalyticsBaseView):\n-    @allow_permission([ROLE.ADMIN, ROLE.MEMBER], level=\"WORKSPACE\")\n-    def post(self, request: HttpRequest, slug: str) -> Response:\n-        self.initialize_workspace(slug, type=\"chart\")\n-        queryset = Issue.issue_objects.filter(**self.filters[\"base_filters\"])\n-\n-        # Apply date range filter if available\n-        if self.filters[\"chart_period_range\"]:\n-            start_date, end_date = self.filters[\"chart_period_range\"]\n-            queryset = queryset.filter(\n-                created_at__date__gte=start_date, created_at__date__lte=end_date\n-            )\n-\n-        queryset = (\n-            queryset.values(\"project_id\", \"project__name\")\n-            .annotate(\n-                cancelled_work_items=Count(\"id\", filter=Q(state__group=\"cancelled\")),\n-                completed_work_items=Count(\"id\", filter=Q(state__group=\"completed\")),\n-                backlog_work_items=Count(\"id\", filter=Q(state__group=\"backlog\")),\n-                un_started_work_items=Count(\"id\", filter=Q(state__group=\"unstarted\")),\n-                started_work_items=Count(\"id\", filter=Q(state__group=\"started\")),\n-            )\n-            .order_by(\"project_id\")\n-        )\n-\n-        # Convert QuerySet to list of dictionaries for serialization\n-        serialized_data = list(queryset)\n-\n-        headers = [\n-            \"Projects\",\n-            \"Completed Issues\",\n-            \"Backlog Issues\",\n-            \"Unstarted Issues\",\n-            \"Started Issues\",\n-        ]\n-\n-        keys = [\n-            \"project__name\",\n-            \"completed_work_items\",\n-            \"backlog_work_items\",\n-            \"un_started_work_items\",\n-            \"started_work_items\",\n-        ]\n-\n-        email = request.user.email\n-\n-        # Send serialized data to background task\n-        export_analytics_to_csv_email.delay(serialized_data, headers, keys, email, slug)\n-\n-        return Response(\n-            {\n-                \"message\": f\"Once the export is ready it will be emailed to you at {str(email)}\"\n-            },\n-            status=status.HTTP_200_OK,\n-        )\n"
        },
        {
          "path": "apiserver/plane/utils/date_utils.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/utils/date_utils.py\n===================================================================\n--- apiserver/plane/utils/date_utils.py\tba158d5 (parent)\n+++ apiserver/plane/utils/date_utils.py\t5b77639 (commit)\n@@ -173,10 +173,10 @@\n     project_filters = {\n         \"workspace__slug\": slug,\n         \"project_projectmember__member\": user,\n         \"project_projectmember__is_active\": True,\n-        \"project__deleted_at__isnull\": True,\n-        \"project__archived_at__isnull\": True,\n+        \"deleted_at__isnull\": True,\n+        \"archived_at__isnull\": True,\n     }\n \n     # Add project IDs to filters if provided\n     if project_ids:\n"
        },
        {
          "path": "packages/types/src/analytics-v2.d.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/analytics-v2.d.ts\n===================================================================\n--- packages/types/src/analytics-v2.d.ts\tba158d5 (parent)\n+++ packages/types/src/analytics-v2.d.ts\t5b77639 (commit)\n@@ -1,52 +1,55 @@\n import { ChartXAxisProperty, ChartYAxisMetric } from \"@plane/constants\";\n import { TChartData } from \"./charts\";\n \n-export type TAnalyticsTabsV2Base = \"overview\" | \"work-items\"\n-export type TAnalyticsGraphsV2Base = \"projects\" | \"work-items\" | \"custom-work-items\"\n+export type TAnalyticsTabsV2Base = \"overview\" | \"work-items\";\n+export type TAnalyticsGraphsV2Base = \"projects\" | \"work-items\" | \"custom-work-items\";\n \n-\n // service types\n \n export interface IAnalyticsResponseV2 {\n-    [key: string]: any;\n+  [key: string]: any;\n }\n \n export interface IAnalyticsResponseFieldsV2 {\n-    count: number;\n-    filter_count: number;\n+  count: number;\n+  filter_count: number;\n }\n \n export interface IAnalyticsRadarEntityV2 {\n-    key: string,\n-    name: string,\n-    count: number\n+  key: string;\n+  name: string;\n+  count: number;\n }\n \n // chart types\n \n export interface IChartResponseV2 {\n-    schema: Record<string, string>;\n-    data: TChartData<string, string>[];\n+  schema: Record<string, string>;\n+  data: TChartData<string, string>[];\n }\n \n // table types\n \n export interface WorkItemInsightColumns {\n-    project_id: string;\n-    project__name: string;\n-    cancelled_work_items: number;\n-    completed_work_items: number;\n-    backlog_work_items: number;\n-    un_started_work_items: number;\n-    started_work_items: number;\n+  project_id?: string;\n+  project__name?: string;\n+  cancelled_work_items: number;\n+  completed_work_items: number;\n+  backlog_work_items: number;\n+  un_started_work_items: number;\n+  started_work_items: number;\n+  // because of the peek view, we will display the name of the project instead of project__name\n+  display_name?: string;\n+  avatar_url?: string;\n+  assignee_id?: string;\n }\n \n export type AnalyticsTableDataMap = {\n-    \"work-items\": WorkItemInsightColumns,\n-}\n+  \"work-items\": WorkItemInsightColumns;\n+};\n \n export interface IAnalyticsV2Params {\n-    x_axis: ChartXAxisProperty;\n-    y_axis: ChartYAxisMetric;\n-    group_by?: ChartXAxisProperty;\n-}\n\\ No newline at end of file\n+  x_axis: ChartXAxisProperty;\n+  y_axis: ChartYAxisMetric;\n+  group_by?: ChartXAxisProperty;\n+}\n"
        },
        {
          "path": "web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/header.tsx",
          "status": "modified",
          "diff": "Index: web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/header.tsx\n===================================================================\n--- web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/header.tsx\tba158d5 (parent)\n+++ web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/header.tsx\t5b77639 (commit)\n@@ -26,9 +26,9 @@\n } from \"@plane/types\";\n // ui\n import { Breadcrumbs, Button, ContrastIcon, Tooltip, Header, CustomSearchSelect } from \"@plane/ui\";\n // components\n-import { ProjectAnalyticsModal } from \"@/components/analytics\";\n+import { WorkItemsModal } from \"@/components/analytics-v2/work-items/modal\";\n import { BreadcrumbLink, SwitcherLabel } from \"@/components/common\";\n import { CycleQuickActions } from \"@/components/cycles\";\n import { DisplayFiltersSelection, FiltersDropdown, FilterSelection, LayoutSelection } from \"@/components/issues\";\n // helpers\n@@ -160,9 +160,10 @@\n   const workItemsCount = getGroupIssueCount(undefined, undefined, false);\n \n   return (\n     <>\n-      <ProjectAnalyticsModal\n+      <WorkItemsModal\n+        projectDetails={currentProjectDetails}\n         isOpen={analyticsModal}\n         onClose={() => setAnalyticsModal(false)}\n         cycleDetails={cycleDetails ?? undefined}\n       />\n"
        },
        {
          "path": "web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/mobile-header.tsx",
          "status": "modified",
          "diff": "Index: web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/mobile-header.tsx\n===================================================================\n--- web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/mobile-header.tsx\tba158d5 (parent)\n+++ web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/cycles/(detail)/mobile-header.tsx\t5b77639 (commit)\n@@ -18,9 +18,9 @@\n import { IIssueDisplayFilterOptions, IIssueDisplayProperties, IIssueFilterOptions } from \"@plane/types\";\n // ui\n import { CustomMenu } from \"@plane/ui\";\n // components\n-import { ProjectAnalyticsModal } from \"@/components/analytics\";\n+import { WorkItemsModal } from \"@/components/analytics-v2/work-items/modal\";\n import { DisplayFiltersSelection, FilterSelection, FiltersDropdown, IssueLayoutIcon } from \"@/components/issues\";\n // helpers\n import { isIssueFilterActive } from \"@/helpers/filter.helper\";\n // hooks\n@@ -122,9 +122,10 @@\n   );\n \n   return (\n     <>\n-      <ProjectAnalyticsModal\n+      <WorkItemsModal\n+        projectDetails={currentProjectDetails}\n         isOpen={analyticsModal}\n         onClose={() => setAnalyticsModal(false)}\n         cycleDetails={cycleDetails ?? undefined}\n       />\n"
        },
        {
          "path": "web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/header.tsx",
          "status": "modified",
          "diff": "Index: web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/header.tsx\n===================================================================\n--- web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/header.tsx\tba158d5 (parent)\n+++ web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/header.tsx\t5b77639 (commit)\n@@ -24,9 +24,9 @@\n } from \"@plane/types\";\n // ui\n import { Breadcrumbs, Button, DiceIcon, Tooltip, Header, CustomSearchSelect } from \"@plane/ui\";\n // components\n-import { ProjectAnalyticsModal } from \"@/components/analytics\";\n+import { WorkItemsModal } from \"@/components/analytics-v2/work-items/modal\";\n import { BreadcrumbLink, SwitcherLabel } from \"@/components/common\";\n import { DisplayFiltersSelection, FiltersDropdown, FilterSelection, LayoutSelection } from \"@/components/issues\";\n // helpers\n import { ModuleQuickActions } from \"@/components/modules\";\n@@ -154,12 +154,13 @@\n     .filter((option) => option !== undefined) as ICustomSearchSelectOption[];\n \n   return (\n     <>\n-      <ProjectAnalyticsModal\n+      <WorkItemsModal\n         isOpen={analyticsModal}\n         onClose={() => setAnalyticsModal(false)}\n         moduleDetails={moduleDetails ?? undefined}\n+        projectDetails={currentProjectDetails}\n       />\n       <Header>\n         <Header.LeftItem>\n           <Breadcrumbs onBack={router.back} isLoading={loader === \"init-loader\"}>\n"
        },
        {
          "path": "web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/mobile-header.tsx",
          "status": "modified",
          "diff": "Index: web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/mobile-header.tsx\n===================================================================\n--- web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/mobile-header.tsx\tba158d5 (parent)\n+++ web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/modules/(detail)/mobile-header.tsx\t5b77639 (commit)\n@@ -20,8 +20,9 @@\n // ui\n import { CustomMenu } from \"@plane/ui\";\n // components\n import { ProjectAnalyticsModal } from \"@/components/analytics\";\n+import { WorkItemsModal } from \"@/components/analytics-v2/work-items/modal\";\n import {\n   DisplayFiltersSelection,\n   FilterSelection,\n   FiltersDropdown,\n@@ -105,12 +106,13 @@\n   );\n \n   return (\n     <div className=\"block md:hidden\">\n-      <ProjectAnalyticsModal\n+      <WorkItemsModal\n         isOpen={analyticsModal}\n         onClose={() => setAnalyticsModal(false)}\n         moduleDetails={moduleDetails ?? undefined}\n+        projectDetails={currentProjectDetails}\n       />\n       <div className=\"flex justify-evenly border-b border-custom-border-200 bg-custom-background-100 py-2\">\n         <CustomMenu\n           maxHeight={\"md\"}\n"
        },
        {
          "path": "web/core/components/analytics-v2/insight-table/root.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/insight-table/root.tsx\n===================================================================\n--- web/core/components/analytics-v2/insight-table/root.tsx\tba158d5 (parent)\n+++ web/core/components/analytics-v2/insight-table/root.tsx\t5b77639 (commit)\n@@ -20,9 +20,9 @@\n ): React.ReactElement => {\n   const { data, isLoading, columns, columnsLabels } = props;\n   const params = useParams();\n   const { t } = useTranslation();\n-  const workspaceSlug = params.workspaceSlug as string;\n+  const workspaceSlug = params.workspaceSlug.toString();\n   if (isLoading) {\n     return <TableLoader columns={columns} rows={5} />;\n   }\n \n@@ -34,9 +34,9 @@\n   });\n \n   const exportCSV = (rows: Row<AnalyticsTableDataMap[T]>[]) => {\n     const rowData: any = rows.map((row) => {\n-      const { project_id, ...exportableData } = row.original;\n+      const { project_id, avatar_url, assignee_id, ...exportableData } = row.original;\n       return Object.fromEntries(\n         Object.entries(exportableData).map(([key, value]) => {\n           if (columnsLabels?.[key]) {\n             return [columnsLabels[key], value];\n"
        },
        {
          "path": "web/core/components/analytics-v2/overview/project-insights.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/overview/project-insights.tsx\n===================================================================\n--- web/core/components/analytics-v2/overview/project-insights.tsx\tba158d5 (parent)\n+++ web/core/components/analytics-v2/overview/project-insights.tsx\t5b77639 (commit)\n@@ -25,18 +25,22 @@\n \n const ProjectInsights = observer(() => {\n   const params = useParams();\n   const { t } = useTranslation();\n-  const workspaceSlug = params.workspaceSlug as string;\n-  const { selectedDuration, selectedDurationLabel, selectedProjects } = useAnalyticsV2();\n+  const workspaceSlug = params.workspaceSlug.toString();\n+  const { selectedDuration, selectedDurationLabel, selectedProjects, selectedCycle, selectedModule, isPeekView } =\n+    useAnalyticsV2();\n   const resolvedPath = useResolvedAssetPath({ basePath: \"/empty-state/analytics-v2/empty-chart-radar\" });\n \n   const { data: projectInsightsData, isLoading: isLoadingProjectInsight } = useSWR(\n-    `radar-chart-${workspaceSlug}-${selectedDuration}-${selectedProjects}`,\n+    `radar-chart-${workspaceSlug}-${selectedDuration}-${selectedProjects}-${selectedCycle}-${selectedModule}-${isPeekView}`,\n     () =>\n       analyticsV2Service.getAdvanceAnalyticsCharts<TChartData<string, string>[]>(workspaceSlug, \"projects\", {\n         // date_filter: selectedDuration,\n         ...(selectedProjects?.length > 0 && { project_ids: selectedProjects?.join(\",\") }),\n+        ...(selectedCycle ? { cycle_id: selectedCycle } : {}),\n+        ...(selectedModule ? { module_id: selectedModule } : {}),\n+        ...(isPeekView ? { peek_view: true } : {}),\n       })\n   );\n \n   return (\n"
        },
        {
          "path": "web/core/components/analytics-v2/total-insights.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/total-insights.tsx\n===================================================================\n--- web/core/components/analytics-v2/total-insights.tsx\tba158d5 (parent)\n+++ web/core/components/analytics-v2/total-insights.tsx\t5b77639 (commit)\n@@ -17,18 +17,22 @@\n \n const TotalInsights: React.FC<{ analyticsType: TAnalyticsTabsV2Base; peekView?: boolean }> = observer(\n   ({ analyticsType, peekView }) => {\n     const params = useParams();\n-    const workspaceSlug = params.workspaceSlug as string;\n+    const workspaceSlug = params.workspaceSlug.toString();\n     const { t } = useTranslation();\n-    const { selectedDuration, selectedProjects, selectedDurationLabel } = useAnalyticsV2();\n+    const { selectedDuration, selectedProjects, selectedDurationLabel, selectedCycle, selectedModule, isPeekView } =\n+      useAnalyticsV2();\n \n     const { data: totalInsightsData, isLoading } = useSWR(\n-      `total-insights-${analyticsType}-${selectedDuration}-${selectedProjects}`,\n+      `total-insights-${analyticsType}-${selectedDuration}-${selectedProjects}-${selectedCycle}-${selectedModule}-${isPeekView}`,\n       () =>\n         analyticsV2Service.getAdvanceAnalytics<IAnalyticsResponseV2>(workspaceSlug, analyticsType, {\n           // date_filter: selectedDuration,\n           ...(selectedProjects?.length > 0 ? { project_ids: selectedProjects.join(\",\") } : {}),\n+          ...(selectedCycle ? { cycle_id: selectedCycle } : {}),\n+          ...(selectedModule ? { module_id: selectedModule } : {}),\n+          ...(isPeekView ? { peek_view: true } : {}),\n         })\n     );\n     return (\n       <div\n"
        },
        {
          "path": "web/core/components/analytics-v2/work-items/created-vs-resolved.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/work-items/created-vs-resolved.tsx\n===================================================================\n--- web/core/components/analytics-v2/work-items/created-vs-resolved.tsx\tba158d5 (parent)\n+++ web/core/components/analytics-v2/work-items/created-vs-resolved.tsx\t5b77639 (commit)\n@@ -18,19 +18,23 @@\n import { ChartLoader } from \"../loaders\";\n \n const analyticsV2Service = new AnalyticsV2Service();\n const CreatedVsResolved = observer(() => {\n-  const { selectedDuration, selectedDurationLabel, selectedProjects } = useAnalyticsV2();\n+  const { selectedDuration, selectedDurationLabel, selectedProjects, selectedCycle, selectedModule, isPeekView } =\n+    useAnalyticsV2();\n   const params = useParams();\n   const { t } = useTranslation();\n-  const workspaceSlug = params.workspaceSlug as string;\n+  const workspaceSlug = params.workspaceSlug.toString();\n   const resolvedPath = useResolvedAssetPath({ basePath: \"/empty-state/analytics-v2/empty-chart-area\" });\n   const { data: createdVsResolvedData, isLoading: isCreatedVsResolvedLoading } = useSWR(\n-    `created-vs-resolved-${workspaceSlug}-${selectedDuration}-${selectedProjects}`,\n+    `created-vs-resolved-${workspaceSlug}-${selectedDuration}-${selectedProjects}-${selectedCycle}-${selectedModule}-${isPeekView}`,\n     () =>\n       analyticsV2Service.getAdvanceAnalyticsCharts<IChartResponseV2>(workspaceSlug, \"work-items\", {\n         // date_filter: selectedDuration,\n         ...(selectedProjects?.length > 0 && { project_ids: selectedProjects?.join(\",\") }),\n+        ...(selectedCycle ? { cycle_id: selectedCycle } : {}),\n+        ...(selectedModule ? { module_id: selectedModule } : {}),\n+        ...(isPeekView ? { peek_view: true } : {}),\n       })\n   );\n   const parsedData: TChartData<string, string>[] = useMemo(() => {\n     if (!createdVsResolvedData?.data) return [];\n"
        },
        {
          "path": "web/core/components/analytics-v2/work-items/modal/content.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/work-items/modal/content.tsx\n===================================================================\n--- web/core/components/analytics-v2/work-items/modal/content.tsx\tba158d5 (parent)\n+++ web/core/components/analytics-v2/work-items/modal/content.tsx\t5b77639 (commit)\n@@ -1,9 +1,9 @@\n import React, { useEffect, useState } from \"react\";\n import { observer } from \"mobx-react\";\n import { Tab } from \"@headlessui/react\";\n // plane package imports\n-import { IProject } from \"@plane/types\";\n+import { ICycle, IModule, IProject } from \"@plane/types\";\n import { Spinner } from \"@plane/ui\";\n // hooks\n import { useAnalyticsV2 } from \"@/hooks/store\";\n // plane web components\n@@ -14,22 +14,54 @@\n \n type Props = {\n   fullScreen: boolean;\n   projectDetails: IProject | undefined;\n+  cycleDetails: ICycle | undefined;\n+  moduleDetails: IModule | undefined;\n };\n \n export const WorkItemsModalMainContent: React.FC<Props> = observer((props) => {\n-  const { projectDetails, fullScreen } = props;\n-  const { updateSelectedProjects } = useAnalyticsV2();\n-  const [isProjectConfigured, setIsProjectConfigured] = useState(false);\n+  const { projectDetails, cycleDetails, moduleDetails, fullScreen } = props;\n+  const { updateSelectedProjects, updateSelectedCycle, updateSelectedModule, updateIsPeekView } = useAnalyticsV2();\n+  const [isModalConfigured, setIsModalConfigured] = useState(false);\n \n   useEffect(() => {\n-    if (!projectDetails?.id) return;\n-    updateSelectedProjects([projectDetails?.id ?? \"\"]);\n-    setIsProjectConfigured(true);\n-  }, [projectDetails?.id, updateSelectedProjects]);\n+    updateIsPeekView(true);\n \n-  if (!isProjectConfigured)\n+    // Handle project selection\n+    if (projectDetails?.id) {\n+      updateSelectedProjects([projectDetails.id]);\n+    }\n+\n+    // Handle cycle selection\n+    if (cycleDetails?.id) {\n+      updateSelectedCycle(cycleDetails.id);\n+    }\n+\n+    // Handle module selection\n+    if (moduleDetails?.id) {\n+      updateSelectedModule(moduleDetails.id);\n+    }\n+    setIsModalConfigured(true);\n+\n+    // Cleanup fields\n+    return () => {\n+      updateSelectedProjects([]);\n+      updateSelectedCycle(\"\");\n+      updateSelectedModule(\"\");\n+      updateIsPeekView(false);\n+    };\n+  }, [\n+    projectDetails?.id,\n+    cycleDetails?.id,\n+    moduleDetails?.id,\n+    updateSelectedProjects,\n+    updateSelectedCycle,\n+    updateSelectedModule,\n+    updateIsPeekView,\n+  ]);\n+\n+  if (!isModalConfigured)\n     return (\n       <div className=\"flex h-full items-center justify-center\">\n         <Spinner />\n       </div>\n"
        },
        {
          "path": "web/core/components/analytics-v2/work-items/modal/header.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/work-items/modal/header.tsx\n===================================================================\n--- web/core/components/analytics-v2/work-items/modal/header.tsx\tba158d5 (parent)\n+++ web/core/components/analytics-v2/work-items/modal/header.tsx\t5b77639 (commit)\n@@ -1,22 +1,27 @@\n import { observer } from \"mobx-react\";\n-\n-// icons\n+// plane package imports\n import { Expand, Shrink, X } from \"lucide-react\";\n+import { ICycle, IModule } from \"@plane/types\";\n+// icons\n \n type Props = {\n   fullScreen: boolean;\n   handleClose: () => void;\n   setFullScreen: React.Dispatch<React.SetStateAction<boolean>>;\n   title: string;\n+  cycle?: ICycle;\n+  module?: IModule;\n };\n \n export const WorkItemsModalHeader: React.FC<Props> = observer((props) => {\n-  const { fullScreen, handleClose, setFullScreen, title } = props;\n+  const { fullScreen, handleClose, setFullScreen, title, cycle, module } = props;\n \n   return (\n     <div className=\"flex items-center justify-between gap-4 bg-custom-background-100 px-5 py-4 text-sm\">\n-      <h3 className=\"break-words\">Analytics for {title}</h3>\n+      <h3 className=\"break-words\">\n+        Analytics for {title} {cycle && `in ${cycle.name}`} {module && `in ${module.name}`}\n+      </h3>\n       <div className=\"flex items-center gap-2\">\n         <button\n           type=\"button\"\n           className=\"hidden place-items-center p-1 text-custom-text-200 hover:text-custom-text-100 md:grid\"\n"
        },
        {
          "path": "web/core/components/analytics-v2/work-items/modal/index.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/work-items/modal/index.tsx\n===================================================================\n--- web/core/components/analytics-v2/work-items/modal/index.tsx\tba158d5 (parent)\n+++ web/core/components/analytics-v2/work-items/modal/index.tsx\t5b77639 (commit)\n@@ -1,21 +1,23 @@\n import React, { useState } from \"react\";\n import { observer } from \"mobx-react\";\n import { Dialog, Transition } from \"@headlessui/react\";\n // plane package imports\n-import { IProject } from \"@plane/types\";\n+import { ICycle, IModule, IProject } from \"@plane/types\";\n // plane web components\n import { WorkItemsModalMainContent } from \"./content\";\n import { WorkItemsModalHeader } from \"./header\";\n \n type Props = {\n   isOpen: boolean;\n   onClose: () => void;\n   projectDetails?: IProject | undefined;\n+  cycleDetails?: ICycle | undefined;\n+  moduleDetails?: IModule | undefined;\n };\n \n export const WorkItemsModal: React.FC<Props> = observer((props) => {\n-  const { isOpen, onClose, projectDetails } = props;\n+  const { isOpen, onClose, projectDetails, moduleDetails, cycleDetails } = props;\n \n   const [fullScreen, setFullScreen] = useState(false);\n \n   const handleClose = () => {\n@@ -50,10 +52,17 @@\n                     fullScreen={fullScreen}\n                     handleClose={handleClose}\n                     setFullScreen={setFullScreen}\n                     title={projectDetails?.name ?? \"\"}\n+                    cycle={cycleDetails}\n+                    module={moduleDetails}\n                   />\n-                  <WorkItemsModalMainContent fullScreen={fullScreen} projectDetails={projectDetails} />\n+                  <WorkItemsModalMainContent\n+                    fullScreen={fullScreen}\n+                    projectDetails={projectDetails}\n+                    cycleDetails={cycleDetails}\n+                    moduleDetails={moduleDetails}\n+                  />\n                 </div>\n               </div>\n             </Dialog.Panel>\n           </div>\n"
        },
        {
          "path": "web/core/components/analytics-v2/work-items/priority-chart.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/work-items/priority-chart.tsx\n===================================================================\n--- web/core/components/analytics-v2/work-items/priority-chart.tsx\tba158d5 (parent)\n+++ web/core/components/analytics-v2/work-items/priority-chart.tsx\t5b77639 (commit)\n@@ -45,21 +45,25 @@\n   const { x_axis, y_axis, group_by } = props;\n   const { t } = useTranslation();\n   const resolvedPath = useResolvedAssetPath({ basePath: \"/empty-state/analytics-v2/empty-chart-bar\" });\n   // store hooks\n-  const { selectedDuration, selectedProjects } = useAnalyticsV2();\n+  const { selectedDuration, selectedProjects, selectedCycle, selectedModule, isPeekView } = useAnalyticsV2();\n   const { workspaceStates } = useProjectState();\n   const { resolvedTheme } = useTheme();\n   // router\n   const params = useParams();\n-  const workspaceSlug = params.workspaceSlug as string;\n+  const workspaceSlug = params.workspaceSlug.toString();\n \n   const { data: priorityChartData, isLoading: priorityChartLoading } = useSWR(\n-    `customized-insights-chart-${workspaceSlug}-${selectedDuration}-${selectedProjects}-${props.x_axis}-${props.y_axis}-${props.group_by}`,\n+    `customized-insights-chart-${workspaceSlug}-${selectedDuration}-\n+    ${selectedProjects}-${selectedCycle}-${selectedModule}-${props.x_axis}-${props.y_axis}-${props.group_by}-${isPeekView}`,\n     () =>\n       analyticsV2Service.getAdvanceAnalyticsCharts<TChart>(workspaceSlug, \"custom-work-items\", {\n         // date_filter: selectedDuration,\n         ...(selectedProjects?.length > 0 && { project_ids: selectedProjects?.join(\",\") }),\n+        ...(selectedCycle ? { cycle_id: selectedCycle } : {}),\n+        ...(selectedModule ? { module_id: selectedModule } : {}),\n+        ...(isPeekView ? { peek_view: true } : {}),\n         ...props,\n       })\n   );\n   const parsedData = useMemo(\n@@ -157,12 +161,25 @@\n     useKeysAsHeaders: true,\n   });\n \n   const exportCSV = (rows: Row<TChartDatum>[]) => {\n-    const rowData = rows.map((row) => ({\n-      name: row.original.name,\n-      count: row.original.count,\n-    }));\n+    const rowData = rows.map((row) => {\n+      const hiddenFields = [\"key\", \"avatar_url\", \"assignee_id\", \"project_id\"];\n+      const otherFields = Object.keys(row.original).filter(\n+        (key) => key !== \"name\" && key !== \"count\" && !hiddenFields.includes(key) && !key.includes(\"id\")\n+      );\n+      return {\n+        name: row.original.name,\n+        count: row.original.count,\n+        ...otherFields.reduce(\n+          (acc, key) => {\n+            acc[parsedData?.schema[key] ?? key] = row.original[key];\n+            return acc;\n+          },\n+          {} as Record<string, string | number>\n+        ),\n+      };\n+    });\n     const csv = generateCsv(csvConfig)(rowData);\n     download(csvConfig)(csv);\n   };\n \n"
        },
        {
          "path": "web/core/components/analytics-v2/work-items/workitems-insight-table.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/analytics-v2/work-items/workitems-insight-table.tsx\n===================================================================\n--- web/core/components/analytics-v2/work-items/workitems-insight-table.tsx\tba158d5 (parent)\n+++ web/core/components/analytics-v2/work-items/workitems-insight-table.tsx\t5b77639 (commit)\n@@ -1,14 +1,16 @@\n import { useMemo } from \"react\";\n-import { ColumnDef } from \"@tanstack/react-table\";\n+import { ColumnDef, Row } from \"@tanstack/react-table\";\n import { observer } from \"mobx-react\";\n import { useParams } from \"next/navigation\";\n import useSWR from \"swr\";\n-import { Briefcase } from \"lucide-react\";\n+import { Briefcase, UserRound } from \"lucide-react\";\n // plane package imports\n import { useTranslation } from \"@plane/i18n\";\n import { WorkItemInsightColumns, AnalyticsTableDataMap } from \"@plane/types\";\n // plane web components\n+import { Avatar } from \"@plane/ui\";\n+import { getFileURL } from \"@plane/utils\";\n import { Logo } from \"@/components/common/logo\";\n // hooks\n import { useAnalyticsV2 } from \"@/hooks/store/use-analytics-v2\";\n import { useProject } from \"@/hooks/store/use-project\";\n@@ -20,47 +22,88 @@\n \n const WorkItemsInsightTable = observer(() => {\n   // router\n   const params = useParams();\n-  const workspaceSlug = params.workspaceSlug as string;\n+  const workspaceSlug = params.workspaceSlug.toString();\n   const { t } = useTranslation();\n   // store hooks\n   const { getProjectById } = useProject();\n-  const { selectedDuration, selectedProjects } = useAnalyticsV2();\n+  const { selectedDuration, selectedProjects, selectedCycle, selectedModule, isPeekView } = useAnalyticsV2();\n   const { data: workItemsData, isLoading } = useSWR(\n-    `insights-table-work-items-${workspaceSlug}-${selectedDuration}-${selectedProjects}`,\n+    `insights-table-work-items-${workspaceSlug}-${selectedDuration}-${selectedProjects}-${selectedCycle}-${selectedModule}-${isPeekView}`,\n     () =>\n       analyticsV2Service.getAdvanceAnalyticsStats<WorkItemInsightColumns[]>(workspaceSlug, \"work-items\", {\n         // date_filter: selectedDuration,\n         ...(selectedProjects?.length > 0 ? { project_ids: selectedProjects.join(\",\") } : {}),\n+        ...(selectedCycle ? { cycle_id: selectedCycle } : {}),\n+        ...(selectedModule ? { module_id: selectedModule } : {}),\n+        ...(isPeekView ? { peek_view: true } : {}),\n       })\n   );\n   // derived values\n-  const columnsLabels: Record<string, string> = {\n-    backlog_work_items: t(\"workspace_projects.state.backlog\"),\n-    started_work_items: t(\"workspace_projects.state.started\"),\n-    un_started_work_items: t(\"workspace_projects.state.unstarted\"),\n-    completed_work_items: t(\"workspace_projects.state.completed\"),\n-    cancelled_work_items: t(\"workspace_projects.state.cancelled\"),\n-    project__name: t(\"common.project\"),\n-  };\n+  const columnsLabels = useMemo(\n+    () => ({\n+      backlog_work_items: t(\"workspace_projects.state.backlog\"),\n+      started_work_items: t(\"workspace_projects.state.started\"),\n+      un_started_work_items: t(\"workspace_projects.state.unstarted\"),\n+      completed_work_items: t(\"workspace_projects.state.completed\"),\n+      cancelled_work_items: t(\"workspace_projects.state.cancelled\"),\n+      project__name: t(\"common.project\"),\n+      display_name: t(\"common.assignee\"),\n+    }),\n+    [t]\n+  );\n   const columns = useMemo(\n     () =>\n       [\n+        !isPeekView\n+          ? {\n+              accessorKey: \"project__name\",\n+              header: () => <div className=\"text-left\">{columnsLabels[\"project__name\"]}</div>,\n+              cell: ({ row }) => {\n+                const project = getProjectById(row.original.project_id);\n+                return (\n+                  <div className=\"flex items-center gap-2\">\n+                    {project?.logo_props ? (\n+                      <Logo logo={project.logo_props} size={18} />\n+                    ) : (\n+                      <Briefcase className=\"h-4 w-4\" />\n+                    )}\n+                    {project?.name}\n+                  </div>\n+                );\n+              },\n+            }\n+          : {\n+              accessorKey: \"display_name\",\n+              header: () => <div className=\"text-left\">{columnsLabels[\"display_name\"]}</div>,\n+              cell: ({ row }: { row: Row<WorkItemInsightColumns> }) => (\n+                <div className=\"text-left\">\n+                  <div className=\"flex items-center gap-2\">\n+                    {row.original.avatar_url && row.original.avatar_url !== \"\" ? (\n+                      <Avatar\n+                        name={row.original.display_name}\n+                        src={getFileURL(row.original.avatar_url)}\n+                        size={24}\n+                        shape=\"circle\"\n+                      />\n+                    ) : (\n+                      <div className=\"flex h-4 w-4 flex-shrink-0 items-center justify-center rounded-full bg-custom-background-80  capitalize overflow-hidden\">\n+                        {row.original.display_name ? (\n+                          row.original.display_name?.[0]\n+                        ) : (\n+                          <UserRound className=\"text-custom-text-200 \" size={12} />\n+                        )}\n+                      </div>\n+                    )}\n+                    <span className=\"break-words text-custom-text-200\">\n+                      {row.original.display_name ?? t(`Unassigned`)}\n+                    </span>\n+                  </div>\n+                </div>\n+              ),\n+            },\n         {\n-          accessorKey: \"project__name\",\n-          header: () => <div className=\"text-left\">{columnsLabels[\"project__name\"]}</div>,\n-          cell: ({ row }) => {\n-            const project = getProjectById(row.original.project_id);\n-            return (\n-              <div className=\"flex items-center gap-2\">\n-                {project?.logo_props ? <Logo logo={project.logo_props} size={18} /> : <Briefcase className=\"h-4 w-4\" />}\n-                {project?.name}\n-              </div>\n-            );\n-          },\n-        },\n-        {\n           accessorKey: \"backlog_work_items\",\n           header: () => <div className=\"text-right\">{columnsLabels[\"backlog_work_items\"]}</div>,\n           cell: ({ row }) => <div className=\"text-right\">{row.original.backlog_work_items}</div>,\n         },\n@@ -84,9 +127,9 @@\n           header: () => <div className=\"text-right\">{columnsLabels[\"cancelled_work_items\"]}</div>,\n           cell: ({ row }) => <div className=\"text-right\">{row.original.cancelled_work_items}</div>,\n         },\n       ] as ColumnDef<AnalyticsTableDataMap[\"work-items\"]>[],\n-    [getProjectById]\n+    [columnsLabels, getProjectById, isPeekView, t]\n   );\n \n   return (\n     <InsightTable<\"work-items\">\n"
        },
        {
          "path": "web/core/components/analytics/old-page.tsx",
          "status": "added",
          "diff": "Index: web/core/components/analytics/old-page.tsx\n===================================================================\n--- web/core/components/analytics/old-page.tsx\tba158d5 (parent)\n+++ web/core/components/analytics/old-page.tsx\t5b77639 (commit)\n@@ -0,0 +1,107 @@\n+\"use client\";\n+\n+import React, { Fragment } from \"react\";\n+import { observer } from \"mobx-react\";\n+import { useSearchParams } from \"next/navigation\";\n+import { Tab } from \"@headlessui/react\";\n+// plane package imports\n+import { ANALYTICS_TABS, EUserPermissionsLevel, EUserPermissions } from \"@plane/constants\";\n+import { useTranslation } from \"@plane/i18n\";\n+import { Header, EHeaderVariant } from \"@plane/ui\";\n+// components\n+import { CustomAnalytics, ScopeAndDemand } from \"@/components/analytics\";\n+import { PageHead } from \"@/components/core\";\n+import { ComicBoxButton, DetailedEmptyState } from \"@/components/empty-state\";\n+// hooks\n+import { useCommandPalette, useEventTracker, useProject, useUserPermissions, useWorkspace } from \"@/hooks/store\";\n+import { useResolvedAssetPath } from \"@/hooks/use-resolved-asset-path\";\n+\n+const OldAnalyticsPage = observer(() => {\n+  const searchParams = useSearchParams();\n+  const analytics_tab = searchParams.get(\"analytics_tab\");\n+  // plane imports\n+  const { t } = useTranslation();\n+  // store hooks\n+  const { toggleCreateProjectModal } = useCommandPalette();\n+  const { setTrackElement } = useEventTracker();\n+  const { workspaceProjectIds, loader } = useProject();\n+  const { currentWorkspace } = useWorkspace();\n+  const { allowPermissions } = useUserPermissions();\n+  // helper hooks\n+  const resolvedPath = useResolvedAssetPath({ basePath: \"/empty-state/onboarding/analytics\" });\n+  // derived values\n+  const pageTitle = currentWorkspace?.name\n+    ? t(`workspace_analytics.page_label`, { workspace: currentWorkspace?.name })\n+    : undefined;\n+\n+  // permissions\n+  const canPerformEmptyStateActions = allowPermissions(\n+    [EUserPermissions.ADMIN, EUserPermissions.MEMBER],\n+    EUserPermissionsLevel.WORKSPACE\n+  );\n+\n+  // TODO: refactor loader implementation\n+  return (\n+    <>\n+      <PageHead title={pageTitle} />\n+      {workspaceProjectIds && (\n+        <>\n+          {workspaceProjectIds.length > 0 || loader === \"init-loader\" ? (\n+            <div className=\"flex h-full flex-col overflow-hidden bg-custom-background-100\">\n+              <Tab.Group as={Fragment} defaultIndex={analytics_tab === \"custom\" ? 1 : 0}>\n+                <Header variant={EHeaderVariant.SECONDARY}>\n+                  <Tab.List as=\"div\" className=\"flex space-x-2 h-full\">\n+                    {ANALYTICS_TABS.map((tab) => (\n+                      <Tab key={tab.key} as={Fragment}>\n+                        {({ selected }) => (\n+                          <button\n+                            className={`text-sm group relative flex items-center gap-1 h-full px-3 cursor-pointer transition-all font-medium outline-none  ${\n+                              selected ? \"text-custom-primary-100 \" : \"hover:text-custom-text-200\"\n+                            }`}\n+                          >\n+                            {t(tab.i18n_title)}\n+                            <div\n+                              className={`border absolute bottom-0 right-0 left-0 rounded-t-md ${selected ? \"border-custom-primary-100\" : \"border-transparent group-hover:border-custom-border-200\"}`}\n+                            />\n+                          </button>\n+                        )}\n+                      </Tab>\n+                    ))}\n+                  </Tab.List>\n+                </Header>\n+                <Tab.Panels as={Fragment}>\n+                  <Tab.Panel as={Fragment}>\n+                    <ScopeAndDemand fullScreen />\n+                  </Tab.Panel>\n+                  <Tab.Panel as={Fragment}>\n+                    <CustomAnalytics fullScreen />\n+                  </Tab.Panel>\n+                </Tab.Panels>\n+              </Tab.Group>\n+            </div>\n+          ) : (\n+            <DetailedEmptyState\n+              title={t(\"workspace_analytics.empty_state.general.title\")}\n+              description={t(\"workspace_analytics.empty_state.general.description\")}\n+              assetPath={resolvedPath}\n+              customPrimaryButton={\n+                <ComicBoxButton\n+                  label={t(\"workspace_analytics.empty_state.general.primary_button.text\")}\n+                  title={t(\"workspace_analytics.empty_state.general.primary_button.comic.title\")}\n+                  description={t(\"workspace_analytics.empty_state.general.primary_button.comic.description\")}\n+                  onClick={() => {\n+                    setTrackElement(\"Analytics empty state\");\n+                    toggleCreateProjectModal(true);\n+                  }}\n+                  disabled={!canPerformEmptyStateActions}\n+                />\n+              }\n+            />\n+          )}\n+        </>\n+      )}\n+    </>\n+  );\n+});\n+\n+export default OldAnalyticsPage;\n"
        },
        {
          "path": "web/core/store/analytics-v2.store.ts",
          "status": "modified",
          "diff": "Index: web/core/store/analytics-v2.store.ts\n===================================================================\n--- web/core/store/analytics-v2.store.ts\tba158d5 (parent)\n+++ web/core/store/analytics-v2.store.ts\t5b77639 (commit)\n@@ -9,43 +9,56 @@\n   //observables\n   currentTab: TAnalyticsTabsV2Base;\n   selectedProjects: string[];\n   selectedDuration: DurationType;\n+  selectedCycle: string;\n+  selectedModule: string;\n+  isPeekView?: boolean;\n \n   //computed\n   selectedDurationLabel: DurationType | null;\n \n   //actions\n   updateSelectedProjects: (projects: string[]) => void;\n   updateSelectedDuration: (duration: DurationType) => void;\n+  updateSelectedCycle: (cycle: string) => void;\n+  updateSelectedModule: (module: string) => void;\n+  updateIsPeekView: (isPeekView: boolean) => void;\n }\n \n export class AnalyticsStoreV2 implements IAnalyticsStoreV2 {\n   //observables\n   currentTab: TAnalyticsTabsV2Base = \"overview\";\n-  selectedProjects: DurationType[] = [];\n+  selectedProjects: string[] = [];\n   selectedDuration: DurationType = \"last_30_days\";\n-\n-  constructor(_rootStore: CoreRootStore) {\n+  selectedCycle: string = \"\";\n+  selectedModule: string = \"\";\n+  isPeekView: boolean = false;\n+  constructor() {\n     makeObservable(this, {\n       // observables\n       currentTab: observable.ref,\n       selectedDuration: observable.ref,\n       selectedProjects: observable.ref,\n+      selectedCycle: observable.ref,\n+      selectedModule: observable.ref,\n+      isPeekView: observable.ref,\n       // computed\n       selectedDurationLabel: computed,\n       // actions\n       updateSelectedProjects: action,\n       updateSelectedDuration: action,\n+      updateSelectedCycle: action,\n+      updateSelectedModule: action,\n+      updateIsPeekView: action,\n     });\n   }\n \n   get selectedDurationLabel() {\n     return ANALYTICS_V2_DURATION_FILTER_OPTIONS.find((item) => item.value === this.selectedDuration)?.name ?? null;\n   }\n \n   updateSelectedProjects = (projects: string[]) => {\n-    const initialState = this.selectedProjects;\n     try {\n       runInAction(() => {\n         this.selectedProjects = projects;\n       });\n@@ -64,5 +77,23 @@\n       console.error(\"Failed to update selected duration\");\n       throw error;\n     }\n   };\n+\n+  updateSelectedCycle = (cycle: string) => {\n+    runInAction(() => {\n+      this.selectedCycle = cycle;\n+    });\n+  };\n+\n+  updateSelectedModule = (module: string) => {\n+    runInAction(() => {\n+      this.selectedModule = module;\n+    });\n+  };\n+\n+  updateIsPeekView = (isPeekView: boolean) => {\n+    runInAction(() => {\n+      this.isPeekView = isPeekView;\n+    });\n+  };\n }\n"
        },
        {
          "path": "web/core/store/root.store.ts",
          "status": "modified",
          "diff": "Index: web/core/store/root.store.ts\n===================================================================\n--- web/core/store/root.store.ts\tba158d5 (parent)\n+++ web/core/store/root.store.ts\t5b77639 (commit)\n@@ -95,9 +95,9 @@\n     this.favorite = new FavoriteStore(this);\n     this.transient = new TransientStore();\n     this.stickyStore = new StickyStore();\n     this.editorAssetStore = new EditorAssetStore();\n-    this.analyticsV2 = new AnalyticsStoreV2(this);\n+    this.analyticsV2 = new AnalyticsStoreV2();\n   }\n \n   resetOnSignOut() {\n     // handling the system theme when user logged out from the app\n"
        }
      ]
    },
    {
      "id": "add-workspace-seed",
      "sha": "298e3dc9cab15d9486ca7b48de4eaf11dcbdbbc2",
      "parentSha": "190300bc6c572da38a432315415101f066bb2f25",
      "spec": "Implement background seeding of a newly created workspace with a default project, workflow states, labels, and example issues.\n\nScope and behaviors:\n- When a workspace is created via the WorkSpaceViewSet.create endpoint, enqueue a background Celery task that seeds the workspace with a project (named after the workspace with a derived short identifier), members, default user properties, states, labels, and issues.\n- Seed data is loaded from JSON files under settings.SEED_DIR/data/.\n- Log informative messages throughout: task start, each entity creation, successful completion, and errors (missing files, JSON parsing issues, missing required fields). If project seeds are missing, log a warning and skip project creation.\n\nRequired changes by file:\n1) apiserver/plane/app/views/workspace/base.py\n- Import the seeding task: from plane.bgtasks.workspace_seed_task import workspace_seed\n- In WorkSpaceViewSet.create, after creating the workspace and WorkspaceMember and before returning the response, enqueue the background task: workspace_seed.delay(serializer.data[\"id\"]).\n\n2) apiserver/plane/bgtasks/workspace_seed_task.py (new file)\n- Define a logger: logging.getLogger(\"plane.worker\").\n- Implement read_seed_file(filename):\n  - Build path as os.path.join(settings.SEED_DIR, \"data\", filename).\n  - Return parsed JSON or None; on FileNotFoundError or JSONDecodeError, log an error and return None.\n- Implement create_project_and_member(workspace) -> Dict[int, uuid.UUID]:\n  - Read projects.json. If empty/missing, log a warning and return {}.\n  - Create a project per seed with:\n    - name = workspace.name (override seed name)\n    - identifier = first 5 alphanumeric chars of workspace.name\n    - workspace, created_by_id = workspace.created_by_id, and remaining seed fields (excluding id, name, identifier)\n  - Bulk create ProjectMember for each WorkspaceMember (copy role) with created_by_id set.\n  - Bulk create IssueUserProperty for each workspace member with default display_filters (group_by=None, order_by=\"sort_order\", type=None, sub_issue=True, show_empty_groups=True, layout=\"list\", calendar_date_range=\"\") and created_by_id.\n  - Return mapping of seed project id -> created Project id.\n- Implement create_project_states(workspace, project_map) -> Dict[int, uuid.UUID]:\n  - Read states.json; for each seed, map project_id via project_map, create State with workspace and created_by_id; return mapping of seed state id -> created State id.\n- Implement create_project_labels(workspace, project_map) -> Dict[int, uuid.UUID]:\n  - Read labels.json; for each seed, map project_id via project_map, create Label with workspace and created_by_id; return mapping of seed label id -> created Label id.\n- Implement create_project_issues(workspace, project_map, states_map, labels_map) -> None:\n  - Read issues.json. For each seed, validate required fields [\"id\", \"labels\", \"project_id\", \"state_id\"]. If missing, log an error and skip that seed.\n  - Create Issue with mapped state_id and project_id, workspace, created_by_id, and remaining seed fields.\n  - Create IssueSequence for the issue with project_id and workspace_id.\n  - Create an IssueActivity for the issue marking a \"created\" event (comment=\"created the issue\", verb=\"created\", actor_id=workspace.created_by_id, epoch=time.time()).\n  - For each label id in labels, create IssueLabel mapping to the created issue and mapped label_id.\n- Implement the Celery task @shared_task workspace_seed(workspace_id: uuid.UUID) -> None:\n  - Log start, load Workspace by id, then call the helper functions in order to create project(s), states, labels, and issues.\n  - On success, log completion; on exception, log an error and re-raise.\n\n3) apiserver/plane/settings/common.py\n- Define the seed directory path at the end of the file:\n  - SEED_DIR = os.path.join(BASE_DIR, \"seeds\")\n\n4) Seed data files under apiserver/plane/seeds/data/\n- projects.json: Array of objects with at least id, name, identifier, and other project attributes referenced by create. Name and identifier are overridden as described.\n- states.json: Array of objects with id, name, color, sequence, group, default, project_id (seed id).\n- labels.json: Array of objects with id, name, color, sort_order, project_id (seed id).\n- issues.json: Array of objects with id, name, description_html, description_stripped, sort_order, state_id (seed id), labels (array of seed label ids), priority, project_id (seed id).\n\nNotes:\n- plane.bgtasks is already an installed app; shared_task discovery via app.autodiscover_tasks suffices (no changes to CELERY_IMPORTS required).\n- Ensure all created rows set workspace and created_by_id consistently, matching patterns across the codebase.\n",
      "prompt": "Add a background onboarding process so that when a workspace is created, it is automatically populated with a default project, workflow states, labels, and a few example issues. Load this content from JSON seed files in a dedicated seeds directory. Hook the workspace creation endpoint to enqueue a background task that performs the seeding. Use reasonable defaults for the project identifier based on the workspace name, copy existing workspace members into the new project with appropriate roles, set up default user display properties, and log progress and errors throughout the process. The task should read from the configured seed directory path in settings and proceed even if some seed files or records are missing, logging any issues.",
      "supplementalFiles": [
        "apiserver/plane/celery.py",
        "apiserver/plane/app/urls/workspace.py",
        "apiserver/plane/app/views/__init__.py",
        "apiserver/plane/settings/redis.py",
        "apiserver/plane/bgtasks/issue_activities_task.py"
      ],
      "fileDiffs": [
        {
          "path": "apiserver/plane/app/views/workspace/base.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/views/workspace/base.py\n===================================================================\n--- apiserver/plane/app/views/workspace/base.py\t190300b (parent)\n+++ apiserver/plane/app/views/workspace/base.py\t298e3dc (commit)\n@@ -41,8 +41,9 @@\n from django.views.decorators.cache import cache_control\n from django.views.decorators.vary import vary_on_cookie\n from plane.utils.constants import RESTRICTED_WORKSPACE_SLUGS\n from plane.license.utils.instance_value import get_configuration_value\n+from plane.bgtasks.workspace_seed_task import workspace_seed\n \n \n class WorkSpaceViewSet(BaseViewSet):\n     model = Workspace\n@@ -125,8 +126,10 @@\n                 data = serializer.data\n                 data[\"total_members\"] = total_members\n                 data[\"role\"] = 20\n \n+                workspace_seed.delay(serializer.data[\"id\"])\n+\n                 return Response(data, status=status.HTTP_201_CREATED)\n             return Response(\n                 [serializer.errors[error][0] for error in serializer.errors],\n                 status=status.HTTP_400_BAD_REQUEST,\n"
        },
        {
          "path": "apiserver/plane/bgtasks/workspace_seed_task.py",
          "status": "added",
          "diff": "Index: apiserver/plane/bgtasks/workspace_seed_task.py\n===================================================================\n--- apiserver/plane/bgtasks/workspace_seed_task.py\t190300b (parent)\n+++ apiserver/plane/bgtasks/workspace_seed_task.py\t298e3dc (commit)\n@@ -0,0 +1,319 @@\n+# Python imports\n+import os\n+import json\n+import time\n+import uuid\n+from typing import Dict\n+import logging\n+\n+# Django imports\n+from django.conf import settings\n+\n+# Third party imports\n+from celery import shared_task\n+\n+# Module imports\n+from plane.db.models import (\n+    Workspace,\n+    WorkspaceMember,\n+    Project,\n+    ProjectMember,\n+    IssueUserProperty,\n+    State,\n+    Label,\n+    Issue,\n+    IssueLabel,\n+    IssueSequence,\n+    IssueActivity,\n+)\n+\n+logger = logging.getLogger(\"plane.worker\")\n+\n+\n+def read_seed_file(filename):\n+    \"\"\"\n+    Read a JSON file from the seed directory.\n+\n+    Args:\n+        filename (str): Name of the JSON file to read\n+\n+    Returns:\n+        dict: Contents of the JSON file\n+    \"\"\"\n+    file_path = os.path.join(settings.SEED_DIR, \"data\", filename)\n+    try:\n+        with open(file_path, \"r\") as file:\n+            return json.load(file)\n+    except FileNotFoundError:\n+        logger.error(f\"Seed file {filename} not found in {settings.SEED_DIR}/data\")\n+        return None\n+    except json.JSONDecodeError:\n+        logger.error(f\"Error decoding JSON from {filename}\")\n+        return None\n+\n+\n+def create_project_and_member(workspace: Workspace) -> Dict[int, uuid.UUID]:\n+    \"\"\"Creates a project and associated members for a workspace.\n+\n+    Creates a new project using the workspace name and sets up all necessary\n+    member associations and user properties.\n+\n+    Args:\n+        workspace: The workspace to create the project in\n+\n+    Returns:\n+        A mapping of seed project IDs to actual project IDs\n+    \"\"\"\n+    project_seeds = read_seed_file(\"projects.json\")\n+    project_identifier = \"\".join(ch for ch in workspace.name if ch.isalnum())[:5]\n+\n+    # Create members\n+    workspace_members = WorkspaceMember.objects.filter(workspace=workspace).values(\n+        \"member_id\", \"role\"\n+    )\n+\n+    projects_map: Dict[int, uuid.UUID] = {}\n+\n+    if not project_seeds:\n+        logger.warning(\n+            \"Task: workspace_seed_task -> No project seeds found. Skipping project creation.\"\n+        )\n+        return projects_map\n+\n+    for project_seed in project_seeds:\n+        project_id = project_seed.pop(\"id\")\n+        # Remove the name from seed data since we want to use workspace name\n+        project_seed.pop(\"name\", None)\n+        project_seed.pop(\"identifier\", None)\n+\n+        project = Project.objects.create(\n+            **project_seed,\n+            workspace=workspace,\n+            name=workspace.name,  # Use workspace name\n+            identifier=project_identifier,\n+            created_by_id=workspace.created_by_id,\n+        )\n+\n+        # Create project members\n+        ProjectMember.objects.bulk_create(\n+            [\n+                ProjectMember(\n+                    project=project,\n+                    member_id=workspace_member[\"member_id\"],\n+                    role=workspace_member[\"role\"],\n+                    workspace_id=workspace.id,\n+                    created_by_id=workspace.created_by_id,\n+                )\n+                for workspace_member in workspace_members\n+            ]\n+        )\n+\n+        # Create issue user properties\n+        IssueUserProperty.objects.bulk_create(\n+            [\n+                IssueUserProperty(\n+                    project=project,\n+                    user_id=workspace_member[\"member_id\"],\n+                    workspace_id=workspace.id,\n+                    display_filters={\n+                        \"group_by\": None,\n+                        \"order_by\": \"sort_order\",\n+                        \"type\": None,\n+                        \"sub_issue\": True,\n+                        \"show_empty_groups\": True,\n+                        \"layout\": \"list\",\n+                        \"calendar_date_range\": \"\",\n+                    },\n+                    created_by_id=workspace.created_by_id,\n+                )\n+                for workspace_member in workspace_members\n+            ]\n+        )\n+        # update map\n+        projects_map[project_id] = project.id\n+        logger.info(f\"Task: workspace_seed_task -> Project {project_id} created\")\n+\n+    return projects_map\n+\n+\n+def create_project_states(\n+    workspace: Workspace, project_map: Dict[int, uuid.UUID]\n+) -> Dict[int, uuid.UUID]:\n+    \"\"\"Creates states for each project in the workspace.\n+\n+    Args:\n+        workspace: The workspace containing the projects\n+        project_map: Mapping of seed project IDs to actual project IDs\n+\n+    Returns:\n+        A mapping of seed state IDs to actual state IDs\n+    \"\"\"\n+\n+    state_seeds = read_seed_file(\"states.json\")\n+    state_map: Dict[int, uuid.UUID] = {}\n+\n+    if not state_seeds:\n+        return state_map\n+\n+    for state_seed in state_seeds:\n+        state_id = state_seed.pop(\"id\")\n+        project_id = state_seed.pop(\"project_id\")\n+\n+        state = State.objects.create(\n+            **state_seed,\n+            project_id=project_map[project_id],\n+            workspace=workspace,\n+            created_by_id=workspace.created_by_id,\n+        )\n+\n+        state_map[state_id] = state.id\n+        logger.info(f\"Task: workspace_seed_task -> State {state_id} created\")\n+    return state_map\n+\n+\n+def create_project_labels(\n+    workspace: Workspace, project_map: Dict[int, uuid.UUID]\n+) -> Dict[int, uuid.UUID]:\n+    \"\"\"Creates labels for each project in the workspace.\n+\n+    Args:\n+        workspace: The workspace containing the projects\n+        project_map: Mapping of seed project IDs to actual project IDs\n+\n+    Returns:\n+        A mapping of seed label IDs to actual label IDs\n+    \"\"\"\n+    label_seeds = read_seed_file(\"labels.json\")\n+    label_map: Dict[int, uuid.UUID] = {}\n+\n+    if not label_seeds:\n+        return label_map\n+\n+    for label_seed in label_seeds:\n+        label_id = label_seed.pop(\"id\")\n+        project_id = label_seed.pop(\"project_id\")\n+        label = Label.objects.create(\n+            **label_seed,\n+            project_id=project_map[project_id],\n+            workspace=workspace,\n+            created_by_id=workspace.created_by_id,\n+        )\n+        label_map[label_id] = label.id\n+\n+        logger.info(f\"Task: workspace_seed_task -> Label {label_id} created\")\n+    return label_map\n+\n+\n+def create_project_issues(\n+    workspace: Workspace,\n+    project_map: Dict[int, uuid.UUID],\n+    states_map: Dict[int, uuid.UUID],\n+    labels_map: Dict[int, uuid.UUID],\n+) -> None:\n+    \"\"\"Creates issues and their associated records for each project.\n+\n+    Creates issues along with their sequences, activities, and label associations.\n+\n+    Args:\n+        workspace: The workspace containing the projects\n+        project_map: Mapping of seed project IDs to actual project IDs\n+        states_map: Mapping of seed state IDs to actual state IDs\n+        labels_map: Mapping of seed label IDs to actual label IDs\n+    \"\"\"\n+    issue_seeds = read_seed_file(\"issues.json\")\n+\n+    if not issue_seeds:\n+        return\n+\n+    for issue_seed in issue_seeds:\n+        required_fields = [\"id\", \"labels\", \"project_id\", \"state_id\"]\n+        # get the values\n+        for field in required_fields:\n+            if field not in issue_seed:\n+                logger.error(\n+                    f\"Task: workspace_seed_task -> Required field '{field}' missing in issue seed\"\n+                )\n+                continue\n+\n+        # get the values\n+        issue_id = issue_seed.pop(\"id\")\n+        labels = issue_seed.pop(\"labels\")\n+        project_id = issue_seed.pop(\"project_id\")\n+        state_id = issue_seed.pop(\"state_id\")\n+\n+        issue = Issue.objects.create(\n+            **issue_seed,\n+            state_id=states_map[state_id],\n+            project_id=project_map[project_id],\n+            workspace=workspace,\n+            created_by_id=workspace.created_by_id,\n+        )\n+        IssueSequence.objects.create(\n+            issue=issue,\n+            project_id=project_map[project_id],\n+            workspace_id=workspace.id,\n+            created_by_id=workspace.created_by_id,\n+        )\n+\n+        IssueActivity.objects.create(\n+            issue=issue,\n+            project_id=project_map[project_id],\n+            workspace_id=workspace.id,\n+            comment=\"created the issue\",\n+            verb=\"created\",\n+            actor_id=workspace.created_by_id,\n+            epoch=time.time(),\n+        )\n+\n+        for label_id in labels:\n+            IssueLabel.objects.create(\n+                issue=issue,\n+                label_id=labels_map[label_id],\n+                project_id=project_map[project_id],\n+                workspace_id=workspace.id,\n+                created_by_id=workspace.created_by_id,\n+            )\n+\n+        logger.info(f\"Task: workspace_seed_task -> Issue {issue_id} created\")\n+    return\n+\n+\n+@shared_task\n+def workspace_seed(workspace_id: uuid.UUID) -> None:\n+    \"\"\"Seeds a new workspace with initial project data.\n+\n+    Creates a complete workspace setup including:\n+    - Projects and project members\n+    - Project states\n+    - Project labels\n+    - Issues and their associations\n+\n+    Args:\n+        workspace_id: ID of the workspace to seed\n+    \"\"\"\n+    try:\n+        logger.info(f\"Task: workspace_seed_task -> Seeding workspace {workspace_id}\")\n+        # Get the workspace\n+        workspace = Workspace.objects.get(id=workspace_id)\n+\n+        # Create a project with the same name as workspace\n+        project_map = create_project_and_member(workspace)\n+\n+        # Create project states\n+        state_map = create_project_states(workspace, project_map)\n+\n+        # Create project labels\n+        label_map = create_project_labels(workspace, project_map)\n+\n+        # create project issues\n+        create_project_issues(workspace, project_map, state_map, label_map)\n+\n+        logger.info(\n+            f\"Task: workspace_seed_task -> Workspace {workspace_id} seeded successfully\"\n+        )\n+        return\n+    except Exception as e:\n+        logger.error(\n+            f\"Task: workspace_seed_task -> Failed to seed workspace {workspace_id}: {str(e)}\"\n+        )\n+        raise e\n"
        },
        {
          "path": "apiserver/plane/seeds/data/issues.json",
          "status": "added",
          "diff": "Index: apiserver/plane/seeds/data/issues.json\n===================================================================\n--- apiserver/plane/seeds/data/issues.json\t190300b (parent)\n+++ apiserver/plane/seeds/data/issues.json\t298e3dc (commit)\n@@ -0,0 +1,85 @@\n+[\n+  {\n+    \"id\": 1,\n+    \"name\": \"Welcome to Plane 👋\",\n+    \"sequence_id\": 1,\n+    \"description_html\": \"<p class=\\\"editor-paragraph-block\\\">Hey there! This demo project is your playground to get hands-on with Plane. We've set this up so you can click around and see how everything works without worrying about breaking anything.</p><p class=\\\"editor-paragraph-block\\\">Each work item is designed to make you familiar with the basics of using Plane. Just follow along card by card at your own pace.</p><p class=\\\"editor-paragraph-block\\\">First thing to try</p><ol class=\\\"list-decimal pl-7 space-y-[--list-spacing-y] tight\\\" data-tight=\\\"true\\\"><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Look in the <strong>Properties</strong> section below where it says <strong>State: Todo</strong>.</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Click on it and change it to <strong>Done</strong> from the dropdown. Alternatively, you can drag and drop the card to the Done column.</p></li></ol>\",\n+    \"description_stripped\": \"Hey there! This demo project is your playground to get hands-on with Plane. We've set this up so you can click around and see how everything works without worrying about breaking anything.Each work item is designed to make you familiar with the basics of using Plane. Just follow along card by card at your own pace.First thing to tryLook in the Properties section below where it says State: Todo.Click on it and change it to Done from the dropdown. Alternatively, you can drag and drop the card to the Done column.\",\n+    \"sort_order\": 1000,\n+    \"state_id\": 3,\n+    \"labels\": [],\n+    \"priority\": \"none\",\n+    \"project_id\": 1\n+  },\n+  {\n+    \"id\": 2,\n+    \"name\": \"1. Create Projects 🎯\",\n+    \"sequence_id\": 2,\n+    \"description_html\": \"<p class=\\\"editor-paragraph-block\\\"><br>A Project in Plane is where all your work comes together. Think of it as a base that organizes your work items and everything else your team needs to get things done.</p><div data-emoji-unicode=\\\"128204\\\" data-emoji-url=\\\"https://cdn.jsdelivr.net/npm/emoji-datasource-apple/img/apple/64/1f4cc.png\\\" data-logo-in-use=\\\"emoji\\\" data-background=\\\"light-blue\\\" data-block-type=\\\"callout-component\\\"><p class=\\\"editor-paragraph-block\\\"><strong>Note: </strong>This tutorial is already set up as a Project, and these cards you're reading are work items within it!</p><p class=\\\"editor-paragraph-block\\\">We're showing you how to create a new project just so you'll know exactly what to do when you're ready to start your own real one.</p></div><ol class=\\\"list-decimal pl-7 space-y-[--list-spacing-y] tight\\\" data-tight=\\\"true\\\"><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Look over at the left sidebar and find where it says <strong>Projects.</strong></p><image-component src=\\\"https://media.docs.plane.so/seed_assets/21.png\\\" width=\\\"395px\\\" height=\\\"362px\\\" id=\\\"7cb0d276-8686-4c8e-9f00-06a18140964d\\\" aspectratio=\\\"1.0900243309002433\\\"></image-component></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Hover your mouse there and you'll see a little <strong>+</strong> icon pop up - go ahead and click it!</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">A modal opens where you can give your project a name and other details.</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Notice the Access type<strong> </strong>options? <strong>Public</strong> means anyone (except Guest users) can see and join it, while <strong>Private</strong> keeps it just for those you invite.</p><div data-icon-color=\\\"#6d7b8a\\\" data-icon-name=\\\"Info\\\" data-emoji-unicode=\\\"128161\\\" data-emoji-url=\\\"https://cdn.jsdelivr.net/npm/emoji-datasource-apple/img/apple/64/1f4a1.png\\\" data-logo-in-use=\\\"emoji\\\" data-background=\\\"green\\\" data-block-type=\\\"callout-component\\\"><p class=\\\"editor-paragraph-block\\\"><strong>Tip:</strong> You can also quickly create a new project by using the keyboard shortcut <strong>P</strong> from anywhere in Plane!</p></div></li></ol>\",\n+    \"sort_order\": 2000,\n+    \"state_id\": 2,\n+    \"labels\": [2],\n+    \"priority\": \"none\",\n+    \"project_id\": 1\n+  },\n+  {\n+    \"id\": 3,\n+    \"name\": \"2. Invite your team 🤜🤛\",\n+    \"sequence_id\": 3,\n+    \"description_html\": \"<p class=\\\"editor-paragraph-block\\\">Let's get your teammates on board!</p><p class=\\\"editor-paragraph-block\\\">First, you'll need to invite them to your workspace before they can join specific projects:</p><ol class=\\\"list-decimal pl-7 space-y-[--list-spacing-y] tight\\\" data-tight=\\\"true\\\"><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Click on your workspace name in the top-left corner, then select <strong>Settings</strong> from the dropdown.<br></p><image-component src=\\\"https://media.docs.plane.so/seed_assets/31.png\\\" width=\\\"395px\\\" height=\\\"367px\\\" id=\\\"26b0f613-b9d8-48b8-a10d-1a75501f19e0\\\" aspectratio=\\\"1.074766355140187\\\"></image-component></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Head over to the <strong>Members</strong> tab - this is your user management hub. Click <strong>Add member</strong> on the top right.<br></p><image-component src=\\\"https://media.docs.plane.so/seed_assets/32.png\\\" width=\\\"1144.380859375px\\\" height=\\\"206.3244316692872px\\\" id=\\\"7c64e9b0-4f6d-4958-917d-f77119cd48bd\\\" aspectratio=\\\"5.546511627906977\\\"></image-component></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Enter your teammate's email address. Select a role for them (Admin, Member or Guest) that determines what they can do in the workspace.</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Your team member will get an email invite. Once they've joined your workspace, you can add them to specific projects.</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">To do this, go to your project's <strong>Settings</strong> page.</p><image-component src=\\\"https://media.docs.plane.so/seed_assets/33.png\\\" width=\\\"1119.380859375px\\\" height=\\\"329.9601265352615px\\\" id=\\\"3029c693-19fc-458e-9f5c-fdf3511dd2b6\\\" aspectratio=\\\"3.39247311827957\\\"></image-component></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Find the <strong>Members</strong> section, select your teammate, and assign them a project role - this controls what they can do within just this project.</p></li></ol><p class=\\\"editor-paragraph-block\\\"><br>That's it!</p><div class=\\\"py-4 border-custom-border-400\\\" data-type=\\\"horizontalRule\\\"><div></div></div><p class=\\\"editor-paragraph-block\\\">To learn more about user management, see <a target=\\\"_blank\\\" rel=\\\"noopener noreferrer nofollow\\\" class=\\\"text-custom-primary-300 underline underline-offset-[3px] hover:text-custom-primary-500 transition-colors cursor-pointer\\\" href=\\\"https://docs.plane.so/core-concepts/workspaces/members\\\">Manage users and roles</a>.</p>\",\n+    \"description_stripped\": \"Let's get your teammates on board!First, you'll need to invite them to your workspace before they can join specific projects:Click on your workspace name in the top-left corner, then select Settings from the dropdown.Head over to the Members tab - this is your user management hub. Click Add member on the top right.Enter your teammate's email address. Select a role for them (Admin, Member or Guest) that determines what they can do in the workspace.Your team member will get an email invite. Once they've joined your workspace, you can add them to specific projects.To do this, go to your project's Settings page.Find the Members section, select your teammate, and assign them a project role - this controls what they can do within just this project.That's it!To learn more about user management, see Manage users and roles.\",\n+    \"sort_order\": 3000,\n+    \"state_id\": 1,\n+    \"labels\": [],\n+    \"priority\": \"none\",\n+    \"project_id\": 1\n+  },\n+  {\n+    \"id\": 4,\n+    \"name\": \"3. Create and assign Work Items ✏️\",\n+    \"sequence_id\": 4,\n+    \"description_html\": \"<p class=\\\"editor-paragraph-block\\\">A work item is the fundamental building block of your project. Think of these as the actionable tasks that move your project forward.</p><p class=\\\"editor-paragraph-block\\\">Ready to add something to your project's to-do list? Here's how:</p><ol class=\\\"list-decimal pl-7 space-y-[--list-spacing-y] tight\\\" data-tight=\\\"true\\\"><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Click the <strong>Add work item</strong> button in the top-right corner of the Work Items page.</p><image-component src=\\\"https://media.docs.plane.so/seed_assets/41.png\\\" width=\\\"1085.380859375px\\\" height=\\\"482.53758375605696px\\\" id=\\\"ba055bc3-4162-4750-9ad4-9434fc0e7121\\\" aspectratio=\\\"2.249318801089918\\\"></image-component></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Give your task a clear title and add any details in the description.</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Set up the essentials:</p><ul class=\\\"list-disc pl-7 space-y-[--list-spacing-y] tight\\\" data-tight=\\\"true\\\"><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Assign it to a team member (or yourself!)</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Choose a priority level</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Add start and due dates if there's a timeline</p></li></ul></li></ol><div data-emoji-unicode=\\\"128161\\\" data-emoji-url=\\\"https://cdn.jsdelivr.net/npm/emoji-datasource-apple/img/apple/64/1f4a1.png\\\" data-logo-in-use=\\\"emoji\\\" data-background=\\\"green\\\" data-block-type=\\\"callout-component\\\"><p class=\\\"editor-paragraph-block\\\"><strong>Tip:</strong> Save time by using the keyboard shortcut <strong>C</strong> from anywhere in your project to quickly create a new work item!</p></div><div class=\\\"py-4 border-custom-border-400\\\" data-type=\\\"horizontalRule\\\"><div></div></div><p class=\\\"editor-paragraph-block\\\">Want to dive deeper into all the things you can do with work items? Check out our <a target=\\\"_blank\\\" rel=\\\"noopener noreferrer nofollow\\\" class=\\\"text-custom-primary-300 underline underline-offset-[3px] hover:text-custom-primary-500 transition-colors cursor-pointer\\\" href=\\\"https://docs.plane.so/core-concepts/issues/overview\\\">documentation</a>.</p>\",\n+    \"description_stripped\": \"A work item is the fundamental building block of your project. Think of these as the actionable tasks that move your project forward.Ready to add something to your project's to-do list? Here's how:Click the Add work item button in the top-right corner of the Work Items page.Give your task a clear title and add any details in the description.Set up the essentials:Assign it to a team member (or yourself!)Choose a priority levelAdd start and due dates if there's a timelineTip: Save time by using the keyboard shortcut C from anywhere in your project to quickly create a new work item!Want to dive deeper into all the things you can do with work items? Check out our documentation.\",\n+    \"sort_order\": 4000,\n+    \"state_id\": 1,\n+    \"labels\": [2],\n+    \"priority\": \"none\",\n+    \"project_id\": 1\n+  },\n+  {\n+    \"id\": 5,\n+    \"name\": \"4. Visualize your work 🔮\",\n+    \"sequence_id\": 5,\n+    \"description_html\": \"<p class=\\\"editor-paragraph-block\\\">Plane offers multiple ways to look at your work items depending on what you need to see. Let's explore how to change views and customize them!</p><image-component src=\\\"https://media.docs.plane.so/seed_assets/51.png\\\" aspectratio=\\\"4.489130434782608\\\"></image-component><h2 class=\\\"editor-heading-block\\\">Switch between layouts</h2><ol class=\\\"list-decimal pl-7 space-y-[--list-spacing-y] tight\\\" data-tight=\\\"true\\\"><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Look at the top toolbar in your project. You'll see several layout icons.</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Click any of these icons to instantly switch between layouts.</p></li></ol><div data-emoji-unicode=\\\"128161\\\" data-emoji-url=\\\"https://cdn.jsdelivr.net/npm/emoji-datasource-apple/img/apple/64/1f4a1.png\\\" data-logo-in-use=\\\"emoji\\\" data-background=\\\"green\\\" data-block-type=\\\"callout-component\\\"><p class=\\\"editor-paragraph-block\\\"><strong>Tip:</strong> Different layouts work best for different needs. Try Board view for tracking progress, Calendar for deadline management, and Gantt for timeline planning! See <a target=\\\"_blank\\\" rel=\\\"noopener noreferrer nofollow\\\" class=\\\"text-custom-primary-300 underline underline-offset-[3px] hover:text-custom-primary-500 transition-colors cursor-pointer\\\" href=\\\"https://docs.plane.so/core-concepts/issues/layouts\\\"><strong>Layouts</strong></a> for more info.</p></div><h2 class=\\\"editor-heading-block\\\">Filter and display options</h2><p class=\\\"editor-paragraph-block\\\">Need to focus on specific work?</p><ol class=\\\"list-decimal pl-7 space-y-[--list-spacing-y] tight\\\" data-tight=\\\"true\\\"><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Click the <strong>Filters</strong> dropdown in the toolbar. Select criteria and choose which items to show.</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Click the <strong>Display</strong> dropdown to tailor how the information appears in your layout</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Created the perfect setup? Save it for later by clicking the the <strong>Save View</strong> button.</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Access saved views anytime from the <strong>Views</strong> section in your sidebar.</p></li></ol>\",\n+    \"description_stripped\": \"Plane offers multiple ways to look at your work items depending on what you need to see. Let's explore how to change views and customize them!Switch between layoutsLook at the top toolbar in your project. You'll see several layout icons.Click any of these icons to instantly switch between layouts.Tip: Different layouts work best for different needs. Try Board view for tracking progress, Calendar for deadline management, and Gantt for timeline planning! See Layouts for more info.Filter and display optionsNeed to focus on specific work?Click the Filters dropdown in the toolbar. Select criteria and choose which items to show.Click the Display dropdown to tailor how the information appears in your layoutCreated the perfect setup? Save it for later by clicking the the Save View button.Access saved views anytime from the Views section in your sidebar.\",\n+    \"sort_order\": 5000,\n+    \"state_id\": 1,\n+    \"labels\": [],\n+    \"priority\": \"none\",\n+    \"project_id\": 1\n+  },\n+  {\n+    \"id\": 6,\n+    \"name\": \"5. Use Cycles to time box tasks 🗓️\",\n+    \"sequence_id\": 6,\n+    \"description_html\": \"<p class=\\\"editor-paragraph-block\\\">A Cycle in Plane is like a sprint - a dedicated timeframe where your team focuses on completing specific work items. It helps you break down your project into manageable chunks with clear start and end dates so everyone knows what to work on and when it needs to be done.</p><h2 class=\\\"editor-heading-block\\\"><strong>Setup Cycles</strong></h2><ol class=\\\"list-decimal pl-7 space-y-[--list-spacing-y] tight\\\" data-tight=\\\"true\\\"><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Go to the <strong>Cycles</strong> section in your project (you can find it in the left sidebar)</p><image-component src=\\\"https://media.docs.plane.so/seed_assets/61.png\\\" width=\\\"1144.380859375px\\\" height=\\\"341.8747850334119px\\\" id=\\\"9c3aea94-703a-4d4c-8c39-4201e994711d\\\" aspectratio=\\\"3.3473684210526318\\\"></image-component></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Click the <strong>Add cycle </strong>button in the top-right corner</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Enter details and set the start and end dates for your cycle.</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Click <strong>Create cycle</strong> and you're ready to go!</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Add existing work items to the Cycle or create new ones.</p></li></ol><div data-emoji-unicode=\\\"128161\\\" data-emoji-url=\\\"https://cdn.jsdelivr.net/npm/emoji-datasource-apple/img/apple/64/1f4a1.png\\\" data-logo-in-use=\\\"emoji\\\" data-background=\\\"green\\\" data-block-type=\\\"callout-component\\\"><p class=\\\"editor-paragraph-block\\\"><strong>Tip:</strong> To create a new Cycle quickly, just press <code class=\\\"rounded bg-custom-background-80 px-[6px] py-[1.5px] font-mono font-medium text-orange-500 border-[0.5px] border-custom-border-200\\\" spellcheck=\\\"false\\\">Q</code> from anywhere in your project!</p></div><div class=\\\"py-4 border-custom-border-400\\\" data-type=\\\"horizontalRule\\\"><div></div></div><p class=\\\"editor-paragraph-block\\\">Want to learn more?</p><ul class=\\\"list-disc pl-7 space-y-[--list-spacing-y] tight\\\" data-tight=\\\"true\\\"><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Starting and stopping cycles</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Transferring work items between cycles</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Tracking progress with charts</p></li></ul><p class=\\\"editor-paragraph-block\\\">Check out our <a target=\\\"_blank\\\" rel=\\\"noopener noreferrer nofollow\\\" class=\\\"text-custom-primary-300 underline underline-offset-[3px] hover:text-custom-primary-500 transition-colors cursor-pointer\\\" href=\\\"https://docs.plane.so/core-concepts/cycles\\\">detailed documentation</a> for everything you need to know!</p>\",\n+    \"description_stripped\": \"A Cycle in Plane is like a sprint - a dedicated timeframe where your team focuses on completing specific work items. It helps you break down your project into manageable chunks with clear start and end dates so everyone knows what to work on and when it needs to be done.Setup CyclesGo to the Cycles section in your project (you can find it in the left sidebar)Click the Add cycle button in the top-right cornerEnter details and set the start and end dates for your cycle.Click Create cycle and you're ready to go!Add existing work items to the Cycle or create new ones.Tip: To create a new Cycle quickly, just press Q from anywhere in your project!Want to learn more?Starting and stopping cyclesTransferring work items between cyclesTracking progress with chartsCheck out our detailed documentation for everything you need to know!\",\n+    \"sort_order\": 6000,\n+    \"state_id\": 1,\n+    \"labels\": [2],\n+    \"priority\": \"none\",\n+    \"project_id\": 1\n+  },\n+  {\n+    \"id\": 7,\n+    \"name\": \"6. Customize your settings ⚙️\",\n+    \"sequence_id\": 7,\n+    \"description_html\": \"<p class=\\\"editor-paragraph-block\\\">Now that you're getting familiar with Plane, let's explore how you can customize settings to make it work just right for you and your team!</p><h2 class=\\\"editor-heading-block\\\">Workspace settings</h2><p class=\\\"editor-paragraph-block\\\">Remember those workspace settings we mentioned when inviting team members? There's a lot more you can do there:</p><ul class=\\\"list-disc pl-7 space-y-[--list-spacing-y] tight\\\" data-tight=\\\"true\\\"><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Invite and manage workspace members</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Upgrade plans and manage billing</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Import data from other tools</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Export your data</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Manage integrations</p></li></ul><h2 class=\\\"editor-heading-block\\\">Project Settings</h2><p class=\\\"editor-paragraph-block\\\">Each project has its own settings where you can:</p><ul class=\\\"list-disc pl-7 space-y-[--list-spacing-y] tight\\\" data-tight=\\\"true\\\"><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Change project details and visibility</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Invite specific members to just this project</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Customize your workflow States (like adding a \\\"Testing\\\" state)</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Create and organize Labels</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Enable or disable features you need (or don't need)</p></li></ul><h2 class=\\\"editor-heading-block\\\">Your Profile Settings</h2><p class=\\\"editor-paragraph-block\\\">You can also customize your own personal experience! Click on your profile icon in the top-right corner to find:</p><ul class=\\\"list-disc pl-7 space-y-[--list-spacing-y] tight\\\" data-tight=\\\"true\\\"><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Profile settings (update your name, photo, etc.)</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Choose your timezone and preferred language for the interface</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Email notification preferences (what you want to be alerted about)</p></li><li class=\\\"not-prose space-y-2\\\"><p class=\\\"editor-paragraph-block\\\">Appearance settings (light/dark mode)<br></p></li></ul><p class=\\\"editor-paragraph-block\\\">Taking a few minutes to set things up just the way you like will make your everyday Plane experience much smoother!</p><div data-emoji-unicode=\\\"128278\\\" data-emoji-url=\\\"https://cdn.jsdelivr.net/npm/emoji-datasource-apple/img/apple/64/1f516.png\\\" data-logo-in-use=\\\"emoji\\\" data-background=\\\"green\\\" data-block-type=\\\"callout-component\\\"><p class=\\\"editor-paragraph-block\\\"><strong>Note:</strong> Some settings are only available to workspace or project admins. If you don't see certain options, you might need admin access.</p></div><p class=\\\"editor-paragraph-block\\\"></p><div class=\\\"py-4 border-custom-border-400\\\" data-type=\\\"horizontalRule\\\"><div></div></div><p class=\\\"editor-paragraph-block\\\"></p>\",\n+    \"description_stripped\": \"Now that you're getting familiar with Plane, let's explore how you can customize settings to make it work just right for you and your team!Workspace settingsRemember those workspace settings we mentioned when inviting team members? There's a lot more you can do there:Invite and manage workspace membersUpgrade plans and manage billingImport data from other toolsExport your dataManage integrationsProject SettingsEach project has its own settings where you can:Change project details and visibilityInvite specific members to just this projectCustomize your workflow States (like adding a \\\"Testing\\\" state)Create and organize LabelsEnable or disable features you need (or don't need)Your Profile SettingsYou can also customize your own personal experience! Click on your profile icon in the top-right corner to find:Profile settings (update your name, photo, etc.)Choose your timezone and preferred language for the interfaceEmail notification preferences (what you want to be alerted about)Appearance settings (light/dark mode)Taking a few minutes to set things up just the way you like will make your everyday Plane experience much smoother!Note: Some settings are only available to workspace or project admins. If you don't see certain options, you might need admin access.\",\n+    \"sort_order\": 7000,\n+    \"state_id\": 1,\n+    \"labels\": [],\n+    \"priority\": \"none\",\n+    \"project_id\": 1\n+  }\n+]\n"
        },
        {
          "path": "apiserver/plane/seeds/data/labels.json",
          "status": "added",
          "diff": "Index: apiserver/plane/seeds/data/labels.json\n===================================================================\n--- apiserver/plane/seeds/data/labels.json\t190300b (parent)\n+++ apiserver/plane/seeds/data/labels.json\t298e3dc (commit)\n@@ -0,0 +1,16 @@\n+[\n+  {\n+    \"id\": 1,\n+    \"name\": \"admin\",\n+    \"color\": \"#0693e3\",\n+    \"sort_order\": 85535,\n+    \"project_id\": 1\n+  },\n+  {\n+    \"id\": 2,\n+    \"name\": \"concepts\",\n+    \"color\": \"#9900ef\",\n+    \"sort_order\": 95535,\n+    \"project_id\": 1\n+  }\n+]\n"
        },
        {
          "path": "apiserver/plane/seeds/data/projects.json",
          "status": "added",
          "diff": "Index: apiserver/plane/seeds/data/projects.json\n===================================================================\n--- apiserver/plane/seeds/data/projects.json\t190300b (parent)\n+++ apiserver/plane/seeds/data/projects.json\t298e3dc (commit)\n@@ -0,0 +1,17 @@\n+[\n+  {\n+    \"id\": 1,\n+    \"name\": \"Plane Demo Project\",\n+    \"identifier\": \"PDP\",\n+    \"description\": \"Welcome to the Plane Demo Project! This project throws you into the driver’s seat of Plane, work management software. Through curated work items, you’ll uncover key features, pick up best practices, and see how Plane can streamline your team’s workflow. Whether you’re a startup hungry to scale or an enterprise sharpening efficiency, this demo is your launchpad to mastering Plane. Jump in and see what it can do!\",\n+    \"network\": 2,\n+    \"cover_image\": \"https://images.unsplash.com/photo-1691230995681-480d86cbc135?auto=format&fit=crop&q=80&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&w=870&q=80\",\n+    \"logo_props\": {\n+      \"emoji\": {\n+        \"url\": \"https://cdn.jsdelivr.net/npm/emoji-datasource-apple/img/apple/64/1f447.png\",\n+        \"value\": \"128071\"\n+      },\n+      \"in_use\": \"emoji\"\n+    }\n+  }\n+]\n"
        },
        {
          "path": "apiserver/plane/seeds/data/states.json",
          "status": "added",
          "diff": "Index: apiserver/plane/seeds/data/states.json\n===================================================================\n--- apiserver/plane/seeds/data/states.json\t190300b (parent)\n+++ apiserver/plane/seeds/data/states.json\t298e3dc (commit)\n@@ -0,0 +1,47 @@\n+[\n+  {\n+    \"id\": 1,\n+    \"name\": \"Backlog\",\n+    \"color\": \"#A3A3A3\",\n+    \"sequence\": 15000,\n+    \"group\": \"backlog\",\n+    \"default\": true,\n+    \"project_id\": 1\n+  },\n+  {\n+    \"id\": 2,\n+    \"name\": \"Todo\",\n+    \"color\": \"#3A3A3A\",\n+    \"sequence\": 25000,\n+    \"group\": \"unstarted\",\n+    \"default\": false,\n+    \"project_id\": 1\n+  },\n+  {\n+    \"id\": 3,\n+    \"name\": \"In Progress\",\n+    \"color\": \"#F59E0B\",\n+    \"sequence\": 35000,\n+    \"group\": \"started\",\n+    \"default\": false,\n+    \"project_id\": 1\n+  },\n+  {\n+    \"id\": 4,\n+    \"name\": \"Done\",\n+    \"color\": \"#16A34A\",\n+    \"sequence\": 45000,\n+    \"group\": \"completed\",\n+    \"default\": false,\n+    \"project_id\": 1\n+  },\n+  {\n+    \"id\": 5,\n+    \"name\": \"Cancelled\",\n+    \"color\": \"#EF4444\",\n+    \"sequence\": 55000,\n+    \"group\": \"cancelled\",\n+    \"default\": false,\n+    \"project_id\": 1\n+  }\n+]\n"
        },
        {
          "path": "apiserver/plane/settings/common.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/settings/common.py\n===================================================================\n--- apiserver/plane/settings/common.py\t190300b (parent)\n+++ apiserver/plane/settings/common.py\t298e3dc (commit)\n@@ -395,4 +395,7 @@\n     \"application/x-sql\",\n     # Gzip\n     \"application/x-gzip\",\n ]\n+\n+# Seed directory path\n+SEED_DIR = os.path.join(BASE_DIR, \"seeds\")\n"
        }
      ]
    },
    {
      "id": "update-cycle-logic",
      "sha": "190300bc6c572da38a432315415101f066bb2f25",
      "parentSha": "550fe547e25d2247aba7e95d4c842dcce45ada00",
      "spec": "Implement the following changes across the backend to update cycle end-date handling, exclude deleted issues in analytics, and leverage stored progress snapshots:\n\n1) Update timezone conversion behavior\n- File: apiserver/plane/utils/timezone_converter.py\n  - Change convert_to_utc signature from convert_to_utc(date, project_id, is_start_date=False, is_start_date_end_date_equal=False) to convert_to_utc(date, project_id, is_start_date=False).\n  - Preserve start-date behavior (start-of-day, +0m0s to ensure the right boundary; maintain current-day behavior).\n  - For end dates (is_start_date is False), always set to the last minute of the calendar day in the project’s timezone by adding 23 hours and 59 minutes with seconds=0, then convert to UTC. Remove any conditional logic tied to equal start/end dates.\n\n2) Remove is_start_date_end_date_equal handling in serializers\n- File: apiserver/plane/api/serializers/cycle.py (CycleSerializer.validate)\n  - Remove computation of is_start_date_end_date_equal.\n  - Convert start_date using convert_to_utc(..., is_start_date=True) and end_date using convert_to_utc(...) without any equal-date parameter.\n- File: apiserver/plane/app/serializers/cycle.py (CycleWriteSerializer.validate)\n  - Remove computation of is_start_date_end_date_equal.\n  - Convert start_date using convert_to_utc(..., is_start_date=True) and end_date using convert_to_utc(...) without any equal-date parameter.\n\n3) Update CycleDateCheckEndpoint to match new convert_to_utc signature\n- File: apiserver/plane/app/views/cycle/base.py (CycleDateCheckEndpoint.post)\n  - Remove is_start_date_end_date_equal calculation and stop passing it to convert_to_utc.\n  - Use convert_to_utc(date=<start>, ..., is_start_date=True) for the start date and convert_to_utc(date=<end>, ...) for the end date.\n\n4) Exclude deleted issues across cycle analytics/query annotations\n- Add filter issue_cycle__issue__deleted_at__isnull=True alongside existing filters (archived, draft, and deleted bridge checks) to all relevant annotations and counts:\n  - File: apiserver/plane/app/views/cycle/base.py (CycleViewSet.get_queryset)\n    - In Count annotations of issue_cycle__issue__id and issue_cycle__issue__state__group (e.g., total_issues, completed_issues, cancelled_issues, started_issues, unstarted_issues, backlog_issues), add issue_cycle__issue__deleted_at__isnull=True.\n  - File: apiserver/plane/app/views/cycle/base.py (TransferCycleIssueEndpoint.post)\n    - For the annotated old_cycle totals and state-group counts, add issue_cycle__issue__deleted_at__isnull=True in each filter block.\n  - File: apiserver/plane/api/views/cycle.py (TransferCycleIssueAPIEndpoint.post)\n    - For the annotated old_cycle totals and state-group counts, add issue_cycle__issue__deleted_at__isnull=True in each filter block.\n  - File: apiserver/plane/app/views/workspace/cycle.py (WorkspaceCyclesEndpoint)\n    - Where cycles are aggregated/filtered by issue_cycle fields, ensure issue_cycle__issue__deleted_at__isnull=True is included.\n\n5) Use a concrete Cycle instance for burndown_plot and snapshot fields\n- File: apiserver/plane/app/views/cycle/base.py (TransferCycleIssueEndpoint.post)\n  - After building the annotated old_cycle queryset, set old_cycle = old_cycle.first().\n  - Pass queryset=old_cycle to burndown_plot (for both points and issues plots).\n  - When constructing current_cycle.progress_snapshot, reference fields directly from old_cycle (e.g., old_cycle.total_issues) rather than old_cycle.first().\n- File: apiserver/plane/api/views/cycle.py (TransferCycleIssueAPIEndpoint.post)\n  - Apply the same pattern: set old_cycle = old_cycle.first(), pass old_cycle to burndown_plot, and reference old_cycle.<field> directly for snapshot data.\n\n6) Leverage stored progress_snapshot in progress and analytics endpoints\n- File: apiserver/plane/app/views/cycle/base.py (CycleProgressEndpoint.get)\n  - Load the cycle by slug/project_id/cycle_id. If not found, return 404.\n  - If cycle.progress_snapshot exists, populate backlog_issues, unstarted_issues, started_issues, cancelled_issues, completed_issues, and total_issues from the snapshot rather than querying. If no snapshot, compute using Issue.issue_objects with the existing bridge filters.\n  - Continue returning estimate aggregates (points) as currently structured.\n- File: apiserver/plane/app/views/cycle/base.py (CycleAnalyticsEndpoint.get)\n  - If cycle.progress_snapshot exists, return distribution data using the snapshot: labels, assignees, and completion_chart, bypassing recomputation. If no snapshot exists, proceed with existing analytics logic based on analytic_type.\n\n7) Update all convert_to_utc call sites to use the new signature\n- Search for and remove any remaining is_start_date_end_date_equal=... arguments.\n- Ensure all calls compile with the new function signature and behavior.\n\nAcceptance criteria\n- End dates are consistently stored as 23:59 local time (seconds=0) converted to UTC; no special handling for equal start/end dates.\n- Cycle list, analytics, and transfer endpoints exclude deleted issues in all counts and distributions.\n- burndown_plot receives a Cycle instance (with annotated totals), not a queryset.\n- After transferring issues, CycleProgressEndpoint and CycleAnalyticsEndpoint use progress_snapshot if present; otherwise they compute from live data.\n- Responses maintain their existing structure and types; code passes lint/tests.",
      "prompt": "Update the cycle APIs so cycles end at the last minute of the local calendar day, analytics exclude deleted issues, and progress/analytics reuse a stored snapshot when available.\n\nRequirements:\n- Treat cycle end dates as the end of the day in the project’s timezone; remove any special-case logic for equal start/end dates.\n- Exclude deleted issues from cycle totals and distributions.\n- When generating burndown charts, use the actual cycle object (with its annotated totals) rather than a queryset.\n- When a cycle has a saved progress snapshot, return analytics/progress from it; only compute from live data if no snapshot exists.\n\nMake coordinated changes in serializers, views, and the timezone conversion utility so the API continues to return the same fields and shapes.",
      "supplementalFiles": [
        "apiserver/plane/utils/analytics_plot.py",
        "apiserver/plane/db/models/cycle.py",
        "apiserver/plane/db/models/issue.py"
      ],
      "fileDiffs": [
        {
          "path": "apiserver/plane/api/serializers/cycle.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/api/serializers/cycle.py\n===================================================================\n--- apiserver/plane/api/serializers/cycle.py\t550fe54 (parent)\n+++ apiserver/plane/api/serializers/cycle.py\t190300b (commit)\n@@ -47,22 +47,16 @@\n \n             if not project_id:\n                 raise serializers.ValidationError(\"Project ID is required\")\n \n-            is_start_date_end_date_equal = (\n-                True\n-                if str(data.get(\"start_date\")) == str(data.get(\"end_date\"))\n-                else False\n-            )\n             data[\"start_date\"] = convert_to_utc(\n                 date=str(data.get(\"start_date\").date()),\n                 project_id=project_id,\n                 is_start_date=True,\n             )\n             data[\"end_date\"] = convert_to_utc(\n                 date=str(data.get(\"end_date\", None).date()),\n                 project_id=project_id,\n-                is_start_date_end_date_equal=is_start_date_end_date_equal,\n             )\n         return data\n \n     class Meta:\n"
        },
        {
          "path": "apiserver/plane/api/views/cycle.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/api/views/cycle.py\n===================================================================\n--- apiserver/plane/api/views/cycle.py\t550fe54 (parent)\n+++ apiserver/plane/api/views/cycle.py\t190300b (commit)\n@@ -787,8 +787,9 @@\n                     filter=Q(\n                         issue_cycle__issue__archived_at__isnull=True,\n                         issue_cycle__issue__is_draft=False,\n                         issue_cycle__deleted_at__isnull=True,\n+                        issue_cycle__issue__deleted_at__isnull=True,\n                     ),\n                 )\n             )\n             .annotate(\n@@ -798,8 +799,9 @@\n                         issue_cycle__issue__state__group=\"completed\",\n                         issue_cycle__issue__archived_at__isnull=True,\n                         issue_cycle__issue__is_draft=False,\n                         issue_cycle__deleted_at__isnull=True,\n+                        issue_cycle__issue__deleted_at__isnull=True,\n                     ),\n                 )\n             )\n             .annotate(\n@@ -846,8 +848,9 @@\n                     ),\n                 )\n             )\n         )\n+        old_cycle = old_cycle.first()\n \n         estimate_type = Project.objects.filter(\n             workspace__slug=slug,\n             pk=project_id,\n@@ -965,9 +968,9 @@\n                 .order_by(\"label_name\")\n             )\n \n             estimate_completion_chart = burndown_plot(\n-                queryset=old_cycle.first(),\n+                queryset=old_cycle,\n                 slug=slug,\n                 project_id=project_id,\n                 plot_type=\"points\",\n                 cycle_id=cycle_id,\n@@ -1113,9 +1116,9 @@\n         ]\n \n         # Pass the new_cycle queryset to burndown_plot\n         completion_chart = burndown_plot(\n-            queryset=old_cycle.first(),\n+            queryset=old_cycle,\n             slug=slug,\n             project_id=project_id,\n             plot_type=\"issues\",\n             cycle_id=cycle_id,\n@@ -1125,14 +1128,14 @@\n             workspace__slug=slug, project_id=project_id, pk=cycle_id\n         ).first()\n \n         current_cycle.progress_snapshot = {\n-            \"total_issues\": old_cycle.first().total_issues,\n-            \"completed_issues\": old_cycle.first().completed_issues,\n-            \"cancelled_issues\": old_cycle.first().cancelled_issues,\n-            \"started_issues\": old_cycle.first().started_issues,\n-            \"unstarted_issues\": old_cycle.first().unstarted_issues,\n-            \"backlog_issues\": old_cycle.first().backlog_issues,\n+            \"total_issues\": old_cycle.total_issues,\n+            \"completed_issues\": old_cycle.completed_issues,\n+            \"cancelled_issues\": old_cycle.cancelled_issues,\n+            \"started_issues\": old_cycle.started_issues,\n+            \"unstarted_issues\": old_cycle.unstarted_issues,\n+            \"backlog_issues\": old_cycle.backlog_issues,\n             \"distribution\": {\n                 \"labels\": label_distribution_data,\n                 \"assignees\": assignee_distribution_data,\n                 \"completion_chart\": completion_chart,\n"
        },
        {
          "path": "apiserver/plane/app/serializers/cycle.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/serializers/cycle.py\n===================================================================\n--- apiserver/plane/app/serializers/cycle.py\t550fe54 (parent)\n+++ apiserver/plane/app/serializers/cycle.py\t190300b (commit)\n@@ -24,22 +24,16 @@\n                 self.initial_data.get(\"project_id\", None)\n                 or (self.instance and self.instance.project_id)\n                 or self.context.get(\"project_id\", None)\n             )\n-            is_start_date_end_date_equal = (\n-                True\n-                if str(data.get(\"start_date\")) == str(data.get(\"end_date\"))\n-                else False\n-            )\n             data[\"start_date\"] = convert_to_utc(\n                 date=str(data.get(\"start_date\").date()),\n                 project_id=project_id,\n                 is_start_date=True,\n             )\n             data[\"end_date\"] = convert_to_utc(\n                 date=str(data.get(\"end_date\", None).date()),\n                 project_id=project_id,\n-                is_start_date_end_date_equal=is_start_date_end_date_equal,\n             )\n         return data\n \n     class Meta:\n"
        },
        {
          "path": "apiserver/plane/app/views/cycle/base.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/views/cycle/base.py\n===================================================================\n--- apiserver/plane/app/views/cycle/base.py\t550fe54 (parent)\n+++ apiserver/plane/app/views/cycle/base.py\t190300b (commit)\n@@ -116,8 +116,9 @@\n                     filter=Q(\n                         issue_cycle__issue__archived_at__isnull=True,\n                         issue_cycle__issue__is_draft=False,\n                         issue_cycle__deleted_at__isnull=True,\n+                        issue_cycle__issue__deleted_at__isnull=True,\n                     ),\n                 )\n             )\n             .annotate(\n@@ -128,8 +129,9 @@\n                         issue_cycle__issue__state__group=\"completed\",\n                         issue_cycle__issue__archived_at__isnull=True,\n                         issue_cycle__issue__is_draft=False,\n                         issue_cycle__deleted_at__isnull=True,\n+                        issue_cycle__issue__deleted_at__isnull=True,\n                     ),\n                 )\n             )\n             .annotate(\n@@ -140,8 +142,9 @@\n                         issue_cycle__issue__state__group__in=[\"cancelled\"],\n                         issue_cycle__issue__archived_at__isnull=True,\n                         issue_cycle__issue__is_draft=False,\n                         issue_cycle__deleted_at__isnull=True,\n+                        issue_cycle__issue__deleted_at__isnull=True,\n                     ),\n                 )\n             )\n             .annotate(\n@@ -265,11 +268,9 @@\n             \"version\",\n             \"created_by\",\n         )\n         datetime_fields = [\"start_date\", \"end_date\"]\n-        data = user_timezone_converter(\n-            data, datetime_fields, project_timezone\n-        )\n+        data = user_timezone_converter(data, datetime_fields, project_timezone)\n         return Response(data, status=status.HTTP_200_OK)\n \n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER])\n     def create(self, request, slug, project_id):\n@@ -414,11 +415,9 @@\n             project = Project.objects.get(id=self.kwargs.get(\"project_id\"))\n             project_timezone = project.timezone\n \n             datetime_fields = [\"start_date\", \"end_date\"]\n-            cycle = user_timezone_converter(\n-                cycle, datetime_fields, project_timezone\n-            )\n+            cycle = user_timezone_converter(cycle, datetime_fields, project_timezone)\n \n             # Send the model activity\n             model_activity.delay(\n                 model_name=\"cycle\",\n@@ -573,18 +572,14 @@\n                 {\"error\": \"Start date and end date both are required\"},\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n \n-        is_start_date_end_date_equal = (\n-            True if str(start_date) == str(end_date) else False\n-        )\n         start_date = convert_to_utc(\n             date=str(start_date), project_id=project_id, is_start_date=True\n         )\n         end_date = convert_to_utc(\n             date=str(end_date),\n             project_id=project_id,\n-            is_start_date_end_date_equal=is_start_date_end_date_equal,\n         )\n \n         # Check if any cycle intersects in the given interval\n         cycles = Cycle.objects.filter(\n@@ -667,8 +662,9 @@\n                     filter=Q(\n                         issue_cycle__issue__archived_at__isnull=True,\n                         issue_cycle__issue__is_draft=False,\n                         issue_cycle__deleted_at__isnull=True,\n+                        issue_cycle__issue__deleted_at__isnull=True,\n                     ),\n                 )\n             )\n             .annotate(\n@@ -731,8 +727,9 @@\n                     ),\n                 )\n             )\n         )\n+        old_cycle = old_cycle.first()\n \n         estimate_type = Project.objects.filter(\n             workspace__slug=slug,\n             pk=project_id,\n@@ -849,9 +846,9 @@\n                 .order_by(\"label_name\")\n             )\n \n             estimate_completion_chart = burndown_plot(\n-                queryset=old_cycle.first(),\n+                queryset=old_cycle,\n                 slug=slug,\n                 project_id=project_id,\n                 plot_type=\"points\",\n                 cycle_id=cycle_id,\n@@ -996,9 +993,9 @@\n         ]\n \n         # Pass the new_cycle queryset to burndown_plot\n         completion_chart = burndown_plot(\n-            queryset=old_cycle.first(),\n+            queryset=old_cycle,\n             slug=slug,\n             project_id=project_id,\n             plot_type=\"issues\",\n             cycle_id=cycle_id,\n@@ -1008,14 +1005,14 @@\n             workspace__slug=slug, project_id=project_id, pk=cycle_id\n         ).first()\n \n         current_cycle.progress_snapshot = {\n-            \"total_issues\": old_cycle.first().total_issues,\n-            \"completed_issues\": old_cycle.first().completed_issues,\n-            \"cancelled_issues\": old_cycle.first().cancelled_issues,\n-            \"started_issues\": old_cycle.first().started_issues,\n-            \"unstarted_issues\": old_cycle.first().unstarted_issues,\n-            \"backlog_issues\": old_cycle.first().backlog_issues,\n+            \"total_issues\": old_cycle.total_issues,\n+            \"completed_issues\": old_cycle.completed_issues,\n+            \"cancelled_issues\": old_cycle.cancelled_issues,\n+            \"started_issues\": old_cycle.started_issues,\n+            \"unstarted_issues\": old_cycle.unstarted_issues,\n+            \"backlog_issues\": old_cycle.backlog_issues,\n             \"distribution\": {\n                 \"labels\": label_distribution_data,\n                 \"assignees\": assignee_distribution_data,\n                 \"completion_chart\": completion_chart,\n@@ -1121,8 +1118,16 @@\n \n class CycleProgressEndpoint(BaseAPIView):\n     @allow_permission([ROLE.ADMIN, ROLE.MEMBER, ROLE.GUEST])\n     def get(self, request, slug, project_id, cycle_id):\n+\n+        cycle = Cycle.objects.filter(\n+            workspace__slug=slug, project_id=project_id, id=cycle_id\n+        ).first()\n+        if not cycle:\n+            return Response(\n+                {\"error\": \"Cycle not found\"}, status=status.HTTP_404_NOT_FOUND\n+            ) \n         aggregate_estimates = (\n             Issue.issue_objects.filter(\n                 estimate_point__estimate__type=\"points\",\n                 issue_cycle__cycle_id=cycle_id,\n@@ -1171,56 +1176,63 @@\n                     \"value_as_float\", default=Value(0), output_field=FloatField()\n                 ),\n             )\n         )\n+        if cycle.progress_snapshot:      \n+            backlog_issues = cycle.progress_snapshot.get(\"backlog_issues\", 0)\n+            unstarted_issues = cycle.progress_snapshot.get(\"unstarted_issues\", 0)\n+            started_issues = cycle.progress_snapshot.get(\"started_issues\", 0)\n+            cancelled_issues = cycle.progress_snapshot.get(\"cancelled_issues\", 0)\n+            completed_issues = cycle.progress_snapshot.get(\"completed_issues\", 0)\n+            total_issues = cycle.progress_snapshot.get(\"total_issues\", 0)\n+        else:\n+            backlog_issues = Issue.issue_objects.filter(\n+                issue_cycle__cycle_id=cycle_id,\n+                issue_cycle__deleted_at__isnull=True,\n+                workspace__slug=slug,\n+                project_id=project_id,\n+                state__group=\"backlog\",\n+            ).count()\n \n-        backlog_issues = Issue.issue_objects.filter(\n-            issue_cycle__cycle_id=cycle_id,\n-            issue_cycle__deleted_at__isnull=True,\n-            workspace__slug=slug,\n-            project_id=project_id,\n-            state__group=\"backlog\",\n-        ).count()\n+            unstarted_issues = Issue.issue_objects.filter(\n+                issue_cycle__cycle_id=cycle_id,\n+                issue_cycle__deleted_at__isnull=True,\n+                workspace__slug=slug,\n+                project_id=project_id,\n+                state__group=\"unstarted\",\n+            ).count()\n \n-        unstarted_issues = Issue.issue_objects.filter(\n-            issue_cycle__cycle_id=cycle_id,\n-            issue_cycle__deleted_at__isnull=True,\n-            workspace__slug=slug,\n-            project_id=project_id,\n-            state__group=\"unstarted\",\n-        ).count()\n+            started_issues = Issue.issue_objects.filter(\n+                issue_cycle__cycle_id=cycle_id,\n+                issue_cycle__deleted_at__isnull=True,\n+                workspace__slug=slug,\n+                project_id=project_id,\n+                state__group=\"started\",\n+            ).count()\n \n-        started_issues = Issue.issue_objects.filter(\n-            issue_cycle__cycle_id=cycle_id,\n-            issue_cycle__deleted_at__isnull=True,\n-            workspace__slug=slug,\n-            project_id=project_id,\n-            state__group=\"started\",\n-        ).count()\n+            cancelled_issues = Issue.issue_objects.filter(\n+                issue_cycle__cycle_id=cycle_id,\n+                issue_cycle__deleted_at__isnull=True,\n+                workspace__slug=slug,\n+                project_id=project_id,\n+                state__group=\"cancelled\",\n+            ).count()\n \n-        cancelled_issues = Issue.issue_objects.filter(\n-            issue_cycle__cycle_id=cycle_id,\n-            issue_cycle__deleted_at__isnull=True,\n-            workspace__slug=slug,\n-            project_id=project_id,\n-            state__group=\"cancelled\",\n-        ).count()\n+            completed_issues = Issue.issue_objects.filter(\n+                issue_cycle__cycle_id=cycle_id,\n+                issue_cycle__deleted_at__isnull=True,\n+                workspace__slug=slug,\n+                project_id=project_id,\n+                state__group=\"completed\",\n+            ).count()\n \n-        completed_issues = Issue.issue_objects.filter(\n-            issue_cycle__cycle_id=cycle_id,\n-            issue_cycle__deleted_at__isnull=True,\n-            workspace__slug=slug,\n-            project_id=project_id,\n-            state__group=\"completed\",\n-        ).count()\n+            total_issues = Issue.issue_objects.filter(\n+                issue_cycle__cycle_id=cycle_id,\n+                issue_cycle__deleted_at__isnull=True,\n+                workspace__slug=slug,\n+                project_id=project_id,\n+            ).count()\n \n-        total_issues = Issue.issue_objects.filter(\n-            issue_cycle__cycle_id=cycle_id,\n-            issue_cycle__deleted_at__isnull=True,\n-            workspace__slug=slug,\n-            project_id=project_id,\n-        ).count()\n-\n         return Response(\n             {\n                 \"backlog_estimate_points\": aggregate_estimates[\"backlog_estimate_point\"]\n                 or 0,\n@@ -1278,8 +1290,27 @@\n                 {\"error\": \"Cycle has no start or end date\"},\n                 status=status.HTTP_400_BAD_REQUEST,\n             )\n \n+        # this will tell whether the issues were transferred to the new cycle\n+        \"\"\" \n+        if the issues were transferred to the new cycle, then the progress_snapshot will be present\n+        return the progress_snapshot data in the analytics for each date\n+            \n+        else issues were not transferred to the new cycle then generate the stats from the cycle isssue bridge tables\n+        \"\"\"\n+\n+        if cycle.progress_snapshot:\n+            distribution = cycle.progress_snapshot.get(\"distribution\", {})\n+            return Response(\n+                {\n+                    \"labels\": distribution.get(\"labels\", []),\n+                    \"assignees\": distribution.get(\"assignees\", []),\n+                    \"completion_chart\": distribution.get(\"completion_chart\", {}),\n+                },\n+                status=status.HTTP_200_OK,\n+            )\n+\n         estimate_type = Project.objects.filter(\n             workspace__slug=slug,\n             pk=project_id,\n             estimate__isnull=False,\n"
        },
        {
          "path": "apiserver/plane/app/views/workspace/cycle.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/views/workspace/cycle.py\n===================================================================\n--- apiserver/plane/app/views/workspace/cycle.py\t550fe54 (parent)\n+++ apiserver/plane/app/views/workspace/cycle.py\t190300b (commit)\n@@ -28,8 +28,9 @@\n                     filter=Q(\n                         issue_cycle__issue__archived_at__isnull=True,\n                         issue_cycle__issue__is_draft=False,\n                         issue_cycle__deleted_at__isnull=True,\n+                        issue_cycle__issue__deleted_at__isnull=True,\n                     ),\n                 )\n             )\n             .annotate(\n"
        },
        {
          "path": "apiserver/plane/utils/timezone_converter.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/utils/timezone_converter.py\n===================================================================\n--- apiserver/plane/utils/timezone_converter.py\t550fe54 (parent)\n+++ apiserver/plane/utils/timezone_converter.py\t190300b (commit)\n@@ -35,9 +35,9 @@\n         return queryset_values\n \n \n def convert_to_utc(\n-    date, project_id, is_start_date=False, is_start_date_end_date_equal=False\n+    date, project_id, is_start_date=False\n ):\n     \"\"\"\n     Converts a start date string to the project's local timezone at 12:00 AM\n     and then converts it to UTC for storage.\n@@ -81,12 +81,10 @@\n             return current_datetime_in_utc\n \n         return utc_datetime\n     else:\n-        # If it's start an end date are equal, add 23 hours, 59 minutes, and 59 seconds\n-        # to make it the end of the day\n-        if is_start_date_end_date_equal:\n-            localized_datetime += timedelta(hours=23, minutes=59, seconds=59)\n+        # the cycle end date is the last minute of the day\n+        localized_datetime += timedelta(hours=23, minutes=59, seconds=0)\n \n         # Convert the localized datetime to UTC\n         utc_datetime = localized_datetime.astimezone(pytz.utc)\n \n"
        }
      ]
    },
    {
      "id": "refactor-page-header",
      "sha": "eac111556610fb94197337f33346a38885e03757",
      "parentSha": "8166a757a77fa210d15197fb16416fe4cf2560bf",
      "spec": "- Introduce page-level editor ref\n  - In web/core/store/pages/base-page.ts, add an observable editorRef: EditorRefApi | null with setter setEditorRef and a method mutateProperties(data: Partial<TPage>, shouldUpdateName?: boolean) to batch apply API payloads. Ensure editorRef is observable.ref and setter uses runInAction.\n  - Update updatePageLogo to optimistically update this.logo_props, revert to original on error.\n\n- Persist and clear editorRef from the editor lifecycle\n  - In web/core/components/pages/editor/page-root.tsx, remove the storeType prop. On handleEditorReady(true), set page.setEditorRef(editorRef.current) if not already set; on unmount, call setEditorRef(null). Pass editorForwardRef (renamed from editorRef) to the PageEditor component; pass page-only to PageEditorToolbarRoot.\n\n- Consume store editorRef instead of RefObject props\n  - In web/core/components/pages/editor/editor-body.tsx, change props: replace editorRef with editorForwardRef (React.RefObject<EditorRefApi>), and handleEditorReady signature to (status: boolean) => void. Use page.editorRef for PageContentBrowser and any editorRef reads; forward the React ref to the Editor component via ref={editorForwardRef}.\n  - In web/core/components/pages/editor/title.tsx and web/ce/components/pages/editor/ai/menu.tsx, change editorRef prop type to EditorRefApi | null and update all usages to call methods directly (e.g., editorRef?.setFocusAtPosition, editorRef?.getSelectedText, editorRef?.insertText).\n  - In web/core/components/pages/editor/summary/content-browser.tsx, memoize onClick via useCallback and use editorRef?.scrollSummary.\n\n- Refactor editor toolbar to derive from page\n  - In web/core/components/pages/editor/toolbar/root.tsx, remove editorReady, editorRef, and storeType props. Read editorRef from page (const { editorRef, isContentEditable } = page). Render <PageToolbar editorRef={editorRef} /> only if editorRef is set. Replace the right-side extra options with a collaborators list import from @/plane-web/components/pages/header/collaborators-list and remove the mobile header.\n  - In web/core/components/pages/editor/toolbar/toolbar.tsx, remove the isHidden prop and adjust classNames: always render with horizontal scrolling; do not toggle opacity based on isHidden. Wrap ColorDropdown in a flex-shrink-0 container.\n  - In web/core/components/pages/editor/toolbar/index.ts, stop exporting extra-options and mobile-root from the barrel.\n\n- Replace legacy header badges/actions with a new header actions cluster\n  - Delete web/core/components/pages/dropdowns/edit-information-popover.tsx and remove its export from web/core/components/pages/dropdowns/index.ts.\n  - Add web/core/components/pages/header/actions.tsx that composes: PageArchivedBadge, PageOfflineBadge, PageLockControl, PageMoveControl, PageInfoPopover, PageCopyLinkControl, and PageOptionsDropdown; it accepts props { page, storeType }.\n  - Update web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/header.tsx:\n    - Import PageHeaderActions from @/components/pages/header/actions.\n    - Define const storeType = EPageStoreType.PROJECT; use it for hooks and pass to PageHeaderActions.\n    - Remove PageEditInformationPopover usage.\n  - Update web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/[pageId]/page.tsx to drop the storeType prop when rendering <PageRoot />.\n\n- Provide CE-layer header placeholders and lock control\n  - Add web/ce/components/pages/header/collaborators-list.tsx exporting PageCollaboratorsList that currently returns null with props { page: TPageInstance }.\n  - Add web/ce/components/pages/header/move-control.tsx exporting PageMoveControl that returns null with props { page: TPageInstance }.\n  - Add web/ce/components/pages/header/lock-control.tsx exporting PageLockControl that:\n    - Shows three display states: \"neutral\" (icon-only LockKeyhole with tooltip), \"locked\" (badge with LockKeyhole and “Locked” text), and \"unlocked\" (temporary badge with LockKeyholeOpen and “Unlocked” text that fades out).\n    - Transitions state based on page.is_locked changes; when unlocking after being locked, show \"unlocked\" for ~600ms then revert to neutral; clear timers on unmount.\n    - Calls pageOperations.toggleLock from usePageOperations on click; render nothing if !page.canCurrentUserLockPage.\n\n- Update info popover and options\n  - In web/core/components/pages/editor/toolbar/info-popover.tsx, remove the editorRef prop and use page.editorRef?.getDocumentInfo() instead. Update the button UI to a 24px icon button and switch edited timestamp to calculateTimeAgoShort(page.updated_at) + \" ago\".\n  - In web/core/components/pages/editor/toolbar/options-dropdown.tsx, remove the editorRef prop and get editorRef from page.editorRef. Adjust the optionsOrder to exclude actions now shown directly in the header (copy-link, move, toggle-lock). Continue to pass storeType and page through to PageActions.\n\n- Update page actions hook\n  - In web/core/hooks/use-page-operations.ts, rename isfavoriteMenuOpen to isFavoriteMenuOpen and update references and dependencies. Ensure toggleFavorite opens the favorite menu when appropriate.\n\n- Project page store merges\n  - In web/core/store/pages/project-page.store.ts, when fetching lists or a single page, if an instance exists in this.data for the id, call existingPage.mutateProperties(response, false) to update fields except name; otherwise create new ProjectPage instances. Ensure loader is cleared afterward.\n\n- Styles for lock/unlock animations\n  - In web/styles/globals.css, add keyframes and classes for textSlideIn, textFadeOut, lockIconAnimation, unlockIconAnimation, fadeOut. Provide utility classes: .animate-text-slide-in, .animate-text-fade-out, .animate-lock-icon, .animate-unlock-icon, .animate-fade-out. Use these in PageLockControl.\n\n- Adjust consumers to new props and exports\n  - Ensure import paths reflect the new locations: header actions are imported directly (\"@/components/pages/header/actions\"); collaborators/move/lock controls are imported from the plane-web CE layer (\"@/plane-web/components/pages/header/...\").\n  - Remove any references to the deleted components (PageEditInformationPopover, PageExtraOptions, PageEditorMobileHeaderRoot) and their barrel exports.\n\n- Visual tweaks\n  - In web/core/components/pages/editor/header/logo-picker.tsx, increase the transition duration from 200ms to 300ms.\n  - In web/core/components/pages/editor/toolbar/root.tsx, wrap the toolbar container with a max-height transition (300ms) and hide when either sticky toolbar is disabled or page is not editable.\n\n- Keep behavior parity\n  - All prior actions (lock/unlock, access toggles, duplicate, archive/restore, move, delete, copy link, open in new tab) must remain functional, but the UI placement changes: copy link, lock/unlock, move, info, offline and archived indicators are in the header group; the dropdown contains the remaining actions.",
      "prompt": "Refactor the wiki page header and editor to centralize the editor instance on the page store and split header actions into explicit controls. Store the editor ref on the page model so downstream components (toolbar, info popover, and dropdown) can read it directly. Replace the single edit-info badge with a header actions cluster that includes archived and offline badges, lock/unlock control with subtle transitions, a move control placeholder, an info popover, and a copy-link control. Remove older extra-options/mobile header components and migrate the options dropdown to no longer receive the editor ref prop, deriving it from the page instead. Ensure the page store supports optimistic logo updates with revert-on-error and bulk property mutation without changing the name by default. When fetching project pages, update existing page instances via the new mutation method instead of replacing them. Add the minimal CSS for lock/unlock animations. Make sure imports/exports are updated and all existing actions still work from their new UI locations.",
      "supplementalFiles": [
        "web/ce/hooks/store/use-page-store.ts",
        "web/ce/hooks/store/use-page.ts",
        "web/core/store/pages/project-page.ts",
        "web/core/components/pages/dropdowns/actions.tsx",
        "web/core/components/pages/index.ts",
        "web/core/hooks/use-collaborative-page-actions.tsx"
      ],
      "fileDiffs": [
        {
          "path": "web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/[pageId]/page.tsx",
          "status": "modified",
          "diff": "Index: web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/[pageId]/page.tsx\n===================================================================\n--- web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/[pageId]/page.tsx\t8166a75 (parent)\n+++ web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/[pageId]/page.tsx\teac1115 (commit)\n@@ -160,9 +160,8 @@\n           <PageRoot\n             config={pageRootConfig}\n             handlers={pageRootHandlers}\n             page={page}\n-            storeType={EPageStoreType.PROJECT}\n             webhookConnectionParams={webhookConnectionParams}\n             workspaceSlug={workspaceSlug?.toString() ?? \"\"}\n           />\n           <IssuePeekOverview />\n"
        },
        {
          "path": "web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/header.tsx",
          "status": "modified",
          "diff": "Index: web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/header.tsx\n===================================================================\n--- web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/header.tsx\t8166a75 (parent)\n+++ web/app/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(detail)/header.tsx\teac1115 (commit)\n@@ -7,12 +7,12 @@\n // ui\n import { Breadcrumbs, Header, CustomSearchSelect } from \"@plane/ui\";\n // components\n import { BreadcrumbLink, PageAccessIcon, SwitcherLabel } from \"@/components/common\";\n-import { PageEditInformationPopover } from \"@/components/pages\";\n+import { PageHeaderActions } from \"@/components/pages/header/actions\";\n // helpers\n-// hooks\n import { getPageName } from \"@/helpers/page.helper\";\n+// hooks\n import { useProject } from \"@/hooks/store\";\n // plane web components\n import { useAppRouter } from \"@/hooks/use-app-router\";\n import { ProjectBreadcrumb } from \"@/plane-web/components/breadcrumbs\";\n@@ -23,23 +23,24 @@\n export interface IPagesHeaderProps {\n   showButton?: boolean;\n }\n \n+const storeType = EPageStoreType.PROJECT;\n+\n export const PageDetailsHeader = observer(() => {\n   // router\n   const router = useAppRouter();\n   const { workspaceSlug, pageId, projectId } = useParams();\n   // store hooks\n   const { currentProjectDetails, loader } = useProject();\n+  const { getPageById, getCurrentProjectPageIds } = usePageStore(storeType);\n   const page = usePage({\n     pageId: pageId?.toString() ?? \"\",\n-    storeType: EPageStoreType.PROJECT,\n+    storeType,\n   });\n-  const { getPageById, getCurrentProjectPageIds } = usePageStore(EPageStoreType.PROJECT);\n   // derived values\n   const projectPageIds = getCurrentProjectPageIds(projectId?.toString());\n \n-  if (!page) return null;\n   const switcherOptions = projectPageIds\n     .map((id) => {\n       const _page = id === pageId ? page : getPageById(id);\n       if (!_page) return;\n@@ -108,10 +109,10 @@\n           </Breadcrumbs>\n         </div>\n       </Header.LeftItem>\n       <Header.RightItem>\n-        <PageEditInformationPopover page={page} />\n         <PageDetailsHeaderExtraActions page={page} />\n+        <PageHeaderActions page={page} storeType={storeType} />\n       </Header.RightItem>\n     </Header>\n   );\n });\n"
        },
        {
          "path": "web/ce/components/pages/editor/ai/menu.tsx",
          "status": "modified",
          "diff": "Index: web/ce/components/pages/editor/ai/menu.tsx\n===================================================================\n--- web/ce/components/pages/editor/ai/menu.tsx\t8166a75 (parent)\n+++ web/ce/components/pages/editor/ai/menu.tsx\teac1115 (commit)\n@@ -1,7 +1,7 @@\n \"use client\";\n \n-import React, { RefObject, useEffect, useRef, useState } from \"react\";\n+import React, { useEffect, useRef, useState } from \"react\";\n import { ChevronRight, CornerDownRight, LucideIcon, RefreshCcw, Sparkles, TriangleAlert } from \"lucide-react\";\n // plane editor\n import { EditorRefApi } from \"@plane/editor\";\n // plane ui\n@@ -17,9 +17,9 @@\n import { AskPiMenu } from \"./ask-pi-menu\";\n const aiService = new AIService();\n \n type Props = {\n-  editorRef: RefObject<EditorRefApi>;\n+  editorRef: EditorRefApi | null;\n   isOpen: boolean;\n   onClose: () => void;\n   workspaceId: string;\n   workspaceSlug: string;\n@@ -72,9 +72,9 @@\n     await aiService.performEditorTask(workspaceSlug.toString(), payload).then((res) => setResponse(res.response));\n   };\n   // handle task click\n   const handleClick = async (key: AI_EDITOR_TASKS) => {\n-    const selection = editorRef.current?.getSelectedText();\n+    const selection = editorRef?.getSelectedText();\n     if (!selection || activeTask === key) return;\n     setActiveTask(key);\n     if (key === AI_EDITOR_TASKS.ASK_ANYTHING) return;\n     setResponse(undefined);\n@@ -85,9 +85,9 @@\n     });\n   };\n   // handle re-generate response\n   const handleRegenerate = async () => {\n-    const selection = editorRef.current?.getSelectedText();\n+    const selection = editorRef?.getSelectedText();\n     if (!selection || !activeTask) return;\n     setIsRegenerating(true);\n     await handleGenerateResponse({\n       task: activeTask,\n@@ -103,9 +103,9 @@\n   };\n   // handle re-generate response\n   const handleToneChange = async (key: string) => {\n     const selectedTone = TONES_LIST.find((t) => t.key === key);\n-    const selection = editorRef.current?.getSelectedText();\n+    const selection = editorRef?.getSelectedText();\n     if (!selectedTone || !selection || !activeTask) return;\n     setResponse(undefined);\n     setIsRegenerating(false);\n     await handleGenerateResponse({\n@@ -122,9 +122,9 @@\n   };\n   // handle replace selected text with the response\n   const handleInsertText = (insertOnNextLine: boolean) => {\n     if (!response) return;\n-    editorRef.current?.insertText(response, insertOnNextLine);\n+    editorRef?.insertText(response, insertOnNextLine);\n     onClose();\n   };\n \n   // reset on close\n"
        },
        {
          "path": "web/ce/components/pages/header/collaborators-list.tsx",
          "status": "added",
          "diff": "Index: web/ce/components/pages/header/collaborators-list.tsx\n===================================================================\n--- web/ce/components/pages/header/collaborators-list.tsx\t8166a75 (parent)\n+++ web/ce/components/pages/header/collaborators-list.tsx\teac1115 (commit)\n@@ -0,0 +1,10 @@\n+\"use client\";\n+\n+// store\n+import { TPageInstance } from \"@/store/pages/base-page\";\n+\n+export type TPageCollaboratorsListProps = {\n+  page: TPageInstance;\n+};\n+\n+export const PageCollaboratorsList = ({}: TPageCollaboratorsListProps) => null;\n"
        },
        {
          "path": "web/ce/components/pages/header/lock-control.tsx",
          "status": "added",
          "diff": "Index: web/ce/components/pages/header/lock-control.tsx\n===================================================================\n--- web/ce/components/pages/header/lock-control.tsx\t8166a75 (parent)\n+++ web/ce/components/pages/header/lock-control.tsx\teac1115 (commit)\n@@ -0,0 +1,116 @@\n+\"use client\";\n+\n+import { useState, useEffect, useRef } from \"react\";\n+import { observer } from \"mobx-react\";\n+import { LockKeyhole, LockKeyholeOpen } from \"lucide-react\";\n+// plane imports\n+import { Tooltip } from \"@plane/ui\";\n+// hooks\n+import { usePageOperations } from \"@/hooks/use-page-operations\";\n+// store\n+import { TPageInstance } from \"@/store/pages/base-page\";\n+\n+// Define our lock display states, renaming \"icon-only\" to \"neutral\"\n+type LockDisplayState = \"neutral\" | \"locked\" | \"unlocked\";\n+\n+type Props = {\n+  page: TPageInstance;\n+};\n+\n+export const PageLockControl = observer(({ page }: Props) => {\n+  // Initial state: if locked, then \"locked\", otherwise default to \"neutral\"\n+  const [displayState, setDisplayState] = useState<LockDisplayState>(page.is_locked ? \"locked\" : \"neutral\");\n+  // derived values\n+  const { canCurrentUserLockPage, is_locked } = page;\n+  // Ref for the transition timer\n+  const timerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n+  // Ref to store the previous value of isLocked for detecting transitions\n+  const prevLockedRef = useRef(is_locked);\n+  // page operations\n+  const {\n+    pageOperations: { toggleLock },\n+  } = usePageOperations({\n+    page,\n+  });\n+\n+  // Cleanup any running timer on unmount\n+  useEffect(\n+    () => () => {\n+      if (timerRef.current) clearTimeout(timerRef.current);\n+    },\n+    []\n+  );\n+\n+  // Update display state when isLocked changes\n+  useEffect(() => {\n+    // Clear any previous timer to avoid overlapping transitions\n+    if (timerRef.current) {\n+      clearTimeout(timerRef.current);\n+      timerRef.current = null;\n+    }\n+\n+    // Transition logic:\n+    // If locked, ensure the display state is \"locked\"\n+    // If unlocked after being locked, show \"unlocked\" briefly then revert to \"neutral\"\n+    if (is_locked) {\n+      setDisplayState(\"locked\");\n+    } else if (prevLockedRef.current === true) {\n+      setDisplayState(\"unlocked\");\n+      timerRef.current = setTimeout(() => {\n+        setDisplayState(\"neutral\");\n+        timerRef.current = null;\n+      }, 600);\n+    } else {\n+      setDisplayState(\"neutral\");\n+    }\n+\n+    // Update the previous locked state\n+    prevLockedRef.current = is_locked;\n+  }, [is_locked]);\n+\n+  if (!canCurrentUserLockPage) return null;\n+\n+  // Render different UI based on the current display state\n+  return (\n+    <>\n+      {displayState === \"neutral\" && (\n+        <Tooltip tooltipContent=\"Lock\" position=\"bottom\">\n+          <button\n+            type=\"button\"\n+            onClick={toggleLock}\n+            className=\"flex-shrink-0 size-6 grid place-items-center rounded text-custom-text-200 hover:text-custom-text-100 hover:bg-custom-background-80 transition-colors\"\n+            aria-label=\"Lock\"\n+          >\n+            <LockKeyhole className=\"size-3.5\" />\n+          </button>\n+        </Tooltip>\n+      )}\n+\n+      {displayState === \"locked\" && (\n+        <button\n+          type=\"button\"\n+          onClick={toggleLock}\n+          className=\"h-6 flex items-center gap-1 px-2 rounded text-custom-primary-100 bg-custom-primary-100/20 hover:bg-custom-primary-100/30 transition-colors\"\n+          aria-label=\"Locked\"\n+        >\n+          <LockKeyhole className=\"flex-shrink-0 size-3.5 animate-lock-icon\" />\n+          <span className=\"text-xs font-medium whitespace-nowrap overflow-hidden transition-all duration-500 ease-out animate-text-slide-in\">\n+            Locked\n+          </span>\n+        </button>\n+      )}\n+\n+      {displayState === \"unlocked\" && (\n+        <div\n+          className=\"h-6 flex items-center gap-1 px-2 rounded text-custom-text-200 animate-fade-out\"\n+          aria-label=\"Unlocked\"\n+        >\n+          <LockKeyholeOpen className=\"flex-shrink-0 size-3.5 animate-unlock-icon\" />\n+          <span className=\"text-xs font-medium whitespace-nowrap overflow-hidden transition-all duration-500 ease-out animate-text-slide-in animate-text-fade-out\">\n+            Unlocked\n+          </span>\n+        </div>\n+      )}\n+    </>\n+  );\n+});\n"
        },
        {
          "path": "web/ce/components/pages/header/move-control.tsx",
          "status": "added",
          "diff": "Index: web/ce/components/pages/header/move-control.tsx\n===================================================================\n--- web/ce/components/pages/header/move-control.tsx\t8166a75 (parent)\n+++ web/ce/components/pages/header/move-control.tsx\teac1115 (commit)\n@@ -0,0 +1,10 @@\n+\"use client\";\n+\n+// store\n+import { TPageInstance } from \"@/store/pages/base-page\";\n+\n+export type TPageMoveControlProps = {\n+  page: TPageInstance;\n+};\n+\n+export const PageMoveControl = ({}: TPageMoveControlProps) => null;\n"
        },
        {
          "path": "web/core/components/pages/dropdowns/edit-information-popover.tsx",
          "status": "deleted",
          "diff": "Index: web/core/components/pages/dropdowns/edit-information-popover.tsx\n===================================================================\n--- web/core/components/pages/dropdowns/edit-information-popover.tsx\t8166a75 (parent)\n+++ web/core/components/pages/dropdowns/edit-information-popover.tsx\teac1115 (commit)\n@@ -1,19 +0,0 @@\n-import { observer } from \"mobx-react\";\n-// helpers\n-import { calculateTimeAgoShort } from \"@/helpers/date-time.helper\";\n-// store types\n-import { TPageInstance } from \"@/store/pages/base-page\";\n-\n-type Props = {\n-  page: TPageInstance;\n-};\n-\n-export const PageEditInformationPopover: React.FC<Props> = observer((props) => {\n-  const { page } = props;\n-\n-  return (\n-    <div className=\"flex-shrink-0 whitespace-nowrap\">\n-      <span className=\"text-sm text-custom-text-300\">Edited {calculateTimeAgoShort(page.updated_at ?? \"\")} ago</span>\n-    </div>\n-  );\n-});\n"
        },
        {
          "path": "web/core/components/pages/dropdowns/index.ts",
          "status": "modified",
          "diff": "Index: web/core/components/pages/dropdowns/index.ts\n===================================================================\n--- web/core/components/pages/dropdowns/index.ts\t8166a75 (parent)\n+++ web/core/components/pages/dropdowns/index.ts\teac1115 (commit)\n@@ -1,2 +1,1 @@\n export * from \"./actions\";\n-export * from \"./edit-information-popover\";\n"
        },
        {
          "path": "web/core/components/pages/editor/editor-body.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/pages/editor/editor-body.tsx\n===================================================================\n--- web/core/components/pages/editor/editor-body.tsx\t8166a75 (parent)\n+++ web/core/components/pages/editor/editor-body.tsx\teac1115 (commit)\n@@ -42,12 +42,12 @@\n };\n \n type Props = {\n   config: TEditorBodyConfig;\n-  editorRef: React.RefObject<EditorRefApi>;\n   editorReady: boolean;\n+  editorForwardRef: React.RefObject<EditorRefApi>;\n   handleConnectionStatus: Dispatch<SetStateAction<boolean>>;\n-  handleEditorReady: Dispatch<SetStateAction<boolean>>;\n+  handleEditorReady: (status: boolean) => void;\n   handlers: TEditorBodyHandlers;\n   page: TPageInstance;\n   webhookConnectionParams: TWebhookConnectionQueryParams;\n   workspaceSlug: string;\n@@ -55,9 +55,9 @@\n \n export const PageEditorBody: React.FC<Props> = observer((props) => {\n   const {\n     config,\n-    editorRef,\n+    editorForwardRef,\n     handleConnectionStatus,\n     handleEditorReady,\n     handlers,\n     page,\n@@ -69,9 +69,9 @@\n   const { getWorkspaceBySlug } = useWorkspace();\n   const { getUserDetails } = useMember();\n \n   // derived values\n-  const { id: pageId, name: pageTitle, isContentEditable, updateTitle } = page;\n+  const { id: pageId, name: pageTitle, isContentEditable, updateTitle, editorRef } = page;\n   const workspaceId = getWorkspaceBySlug(workspaceSlug)?.id ?? \"\";\n   // issue-embed\n   const { issueEmbedProps } = useIssueEmbed({\n     fetchEmbedSuggestions: handlers.fetchEntity,\n@@ -171,12 +171,12 @@\n         <div className=\"page-summary-container absolute h-full right-0 top-[64px] z-[5]\">\n           <div className=\"sticky top-[72px]\">\n             <div className=\"group/page-toc relative px-page-x\">\n               <div className=\"cursor-pointer max-h-[50vh] overflow-hidden\">\n-                <PageContentBrowser editorRef={editorRef?.current} showOutline />\n+                <PageContentBrowser editorRef={editorRef} showOutline />\n               </div>\n               <div className=\"absolute top-0 right-0 opacity-0 translate-x-1/2 pointer-events-none group-hover/page-toc:opacity-100 group-hover/page-toc:-translate-x-1/4 group-hover/page-toc:pointer-events-auto transition-all duration-300 w-52 max-h-[70vh] overflow-y-scroll vertical-scrollbar scrollbar-sm whitespace-nowrap bg-custom-background-90 p-4 rounded\">\n-                <PageContentBrowser editorRef={editorRef?.current} />\n+                <PageContentBrowser editorRef={editorRef} />\n               </div>\n             </div>\n           </div>\n         </div>\n@@ -195,9 +195,9 @@\n           editable={isContentEditable}\n           id={pageId}\n           fileHandler={config.fileHandler}\n           handleEditorReady={handleEditorReady}\n-          ref={editorRef}\n+          ref={editorForwardRef}\n           containerClassName=\"h-full p-0 pb-64\"\n           displayConfig={displayConfig}\n           mentionHandler={{\n             searchCallback: async (query) => {\n"
        },
        {
          "path": "web/core/components/pages/editor/header/logo-picker.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/pages/editor/header/logo-picker.tsx\n===================================================================\n--- web/core/components/pages/editor/header/logo-picker.tsx\t8166a75 (parent)\n+++ web/core/components/pages/editor/header/logo-picker.tsx\teac1115 (commit)\n@@ -22,9 +22,9 @@\n   const isLogoSelected = !!logo_props?.in_use;\n \n   return (\n     <div\n-      className={cn(className, \"max-h-0 pointer-events-none transition-all ease-linear duration-200\", {\n+      className={cn(className, \"max-h-0 pointer-events-none transition-all ease-linear duration-300\", {\n         \"max-h-[56px] pointer-events-auto\": isLogoSelected,\n       })}\n     >\n       <EmojiIconPicker\n"
        },
        {
          "path": "web/core/components/pages/editor/page-root.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/pages/editor/page-root.tsx\n===================================================================\n--- web/core/components/pages/editor/page-root.tsx\t8166a75 (parent)\n+++ web/core/components/pages/editor/page-root.tsx\teac1115 (commit)\n@@ -1,5 +1,5 @@\n-import { useEffect, useRef, useState } from \"react\";\n+import { useCallback, useEffect, useRef, useState } from \"react\";\n import { observer } from \"mobx-react\";\n import { useSearchParams } from \"next/navigation\";\n // editor\n import { EditorRefApi } from \"@plane/editor\";\n@@ -17,10 +17,8 @@\n // hooks\n import { useAppRouter } from \"@/hooks/use-app-router\";\n import { usePageFallback } from \"@/hooks/use-page-fallback\";\n import { useQueryParams } from \"@/hooks/use-query-params\";\n-// plane web hooks\n-import { EPageStoreType } from \"@/plane-web/hooks/store\";\n // store\n import { TPageInstance } from \"@/store/pages/base-page\";\n \n export type TPageRootHandlers = {\n@@ -37,15 +35,14 @@\n type TPageRootProps = {\n   config: TPageRootConfig;\n   handlers: TPageRootHandlers;\n   page: TPageInstance;\n-  storeType: EPageStoreType;\n   webhookConnectionParams: TWebhookConnectionQueryParams;\n   workspaceSlug: string;\n };\n \n export const PageRoot = observer((props: TPageRootProps) => {\n-  const { config, handlers, page, storeType, webhookConnectionParams, workspaceSlug } = props;\n+  const { config, handlers, page, webhookConnectionParams, workspaceSlug } = props;\n   // states\n   const [editorReady, setEditorReady] = useState(false);\n   const [hasConnectionFailed, setHasConnectionFailed] = useState(false);\n   const [isVersionsOverlayOpen, setIsVersionsOverlayOpen] = useState(false);\n@@ -55,9 +52,9 @@\n   const router = useAppRouter();\n   // search params\n   const searchParams = useSearchParams();\n   // derived values\n-  const { isContentEditable } = page;\n+  const { isContentEditable, setEditorRef } = page;\n   // page fallback\n   usePageFallback({\n     editorRef,\n     fetchPageDescription: handlers.fetchDescriptionBinary,\n@@ -66,8 +63,18 @@\n   });\n   // update query params\n   const { updateQueryParams } = useQueryParams();\n \n+  const handleEditorReady = useCallback(\n+    (status: boolean) => {\n+      setEditorReady(status);\n+      if (editorRef.current && !page.editorRef) {\n+        setEditorRef(editorRef.current);\n+      }\n+    },\n+    [page.editorRef, setEditorRef]\n+  );\n+\n   const version = searchParams.get(\"version\");\n   useEffect(() => {\n     if (!version) {\n       setIsVersionsOverlayOpen(false);\n@@ -88,8 +95,16 @@\n     editorRef.current?.setEditorValue(descriptionHTML);\n   };\n   const currentVersionDescription = editorRef.current?.getDocument().html;\n \n+  // reset editor ref on unmount\n+  useEffect(\n+    () => () => {\n+      setEditorRef(null);\n+    },\n+    [setEditorRef]\n+  );\n+\n   return (\n     <>\n       <PageVersionsOverlay\n         activeVersion={version}\n@@ -102,15 +117,15 @@\n         onClose={handleCloseVersionsOverlay}\n         pageId={page.id ?? \"\"}\n         restoreEnabled={isContentEditable}\n       />\n-      <PageEditorToolbarRoot editorReady={editorReady} editorRef={editorRef} page={page} storeType={storeType} />\n+      <PageEditorToolbarRoot page={page} />\n       <PageEditorBody\n         config={config}\n         editorReady={editorReady}\n-        editorRef={editorRef}\n+        editorForwardRef={editorRef}\n         handleConnectionStatus={setHasConnectionFailed}\n-        handleEditorReady={setEditorReady}\n+        handleEditorReady={handleEditorReady}\n         handlers={handlers}\n         page={page}\n         webhookConnectionParams={webhookConnectionParams}\n         workspaceSlug={workspaceSlug}\n"
        },
        {
          "path": "web/core/components/pages/editor/summary/content-browser.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/pages/editor/summary/content-browser.tsx\n===================================================================\n--- web/core/components/pages/editor/summary/content-browser.tsx\t8166a75 (parent)\n+++ web/core/components/pages/editor/summary/content-browser.tsx\teac1115 (commit)\n@@ -1,5 +1,5 @@\n-import { useState, useEffect } from \"react\";\n+import { useState, useEffect, useCallback } from \"react\";\n // plane editor\n import { EditorRefApi, IMarking } from \"@plane/editor\";\n // components\n import { OutlineHeading1, OutlineHeading2, OutlineHeading3 } from \"./heading-components\";\n@@ -23,12 +23,15 @@\n       if (unsubscribe) unsubscribe();\n     };\n   }, [editorRef]);\n \n-  const handleOnClick = (marking: IMarking) => {\n-    editorRef?.scrollSummary(marking);\n-    if (setSidePeekVisible) setSidePeekVisible(false);\n-  };\n+  const handleOnClick = useCallback(\n+    (marking: IMarking) => {\n+      editorRef?.scrollSummary(marking);\n+      setSidePeekVisible?.(false);\n+    },\n+    [editorRef, setSidePeekVisible]\n+  );\n \n   const HeadingComponent: {\n     [key: number]: React.FC<{ marking: IMarking; onClick: () => void }>;\n   } = {\n"
        },
        {
          "path": "web/core/components/pages/editor/title.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/pages/editor/title.tsx\n===================================================================\n--- web/core/components/pages/editor/title.tsx\t8166a75 (parent)\n+++ web/core/components/pages/editor/title.tsx\teac1115 (commit)\n@@ -12,9 +12,9 @@\n // hooks\n import { usePageFilters } from \"@/hooks/use-page-filters\";\n \n type Props = {\n-  editorRef: React.RefObject<EditorRefApi>;\n+  editorRef: EditorRefApi | null;\n   readOnly: boolean;\n   title: string | undefined;\n   updateTitle: (title: string) => void;\n };\n@@ -52,9 +52,9 @@\n             placeholder=\"Untitled\"\n             onKeyDown={(e) => {\n               if (e.key === \"Enter\") {\n                 e.preventDefault();\n-                editorRef.current?.setFocusAtPosition(0);\n+                editorRef?.setFocusAtPosition(0);\n               }\n             }}\n             value={title}\n             onChange={(e) => updateTitle(e.target.value)}\n"
        },
        {
          "path": "web/core/components/pages/editor/toolbar/extra-options.tsx",
          "status": "deleted",
          "diff": "Index: web/core/components/pages/editor/toolbar/extra-options.tsx\n===================================================================\n--- web/core/components/pages/editor/toolbar/extra-options.tsx\t8166a75 (parent)\n+++ web/core/components/pages/editor/toolbar/extra-options.tsx\teac1115 (commit)\n@@ -1,103 +0,0 @@\n-\"use client\";\n-\n-import { observer } from \"mobx-react\";\n-// constants\n-import { IS_FAVORITE_MENU_OPEN } from \"@plane/constants\";\n-// editor\n-import { EditorRefApi } from \"@plane/editor\";\n-// plane hooks\n-import { useLocalStorage } from \"@plane/hooks\";\n-// ui\n-import { ArchiveIcon, FavoriteStar, setToast, TOAST_TYPE, Tooltip } from \"@plane/ui\";\n-// components\n-import { LockedComponent } from \"@/components/icons/locked-component\";\n-import { PageInfoPopover, PageOptionsDropdown } from \"@/components/pages\";\n-// helpers\n-import { renderFormattedDate } from \"@/helpers/date-time.helper\";\n-// hooks\n-import useOnlineStatus from \"@/hooks/use-online-status\";\n-// plane web hooks\n-import { EPageStoreType } from \"@/plane-web/hooks/store\";\n-// store\n-import { TPageInstance } from \"@/store/pages/base-page\";\n-\n-type Props = {\n-  editorRef: EditorRefApi;\n-  page: TPageInstance;\n-  storeType: EPageStoreType;\n-};\n-\n-export const PageExtraOptions: React.FC<Props> = observer((props) => {\n-  const { editorRef, page, storeType } = props;\n-  // derived values\n-  const {\n-    archived_at,\n-    isContentEditable,\n-    is_favorite,\n-    is_locked,\n-    canCurrentUserFavoritePage,\n-    addToFavorites,\n-    removePageFromFavorites,\n-  } = page;\n-  // use online status\n-  const { isOnline } = useOnlineStatus();\n-  // local storage\n-  const { setValue: toggleFavoriteMenu, storedValue: isFavoriteMenuOpen } = useLocalStorage<boolean>(\n-    IS_FAVORITE_MENU_OPEN,\n-    false\n-  );\n-  // favorite handler\n-  const handleFavorite = () => {\n-    if (is_favorite) {\n-      removePageFromFavorites().then(() =>\n-        setToast({\n-          type: TOAST_TYPE.SUCCESS,\n-          title: \"Success!\",\n-          message: \"Page removed from favorites.\",\n-        })\n-      );\n-    } else {\n-      addToFavorites().then(() => {\n-        if (!isFavoriteMenuOpen) toggleFavoriteMenu(true);\n-        setToast({\n-          type: TOAST_TYPE.SUCCESS,\n-          title: \"Success!\",\n-          message: \"Page added to favorites.\",\n-        });\n-      });\n-    }\n-  };\n-\n-  return (\n-    <div className=\"flex items-center gap-3\">\n-      {is_locked && <LockedComponent />}\n-      {archived_at && (\n-        <div className=\"flex-shrink-0 flex h-7 items-center gap-2 rounded-full bg-blue-500/20 px-3 py-0.5 text-xs font-medium text-blue-500\">\n-          <ArchiveIcon className=\"flex-shrink-0 size-3\" />\n-          <span>Archived at {renderFormattedDate(archived_at)}</span>\n-        </div>\n-      )}\n-      {isContentEditable && !isOnline && (\n-        <Tooltip\n-          tooltipHeading=\"You are offline.\"\n-          tooltipContent=\"You can continue making changes. They will be synced when you are back online.\"\n-        >\n-          <div className=\"flex-shrink-0 flex h-7 items-center gap-2 rounded-full bg-custom-background-80 px-3 py-0.5 text-xs font-medium text-custom-text-300\">\n-            <span className=\"flex-shrink-0 size-1.5 rounded-full bg-custom-text-300\" />\n-            <span>Offline</span>\n-          </div>\n-        </Tooltip>\n-      )}\n-      {canCurrentUserFavoritePage && (\n-        <FavoriteStar\n-          selected={is_favorite}\n-          onClick={handleFavorite}\n-          buttonClassName=\"flex-shrink-0\"\n-          iconClassName=\"text-custom-text-100\"\n-        />\n-      )}\n-      <PageInfoPopover editorRef={editorRef} page={page} />\n-      <PageOptionsDropdown editorRef={editorRef} page={page} storeType={storeType} />\n-    </div>\n-  );\n-});\n"
        },
        {
          "path": "web/core/components/pages/editor/toolbar/index.ts",
          "status": "modified",
          "diff": "Index: web/core/components/pages/editor/toolbar/index.ts\n===================================================================\n--- web/core/components/pages/editor/toolbar/index.ts\t8166a75 (parent)\n+++ web/core/components/pages/editor/toolbar/index.ts\teac1115 (commit)\n@@ -1,7 +1,5 @@\n export * from \"./color-dropdown\";\n-export * from \"./extra-options\";\n export * from \"./info-popover\";\n export * from \"./options-dropdown\";\n export * from \"./root\";\n-export * from \"./mobile-root\";\n export * from \"./toolbar\";\n"
        },
        {
          "path": "web/core/components/pages/editor/toolbar/info-popover.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/pages/editor/toolbar/info-popover.tsx\n===================================================================\n--- web/core/components/pages/editor/toolbar/info-popover.tsx\t8166a75 (parent)\n+++ web/core/components/pages/editor/toolbar/info-popover.tsx\teac1115 (commit)\n@@ -1,29 +1,26 @@\n import { useState } from \"react\";\n+import { observer } from \"mobx-react\";\n import Link from \"next/link\";\n import { useParams } from \"next/navigation\";\n import { usePopper } from \"react-popper\";\n import { Info } from \"lucide-react\";\n-// plane editor\n-import { EditorRefApi } from \"@plane/editor\";\n-// plane ui\n+// plane imports\n import { Avatar } from \"@plane/ui\";\n-// plane utils\n import { getFileURL, renderFormattedDate } from \"@plane/utils\";\n // helpers\n-import { getReadTimeFromWordsCount } from \"@/helpers/date-time.helper\";\n+import { calculateTimeAgoShort, getReadTimeFromWordsCount } from \"@/helpers/date-time.helper\";\n // hooks\n import { useMember } from \"@/hooks/store\";\n // store types\n import { TPageInstance } from \"@/store/pages/base-page\";\n \n type Props = {\n-  editorRef: EditorRefApi | null;\n   page: TPageInstance;\n };\n \n-export const PageInfoPopover: React.FC<Props> = (props) => {\n-  const { editorRef, page } = props;\n+export const PageInfoPopover: React.FC<Props> = observer((props) => {\n+  const { page } = props;\n   // states\n   const [isPopoverOpen, setIsPopoverOpen] = useState(false);\n   // refs\n   const [referenceElement, setReferenceElement] = useState<HTMLButtonElement | null>(null);\n@@ -39,9 +36,9 @@\n   // derived values\n   const editorInformation = page.updated_by ? getUserDetails(page.updated_by) : undefined;\n   const creatorInformation = page.created_by ? getUserDetails(page.created_by) : undefined;\n \n-  const documentsInfo = editorRef?.getDocumentInfo() || { words: 0, characters: 0, paragraphs: 0 };\n+  const documentsInfo = page.editorRef?.getDocumentInfo() || { words: 0, characters: 0, paragraphs: 0 };\n \n   const secondsToReadableTime = () => {\n     const wordsCount = documentsInfo.words;\n     const readTimeInSeconds = Number(getReadTimeFromWordsCount(wordsCount).toFixed(0));\n@@ -71,10 +68,18 @@\n     },\n   ];\n \n   return (\n-    <div onMouseEnter={() => setIsPopoverOpen(true)} onMouseLeave={() => setIsPopoverOpen(false)}>\n-      <button type=\"button\" ref={setReferenceElement} className=\"block\">\n+    <div\n+      className=\"flex-shrink-0\"\n+      onMouseEnter={() => setIsPopoverOpen(true)}\n+      onMouseLeave={() => setIsPopoverOpen(false)}\n+    >\n+      <button\n+        type=\"button\"\n+        ref={setReferenceElement}\n+        className=\"size-6 grid place-items-center rounded text-custom-text-200 hover:text-custom-text-100 hover:bg-custom-background-80 transition-colors\"\n+      >\n         <Info className=\"size-3.5\" />\n       </button>\n       {isPopoverOpen && (\n         <div\n@@ -105,9 +110,9 @@\n                   size=\"sm\"\n                 />\n                 <span>\n                   {editorInformation?.display_name}{\" \"}\n-                  <span className=\"text-custom-text-300\">{renderFormattedDate(page.updated_at)}</span>\n+                  <span className=\"text-custom-text-300\">{calculateTimeAgoShort(page.updated_at ?? \"\")} ago</span>\n                 </span>\n               </Link>\n             </div>\n             <div>\n@@ -132,5 +137,5 @@\n         </div>\n       )}\n     </div>\n   );\n-};\n+});\n"
        },
        {
          "path": "web/core/components/pages/editor/toolbar/mobile-root.tsx",
          "status": "deleted",
          "diff": "Index: web/core/components/pages/editor/toolbar/mobile-root.tsx\n===================================================================\n--- web/core/components/pages/editor/toolbar/mobile-root.tsx\t8166a75 (parent)\n+++ web/core/components/pages/editor/toolbar/mobile-root.tsx\teac1115 (commit)\n@@ -1,37 +0,0 @@\n-import { observer } from \"mobx-react\";\n-// plane imports\n-import { EditorRefApi } from \"@plane/editor\";\n-import { Header, EHeaderVariant } from \"@plane/ui\";\n-// components\n-import { PageExtraOptions, PageToolbar } from \"@/components/pages\";\n-// hooks\n-import { usePageFilters } from \"@/hooks/use-page-filters\";\n-// plane web hooks\n-import { EPageStoreType } from \"@/plane-web/hooks/store\";\n-// store\n-import { TPageInstance } from \"@/store/pages/base-page\";\n-\n-type Props = {\n-  editorRef: EditorRefApi;\n-  page: TPageInstance;\n-  storeType: EPageStoreType;\n-};\n-\n-export const PageEditorMobileHeaderRoot: React.FC<Props> = observer((props) => {\n-  const { editorRef, page, storeType } = props;\n-  // derived values\n-  const { isContentEditable } = page;\n-  // page filters\n-  const { isStickyToolbarEnabled } = usePageFilters();\n-\n-  return (\n-    <>\n-      <Header variant={EHeaderVariant.SECONDARY}>\n-        <PageExtraOptions editorRef={editorRef} page={page} storeType={storeType} />\n-      </Header>\n-      <Header variant={EHeaderVariant.TERNARY}>\n-        {isContentEditable && editorRef && <PageToolbar editorRef={editorRef} isHidden={!isStickyToolbarEnabled} />}\n-      </Header>\n-    </>\n-  );\n-});\n"
        },
        {
          "path": "web/core/components/pages/editor/toolbar/options-dropdown.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/pages/editor/toolbar/options-dropdown.tsx\n===================================================================\n--- web/core/components/pages/editor/toolbar/options-dropdown.tsx\t8166a75 (parent)\n+++ web/core/components/pages/editor/toolbar/options-dropdown.tsx\teac1115 (commit)\n@@ -3,11 +3,9 @@\n import { useMemo, useState } from \"react\";\n import { observer } from \"mobx-react\";\n import { useRouter } from \"next/navigation\";\n import { ArrowUpToLine, Clipboard, History } from \"lucide-react\";\n-// document editor\n-import { EditorRefApi } from \"@plane/editor\";\n-// ui\n+// plane imports\n import { TContextMenuItem, TOAST_TYPE, ToggleSwitch, setToast } from \"@plane/ui\";\n // components\n import { ExportPageModal, PageActions, TPageActions } from \"@/components/pages\";\n // helpers\n@@ -20,21 +18,20 @@\n // store\n import { TPageInstance } from \"@/store/pages/base-page\";\n \n type Props = {\n-  editorRef: EditorRefApi | null;\n   page: TPageInstance;\n   storeType: EPageStoreType;\n };\n \n export const PageOptionsDropdown: React.FC<Props> = observer((props) => {\n-  const { editorRef, page, storeType } = props;\n+  const { page, storeType } = props;\n   // states\n   const [isExportModalOpen, setIsExportModalOpen] = useState(false);\n   // router\n   const router = useRouter();\n   // store values\n-  const { name, isContentEditable } = page;\n+  const { name, isContentEditable, editorRef } = page;\n   // page filters\n   const { isFullWidth, handleFullWidth, isStickyToolbarEnabled, handleStickyToolbar } = usePageFilters();\n   // update query params\n   const { updateQueryParams } = useQueryParams();\n@@ -126,12 +123,9 @@\n         extraOptions={EXTRA_MENU_OPTIONS}\n         optionsOrder={[\n           \"full-screen\",\n           \"sticky-toolbar\",\n-          \"copy-link\",\n           \"make-a-copy\",\n-          \"move\",\n-          \"toggle-lock\",\n           \"toggle-access\",\n           \"archive-restore\",\n           \"delete\",\n           \"version-history\",\n"
        },
        {
          "path": "web/core/components/pages/editor/toolbar/root.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/pages/editor/toolbar/root.tsx\n===================================================================\n--- web/core/components/pages/editor/toolbar/root.tsx\t8166a75 (parent)\n+++ web/core/components/pages/editor/toolbar/root.tsx\teac1115 (commit)\n@@ -1,58 +1,48 @@\n import { observer } from \"mobx-react\";\n-import { EditorRefApi } from \"@plane/editor\";\n // components\n-import { PageEditorMobileHeaderRoot, PageExtraOptions, PageToolbar } from \"@/components/pages\";\n+import { PageToolbar } from \"@/components/pages\";\n // helpers\n import { cn } from \"@/helpers/common.helper\";\n // hooks\n import { usePageFilters } from \"@/hooks/use-page-filters\";\n-// plane web hooks\n-import { EPageStoreType } from \"@/plane-web/hooks/store\";\n+// plane web components\n+import { PageCollaboratorsList } from \"@/plane-web/components/pages/header/collaborators-list\";\n // store\n import { TPageInstance } from \"@/store/pages/base-page\";\n \n type Props = {\n-  editorReady: boolean;\n-  editorRef: React.RefObject<EditorRefApi>;\n   page: TPageInstance;\n-  storeType: EPageStoreType;\n };\n \n export const PageEditorToolbarRoot: React.FC<Props> = observer((props) => {\n-  const { editorReady, editorRef, page, storeType } = props;\n+  const { page } = props;\n   // derived values\n-  const { isContentEditable } = page;\n+  const { isContentEditable, editorRef } = page;\n   // page filters\n   const { isFullWidth, isStickyToolbarEnabled } = usePageFilters();\n   // derived values\n-  const resolvedEditorRef = editorRef.current;\n   const shouldHideToolbar = !isStickyToolbarEnabled || !isContentEditable;\n \n-  if (!resolvedEditorRef) return null;\n-\n   return (\n-    <div id=\"page-toolbar-container\">\n+    <div\n+      id=\"page-toolbar-container\"\n+      className={cn(\"max-h-[52px] transition-all ease-linear duration-300 overflow-auto\", {\n+        \"max-h-0 overflow-hidden\": shouldHideToolbar,\n+      })}\n+    >\n       <div\n         className={cn(\n-          \"hidden md:flex items-center relative min-h-[52px] page-toolbar-content px-page-x border-b border-transparent transition-all duration-200 ease-in-out\",\n+          \"hidden md:flex items-center relative min-h-[52px] page-toolbar-content px-page-x transition-all duration-200 ease-in-out\",\n           {\n             \"wide-layout\": isFullWidth,\n-            \"border-custom-border-200\": true,\n           }\n         )}\n       >\n         <div className=\"max-w-full w-full flex items-center justify-between\">\n-          <div>\n-            {editorReady && resolvedEditorRef && (\n-              <PageToolbar editorRef={resolvedEditorRef} isHidden={shouldHideToolbar} />\n-            )}\n-          </div>\n-          <PageExtraOptions editorRef={resolvedEditorRef} page={page} storeType={storeType} />\n+          {editorRef && <PageToolbar editorRef={editorRef} />}\n+          <PageCollaboratorsList page={page} />\n         </div>\n       </div>\n-      <div className=\"md:hidden\">\n-        <PageEditorMobileHeaderRoot editorRef={resolvedEditorRef} page={page} storeType={storeType} />\n-      </div>\n     </div>\n   );\n });\n"
        },
        {
          "path": "web/core/components/pages/editor/toolbar/toolbar.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/pages/editor/toolbar/toolbar.tsx\n===================================================================\n--- web/core/components/pages/editor/toolbar/toolbar.tsx\t8166a75 (parent)\n+++ web/core/components/pages/editor/toolbar/toolbar.tsx\teac1115 (commit)\n@@ -14,9 +14,8 @@\n import { cn } from \"@/helpers/common.helper\";\n \n type Props = {\n   editorRef: EditorRefApi;\n-  isHidden: boolean;\n };\n \n type ToolbarButtonProps = {\n   item: ToolbarMenuItem;\n@@ -64,9 +63,9 @@\n \n const toolbarItems = TOOLBAR_ITEMS.document;\n \n export const PageToolbar: React.FC<Props> = (props) => {\n-  const { editorRef, isHidden } = props;\n+  const { editorRef } = props;\n   // states\n   const [activeStates, setActiveStates] = useState<Record<string, boolean>>({});\n \n   const updateActiveStates = useCallback(() => {\n@@ -97,16 +96,9 @@\n     })\n   );\n \n   return (\n-    <div\n-      className={cn(\n-        \"flex flex-wrap items-center divide-x divide-custom-border-200 opacity-100 transition-opacity duration-200 ease-in-out\",\n-        {\n-          \"opacity-0 pointer-events-none\": isHidden,\n-        }\n-      )}\n-    >\n+    <div className=\"flex items-center divide-x divide-custom-border-200 overflow-x-scroll\">\n       <CustomMenu\n         customButton={\n           <span className=\"text-custom-text-300 text-sm border-[0.5px] border-custom-border-300 hover:bg-custom-background-80 h-7 w-24 rounded px-2 flex items-center justify-between gap-2 whitespace-nowrap text-left\">\n             {activeTypography?.name || \"Text\"}\n@@ -138,22 +130,24 @@\n             )}\n           </CustomMenu.MenuItem>\n         ))}\n       </CustomMenu>\n-      <ColorDropdown\n-        handleColorSelect={(key, color) =>\n-          editorRef.executeMenuItemCommand({\n-            itemKey: key,\n-            color,\n-          })\n-        }\n-        isColorActive={(key, color) =>\n-          editorRef.isMenuItemActive({\n-            itemKey: key,\n-            color,\n-          })\n-        }\n-      />\n+      <div className=\"flex-shrink-0\">\n+        <ColorDropdown\n+          handleColorSelect={(key, color) =>\n+            editorRef.executeMenuItemCommand({\n+              itemKey: key,\n+              color,\n+            })\n+          }\n+          isColorActive={(key, color) =>\n+            editorRef.isMenuItemActive({\n+              itemKey: key,\n+              color,\n+            })\n+          }\n+        />\n+      </div>\n       {Object.keys(toolbarItems).map((key) => (\n         <div key={key} className=\"flex items-center gap-0.5 px-2 first:pl-0 last:pr-0\">\n           {toolbarItems[key].map((item) => (\n             <ToolbarButton\n"
        },
        {
          "path": "web/core/components/pages/header/actions.tsx",
          "status": "added",
          "diff": "Index: web/core/components/pages/header/actions.tsx\n===================================================================\n--- web/core/components/pages/header/actions.tsx\t8166a75 (parent)\n+++ web/core/components/pages/header/actions.tsx\teac1115 (commit)\n@@ -0,0 +1,37 @@\n+\"use client\";\n+\n+import { observer } from \"mobx-react\";\n+// components\n+import { PageInfoPopover, PageOptionsDropdown } from \"@/components/pages\";\n+// plane web components\n+import { PageLockControl } from \"@/plane-web/components/pages/header/lock-control\";\n+import { PageMoveControl } from \"@/plane-web/components/pages/header/move-control\";\n+// plane web hooks\n+import { EPageStoreType } from \"@/plane-web/hooks/store\";\n+// store\n+import { TPageInstance } from \"@/store/pages/base-page\";\n+// local imports\n+import { PageArchivedBadge } from \"./archived-badge\";\n+import { PageCopyLinkControl } from \"./copy-link-control\";\n+import { PageOfflineBadge } from \"./offline-badge\";\n+\n+type Props = {\n+  page: TPageInstance;\n+  storeType: EPageStoreType;\n+};\n+\n+export const PageHeaderActions: React.FC<Props> = observer((props) => {\n+  const { page, storeType } = props;\n+\n+  return (\n+    <div className=\"flex items-center gap-1\">\n+      <PageArchivedBadge page={page} />\n+      <PageOfflineBadge page={page} />\n+      <PageLockControl page={page} />\n+      <PageMoveControl page={page} />\n+      <PageInfoPopover page={page} />\n+      <PageCopyLinkControl page={page} />\n+      <PageOptionsDropdown page={page} storeType={storeType} />\n+    </div>\n+  );\n+});\n"
        },
        {
          "path": "web/core/components/pages/header/archived-badge.tsx",
          "status": "added",
          "diff": "Index: web/core/components/pages/header/archived-badge.tsx\n===================================================================\n--- web/core/components/pages/header/archived-badge.tsx\t8166a75 (parent)\n+++ web/core/components/pages/header/archived-badge.tsx\teac1115 (commit)\n@@ -0,0 +1,21 @@\n+import { observer } from \"mobx-react\";\n+// plane imports\n+import { ArchiveIcon } from \"@plane/ui\";\n+import { renderFormattedDate } from \"@plane/utils\";\n+// store\n+import { TPageInstance } from \"@/store/pages/base-page\";\n+\n+type Props = {\n+  page: TPageInstance;\n+};\n+\n+export const PageArchivedBadge = observer(({ page }: Props) => {\n+  if (!page.archived_at) return null;\n+\n+  return (\n+    <div className=\"flex-shrink-0 h-6 flex items-center gap-1 px-2 rounded text-custom-primary-100 bg-custom-primary-100/20\">\n+      <ArchiveIcon className=\"flex-shrink-0 size-3.5\" />\n+      <span className=\"text-xs font-medium\">Archived at {renderFormattedDate(page.archived_at)}</span>\n+    </div>\n+  );\n+});\n"
        },
        {
          "path": "web/core/components/pages/header/copy-link-control.tsx",
          "status": "added",
          "diff": "Index: web/core/components/pages/header/copy-link-control.tsx\n===================================================================\n--- web/core/components/pages/header/copy-link-control.tsx\t8166a75 (parent)\n+++ web/core/components/pages/header/copy-link-control.tsx\teac1115 (commit)\n@@ -0,0 +1,27 @@\n+import { observer } from \"mobx-react\";\n+import { Link } from \"lucide-react\";\n+// hooks\n+import { usePageOperations } from \"@/hooks/use-page-operations\";\n+// store\n+import { TPageInstance } from \"@/store/pages/base-page\";\n+\n+type Props = {\n+  page: TPageInstance;\n+};\n+\n+export const PageCopyLinkControl = observer(({ page }: Props) => {\n+  // page operations\n+  const { pageOperations } = usePageOperations({\n+    page,\n+  });\n+\n+  return (\n+    <button\n+      type=\"button\"\n+      onClick={pageOperations.copyLink}\n+      className=\"flex-shrink-0 size-6 grid place-items-center rounded text-custom-text-200 hover:text-custom-text-100 hover:bg-custom-background-80 transition-colors\"\n+    >\n+      <Link className=\"size-3.5\" />\n+    </button>\n+  );\n+});\n"
        },
        {
          "path": "web/core/components/pages/header/favorite-control.tsx",
          "status": "added",
          "diff": "Index: web/core/components/pages/header/favorite-control.tsx\n===================================================================\n--- web/core/components/pages/header/favorite-control.tsx\t8166a75 (parent)\n+++ web/core/components/pages/header/favorite-control.tsx\teac1115 (commit)\n@@ -0,0 +1,31 @@\n+import { observer } from \"mobx-react\";\n+// plane imports\n+import { FavoriteStar } from \"@plane/ui\";\n+// hooks\n+import { usePageOperations } from \"@/hooks/use-page-operations\";\n+// store\n+import { TPageInstance } from \"@/store/pages/base-page\";\n+\n+type Props = {\n+  page: TPageInstance;\n+};\n+\n+export const PageFavoriteControl = observer(({ page }: Props) => {\n+  // derived values\n+  const { is_favorite, canCurrentUserFavoritePage } = page;\n+  // page operations\n+  const { pageOperations } = usePageOperations({\n+    page,\n+  });\n+\n+  if (!canCurrentUserFavoritePage) return null;\n+\n+  return (\n+    <FavoriteStar\n+      selected={is_favorite}\n+      onClick={pageOperations.toggleFavorite}\n+      buttonClassName=\"flex-shrink-0 size-6 group rounded hover:bg-custom-background-80 transition-colors\"\n+      iconClassName=\"size-3.5 text-custom-text-200 group-hover:text-custom-text-10\"\n+    />\n+  );\n+});\n"
        },
        {
          "path": "web/core/components/pages/header/offline-badge.tsx",
          "status": "added",
          "diff": "Index: web/core/components/pages/header/offline-badge.tsx\n===================================================================\n--- web/core/components/pages/header/offline-badge.tsx\t8166a75 (parent)\n+++ web/core/components/pages/header/offline-badge.tsx\teac1115 (commit)\n@@ -0,0 +1,30 @@\n+import { observer } from \"mobx-react\";\n+// plane imports\n+import { Tooltip } from \"@plane/ui\";\n+// hooks\n+import useOnlineStatus from \"@/hooks/use-online-status\";\n+// store\n+import { TPageInstance } from \"@/store/pages/base-page\";\n+\n+type Props = {\n+  page: TPageInstance;\n+};\n+\n+export const PageOfflineBadge = observer(({ page }: Props) => {\n+  // use online status\n+  const { isOnline } = useOnlineStatus();\n+\n+  if (!page.isContentEditable || isOnline) return null;\n+\n+  return (\n+    <Tooltip\n+      tooltipHeading=\"You are offline.\"\n+      tooltipContent=\"You can continue making changes. They will be synced when you are back online.\"\n+    >\n+      <div className=\"flex-shrink-0 flex h-7 items-center gap-2 rounded-full bg-custom-background-80 px-3 py-0.5 text-xs font-medium text-custom-text-300\">\n+        <span className=\"flex-shrink-0 size-1.5 rounded-full bg-custom-text-300\" />\n+        <span>Offline</span>\n+      </div>\n+    </Tooltip>\n+  );\n+});\n"
        },
        {
          "path": "web/core/hooks/use-page-operations.ts",
          "status": "modified",
          "diff": "Index: web/core/hooks/use-page-operations.ts\n===================================================================\n--- web/core/hooks/use-page-operations.ts\t8166a75 (parent)\n+++ web/core/hooks/use-page-operations.ts\teac1115 (commit)\n@@ -46,9 +46,9 @@\n   } = page;\n   // collaborative actions\n   const { executeCollaborativeAction } = useCollaborativePageActions(props);\n   // local storage\n-  const { setValue: toggleFavoriteMenu, storedValue: isfavoriteMenuOpen } = useLocalStorage<boolean>(\n+  const { setValue: toggleFavoriteMenu, storedValue: isFavoriteMenuOpen } = useLocalStorage<boolean>(\n     IS_FAVORITE_MENU_OPEN,\n     false\n   );\n   // page operations\n@@ -146,9 +146,9 @@\n             })\n           );\n         } else {\n           addToFavorites().then(() => {\n-            if (!isfavoriteMenuOpen) toggleFavoriteMenu(true);\n+            if (!isFavoriteMenuOpen) toggleFavoriteMenu(true);\n             setToast({\n               type: TOAST_TYPE.SUCCESS,\n               title: \"Success!\",\n               message: \"Page added to favorites.\",\n@@ -198,9 +198,11 @@\n     executeCollaborativeAction,\n     getRedirectionLink,\n     is_favorite,\n     is_locked,\n+    isFavoriteMenuOpen,\n     removePageFromFavorites,\n+    toggleFavoriteMenu,\n   ]);\n   return {\n     pageOperations,\n   };\n"
        },
        {
          "path": "web/core/store/pages/base-page.ts",
          "status": "modified",
          "diff": "Index: web/core/store/pages/base-page.ts\n===================================================================\n--- web/core/store/pages/base-page.ts\t8166a75 (parent)\n+++ web/core/store/pages/base-page.ts\teac1115 (commit)\n@@ -1,8 +1,9 @@\n import set from \"lodash/set\";\n import { action, computed, makeObservable, observable, reaction, runInAction } from \"mobx\";\n // plane imports\n import { EPageAccess } from \"@plane/constants\";\n+import { EditorRefApi } from \"@plane/editor\";\n import { TDocumentPayload, TLogoProps, TNameDescriptionLoader, TPage } from \"@plane/types\";\n import { TChangeHandlerProps } from \"@plane/ui\";\n import { convertHexEmojiToDecimal } from \"@plane/utils\";\n // plane web store\n@@ -10,8 +11,9 @@\n \n export type TBasePage = TPage & {\n   // observables\n   isSubmitting: TNameDescriptionLoader;\n+  editorRef: EditorRefApi | null;\n   // computed\n   asJSON: TPage | undefined;\n   isCurrentUserOwner: boolean;\n   // helpers\n@@ -31,8 +33,10 @@\n   updatePageLogo: (value: TChangeHandlerProps) => Promise<void>;\n   addToFavorites: () => Promise<void>;\n   removePageFromFavorites: () => Promise<void>;\n   duplicate: () => Promise<TPage | undefined>;\n+  mutateProperties: (data: Partial<TPage>, shouldUpdateName?: boolean) => void;\n+  setEditorRef: (editorRef: EditorRefApi | null) => void;\n };\n \n export type TBasePagePermissions = {\n   canCurrentUserAccessPage: boolean;\n@@ -67,8 +71,9 @@\n \n export class BasePage implements TBasePage {\n   // loaders\n   isSubmitting: TNameDescriptionLoader = \"saved\";\n+  editorRef: EditorRefApi | null = null;\n   // page properties\n   id: string | undefined;\n   name: string | undefined;\n   logo_props: TLogoProps | undefined;\n@@ -124,8 +129,9 @@\n \n     makeObservable(this, {\n       // loaders\n       isSubmitting: observable.ref,\n+      editorRef: observable.ref,\n       // page properties\n       id: observable.ref,\n       name: observable.ref,\n       logo_props: observable.ref,\n@@ -164,8 +170,10 @@\n       updatePageLogo: action,\n       addToFavorites: action,\n       removePageFromFavorites: action,\n       duplicate: action,\n+      mutateProperties: action,\n+      setEditorRef: action,\n     });\n \n     this.rootStore = store;\n     this.services = services;\n@@ -425,27 +433,36 @@\n     }\n   };\n \n   updatePageLogo = async (value: TChangeHandlerProps) => {\n-    let logoValue = {};\n-    if (value?.type === \"emoji\")\n-      logoValue = {\n-        value: convertHexEmojiToDecimal(value.value.unified),\n-        url: value.value.imageUrl,\n+    const originalLogoProps = { ...this.logo_props };\n+    try {\n+      let logoValue = {};\n+      if (value?.type === \"emoji\")\n+        logoValue = {\n+          value: convertHexEmojiToDecimal(value.value.unified),\n+          url: value.value.imageUrl,\n+        };\n+      else if (value?.type === \"icon\") logoValue = value.value;\n+\n+      const logoProps: TLogoProps = {\n+        in_use: value?.type,\n+        [value?.type]: logoValue,\n       };\n-    else if (value?.type === \"icon\") logoValue = value.value;\n \n-    const logoProps: TLogoProps = {\n-      in_use: value?.type,\n-      [value?.type]: logoValue,\n-    };\n-\n-    await this.services.update({\n-      logo_props: logoProps,\n-    });\n-    runInAction(() => {\n-      this.logo_props = logoProps;\n-    });\n+      runInAction(() => {\n+        this.logo_props = logoProps;\n+      });\n+      await this.services.update({\n+        logo_props: logoProps,\n+      });\n+    } catch (error) {\n+      console.error(\"Error in updating page logo\", error);\n+      runInAction(() => {\n+        this.logo_props = originalLogoProps as TLogoProps;\n+      });\n+      throw error;\n+    }\n   };\n \n   /**\n    * @description add the page to favorites\n@@ -497,5 +514,24 @@\n   /**\n    * @description duplicate the page\n    */\n   duplicate = async () => await this.services.duplicate();\n+\n+  /**\n+   * @description mutate multiple properties at once\n+   * @param data Partial<TPage>\n+   */\n+  mutateProperties = (data: Partial<TPage>, shouldUpdateName: boolean = true) => {\n+    Object.keys(data).forEach((key) => {\n+      const value = data[key as keyof TPage];\n+      if (key === \"name\" && !shouldUpdateName) return;\n+      set(this, key, value);\n+    });\n+  };\n+\n+  setEditorRef = (editorRef: EditorRefApi | null) => {\n+    console.log(\"store editorRef\", editorRef);\n+    runInAction(() => {\n+      this.editorRef = editorRef;\n+    });\n+  };\n }\n"
        },
        {
          "path": "web/core/store/pages/project-page.store.ts",
          "status": "modified",
          "diff": "Index: web/core/store/pages/project-page.store.ts\n===================================================================\n--- web/core/store/pages/project-page.store.ts\t8166a75 (parent)\n+++ web/core/store/pages/project-page.store.ts\teac1115 (commit)\n@@ -205,9 +205,21 @@\n       });\n \n       const pages = await this.service.fetchAll(workspaceSlug, projectId);\n       runInAction(() => {\n-        for (const page of pages) if (page?.id) set(this.data, [page.id], new ProjectPage(this.store, page));\n+        for (const page of pages) {\n+          if (page?.id) {\n+            const existingPage = this.getPageById(page.id);\n+            if (existingPage) {\n+              // If page already exists, update all fields except name\n+              const { name, ...otherFields } = page;\n+              existingPage.mutateProperties(otherFields, false);\n+            } else {\n+              // If new page, create a new instance with all data\n+              set(this.data, [page.id], new ProjectPage(this.store, page));\n+            }\n+          }\n+        }\n         this.loader = undefined;\n       });\n \n       return pages;\n@@ -237,10 +249,18 @@\n         this.error = undefined;\n       });\n \n       const page = await this.service.fetchById(workspaceSlug, projectId, pageId);\n+      const pageInstance = page?.id ? this.getPageById(page.id) : undefined;\n+\n       runInAction(() => {\n-        if (page?.id) set(this.data, [page.id], new ProjectPage(this.store, page));\n+        if (page?.id) {\n+          if (pageInstance) {\n+            pageInstance.mutateProperties(page, false);\n+          } else {\n+            set(this.data, [page.id], new ProjectPage(this.store, page));\n+          }\n+        }\n         this.loader = undefined;\n       });\n \n       return page;\n"
        },
        {
          "path": "web/styles/globals.css",
          "status": "modified",
          "diff": "Index: web/styles/globals.css\n===================================================================\n--- web/styles/globals.css\t8166a75 (parent)\n+++ web/styles/globals.css\teac1115 (commit)\n@@ -853,4 +853,92 @@\n \n .epr-search-container > .epr-icn-search {\n   color: rgb(var(--color-text-400)) !important;\n }\n+\n+/* Lock icon animations */\n+@keyframes textSlideIn {\n+  0% {\n+    opacity: 0;\n+    transform: translateX(-8px);\n+    max-width: 0px;\n+  }\n+  40% {\n+    opacity: 0.7;\n+    max-width: 60px;\n+  }\n+  100% {\n+    opacity: 1;\n+    transform: translateX(0);\n+    max-width: 60px;\n+  }\n+}\n+\n+@keyframes textFadeOut {\n+  0% {\n+    opacity: 1;\n+    transform: translateX(0);\n+  }\n+  100% {\n+    opacity: 0;\n+    transform: translateX(8px);\n+  }\n+}\n+\n+@keyframes lockIconAnimation {\n+  0% {\n+    transform: rotate(-5deg) scale(1);\n+  }\n+  25% {\n+    transform: rotate(0deg) scale(1.15);\n+  }\n+  50% {\n+    transform: rotate(5deg) scale(1.08);\n+  }\n+  100% {\n+    transform: rotate(0deg) scale(1);\n+  }\n+}\n+\n+@keyframes unlockIconAnimation {\n+  0% {\n+    transform: rotate(0deg) scale(1);\n+  }\n+  40% {\n+    transform: rotate(-8deg) scale(1.15);\n+  }\n+  80% {\n+    transform: rotate(3deg) scale(1.05);\n+  }\n+  100% {\n+    transform: rotate(0deg) scale(1);\n+  }\n+}\n+\n+@keyframes fadeOut {\n+  0% {\n+    opacity: 1;\n+  }\n+  100% {\n+    opacity: 0;\n+  }\n+}\n+\n+.animate-text-slide-in {\n+  animation: textSlideIn 400ms ease-out forwards;\n+}\n+\n+.animate-text-fade-out {\n+  animation: textFadeOut 600ms ease-in 300ms forwards;\n+}\n+\n+.animate-lock-icon {\n+  animation: lockIconAnimation 600ms ease-out forwards;\n+}\n+\n+.animate-unlock-icon {\n+  animation: unlockIconAnimation 600ms ease-out forwards;\n+}\n+\n+.animate-fade-out {\n+  animation: fadeOut 500ms ease-in 100ms forwards;\n+}\n"
        }
      ]
    },
    {
      "id": "add-subwork-sorting",
      "sha": "14dc6a56bcdc65fc3c8179f991d61c2c8784484f",
      "parentSha": "55340f9f480b04c41077623ca3cf0efb2fc5572b",
      "spec": "Implement sub-work items sorting and display property toggles across backend and frontend.\n\nBackend (Django, sub-issues endpoint):\n- Endpoint: apiserver/plane/app/views/issue/sub_issue.py\n  - Accept two new query params: order_by (default \"-created_at\") and group_by (optional). order_by must be applied using plane.utils.order_queryset.order_issue_queryset, returning an ordered queryset and the resolved ordering field. group_by, when present, must return the sub_issues field as a mapping of group keys to arrays of issues instead of a flat array.\n  - Special-case grouping for assignees__ids: if an issue has multiple assignees, include the issue under each assignee_id; if assignee_ids is an empty array, use the \"None\" key.\n  - Preserve the existing state_distribution behavior. When group_by is not provided, return the original flat array under sub_issues.\n\n- Utility: apiserver/plane/utils/order_queryset.py\n  - Ensure order_issue_queryset(issue_queryset, order_by_param) supports ordering by created_at, updated_at, start_date, priority, and any annotated priority/state fields, consistent with usage in other issue endpoints.\n\nConstants and Types:\n- Constants: packages/constants/src/issue/common.ts\n  - Add SUB_ISSUES_DISPLAY_PROPERTIES_KEYS: [\"key\", \"assignee\", \"start_date\", \"due_date\", \"priority\", \"state\"].\n\n- Filters: packages/constants/src/issue/filter.ts\n  - Add a new page key sub_work_items with list layout:\n    - display_properties uses SUB_ISSUES_DISPLAY_PROPERTIES_KEYS.\n    - filters: [] (none).\n    - display_filters: include order_by options [\"-created_at\", \"-updated_at\", \"start_date\", \"-priority\"].\n    - extra_options: { access: true, values: [\"sub_issue\"] }.\n\n- Types: packages/types/src/issues/issue_sub_issues.d.ts\n  - Change TIssueSubIssues.sub_issues to a union type TSubIssueResponse = TIssue[] | { [key: string]: TIssue[] } to support grouped responses.\n  - Introduce TSubIssueOperations describing sub-issue operations used by the UI (copyLink, fetchSubIssues, addSubIssue, updateSubIssue, removeSubIssue, deleteSubIssue).\n\nUI/Icons:\n- Create and export a DisplayProperties icon:\n  - packages/ui/src/icons/display-properties.tsx with a 12x12 SVG matching the style of existing icons.\n  - Re-export from packages/ui/src/icons/index.ts as DisplayPropertiesIcon.\n\nWeb service and utilities:\n- Service: web/core/services/issue/issue.service.ts\n  - Modify subIssues(workspaceSlug, projectId, issueId, queries?) to accept query params and send them via params in the GET request.\n\n- Clipboard utility usage:\n  - Replace custom URL-building clipboard methods with copyUrlToClipboard from @plane/utils, and rename operation methods to copyLink(path) where used by relations and sub-issues helpers.\n\nIssue detail widget – sub-issues UI refactor:\n- Replace old sub-issues components (under web/core/components/issues/sub-issues/) with new modular components under web/core/components/issues/issue-detail-widgets/sub-issues/:\n  - issues-list/root.tsx: Render a list of sub-issue IDs for a parent and map to item renderers.\n  - issues-list/list-item.tsx: Render each sub-issue row, including conditionally visible key (identifier), name, menu actions, and a properties section.\n  - issues-list/properties.tsx: Provide StateDropdown, PriorityDropdown, MemberDropdown, DateDropdown (start_date, due_date), gated by WithDisplayPropertiesHOC per property key.\n  - display-filters.tsx: SubIssueDisplayFilters component wrapping FilterDisplayProperties and FilterOrderBy, in a FiltersDropdown with DisplayPropertiesIcon as the trigger.\n  - title-actions.tsx: SubWorkItemTitleActions component that reads/updates per-parent displayProperties and displayFilters in the sub-issue filter store; trigger a refetch on display_filters updates.\n  - title.tsx: Replace action area with SubWorkItemTitleActions; pass workspaceSlug and projectId to enable updates.\n  - content.tsx: Use SubIssuesListRoot (instead of the old IssueList); keep CRUD modal logic and visibility toggling; memoize handlers with useCallback.\n\nMobX store – sub-issues filtering and grouping:\n- Extend sub-issues store: web/core/store/issue/issue-details/sub_issues.store.ts\n  - Add observables: groupedSubIssuesMap (Record<string, TGroupedIssues>), groupedSubIssuesCount (Record<string, number>), loader (TLoader), and filters (instance of WorkItemSubIssueFiltersStore).\n  - Add groupedSubIssuesByIssueId(issueId) getter to expose grouped results for the parent.\n  - Update fetchSubIssues to:\n    - Compute query params from filters.computedFilterParams(parentIssueId) (order_by and optional group_by mapping).\n    - Call IssueService.subIssues with params.\n    - Process response via filters.processSubIssueResponse to obtain issueList and groupedIssues.\n    - Update groupedSubIssuesMap[parentIssueId] with groupedIssues and update issues and sub_issues_count safely.\n\n- Create sub-issue filter store: web/core/store/issue/issue-details/sub_issues_filter.store.ts\n  - Maintain subIssueFiltersMap keyed by parentId with structure Partial<IIssueFilters>.\n  - Initialize defaults: displayProperties enabling key, issue_type, assignee, start_date, due_date, labels, priority, state; displayFilters empty.\n  - Provide getSubIssueFilters(parentId) to return current filters, initializing if needed.\n  - Provide computedFilterParams(parentId) to convert displayFilters to request params (stringify order_by, map group_by using EIssueGroupByToServerOptions).\n  - Provide processSubIssueResponse(response) to output a flat issue list and grouped mapping:\n    - If response is an array, create a single ALL_ISSUES group with all issue IDs and counts.\n    - If response is an object, flatten its values to issueList and create group-to-IDs mapping with counts and total under ALL_ISSUES.\n  - Provide updateSubIssueFilters(workspaceSlug, projectId, filterType, filters, parentId): merge and, for display_filters, refetch sub-issues; for display_properties, update in-place without refetch.\n\nInteraction expectations:\n- In issue detail sub-work items:\n  - Display menu toggles visibility of key, assignee, start date, due date, priority, and state properties.\n  - Changing order_by triggers a refetch and updates the rendered order accordingly.\n  - If grouping is later added to the UI, the backend can return grouped sub_issues and the store must handle both shapes.\n  - Copy link actions use shared copyUrlToClipboard.\n\nReplacement and cleanup:\n- Remove references to legacy components under web/core/components/issues/sub-issues/ (index.ts, issues-list.tsx, progressbar.tsx, properties.tsx, root.tsx) and update imports to the new issue-detail-widgets/sub-issues/ equivalents.",
      "prompt": "Add sorting and display property controls to the sub-work items section of an issue detail view.\n\nRequirements:\n- Accept order_by and optional group_by on the sub-work items API and apply ordering. When group_by is present, return grouped results keyed by the selected grouping while keeping state distribution.\n- Update the UI to include a Display menu for sub-work items where users can toggle visible properties (key, assignee, start date, due date, priority, state) and choose a sort order. Reflect choices in the rendered list and API requests.\n- Update the data model and client logic to handle both flat and grouped responses for sub-work items. Implement a filter store that computes query params from UI state and processes the API response to normalize data for rendering.\n- Refactor sub-work items into modular list, item, and properties components that respect the current display properties. Ensure link copying uses a shared utility.\n- Ensure the sub-issues service method accepts query params and that the store refetches when sorting (and future grouping) changes.\n\nDeliverables:\n- Backend endpoint update for ordering/grouping and appropriate response shapes.\n- Frontend constants and types updates for sub-work item display properties and grouped responses.\n- UI components for sub-work item filter and display controls, integrated into the issue detail widget.\n- Store changes to compute query params, fetch with them, and normalize responses.\n- Removal of old sub-work items components in favor of the new structure.",
      "supplementalFiles": [
        "apiserver/plane/utils/order_queryset.py",
        "apiserver/plane/app/views/issue/base.py",
        "packages/constants/src/issue/index.ts",
        "packages/constants/src/index.ts",
        "packages/utils/src/string.ts",
        "packages/types/src/view-props.d.ts",
        "packages/types/src/issues/base.d.ts",
        "web/core/components/issues/issue-layouts/filters/header/display-filters/display-properties.tsx",
        "web/core/components/issues/issue-layouts/filters/header/display-filters/order-by.tsx",
        "web/core/components/issues/issue-layouts/filters/header/helpers/dropdown.tsx",
        "web/core/components/issues/issue-layouts/properties/with-display-properties-HOC.tsx",
        "web/core/helpers/date-time.helper.ts",
        "web/core/store/issue/issue-details/root.store.ts",
        "web/core/store/issue/root.store.ts"
      ],
      "fileDiffs": [
        {
          "path": "apiserver/plane/app/views/issue/sub_issue.py",
          "status": "modified",
          "diff": "Index: apiserver/plane/app/views/issue/sub_issue.py\n===================================================================\n--- apiserver/plane/app/views/issue/sub_issue.py\t55340f9 (parent)\n+++ apiserver/plane/app/views/issue/sub_issue.py\t14dc6a5 (commit)\n@@ -22,8 +22,9 @@\n from plane.bgtasks.issue_activities_task import issue_activity\n from plane.utils.timezone_converter import user_timezone_converter\n from collections import defaultdict\n from plane.utils.host import base_host\n+from plane.utils.order_queryset import order_issue_queryset\n \n class SubIssuesEndpoint(BaseAPIView):\n     permission_classes = [ProjectEntityPermission]\n \n@@ -101,8 +102,17 @@\n             .annotate(state_group=F(\"state__group\"))\n             .order_by(\"-created_at\")\n         )\n \n+        # Ordering\n+        order_by_param = request.GET.get(\"order_by\", \"-created_at\")\n+        group_by = request.GET.get(\"group_by\", False)\n+\n+        if order_by_param:\n+            sub_issues, order_by_param = order_issue_queryset(\n+                sub_issues, order_by_param\n+            )\n+\n         # create's a dict with state group name with their respective issue id's\n         result = defaultdict(list)\n         for sub_issue in sub_issues:\n             result[sub_issue.state_group].append(str(sub_issue.id))\n@@ -137,8 +147,28 @@\n         datetime_fields = [\"created_at\", \"updated_at\"]\n         sub_issues = user_timezone_converter(\n             sub_issues, datetime_fields, request.user.user_timezone\n         )\n+        # Grouping\n+        if group_by:\n+            result_dict = defaultdict(list)\n+\n+            for issue in sub_issues:\n+                if group_by == \"assignees__ids\":\n+                    if issue[\"assignee_ids\"]:\n+                        assignee_ids = issue[\"assignee_ids\"]\n+                        for assignee_id in assignee_ids:\n+                            result_dict[str(assignee_id)].append(issue)\n+                    elif issue[\"assignee_ids\"] == []:\n+                        result_dict[\"None\"].append(issue)\n+\n+                elif group_by:\n+                    result_dict[str(issue[group_by])].append(issue)\n+\n+            return Response(\n+                {\"sub_issues\": result_dict, \"state_distribution\": result},\n+                status=status.HTTP_200_OK,\n+            )\n         return Response(\n             {\"sub_issues\": sub_issues, \"state_distribution\": result},\n             status=status.HTTP_200_OK,\n         )\n"
        },
        {
          "path": "packages/constants/src/issue/common.ts",
          "status": "modified",
          "diff": "Index: packages/constants/src/issue/common.ts\n===================================================================\n--- packages/constants/src/issue/common.ts\t55340f9 (parent)\n+++ packages/constants/src/issue/common.ts\t14dc6a5 (commit)\n@@ -164,8 +164,17 @@\n   \"cycle\",\n   \"issue_type\",\n ];\n \n+export const SUB_ISSUES_DISPLAY_PROPERTIES_KEYS: (keyof IIssueDisplayProperties)[] = [\n+  \"key\",\n+  \"assignee\",\n+  \"start_date\",\n+  \"due_date\",\n+  \"priority\",\n+  \"state\",\n+];\n+\n export const ISSUE_DISPLAY_PROPERTIES: {\n   key: keyof IIssueDisplayProperties;\n   titleTranslationKey: string;\n }[] = [\n"
        },
        {
          "path": "packages/constants/src/issue/filter.ts",
          "status": "modified",
          "diff": "Index: packages/constants/src/issue/filter.ts\n===================================================================\n--- packages/constants/src/issue/filter.ts\t55340f9 (parent)\n+++ packages/constants/src/issue/filter.ts\t14dc6a5 (commit)\n@@ -5,8 +5,9 @@\n import {\n   TIssueFilterPriorityObject,\n   ISSUE_DISPLAY_PROPERTIES_KEYS,\n   EIssuesStoreType,\n+  SUB_ISSUES_DISPLAY_PROPERTIES_KEYS,\n } from \"./common\";\n \n import { TIssueLayout } from \"./layout\";\n \n@@ -95,50 +96,26 @@\n \n export const ISSUE_DISPLAY_FILTERS_BY_PAGE: TIssueFiltersToDisplayByPageType = {\n   profile_issues: {\n     list: {\n-      filters: [\n-        \"priority\",\n-        \"state_group\",\n-        \"labels\",\n-        \"start_date\",\n-        \"target_date\",\n-      ],\n+      filters: [\"priority\", \"state_group\", \"labels\", \"start_date\", \"target_date\"],\n       display_properties: ISSUE_DISPLAY_PROPERTIES_KEYS,\n       display_filters: {\n         group_by: [\"state_detail.group\", \"priority\", \"project\", \"labels\", null],\n-        order_by: [\n-          \"sort_order\",\n-          \"-created_at\",\n-          \"-updated_at\",\n-          \"start_date\",\n-          \"-priority\",\n-        ],\n+        order_by: [\"sort_order\", \"-created_at\", \"-updated_at\", \"start_date\", \"-priority\"],\n         type: [null, \"active\", \"backlog\"],\n       },\n       extra_options: {\n         access: true,\n         values: [\"show_empty_groups\", \"sub_issue\"],\n       },\n     },\n     kanban: {\n-      filters: [\n-        \"priority\",\n-        \"state_group\",\n-        \"labels\",\n-        \"start_date\",\n-        \"target_date\",\n-      ],\n+      filters: [\"priority\", \"state_group\", \"labels\", \"start_date\", \"target_date\"],\n       display_properties: ISSUE_DISPLAY_PROPERTIES_KEYS,\n       display_filters: {\n         group_by: [\"state_detail.group\", \"priority\", \"project\", \"labels\"],\n-        order_by: [\n-          \"sort_order\",\n-          \"-created_at\",\n-          \"-updated_at\",\n-          \"start_date\",\n-          \"-priority\",\n-        ],\n+        order_by: [\"sort_order\", \"-created_at\", \"-updated_at\", \"start_date\", \"-priority\"],\n         type: [null, \"active\", \"backlog\"],\n       },\n       extra_options: {\n         access: true,\n@@ -172,15 +149,9 @@\n           \"assignees\",\n           \"created_by\",\n           null,\n         ],\n-        order_by: [\n-          \"sort_order\",\n-          \"-created_at\",\n-          \"-updated_at\",\n-          \"start_date\",\n-          \"-priority\",\n-        ],\n+        order_by: [\"sort_order\", \"-created_at\", \"-updated_at\", \"start_date\", \"-priority\"],\n         type: [null, \"active\", \"backlog\"],\n       },\n       extra_options: {\n         access: true,\n@@ -189,71 +160,26 @@\n     },\n   },\n   draft_issues: {\n     list: {\n-      filters: [\n-        \"priority\",\n-        \"state_group\",\n-        \"cycle\",\n-        \"module\",\n-        \"labels\",\n-        \"start_date\",\n-        \"target_date\",\n-        \"issue_type\",\n-      ],\n+      filters: [\"priority\", \"state_group\", \"cycle\", \"module\", \"labels\", \"start_date\", \"target_date\", \"issue_type\"],\n       display_properties: ISSUE_DISPLAY_PROPERTIES_KEYS,\n       display_filters: {\n-        group_by: [\n-          \"state_detail.group\",\n-          \"cycle\",\n-          \"module\",\n-          \"priority\",\n-          \"project\",\n-          \"labels\",\n-          null,\n-        ],\n-        order_by: [\n-          \"sort_order\",\n-          \"-created_at\",\n-          \"-updated_at\",\n-          \"start_date\",\n-          \"-priority\",\n-        ],\n+        group_by: [\"state_detail.group\", \"cycle\", \"module\", \"priority\", \"project\", \"labels\", null],\n+        order_by: [\"sort_order\", \"-created_at\", \"-updated_at\", \"start_date\", \"-priority\"],\n         type: [null, \"active\", \"backlog\"],\n       },\n       extra_options: {\n         access: true,\n         values: [\"show_empty_groups\"],\n       },\n     },\n     kanban: {\n-      filters: [\n-        \"priority\",\n-        \"state_group\",\n-        \"cycle\",\n-        \"module\",\n-        \"labels\",\n-        \"start_date\",\n-        \"target_date\",\n-        \"issue_type\",\n-      ],\n+      filters: [\"priority\", \"state_group\", \"cycle\", \"module\", \"labels\", \"start_date\", \"target_date\", \"issue_type\"],\n       display_properties: ISSUE_DISPLAY_PROPERTIES_KEYS,\n       display_filters: {\n-        group_by: [\n-          \"state_detail.group\",\n-          \"cycle\",\n-          \"module\",\n-          \"priority\",\n-          \"project\",\n-          \"labels\",\n-        ],\n-        order_by: [\n-          \"sort_order\",\n-          \"-created_at\",\n-          \"-updated_at\",\n-          \"start_date\",\n-          \"-priority\",\n-        ],\n+        group_by: [\"state_detail.group\", \"cycle\", \"module\", \"priority\", \"project\", \"labels\"],\n+        order_by: [\"sort_order\", \"-created_at\", \"-updated_at\", \"start_date\", \"-priority\"],\n         type: [null, \"active\", \"backlog\"],\n       },\n       extra_options: {\n         access: true,\n@@ -322,26 +248,10 @@\n         \"issue_type\",\n       ],\n       display_properties: ISSUE_DISPLAY_PROPERTIES_KEYS,\n       display_filters: {\n-        group_by: [\n-          \"state\",\n-          \"priority\",\n-          \"cycle\",\n-          \"module\",\n-          \"labels\",\n-          \"assignees\",\n-          \"created_by\",\n-          null,\n-        ],\n-        order_by: [\n-          \"sort_order\",\n-          \"-created_at\",\n-          \"-updated_at\",\n-          \"start_date\",\n-          \"-priority\",\n-          \"target_date\",\n-        ],\n+        group_by: [\"state\", \"priority\", \"cycle\", \"module\", \"labels\", \"assignees\", \"created_by\", null],\n+        order_by: [\"sort_order\", \"-created_at\", \"-updated_at\", \"start_date\", \"-priority\", \"target_date\"],\n         type: [null, \"active\", \"backlog\"],\n       },\n       extra_options: {\n         access: true,\n@@ -363,35 +273,11 @@\n         \"issue_type\",\n       ],\n       display_properties: ISSUE_DISPLAY_PROPERTIES_KEYS,\n       display_filters: {\n-        group_by: [\n-          \"state\",\n-          \"priority\",\n-          \"cycle\",\n-          \"module\",\n-          \"labels\",\n-          \"assignees\",\n-          \"created_by\",\n-        ],\n-        sub_group_by: [\n-          \"state\",\n-          \"priority\",\n-          \"cycle\",\n-          \"module\",\n-          \"labels\",\n-          \"assignees\",\n-          \"created_by\",\n-          null,\n-        ],\n-        order_by: [\n-          \"sort_order\",\n-          \"-created_at\",\n-          \"-updated_at\",\n-          \"start_date\",\n-          \"-priority\",\n-          \"target_date\",\n-        ],\n+        group_by: [\"state\", \"priority\", \"cycle\", \"module\", \"labels\", \"assignees\", \"created_by\"],\n+        sub_group_by: [\"state\", \"priority\", \"cycle\", \"module\", \"labels\", \"assignees\", \"created_by\", null],\n+        order_by: [\"sort_order\", \"-created_at\", \"-updated_at\", \"start_date\", \"-priority\", \"target_date\"],\n         type: [null, \"active\", \"backlog\"],\n       },\n       extra_options: {\n         access: true,\n@@ -435,15 +321,9 @@\n         \"issue_type\",\n       ],\n       display_properties: ISSUE_DISPLAY_PROPERTIES_KEYS,\n       display_filters: {\n-        order_by: [\n-          \"sort_order\",\n-          \"-created_at\",\n-          \"-updated_at\",\n-          \"start_date\",\n-          \"-priority\",\n-        ],\n+        order_by: [\"sort_order\", \"-created_at\", \"-updated_at\", \"start_date\", \"-priority\"],\n         type: [null, \"active\", \"backlog\"],\n       },\n       extra_options: {\n         access: true,\n@@ -465,23 +345,30 @@\n         \"issue_type\",\n       ],\n       display_properties: [\"key\", \"issue_type\"],\n       display_filters: {\n-        order_by: [\n-          \"sort_order\",\n-          \"-created_at\",\n-          \"-updated_at\",\n-          \"start_date\",\n-          \"-priority\",\n-        ],\n+        order_by: [\"sort_order\", \"-created_at\", \"-updated_at\", \"start_date\", \"-priority\"],\n         type: [null, \"active\", \"backlog\"],\n       },\n       extra_options: {\n         access: true,\n         values: [\"sub_issue\"],\n       },\n     },\n   },\n+  sub_work_items: {\n+    list: {\n+      display_properties: SUB_ISSUES_DISPLAY_PROPERTIES_KEYS,\n+      filters: [],\n+      display_filters: {\n+        order_by: [\"-created_at\", \"-updated_at\", \"start_date\", \"-priority\"],\n+      },\n+      extra_options: {\n+        access: true,\n+        values: [\"sub_issue\"],\n+      },\n+    },\n+  },\n };\n \n export const ISSUE_STORE_TO_FILTERS_MAP: Partial<\n   Record<EIssuesStoreType, TFiltersByLayout>\n"
        },
        {
          "path": "packages/types/src/issues/issue_sub_issues.d.ts",
          "status": "modified",
          "diff": "Index: packages/types/src/issues/issue_sub_issues.d.ts\n===================================================================\n--- packages/types/src/issues/issue_sub_issues.d.ts\t55340f9 (parent)\n+++ packages/types/src/issues/issue_sub_issues.d.ts\t14dc6a5 (commit)\n@@ -9,14 +9,33 @@\n };\n \n export type TIssueSubIssues = {\n   state_distribution: TSubIssuesStateDistribution;\n-  sub_issues: TIssue[];\n+  sub_issues: TSubIssueResponse;\n };\n \n+export type TSubIssueResponse = TIssue[] | { [key: string]: TIssue[] };\n+\n export type TIssueSubIssuesStateDistributionMap = {\n   [issue_id: string]: TSubIssuesStateDistribution;\n };\n \n export type TIssueSubIssuesIdMap = {\n   [issue_id: string]: string[];\n };\n+\n+export type TSubIssueOperations = {\n+  copyLink: (path: string) => void;\n+  fetchSubIssues: (workspaceSlug: string, projectId: string, parentIssueId: string) => Promise<void>;\n+  addSubIssue: (workspaceSlug: string, projectId: string, parentIssueId: string, issueIds: string[]) => Promise<void>;\n+  updateSubIssue: (\n+    workspaceSlug: string,\n+    projectId: string,\n+    parentIssueId: string,\n+    issueId: string,\n+    issueData: Partial<TIssue>,\n+    oldIssue?: Partial<TIssue>,\n+    fromModal?: boolean\n+  ) => Promise<void>;\n+  removeSubIssue: (workspaceSlug: string, projectId: string, parentIssueId: string, issueId: string) => Promise<void>;\n+  deleteSubIssue: (workspaceSlug: string, projectId: string, parentIssueId: string, issueId: string) => Promise<void>;\n+};\n"
        },
        {
          "path": "packages/ui/src/icons/display-properties.tsx",
          "status": "added",
          "diff": "Index: packages/ui/src/icons/display-properties.tsx\n===================================================================\n--- packages/ui/src/icons/display-properties.tsx\t55340f9 (parent)\n+++ packages/ui/src/icons/display-properties.tsx\t14dc6a5 (commit)\n@@ -0,0 +1,14 @@\n+import * as React from \"react\";\n+\n+import { ISvgIcons } from \"./type\";\n+\n+export const DisplayPropertiesIcon: React.FC<ISvgIcons> = ({ className = \"text-current\", ...rest }) => (\n+  <svg viewBox=\"0 0 12 12\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" {...rest} className={className}>\n+    <path\n+      fillRule=\"evenodd\"\n+      clipRule=\"evenodd\"\n+      d=\"M2.93934 0.93934C3.22064 0.658035 3.60218 0.5 4 0.5C4.39782 0.5 4.77936 0.658035 5.06066 0.93934C5.22036 1.09904 5.34033 1.29105 5.41421 1.5H11.5C11.7761 1.5 12 1.72386 12 2C12 2.27614 11.7761 2.5 11.5 2.5H5.41421C5.34033 2.70895 5.22036 2.90096 5.06066 3.06066C4.77936 3.34197 4.39782 3.5 4 3.5C3.60218 3.5 3.22064 3.34197 2.93934 3.06066C2.77964 2.90096 2.65967 2.70895 2.58579 2.5H0.5C0.223858 2.5 0 2.27614 0 2C0 1.72386 0.223858 1.5 0.5 1.5H2.58579C2.65967 1.29105 2.77964 1.09904 2.93934 0.93934ZM4 1.5C3.86739 1.5 3.74021 1.55268 3.64645 1.64645C3.55268 1.74021 3.5 1.86739 3.5 2C3.5 2.13261 3.55268 2.25979 3.64645 2.35355C3.74021 2.44732 3.86739 2.5 4 2.5C4.13261 2.5 4.25979 2.44732 4.35355 2.35355C4.44732 2.25979 4.5 2.13261 4.5 2C4.5 1.86739 4.44732 1.74021 4.35355 1.64645C4.25979 1.55268 4.13261 1.5 4 1.5ZM6.93934 4.93934C7.22064 4.65804 7.60218 4.5 8 4.5C8.39783 4.5 8.77936 4.65804 9.06066 4.93934C9.22036 5.09904 9.34033 5.29105 9.41422 5.5H11.5C11.7761 5.5 12 5.72386 12 6C12 6.27614 11.7761 6.5 11.5 6.5H9.41422C9.34033 6.70895 9.22036 6.90096 9.06066 7.06066C8.77936 7.34196 8.39783 7.5 8 7.5C7.60218 7.5 7.22064 7.34196 6.93934 7.06066C6.77964 6.90096 6.65967 6.70895 6.58579 6.5H0.5C0.223858 6.5 0 6.27614 0 6C0 5.72386 0.223858 5.5 0.5 5.5H6.58579C6.65967 5.29105 6.77964 5.09904 6.93934 4.93934ZM8 5.5C7.86739 5.5 7.74021 5.55268 7.64645 5.64645C7.55268 5.74021 7.5 5.86739 7.5 6C7.5 6.13261 7.55268 6.25979 7.64645 6.35355C7.74021 6.44732 7.86739 6.5 8 6.5C8.13261 6.5 8.25978 6.44732 8.35355 6.35355C8.44732 6.25979 8.5 6.13261 8.5 6C8.5 5.86739 8.44732 5.74022 8.35355 5.64645C8.25978 5.55268 8.13261 5.5 8 5.5ZM2.93934 8.93934C3.22064 8.65804 3.60217 8.5 4 8.5C4.39783 8.5 4.77936 8.65804 5.06066 8.93934C5.22036 9.09904 5.34033 9.29105 5.41421 9.5H11.5C11.7761 9.5 12 9.72386 12 10C12 10.2761 11.7761 10.5 11.5 10.5H5.41421C5.34033 10.709 5.22036 10.901 5.06066 11.0607C4.77936 11.342 4.39783 11.5 4 11.5C3.60217 11.5 3.22064 11.342 2.93934 11.0607C2.77964 10.901 2.65967 10.709 2.58579 10.5H0.5C0.223858 10.5 0 10.2761 0 10C0 9.72386 0.223858 9.5 0.5 9.5H2.58579C2.65967 9.29105 2.77964 9.09904 2.93934 8.93934ZM4 9.5C3.86739 9.5 3.74022 9.55268 3.64645 9.64645C3.55268 9.74022 3.5 9.86739 3.5 10C3.5 10.1326 3.55268 10.2598 3.64645 10.3536C3.74022 10.4473 3.86739 10.5 4 10.5C4.13261 10.5 4.25979 10.4473 4.35355 10.3536C4.44732 10.2598 4.5 10.1326 4.5 10C4.5 9.86739 4.44732 9.74022 4.35355 9.64645C4.25979 9.55268 4.13261 9.5 4 9.5Z\"\n+      fill=\"currentColor\"\n+    />\n+  </svg>\n+);\n"
        },
        {
          "path": "packages/ui/src/icons/index.ts",
          "status": "modified",
          "diff": "Index: packages/ui/src/icons/index.ts\n===================================================================\n--- packages/ui/src/icons/index.ts\t55340f9 (parent)\n+++ packages/ui/src/icons/index.ts\t14dc6a5 (commit)\n@@ -50,4 +50,5 @@\n export * from \"./multiple-sticky\";\n export * from \"./sticky-note-icon\";\n export * from \"./bar-icon\";\n export * from \"./tree-map-icon\";\n+export * from \"./display-properties\";\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/relations/helper.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/relations/helper.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/relations/helper.tsx\t55340f9 (parent)\n+++ web/core/components/issues/issue-detail-widgets/relations/helper.tsx\t14dc6a5 (commit)\n@@ -1,19 +1,18 @@\n \"use client\";\n import { useMemo } from \"react\";\n import { usePathname } from \"next/navigation\";\n+// plane imports\n import { EIssueServiceType, ISSUE_DELETED, ISSUE_UPDATED } from \"@plane/constants\";\n import { useTranslation } from \"@plane/i18n\";\n import { TIssue, TIssueServiceType } from \"@plane/types\";\n import { TOAST_TYPE, setToast } from \"@plane/ui\";\n-// constants\n-// helper\n-import { copyTextToClipboard } from \"@/helpers/string.helper\";\n+import { copyUrlToClipboard } from \"@plane/utils\";\n // hooks\n import { useEventTracker, useIssueDetail } from \"@/hooks/store\";\n \n export type TRelationIssueOperations = {\n-  copyText: (text: string) => void;\n+  copyLink: (path: string) => void;\n   update: (workspaceSlug: string, projectId: string, issueId: string, data: Partial<TIssue>) => Promise<void>;\n   remove: (workspaceSlug: string, projectId: string, issueId: string) => Promise<void>;\n };\n \n@@ -28,19 +27,18 @@\n   const entityName = issueServiceType === EIssueServiceType.ISSUES ? \"Work item\" : \"Epic\";\n \n   const issueOperations: TRelationIssueOperations = useMemo(\n     () => ({\n-      copyText: (text: string) => {\n-        const originURL = typeof window !== \"undefined\" && window.location.origin ? window.location.origin : \"\";\n-        copyTextToClipboard(`${originURL}${text}`).then(() => {\n+      copyLink: (path) => {\n+        copyUrlToClipboard(path).then(() => {\n           setToast({\n             type: TOAST_TYPE.SUCCESS,\n             title: t(\"common.link_copied\"),\n             message: t(\"entity.link_copied_to_clipboard\", { entity: entityName }),\n           });\n         });\n       },\n-      update: async (workspaceSlug: string, projectId: string, issueId: string, data: Partial<TIssue>) => {\n+      update: async (workspaceSlug, projectId, issueId, data) => {\n         try {\n           await updateIssue(workspaceSlug, projectId, issueId, data);\n           captureIssueEvent({\n             eventName: ISSUE_UPDATED,\n@@ -55,9 +53,9 @@\n             title: t(\"toast.success\"),\n             type: TOAST_TYPE.SUCCESS,\n             message: t(\"entity.update.success\", { entity: entityName }),\n           });\n-        } catch (error) {\n+        } catch {\n           captureIssueEvent({\n             eventName: ISSUE_UPDATED,\n             payload: { state: \"FAILED\", element: \"Issue detail page\" },\n             updates: {\n@@ -72,27 +70,27 @@\n             message: t(\"entity.update.failed\", { entity: entityName }),\n           });\n         }\n       },\n-      remove: async (workspaceSlug: string, projectId: string, issueId: string) => {\n+      remove: async (workspaceSlug, projectId, issueId) => {\n         try {\n           return removeIssue(workspaceSlug, projectId, issueId).then(() => {\n             captureIssueEvent({\n               eventName: ISSUE_DELETED,\n               payload: { id: issueId, state: \"SUCCESS\", element: \"Issue detail page\" },\n               path: pathname,\n             });\n           });\n-        } catch (error) {\n+        } catch {\n           captureIssueEvent({\n             eventName: ISSUE_DELETED,\n             payload: { id: issueId, state: \"FAILED\", element: \"Issue detail page\" },\n             path: pathname,\n           });\n         }\n       },\n     }),\n-    [pathname, removeIssue, updateIssue]\n+    [captureIssueEvent, entityName, pathname, removeIssue, t, updateIssue]\n   );\n \n   return issueOperations;\n };\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/content.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/content.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/content.tsx\t55340f9 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/content.tsx\t14dc6a5 (commit)\n@@ -5,13 +5,13 @@\n import { TIssue, TIssueServiceType } from \"@plane/types\";\n // components\n import { DeleteIssueModal } from \"@/components/issues/delete-issue-modal\";\n import { CreateUpdateIssueModal } from \"@/components/issues/issue-modal\";\n-import { IssueList } from \"@/components/issues/sub-issues/issues-list\";\n // hooks\n import { useIssueDetail } from \"@/hooks/store\";\n-// helper\n+// local imports\n import { useSubIssueOperations } from \"./helper\";\n+import { SubIssuesListRoot } from \"./issues-list/root\";\n \n type Props = {\n   workspaceSlug: string;\n   projectId: string;\n@@ -52,32 +52,32 @@\n       issue: undefined,\n     },\n   });\n   // store hooks\n-  const { toggleCreateIssueModal, toggleDeleteIssueModal } = useIssueDetail();\n   const {\n+    toggleCreateIssueModal,\n+    toggleDeleteIssueModal,\n     subIssues: { subIssueHelpersByIssueId, setSubIssueHelpers },\n   } = useIssueDetail(issueServiceType);\n \n   // helpers\n   const subIssueOperations = useSubIssueOperations(issueServiceType);\n   const subIssueHelpers = subIssueHelpersByIssueId(`${parentIssueId}_root`);\n \n   // handler\n-  const handleIssueCrudState = (\n-    key: \"create\" | \"existing\" | \"update\" | \"delete\",\n-    _parentIssueId: string | null,\n-    issue: TIssue | null = null\n-  ) => {\n-    setIssueCrudState({\n-      ...issueCrudState,\n-      [key]: {\n-        toggle: !issueCrudState[key].toggle,\n-        parentIssueId: _parentIssueId,\n-        issue: issue,\n-      },\n-    });\n-  };\n+  const handleIssueCrudState = useCallback(\n+    (key: \"create\" | \"existing\" | \"update\" | \"delete\", _parentIssueId: string | null, issue: TIssue | null = null) => {\n+      setIssueCrudState({\n+        ...issueCrudState,\n+        [key]: {\n+          toggle: !issueCrudState[key].toggle,\n+          parentIssueId: _parentIssueId,\n+          issue,\n+        },\n+      });\n+    },\n+    [issueCrudState]\n+  );\n \n   const handleFetchSubIssues = useCallback(async () => {\n     if (!subIssueHelpers.issue_visibility.includes(parentIssueId)) {\n       try {\n@@ -115,9 +115,9 @@\n \n   return (\n     <>\n       {subIssueHelpers.issue_visibility.includes(parentIssueId) && (\n-        <IssueList\n+        <SubIssuesListRoot\n           workspaceSlug={workspaceSlug}\n           projectId={projectId}\n           parentIssueId={parentIssueId}\n           rootIssueId={parentIssueId}\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/display-filters.tsx",
          "status": "added",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/display-filters.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/display-filters.tsx\t55340f9 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/display-filters.tsx\t14dc6a5 (commit)\n@@ -0,0 +1,70 @@\n+import { FC } from \"react\";\n+import isEmpty from \"lodash/isEmpty\";\n+import { observer } from \"mobx-react\";\n+import { IIssueDisplayFilterOptions, ILayoutDisplayFiltersOptions, IIssueDisplayProperties } from \"@plane/types\";\n+import { DisplayPropertiesIcon } from \"@plane/ui\";\n+import { FilterDisplayProperties, FilterOrderBy, FiltersDropdown } from \"@/components/issues\";\n+\n+type TSubIssueDisplayFiltersProps = {\n+  displayProperties: IIssueDisplayProperties;\n+  displayFilters: IIssueDisplayFilterOptions;\n+  handleDisplayFiltersUpdate: (updatedDisplayFilter: Partial<IIssueDisplayFilterOptions>) => void;\n+  handleDisplayPropertiesUpdate: (updatedDisplayProperties: Partial<IIssueDisplayProperties>) => void;\n+  layoutDisplayFiltersOptions: ILayoutDisplayFiltersOptions | undefined;\n+  isEpic?: boolean;\n+};\n+\n+export const SubIssueDisplayFilters: FC<TSubIssueDisplayFiltersProps> = observer((props) => {\n+  const {\n+    isEpic = false,\n+    displayProperties,\n+    layoutDisplayFiltersOptions,\n+    handleDisplayPropertiesUpdate,\n+    handleDisplayFiltersUpdate,\n+    displayFilters,\n+  } = props;\n+\n+  return (\n+    <>\n+      {layoutDisplayFiltersOptions?.display_filters && layoutDisplayFiltersOptions?.display_properties.length > 0 && (\n+        <FiltersDropdown\n+          placement=\"bottom-end\"\n+          menuButton={<DisplayPropertiesIcon className=\"h-3.5 w-3.5 text-custom-text-100\" />}\n+        >\n+          <div\n+            onClick={(e) => {\n+              e.stopPropagation();\n+              e.preventDefault();\n+            }}\n+            className=\"vertical-scrollbar scrollbar-sm relative h-full w-full divide-y divide-custom-border-200 overflow-hidden overflow-y-auto px-2.5 max-h-[25rem] text-left\"\n+          >\n+            {/* display properties */}\n+            <div className=\"py-2\">\n+              <FilterDisplayProperties\n+                displayProperties={displayProperties}\n+                displayPropertiesToRender={layoutDisplayFiltersOptions.display_properties}\n+                handleUpdate={handleDisplayPropertiesUpdate}\n+                isEpic={isEpic}\n+              />\n+            </div>\n+\n+            {/* order by */}\n+            {!isEmpty(layoutDisplayFiltersOptions?.display_filters?.order_by) && (\n+              <div className=\"py-2\">\n+                <FilterOrderBy\n+                  selectedOrderBy={displayFilters?.order_by}\n+                  handleUpdate={(val) =>\n+                    handleDisplayFiltersUpdate({\n+                      order_by: val,\n+                    })\n+                  }\n+                  orderByOptions={layoutDisplayFiltersOptions?.display_filters.order_by ?? []}\n+                />\n+              </div>\n+            )}\n+          </div>\n+        </FiltersDropdown>\n+      )}\n+    </>\n+  );\n+});\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/helper.ts",
          "status": "renamed",
          "oldPath": "web/core/components/issues/issue-detail-widgets/sub-issues/helper.tsx",
          "diff": "===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/helper.tsx\t55340f9 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/helper.ts\t14dc6a5 (commit)\n@@ -1,30 +1,24 @@\n \"use client\";\n+\n import { useMemo } from \"react\";\n import { useParams, usePathname } from \"next/navigation\";\n+// plane imports\n import { EIssueServiceType } from \"@plane/constants\";\n import { useTranslation } from \"@plane/i18n\";\n-import { TIssue, TIssueServiceType } from \"@plane/types\";\n+import { TIssueServiceType, TSubIssueOperations } from \"@plane/types\";\n import { TOAST_TYPE, setToast } from \"@plane/ui\";\n-// helper\n-import { copyTextToClipboard } from \"@/helpers/string.helper\";\n+import { copyUrlToClipboard } from \"@plane/utils\";\n // hooks\n import { useEventTracker, useIssueDetail, useProjectState } from \"@/hooks/store\";\n-// plane-web\n+// plane web helpers\n import { updateEpicAnalytics } from \"@/plane-web/helpers/epic-analytics\";\n-// type\n-import { TSubIssueOperations } from \"../../sub-issues\";\n \n-export type TRelationIssueOperations = {\n-  copyText: (text: string) => void;\n-  update: (workspaceSlug: string, projectId: string, issueId: string, data: Partial<TIssue>) => Promise<void>;\n-  remove: (workspaceSlug: string, projectId: string, issueId: string) => Promise<void>;\n-};\n-\n export const useSubIssueOperations = (issueServiceType: TIssueServiceType): TSubIssueOperations => {\n   // router\n   const { epicId: epicIdParam } = useParams();\n   const pathname = usePathname();\n+  // translation\n   const { t } = useTranslation();\n   // store hooks\n   const {\n     issue: { getIssueById },\n@@ -45,11 +39,10 @@\n   const epicId = epicIdParam || epicPeekIssue?.issueId;\n \n   const subIssueOperations: TSubIssueOperations = useMemo(\n     () => ({\n-      copyText: (text: string) => {\n-        const originURL = typeof window !== \"undefined\" && window.location.origin ? window.location.origin : \"\";\n-        copyTextToClipboard(`${originURL}/${text}`).then(() => {\n+      copyLink: (path) => {\n+        copyUrlToClipboard(`/${path}`).then(() => {\n           setToast({\n             type: TOAST_TYPE.SUCCESS,\n             title: t(\"common.link_copied\"),\n             message: t(\"entity.link_copied_to_clipboard\", {\n@@ -60,9 +53,9 @@\n             }),\n           });\n         });\n       },\n-      fetchSubIssues: async (workspaceSlug: string, projectId: string, parentIssueId: string) => {\n+      fetchSubIssues: async (workspaceSlug, projectId, parentIssueId) => {\n         try {\n           await fetchSubIssues(workspaceSlug, projectId, parentIssueId);\n         } catch {\n           setToast({\n@@ -76,9 +69,9 @@\n             }),\n           });\n         }\n       },\n-      addSubIssue: async (workspaceSlug: string, projectId: string, parentIssueId: string, issueIds: string[]) => {\n+      addSubIssue: async (workspaceSlug, projectId, parentIssueId, issueIds) => {\n         try {\n           await createSubIssues(workspaceSlug, projectId, parentIssueId, issueIds);\n           setToast({\n             type: TOAST_TYPE.SUCCESS,\n@@ -93,9 +86,8 @@\n         } catch {\n           setToast({\n             type: TOAST_TYPE.ERROR,\n             title: t(\"toast.error\"),\n-            // message: `Error adding ${issueServiceType === EIssueServiceType.ISSUES ? \"sub-issues\" : \"issues\"}`,\n             message: t(\"entity.add.failed\", {\n               entity:\n                 issueServiceType === EIssueServiceType.ISSUES\n                   ? t(\"common.sub_work_items\")\n@@ -104,15 +96,15 @@\n           });\n         }\n       },\n       updateSubIssue: async (\n-        workspaceSlug: string,\n-        projectId: string,\n-        parentIssueId: string,\n-        issueId: string,\n-        issueData: Partial<TIssue>,\n-        oldIssue: Partial<TIssue> = {},\n-        fromModal: boolean = false\n+        workspaceSlug,\n+        projectId,\n+        parentIssueId,\n+        issueId,\n+        issueData,\n+        oldIssue = {},\n+        fromModal = false\n       ) => {\n         try {\n           setSubIssueHelpers(parentIssueId, \"issue_loader\", issueId);\n           await updateSubIssue(workspaceSlug, projectId, parentIssueId, issueId, issueData, oldIssue, fromModal);\n@@ -171,9 +163,9 @@\n             message: t(\"sub_work_item.update.error\"),\n           });\n         }\n       },\n-      removeSubIssue: async (workspaceSlug: string, projectId: string, parentIssueId: string, issueId: string) => {\n+      removeSubIssue: async (workspaceSlug, projectId, parentIssueId, issueId) => {\n         try {\n           setSubIssueHelpers(parentIssueId, \"issue_loader\", issueId);\n           await removeSubIssue(workspaceSlug, projectId, parentIssueId, issueId);\n           if (issueServiceType === EIssueServiceType.EPICS) {\n@@ -217,9 +209,9 @@\n             message: t(\"sub_work_item.remove.error\"),\n           });\n         }\n       },\n-      deleteSubIssue: async (workspaceSlug: string, projectId: string, parentIssueId: string, issueId: string) => {\n+      deleteSubIssue: async (workspaceSlug, projectId, parentIssueId, issueId) => {\n         try {\n           setSubIssueHelpers(parentIssueId, \"issue_loader\", issueId);\n           return deleteSubIssue(workspaceSlug, projectId, parentIssueId, issueId).then(() => {\n             captureIssueEvent({\n@@ -243,22 +235,22 @@\n         }\n       },\n     }),\n     [\n-      fetchSubIssues,\n+      captureIssueEvent,\n       createSubIssues,\n-      epicId,\n-      updateSubIssue,\n-      removeSubIssue,\n       deleteSubIssue,\n-      setSubIssueHelpers,\n+      epicId,\n+      fetchSubIssues,\n       getIssueById,\n       getStateById,\n-      updateAnalytics,\n-      captureIssueEvent,\n+      issueServiceType,\n       pathname,\n+      removeSubIssue,\n+      setSubIssueHelpers,\n       t,\n-      issueServiceType,\n+      updateAnalytics,\n+      updateSubIssue,\n     ]\n   );\n \n   return subIssueOperations;\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/index.ts",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/index.ts\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/index.ts\t55340f9 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/index.ts\t14dc6a5 (commit)\n@@ -1,4 +1,5 @@\n export * from \"./content\";\n export * from \"./title\";\n export * from \"./root\";\n export * from \"./quick-action-button\";\n+export * from \"./display-filters\";\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/list-item.tsx",
          "status": "renamed",
          "oldPath": "web/core/components/issues/sub-issues/issue-list-item.tsx",
          "diff": "===================================================================\n--- web/core/components/issues/sub-issues/issue-list-item.tsx\t55340f9 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/list-item.tsx\t14dc6a5 (commit)\n@@ -1,15 +1,16 @@\n \"use client\";\n \n-import React from \"react\";\n import { observer } from \"mobx-react\";\n import { ChevronRight, X, Pencil, Trash, Link as LinkIcon, Loader } from \"lucide-react\";\n+// plane imports\n import { EIssueServiceType } from \"@plane/constants\";\n import { useTranslation } from \"@plane/i18n\";\n-import { TIssue, TIssueServiceType } from \"@plane/types\";\n-// ui\n+import { TIssue, TIssueServiceType, TSubIssueOperations } from \"@plane/types\";\n import { ControlLink, CustomMenu, Tooltip } from \"@plane/ui\";\n // helpers\n+import { useSubIssueOperations } from \"@/components/issues/issue-detail-widgets/sub-issues/helper\";\n+import { WithDisplayPropertiesHOC } from \"@/components/issues/issue-layouts/properties/with-display-properties-HOC\";\n import { cn } from \"@/helpers/common.helper\";\n import { generateWorkItemLink } from \"@/helpers/issue.helper\";\n // hooks\n import { useIssueDetail, useProject, useProjectState } from \"@/hooks/store\";\n@@ -17,17 +18,12 @@\n import { usePlatformOS } from \"@/hooks/use-platform-os\";\n // plane web components\n import { IssueIdentifier } from \"@/plane-web/components/issues\";\n // local components\n-import { useSubIssueOperations } from \"../issue-detail-widgets/sub-issues/helper\";\n-import { IssueList } from \"./issues-list\";\n-import { IssueProperty } from \"./properties\";\n-// ui\n-// types\n-import { TSubIssueOperations } from \"./root\";\n-// import { ISubIssuesRootLoaders, ISubIssuesRootLoadersHandler } from \"./root\";\n+import { SubIssuesListItemProperties } from \"./properties\";\n+import { SubIssuesListRoot } from \"./root\";\n \n-export interface ISubIssues {\n+type Props = {\n   workspaceSlug: string;\n   projectId: string;\n   parentIssueId: string;\n   rootIssueId: string;\n@@ -40,11 +36,11 @@\n   ) => void;\n   subIssueOperations: TSubIssueOperations;\n   issueId: string;\n   issueServiceType?: TIssueServiceType;\n-}\n+};\n \n-export const IssueListItem: React.FC<ISubIssues> = observer((props) => {\n+export const SubIssuesListItem: React.FC<Props> = observer((props) => {\n   const {\n     workspaceSlug,\n     projectId,\n     parentIssueId,\n@@ -58,8 +54,11 @@\n   } = props;\n   const { t } = useTranslation();\n   const {\n     issue: { getIssueById },\n+    subIssues: {\n+      filters: { getSubIssueFilters },\n+    },\n   } = useIssueDetail(issueServiceType);\n   const {\n     subIssues: { subIssueHelpersByIssueId, setSubIssueHelpers },\n   } = useIssueDetail();\n@@ -79,8 +78,12 @@\n \n   const subIssueHelpers = subIssueHelpersByIssueId(parentIssueId);\n   const subIssueCount = issue?.sub_issues_count ?? 0;\n \n+  // derived values\n+  const subIssueFilters = getSubIssueFilters(parentIssueId);\n+  const displayProperties = subIssueFilters.displayProperties ?? {};\n+\n   //\n   const handleIssuePeekOverview = (issue: TIssue) => handleRedirection(workspaceSlug, issue, isMobile);\n \n   if (!issue) return <></>;\n@@ -149,19 +152,21 @@\n                 style={{\n                   backgroundColor: currentIssueStateDetail?.color ?? \"#737373\",\n                 }}\n               />\n-              <div className=\"flex-shrink-0\">\n-                {projectDetail && (\n-                  <IssueIdentifier\n-                    projectId={projectDetail.id}\n-                    issueTypeId={issue.type_id}\n-                    projectIdentifier={projectDetail.identifier}\n-                    issueSequenceId={issue.sequence_id}\n-                    textContainerClassName=\"text-xs text-custom-text-200\"\n-                  />\n-                )}\n-              </div>\n+              <WithDisplayPropertiesHOC displayProperties={displayProperties || {}} displayPropertyKey=\"key\">\n+                <div className=\"flex-shrink-0\">\n+                  {projectDetail && (\n+                    <IssueIdentifier\n+                      projectId={projectDetail.id}\n+                      issueTypeId={issue.type_id}\n+                      projectIdentifier={projectDetail.identifier}\n+                      issueSequenceId={issue.sequence_id}\n+                      textContainerClassName=\"text-xs text-custom-text-200\"\n+                    />\n+                  )}\n+                </div>\n+              </WithDisplayPropertiesHOC>\n               <Tooltip tooltipContent={issue.name} isMobile={isMobile}>\n                 <span className=\"w-full truncate text-sm text-custom-text-100\">{issue.name}</span>\n               </Tooltip>\n             </div>\n@@ -172,15 +177,16 @@\n                 e.preventDefault();\n                 e.stopPropagation();\n               }}\n             >\n-              <IssueProperty\n+              <SubIssuesListItemProperties\n                 workspaceSlug={workspaceSlug}\n                 parentIssueId={parentIssueId}\n                 issueId={issueId}\n                 disabled={disabled}\n-                subIssueOperations={subIssueOperations}\n-                issueServiceType={issueServiceType}\n+                updateSubIssue={subIssueOperations.updateSubIssue}\n+                displayProperties={displayProperties}\n+                issue={issue}\n               />\n             </div>\n \n             <div className=\"flex-shrink-0 text-sm\">\n@@ -204,9 +210,9 @@\n                 <CustomMenu.MenuItem\n                   onClick={(e) => {\n                     e.stopPropagation();\n                     e.preventDefault();\n-                    subIssueOperations.copyText(workItemLink);\n+                    subIssueOperations.copyLink(workItemLink);\n                   }}\n                 >\n                   <div className=\"flex items-center gap-2\">\n                     <LinkIcon className=\"h-3.5 w-3.5\" strokeWidth={2} />\n@@ -257,9 +263,9 @@\n       {subIssueHelpers.issue_visibility.includes(issueId) &&\n         issue.project_id &&\n         subIssueCount > 0 &&\n         !isCurrentIssueRoot && (\n-          <IssueList\n+          <SubIssuesListRoot\n             workspaceSlug={workspaceSlug}\n             projectId={issue.project_id}\n             parentIssueId={issue.id}\n             rootIssueId={rootIssueId}\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/properties.tsx",
          "status": "added",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/properties.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/properties.tsx\t55340f9 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/properties.tsx\t14dc6a5 (commit)\n@@ -0,0 +1,161 @@\n+// plane imports\n+import { SyntheticEvent } from \"react\";\n+import { observer } from \"mobx-react\";\n+import { CalendarClock } from \"lucide-react\";\n+import { useTranslation } from \"@plane/i18n\";\n+import { IIssueDisplayProperties, TIssue } from \"@plane/types\";\n+// components\n+import { PriorityDropdown, MemberDropdown, StateDropdown, DateDropdown } from \"@/components/dropdowns\";\n+// hooks\n+import { WithDisplayPropertiesHOC } from \"@/components/issues/issue-layouts/properties/with-display-properties-HOC\";\n+import { getDate, renderFormattedPayloadDate } from \"@/helpers/date-time.helper\";\n+\n+type Props = {\n+  workspaceSlug: string;\n+  parentIssueId: string;\n+  issueId: string;\n+  disabled: boolean;\n+  updateSubIssue: (\n+    workspaceSlug: string,\n+    projectId: string,\n+    parentIssueId: string,\n+    issueId: string,\n+    issueData: Partial<TIssue>,\n+    oldIssue?: Partial<TIssue>\n+  ) => Promise<void>;\n+  displayProperties?: IIssueDisplayProperties;\n+  issue: TIssue;\n+};\n+\n+export const SubIssuesListItemProperties: React.FC<Props> = observer((props) => {\n+  const { workspaceSlug, parentIssueId, issueId, disabled, updateSubIssue, displayProperties, issue } = props;\n+  // hooks\n+  const { t } = useTranslation();\n+\n+  const handleEventPropagation = (e: SyntheticEvent<HTMLDivElement>) => {\n+    e.stopPropagation();\n+    e.preventDefault();\n+  };\n+\n+  if (!displayProperties) return <></>;\n+\n+  const maxDate = getDate(issue.target_date);\n+  maxDate?.setDate(maxDate.getDate());\n+  return (\n+    <div className=\"relative flex items-center gap-2\">\n+      <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"start_date\">\n+        <div className=\"h-5 flex-shrink-0\" onFocus={handleEventPropagation} onClick={handleEventPropagation}>\n+          <DateDropdown\n+            value={issue.start_date ?? null}\n+            onChange={(val) =>\n+              issue.project_id &&\n+              updateSubIssue(\n+                workspaceSlug,\n+                issue.project_id,\n+                parentIssueId,\n+                issueId,\n+                {\n+                  start_date: val ? renderFormattedPayloadDate(val) : null,\n+                },\n+                { ...issue }\n+              )\n+            }\n+            maxDate={maxDate}\n+            placeholder={t(\"common.order_by.start_date\")}\n+            icon={<CalendarClock className=\"h-3 w-3 flex-shrink-0\" />}\n+            buttonVariant={issue.start_date ? \"border-with-text\" : \"border-without-text\"}\n+            optionsClassName=\"z-30\"\n+            disabled={!disabled}\n+          />\n+        </div>\n+      </WithDisplayPropertiesHOC>\n+\n+      <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"due_date\">\n+        <div className=\"h-5 flex-shrink-0\" onFocus={handleEventPropagation} onClick={handleEventPropagation}>\n+          <DateDropdown\n+            value={issue.target_date ?? null}\n+            onChange={(val) =>\n+              issue.project_id &&\n+              updateSubIssue(\n+                workspaceSlug,\n+                issue.project_id,\n+                parentIssueId,\n+                issueId,\n+                {\n+                  target_date: val ? renderFormattedPayloadDate(val) : null,\n+                },\n+                { ...issue }\n+              )\n+            }\n+            maxDate={maxDate}\n+            placeholder={t(\"common.order_by.due_date\")}\n+            icon={<CalendarClock className=\"h-3 w-3 flex-shrink-0\" />}\n+            buttonVariant={issue.target_date ? \"border-with-text\" : \"border-without-text\"}\n+            optionsClassName=\"z-30\"\n+            disabled={!disabled}\n+          />\n+        </div>\n+      </WithDisplayPropertiesHOC>\n+\n+      <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"state\">\n+        <div className=\"h-5 flex-shrink-0\">\n+          <StateDropdown\n+            value={issue.state_id}\n+            projectId={issue.project_id ?? undefined}\n+            onChange={(val) =>\n+              issue.project_id &&\n+              updateSubIssue(\n+                workspaceSlug,\n+                issue.project_id,\n+                parentIssueId,\n+                issueId,\n+                {\n+                  state_id: val,\n+                },\n+                { ...issue }\n+              )\n+            }\n+            disabled={!disabled}\n+            buttonVariant=\"border-with-text\"\n+          />\n+        </div>\n+      </WithDisplayPropertiesHOC>\n+\n+      <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"priority\">\n+        <div className=\"h-5 flex-shrink-0\">\n+          <PriorityDropdown\n+            value={issue.priority}\n+            onChange={(val) =>\n+              issue.project_id &&\n+              updateSubIssue(workspaceSlug, issue.project_id, parentIssueId, issueId, {\n+                priority: val,\n+              })\n+            }\n+            disabled={!disabled}\n+            buttonVariant=\"border-without-text\"\n+            buttonClassName=\"border\"\n+          />\n+        </div>\n+      </WithDisplayPropertiesHOC>\n+\n+      <WithDisplayPropertiesHOC displayProperties={displayProperties} displayPropertyKey=\"assignee\">\n+        <div className=\"h-5 flex-shrink-0\">\n+          <MemberDropdown\n+            value={issue.assignee_ids}\n+            projectId={issue.project_id ?? undefined}\n+            onChange={(val) =>\n+              issue.project_id &&\n+              updateSubIssue(workspaceSlug, issue.project_id, parentIssueId, issueId, {\n+                assignee_ids: val,\n+              })\n+            }\n+            disabled={!disabled}\n+            multiple\n+            buttonVariant={(issue?.assignee_ids || []).length > 0 ? \"transparent-without-text\" : \"border-without-text\"}\n+            buttonClassName={(issue?.assignee_ids || []).length > 0 ? \"hover:bg-transparent px-0\" : \"\"}\n+          />\n+        </div>\n+      </WithDisplayPropertiesHOC>\n+    </div>\n+  );\n+});\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/root.tsx",
          "status": "added",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/root.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/root.tsx\t55340f9 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/issues-list/root.tsx\t14dc6a5 (commit)\n@@ -0,0 +1,64 @@\n+import { observer } from \"mobx-react\";\n+// plane imports\n+import { EIssueServiceType } from \"@plane/constants\";\n+import { TIssue, TIssueServiceType, TSubIssueOperations } from \"@plane/types\";\n+// hooks\n+import { useIssueDetail } from \"@/hooks/store\";\n+// local imports\n+import { SubIssuesListItem } from \"./list-item\";\n+\n+type Props = {\n+  workspaceSlug: string;\n+  projectId: string;\n+  parentIssueId: string;\n+  rootIssueId: string;\n+  spacingLeft: number;\n+  disabled: boolean;\n+  handleIssueCrudState: (\n+    key: \"create\" | \"existing\" | \"update\" | \"delete\",\n+    issueId: string,\n+    issue?: TIssue | null\n+  ) => void;\n+  subIssueOperations: TSubIssueOperations;\n+  issueServiceType?: TIssueServiceType;\n+};\n+\n+export const SubIssuesListRoot: React.FC<Props> = observer((props) => {\n+  const {\n+    workspaceSlug,\n+    projectId,\n+    parentIssueId,\n+    rootIssueId,\n+    spacingLeft = 10,\n+    disabled,\n+    handleIssueCrudState,\n+    subIssueOperations,\n+    issueServiceType = EIssueServiceType.ISSUES,\n+  } = props;\n+  // store hooks\n+  const {\n+    subIssues: { subIssuesByIssueId },\n+  } = useIssueDetail(issueServiceType);\n+  // derived values\n+  const subIssueIds = subIssuesByIssueId(parentIssueId);\n+\n+  return (\n+    <div className=\"relative\">\n+      {subIssueIds?.map((issueId) => (\n+        <SubIssuesListItem\n+          key={issueId}\n+          workspaceSlug={workspaceSlug}\n+          projectId={projectId}\n+          parentIssueId={parentIssueId}\n+          rootIssueId={rootIssueId}\n+          issueId={issueId}\n+          spacingLeft={spacingLeft}\n+          disabled={disabled}\n+          handleIssueCrudState={handleIssueCrudState}\n+          subIssueOperations={subIssueOperations}\n+          issueServiceType={issueServiceType}\n+        />\n+      ))}\n+    </div>\n+  );\n+});\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/root.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/root.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/root.tsx\t55340f9 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/root.tsx\t14dc6a5 (commit)\n@@ -20,9 +20,9 @@\n export const SubIssuesCollapsible: FC<Props> = observer((props) => {\n   const { workspaceSlug, projectId, issueId, disabled = false, issueServiceType } = props;\n   // store hooks\n   const { openWidgets, toggleOpenWidget } = useIssueDetail(issueServiceType);\n-  // derived state\n+  // derived values\n   const isCollapsibleOpen = openWidgets.includes(\"sub-issues\");\n \n   return (\n     <Collapsible\n@@ -32,9 +32,10 @@\n         <SubIssuesCollapsibleTitle\n           isOpen={isCollapsibleOpen}\n           parentIssueId={issueId}\n           disabled={disabled}\n-          issueServiceType={issueServiceType}\n+          projectId={projectId}\n+          workspaceSlug={workspaceSlug}\n         />\n       }\n       buttonClassName=\"w-full\"\n     >\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/title-actions.tsx",
          "status": "added",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/title-actions.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/title-actions.tsx\t55340f9 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/title-actions.tsx\t14dc6a5 (commit)\n@@ -0,0 +1,69 @@\n+import { FC, useCallback } from \"react\";\n+import { observer } from \"mobx-react\";\n+import { EIssueFilterType, EIssueServiceType, ISSUE_DISPLAY_FILTERS_BY_PAGE } from \"@plane/constants\";\n+import { IIssueDisplayFilterOptions, IIssueDisplayProperties, TIssueServiceType } from \"@plane/types\";\n+import { useIssueDetail } from \"@/hooks/store\";\n+import { SubIssueDisplayFilters } from \"./display-filters\";\n+import { SubIssuesActionButton } from \"./quick-action-button\";\n+\n+type TSubWorkItemTitleActionsProps = {\n+  disabled: boolean;\n+  issueServiceType?: TIssueServiceType;\n+  parentId: string;\n+  workspaceSlug: string;\n+  projectId: string;\n+};\n+\n+export const SubWorkItemTitleActions: FC<TSubWorkItemTitleActionsProps> = observer((props) => {\n+  const { disabled, issueServiceType = EIssueServiceType.ISSUES, parentId, workspaceSlug, projectId } = props;\n+\n+  // store hooks\n+  const {\n+    subIssues: {\n+      filters: { getSubIssueFilters, updateSubIssueFilters },\n+    },\n+  } = useIssueDetail(issueServiceType);\n+\n+  // derived values\n+  const subIssueFilters = getSubIssueFilters(parentId);\n+\n+  const layoutDisplayFiltersOptions = ISSUE_DISPLAY_FILTERS_BY_PAGE[\"sub_work_items\"].list;\n+\n+  const handleDisplayFilters = useCallback(\n+    (updatedDisplayFilter: Partial<IIssueDisplayFilterOptions>) => {\n+      if (!workspaceSlug || !projectId) return;\n+      updateSubIssueFilters(workspaceSlug, projectId, EIssueFilterType.DISPLAY_FILTERS, updatedDisplayFilter, parentId);\n+    },\n+    [workspaceSlug, projectId, parentId, updateSubIssueFilters]\n+  );\n+\n+  const handleDisplayPropertiesUpdate = useCallback(\n+    (updatedDisplayProperties: Partial<IIssueDisplayProperties>) => {\n+      if (!workspaceSlug || !projectId) return;\n+      updateSubIssueFilters(\n+        workspaceSlug,\n+        projectId,\n+        EIssueFilterType.DISPLAY_PROPERTIES,\n+        updatedDisplayProperties,\n+        parentId\n+      );\n+    },\n+    [workspaceSlug, projectId, parentId, updateSubIssueFilters]\n+  );\n+\n+  return (\n+    <div className=\"flex items-center gap-2\">\n+      <SubIssueDisplayFilters\n+        isEpic={issueServiceType === EIssueServiceType.EPICS}\n+        layoutDisplayFiltersOptions={layoutDisplayFiltersOptions}\n+        displayProperties={subIssueFilters?.displayProperties ?? {}}\n+        displayFilters={subIssueFilters?.displayFilters ?? {}}\n+        handleDisplayPropertiesUpdate={handleDisplayPropertiesUpdate}\n+        handleDisplayFiltersUpdate={handleDisplayFilters}\n+      />\n+      {!disabled && (\n+        <SubIssuesActionButton issueId={parentId} disabled={disabled} issueServiceType={issueServiceType} />\n+      )}\n+    </div>\n+  );\n+});\n"
        },
        {
          "path": "web/core/components/issues/issue-detail-widgets/sub-issues/title.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/issue-detail-widgets/sub-issues/title.tsx\n===================================================================\n--- web/core/components/issues/issue-detail-widgets/sub-issues/title.tsx\t55340f9 (parent)\n+++ web/core/components/issues/issue-detail-widgets/sub-issues/title.tsx\t14dc6a5 (commit)\n@@ -1,35 +1,47 @@\n \"use client\";\n-import React, { FC } from \"react\";\n+\n+import { FC } from \"react\";\n import { observer } from \"mobx-react\";\n+// plane imports\n import { EIssueServiceType } from \"@plane/constants\";\n import { useTranslation } from \"@plane/i18n\";\n import { TIssueServiceType } from \"@plane/types\";\n import { CircularProgressIndicator, CollapsibleButton } from \"@plane/ui\";\n-// components\n-import { SubIssuesActionButton } from \"@/components/issues/issue-detail-widgets\";\n // hooks\n import { useIssueDetail } from \"@/hooks/store\";\n+import { SubWorkItemTitleActions } from \"./title-actions\";\n \n type Props = {\n   isOpen: boolean;\n   parentIssueId: string;\n   disabled: boolean;\n   issueServiceType?: TIssueServiceType;\n+  projectId: string;\n+  workspaceSlug: string;\n };\n \n export const SubIssuesCollapsibleTitle: FC<Props> = observer((props) => {\n-  const { isOpen, parentIssueId, disabled, issueServiceType = EIssueServiceType.ISSUES } = props;\n+  const {\n+    isOpen,\n+    parentIssueId,\n+    disabled,\n+    issueServiceType = EIssueServiceType.ISSUES,\n+    projectId,\n+    workspaceSlug,\n+  } = props;\n+  // translation\n   const { t } = useTranslation();\n   // store hooks\n   const {\n-    subIssues: { subIssuesByIssueId, stateDistributionByIssueId },\n+    subIssues: {\n+      subIssuesByIssueId,\n+      stateDistributionByIssueId,\n+    },\n   } = useIssueDetail(issueServiceType);\n-\n-  // derived data\n+  // derived values\n   const subIssuesDistribution = stateDistributionByIssueId(parentIssueId);\n   const subIssues = subIssuesByIssueId(parentIssueId);\n-\n   // if there are no sub-issues, return null\n   if (!subIssues) return null;\n \n   // calculate percentage of completed sub-issues\n@@ -49,11 +61,15 @@\n           </span>\n         </div>\n       }\n       actionItemElement={\n-        !disabled && (\n-          <SubIssuesActionButton issueId={parentIssueId} disabled={disabled} issueServiceType={issueServiceType} />\n-        )\n+        <SubWorkItemTitleActions\n+          workspaceSlug={workspaceSlug}\n+          projectId={projectId}\n+          parentId={parentIssueId}\n+          disabled={disabled}\n+          issueServiceType={issueServiceType}\n+        />\n       }\n     />\n   );\n });\n"
        },
        {
          "path": "web/core/components/issues/relations/issue-list-item.tsx",
          "status": "modified",
          "diff": "Index: web/core/components/issues/relations/issue-list-item.tsx\n===================================================================\n--- web/core/components/issues/relations/issue-list-item.tsx\t55340f9 (parent)\n+++ web/core/components/issues/relations/issue-list-item.tsx\t14dc6a5 (commit)\n@@ -108,9 +108,9 @@\n \n   const handleCopyIssueLink = (e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n     e.stopPropagation();\n     e.preventDefault();\n-    issueOperations.copyText(workItemLink);\n+    issueOperations.copyLink(workItemLink);\n   };\n \n   const handleRemoveRelation = (e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n     e.preventDefault();\n"
        },
        {
          "path": "web/core/components/issues/sub-issues/index.ts",
          "status": "deleted",
          "diff": "Index: web/core/components/issues/sub-issues/index.ts\n===================================================================\n--- web/core/components/issues/sub-issues/index.ts\t55340f9 (parent)\n+++ web/core/components/issues/sub-issues/index.ts\t14dc6a5 (commit)\n@@ -1,1 +0,0 @@\n-export * from \"./root\";\n"
        },
        {
          "path": "web/core/components/issues/sub-issues/issues-list.tsx",
          "status": "deleted",
          "diff": "Index: web/core/components/issues/sub-issues/issues-list.tsx\n===================================================================\n--- web/core/components/issues/sub-issues/issues-list.tsx\t55340f9 (parent)\n+++ web/core/components/issues/sub-issues/issues-list.tsx\t14dc6a5 (commit)\n@@ -1,69 +0,0 @@\n-import { FC, Fragment } from \"react\";\n-import { observer } from \"mobx-react\";\n-import { EIssueServiceType } from \"@plane/constants\";\n-import { TIssue, TIssueServiceType } from \"@plane/types\";\n-// hooks\n-import { useIssueDetail } from \"@/hooks/store\";\n-// components\n-import { IssueListItem } from \"./issue-list-item\";\n-// types\n-import { TSubIssueOperations } from \"./root\";\n-\n-export interface IIssueList {\n-  workspaceSlug: string;\n-  projectId: string;\n-  parentIssueId: string;\n-  rootIssueId: string;\n-  spacingLeft: number;\n-  disabled: boolean;\n-  handleIssueCrudState: (\n-    key: \"create\" | \"existing\" | \"update\" | \"delete\",\n-    issueId: string,\n-    issue?: TIssue | null\n-  ) => void;\n-  subIssueOperations: TSubIssueOperations;\n-  issueServiceType?: TIssueServiceType;\n-}\n-\n-export const IssueList: FC<IIssueList> = observer((props) => {\n-  const {\n-    workspaceSlug,\n-    projectId,\n-    parentIssueId,\n-    rootIssueId,\n-    spacingLeft = 10,\n-    disabled,\n-    handleIssueCrudState,\n-    subIssueOperations,\n-    issueServiceType = EIssueServiceType.ISSUES,\n-  } = props;\n-  // hooks\n-  const {\n-    subIssues: { subIssuesByIssueId },\n-  } = useIssueDetail(issueServiceType);\n-\n-  const subIssueIds = subIssuesByIssueId(parentIssueId);\n-\n-  return (\n-    <div className=\"relative\">\n-      {subIssueIds &&\n-        subIssueIds.length > 0 &&\n-        subIssueIds.map((issueId) => (\n-          <Fragment key={issueId}>\n-            <IssueListItem\n-              workspaceSlug={workspaceSlug}\n-              projectId={projectId}\n-              parentIssueId={parentIssueId}\n-              rootIssueId={rootIssueId}\n-              issueId={issueId}\n-              spacingLeft={spacingLeft}\n-              disabled={disabled}\n-              handleIssueCrudState={handleIssueCrudState}\n-              subIssueOperations={subIssueOperations}\n-              issueServiceType={issueServiceType}\n-            />\n-          </Fragment>\n-        ))}\n-    </div>\n-  );\n-});\n"
        },
        {
          "path": "web/core/components/issues/sub-issues/progressbar.tsx",
          "status": "deleted",
          "diff": "Index: web/core/components/issues/sub-issues/progressbar.tsx\n===================================================================\n--- web/core/components/issues/sub-issues/progressbar.tsx\t55340f9 (parent)\n+++ web/core/components/issues/sub-issues/progressbar.tsx\t14dc6a5 (commit)\n@@ -1,25 +0,0 @@\n-export interface IProgressBar {\n-  total: number;\n-  done: number;\n-}\n-\n-export const ProgressBar = ({ total = 0, done = 0 }: IProgressBar) => {\n-  const calPercentage = (doneValue: number, totalValue: number): string => {\n-    if (doneValue === 0 || totalValue === 0) return (0).toFixed(0);\n-    return ((100 * doneValue) / totalValue).toFixed(0);\n-  };\n-\n-  return (\n-    <div className=\"relative flex items-center gap-2\">\n-      <div className=\"w-full\">\n-        <div className=\"w-full overflow-hidden rounded-full bg-custom-background-80 shadow\">\n-          <div\n-            className=\"h-[6px] rounded-full bg-green-500 transition-all\"\n-            style={{ width: `${calPercentage(done, total)}%` }}\n-          />\n-        </div>\n-      </div>\n-      <div className=\"flex-shrink-0 text-xs font-medium\">{calPercentage(done, total)}% Done</div>\n-    </div>\n-  );\n-};\n"
        },
        {
          "path": "web/core/components/issues/sub-issues/properties.tsx",
          "status": "deleted",
          "diff": "Index: web/core/components/issues/sub-issues/properties.tsx\n===================================================================\n--- web/core/components/issues/sub-issues/properties.tsx\t55340f9 (parent)\n+++ web/core/components/issues/sub-issues/properties.tsx\t14dc6a5 (commit)\n@@ -1,86 +0,0 @@\n-import React from \"react\";\n-import { TIssueServiceType } from \"@plane/types\";\n-// hooks\n-import { PriorityDropdown, MemberDropdown, StateDropdown } from \"@/components/dropdowns\";\n-import { useIssueDetail } from \"@/hooks/store\";\n-// components\n-// types\n-import { TSubIssueOperations } from \"./root\";\n-\n-export interface IIssueProperty {\n-  workspaceSlug: string;\n-  parentIssueId: string;\n-  issueId: string;\n-  disabled: boolean;\n-  subIssueOperations: TSubIssueOperations;\n-  issueServiceType?: TIssueServiceType;\n-}\n-\n-export const IssueProperty: React.FC<IIssueProperty> = (props) => {\n-  const { workspaceSlug, parentIssueId, issueId, disabled, subIssueOperations, issueServiceType } = props;\n-  // hooks\n-  const {\n-    issue: { getIssueById },\n-  } = useIssueDetail(issueServiceType);\n-\n-  const issue = getIssueById(issueId);\n-\n-  if (!issue) return <></>;\n-  return (\n-    <div className=\"relative flex items-center gap-2\">\n-      <div className=\"h-5 flex-shrink-0\">\n-        <StateDropdown\n-          value={issue.state_id}\n-          projectId={issue.project_id ?? undefined}\n-          onChange={(val) =>\n-            issue.project_id &&\n-            subIssueOperations.updateSubIssue(\n-              workspaceSlug,\n-              issue.project_id,\n-              parentIssueId,\n-              issueId,\n-              {\n-                state_id: val,\n-              },\n-              { ...issue }\n-            )\n-          }\n-          disabled={!disabled}\n-          buttonVariant=\"border-with-text\"\n-        />\n-      </div>\n-\n-      <div className=\"h-5 flex-shrink-0\">\n-        <PriorityDropdown\n-          value={issue.priority}\n-          onChange={(val) =>\n-            issue.project_id &&\n-            subIssueOperations.updateSubIssue(workspaceSlug, issue.project_id, parentIssueId, issueId, {\n-              priority: val,\n-            })\n-          }\n-          disabled={!disabled}\n-          buttonVariant=\"border-without-text\"\n-          buttonClassName=\"border\"\n-        />\n-      </div>\n-\n-      <div className=\"h-5 flex-shrink-0\">\n-        <MemberDropdown\n-          value={issue.assignee_ids}\n-          projectId={issue.project_id ?? undefined}\n-          onChange={(val) =>\n-            issue.project_id &&\n-            subIssueOperations.updateSubIssue(workspaceSlug, issue.project_id, parentIssueId, issueId, {\n-              assignee_ids: val,\n-            })\n-          }\n-          disabled={!disabled}\n-          multiple\n-          buttonVariant={(issue?.assignee_ids || []).length > 0 ? \"transparent-without-text\" : \"border-without-text\"}\n-          buttonClassName={(issue?.assignee_ids || []).length > 0 ? \"hover:bg-transparent px-0\" : \"\"}\n-        />\n-      </div>\n-    </div>\n-  );\n-};\n"
        },
        {
          "path": "web/core/components/issues/sub-issues/root.tsx",
          "status": "deleted",
          "diff": "Index: web/core/components/issues/sub-issues/root.tsx\n===================================================================\n--- web/core/components/issues/sub-issues/root.tsx\t55340f9 (parent)\n+++ web/core/components/issues/sub-issues/root.tsx\t14dc6a5 (commit)\n@@ -1,546 +0,0 @@\n-\"use client\";\n-\n-import { FC, useCallback, useEffect, useMemo, useState } from \"react\";\n-import { observer } from \"mobx-react\";\n-import { usePathname } from \"next/navigation\";\n-// icons\n-import { Plus, ChevronRight, Loader, Pencil } from \"lucide-react\";\n-// types\n-import { IUser, TIssue } from \"@plane/types\";\n-// ui\n-import { CircularProgressIndicator, CustomMenu, LayersIcon, TOAST_TYPE, setToast } from \"@plane/ui\";\n-// components\n-import { ExistingIssuesListModal } from \"@/components/core\";\n-import { CreateUpdateIssueModal, DeleteIssueModal } from \"@/components/issues\";\n-// helpers\n-import { cn } from \"@/helpers/common.helper\";\n-import { copyTextToClipboard } from \"@/helpers/string.helper\";\n-// hooks\n-import { useEventTracker, useIssueDetail } from \"@/hooks/store\";\n-// local components\n-import useURLHash from \"@/hooks/use-url-hash\";\n-import { IssueList } from \"./issues-list\";\n-\n-export interface ISubIssuesRoot {\n-  workspaceSlug: string;\n-  projectId: string;\n-  parentIssueId: string;\n-  currentUser: IUser;\n-  disabled: boolean;\n-}\n-\n-export type TSubIssueOperations = {\n-  copyText: (text: string) => void;\n-  fetchSubIssues: (workspaceSlug: string, projectId: string, parentIssueId: string) => Promise<void>;\n-  addSubIssue: (workspaceSlug: string, projectId: string, parentIssueId: string, issueIds: string[]) => Promise<void>;\n-  updateSubIssue: (\n-    workspaceSlug: string,\n-    projectId: string,\n-    parentIssueId: string,\n-    issueId: string,\n-    issueData: Partial<TIssue>,\n-    oldIssue?: Partial<TIssue>,\n-    fromModal?: boolean\n-  ) => Promise<void>;\n-  removeSubIssue: (workspaceSlug: string, projectId: string, parentIssueId: string, issueId: string) => Promise<void>;\n-  deleteSubIssue: (workspaceSlug: string, projectId: string, parentIssueId: string, issueId: string) => Promise<void>;\n-};\n-\n-export const SubIssuesRoot: FC<ISubIssuesRoot> = observer((props) => {\n-  const { workspaceSlug, projectId, parentIssueId, disabled = false } = props;\n-  // router\n-  const pathname = usePathname();\n-  const hashValue = useURLHash();\n-  const {\n-    issue: { getIssueById },\n-    subIssues: { subIssuesByIssueId, stateDistributionByIssueId, subIssueHelpersByIssueId, setSubIssueHelpers },\n-    fetchSubIssues,\n-    createSubIssues,\n-    updateSubIssue,\n-    removeSubIssue,\n-    deleteSubIssue,\n-    isCreateIssueModalOpen,\n-    toggleCreateIssueModal,\n-    isSubIssuesModalOpen,\n-    toggleSubIssuesModal,\n-    toggleDeleteIssueModal,\n-  } = useIssueDetail();\n-  const { setTrackElement, captureIssueEvent } = useEventTracker();\n-  // state\n-\n-  type TIssueCrudState = { toggle: boolean; parentIssueId: string | undefined; issue: TIssue | undefined };\n-  const [issueCrudState, setIssueCrudState] = useState<{\n-    create: TIssueCrudState;\n-    existing: TIssueCrudState;\n-    update: TIssueCrudState;\n-    delete: TIssueCrudState;\n-  }>({\n-    create: {\n-      toggle: false,\n-      parentIssueId: undefined,\n-      issue: undefined,\n-    },\n-    existing: {\n-      toggle: false,\n-      parentIssueId: undefined,\n-      issue: undefined,\n-    },\n-    update: {\n-      toggle: false,\n-      parentIssueId: undefined,\n-      issue: undefined,\n-    },\n-    delete: {\n-      toggle: false,\n-      parentIssueId: undefined,\n-      issue: undefined,\n-    },\n-  });\n-\n-  const scrollToSubIssuesView = useCallback(() => {\n-    if (hashValue === \"sub-issues\") {\n-      setTimeout(() => {\n-        const subIssueDiv = document.getElementById(`sub-issues`);\n-        if (subIssueDiv)\n-          subIssueDiv.scrollIntoView({\n-            behavior: \"smooth\",\n-            block: \"start\",\n-          });\n-      }, 200);\n-    }\n-  }, [hashValue]);\n-\n-  useEffect(() => {\n-    if (hashValue) {\n-      scrollToSubIssuesView();\n-    }\n-  }, [hashValue, scrollToSubIssuesView]);\n-\n-  const handleIssueCrudState = (\n-    key: \"create\" | \"existing\" | \"update\" | \"delete\",\n-    _parentIssueId: string | null,\n-    issue: TIssue | null = null\n-  ) => {\n-    setIssueCrudState({\n-      ...issueCrudState,\n-      [key]: {\n-        toggle: !issueCrudState[key].toggle,\n-        parentIssueId: _parentIssueId,\n-        issue: issue,\n-      },\n-    });\n-  };\n-\n-  const subIssueOperations: TSubIssueOperations = useMemo(\n-    () => ({\n-      copyText: (text: string) => {\n-        const originURL = typeof window !== \"undefined\" && window.location.origin ? window.location.origin : \"\";\n-        copyTextToClipboard(`${originURL}${text}`).then(() => {\n-          setToast({\n-            type: TOAST_TYPE.SUCCESS,\n-            title: \"Link Copied!\",\n-            message: \"Work item link copied to clipboard.\",\n-          });\n-        });\n-      },\n-      fetchSubIssues: async (workspaceSlug: string, projectId: string, parentIssueId: string) => {\n-        try {\n-          await fetchSubIssues(workspaceSlug, projectId, parentIssueId);\n-        } catch (error) {\n-          setToast({\n-            type: TOAST_TYPE.ERROR,\n-            title: \"Error!\",\n-            message: \"Error fetching sub-work items\",\n-          });\n-        }\n-      },\n-      addSubIssue: async (workspaceSlug: string, projectId: string, parentIssueId: string, issueIds: string[]) => {\n-        try {\n-          await createSubIssues(workspaceSlug, projectId, parentIssueId, issueIds);\n-          setToast({\n-            type: TOAST_TYPE.SUCCESS,\n-            title: \"Success!\",\n-            message: \"Sub-work items added successfully\",\n-          });\n-        } catch (error) {\n-          setToast({\n-            type: TOAST_TYPE.ERROR,\n-            title: \"Error!\",\n-            message: \"Error adding sub-work item\",\n-          });\n-        }\n-      },\n-      updateSubIssue: async (\n-        workspaceSlug: string,\n-        projectId: string,\n-        parentIssueId: string,\n-        issueId: string,\n-        issueData: Partial<TIssue>,\n-        oldIssue: Partial<TIssue> = {},\n-        fromModal: boolean = false\n-      ) => {\n-        try {\n-          setSubIssueHelpers(parentIssueId, \"issue_loader\", issueId);\n-          await updateSubIssue(workspaceSlug, projectId, parentIssueId, issueId, issueData, oldIssue, fromModal);\n-          captureIssueEvent({\n-            eventName: \"Sub-issue updated\",\n-            payload: { ...oldIssue, ...issueData, state: \"SUCCESS\", element: \"Issue detail page\" },\n-            updates: {\n-              changed_property: Object.keys(issueData).join(\",\"),\n-              change_details: Object.values(issueData).join(\",\"),\n-            },\n-            path: pathname,\n-          });\n-          setToast({\n-            type: TOAST_TYPE.SUCCESS,\n-            title: \"Success!\",\n-            message: \"Sub-work item updated successfully\",\n-          });\n-          setSubIssueHelpers(parentIssueId, \"issue_loader\", issueId);\n-        } catch (error) {\n-          captureIssueEvent({\n-            eventName: \"Sub-issue updated\",\n-            payload: { ...oldIssue, ...issueData, state: \"FAILED\", element: \"Issue detail page\" },\n-            updates: {\n-              changed_property: Object.keys(issueData).join(\",\"),\n-              change_details: Object.values(issueData).join(\",\"),\n-            },\n-            path: pathname,\n-          });\n-          setToast({\n-            type: TOAST_TYPE.ERROR,\n-            title: \"Error!\",\n-            message: \"Error updating sub-work item\",\n-          });\n-        }\n-      },\n-      removeSubIssue: async (workspaceSlug: string, projectId: string, parentIssueId: string, issueId: string) => {\n-        try {\n-          setSubIssueHelpers(parentIssueId, \"issue_loader\", issueId);\n-          await removeSubIssue(workspaceSlug, projectId, parentIssueId, issueId);\n-          setToast({\n-            type: TOAST_TYPE.SUCCESS,\n-            title: \"Success!\",\n-            message: \"Sub-work item removed successfully\",\n-          });\n-          captureIssueEvent({\n-            eventName: \"Sub-issue removed\",\n-            payload: { id: issueId, state: \"SUCCESS\", element: \"Issue detail page\" },\n-            updates: {\n-              changed_property: \"parent_id\",\n-              change_details: parentIssueId,\n-            },\n-            path: pathname,\n-          });\n-          setSubIssueHelpers(parentIssueId, \"issue_loader\", issueId);\n-        } catch (error) {\n-          captureIssueEvent({\n-            eventName: \"Sub-issue removed\",\n-            payload: { id: issueId, state: \"FAILED\", element: \"Issue detail page\" },\n-            updates: {\n-              changed_property: \"parent_id\",\n-              change_details: parentIssueId,\n-            },\n-            path: pathname,\n-          });\n-          setToast({\n-            type: TOAST_TYPE.ERROR,\n-            title: \"Error!\",\n-            message: \"Error removing sub-work item\",\n-          });\n-        }\n-      },\n-      deleteSubIssue: async (workspaceSlug: string, projectId: string, parentIssueId: string, issueId: string) => {\n-        try {\n-          setSubIssueHelpers(parentIssueId, \"issue_loader\", issueId);\n-          await deleteSubIssue(workspaceSlug, projectId, parentIssueId, issueId);\n-          captureIssueEvent({\n-            eventName: \"Sub-issue deleted\",\n-            payload: { id: issueId, state: \"SUCCESS\", element: \"Issue detail page\" },\n-            path: pathname,\n-          });\n-          setSubIssueHelpers(parentIssueId, \"issue_loader\", issueId);\n-        } catch (error) {\n-          captureIssueEvent({\n-            eventName: \"Sub-issue removed\",\n-            payload: { id: issueId, state: \"FAILED\", element: \"Issue detail page\" },\n-            path: pathname,\n-          });\n-          setToast({\n-            type: TOAST_TYPE.ERROR,\n-            title: \"Error!\",\n-            message: \"Error deleting work item\",\n-          });\n-        }\n-      },\n-    }),\n-    [fetchSubIssues, createSubIssues, updateSubIssue, removeSubIssue, deleteSubIssue, setSubIssueHelpers]\n-  );\n-\n-  const issue = getIssueById(parentIssueId);\n-  const subIssuesDistribution = stateDistributionByIssueId(parentIssueId);\n-  const subIssues = subIssuesByIssueId(parentIssueId);\n-  const subIssueHelpers = subIssueHelpersByIssueId(`${parentIssueId}_root`);\n-\n-  const handleFetchSubIssues = useCallback(async () => {\n-    if (!subIssueHelpers.issue_visibility.includes(parentIssueId)) {\n-      setSubIssueHelpers(`${parentIssueId}_root`, \"preview_loader\", parentIssueId);\n-      await subIssueOperations.fetchSubIssues(workspaceSlug, projectId, parentIssueId);\n-      setSubIssueHelpers(`${parentIssueId}_root`, \"preview_loader\", parentIssueId);\n-    }\n-    setSubIssueHelpers(`${parentIssueId}_root`, \"issue_visibility\", parentIssueId);\n-  }, [\n-    parentIssueId,\n-    projectId,\n-    setSubIssueHelpers,\n-    subIssueHelpers.issue_visibility,\n-    subIssueOperations,\n-    workspaceSlug,\n-  ]);\n-\n-  useEffect(() => {\n-    handleFetchSubIssues();\n-\n-    return () => {\n-      handleFetchSubIssues();\n-    };\n-    // eslint-disable-next-line react-hooks/exhaustive-deps\n-  }, [parentIssueId]);\n-\n-  if (!issue) return <></>;\n-  return (\n-    <div id=\"sub-issues\" className=\"h-full w-full space-y-2\">\n-      {!subIssues ? (\n-        <div className=\"py-3 text-center text-sm  font-medium text-custom-text-300\">Loading...</div>\n-      ) : (\n-        <>\n-          {subIssues && subIssues?.length > 0 ? (\n-            <>\n-              <div className=\"relative flex items-center justify-between gap-2 text-xs\">\n-                <div className=\"flex items-center gap-2\">\n-                  <button\n-                    type=\"button\"\n-                    className=\"flex items-center gap-1 rounded py-1 px-2 transition-all hover:bg-custom-background-80 font-medium\"\n-                    onClick={handleFetchSubIssues}\n-                  >\n-                    <div className=\"flex flex-shrink-0 items-center justify-center\">\n-                      {subIssueHelpers.preview_loader.includes(parentIssueId) ? (\n-                        <Loader strokeWidth={2} className=\"h-3 w-3 animate-spin\" />\n-                      ) : (\n-                        <ChevronRight\n-                          className={cn(\"h-3 w-3 transition-all\", {\n-                            \"rotate-90\": subIssueHelpers.issue_visibility.includes(parentIssueId),\n-                          })}\n-                          strokeWidth={2}\n-                        />\n-                      )}\n-                    </div>\n-                    <div>Sub-work items</div>\n-                  </button>\n-                  <div className=\"flex items-center gap-2 text-custom-text-300\">\n-                    <CircularProgressIndicator\n-                      size={16}\n-                      percentage={\n-                        subIssuesDistribution?.completed?.length && subIssues.length\n-                          ? (subIssuesDistribution?.completed?.length / subIssues.length) * 100\n-                          : 0\n-                      }\n-                      strokeWidth={3}\n-                    />\n-                    <span>\n-                      {subIssuesDistribution?.completed?.length ?? 0}/{subIssues.length} Done\n-                    </span>\n-                  </div>\n-                </div>\n-\n-                {!disabled && (\n-                  <CustomMenu\n-                    label={\n-                      <>\n-                        <Plus className=\"h-3 w-3\" />\n-                        Add sub-work item\n-                      </>\n-                    }\n-                    buttonClassName=\"whitespace-nowrap\"\n-                    placement=\"bottom-end\"\n-                    noBorder\n-                    noChevron\n-                  >\n-                    <CustomMenu.MenuItem\n-                      onClick={() => {\n-                        setTrackElement(\"Issue detail nested sub-issue\");\n-                        handleIssueCrudState(\"create\", parentIssueId, null);\n-                        toggleCreateIssueModal(true);\n-                      }}\n-                    >\n-                      <div className=\"flex items-center gap-2\">\n-                        <Pencil className=\"h-3 w-3\" />\n-                        <span>Create new</span>\n-                      </div>\n-                    </CustomMenu.MenuItem>\n-                    <CustomMenu.MenuItem\n-                      onClick={() => {\n-                        setTrackElement(\"Issue detail nested sub-issue\");\n-                        handleIssueCrudState(\"existing\", parentIssueId, null);\n-                        toggleSubIssuesModal(issue.id);\n-                      }}\n-                    >\n-                      <div className=\"flex items-center gap-2\">\n-                        <LayersIcon className=\"h-3 w-3\" />\n-                        <span>Add existing</span>\n-                      </div>\n-                    </CustomMenu.MenuItem>\n-                  </CustomMenu>\n-                )}\n-              </div>\n-\n-              {subIssueHelpers.issue_visibility.includes(parentIssueId) && (\n-                <IssueList\n-                  workspaceSlug={workspaceSlug}\n-                  projectId={projectId}\n-                  parentIssueId={parentIssueId}\n-                  rootIssueId={parentIssueId}\n-                  spacingLeft={10}\n-                  disabled={!disabled}\n-                  handleIssueCrudState={handleIssueCrudState}\n-                  subIssueOperations={subIssueOperations}\n-                />\n-              )}\n-            </>\n-          ) : (\n-            !disabled && (\n-              <div className=\"flex items-center justify-between\">\n-                <div className=\"text-xs italic text-custom-text-300\">No sub-work items yet</div>\n-                <CustomMenu\n-                  label={\n-                    <>\n-                      <Plus className=\"h-3 w-3\" />\n-                      Add sub-work item\n-                    </>\n-                  }\n-                  buttonClassName=\"whitespace-nowrap\"\n-                  placement=\"bottom-end\"\n-                  noBorder\n-                  noChevron\n-                >\n-                  <CustomMenu.MenuItem\n-                    onClick={() => {\n-                      setTrackElement(\"Issue detail nested sub-issue\");\n-                      handleIssueCrudState(\"create\", parentIssueId, null);\n-                      toggleCreateIssueModal(true);\n-                    }}\n-                  >\n-                    <div className=\"flex items-center gap-2\">\n-                      <Pencil className=\"h-3 w-3\" />\n-                      <span>Create new</span>\n-                    </div>\n-                  </CustomMenu.MenuItem>\n-                  <CustomMenu.MenuItem\n-                    onClick={() => {\n-                      setTrackElement(\"Issue detail nested sub-issue\");\n-                      handleIssueCrudState(\"existing\", parentIssueId, null);\n-                      toggleSubIssuesModal(issue.id);\n-                    }}\n-                  >\n-                    <div className=\"flex items-center gap-2\">\n-                      <LayersIcon className=\"h-3 w-3\" />\n-                      <span>Add existing</span>\n-                    </div>\n-                  </CustomMenu.MenuItem>\n-                </CustomMenu>\n-              </div>\n-            )\n-          )}\n-\n-          {/* issue create, add from existing , update and delete modals */}\n-          {issueCrudState?.create?.toggle && issueCrudState?.create?.parentIssueId && isCreateIssueModalOpen && (\n-            <CreateUpdateIssueModal\n-              isOpen={issueCrudState?.create?.toggle}\n-              data={{\n-                parent_id: issueCrudState?.create?.parentIssueId,\n-              }}\n-              onClose={() => {\n-                handleIssueCrudState(\"create\", null, null);\n-                toggleCreateIssueModal(false);\n-              }}\n-              onSubmit={async (_issue: TIssue) => {\n-                if (_issue.parent_id) {\n-                  await subIssueOperations.addSubIssue(workspaceSlug, projectId, _issue.parent_id, [_issue.id]);\n-                }\n-              }}\n-            />\n-          )}\n-\n-          {issueCrudState?.existing?.toggle && issueCrudState?.existing?.parentIssueId && isSubIssuesModalOpen && (\n-            <ExistingIssuesListModal\n-              workspaceSlug={workspaceSlug}\n-              projectId={projectId}\n-              isOpen={issueCrudState?.existing?.toggle}\n-              handleClose={() => {\n-                handleIssueCrudState(\"existing\", null, null);\n-                toggleSubIssuesModal(null);\n-              }}\n-              searchParams={{ sub_issue: true, issue_id: issueCrudState?.existing?.parentIssueId }}\n-              handleOnSubmit={(_issue) =>\n-                subIssueOperations.addSubIssue(\n-                  workspaceSlug,\n-                  projectId,\n-                  parentIssueId,\n-                  _issue.map((issue) => issue.id)\n-                )\n-              }\n-              workspaceLevelToggle\n-            />\n-          )}\n-\n-          {issueCrudState?.update?.toggle && issueCrudState?.update?.issue && (\n-            <>\n-              <CreateUpdateIssueModal\n-                isOpen={issueCrudState?.update?.toggle}\n-                onClose={() => {\n-                  handleIssueCrudState(\"update\", null, null);\n-                  toggleCreateIssueModal(false);\n-                }}\n-                data={issueCrudState?.update?.issue ?? undefined}\n-                onSubmit={async (_issue: TIssue) => {\n-                  await subIssueOperations.updateSubIssue(\n-                    workspaceSlug,\n-                    projectId,\n-                    parentIssueId,\n-                    _issue.id,\n-                    _issue,\n-                    issueCrudState?.update?.issue,\n-                    true\n-                  );\n-                }}\n-              />\n-            </>\n-          )}\n-\n-          {issueCrudState?.delete?.toggle &&\n-            issueCrudState?.delete?.issue &&\n-            issueCrudState.delete.parentIssueId &&\n-            issueCrudState.delete.issue.id && (\n-              <DeleteIssueModal\n-                isOpen={issueCrudState?.delete?.toggle}\n-                handleClose={() => {\n-                  handleIssueCrudState(\"delete\", null, null);\n-                  toggleDeleteIssueModal(null);\n-                }}\n-                data={issueCrudState?.delete?.issue as TIssue}\n-                onSubmit={async () =>\n-                  await subIssueOperations.deleteSubIssue(\n-                    workspaceSlug,\n-                    projectId,\n-                    issueCrudState?.delete?.parentIssueId as string,\n-                    issueCrudState?.delete?.issue?.id as string\n-                  )\n-                }\n-                isSubIssue\n-              />\n-            )}\n-        </>\n-      )}\n-    </div>\n-  );\n-});\n"
        },
        {
          "path": "web/core/services/issue/issue.service.ts",
          "status": "modified",
          "diff": "Index: web/core/services/issue/issue.service.ts\n===================================================================\n--- web/core/services/issue/issue.service.ts\t55340f9 (parent)\n+++ web/core/services/issue/issue.service.ts\t14dc6a5 (commit)\n@@ -266,11 +266,17 @@\n         throw error?.response?.data;\n       });\n   }\n \n-  async subIssues(workspaceSlug: string, projectId: string, issueId: string): Promise<TIssueSubIssues> {\n+  async subIssues(\n+    workspaceSlug: string,\n+    projectId: string,\n+    issueId: string,\n+    queries?: Partial<Record<TIssueParams, string | boolean>>\n+  ): Promise<TIssueSubIssues> {\n     return this.get(\n-      `/api/workspaces/${workspaceSlug}/projects/${projectId}/${this.serviceType}/${issueId}/${this.serviceType === EIssueServiceType.EPICS ? \"issues\" : \"sub-issues\"}/`\n+      `/api/workspaces/${workspaceSlug}/projects/${projectId}/${this.serviceType}/${issueId}/${this.serviceType === EIssueServiceType.EPICS ? \"issues\" : \"sub-issues\"}/`,\n+      { params: queries }\n     )\n       .then((response) => response?.data)\n       .catch((error) => {\n         throw error?.response?.data;\n"
        },
        {
          "path": "web/core/store/issue/issue-details/sub_issues.store.ts",
          "status": "modified",
          "diff": "Index: web/core/store/issue/issue-details/sub_issues.store.ts\n===================================================================\n--- web/core/store/issue/issue-details/sub_issues.store.ts\t55340f9 (parent)\n+++ web/core/store/issue/issue-details/sub_issues.store.ts\t14dc6a5 (commit)\n@@ -12,14 +12,18 @@\n   TIssueSubIssuesStateDistributionMap,\n   TIssueSubIssuesIdMap,\n   TSubIssuesStateDistribution,\n   TIssueServiceType,\n+  TLoader,\n+  TGroupedIssues,\n+  TGroupedIssueCount,\n } from \"@plane/types\";\n // services\n import { updatePersistentLayer } from \"@/local-db/utils/utils\";\n import { IssueService } from \"@/services/issue\";\n // store\n import { IIssueDetail } from \"./root.store\";\n+import { IWorkItemSubIssueFiltersStore, WorkItemSubIssueFiltersStore } from \"./sub_issues_filter.store\";\n \n export interface IIssueSubIssuesStoreActions {\n   fetchSubIssues: (workspaceSlug: string, projectId: string, parentIssueId: string) => Promise<TIssueSubIssues>;\n   createSubIssues: (\n@@ -46,13 +50,18 @@\n export interface IIssueSubIssuesStore extends IIssueSubIssuesStoreActions {\n   // observables\n   subIssuesStateDistribution: TIssueSubIssuesStateDistributionMap;\n   subIssues: TIssueSubIssuesIdMap;\n+  groupedSubIssuesMap: Record<string, TGroupedIssues>;\n+  groupedSubIssuesCount: TGroupedIssueCount;\n   subIssueHelpers: Record<string, TSubIssueHelpers>; // parent_issue_id -> TSubIssueHelpers\n+  loader: TLoader;\n+  filters: IWorkItemSubIssueFiltersStore;\n   // helper methods\n   stateDistributionByIssueId: (issueId: string) => TSubIssuesStateDistribution | undefined;\n   subIssuesByIssueId: (issueId: string) => string[] | undefined;\n   subIssueHelpersByIssueId: (issueId: string) => TSubIssueHelpers;\n+  groupedSubIssuesByIssueId: (issueId: string) => TGroupedIssues | undefined;\n   // actions\n   fetchOtherProjectProperties: (workspaceSlug: string, projectIds: string[]) => Promise<void>;\n   setSubIssueHelpers: (parentIssueId: string, key: TSubIssueHelpersKeys, value: string) => void;\n }\n@@ -60,9 +69,14 @@\n export class IssueSubIssuesStore implements IIssueSubIssuesStore {\n   // observables\n   subIssuesStateDistribution: TIssueSubIssuesStateDistributionMap = {};\n   subIssues: TIssueSubIssuesIdMap = {};\n+  groupedSubIssuesMap: Record<string, TGroupedIssues> = {};\n+  groupedSubIssuesCount: TGroupedIssueCount = {};\n   subIssueHelpers: Record<string, TSubIssueHelpers> = {};\n+  loader: TLoader = undefined;\n+\n+  filters: IWorkItemSubIssueFiltersStore;\n   // root store\n   rootIssueDetailStore: IIssueDetail;\n   // services\n   serviceType;\n@@ -73,17 +87,21 @@\n       // observables\n       subIssuesStateDistribution: observable,\n       subIssues: observable,\n       subIssueHelpers: observable,\n+      groupedSubIssuesMap: observable,\n+      loader: observable.ref,\n       // actions\n       setSubIssueHelpers: action,\n       fetchSubIssues: action,\n       createSubIssues: action,\n       updateSubIssue: action,\n       removeSubIssue: action,\n       deleteSubIssue: action,\n       fetchOtherProjectProperties: action,\n+      groupedSubIssuesByIssueId: action,\n     });\n+    this.filters = new WorkItemSubIssueFiltersStore(this);\n     // root store\n     this.rootIssueDetailStore = rootStore;\n     // services\n     this.serviceType = serviceType;\n@@ -100,8 +118,10 @@\n     if (!issueId) return undefined;\n     return this.subIssues[issueId] ?? undefined;\n   };\n \n+  groupedSubIssuesByIssueId = (issueId: string) => this.groupedSubIssuesMap[issueId] ?? undefined;\n+\n   subIssueHelpersByIssueId = (issueId: string) => ({\n     preview_loader: this.subIssueHelpers?.[issueId]?.preview_loader || [],\n     issue_visibility: this.subIssueHelpers?.[issueId]?.issue_visibility || [],\n     issue_loader: this.subIssueHelpers?.[issueId]?.issue_loader || [],\n@@ -117,30 +137,39 @@\n     });\n   };\n \n   fetchSubIssues = async (workspaceSlug: string, projectId: string, parentIssueId: string) => {\n-    const response = await this.issueService.subIssues(workspaceSlug, projectId, parentIssueId);\n+    // get filter params\n+    const filterParams = this.filters.computedFilterParams(parentIssueId);\n+    const response = await this.issueService.subIssues(workspaceSlug, projectId, parentIssueId, filterParams);\n+\n     const subIssuesStateDistribution = response?.state_distribution ?? {};\n-    const subIssues = (response.sub_issues ?? []) as TIssue[];\n-    this.rootIssueDetailStore.rootIssueStore.issues.addIssue(subIssues);\n-    // fetch other issues states and members when sub-issues are from different project\n-    if (subIssues && subIssues.length > 0) {\n+\n+    // process sub issues response\n+    const { issueList, groupedIssues } = this.filters.processSubIssueResponse(response.sub_issues);\n+\n+    // set grouped issues count\n+    set(this.groupedSubIssuesMap, [parentIssueId], groupedIssues);\n+\n+    this.rootIssueDetailStore.rootIssueStore.issues.addIssue(issueList);\n+\n+    if (issueList && issueList.length > 0) {\n       const otherProjectIds = uniq(\n-        subIssues.map((issue) => issue.project_id).filter((id) => !!id && id !== projectId)\n+        issueList.map((issue) => issue.project_id).filter((id) => !!id && id !== projectId)\n       ) as string[];\n       this.fetchOtherProjectProperties(workspaceSlug, otherProjectIds);\n     }\n-    if (subIssues) {\n+    if (issueList) {\n       this.rootIssueDetailStore.rootIssueStore.issues.updateIssue(parentIssueId, {\n-        sub_issues_count: subIssues.length,\n+        sub_issues_count: issueList.length,\n       });\n     }\n     runInAction(() => {\n       set(this.subIssuesStateDistribution, parentIssueId, subIssuesStateDistribution);\n       set(\n         this.subIssues,\n         parentIssueId,\n-        subIssues.map((issue) => issue.id)\n+        issueList.map((issue) => issue.id)\n       );\n     });\n     return response;\n   };\n@@ -281,9 +310,9 @@\n       // update sub-issues_count of the parent issue\n       set(\n         this.rootIssueDetailStore.rootIssueStore.issues.issuesMap,\n         [parentIssueId, \"sub_issues_count\"],\n-        this.subIssues[parentIssueId].length\n+        this.subIssues[parentIssueId]?.length\n       );\n     });\n \n     if (this.serviceType === EIssueServiceType.ISSUES) {\n@@ -318,9 +347,9 @@\n       // update sub-issues_count of the parent issue\n       set(\n         this.rootIssueDetailStore.rootIssueStore.issues.issuesMap,\n         [parentIssueId, \"sub_issues_count\"],\n-        this.subIssues[parentIssueId].length\n+        this.subIssues[parentIssueId]?.length\n       );\n     });\n \n     if (this.serviceType === EIssueServiceType.ISSUES) {\n"
        },
        {
          "path": "web/core/store/issue/issue-details/sub_issues_filter.store.ts",
          "status": "added",
          "diff": "Index: web/core/store/issue/issue-details/sub_issues_filter.store.ts\n===================================================================\n--- web/core/store/issue/issue-details/sub_issues_filter.store.ts\t55340f9 (parent)\n+++ web/core/store/issue/issue-details/sub_issues_filter.store.ts\t14dc6a5 (commit)\n@@ -0,0 +1,202 @@\n+import set from \"lodash/set\";\n+import { action, makeObservable, observable } from \"mobx\";\n+import { ALL_ISSUES, EIssueFilterType, EIssueGroupByToServerOptions } from \"@plane/constants\";\n+import {\n+  IIssueDisplayFilterOptions,\n+  IIssueDisplayProperties,\n+  IIssueFilters,\n+  TGroupedIssueCount,\n+  TGroupedIssues,\n+  TIssue,\n+  TIssueParams,\n+  TIssues,\n+  TSubGroupedIssues,\n+  TSubIssueResponse,\n+} from \"@plane/types\";\n+import { IIssueSubIssuesStore } from \"./sub_issues.store\";\n+\n+export interface IWorkItemSubIssueFiltersStore {\n+  subIssueFiltersMap: Record<string, Partial<IIssueFilters>>;\n+  // helpers methods\n+  updateSubIssueFilters: (\n+    workspaceSlug: string,\n+    projectId: string,\n+    filterType: EIssueFilterType,\n+    filters: IIssueDisplayFilterOptions | IIssueDisplayProperties,\n+    parentId: string\n+  ) => Promise<void>;\n+  getSubIssueFilters: (parentId: string) => Partial<IIssueFilters>;\n+  computedFilterParams: (parentId: string) => Partial<Record<TIssueParams, string | boolean>>;\n+  processSubIssueResponse: (issueResponse: TSubIssueResponse) => {\n+    issueList: TIssue[];\n+    groupedIssues: TIssues;\n+    groupedIssueCount: TGroupedIssueCount;\n+  };\n+}\n+\n+export class WorkItemSubIssueFiltersStore implements IWorkItemSubIssueFiltersStore {\n+  // observables\n+  subIssueFiltersMap: Record<string, Partial<IIssueFilters>> = {};\n+\n+  subIssueStore: IIssueSubIssuesStore;\n+\n+  constructor(subIssueStore: IIssueSubIssuesStore) {\n+    makeObservable(this, {\n+      subIssueFiltersMap: observable,\n+      updateSubIssueFilters: action,\n+      getSubIssueFilters: action,\n+    });\n+    // sub issue store\n+    this.subIssueStore = subIssueStore;\n+  }\n+\n+  /**\n+   * @description This method is used to initialize the sub issue filters\n+   * @param parentId\n+   */\n+  initSubIssueFilters = (parentId: string) => {\n+    set(this.subIssueFiltersMap, [parentId], {\n+      displayFilters: {},\n+      displayProperties: {\n+        key: true,\n+        issue_type: true,\n+        assignee: true,\n+        start_date: true,\n+        due_date: true,\n+        labels: true,\n+        priority: true,\n+        state: true,\n+      },\n+    });\n+  };\n+\n+  /**\n+   * @description This method is used to process the sub issue response to provide the data to update the store\n+   * @param issueResponse\n+   * @returns issueList, list of issues data\n+   * @returns groupedIssues, grouped issue ids\n+   * @returns groupedIssueCount, object containing issue counts of individual groups\n+   */\n+  processSubIssueResponse = (\n+    issueResponse: TSubIssueResponse\n+  ): {\n+    issueList: TIssue[];\n+    groupedIssues: TIssues;\n+    groupedIssueCount: TGroupedIssueCount;\n+  } => {\n+    const issueResult = issueResponse;\n+\n+    if (!issueResult) {\n+      return {\n+        issueList: [],\n+        groupedIssues: {},\n+        groupedIssueCount: {},\n+      };\n+    }\n+\n+    //if is an array then it's an ungrouped response. return values with groupId as ALL_ISSUES\n+    if (Array.isArray(issueResult)) {\n+      return {\n+        issueList: issueResult,\n+        groupedIssues: {\n+          [ALL_ISSUES]: issueResult.map((issue) => issue.id),\n+        },\n+        groupedIssueCount: {\n+          [ALL_ISSUES]: issueResult.length,\n+        },\n+      };\n+    }\n+\n+    const issueList: TIssue[] = [];\n+    const groupedIssues: TGroupedIssues | TSubGroupedIssues = {};\n+    const groupedIssueCount: TGroupedIssueCount = {};\n+\n+    // update total issue count to ALL_ISSUES\n+    set(groupedIssueCount, [ALL_ISSUES], issueResult.length);\n+\n+    // loop through all the groupIds from issue Result\n+    for (const groupId in issueResult) {\n+      const groupIssueResult = issueResult[groupId];\n+\n+      // if groupIssueResult is undefined then continue the loop\n+      if (!groupIssueResult) continue;\n+\n+      // set grouped Issue count of the current groupId\n+      set(groupedIssueCount, [groupId], groupIssueResult.length);\n+\n+      // add the result to issueList\n+      issueList.push(...groupIssueResult);\n+      // set the issue Ids to the groupId path\n+      set(\n+        groupedIssues,\n+        [groupId],\n+        groupIssueResult.map((issue) => issue.id)\n+      );\n+    }\n+\n+    return { issueList, groupedIssues, groupedIssueCount };\n+  };\n+\n+  /**\n+   * @description This method is used to get the sub issue filters\n+   * @param parentId\n+   * @returns IIssueFilters\n+   */\n+  getSubIssueFilters = (parentId: string) => {\n+    if (!this.subIssueFiltersMap[parentId]) {\n+      this.initSubIssueFilters(parentId);\n+    }\n+    return this.subIssueFiltersMap[parentId];\n+  };\n+\n+  computedFilterParams = (parentId: string) => {\n+    const displayFilters = this.getSubIssueFilters(parentId).displayFilters;\n+\n+    const computedFilters: Partial<Record<TIssueParams, undefined | string[] | boolean | string>> = {\n+      order_by: displayFilters?.order_by || undefined,\n+      group_by: displayFilters?.group_by ? EIssueGroupByToServerOptions[displayFilters.group_by] : undefined,\n+    };\n+\n+    const issueFiltersParams: Partial<Record<TIssueParams, boolean | string>> = {};\n+    Object.keys(computedFilters).forEach((key) => {\n+      const _key = key as TIssueParams;\n+      const _value: string | boolean | string[] | undefined = computedFilters[_key];\n+      const nonEmptyArrayValue = Array.isArray(_value) && _value.length === 0 ? undefined : _value;\n+      if (nonEmptyArrayValue != undefined)\n+        issueFiltersParams[_key] = Array.isArray(nonEmptyArrayValue)\n+          ? nonEmptyArrayValue.join(\",\")\n+          : nonEmptyArrayValue;\n+    });\n+\n+    return issueFiltersParams;\n+  };\n+\n+  /**\n+   * @description This method is used to update the sub issue filters\n+   * @param projectId\n+   * @param filterType\n+   * @param filters\n+   */\n+  updateSubIssueFilters = async (\n+    workspaceSlug: string,\n+    projectId: string,\n+    filterType: EIssueFilterType,\n+    filters: IIssueDisplayFilterOptions | IIssueDisplayProperties,\n+    parentId: string\n+  ) => {\n+    const _filters = this.getSubIssueFilters(parentId);\n+    switch (filterType) {\n+      case EIssueFilterType.DISPLAY_FILTERS: {\n+        set(this.subIssueFiltersMap, [parentId, \"displayFilters\"], { ..._filters.displayFilters, ...filters });\n+        this.subIssueStore.fetchSubIssues(workspaceSlug, projectId, parentId);\n+        break;\n+      }\n+      case EIssueFilterType.DISPLAY_PROPERTIES:\n+        set(this.subIssueFiltersMap, [parentId, \"displayProperties\"], {\n+          ..._filters.displayProperties,\n+          ...filters,\n+        });\n+        break;\n+    }\n+  };\n+}\n"
        }
      ]
    }
  ]
}