{
  "error": "Tool `read_files` is not currently available. Make sure to only use tools listed in the system instructions.",
  "trace": [
    {
      "type": "start",
      "messageHistoryLength": 0
    },
    {
      "type": "tool_call",
      "toolCallId": "1822b996-bb36-4ccc-bd13-c18400ac6b1e",
      "toolName": "spawn_agent_inline",
      "input": {
        "agent_type": "context-pruner",
        "params": {}
      },
      "agentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "1822b996-bb36-4ccc-bd13-c18400ac6b1e",
      "toolName": "spawn_agent_inline",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Agent spawned."
          }
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "D-Oe9G8zl9M",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "read_subtree",
            "params": {
              "paths": [
                ".agents"
              ],
              "maxTokens": 8000
            }
          },
          {
            "agent_type": "read_subtree",
            "params": {
              "paths": [
                ".agents/examples"
              ],
              "maxTokens": 4000
            }
          },
          {
            "agent_type": "file-picker",
            "params": {
              "prompt": "agent builder, agent creation, scaffolding custom agents, agent templates"
            }
          },
          {
            "agent_type": "file-picker",
            "params": {
              "prompt": "diff-reviewer agent examples and configurations"
            }
          },
          {
            "agent_type": "file-picker",
            "params": {
              "prompt": "your-custom-agent starter template or git-committer agent"
            }
          },
          {
            "agent_type": "file-picker",
            "params": {
              "prompt": "agent personas, list of agent personalities or types"
            }
          },
          {
            "agent_type": "file-picker",
            "params": {
              "prompt": "file-explorer agent definition and spawn target"
            }
          },
          {
            "agent_type": "code-searcher",
            "params": {
              "searchQueries": [
                {
                  "pattern": "diff-reviewer"
                },
                {
                  "pattern": "your-custom-agent"
                },
                {
                  "pattern": "spawnable agents|spawnAgents"
                },
                {
                  "pattern": "agent builder|agentBuilder"
                },
                {
                  "pattern": "agent personas|agentPersonas"
                }
              ]
            }
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-OfY8_NY2s",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "prompt": "agent builder, agent creation, scaffolding custom agents, agent templates"
      }
    },
    {
      "type": "subagent_start",
      "agentId": "D-OfY_tExks",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "prompt": "diff-reviewer agent examples and configurations"
      }
    },
    {
      "type": "subagent_start",
      "agentId": "D-OfaYSx8-Q",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "prompt": "your-custom-agent starter template or git-committer agent"
      }
    },
    {
      "type": "subagent_start",
      "agentId": "D-OfaV526OE",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "prompt": "agent personas, list of agent personalities or types"
      }
    },
    {
      "type": "subagent_start",
      "agentId": "D-OfaehVPQw",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "prompt": "file-explorer agent definition and spawn target"
      }
    },
    {
      "type": "subagent_start",
      "agentId": "D-Ofa741I0M",
      "agentType": "code-searcher",
      "displayName": "Code Searcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "searchQueries": [
          {
            "pattern": "diff-reviewer"
          },
          {
            "pattern": "your-custom-agent"
          },
          {
            "pattern": "spawnable agents|spawnAgents"
          },
          {
            "pattern": "agent builder|agentBuilder"
          },
          {
            "pattern": "agent personas|agentPersonas"
          }
        ]
      }
    },
    {
      "type": "tool_call",
      "toolCallId": "877e5ab3-210d-4cf9-84e6-267e388d68ad",
      "toolName": "code_search",
      "input": {
        "pattern": "diff-reviewer"
      },
      "agentId": "D-Ofa741I0M",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "3c204c3d-25bd-4014-b0b9-935f91f963e5",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "file-lister",
            "prompt": "",
            "params": {
              "prompt": "agent personas, list of agent personalities or types"
            }
          }
        ]
      },
      "agentId": "D-OfaV526OE",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-OgGtcToUQ",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-OfaV526OE",
      "prompt": "",
      "params": {
        "prompt": "agent personas, list of agent personalities or types"
      }
    },
    {
      "type": "tool_call",
      "toolCallId": "b8a5729e-8e1d-4629-9a40-03ed7cd2ac40",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "file-lister",
            "prompt": "",
            "params": {
              "prompt": "file-explorer agent definition and spawn target"
            }
          }
        ]
      },
      "agentId": "D-OfaehVPQw",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-OgWSwaG9Q",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-OfaehVPQw",
      "prompt": "",
      "params": {
        "prompt": "file-explorer agent definition and spawn target"
      }
    },
    {
      "type": "tool_call",
      "toolCallId": "d5d9bf34-0e52-49e8-97f8-330da68aa9a2",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "file-lister",
            "prompt": "",
            "params": {
              "prompt": "diff-reviewer agent examples and configurations"
            }
          }
        ]
      },
      "agentId": "D-OfY_tExks",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-OgbZG1Kis",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-OfY_tExks",
      "prompt": "",
      "params": {
        "prompt": "diff-reviewer agent examples and configurations"
      }
    },
    {
      "type": "tool_call",
      "toolCallId": "e359f44e-929f-499e-9245-d0f00b579a3c",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "file-lister",
            "prompt": "",
            "params": {
              "prompt": "agent builder, agent creation, scaffolding custom agents, agent templates"
            }
          }
        ]
      },
      "agentId": "D-OfY8_NY2s",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-OgiVqb-lc",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-OfY8_NY2s",
      "prompt": "",
      "params": {
        "prompt": "agent builder, agent creation, scaffolding custom agents, agent templates"
      }
    },
    {
      "type": "tool_call",
      "toolCallId": "5fb459f2-3aca-4499-b719-39696556c4d8",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "file-lister",
            "prompt": "",
            "params": {
              "prompt": "your-custom-agent starter template or git-committer agent"
            }
          }
        ]
      },
      "agentId": "D-OfaYSx8-Q",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-Ogo19lSyI",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-OfaYSx8-Q",
      "prompt": "",
      "params": {
        "prompt": "your-custom-agent starter template or git-committer agent"
      }
    },
    {
      "type": "tool_call",
      "toolCallId": "4f170aca-9b8d-4fce-a6b7-ada8261923fc",
      "toolName": "read_subtree",
      "input": {
        "paths": [],
        "maxTokens": 500000
      },
      "agentId": "D-OgGtcToUQ",
      "parentAgentId": "D-OfaV526OE",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "4f170aca-9b8d-4fce-a6b7-ada8261923fc",
      "toolName": "read_subtree",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": ".",
              "type": "directory",
              "printedTree": ".agents/\n examples/\n  diff-reviewer-1.ts\n  diff-reviewer-2.ts\n  diff-reviewer-3.ts\n opensource/\n  base.ts\n  coder.ts\n  file-picker.ts\n  researcher.ts\n  reviewer.ts\n  thinker.ts\n ask.ts\n base-experimental.ts\n base-lite.ts\n base-max.ts\n base.ts\n brainstormer.ts\n changes-reviewer.ts\n charles.ts\n claude4-gemini-thinking.ts\n constants.ts\n file-explorer.ts\n file-picker.ts\n git-committer.ts\n knowledge-keeper.ts\n planner.ts\n researcher.ts\n reviewer.ts\n superagent.ts\n thinker.ts\n.bin/\n bun\n.github/\n workflows/\n  ci.yml\n  evals.yml\n  nightly-evals.yml\n  npm-app-release-build.yml\n  npm-app-release-prod.yml\n  npm-app-release-staging.yml\n .gitignore\n CODEOWNERS\n knowledge.md\n.vscode/\n settings.json\nbackend/\n src/\n  __tests__/\n   test-data/\n    dex-go/\n     edit-snippet.go\n     expected.go\n     original.go\n   agent-id-resolution.test.ts\n   agent-registry.test.ts\n   auto-topup.test.ts\n   credit-conversion.test.ts\n   fast-rewrite.test.ts\n   generate-diffs-prompt.test.ts\n   get-custom-file-picker-config.test.ts\n   live-user-inputs.test.ts\n   loop-agent-steps.test.ts\n   main-prompt.integration.test.ts\n   main-prompt.test.ts\n   process-file-block.test.ts\n   process-str-replace.test.ts\n   read-docs-tool.test.ts\n   request-files-prompt.test.ts\n   run-agent-step-tools.test.ts\n   run-programmatic-step.test.ts\n   sandbox-generator.test.ts\n   subagent-streaming.test.ts\n   test-utils.ts\n   tool-call-schema.test.ts\n   usage-calculation.test.ts\n   web-search-tool.test.ts\n   xml-stream-parser.test.ts\n  admin/\n   grade-runs.ts\n   relabelRuns.ts\n  api/\n   org.ts\n   usage.ts\n  context/\n   app-context.ts\n  find-files/\n   check-new-files-necessary.ts\n   custom-file-picker-config.ts\n   request-files-prompt.ts\n  llm-apis/\n   __tests__/\n    linkup-api.test.ts\n   vercel-ai-sdk/\n    ai-sdk.ts\n    openrouter.ts\n    vertex-finetuned.ts\n   claude.ts\n   context7-api.ts\n   gemini-with-fallbacks.ts\n   knowledge.md\n   linkup-api.ts\n   message-cost-tracker.ts\n   openai-api.ts\n   openrouter.ts\n   relace-api.ts\n  system-prompt/\n   agent-instructions.md\n   prompts.ts\n   save-agent-request.ts\n   search-system-prompt.ts\n   truncate-file-tree.ts\n  templates/\n   agents/\n    archive/\n     dry-run.ts\n    agent-builder.ts\n    ask.ts\n    base.ts\n    file-explorer.ts\n    file-picker.ts\n    planner.ts\n    researcher.ts\n    reviewer.ts\n    superagent.ts\n    thinker.ts\n    thinking-base.ts\n   agent-list.ts\n   agent-registry.ts\n   ask-prompts.ts\n   base-prompts.ts\n   prompts.ts\n   README.md\n   strings.ts\n   types.ts\n  tools/\n   definitions/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    list.ts\n    tool-def-type.ts\n   handlers/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    handler-function-type.ts\n    list.ts\n   constants.ts\n   prompts.ts\n   stream-parser.ts\n   tool-executor.ts\n  util/\n   __tests__/\n    messages.test.ts\n    object.test.ts\n    parse-tool-call-xml.test.ts\n    simplify-tool-results.test.ts\n    split-data.test.ts\n   check-auth.ts\n   debug.ts\n   file-resolver.ts\n   logger.ts\n   messages.ts\n   object.ts\n   parse-tool-call-xml.ts\n   quickjs-sandbox.ts\n   simplify-tool-results.ts\n   split-data.ts\n   token-counter.ts\n  websockets/\n   auth.ts\n   middleware.ts\n   request-context.ts\n   server.ts\n   switchboard.ts\n   websocket-action.ts\n  async-agent-manager.ts\n  check-terminal-command.ts\n  fast-rewrite.ts\n  generate-diffs-prompt.ts\n  get-documentation-for-query.ts\n  get-file-reading-updates.ts\n  index.ts\n  live-user-inputs.ts\n  loop-main-prompt.ts\n  main-prompt.ts\n  process-file-block.ts\n  process-str-replace.ts\n  prompt-agent-stream.ts\n  run-agent-step.ts\n  run-programmatic-step.ts\n  xml-stream-parser.ts\n .gitignore\n knowledge.md\n package.json\n README.md\n tsconfig.json\ncommon/\n src/\n  __tests__/\n   agent-validation.test.ts\n   dynamic-agent-template-schema.test.ts\n   handlesteps-parsing.test.ts\n  api-keys/\n   constants.ts\n   crypto.ts\n  constants/\n   agents.ts\n   analytics-events.ts\n   grant-priorities.ts\n  db/\n   migrations/\n    meta/\n     _journal.json\n     0000_snapshot.json\n     0001_snapshot.json\n     0002_snapshot.json\n     0003_snapshot.json\n     0004_snapshot.json\n     0005_snapshot.json\n     0006_snapshot.json\n     0007_snapshot.json\n     0008_snapshot.json\n     0009_snapshot.json\n     0010_snapshot.json\n     0011_snapshot.json\n     0012_snapshot.json\n     0013_snapshot.json\n     0014_snapshot.json\n     0015_snapshot.json\n     0016_snapshot.json\n     0017_snapshot.json\n     0018_snapshot.json\n     0019_snapshot.json\n     0020_snapshot.json\n     0021_snapshot.json\n     0026_snapshot.json\n     0027_snapshot.json\n     0028_snapshot.json\n    0000_overjoyed_thing.sql\n    0001_fuzzy_typhoid_mary.sql\n    0002_sticky_dormammu.sql\n    0003_military_owl.sql\n    0004_neat_pet_avengers.sql\n    0005_minor_the_professor.sql\n    0006_first_quasimodo.sql\n    0007_equal_warlock.sql\n    0008_puzzling_carnage.sql\n    0009_bitter_rumiko_fujikawa.sql\n    0010_overjoyed_red_skull.sql\n    0011_familiar_ezekiel_stane.sql\n    0012_fluffy_naoko.sql\n    0013_famous_risque.sql\n    0014_wakeful_sinister_six.sql\n    0015_stormy_zuras.sql\n    0016_clear_hairball.sql\n    0017_tricky_randall_flagg.sql\n    0018_stale_human_robot.sql\n    0019_amused_nebula.sql\n    0020_young_sleeper.sql\n    0021_tiny_marauders.sql\n    0026_chilly_mockingbird.sql\n    0027_sloppy_quasar.sql\n    0028_lush_johnny_blaze.sql\n   docker-compose.yml\n   drizzle.config.ts\n   index.ts\n   schema.knowledge.md\n   schema.ts\n   transaction.ts\n  json-config/\n   __tests__/\n    __snapshots__/\n     stringify-schema.test.ts.snap\n    constants.test.ts\n    stringify-schema.test.ts\n   constants.ts\n   default.ts\n   stringify-schema.ts\n  templates/\n   agent-validation.ts\n   dynamic-agent-functions.ts\n  testing/\n   mock-modules.ts\n  tools/\n   params/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n   compile-tool-definitions.ts\n   constants.ts\n   list.ts\n   utils.ts\n  types/\n   __tests__/\n    dynamic-agent-template.test.ts\n   api/\n    agents/\n     publish.ts\n   agent-template.ts\n   dynamic-agent-template.ts\n   grant.ts\n   message.ts\n   organization.ts\n   print-mode.ts\n   publisher.ts\n   referral.ts\n   session-state.ts\n   usage.ts\n  util/\n   __tests__/\n    messages.test.ts\n    partial-json-delta.test.ts\n    saxy.test.ts\n    string.test.ts\n   examples/\n    diff-reviewer-1.ts\n    diff-reviewer-2.ts\n    diff-reviewer-3.ts\n   agent-file-utils.ts\n   agent-name-normalization.ts\n   agent-name-resolver.ts\n   agent-template-validation.ts\n   array.ts\n   changes.ts\n   credentials.ts\n   currency.ts\n   dates.ts\n   error.ts\n   file.ts\n   git.ts\n   logger.ts\n   lru-cache.ts\n   messages.ts\n   min-heap.ts\n   model-utils.ts\n   object.ts\n   partial-json-delta.ts\n   patch.ts\n   promise.ts\n   random.ts\n   referral.ts\n   saxy.ts\n   string.knowledge.md\n   string.ts\n   stripe.ts\n   sync-failure.ts\n   xml.ts\n   zod-schema.ts\n  websockets/\n   websocket-client.ts\n   websocket-schema.ts\n  actions.ts\n  analytics.ts\n  browser-actions.ts\n  constants.ts\n  project-file-tree.ts\n knowledge.md\n package.json\n tsconfig.json\nevals/\n git-evals/\n  email-eval-results.ts\n  eval-levelcode.json\n  eval-manifold.json\n  eval-result-levelcode-mock.json\n  gen-evals.ts\n  judge-git-eval.ts\n  post-eval-analysis.ts\n  run-eval-set.ts\n  run-git-evals.ts\n  run-single-eval-process.ts\n  run-single-eval.ts\n  setup-test-repo.ts\n  types.ts\n .gitignore\n bun.lock\n constants.ts\n e2e-cat-app-script.ts\n knowledge.md\n package.json\n scaffolding.ts\n swe-bench-eval.ts\n swe-bench-ids.ts\n swe-bench.test.ts\n test-repos.json\n test-setup.ts\n tsconfig.json\nnpm-app/\n release/\n  index.js\n  package.json\n  README.md\n release-staging/\n  index.js\n  package.json\n  README.md\n scripts/\n  build-binary.js\n  generate-github-token.ts\n  patch-web-tree-sitter.ts\n  release.js\n  twitch-plays-levelcode.sh\n src/\n  __tests__/\n   display.test.ts\n   tool-handlers.test.ts\n  agents/\n   agent-utils.ts\n   load-agents.ts\n  checkpoints/\n   checkpoint-manager.ts\n   file-manager.ts\n  cli-handlers/\n   agent-creation-chat.ts\n   agents.ts\n   api-key.ts\n   checkpoint.ts\n   diff.ts\n   easter-egg.ts\n   inititalization-flow.ts\n   mini-chat.ts\n   publish.ts\n   subagent-list.ts\n   subagent.ts\n  display/\n   overrides.ts\n   print-mode.ts\n   squash-newlines.ts\n  json-config/\n   hooks.ts\n   parser.ts\n  native/\n   ripgrep.ts\n  terminal/\n   background.ts\n   run-command.ts\n  utils/\n   __tests__/\n    __snapshots__/\n     background-process-manager.test.ts.snap\n     frustration-detector.test.ts.snap\n     rage-detector.test.ts.snap\n     xml-stream-parser.test.ts.snap\n    background-process-manager.test.ts\n    rage-detector.test.ts\n    response-example-4-files.txt\n    tool-renderers.test.ts\n    xml-stream-parser.test.ts\n   agent-validation.ts\n   analytics.ts\n   detect-shell.ts\n   git.ts\n   logger.ts\n   rage-detector.ts\n   spinner.ts\n   suppress-console.ts\n   system-info.ts\n   terminal.ts\n   tool-renderers.ts\n   with-hang-detection.ts\n   xml-stream-parser.ts\n  workers/\n   checkpoint-worker.ts\n   project-context.ts\n  background-process-manager.ts\n  browser-runner.ts\n  chat-storage.ts\n  cli-definitions.ts\n  cli.ts\n  client.ts\n  config.ts\n  create-template-project.ts\n  credentials.ts\n  dev-process-manager.ts\n  diff-manager.ts\n  fingerprint.ts\n  index.ts\n  menu.ts\n  project-files.ts\n  rage-detectors.ts\n  startup-process-handler.ts\n  subagent-storage.ts\n  tool-handlers.ts\n  types.ts\n  web-scraper.ts\n .gitignore\n bunfig.toml\n package.json\n tsconfig.json\npackages/\n bigquery/\n  src/\n   client.ts\n   index.ts\n   schema.ts\n  knowledge.md\n  package.json\n  tsconfig.json\n billing/\n  src/\n   __tests__/\n    credit-delegation.test.ts\n    extract-owner-repo.test.ts\n    org-billing.test.ts\n   auto-topup.ts\n   balance-calculator.ts\n   billing.knowledge.md\n   conversion.ts\n   credit-delegation.ts\n   grant-credits.knowledge.md\n   grant-credits.ts\n   index.ts\n   org-billing.ts\n   org-monitoring.ts\n   usage-service.ts\n   utils.ts\n  knowledge.md\n  package.json\n  project.json\n  tsconfig.json\n build-tools/\n  executors/\n   infisical-run/\n    executor.ts\n    schema.json\n  executors.json\n  package.json\n  project.json\n  tsconfig.json\n code-map/\n  __tests__/\n   test-langs/\n    test.c\n    test.cpp\n    test.cs\n    test.go\n    test.java\n    test.js\n    test.php\n    test.py\n    test.rb\n    test.rs\n    test.ts\n   languages.test.ts\n   parse.test.ts\n  src/\n   tree-sitter-queries/\n    readme.md\n    tree-sitter-c_sharp-tags.scm\n    tree-sitter-c-tags.scm\n    tree-sitter-cpp-tags.scm\n    tree-sitter-go-tags.scm\n    tree-sitter-java-tags.scm\n    tree-sitter-javascript-tags.scm\n    tree-sitter-php-tags.scm\n    tree-sitter-python-tags.scm\n    tree-sitter-ruby-tags.scm\n    tree-sitter-rust-tags.scm\n    tree-sitter-typescript-tags.scm\n   index.ts\n   languages.ts\n   parse.ts\n  package.json\n  tsconfig.json\n internal/\n  src/\n   loops/\n    client.ts\n    index.ts\n    types.ts\n   openrouter-ai-sdk/\n    internal/\n     index.ts\n    schemas/\n     reasoning-details.ts\n    types/\n     index.ts\n     openrouter-chat-completions-input.ts\n     openrouter-chat-settings.ts\n    .gitignore\n    convert-to-openrouter-chat-messages.test.ts\n    convert-to-openrouter-chat-messages.ts\n    convert-to-openrouter-completion-prompt.ts\n    index.ts\n    map-openrouter-chat-logprobs.ts\n    map-openrouter-completion-logprobs.ts\n    map-openrouter-finish-reason.ts\n    openrouter-chat-language-model.test.ts\n    openrouter-chat-language-model.ts\n    openrouter-completion-language-model.test.ts\n    openrouter-completion-language-model.ts\n    openrouter-completion-settings.ts\n    openrouter-error.ts\n    openrouter-facade.ts\n    openrouter-provider-options.test.ts\n    openrouter-provider.ts\n    openrouter-stream-usage-accounting.test.ts\n    openrouter-usage-accounting.test.ts\n   utils/\n    __tests__/\n     version-utils.test.ts\n    auth.ts\n    version-utils.ts\n    xml-parser.ts\n   env.ts\n   index.ts\n   knowledge.md\n  package.json\n  tsconfig.json\npython-app/\n src/\n  levelcode/\n   __init__.py\n .gitignore\n knowledge.md\n LICENSE\n pyproject.toml\n README.md\nscripts/\n changelog/\n  2025-05-18-version-10283-release-enhanced-assistant-experience-system-stability.mdx\n  2025-05-25-version-10295-enhanced-ai-models-and-user-experience-improvements.mdx\n  2025-06-01-version-10305-release-enhanced-ai-models-new-commands-and-performance-improvements.mdx\n  docs.json\n ft-file-selection/\n  .gitignore\n  collect-tuning-data.ts\n  grade-traces.ts\n  print-recent-relabels.ts\n  print-recent-traces.ts\n  README.md\n  relabel-for-offline-scoring.ts\n  relabel-traces-with-context.ts\n  relabel-traces.ts\n .gitignore\n analyze-edit-blocks.ts\n analyze-model-usage.ts\n apply-credit-migration.ts\n calculate-average-spend.ts\n calculate-dau.ts\n calculate-monthly-usage.ts\n calculate-mrr.ts\n calculate-weekly-usage.ts\n cleanup-worktree.sh\n convert-escaped-newlines.ts\n count-edit-file.ts\n debug-log-subset.ts\n dev.sh\n export-user-emails.ts\n generate-ci-env.js\n generate-tool-definitions.ts\n get-changelog.ts\n init-worktree.ts\n package.json\n tsconfig.json\n update-stripe-subscriptions.ts\nsdk/\n scripts/\n  publish.js\n src/\n  tools/\n   change-file.ts\n   read-files.ts\n  types/\n   agent-definition.ts\n   tools.ts\n  client.ts\n  constants.ts\n  index.ts\n  process-stream.ts\n  websocket-client.ts\n .npmignore\n CHANGELOG.md\n package.json\n PUBLISHING.md\n README.md\n tsconfig.json\nweb/\n public/\n  levelcode-intro1.webm\n scripts/\n  discord/\n   index.ts\n   register-commands.ts\n src/\n  __tests__/\n   e2e/\n    home.spec.ts\n   unit/\n    home.spec.tsx\n  actions/\n   hello-action.ts\n  app/\n   [sponsee]/\n    page.tsx\n   admin/\n    file-picker/\n     page.tsx\n    orgs/\n     page.tsx\n    traces/\n     components/\n      chat-message.tsx\n      client-session-viewer.tsx\n      empty-state.tsx\n      error-boundary.tsx\n      loading-skeletons.tsx\n      timeline-chart.module.css\n      timeline-chart.tsx\n      trace-viewer.tsx\n     utils/\n      __tests__/\n       trace-processing.test.ts\n      trace-processing.ts\n     page.tsx\n    layout.tsx\n   affiliates/\n    actions.ts\n    page.tsx\n   agents/\n    page.tsx\n   api/\n    admin/\n     orgs/\n      [orgId]/\n       features/\n        [feature]/\n         route.ts\n      export/\n       route.ts\n      route.ts\n     relabel-for-user/\n      route.ts\n     traces/\n      [clientRequestId]/\n       messages/\n        route.ts\n       timeline/\n        route.ts\n      client/\n       [clientId]/\n        sessions/\n         route.ts\n     admin-auth.ts\n    agents/\n     [publisherId]/\n      [agentId]/\n       [version]/\n        route.ts\n       latest/\n        route.ts\n     publish/\n      route.ts\n     validate/\n      route.ts\n     route.ts\n    api-keys/\n     route.ts\n    auth/\n     [...nextauth]/\n      auth-options.ts\n      route.ts\n     cli/\n      code/\n       route.ts\n      logout/\n       route.ts\n      status/\n       route.ts\n    feed/\n     route.ts\n    git-evals/\n     visibility/\n      route.ts\n     route.ts\n    healthz/\n     route.ts\n    invites/\n     [token]/\n      route.ts\n    orgs/\n     [orgId]/\n      alerts/\n       [alertId]/\n        dismiss/\n         route.ts\n       route.ts\n      analytics/\n       export/\n        route.ts\n       route.ts\n      billing/\n       setup/\n        route.ts\n       status/\n        route.ts\n       subscription/\n        route.ts\n      credits/\n       route.ts\n      invitations/\n       [email]/\n        resend/\n         route.ts\n        route.ts\n       bulk/\n        route.ts\n       route.ts\n      members/\n       [userId]/\n        route.ts\n       route.ts\n      monitoring/\n       route.ts\n      publishers/\n       route.ts\n      repos/\n       [repoId]/\n        route.ts\n       route.ts\n      settings/\n       route.ts\n      usage/\n       export/\n        route.ts\n       route.ts\n      route.ts\n     slug/\n      [slug]/\n       route.ts\n     route.ts\n    publishers/\n     [id]/\n      organization/\n       route.ts\n     validate/\n      route.ts\n     route.ts\n    referrals/\n     [code]/\n      route.ts\n     helpers.ts\n     route.ts\n    stripe/\n     buy-credits/\n      route.ts\n     webhook/\n      route.ts\n    upload/\n     avatar/\n      route.ts\n    user/\n     auto-topup/\n      route.ts\n     profile/\n      route.ts\n     usage/\n      route.ts\n   config/\n    page.tsx\n   docs/\n    [category]/\n     layout.tsx\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   evals/\n    evals-table.tsx\n    page.tsx\n   invites/\n    [token]/\n     page.tsx\n   login/\n    page.tsx\n   onboard/\n    page.tsx\n   orgs/\n    [slug]/\n     analytics/\n      page.tsx\n     billing/\n      purchase/\n       page.tsx\n      setup/\n       page.tsx\n     repositories/\n      page.tsx\n     settings/\n      page.tsx\n     team/\n      page.tsx\n     usage/\n      page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   payment-success/\n    page.tsx\n   pricing/\n    page.tsx\n   privacy-policy/\n    page.tsx\n   publishers/\n    [id]/\n     agents/\n      [agentId]/\n       [version]/\n        page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   referrals/\n    [code]/\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   terms-of-service/\n    page.tsx\n   usage/\n    layout.tsx\n    page.tsx\n    usage-display.tsx\n   analytics.knowledge.md\n   layout.tsx\n   page.tsx\n   robots.ts\n   sitemap.ts\n  components/\n   agent/\n    json-viewer.tsx\n   auto-topup/\n    AutoTopupSettings.tsx\n    AutoTopupSettingsForm.tsx\n    AutoTopupSwitch.tsx\n    BaseAutoTopupSettings.tsx\n    BaseAutoTopupSettingsForm.tsx\n    BaseAutoTopupSwitch.tsx\n    constants.ts\n    OrgAutoTopupSettings.tsx\n    OrgAutoTopupSettingsForm.tsx\n    OrgAutoTopupSwitch.tsx\n    types.ts\n   credits/\n    CreditManagementSection.tsx\n    CreditPurchaseSection.tsx\n   docs/\n    mdx/\n     code-demo.tsx\n     custom-link.tsx\n     markdown-table.tsx\n     mdx-components.tsx\n     mermaid-diagram.tsx\n     schema-display.tsx\n    copy-heading.tsx\n    doc-sidebar.tsx\n    docs.knowledge.md\n    toc.tsx\n   login/\n    login-card.tsx\n    login-client-wrapper.tsx\n   navbar/\n    navbar.tsx\n    user-dropdown.tsx\n   organization/\n    advanced-monitor.tsx\n    billing-alerts.tsx\n    billing-reports.tsx\n    billing-status.tsx\n    credit-monitor.tsx\n    model-config-sheet.tsx\n    organization-success-modal.tsx\n    repository-management.tsx\n    team-management.tsx\n   providers/\n    query-client-provider.tsx\n   publisher/\n    basic-info-step.tsx\n    ownership-step.tsx\n    profile-details-step.tsx\n    step-template.tsx\n   sign-in/\n    sign-in-button.tsx\n    sign-in-card-footer.tsx\n   ui/\n    landing/\n     competition/\n      claude-code.tsx\n      cline.tsx\n      cursor.tsx\n      github-copilot.tsx\n      index.tsx\n      tabs.tsx\n     feature/\n      browser-comparison.tsx\n      chart-illustration.tsx\n      code-illustration.tsx\n      highlight-text.tsx\n      index.tsx\n      workflow-illustration.tsx\n     animated-element.tsx\n     constants.ts\n     cta-section.tsx\n     demo-code-display.tsx\n     testimonials-section.tsx\n     types.ts\n    terminal/\n     index.tsx\n     style.css\n     terminal-input.tsx\n     terminal-output.tsx\n    avatar-upload.tsx\n    background-beams.tsx\n    badge.tsx\n    banner.tsx\n    button.tsx\n    card.tsx\n    collapsible.tsx\n    credit-confetti.tsx\n    decorative-blocks.tsx\n    dialog.tsx\n    dropdown-menu.tsx\n    enhanced-copy-button.tsx\n    footer.tsx\n    hero-buttons.tsx\n    hero.tsx\n    input.tsx\n    install-dialog.tsx\n    label.tsx\n    neon-gradient-button.tsx\n    progress.tsx\n    radio-group.tsx\n    section.tsx\n    select.tsx\n    separator.tsx\n    sheet.tsx\n    sidebar.tsx\n    skeleton-loading.tsx\n    skeleton.tsx\n    slider.tsx\n    switch.tsx\n    table.tsx\n    tabs.tsx\n    textarea.tsx\n    toast.tsx\n    toaster.tsx\n    tooltip.tsx\n    use-toast.ts\n   BrowserPreview.tsx\n   card-with-beams.tsx\n   CookieConsentCard.tsx\n   footer.tsx\n   icons.tsx\n   IDEDemo.tsx\n   layout-wrapper.tsx\n   TerminalDemo.tsx\n   theme-provider.tsx\n   theme-switcher.tsx\n  content/\n   advanced/\n    claude-code-comparison.mdx\n    config.mdx\n    how-does-it-work.mdx\n    large-projects.mdx\n    troubleshooting.mdx\n    what-models.mdx\n   agents/\n    agent-reference.mdx\n    creating-new-agents.mdx\n    customizing-agents.mdx\n    overview.mdx\n    troubleshooting-agent-customization.mdx\n   case-studies/\n    _cta.mdx\n    benjamin-bryant.mdx\n    oliver-lukesch.mdx\n   help/\n    faq.mdx\n    getting-started.mdx\n   tips/\n    best-practices.mdx\n    keyboard-shortcuts.mdx\n    knowledge-files.mdx\n    other-use-cases.mdx\n    version-control.mdx\n    where-levelcode-shines.mdx\n  discord/\n   client.ts\n   rate-limiter.ts\n  hooks/\n   use-auto-topup.ts\n   use-install-dialog.ts\n   use-mobile.tsx\n   use-model-config.ts\n   use-org-auto-topup.ts\n   use-organization-data.ts\n   use-user-profile.ts\n  lib/\n   server/\n    referral.ts\n   validators/\n    publisher.ts\n   admin-auth.ts\n   constant.ts\n   currency.ts\n   docs.ts\n   fonts.ts\n   organization-permissions.ts\n   PostHogProvider.tsx\n   publisher-permissions.ts\n   remark-code-to-codedemo.ts\n   server-init.ts\n   SessionProvider.tsx\n   stripe-utils.ts\n   testimonials.ts\n   trackConversions.ts\n   utils.ts\n  styles/\n   globals.css\n  types/\n   docs.ts\n   user.ts\n  util/\n   logger.ts\n .eslintignore\n .eslintrc.js\n .gitignore\n .prettierignore\n .prettierrc.js\n commitlint.config.js\n components.json\n contentlayer.config.ts\n jest.config.js\n jest.setup.js\n knowledge.md\n next.config.mjs\n package.json\n playwright.config.ts\n postcss.config.cjs\n README.md\n tailwind.config.ts\n tsconfig.json\n.envrc\n.gitignore\n.infisical.json\n.prettierrc\nauthentication.knowledge.md\nbun.lock\nbunfig.toml\nlevelcode.json\neslint.config.js\nknowledge.md\npackage.json\nREADME.md\ntsconfig.base.json\ntsconfig.json\nWINDOWS.md\n",
              "tokenCount": 9007,
              "truncationLevel": "none"
            }
          ]
        }
      ],
      "parentAgentId": "D-OgGtcToUQ"
    },
    {
      "type": "tool_call",
      "toolCallId": "4d5eb69d-6f5d-4c20-b1c2-51f7bebcc29b",
      "toolName": "read_subtree",
      "input": {
        "paths": [],
        "maxTokens": 500000
      },
      "agentId": "D-OgWSwaG9Q",
      "parentAgentId": "D-OfaehVPQw",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "4d5eb69d-6f5d-4c20-b1c2-51f7bebcc29b",
      "toolName": "read_subtree",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": ".",
              "type": "directory",
              "printedTree": ".agents/\n examples/\n  diff-reviewer-1.ts\n  diff-reviewer-2.ts\n  diff-reviewer-3.ts\n opensource/\n  base.ts\n  coder.ts\n  file-picker.ts\n  researcher.ts\n  reviewer.ts\n  thinker.ts\n ask.ts\n base-experimental.ts\n base-lite.ts\n base-max.ts\n base.ts\n brainstormer.ts\n changes-reviewer.ts\n charles.ts\n claude4-gemini-thinking.ts\n constants.ts\n file-explorer.ts\n file-picker.ts\n git-committer.ts\n knowledge-keeper.ts\n planner.ts\n researcher.ts\n reviewer.ts\n superagent.ts\n thinker.ts\n.bin/\n bun\n.github/\n workflows/\n  ci.yml\n  evals.yml\n  nightly-evals.yml\n  npm-app-release-build.yml\n  npm-app-release-prod.yml\n  npm-app-release-staging.yml\n .gitignore\n CODEOWNERS\n knowledge.md\n.vscode/\n settings.json\nbackend/\n src/\n  __tests__/\n   test-data/\n    dex-go/\n     edit-snippet.go\n     expected.go\n     original.go\n   agent-id-resolution.test.ts\n   agent-registry.test.ts\n   auto-topup.test.ts\n   credit-conversion.test.ts\n   fast-rewrite.test.ts\n   generate-diffs-prompt.test.ts\n   get-custom-file-picker-config.test.ts\n   live-user-inputs.test.ts\n   loop-agent-steps.test.ts\n   main-prompt.integration.test.ts\n   main-prompt.test.ts\n   process-file-block.test.ts\n   process-str-replace.test.ts\n   read-docs-tool.test.ts\n   request-files-prompt.test.ts\n   run-agent-step-tools.test.ts\n   run-programmatic-step.test.ts\n   sandbox-generator.test.ts\n   subagent-streaming.test.ts\n   test-utils.ts\n   tool-call-schema.test.ts\n   usage-calculation.test.ts\n   web-search-tool.test.ts\n   xml-stream-parser.test.ts\n  admin/\n   grade-runs.ts\n   relabelRuns.ts\n  api/\n   org.ts\n   usage.ts\n  context/\n   app-context.ts\n  find-files/\n   check-new-files-necessary.ts\n   custom-file-picker-config.ts\n   request-files-prompt.ts\n  llm-apis/\n   __tests__/\n    linkup-api.test.ts\n   vercel-ai-sdk/\n    ai-sdk.ts\n    openrouter.ts\n    vertex-finetuned.ts\n   claude.ts\n   context7-api.ts\n   gemini-with-fallbacks.ts\n   knowledge.md\n   linkup-api.ts\n   message-cost-tracker.ts\n   openai-api.ts\n   openrouter.ts\n   relace-api.ts\n  system-prompt/\n   agent-instructions.md\n   prompts.ts\n   save-agent-request.ts\n   search-system-prompt.ts\n   truncate-file-tree.ts\n  templates/\n   agents/\n    archive/\n     dry-run.ts\n    agent-builder.ts\n    ask.ts\n    base.ts\n    file-explorer.ts\n    file-picker.ts\n    planner.ts\n    researcher.ts\n    reviewer.ts\n    superagent.ts\n    thinker.ts\n    thinking-base.ts\n   agent-list.ts\n   agent-registry.ts\n   ask-prompts.ts\n   base-prompts.ts\n   prompts.ts\n   README.md\n   strings.ts\n   types.ts\n  tools/\n   definitions/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    list.ts\n    tool-def-type.ts\n   handlers/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    handler-function-type.ts\n    list.ts\n   constants.ts\n   prompts.ts\n   stream-parser.ts\n   tool-executor.ts\n  util/\n   __tests__/\n    messages.test.ts\n    object.test.ts\n    parse-tool-call-xml.test.ts\n    simplify-tool-results.test.ts\n    split-data.test.ts\n   check-auth.ts\n   debug.ts\n   file-resolver.ts\n   logger.ts\n   messages.ts\n   object.ts\n   parse-tool-call-xml.ts\n   quickjs-sandbox.ts\n   simplify-tool-results.ts\n   split-data.ts\n   token-counter.ts\n  websockets/\n   auth.ts\n   middleware.ts\n   request-context.ts\n   server.ts\n   switchboard.ts\n   websocket-action.ts\n  async-agent-manager.ts\n  check-terminal-command.ts\n  fast-rewrite.ts\n  generate-diffs-prompt.ts\n  get-documentation-for-query.ts\n  get-file-reading-updates.ts\n  index.ts\n  live-user-inputs.ts\n  loop-main-prompt.ts\n  main-prompt.ts\n  process-file-block.ts\n  process-str-replace.ts\n  prompt-agent-stream.ts\n  run-agent-step.ts\n  run-programmatic-step.ts\n  xml-stream-parser.ts\n .gitignore\n knowledge.md\n package.json\n README.md\n tsconfig.json\ncommon/\n src/\n  __tests__/\n   agent-validation.test.ts\n   dynamic-agent-template-schema.test.ts\n   handlesteps-parsing.test.ts\n  api-keys/\n   constants.ts\n   crypto.ts\n  constants/\n   agents.ts\n   analytics-events.ts\n   grant-priorities.ts\n  db/\n   migrations/\n    meta/\n     _journal.json\n     0000_snapshot.json\n     0001_snapshot.json\n     0002_snapshot.json\n     0003_snapshot.json\n     0004_snapshot.json\n     0005_snapshot.json\n     0006_snapshot.json\n     0007_snapshot.json\n     0008_snapshot.json\n     0009_snapshot.json\n     0010_snapshot.json\n     0011_snapshot.json\n     0012_snapshot.json\n     0013_snapshot.json\n     0014_snapshot.json\n     0015_snapshot.json\n     0016_snapshot.json\n     0017_snapshot.json\n     0018_snapshot.json\n     0019_snapshot.json\n     0020_snapshot.json\n     0021_snapshot.json\n     0026_snapshot.json\n     0027_snapshot.json\n     0028_snapshot.json\n    0000_overjoyed_thing.sql\n    0001_fuzzy_typhoid_mary.sql\n    0002_sticky_dormammu.sql\n    0003_military_owl.sql\n    0004_neat_pet_avengers.sql\n    0005_minor_the_professor.sql\n    0006_first_quasimodo.sql\n    0007_equal_warlock.sql\n    0008_puzzling_carnage.sql\n    0009_bitter_rumiko_fujikawa.sql\n    0010_overjoyed_red_skull.sql\n    0011_familiar_ezekiel_stane.sql\n    0012_fluffy_naoko.sql\n    0013_famous_risque.sql\n    0014_wakeful_sinister_six.sql\n    0015_stormy_zuras.sql\n    0016_clear_hairball.sql\n    0017_tricky_randall_flagg.sql\n    0018_stale_human_robot.sql\n    0019_amused_nebula.sql\n    0020_young_sleeper.sql\n    0021_tiny_marauders.sql\n    0026_chilly_mockingbird.sql\n    0027_sloppy_quasar.sql\n    0028_lush_johnny_blaze.sql\n   docker-compose.yml\n   drizzle.config.ts\n   index.ts\n   schema.knowledge.md\n   schema.ts\n   transaction.ts\n  json-config/\n   __tests__/\n    __snapshots__/\n     stringify-schema.test.ts.snap\n    constants.test.ts\n    stringify-schema.test.ts\n   constants.ts\n   default.ts\n   stringify-schema.ts\n  templates/\n   agent-validation.ts\n   dynamic-agent-functions.ts\n  testing/\n   mock-modules.ts\n  tools/\n   params/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n   compile-tool-definitions.ts\n   constants.ts\n   list.ts\n   utils.ts\n  types/\n   __tests__/\n    dynamic-agent-template.test.ts\n   api/\n    agents/\n     publish.ts\n   agent-template.ts\n   dynamic-agent-template.ts\n   grant.ts\n   message.ts\n   organization.ts\n   print-mode.ts\n   publisher.ts\n   referral.ts\n   session-state.ts\n   usage.ts\n  util/\n   __tests__/\n    messages.test.ts\n    partial-json-delta.test.ts\n    saxy.test.ts\n    string.test.ts\n   examples/\n    diff-reviewer-1.ts\n    diff-reviewer-2.ts\n    diff-reviewer-3.ts\n   agent-file-utils.ts\n   agent-name-normalization.ts\n   agent-name-resolver.ts\n   agent-template-validation.ts\n   array.ts\n   changes.ts\n   credentials.ts\n   currency.ts\n   dates.ts\n   error.ts\n   file.ts\n   git.ts\n   logger.ts\n   lru-cache.ts\n   messages.ts\n   min-heap.ts\n   model-utils.ts\n   object.ts\n   partial-json-delta.ts\n   patch.ts\n   promise.ts\n   random.ts\n   referral.ts\n   saxy.ts\n   string.knowledge.md\n   string.ts\n   stripe.ts\n   sync-failure.ts\n   xml.ts\n   zod-schema.ts\n  websockets/\n   websocket-client.ts\n   websocket-schema.ts\n  actions.ts\n  analytics.ts\n  browser-actions.ts\n  constants.ts\n  project-file-tree.ts\n knowledge.md\n package.json\n tsconfig.json\nevals/\n git-evals/\n  email-eval-results.ts\n  eval-levelcode.json\n  eval-manifold.json\n  eval-result-levelcode-mock.json\n  gen-evals.ts\n  judge-git-eval.ts\n  post-eval-analysis.ts\n  run-eval-set.ts\n  run-git-evals.ts\n  run-single-eval-process.ts\n  run-single-eval.ts\n  setup-test-repo.ts\n  types.ts\n .gitignore\n bun.lock\n constants.ts\n e2e-cat-app-script.ts\n knowledge.md\n package.json\n scaffolding.ts\n swe-bench-eval.ts\n swe-bench-ids.ts\n swe-bench.test.ts\n test-repos.json\n test-setup.ts\n tsconfig.json\nnpm-app/\n release/\n  index.js\n  package.json\n  README.md\n release-staging/\n  index.js\n  package.json\n  README.md\n scripts/\n  build-binary.js\n  generate-github-token.ts\n  patch-web-tree-sitter.ts\n  release.js\n  twitch-plays-levelcode.sh\n src/\n  __tests__/\n   display.test.ts\n   tool-handlers.test.ts\n  agents/\n   agent-utils.ts\n   load-agents.ts\n  checkpoints/\n   checkpoint-manager.ts\n   file-manager.ts\n  cli-handlers/\n   agent-creation-chat.ts\n   agents.ts\n   api-key.ts\n   checkpoint.ts\n   diff.ts\n   easter-egg.ts\n   inititalization-flow.ts\n   mini-chat.ts\n   publish.ts\n   subagent-list.ts\n   subagent.ts\n  display/\n   overrides.ts\n   print-mode.ts\n   squash-newlines.ts\n  json-config/\n   hooks.ts\n   parser.ts\n  native/\n   ripgrep.ts\n  terminal/\n   background.ts\n   run-command.ts\n  utils/\n   __tests__/\n    __snapshots__/\n     background-process-manager.test.ts.snap\n     frustration-detector.test.ts.snap\n     rage-detector.test.ts.snap\n     xml-stream-parser.test.ts.snap\n    background-process-manager.test.ts\n    rage-detector.test.ts\n    response-example-4-files.txt\n    tool-renderers.test.ts\n    xml-stream-parser.test.ts\n   agent-validation.ts\n   analytics.ts\n   detect-shell.ts\n   git.ts\n   logger.ts\n   rage-detector.ts\n   spinner.ts\n   suppress-console.ts\n   system-info.ts\n   terminal.ts\n   tool-renderers.ts\n   with-hang-detection.ts\n   xml-stream-parser.ts\n  workers/\n   checkpoint-worker.ts\n   project-context.ts\n  background-process-manager.ts\n  browser-runner.ts\n  chat-storage.ts\n  cli-definitions.ts\n  cli.ts\n  client.ts\n  config.ts\n  create-template-project.ts\n  credentials.ts\n  dev-process-manager.ts\n  diff-manager.ts\n  fingerprint.ts\n  index.ts\n  menu.ts\n  project-files.ts\n  rage-detectors.ts\n  startup-process-handler.ts\n  subagent-storage.ts\n  tool-handlers.ts\n  types.ts\n  web-scraper.ts\n .gitignore\n bunfig.toml\n package.json\n tsconfig.json\npackages/\n bigquery/\n  src/\n   client.ts\n   index.ts\n   schema.ts\n  knowledge.md\n  package.json\n  tsconfig.json\n billing/\n  src/\n   __tests__/\n    credit-delegation.test.ts\n    extract-owner-repo.test.ts\n    org-billing.test.ts\n   auto-topup.ts\n   balance-calculator.ts\n   billing.knowledge.md\n   conversion.ts\n   credit-delegation.ts\n   grant-credits.knowledge.md\n   grant-credits.ts\n   index.ts\n   org-billing.ts\n   org-monitoring.ts\n   usage-service.ts\n   utils.ts\n  knowledge.md\n  package.json\n  project.json\n  tsconfig.json\n build-tools/\n  executors/\n   infisical-run/\n    executor.ts\n    schema.json\n  executors.json\n  package.json\n  project.json\n  tsconfig.json\n code-map/\n  __tests__/\n   test-langs/\n    test.c\n    test.cpp\n    test.cs\n    test.go\n    test.java\n    test.js\n    test.php\n    test.py\n    test.rb\n    test.rs\n    test.ts\n   languages.test.ts\n   parse.test.ts\n  src/\n   tree-sitter-queries/\n    readme.md\n    tree-sitter-c_sharp-tags.scm\n    tree-sitter-c-tags.scm\n    tree-sitter-cpp-tags.scm\n    tree-sitter-go-tags.scm\n    tree-sitter-java-tags.scm\n    tree-sitter-javascript-tags.scm\n    tree-sitter-php-tags.scm\n    tree-sitter-python-tags.scm\n    tree-sitter-ruby-tags.scm\n    tree-sitter-rust-tags.scm\n    tree-sitter-typescript-tags.scm\n   index.ts\n   languages.ts\n   parse.ts\n  package.json\n  tsconfig.json\n internal/\n  src/\n   loops/\n    client.ts\n    index.ts\n    types.ts\n   openrouter-ai-sdk/\n    internal/\n     index.ts\n    schemas/\n     reasoning-details.ts\n    types/\n     index.ts\n     openrouter-chat-completions-input.ts\n     openrouter-chat-settings.ts\n    .gitignore\n    convert-to-openrouter-chat-messages.test.ts\n    convert-to-openrouter-chat-messages.ts\n    convert-to-openrouter-completion-prompt.ts\n    index.ts\n    map-openrouter-chat-logprobs.ts\n    map-openrouter-completion-logprobs.ts\n    map-openrouter-finish-reason.ts\n    openrouter-chat-language-model.test.ts\n    openrouter-chat-language-model.ts\n    openrouter-completion-language-model.test.ts\n    openrouter-completion-language-model.ts\n    openrouter-completion-settings.ts\n    openrouter-error.ts\n    openrouter-facade.ts\n    openrouter-provider-options.test.ts\n    openrouter-provider.ts\n    openrouter-stream-usage-accounting.test.ts\n    openrouter-usage-accounting.test.ts\n   utils/\n    __tests__/\n     version-utils.test.ts\n    auth.ts\n    version-utils.ts\n    xml-parser.ts\n   env.ts\n   index.ts\n   knowledge.md\n  package.json\n  tsconfig.json\npython-app/\n src/\n  levelcode/\n   __init__.py\n .gitignore\n knowledge.md\n LICENSE\n pyproject.toml\n README.md\nscripts/\n changelog/\n  2025-05-18-version-10283-release-enhanced-assistant-experience-system-stability.mdx\n  2025-05-25-version-10295-enhanced-ai-models-and-user-experience-improvements.mdx\n  2025-06-01-version-10305-release-enhanced-ai-models-new-commands-and-performance-improvements.mdx\n  docs.json\n ft-file-selection/\n  .gitignore\n  collect-tuning-data.ts\n  grade-traces.ts\n  print-recent-relabels.ts\n  print-recent-traces.ts\n  README.md\n  relabel-for-offline-scoring.ts\n  relabel-traces-with-context.ts\n  relabel-traces.ts\n .gitignore\n analyze-edit-blocks.ts\n analyze-model-usage.ts\n apply-credit-migration.ts\n calculate-average-spend.ts\n calculate-dau.ts\n calculate-monthly-usage.ts\n calculate-mrr.ts\n calculate-weekly-usage.ts\n cleanup-worktree.sh\n convert-escaped-newlines.ts\n count-edit-file.ts\n debug-log-subset.ts\n dev.sh\n export-user-emails.ts\n generate-ci-env.js\n generate-tool-definitions.ts\n get-changelog.ts\n init-worktree.ts\n package.json\n tsconfig.json\n update-stripe-subscriptions.ts\nsdk/\n scripts/\n  publish.js\n src/\n  tools/\n   change-file.ts\n   read-files.ts\n  types/\n   agent-definition.ts\n   tools.ts\n  client.ts\n  constants.ts\n  index.ts\n  process-stream.ts\n  websocket-client.ts\n .npmignore\n CHANGELOG.md\n package.json\n PUBLISHING.md\n README.md\n tsconfig.json\nweb/\n public/\n  levelcode-intro1.webm\n scripts/\n  discord/\n   index.ts\n   register-commands.ts\n src/\n  __tests__/\n   e2e/\n    home.spec.ts\n   unit/\n    home.spec.tsx\n  actions/\n   hello-action.ts\n  app/\n   [sponsee]/\n    page.tsx\n   admin/\n    file-picker/\n     page.tsx\n    orgs/\n     page.tsx\n    traces/\n     components/\n      chat-message.tsx\n      client-session-viewer.tsx\n      empty-state.tsx\n      error-boundary.tsx\n      loading-skeletons.tsx\n      timeline-chart.module.css\n      timeline-chart.tsx\n      trace-viewer.tsx\n     utils/\n      __tests__/\n       trace-processing.test.ts\n      trace-processing.ts\n     page.tsx\n    layout.tsx\n   affiliates/\n    actions.ts\n    page.tsx\n   agents/\n    page.tsx\n   api/\n    admin/\n     orgs/\n      [orgId]/\n       features/\n        [feature]/\n         route.ts\n      export/\n       route.ts\n      route.ts\n     relabel-for-user/\n      route.ts\n     traces/\n      [clientRequestId]/\n       messages/\n        route.ts\n       timeline/\n        route.ts\n      client/\n       [clientId]/\n        sessions/\n         route.ts\n     admin-auth.ts\n    agents/\n     [publisherId]/\n      [agentId]/\n       [version]/\n        route.ts\n       latest/\n        route.ts\n     publish/\n      route.ts\n     validate/\n      route.ts\n     route.ts\n    api-keys/\n     route.ts\n    auth/\n     [...nextauth]/\n      auth-options.ts\n      route.ts\n     cli/\n      code/\n       route.ts\n      logout/\n       route.ts\n      status/\n       route.ts\n    feed/\n     route.ts\n    git-evals/\n     visibility/\n      route.ts\n     route.ts\n    healthz/\n     route.ts\n    invites/\n     [token]/\n      route.ts\n    orgs/\n     [orgId]/\n      alerts/\n       [alertId]/\n        dismiss/\n         route.ts\n       route.ts\n      analytics/\n       export/\n        route.ts\n       route.ts\n      billing/\n       setup/\n        route.ts\n       status/\n        route.ts\n       subscription/\n        route.ts\n      credits/\n       route.ts\n      invitations/\n       [email]/\n        resend/\n         route.ts\n        route.ts\n       bulk/\n        route.ts\n       route.ts\n      members/\n       [userId]/\n        route.ts\n       route.ts\n      monitoring/\n       route.ts\n      publishers/\n       route.ts\n      repos/\n       [repoId]/\n        route.ts\n       route.ts\n      settings/\n       route.ts\n      usage/\n       export/\n        route.ts\n       route.ts\n      route.ts\n     slug/\n      [slug]/\n       route.ts\n     route.ts\n    publishers/\n     [id]/\n      organization/\n       route.ts\n     validate/\n      route.ts\n     route.ts\n    referrals/\n     [code]/\n      route.ts\n     helpers.ts\n     route.ts\n    stripe/\n     buy-credits/\n      route.ts\n     webhook/\n      route.ts\n    upload/\n     avatar/\n      route.ts\n    user/\n     auto-topup/\n      route.ts\n     profile/\n      route.ts\n     usage/\n      route.ts\n   config/\n    page.tsx\n   docs/\n    [category]/\n     layout.tsx\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   evals/\n    evals-table.tsx\n    page.tsx\n   invites/\n    [token]/\n     page.tsx\n   login/\n    page.tsx\n   onboard/\n    page.tsx\n   orgs/\n    [slug]/\n     analytics/\n      page.tsx\n     billing/\n      purchase/\n       page.tsx\n      setup/\n       page.tsx\n     repositories/\n      page.tsx\n     settings/\n      page.tsx\n     team/\n      page.tsx\n     usage/\n      page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   payment-success/\n    page.tsx\n   pricing/\n    page.tsx\n   privacy-policy/\n    page.tsx\n   publishers/\n    [id]/\n     agents/\n      [agentId]/\n       [version]/\n        page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   referrals/\n    [code]/\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   terms-of-service/\n    page.tsx\n   usage/\n    layout.tsx\n    page.tsx\n    usage-display.tsx\n   analytics.knowledge.md\n   layout.tsx\n   page.tsx\n   robots.ts\n   sitemap.ts\n  components/\n   agent/\n    json-viewer.tsx\n   auto-topup/\n    AutoTopupSettings.tsx\n    AutoTopupSettingsForm.tsx\n    AutoTopupSwitch.tsx\n    BaseAutoTopupSettings.tsx\n    BaseAutoTopupSettingsForm.tsx\n    BaseAutoTopupSwitch.tsx\n    constants.ts\n    OrgAutoTopupSettings.tsx\n    OrgAutoTopupSettingsForm.tsx\n    OrgAutoTopupSwitch.tsx\n    types.ts\n   credits/\n    CreditManagementSection.tsx\n    CreditPurchaseSection.tsx\n   docs/\n    mdx/\n     code-demo.tsx\n     custom-link.tsx\n     markdown-table.tsx\n     mdx-components.tsx\n     mermaid-diagram.tsx\n     schema-display.tsx\n    copy-heading.tsx\n    doc-sidebar.tsx\n    docs.knowledge.md\n    toc.tsx\n   login/\n    login-card.tsx\n    login-client-wrapper.tsx\n   navbar/\n    navbar.tsx\n    user-dropdown.tsx\n   organization/\n    advanced-monitor.tsx\n    billing-alerts.tsx\n    billing-reports.tsx\n    billing-status.tsx\n    credit-monitor.tsx\n    model-config-sheet.tsx\n    organization-success-modal.tsx\n    repository-management.tsx\n    team-management.tsx\n   providers/\n    query-client-provider.tsx\n   publisher/\n    basic-info-step.tsx\n    ownership-step.tsx\n    profile-details-step.tsx\n    step-template.tsx\n   sign-in/\n    sign-in-button.tsx\n    sign-in-card-footer.tsx\n   ui/\n    landing/\n     competition/\n      claude-code.tsx\n      cline.tsx\n      cursor.tsx\n      github-copilot.tsx\n      index.tsx\n      tabs.tsx\n     feature/\n      browser-comparison.tsx\n      chart-illustration.tsx\n      code-illustration.tsx\n      highlight-text.tsx\n      index.tsx\n      workflow-illustration.tsx\n     animated-element.tsx\n     constants.ts\n     cta-section.tsx\n     demo-code-display.tsx\n     testimonials-section.tsx\n     types.ts\n    terminal/\n     index.tsx\n     style.css\n     terminal-input.tsx\n     terminal-output.tsx\n    avatar-upload.tsx\n    background-beams.tsx\n    badge.tsx\n    banner.tsx\n    button.tsx\n    card.tsx\n    collapsible.tsx\n    credit-confetti.tsx\n    decorative-blocks.tsx\n    dialog.tsx\n    dropdown-menu.tsx\n    enhanced-copy-button.tsx\n    footer.tsx\n    hero-buttons.tsx\n    hero.tsx\n    input.tsx\n    install-dialog.tsx\n    label.tsx\n    neon-gradient-button.tsx\n    progress.tsx\n    radio-group.tsx\n    section.tsx\n    select.tsx\n    separator.tsx\n    sheet.tsx\n    sidebar.tsx\n    skeleton-loading.tsx\n    skeleton.tsx\n    slider.tsx\n    switch.tsx\n    table.tsx\n    tabs.tsx\n    textarea.tsx\n    toast.tsx\n    toaster.tsx\n    tooltip.tsx\n    use-toast.ts\n   BrowserPreview.tsx\n   card-with-beams.tsx\n   CookieConsentCard.tsx\n   footer.tsx\n   icons.tsx\n   IDEDemo.tsx\n   layout-wrapper.tsx\n   TerminalDemo.tsx\n   theme-provider.tsx\n   theme-switcher.tsx\n  content/\n   advanced/\n    claude-code-comparison.mdx\n    config.mdx\n    how-does-it-work.mdx\n    large-projects.mdx\n    troubleshooting.mdx\n    what-models.mdx\n   agents/\n    agent-reference.mdx\n    creating-new-agents.mdx\n    customizing-agents.mdx\n    overview.mdx\n    troubleshooting-agent-customization.mdx\n   case-studies/\n    _cta.mdx\n    benjamin-bryant.mdx\n    oliver-lukesch.mdx\n   help/\n    faq.mdx\n    getting-started.mdx\n   tips/\n    best-practices.mdx\n    keyboard-shortcuts.mdx\n    knowledge-files.mdx\n    other-use-cases.mdx\n    version-control.mdx\n    where-levelcode-shines.mdx\n  discord/\n   client.ts\n   rate-limiter.ts\n  hooks/\n   use-auto-topup.ts\n   use-install-dialog.ts\n   use-mobile.tsx\n   use-model-config.ts\n   use-org-auto-topup.ts\n   use-organization-data.ts\n   use-user-profile.ts\n  lib/\n   server/\n    referral.ts\n   validators/\n    publisher.ts\n   admin-auth.ts\n   constant.ts\n   currency.ts\n   docs.ts\n   fonts.ts\n   organization-permissions.ts\n   PostHogProvider.tsx\n   publisher-permissions.ts\n   remark-code-to-codedemo.ts\n   server-init.ts\n   SessionProvider.tsx\n   stripe-utils.ts\n   testimonials.ts\n   trackConversions.ts\n   utils.ts\n  styles/\n   globals.css\n  types/\n   docs.ts\n   user.ts\n  util/\n   logger.ts\n .eslintignore\n .eslintrc.js\n .gitignore\n .prettierignore\n .prettierrc.js\n commitlint.config.js\n components.json\n contentlayer.config.ts\n jest.config.js\n jest.setup.js\n knowledge.md\n next.config.mjs\n package.json\n playwright.config.ts\n postcss.config.cjs\n README.md\n tailwind.config.ts\n tsconfig.json\n.envrc\n.gitignore\n.infisical.json\n.prettierrc\nauthentication.knowledge.md\nbun.lock\nbunfig.toml\nlevelcode.json\neslint.config.js\nknowledge.md\npackage.json\nREADME.md\ntsconfig.base.json\ntsconfig.json\nWINDOWS.md\n",
              "tokenCount": 9007,
              "truncationLevel": "none"
            }
          ]
        }
      ],
      "parentAgentId": "D-OgWSwaG9Q"
    },
    {
      "type": "tool_call",
      "toolCallId": "2ab4337f-6692-4efa-a912-0d2f266b2351",
      "toolName": "read_subtree",
      "input": {
        "paths": [],
        "maxTokens": 500000
      },
      "agentId": "D-OgbZG1Kis",
      "parentAgentId": "D-OfY_tExks",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "2ab4337f-6692-4efa-a912-0d2f266b2351",
      "toolName": "read_subtree",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": ".",
              "type": "directory",
              "printedTree": ".agents/\n examples/\n  diff-reviewer-1.ts\n  diff-reviewer-2.ts\n  diff-reviewer-3.ts\n opensource/\n  base.ts\n  coder.ts\n  file-picker.ts\n  researcher.ts\n  reviewer.ts\n  thinker.ts\n ask.ts\n base-experimental.ts\n base-lite.ts\n base-max.ts\n base.ts\n brainstormer.ts\n changes-reviewer.ts\n charles.ts\n claude4-gemini-thinking.ts\n constants.ts\n file-explorer.ts\n file-picker.ts\n git-committer.ts\n knowledge-keeper.ts\n planner.ts\n researcher.ts\n reviewer.ts\n superagent.ts\n thinker.ts\n.bin/\n bun\n.github/\n workflows/\n  ci.yml\n  evals.yml\n  nightly-evals.yml\n  npm-app-release-build.yml\n  npm-app-release-prod.yml\n  npm-app-release-staging.yml\n .gitignore\n CODEOWNERS\n knowledge.md\n.vscode/\n settings.json\nbackend/\n src/\n  __tests__/\n   test-data/\n    dex-go/\n     edit-snippet.go\n     expected.go\n     original.go\n   agent-id-resolution.test.ts\n   agent-registry.test.ts\n   auto-topup.test.ts\n   credit-conversion.test.ts\n   fast-rewrite.test.ts\n   generate-diffs-prompt.test.ts\n   get-custom-file-picker-config.test.ts\n   live-user-inputs.test.ts\n   loop-agent-steps.test.ts\n   main-prompt.integration.test.ts\n   main-prompt.test.ts\n   process-file-block.test.ts\n   process-str-replace.test.ts\n   read-docs-tool.test.ts\n   request-files-prompt.test.ts\n   run-agent-step-tools.test.ts\n   run-programmatic-step.test.ts\n   sandbox-generator.test.ts\n   subagent-streaming.test.ts\n   test-utils.ts\n   tool-call-schema.test.ts\n   usage-calculation.test.ts\n   web-search-tool.test.ts\n   xml-stream-parser.test.ts\n  admin/\n   grade-runs.ts\n   relabelRuns.ts\n  api/\n   org.ts\n   usage.ts\n  context/\n   app-context.ts\n  find-files/\n   check-new-files-necessary.ts\n   custom-file-picker-config.ts\n   request-files-prompt.ts\n  llm-apis/\n   __tests__/\n    linkup-api.test.ts\n   vercel-ai-sdk/\n    ai-sdk.ts\n    openrouter.ts\n    vertex-finetuned.ts\n   claude.ts\n   context7-api.ts\n   gemini-with-fallbacks.ts\n   knowledge.md\n   linkup-api.ts\n   message-cost-tracker.ts\n   openai-api.ts\n   openrouter.ts\n   relace-api.ts\n  system-prompt/\n   agent-instructions.md\n   prompts.ts\n   save-agent-request.ts\n   search-system-prompt.ts\n   truncate-file-tree.ts\n  templates/\n   agents/\n    archive/\n     dry-run.ts\n    agent-builder.ts\n    ask.ts\n    base.ts\n    file-explorer.ts\n    file-picker.ts\n    planner.ts\n    researcher.ts\n    reviewer.ts\n    superagent.ts\n    thinker.ts\n    thinking-base.ts\n   agent-list.ts\n   agent-registry.ts\n   ask-prompts.ts\n   base-prompts.ts\n   prompts.ts\n   README.md\n   strings.ts\n   types.ts\n  tools/\n   definitions/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    list.ts\n    tool-def-type.ts\n   handlers/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    handler-function-type.ts\n    list.ts\n   constants.ts\n   prompts.ts\n   stream-parser.ts\n   tool-executor.ts\n  util/\n   __tests__/\n    messages.test.ts\n    object.test.ts\n    parse-tool-call-xml.test.ts\n    simplify-tool-results.test.ts\n    split-data.test.ts\n   check-auth.ts\n   debug.ts\n   file-resolver.ts\n   logger.ts\n   messages.ts\n   object.ts\n   parse-tool-call-xml.ts\n   quickjs-sandbox.ts\n   simplify-tool-results.ts\n   split-data.ts\n   token-counter.ts\n  websockets/\n   auth.ts\n   middleware.ts\n   request-context.ts\n   server.ts\n   switchboard.ts\n   websocket-action.ts\n  async-agent-manager.ts\n  check-terminal-command.ts\n  fast-rewrite.ts\n  generate-diffs-prompt.ts\n  get-documentation-for-query.ts\n  get-file-reading-updates.ts\n  index.ts\n  live-user-inputs.ts\n  loop-main-prompt.ts\n  main-prompt.ts\n  process-file-block.ts\n  process-str-replace.ts\n  prompt-agent-stream.ts\n  run-agent-step.ts\n  run-programmatic-step.ts\n  xml-stream-parser.ts\n .gitignore\n knowledge.md\n package.json\n README.md\n tsconfig.json\ncommon/\n src/\n  __tests__/\n   agent-validation.test.ts\n   dynamic-agent-template-schema.test.ts\n   handlesteps-parsing.test.ts\n  api-keys/\n   constants.ts\n   crypto.ts\n  constants/\n   agents.ts\n   analytics-events.ts\n   grant-priorities.ts\n  db/\n   migrations/\n    meta/\n     _journal.json\n     0000_snapshot.json\n     0001_snapshot.json\n     0002_snapshot.json\n     0003_snapshot.json\n     0004_snapshot.json\n     0005_snapshot.json\n     0006_snapshot.json\n     0007_snapshot.json\n     0008_snapshot.json\n     0009_snapshot.json\n     0010_snapshot.json\n     0011_snapshot.json\n     0012_snapshot.json\n     0013_snapshot.json\n     0014_snapshot.json\n     0015_snapshot.json\n     0016_snapshot.json\n     0017_snapshot.json\n     0018_snapshot.json\n     0019_snapshot.json\n     0020_snapshot.json\n     0021_snapshot.json\n     0026_snapshot.json\n     0027_snapshot.json\n     0028_snapshot.json\n    0000_overjoyed_thing.sql\n    0001_fuzzy_typhoid_mary.sql\n    0002_sticky_dormammu.sql\n    0003_military_owl.sql\n    0004_neat_pet_avengers.sql\n    0005_minor_the_professor.sql\n    0006_first_quasimodo.sql\n    0007_equal_warlock.sql\n    0008_puzzling_carnage.sql\n    0009_bitter_rumiko_fujikawa.sql\n    0010_overjoyed_red_skull.sql\n    0011_familiar_ezekiel_stane.sql\n    0012_fluffy_naoko.sql\n    0013_famous_risque.sql\n    0014_wakeful_sinister_six.sql\n    0015_stormy_zuras.sql\n    0016_clear_hairball.sql\n    0017_tricky_randall_flagg.sql\n    0018_stale_human_robot.sql\n    0019_amused_nebula.sql\n    0020_young_sleeper.sql\n    0021_tiny_marauders.sql\n    0026_chilly_mockingbird.sql\n    0027_sloppy_quasar.sql\n    0028_lush_johnny_blaze.sql\n   docker-compose.yml\n   drizzle.config.ts\n   index.ts\n   schema.knowledge.md\n   schema.ts\n   transaction.ts\n  json-config/\n   __tests__/\n    __snapshots__/\n     stringify-schema.test.ts.snap\n    constants.test.ts\n    stringify-schema.test.ts\n   constants.ts\n   default.ts\n   stringify-schema.ts\n  templates/\n   agent-validation.ts\n   dynamic-agent-functions.ts\n  testing/\n   mock-modules.ts\n  tools/\n   params/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n   compile-tool-definitions.ts\n   constants.ts\n   list.ts\n   utils.ts\n  types/\n   __tests__/\n    dynamic-agent-template.test.ts\n   api/\n    agents/\n     publish.ts\n   agent-template.ts\n   dynamic-agent-template.ts\n   grant.ts\n   message.ts\n   organization.ts\n   print-mode.ts\n   publisher.ts\n   referral.ts\n   session-state.ts\n   usage.ts\n  util/\n   __tests__/\n    messages.test.ts\n    partial-json-delta.test.ts\n    saxy.test.ts\n    string.test.ts\n   examples/\n    diff-reviewer-1.ts\n    diff-reviewer-2.ts\n    diff-reviewer-3.ts\n   agent-file-utils.ts\n   agent-name-normalization.ts\n   agent-name-resolver.ts\n   agent-template-validation.ts\n   array.ts\n   changes.ts\n   credentials.ts\n   currency.ts\n   dates.ts\n   error.ts\n   file.ts\n   git.ts\n   logger.ts\n   lru-cache.ts\n   messages.ts\n   min-heap.ts\n   model-utils.ts\n   object.ts\n   partial-json-delta.ts\n   patch.ts\n   promise.ts\n   random.ts\n   referral.ts\n   saxy.ts\n   string.knowledge.md\n   string.ts\n   stripe.ts\n   sync-failure.ts\n   xml.ts\n   zod-schema.ts\n  websockets/\n   websocket-client.ts\n   websocket-schema.ts\n  actions.ts\n  analytics.ts\n  browser-actions.ts\n  constants.ts\n  project-file-tree.ts\n knowledge.md\n package.json\n tsconfig.json\nevals/\n git-evals/\n  email-eval-results.ts\n  eval-levelcode.json\n  eval-manifold.json\n  eval-result-levelcode-mock.json\n  gen-evals.ts\n  judge-git-eval.ts\n  post-eval-analysis.ts\n  run-eval-set.ts\n  run-git-evals.ts\n  run-single-eval-process.ts\n  run-single-eval.ts\n  setup-test-repo.ts\n  types.ts\n .gitignore\n bun.lock\n constants.ts\n e2e-cat-app-script.ts\n knowledge.md\n package.json\n scaffolding.ts\n swe-bench-eval.ts\n swe-bench-ids.ts\n swe-bench.test.ts\n test-repos.json\n test-setup.ts\n tsconfig.json\nnpm-app/\n release/\n  index.js\n  package.json\n  README.md\n release-staging/\n  index.js\n  package.json\n  README.md\n scripts/\n  build-binary.js\n  generate-github-token.ts\n  patch-web-tree-sitter.ts\n  release.js\n  twitch-plays-levelcode.sh\n src/\n  __tests__/\n   display.test.ts\n   tool-handlers.test.ts\n  agents/\n   agent-utils.ts\n   load-agents.ts\n  checkpoints/\n   checkpoint-manager.ts\n   file-manager.ts\n  cli-handlers/\n   agent-creation-chat.ts\n   agents.ts\n   api-key.ts\n   checkpoint.ts\n   diff.ts\n   easter-egg.ts\n   inititalization-flow.ts\n   mini-chat.ts\n   publish.ts\n   subagent-list.ts\n   subagent.ts\n  display/\n   overrides.ts\n   print-mode.ts\n   squash-newlines.ts\n  json-config/\n   hooks.ts\n   parser.ts\n  native/\n   ripgrep.ts\n  terminal/\n   background.ts\n   run-command.ts\n  utils/\n   __tests__/\n    __snapshots__/\n     background-process-manager.test.ts.snap\n     frustration-detector.test.ts.snap\n     rage-detector.test.ts.snap\n     xml-stream-parser.test.ts.snap\n    background-process-manager.test.ts\n    rage-detector.test.ts\n    response-example-4-files.txt\n    tool-renderers.test.ts\n    xml-stream-parser.test.ts\n   agent-validation.ts\n   analytics.ts\n   detect-shell.ts\n   git.ts\n   logger.ts\n   rage-detector.ts\n   spinner.ts\n   suppress-console.ts\n   system-info.ts\n   terminal.ts\n   tool-renderers.ts\n   with-hang-detection.ts\n   xml-stream-parser.ts\n  workers/\n   checkpoint-worker.ts\n   project-context.ts\n  background-process-manager.ts\n  browser-runner.ts\n  chat-storage.ts\n  cli-definitions.ts\n  cli.ts\n  client.ts\n  config.ts\n  create-template-project.ts\n  credentials.ts\n  dev-process-manager.ts\n  diff-manager.ts\n  fingerprint.ts\n  index.ts\n  menu.ts\n  project-files.ts\n  rage-detectors.ts\n  startup-process-handler.ts\n  subagent-storage.ts\n  tool-handlers.ts\n  types.ts\n  web-scraper.ts\n .gitignore\n bunfig.toml\n package.json\n tsconfig.json\npackages/\n bigquery/\n  src/\n   client.ts\n   index.ts\n   schema.ts\n  knowledge.md\n  package.json\n  tsconfig.json\n billing/\n  src/\n   __tests__/\n    credit-delegation.test.ts\n    extract-owner-repo.test.ts\n    org-billing.test.ts\n   auto-topup.ts\n   balance-calculator.ts\n   billing.knowledge.md\n   conversion.ts\n   credit-delegation.ts\n   grant-credits.knowledge.md\n   grant-credits.ts\n   index.ts\n   org-billing.ts\n   org-monitoring.ts\n   usage-service.ts\n   utils.ts\n  knowledge.md\n  package.json\n  project.json\n  tsconfig.json\n build-tools/\n  executors/\n   infisical-run/\n    executor.ts\n    schema.json\n  executors.json\n  package.json\n  project.json\n  tsconfig.json\n code-map/\n  __tests__/\n   test-langs/\n    test.c\n    test.cpp\n    test.cs\n    test.go\n    test.java\n    test.js\n    test.php\n    test.py\n    test.rb\n    test.rs\n    test.ts\n   languages.test.ts\n   parse.test.ts\n  src/\n   tree-sitter-queries/\n    readme.md\n    tree-sitter-c_sharp-tags.scm\n    tree-sitter-c-tags.scm\n    tree-sitter-cpp-tags.scm\n    tree-sitter-go-tags.scm\n    tree-sitter-java-tags.scm\n    tree-sitter-javascript-tags.scm\n    tree-sitter-php-tags.scm\n    tree-sitter-python-tags.scm\n    tree-sitter-ruby-tags.scm\n    tree-sitter-rust-tags.scm\n    tree-sitter-typescript-tags.scm\n   index.ts\n   languages.ts\n   parse.ts\n  package.json\n  tsconfig.json\n internal/\n  src/\n   loops/\n    client.ts\n    index.ts\n    types.ts\n   openrouter-ai-sdk/\n    internal/\n     index.ts\n    schemas/\n     reasoning-details.ts\n    types/\n     index.ts\n     openrouter-chat-completions-input.ts\n     openrouter-chat-settings.ts\n    .gitignore\n    convert-to-openrouter-chat-messages.test.ts\n    convert-to-openrouter-chat-messages.ts\n    convert-to-openrouter-completion-prompt.ts\n    index.ts\n    map-openrouter-chat-logprobs.ts\n    map-openrouter-completion-logprobs.ts\n    map-openrouter-finish-reason.ts\n    openrouter-chat-language-model.test.ts\n    openrouter-chat-language-model.ts\n    openrouter-completion-language-model.test.ts\n    openrouter-completion-language-model.ts\n    openrouter-completion-settings.ts\n    openrouter-error.ts\n    openrouter-facade.ts\n    openrouter-provider-options.test.ts\n    openrouter-provider.ts\n    openrouter-stream-usage-accounting.test.ts\n    openrouter-usage-accounting.test.ts\n   utils/\n    __tests__/\n     version-utils.test.ts\n    auth.ts\n    version-utils.ts\n    xml-parser.ts\n   env.ts\n   index.ts\n   knowledge.md\n  package.json\n  tsconfig.json\npython-app/\n src/\n  levelcode/\n   __init__.py\n .gitignore\n knowledge.md\n LICENSE\n pyproject.toml\n README.md\nscripts/\n changelog/\n  2025-05-18-version-10283-release-enhanced-assistant-experience-system-stability.mdx\n  2025-05-25-version-10295-enhanced-ai-models-and-user-experience-improvements.mdx\n  2025-06-01-version-10305-release-enhanced-ai-models-new-commands-and-performance-improvements.mdx\n  docs.json\n ft-file-selection/\n  .gitignore\n  collect-tuning-data.ts\n  grade-traces.ts\n  print-recent-relabels.ts\n  print-recent-traces.ts\n  README.md\n  relabel-for-offline-scoring.ts\n  relabel-traces-with-context.ts\n  relabel-traces.ts\n .gitignore\n analyze-edit-blocks.ts\n analyze-model-usage.ts\n apply-credit-migration.ts\n calculate-average-spend.ts\n calculate-dau.ts\n calculate-monthly-usage.ts\n calculate-mrr.ts\n calculate-weekly-usage.ts\n cleanup-worktree.sh\n convert-escaped-newlines.ts\n count-edit-file.ts\n debug-log-subset.ts\n dev.sh\n export-user-emails.ts\n generate-ci-env.js\n generate-tool-definitions.ts\n get-changelog.ts\n init-worktree.ts\n package.json\n tsconfig.json\n update-stripe-subscriptions.ts\nsdk/\n scripts/\n  publish.js\n src/\n  tools/\n   change-file.ts\n   read-files.ts\n  types/\n   agent-definition.ts\n   tools.ts\n  client.ts\n  constants.ts\n  index.ts\n  process-stream.ts\n  websocket-client.ts\n .npmignore\n CHANGELOG.md\n package.json\n PUBLISHING.md\n README.md\n tsconfig.json\nweb/\n public/\n  levelcode-intro1.webm\n scripts/\n  discord/\n   index.ts\n   register-commands.ts\n src/\n  __tests__/\n   e2e/\n    home.spec.ts\n   unit/\n    home.spec.tsx\n  actions/\n   hello-action.ts\n  app/\n   [sponsee]/\n    page.tsx\n   admin/\n    file-picker/\n     page.tsx\n    orgs/\n     page.tsx\n    traces/\n     components/\n      chat-message.tsx\n      client-session-viewer.tsx\n      empty-state.tsx\n      error-boundary.tsx\n      loading-skeletons.tsx\n      timeline-chart.module.css\n      timeline-chart.tsx\n      trace-viewer.tsx\n     utils/\n      __tests__/\n       trace-processing.test.ts\n      trace-processing.ts\n     page.tsx\n    layout.tsx\n   affiliates/\n    actions.ts\n    page.tsx\n   agents/\n    page.tsx\n   api/\n    admin/\n     orgs/\n      [orgId]/\n       features/\n        [feature]/\n         route.ts\n      export/\n       route.ts\n      route.ts\n     relabel-for-user/\n      route.ts\n     traces/\n      [clientRequestId]/\n       messages/\n        route.ts\n       timeline/\n        route.ts\n      client/\n       [clientId]/\n        sessions/\n         route.ts\n     admin-auth.ts\n    agents/\n     [publisherId]/\n      [agentId]/\n       [version]/\n        route.ts\n       latest/\n        route.ts\n     publish/\n      route.ts\n     validate/\n      route.ts\n     route.ts\n    api-keys/\n     route.ts\n    auth/\n     [...nextauth]/\n      auth-options.ts\n      route.ts\n     cli/\n      code/\n       route.ts\n      logout/\n       route.ts\n      status/\n       route.ts\n    feed/\n     route.ts\n    git-evals/\n     visibility/\n      route.ts\n     route.ts\n    healthz/\n     route.ts\n    invites/\n     [token]/\n      route.ts\n    orgs/\n     [orgId]/\n      alerts/\n       [alertId]/\n        dismiss/\n         route.ts\n       route.ts\n      analytics/\n       export/\n        route.ts\n       route.ts\n      billing/\n       setup/\n        route.ts\n       status/\n        route.ts\n       subscription/\n        route.ts\n      credits/\n       route.ts\n      invitations/\n       [email]/\n        resend/\n         route.ts\n        route.ts\n       bulk/\n        route.ts\n       route.ts\n      members/\n       [userId]/\n        route.ts\n       route.ts\n      monitoring/\n       route.ts\n      publishers/\n       route.ts\n      repos/\n       [repoId]/\n        route.ts\n       route.ts\n      settings/\n       route.ts\n      usage/\n       export/\n        route.ts\n       route.ts\n      route.ts\n     slug/\n      [slug]/\n       route.ts\n     route.ts\n    publishers/\n     [id]/\n      organization/\n       route.ts\n     validate/\n      route.ts\n     route.ts\n    referrals/\n     [code]/\n      route.ts\n     helpers.ts\n     route.ts\n    stripe/\n     buy-credits/\n      route.ts\n     webhook/\n      route.ts\n    upload/\n     avatar/\n      route.ts\n    user/\n     auto-topup/\n      route.ts\n     profile/\n      route.ts\n     usage/\n      route.ts\n   config/\n    page.tsx\n   docs/\n    [category]/\n     layout.tsx\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   evals/\n    evals-table.tsx\n    page.tsx\n   invites/\n    [token]/\n     page.tsx\n   login/\n    page.tsx\n   onboard/\n    page.tsx\n   orgs/\n    [slug]/\n     analytics/\n      page.tsx\n     billing/\n      purchase/\n       page.tsx\n      setup/\n       page.tsx\n     repositories/\n      page.tsx\n     settings/\n      page.tsx\n     team/\n      page.tsx\n     usage/\n      page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   payment-success/\n    page.tsx\n   pricing/\n    page.tsx\n   privacy-policy/\n    page.tsx\n   publishers/\n    [id]/\n     agents/\n      [agentId]/\n       [version]/\n        page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   referrals/\n    [code]/\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   terms-of-service/\n    page.tsx\n   usage/\n    layout.tsx\n    page.tsx\n    usage-display.tsx\n   analytics.knowledge.md\n   layout.tsx\n   page.tsx\n   robots.ts\n   sitemap.ts\n  components/\n   agent/\n    json-viewer.tsx\n   auto-topup/\n    AutoTopupSettings.tsx\n    AutoTopupSettingsForm.tsx\n    AutoTopupSwitch.tsx\n    BaseAutoTopupSettings.tsx\n    BaseAutoTopupSettingsForm.tsx\n    BaseAutoTopupSwitch.tsx\n    constants.ts\n    OrgAutoTopupSettings.tsx\n    OrgAutoTopupSettingsForm.tsx\n    OrgAutoTopupSwitch.tsx\n    types.ts\n   credits/\n    CreditManagementSection.tsx\n    CreditPurchaseSection.tsx\n   docs/\n    mdx/\n     code-demo.tsx\n     custom-link.tsx\n     markdown-table.tsx\n     mdx-components.tsx\n     mermaid-diagram.tsx\n     schema-display.tsx\n    copy-heading.tsx\n    doc-sidebar.tsx\n    docs.knowledge.md\n    toc.tsx\n   login/\n    login-card.tsx\n    login-client-wrapper.tsx\n   navbar/\n    navbar.tsx\n    user-dropdown.tsx\n   organization/\n    advanced-monitor.tsx\n    billing-alerts.tsx\n    billing-reports.tsx\n    billing-status.tsx\n    credit-monitor.tsx\n    model-config-sheet.tsx\n    organization-success-modal.tsx\n    repository-management.tsx\n    team-management.tsx\n   providers/\n    query-client-provider.tsx\n   publisher/\n    basic-info-step.tsx\n    ownership-step.tsx\n    profile-details-step.tsx\n    step-template.tsx\n   sign-in/\n    sign-in-button.tsx\n    sign-in-card-footer.tsx\n   ui/\n    landing/\n     competition/\n      claude-code.tsx\n      cline.tsx\n      cursor.tsx\n      github-copilot.tsx\n      index.tsx\n      tabs.tsx\n     feature/\n      browser-comparison.tsx\n      chart-illustration.tsx\n      code-illustration.tsx\n      highlight-text.tsx\n      index.tsx\n      workflow-illustration.tsx\n     animated-element.tsx\n     constants.ts\n     cta-section.tsx\n     demo-code-display.tsx\n     testimonials-section.tsx\n     types.ts\n    terminal/\n     index.tsx\n     style.css\n     terminal-input.tsx\n     terminal-output.tsx\n    avatar-upload.tsx\n    background-beams.tsx\n    badge.tsx\n    banner.tsx\n    button.tsx\n    card.tsx\n    collapsible.tsx\n    credit-confetti.tsx\n    decorative-blocks.tsx\n    dialog.tsx\n    dropdown-menu.tsx\n    enhanced-copy-button.tsx\n    footer.tsx\n    hero-buttons.tsx\n    hero.tsx\n    input.tsx\n    install-dialog.tsx\n    label.tsx\n    neon-gradient-button.tsx\n    progress.tsx\n    radio-group.tsx\n    section.tsx\n    select.tsx\n    separator.tsx\n    sheet.tsx\n    sidebar.tsx\n    skeleton-loading.tsx\n    skeleton.tsx\n    slider.tsx\n    switch.tsx\n    table.tsx\n    tabs.tsx\n    textarea.tsx\n    toast.tsx\n    toaster.tsx\n    tooltip.tsx\n    use-toast.ts\n   BrowserPreview.tsx\n   card-with-beams.tsx\n   CookieConsentCard.tsx\n   footer.tsx\n   icons.tsx\n   IDEDemo.tsx\n   layout-wrapper.tsx\n   TerminalDemo.tsx\n   theme-provider.tsx\n   theme-switcher.tsx\n  content/\n   advanced/\n    claude-code-comparison.mdx\n    config.mdx\n    how-does-it-work.mdx\n    large-projects.mdx\n    troubleshooting.mdx\n    what-models.mdx\n   agents/\n    agent-reference.mdx\n    creating-new-agents.mdx\n    customizing-agents.mdx\n    overview.mdx\n    troubleshooting-agent-customization.mdx\n   case-studies/\n    _cta.mdx\n    benjamin-bryant.mdx\n    oliver-lukesch.mdx\n   help/\n    faq.mdx\n    getting-started.mdx\n   tips/\n    best-practices.mdx\n    keyboard-shortcuts.mdx\n    knowledge-files.mdx\n    other-use-cases.mdx\n    version-control.mdx\n    where-levelcode-shines.mdx\n  discord/\n   client.ts\n   rate-limiter.ts\n  hooks/\n   use-auto-topup.ts\n   use-install-dialog.ts\n   use-mobile.tsx\n   use-model-config.ts\n   use-org-auto-topup.ts\n   use-organization-data.ts\n   use-user-profile.ts\n  lib/\n   server/\n    referral.ts\n   validators/\n    publisher.ts\n   admin-auth.ts\n   constant.ts\n   currency.ts\n   docs.ts\n   fonts.ts\n   organization-permissions.ts\n   PostHogProvider.tsx\n   publisher-permissions.ts\n   remark-code-to-codedemo.ts\n   server-init.ts\n   SessionProvider.tsx\n   stripe-utils.ts\n   testimonials.ts\n   trackConversions.ts\n   utils.ts\n  styles/\n   globals.css\n  types/\n   docs.ts\n   user.ts\n  util/\n   logger.ts\n .eslintignore\n .eslintrc.js\n .gitignore\n .prettierignore\n .prettierrc.js\n commitlint.config.js\n components.json\n contentlayer.config.ts\n jest.config.js\n jest.setup.js\n knowledge.md\n next.config.mjs\n package.json\n playwright.config.ts\n postcss.config.cjs\n README.md\n tailwind.config.ts\n tsconfig.json\n.envrc\n.gitignore\n.infisical.json\n.prettierrc\nauthentication.knowledge.md\nbun.lock\nbunfig.toml\nlevelcode.json\neslint.config.js\nknowledge.md\npackage.json\nREADME.md\ntsconfig.base.json\ntsconfig.json\nWINDOWS.md\n",
              "tokenCount": 9007,
              "truncationLevel": "none"
            }
          ]
        }
      ],
      "parentAgentId": "D-OgbZG1Kis"
    },
    {
      "type": "tool_call",
      "toolCallId": "e8dd6cc1-5286-429f-8a75-d4157a84c81f",
      "toolName": "read_subtree",
      "input": {
        "paths": [],
        "maxTokens": 500000
      },
      "agentId": "D-OgiVqb-lc",
      "parentAgentId": "D-OfY8_NY2s",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "e8dd6cc1-5286-429f-8a75-d4157a84c81f",
      "toolName": "read_subtree",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": ".",
              "type": "directory",
              "printedTree": ".agents/\n examples/\n  diff-reviewer-1.ts\n  diff-reviewer-2.ts\n  diff-reviewer-3.ts\n opensource/\n  base.ts\n  coder.ts\n  file-picker.ts\n  researcher.ts\n  reviewer.ts\n  thinker.ts\n ask.ts\n base-experimental.ts\n base-lite.ts\n base-max.ts\n base.ts\n brainstormer.ts\n changes-reviewer.ts\n charles.ts\n claude4-gemini-thinking.ts\n constants.ts\n file-explorer.ts\n file-picker.ts\n git-committer.ts\n knowledge-keeper.ts\n planner.ts\n researcher.ts\n reviewer.ts\n superagent.ts\n thinker.ts\n.bin/\n bun\n.github/\n workflows/\n  ci.yml\n  evals.yml\n  nightly-evals.yml\n  npm-app-release-build.yml\n  npm-app-release-prod.yml\n  npm-app-release-staging.yml\n .gitignore\n CODEOWNERS\n knowledge.md\n.vscode/\n settings.json\nbackend/\n src/\n  __tests__/\n   test-data/\n    dex-go/\n     edit-snippet.go\n     expected.go\n     original.go\n   agent-id-resolution.test.ts\n   agent-registry.test.ts\n   auto-topup.test.ts\n   credit-conversion.test.ts\n   fast-rewrite.test.ts\n   generate-diffs-prompt.test.ts\n   get-custom-file-picker-config.test.ts\n   live-user-inputs.test.ts\n   loop-agent-steps.test.ts\n   main-prompt.integration.test.ts\n   main-prompt.test.ts\n   process-file-block.test.ts\n   process-str-replace.test.ts\n   read-docs-tool.test.ts\n   request-files-prompt.test.ts\n   run-agent-step-tools.test.ts\n   run-programmatic-step.test.ts\n   sandbox-generator.test.ts\n   subagent-streaming.test.ts\n   test-utils.ts\n   tool-call-schema.test.ts\n   usage-calculation.test.ts\n   web-search-tool.test.ts\n   xml-stream-parser.test.ts\n  admin/\n   grade-runs.ts\n   relabelRuns.ts\n  api/\n   org.ts\n   usage.ts\n  context/\n   app-context.ts\n  find-files/\n   check-new-files-necessary.ts\n   custom-file-picker-config.ts\n   request-files-prompt.ts\n  llm-apis/\n   __tests__/\n    linkup-api.test.ts\n   vercel-ai-sdk/\n    ai-sdk.ts\n    openrouter.ts\n    vertex-finetuned.ts\n   claude.ts\n   context7-api.ts\n   gemini-with-fallbacks.ts\n   knowledge.md\n   linkup-api.ts\n   message-cost-tracker.ts\n   openai-api.ts\n   openrouter.ts\n   relace-api.ts\n  system-prompt/\n   agent-instructions.md\n   prompts.ts\n   save-agent-request.ts\n   search-system-prompt.ts\n   truncate-file-tree.ts\n  templates/\n   agents/\n    archive/\n     dry-run.ts\n    agent-builder.ts\n    ask.ts\n    base.ts\n    file-explorer.ts\n    file-picker.ts\n    planner.ts\n    researcher.ts\n    reviewer.ts\n    superagent.ts\n    thinker.ts\n    thinking-base.ts\n   agent-list.ts\n   agent-registry.ts\n   ask-prompts.ts\n   base-prompts.ts\n   prompts.ts\n   README.md\n   strings.ts\n   types.ts\n  tools/\n   definitions/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    list.ts\n    tool-def-type.ts\n   handlers/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    handler-function-type.ts\n    list.ts\n   constants.ts\n   prompts.ts\n   stream-parser.ts\n   tool-executor.ts\n  util/\n   __tests__/\n    messages.test.ts\n    object.test.ts\n    parse-tool-call-xml.test.ts\n    simplify-tool-results.test.ts\n    split-data.test.ts\n   check-auth.ts\n   debug.ts\n   file-resolver.ts\n   logger.ts\n   messages.ts\n   object.ts\n   parse-tool-call-xml.ts\n   quickjs-sandbox.ts\n   simplify-tool-results.ts\n   split-data.ts\n   token-counter.ts\n  websockets/\n   auth.ts\n   middleware.ts\n   request-context.ts\n   server.ts\n   switchboard.ts\n   websocket-action.ts\n  async-agent-manager.ts\n  check-terminal-command.ts\n  fast-rewrite.ts\n  generate-diffs-prompt.ts\n  get-documentation-for-query.ts\n  get-file-reading-updates.ts\n  index.ts\n  live-user-inputs.ts\n  loop-main-prompt.ts\n  main-prompt.ts\n  process-file-block.ts\n  process-str-replace.ts\n  prompt-agent-stream.ts\n  run-agent-step.ts\n  run-programmatic-step.ts\n  xml-stream-parser.ts\n .gitignore\n knowledge.md\n package.json\n README.md\n tsconfig.json\ncommon/\n src/\n  __tests__/\n   agent-validation.test.ts\n   dynamic-agent-template-schema.test.ts\n   handlesteps-parsing.test.ts\n  api-keys/\n   constants.ts\n   crypto.ts\n  constants/\n   agents.ts\n   analytics-events.ts\n   grant-priorities.ts\n  db/\n   migrations/\n    meta/\n     _journal.json\n     0000_snapshot.json\n     0001_snapshot.json\n     0002_snapshot.json\n     0003_snapshot.json\n     0004_snapshot.json\n     0005_snapshot.json\n     0006_snapshot.json\n     0007_snapshot.json\n     0008_snapshot.json\n     0009_snapshot.json\n     0010_snapshot.json\n     0011_snapshot.json\n     0012_snapshot.json\n     0013_snapshot.json\n     0014_snapshot.json\n     0015_snapshot.json\n     0016_snapshot.json\n     0017_snapshot.json\n     0018_snapshot.json\n     0019_snapshot.json\n     0020_snapshot.json\n     0021_snapshot.json\n     0026_snapshot.json\n     0027_snapshot.json\n     0028_snapshot.json\n    0000_overjoyed_thing.sql\n    0001_fuzzy_typhoid_mary.sql\n    0002_sticky_dormammu.sql\n    0003_military_owl.sql\n    0004_neat_pet_avengers.sql\n    0005_minor_the_professor.sql\n    0006_first_quasimodo.sql\n    0007_equal_warlock.sql\n    0008_puzzling_carnage.sql\n    0009_bitter_rumiko_fujikawa.sql\n    0010_overjoyed_red_skull.sql\n    0011_familiar_ezekiel_stane.sql\n    0012_fluffy_naoko.sql\n    0013_famous_risque.sql\n    0014_wakeful_sinister_six.sql\n    0015_stormy_zuras.sql\n    0016_clear_hairball.sql\n    0017_tricky_randall_flagg.sql\n    0018_stale_human_robot.sql\n    0019_amused_nebula.sql\n    0020_young_sleeper.sql\n    0021_tiny_marauders.sql\n    0026_chilly_mockingbird.sql\n    0027_sloppy_quasar.sql\n    0028_lush_johnny_blaze.sql\n   docker-compose.yml\n   drizzle.config.ts\n   index.ts\n   schema.knowledge.md\n   schema.ts\n   transaction.ts\n  json-config/\n   __tests__/\n    __snapshots__/\n     stringify-schema.test.ts.snap\n    constants.test.ts\n    stringify-schema.test.ts\n   constants.ts\n   default.ts\n   stringify-schema.ts\n  templates/\n   agent-validation.ts\n   dynamic-agent-functions.ts\n  testing/\n   mock-modules.ts\n  tools/\n   params/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n   compile-tool-definitions.ts\n   constants.ts\n   list.ts\n   utils.ts\n  types/\n   __tests__/\n    dynamic-agent-template.test.ts\n   api/\n    agents/\n     publish.ts\n   agent-template.ts\n   dynamic-agent-template.ts\n   grant.ts\n   message.ts\n   organization.ts\n   print-mode.ts\n   publisher.ts\n   referral.ts\n   session-state.ts\n   usage.ts\n  util/\n   __tests__/\n    messages.test.ts\n    partial-json-delta.test.ts\n    saxy.test.ts\n    string.test.ts\n   examples/\n    diff-reviewer-1.ts\n    diff-reviewer-2.ts\n    diff-reviewer-3.ts\n   agent-file-utils.ts\n   agent-name-normalization.ts\n   agent-name-resolver.ts\n   agent-template-validation.ts\n   array.ts\n   changes.ts\n   credentials.ts\n   currency.ts\n   dates.ts\n   error.ts\n   file.ts\n   git.ts\n   logger.ts\n   lru-cache.ts\n   messages.ts\n   min-heap.ts\n   model-utils.ts\n   object.ts\n   partial-json-delta.ts\n   patch.ts\n   promise.ts\n   random.ts\n   referral.ts\n   saxy.ts\n   string.knowledge.md\n   string.ts\n   stripe.ts\n   sync-failure.ts\n   xml.ts\n   zod-schema.ts\n  websockets/\n   websocket-client.ts\n   websocket-schema.ts\n  actions.ts\n  analytics.ts\n  browser-actions.ts\n  constants.ts\n  project-file-tree.ts\n knowledge.md\n package.json\n tsconfig.json\nevals/\n git-evals/\n  email-eval-results.ts\n  eval-levelcode.json\n  eval-manifold.json\n  eval-result-levelcode-mock.json\n  gen-evals.ts\n  judge-git-eval.ts\n  post-eval-analysis.ts\n  run-eval-set.ts\n  run-git-evals.ts\n  run-single-eval-process.ts\n  run-single-eval.ts\n  setup-test-repo.ts\n  types.ts\n .gitignore\n bun.lock\n constants.ts\n e2e-cat-app-script.ts\n knowledge.md\n package.json\n scaffolding.ts\n swe-bench-eval.ts\n swe-bench-ids.ts\n swe-bench.test.ts\n test-repos.json\n test-setup.ts\n tsconfig.json\nnpm-app/\n release/\n  index.js\n  package.json\n  README.md\n release-staging/\n  index.js\n  package.json\n  README.md\n scripts/\n  build-binary.js\n  generate-github-token.ts\n  patch-web-tree-sitter.ts\n  release.js\n  twitch-plays-levelcode.sh\n src/\n  __tests__/\n   display.test.ts\n   tool-handlers.test.ts\n  agents/\n   agent-utils.ts\n   load-agents.ts\n  checkpoints/\n   checkpoint-manager.ts\n   file-manager.ts\n  cli-handlers/\n   agent-creation-chat.ts\n   agents.ts\n   api-key.ts\n   checkpoint.ts\n   diff.ts\n   easter-egg.ts\n   inititalization-flow.ts\n   mini-chat.ts\n   publish.ts\n   subagent-list.ts\n   subagent.ts\n  display/\n   overrides.ts\n   print-mode.ts\n   squash-newlines.ts\n  json-config/\n   hooks.ts\n   parser.ts\n  native/\n   ripgrep.ts\n  terminal/\n   background.ts\n   run-command.ts\n  utils/\n   __tests__/\n    __snapshots__/\n     background-process-manager.test.ts.snap\n     frustration-detector.test.ts.snap\n     rage-detector.test.ts.snap\n     xml-stream-parser.test.ts.snap\n    background-process-manager.test.ts\n    rage-detector.test.ts\n    response-example-4-files.txt\n    tool-renderers.test.ts\n    xml-stream-parser.test.ts\n   agent-validation.ts\n   analytics.ts\n   detect-shell.ts\n   git.ts\n   logger.ts\n   rage-detector.ts\n   spinner.ts\n   suppress-console.ts\n   system-info.ts\n   terminal.ts\n   tool-renderers.ts\n   with-hang-detection.ts\n   xml-stream-parser.ts\n  workers/\n   checkpoint-worker.ts\n   project-context.ts\n  background-process-manager.ts\n  browser-runner.ts\n  chat-storage.ts\n  cli-definitions.ts\n  cli.ts\n  client.ts\n  config.ts\n  create-template-project.ts\n  credentials.ts\n  dev-process-manager.ts\n  diff-manager.ts\n  fingerprint.ts\n  index.ts\n  menu.ts\n  project-files.ts\n  rage-detectors.ts\n  startup-process-handler.ts\n  subagent-storage.ts\n  tool-handlers.ts\n  types.ts\n  web-scraper.ts\n .gitignore\n bunfig.toml\n package.json\n tsconfig.json\npackages/\n bigquery/\n  src/\n   client.ts\n   index.ts\n   schema.ts\n  knowledge.md\n  package.json\n  tsconfig.json\n billing/\n  src/\n   __tests__/\n    credit-delegation.test.ts\n    extract-owner-repo.test.ts\n    org-billing.test.ts\n   auto-topup.ts\n   balance-calculator.ts\n   billing.knowledge.md\n   conversion.ts\n   credit-delegation.ts\n   grant-credits.knowledge.md\n   grant-credits.ts\n   index.ts\n   org-billing.ts\n   org-monitoring.ts\n   usage-service.ts\n   utils.ts\n  knowledge.md\n  package.json\n  project.json\n  tsconfig.json\n build-tools/\n  executors/\n   infisical-run/\n    executor.ts\n    schema.json\n  executors.json\n  package.json\n  project.json\n  tsconfig.json\n code-map/\n  __tests__/\n   test-langs/\n    test.c\n    test.cpp\n    test.cs\n    test.go\n    test.java\n    test.js\n    test.php\n    test.py\n    test.rb\n    test.rs\n    test.ts\n   languages.test.ts\n   parse.test.ts\n  src/\n   tree-sitter-queries/\n    readme.md\n    tree-sitter-c_sharp-tags.scm\n    tree-sitter-c-tags.scm\n    tree-sitter-cpp-tags.scm\n    tree-sitter-go-tags.scm\n    tree-sitter-java-tags.scm\n    tree-sitter-javascript-tags.scm\n    tree-sitter-php-tags.scm\n    tree-sitter-python-tags.scm\n    tree-sitter-ruby-tags.scm\n    tree-sitter-rust-tags.scm\n    tree-sitter-typescript-tags.scm\n   index.ts\n   languages.ts\n   parse.ts\n  package.json\n  tsconfig.json\n internal/\n  src/\n   loops/\n    client.ts\n    index.ts\n    types.ts\n   openrouter-ai-sdk/\n    internal/\n     index.ts\n    schemas/\n     reasoning-details.ts\n    types/\n     index.ts\n     openrouter-chat-completions-input.ts\n     openrouter-chat-settings.ts\n    .gitignore\n    convert-to-openrouter-chat-messages.test.ts\n    convert-to-openrouter-chat-messages.ts\n    convert-to-openrouter-completion-prompt.ts\n    index.ts\n    map-openrouter-chat-logprobs.ts\n    map-openrouter-completion-logprobs.ts\n    map-openrouter-finish-reason.ts\n    openrouter-chat-language-model.test.ts\n    openrouter-chat-language-model.ts\n    openrouter-completion-language-model.test.ts\n    openrouter-completion-language-model.ts\n    openrouter-completion-settings.ts\n    openrouter-error.ts\n    openrouter-facade.ts\n    openrouter-provider-options.test.ts\n    openrouter-provider.ts\n    openrouter-stream-usage-accounting.test.ts\n    openrouter-usage-accounting.test.ts\n   utils/\n    __tests__/\n     version-utils.test.ts\n    auth.ts\n    version-utils.ts\n    xml-parser.ts\n   env.ts\n   index.ts\n   knowledge.md\n  package.json\n  tsconfig.json\npython-app/\n src/\n  levelcode/\n   __init__.py\n .gitignore\n knowledge.md\n LICENSE\n pyproject.toml\n README.md\nscripts/\n changelog/\n  2025-05-18-version-10283-release-enhanced-assistant-experience-system-stability.mdx\n  2025-05-25-version-10295-enhanced-ai-models-and-user-experience-improvements.mdx\n  2025-06-01-version-10305-release-enhanced-ai-models-new-commands-and-performance-improvements.mdx\n  docs.json\n ft-file-selection/\n  .gitignore\n  collect-tuning-data.ts\n  grade-traces.ts\n  print-recent-relabels.ts\n  print-recent-traces.ts\n  README.md\n  relabel-for-offline-scoring.ts\n  relabel-traces-with-context.ts\n  relabel-traces.ts\n .gitignore\n analyze-edit-blocks.ts\n analyze-model-usage.ts\n apply-credit-migration.ts\n calculate-average-spend.ts\n calculate-dau.ts\n calculate-monthly-usage.ts\n calculate-mrr.ts\n calculate-weekly-usage.ts\n cleanup-worktree.sh\n convert-escaped-newlines.ts\n count-edit-file.ts\n debug-log-subset.ts\n dev.sh\n export-user-emails.ts\n generate-ci-env.js\n generate-tool-definitions.ts\n get-changelog.ts\n init-worktree.ts\n package.json\n tsconfig.json\n update-stripe-subscriptions.ts\nsdk/\n scripts/\n  publish.js\n src/\n  tools/\n   change-file.ts\n   read-files.ts\n  types/\n   agent-definition.ts\n   tools.ts\n  client.ts\n  constants.ts\n  index.ts\n  process-stream.ts\n  websocket-client.ts\n .npmignore\n CHANGELOG.md\n package.json\n PUBLISHING.md\n README.md\n tsconfig.json\nweb/\n public/\n  levelcode-intro1.webm\n scripts/\n  discord/\n   index.ts\n   register-commands.ts\n src/\n  __tests__/\n   e2e/\n    home.spec.ts\n   unit/\n    home.spec.tsx\n  actions/\n   hello-action.ts\n  app/\n   [sponsee]/\n    page.tsx\n   admin/\n    file-picker/\n     page.tsx\n    orgs/\n     page.tsx\n    traces/\n     components/\n      chat-message.tsx\n      client-session-viewer.tsx\n      empty-state.tsx\n      error-boundary.tsx\n      loading-skeletons.tsx\n      timeline-chart.module.css\n      timeline-chart.tsx\n      trace-viewer.tsx\n     utils/\n      __tests__/\n       trace-processing.test.ts\n      trace-processing.ts\n     page.tsx\n    layout.tsx\n   affiliates/\n    actions.ts\n    page.tsx\n   agents/\n    page.tsx\n   api/\n    admin/\n     orgs/\n      [orgId]/\n       features/\n        [feature]/\n         route.ts\n      export/\n       route.ts\n      route.ts\n     relabel-for-user/\n      route.ts\n     traces/\n      [clientRequestId]/\n       messages/\n        route.ts\n       timeline/\n        route.ts\n      client/\n       [clientId]/\n        sessions/\n         route.ts\n     admin-auth.ts\n    agents/\n     [publisherId]/\n      [agentId]/\n       [version]/\n        route.ts\n       latest/\n        route.ts\n     publish/\n      route.ts\n     validate/\n      route.ts\n     route.ts\n    api-keys/\n     route.ts\n    auth/\n     [...nextauth]/\n      auth-options.ts\n      route.ts\n     cli/\n      code/\n       route.ts\n      logout/\n       route.ts\n      status/\n       route.ts\n    feed/\n     route.ts\n    git-evals/\n     visibility/\n      route.ts\n     route.ts\n    healthz/\n     route.ts\n    invites/\n     [token]/\n      route.ts\n    orgs/\n     [orgId]/\n      alerts/\n       [alertId]/\n        dismiss/\n         route.ts\n       route.ts\n      analytics/\n       export/\n        route.ts\n       route.ts\n      billing/\n       setup/\n        route.ts\n       status/\n        route.ts\n       subscription/\n        route.ts\n      credits/\n       route.ts\n      invitations/\n       [email]/\n        resend/\n         route.ts\n        route.ts\n       bulk/\n        route.ts\n       route.ts\n      members/\n       [userId]/\n        route.ts\n       route.ts\n      monitoring/\n       route.ts\n      publishers/\n       route.ts\n      repos/\n       [repoId]/\n        route.ts\n       route.ts\n      settings/\n       route.ts\n      usage/\n       export/\n        route.ts\n       route.ts\n      route.ts\n     slug/\n      [slug]/\n       route.ts\n     route.ts\n    publishers/\n     [id]/\n      organization/\n       route.ts\n     validate/\n      route.ts\n     route.ts\n    referrals/\n     [code]/\n      route.ts\n     helpers.ts\n     route.ts\n    stripe/\n     buy-credits/\n      route.ts\n     webhook/\n      route.ts\n    upload/\n     avatar/\n      route.ts\n    user/\n     auto-topup/\n      route.ts\n     profile/\n      route.ts\n     usage/\n      route.ts\n   config/\n    page.tsx\n   docs/\n    [category]/\n     layout.tsx\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   evals/\n    evals-table.tsx\n    page.tsx\n   invites/\n    [token]/\n     page.tsx\n   login/\n    page.tsx\n   onboard/\n    page.tsx\n   orgs/\n    [slug]/\n     analytics/\n      page.tsx\n     billing/\n      purchase/\n       page.tsx\n      setup/\n       page.tsx\n     repositories/\n      page.tsx\n     settings/\n      page.tsx\n     team/\n      page.tsx\n     usage/\n      page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   payment-success/\n    page.tsx\n   pricing/\n    page.tsx\n   privacy-policy/\n    page.tsx\n   publishers/\n    [id]/\n     agents/\n      [agentId]/\n       [version]/\n        page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   referrals/\n    [code]/\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   terms-of-service/\n    page.tsx\n   usage/\n    layout.tsx\n    page.tsx\n    usage-display.tsx\n   analytics.knowledge.md\n   layout.tsx\n   page.tsx\n   robots.ts\n   sitemap.ts\n  components/\n   agent/\n    json-viewer.tsx\n   auto-topup/\n    AutoTopupSettings.tsx\n    AutoTopupSettingsForm.tsx\n    AutoTopupSwitch.tsx\n    BaseAutoTopupSettings.tsx\n    BaseAutoTopupSettingsForm.tsx\n    BaseAutoTopupSwitch.tsx\n    constants.ts\n    OrgAutoTopupSettings.tsx\n    OrgAutoTopupSettingsForm.tsx\n    OrgAutoTopupSwitch.tsx\n    types.ts\n   credits/\n    CreditManagementSection.tsx\n    CreditPurchaseSection.tsx\n   docs/\n    mdx/\n     code-demo.tsx\n     custom-link.tsx\n     markdown-table.tsx\n     mdx-components.tsx\n     mermaid-diagram.tsx\n     schema-display.tsx\n    copy-heading.tsx\n    doc-sidebar.tsx\n    docs.knowledge.md\n    toc.tsx\n   login/\n    login-card.tsx\n    login-client-wrapper.tsx\n   navbar/\n    navbar.tsx\n    user-dropdown.tsx\n   organization/\n    advanced-monitor.tsx\n    billing-alerts.tsx\n    billing-reports.tsx\n    billing-status.tsx\n    credit-monitor.tsx\n    model-config-sheet.tsx\n    organization-success-modal.tsx\n    repository-management.tsx\n    team-management.tsx\n   providers/\n    query-client-provider.tsx\n   publisher/\n    basic-info-step.tsx\n    ownership-step.tsx\n    profile-details-step.tsx\n    step-template.tsx\n   sign-in/\n    sign-in-button.tsx\n    sign-in-card-footer.tsx\n   ui/\n    landing/\n     competition/\n      claude-code.tsx\n      cline.tsx\n      cursor.tsx\n      github-copilot.tsx\n      index.tsx\n      tabs.tsx\n     feature/\n      browser-comparison.tsx\n      chart-illustration.tsx\n      code-illustration.tsx\n      highlight-text.tsx\n      index.tsx\n      workflow-illustration.tsx\n     animated-element.tsx\n     constants.ts\n     cta-section.tsx\n     demo-code-display.tsx\n     testimonials-section.tsx\n     types.ts\n    terminal/\n     index.tsx\n     style.css\n     terminal-input.tsx\n     terminal-output.tsx\n    avatar-upload.tsx\n    background-beams.tsx\n    badge.tsx\n    banner.tsx\n    button.tsx\n    card.tsx\n    collapsible.tsx\n    credit-confetti.tsx\n    decorative-blocks.tsx\n    dialog.tsx\n    dropdown-menu.tsx\n    enhanced-copy-button.tsx\n    footer.tsx\n    hero-buttons.tsx\n    hero.tsx\n    input.tsx\n    install-dialog.tsx\n    label.tsx\n    neon-gradient-button.tsx\n    progress.tsx\n    radio-group.tsx\n    section.tsx\n    select.tsx\n    separator.tsx\n    sheet.tsx\n    sidebar.tsx\n    skeleton-loading.tsx\n    skeleton.tsx\n    slider.tsx\n    switch.tsx\n    table.tsx\n    tabs.tsx\n    textarea.tsx\n    toast.tsx\n    toaster.tsx\n    tooltip.tsx\n    use-toast.ts\n   BrowserPreview.tsx\n   card-with-beams.tsx\n   CookieConsentCard.tsx\n   footer.tsx\n   icons.tsx\n   IDEDemo.tsx\n   layout-wrapper.tsx\n   TerminalDemo.tsx\n   theme-provider.tsx\n   theme-switcher.tsx\n  content/\n   advanced/\n    claude-code-comparison.mdx\n    config.mdx\n    how-does-it-work.mdx\n    large-projects.mdx\n    troubleshooting.mdx\n    what-models.mdx\n   agents/\n    agent-reference.mdx\n    creating-new-agents.mdx\n    customizing-agents.mdx\n    overview.mdx\n    troubleshooting-agent-customization.mdx\n   case-studies/\n    _cta.mdx\n    benjamin-bryant.mdx\n    oliver-lukesch.mdx\n   help/\n    faq.mdx\n    getting-started.mdx\n   tips/\n    best-practices.mdx\n    keyboard-shortcuts.mdx\n    knowledge-files.mdx\n    other-use-cases.mdx\n    version-control.mdx\n    where-levelcode-shines.mdx\n  discord/\n   client.ts\n   rate-limiter.ts\n  hooks/\n   use-auto-topup.ts\n   use-install-dialog.ts\n   use-mobile.tsx\n   use-model-config.ts\n   use-org-auto-topup.ts\n   use-organization-data.ts\n   use-user-profile.ts\n  lib/\n   server/\n    referral.ts\n   validators/\n    publisher.ts\n   admin-auth.ts\n   constant.ts\n   currency.ts\n   docs.ts\n   fonts.ts\n   organization-permissions.ts\n   PostHogProvider.tsx\n   publisher-permissions.ts\n   remark-code-to-codedemo.ts\n   server-init.ts\n   SessionProvider.tsx\n   stripe-utils.ts\n   testimonials.ts\n   trackConversions.ts\n   utils.ts\n  styles/\n   globals.css\n  types/\n   docs.ts\n   user.ts\n  util/\n   logger.ts\n .eslintignore\n .eslintrc.js\n .gitignore\n .prettierignore\n .prettierrc.js\n commitlint.config.js\n components.json\n contentlayer.config.ts\n jest.config.js\n jest.setup.js\n knowledge.md\n next.config.mjs\n package.json\n playwright.config.ts\n postcss.config.cjs\n README.md\n tailwind.config.ts\n tsconfig.json\n.envrc\n.gitignore\n.infisical.json\n.prettierrc\nauthentication.knowledge.md\nbun.lock\nbunfig.toml\nlevelcode.json\neslint.config.js\nknowledge.md\npackage.json\nREADME.md\ntsconfig.base.json\ntsconfig.json\nWINDOWS.md\n",
              "tokenCount": 9007,
              "truncationLevel": "none"
            }
          ]
        }
      ],
      "parentAgentId": "D-OgiVqb-lc"
    },
    {
      "type": "tool_call",
      "toolCallId": "557a0acd-be3c-43ac-958e-f02af0941e66",
      "toolName": "read_subtree",
      "input": {
        "paths": [],
        "maxTokens": 500000
      },
      "agentId": "D-Ogo19lSyI",
      "parentAgentId": "D-OfaYSx8-Q",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "557a0acd-be3c-43ac-958e-f02af0941e66",
      "toolName": "read_subtree",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": ".",
              "type": "directory",
              "printedTree": ".agents/\n examples/\n  diff-reviewer-1.ts\n  diff-reviewer-2.ts\n  diff-reviewer-3.ts\n opensource/\n  base.ts\n  coder.ts\n  file-picker.ts\n  researcher.ts\n  reviewer.ts\n  thinker.ts\n ask.ts\n base-experimental.ts\n base-lite.ts\n base-max.ts\n base.ts\n brainstormer.ts\n changes-reviewer.ts\n charles.ts\n claude4-gemini-thinking.ts\n constants.ts\n file-explorer.ts\n file-picker.ts\n git-committer.ts\n knowledge-keeper.ts\n planner.ts\n researcher.ts\n reviewer.ts\n superagent.ts\n thinker.ts\n.bin/\n bun\n.github/\n workflows/\n  ci.yml\n  evals.yml\n  nightly-evals.yml\n  npm-app-release-build.yml\n  npm-app-release-prod.yml\n  npm-app-release-staging.yml\n .gitignore\n CODEOWNERS\n knowledge.md\n.vscode/\n settings.json\nbackend/\n src/\n  __tests__/\n   test-data/\n    dex-go/\n     edit-snippet.go\n     expected.go\n     original.go\n   agent-id-resolution.test.ts\n   agent-registry.test.ts\n   auto-topup.test.ts\n   credit-conversion.test.ts\n   fast-rewrite.test.ts\n   generate-diffs-prompt.test.ts\n   get-custom-file-picker-config.test.ts\n   live-user-inputs.test.ts\n   loop-agent-steps.test.ts\n   main-prompt.integration.test.ts\n   main-prompt.test.ts\n   process-file-block.test.ts\n   process-str-replace.test.ts\n   read-docs-tool.test.ts\n   request-files-prompt.test.ts\n   run-agent-step-tools.test.ts\n   run-programmatic-step.test.ts\n   sandbox-generator.test.ts\n   subagent-streaming.test.ts\n   test-utils.ts\n   tool-call-schema.test.ts\n   usage-calculation.test.ts\n   web-search-tool.test.ts\n   xml-stream-parser.test.ts\n  admin/\n   grade-runs.ts\n   relabelRuns.ts\n  api/\n   org.ts\n   usage.ts\n  context/\n   app-context.ts\n  find-files/\n   check-new-files-necessary.ts\n   custom-file-picker-config.ts\n   request-files-prompt.ts\n  llm-apis/\n   __tests__/\n    linkup-api.test.ts\n   vercel-ai-sdk/\n    ai-sdk.ts\n    openrouter.ts\n    vertex-finetuned.ts\n   claude.ts\n   context7-api.ts\n   gemini-with-fallbacks.ts\n   knowledge.md\n   linkup-api.ts\n   message-cost-tracker.ts\n   openai-api.ts\n   openrouter.ts\n   relace-api.ts\n  system-prompt/\n   agent-instructions.md\n   prompts.ts\n   save-agent-request.ts\n   search-system-prompt.ts\n   truncate-file-tree.ts\n  templates/\n   agents/\n    archive/\n     dry-run.ts\n    agent-builder.ts\n    ask.ts\n    base.ts\n    file-explorer.ts\n    file-picker.ts\n    planner.ts\n    researcher.ts\n    reviewer.ts\n    superagent.ts\n    thinker.ts\n    thinking-base.ts\n   agent-list.ts\n   agent-registry.ts\n   ask-prompts.ts\n   base-prompts.ts\n   prompts.ts\n   README.md\n   strings.ts\n   types.ts\n  tools/\n   definitions/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    list.ts\n    tool-def-type.ts\n   handlers/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    handler-function-type.ts\n    list.ts\n   constants.ts\n   prompts.ts\n   stream-parser.ts\n   tool-executor.ts\n  util/\n   __tests__/\n    messages.test.ts\n    object.test.ts\n    parse-tool-call-xml.test.ts\n    simplify-tool-results.test.ts\n    split-data.test.ts\n   check-auth.ts\n   debug.ts\n   file-resolver.ts\n   logger.ts\n   messages.ts\n   object.ts\n   parse-tool-call-xml.ts\n   quickjs-sandbox.ts\n   simplify-tool-results.ts\n   split-data.ts\n   token-counter.ts\n  websockets/\n   auth.ts\n   middleware.ts\n   request-context.ts\n   server.ts\n   switchboard.ts\n   websocket-action.ts\n  async-agent-manager.ts\n  check-terminal-command.ts\n  fast-rewrite.ts\n  generate-diffs-prompt.ts\n  get-documentation-for-query.ts\n  get-file-reading-updates.ts\n  index.ts\n  live-user-inputs.ts\n  loop-main-prompt.ts\n  main-prompt.ts\n  process-file-block.ts\n  process-str-replace.ts\n  prompt-agent-stream.ts\n  run-agent-step.ts\n  run-programmatic-step.ts\n  xml-stream-parser.ts\n .gitignore\n knowledge.md\n package.json\n README.md\n tsconfig.json\ncommon/\n src/\n  __tests__/\n   agent-validation.test.ts\n   dynamic-agent-template-schema.test.ts\n   handlesteps-parsing.test.ts\n  api-keys/\n   constants.ts\n   crypto.ts\n  constants/\n   agents.ts\n   analytics-events.ts\n   grant-priorities.ts\n  db/\n   migrations/\n    meta/\n     _journal.json\n     0000_snapshot.json\n     0001_snapshot.json\n     0002_snapshot.json\n     0003_snapshot.json\n     0004_snapshot.json\n     0005_snapshot.json\n     0006_snapshot.json\n     0007_snapshot.json\n     0008_snapshot.json\n     0009_snapshot.json\n     0010_snapshot.json\n     0011_snapshot.json\n     0012_snapshot.json\n     0013_snapshot.json\n     0014_snapshot.json\n     0015_snapshot.json\n     0016_snapshot.json\n     0017_snapshot.json\n     0018_snapshot.json\n     0019_snapshot.json\n     0020_snapshot.json\n     0021_snapshot.json\n     0026_snapshot.json\n     0027_snapshot.json\n     0028_snapshot.json\n    0000_overjoyed_thing.sql\n    0001_fuzzy_typhoid_mary.sql\n    0002_sticky_dormammu.sql\n    0003_military_owl.sql\n    0004_neat_pet_avengers.sql\n    0005_minor_the_professor.sql\n    0006_first_quasimodo.sql\n    0007_equal_warlock.sql\n    0008_puzzling_carnage.sql\n    0009_bitter_rumiko_fujikawa.sql\n    0010_overjoyed_red_skull.sql\n    0011_familiar_ezekiel_stane.sql\n    0012_fluffy_naoko.sql\n    0013_famous_risque.sql\n    0014_wakeful_sinister_six.sql\n    0015_stormy_zuras.sql\n    0016_clear_hairball.sql\n    0017_tricky_randall_flagg.sql\n    0018_stale_human_robot.sql\n    0019_amused_nebula.sql\n    0020_young_sleeper.sql\n    0021_tiny_marauders.sql\n    0026_chilly_mockingbird.sql\n    0027_sloppy_quasar.sql\n    0028_lush_johnny_blaze.sql\n   docker-compose.yml\n   drizzle.config.ts\n   index.ts\n   schema.knowledge.md\n   schema.ts\n   transaction.ts\n  json-config/\n   __tests__/\n    __snapshots__/\n     stringify-schema.test.ts.snap\n    constants.test.ts\n    stringify-schema.test.ts\n   constants.ts\n   default.ts\n   stringify-schema.ts\n  templates/\n   agent-validation.ts\n   dynamic-agent-functions.ts\n  testing/\n   mock-modules.ts\n  tools/\n   params/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n   compile-tool-definitions.ts\n   constants.ts\n   list.ts\n   utils.ts\n  types/\n   __tests__/\n    dynamic-agent-template.test.ts\n   api/\n    agents/\n     publish.ts\n   agent-template.ts\n   dynamic-agent-template.ts\n   grant.ts\n   message.ts\n   organization.ts\n   print-mode.ts\n   publisher.ts\n   referral.ts\n   session-state.ts\n   usage.ts\n  util/\n   __tests__/\n    messages.test.ts\n    partial-json-delta.test.ts\n    saxy.test.ts\n    string.test.ts\n   examples/\n    diff-reviewer-1.ts\n    diff-reviewer-2.ts\n    diff-reviewer-3.ts\n   agent-file-utils.ts\n   agent-name-normalization.ts\n   agent-name-resolver.ts\n   agent-template-validation.ts\n   array.ts\n   changes.ts\n   credentials.ts\n   currency.ts\n   dates.ts\n   error.ts\n   file.ts\n   git.ts\n   logger.ts\n   lru-cache.ts\n   messages.ts\n   min-heap.ts\n   model-utils.ts\n   object.ts\n   partial-json-delta.ts\n   patch.ts\n   promise.ts\n   random.ts\n   referral.ts\n   saxy.ts\n   string.knowledge.md\n   string.ts\n   stripe.ts\n   sync-failure.ts\n   xml.ts\n   zod-schema.ts\n  websockets/\n   websocket-client.ts\n   websocket-schema.ts\n  actions.ts\n  analytics.ts\n  browser-actions.ts\n  constants.ts\n  project-file-tree.ts\n knowledge.md\n package.json\n tsconfig.json\nevals/\n git-evals/\n  email-eval-results.ts\n  eval-levelcode.json\n  eval-manifold.json\n  eval-result-levelcode-mock.json\n  gen-evals.ts\n  judge-git-eval.ts\n  post-eval-analysis.ts\n  run-eval-set.ts\n  run-git-evals.ts\n  run-single-eval-process.ts\n  run-single-eval.ts\n  setup-test-repo.ts\n  types.ts\n .gitignore\n bun.lock\n constants.ts\n e2e-cat-app-script.ts\n knowledge.md\n package.json\n scaffolding.ts\n swe-bench-eval.ts\n swe-bench-ids.ts\n swe-bench.test.ts\n test-repos.json\n test-setup.ts\n tsconfig.json\nnpm-app/\n release/\n  index.js\n  package.json\n  README.md\n release-staging/\n  index.js\n  package.json\n  README.md\n scripts/\n  build-binary.js\n  generate-github-token.ts\n  patch-web-tree-sitter.ts\n  release.js\n  twitch-plays-levelcode.sh\n src/\n  __tests__/\n   display.test.ts\n   tool-handlers.test.ts\n  agents/\n   agent-utils.ts\n   load-agents.ts\n  checkpoints/\n   checkpoint-manager.ts\n   file-manager.ts\n  cli-handlers/\n   agent-creation-chat.ts\n   agents.ts\n   api-key.ts\n   checkpoint.ts\n   diff.ts\n   easter-egg.ts\n   inititalization-flow.ts\n   mini-chat.ts\n   publish.ts\n   subagent-list.ts\n   subagent.ts\n  display/\n   overrides.ts\n   print-mode.ts\n   squash-newlines.ts\n  json-config/\n   hooks.ts\n   parser.ts\n  native/\n   ripgrep.ts\n  terminal/\n   background.ts\n   run-command.ts\n  utils/\n   __tests__/\n    __snapshots__/\n     background-process-manager.test.ts.snap\n     frustration-detector.test.ts.snap\n     rage-detector.test.ts.snap\n     xml-stream-parser.test.ts.snap\n    background-process-manager.test.ts\n    rage-detector.test.ts\n    response-example-4-files.txt\n    tool-renderers.test.ts\n    xml-stream-parser.test.ts\n   agent-validation.ts\n   analytics.ts\n   detect-shell.ts\n   git.ts\n   logger.ts\n   rage-detector.ts\n   spinner.ts\n   suppress-console.ts\n   system-info.ts\n   terminal.ts\n   tool-renderers.ts\n   with-hang-detection.ts\n   xml-stream-parser.ts\n  workers/\n   checkpoint-worker.ts\n   project-context.ts\n  background-process-manager.ts\n  browser-runner.ts\n  chat-storage.ts\n  cli-definitions.ts\n  cli.ts\n  client.ts\n  config.ts\n  create-template-project.ts\n  credentials.ts\n  dev-process-manager.ts\n  diff-manager.ts\n  fingerprint.ts\n  index.ts\n  menu.ts\n  project-files.ts\n  rage-detectors.ts\n  startup-process-handler.ts\n  subagent-storage.ts\n  tool-handlers.ts\n  types.ts\n  web-scraper.ts\n .gitignore\n bunfig.toml\n package.json\n tsconfig.json\npackages/\n bigquery/\n  src/\n   client.ts\n   index.ts\n   schema.ts\n  knowledge.md\n  package.json\n  tsconfig.json\n billing/\n  src/\n   __tests__/\n    credit-delegation.test.ts\n    extract-owner-repo.test.ts\n    org-billing.test.ts\n   auto-topup.ts\n   balance-calculator.ts\n   billing.knowledge.md\n   conversion.ts\n   credit-delegation.ts\n   grant-credits.knowledge.md\n   grant-credits.ts\n   index.ts\n   org-billing.ts\n   org-monitoring.ts\n   usage-service.ts\n   utils.ts\n  knowledge.md\n  package.json\n  project.json\n  tsconfig.json\n build-tools/\n  executors/\n   infisical-run/\n    executor.ts\n    schema.json\n  executors.json\n  package.json\n  project.json\n  tsconfig.json\n code-map/\n  __tests__/\n   test-langs/\n    test.c\n    test.cpp\n    test.cs\n    test.go\n    test.java\n    test.js\n    test.php\n    test.py\n    test.rb\n    test.rs\n    test.ts\n   languages.test.ts\n   parse.test.ts\n  src/\n   tree-sitter-queries/\n    readme.md\n    tree-sitter-c_sharp-tags.scm\n    tree-sitter-c-tags.scm\n    tree-sitter-cpp-tags.scm\n    tree-sitter-go-tags.scm\n    tree-sitter-java-tags.scm\n    tree-sitter-javascript-tags.scm\n    tree-sitter-php-tags.scm\n    tree-sitter-python-tags.scm\n    tree-sitter-ruby-tags.scm\n    tree-sitter-rust-tags.scm\n    tree-sitter-typescript-tags.scm\n   index.ts\n   languages.ts\n   parse.ts\n  package.json\n  tsconfig.json\n internal/\n  src/\n   loops/\n    client.ts\n    index.ts\n    types.ts\n   openrouter-ai-sdk/\n    internal/\n     index.ts\n    schemas/\n     reasoning-details.ts\n    types/\n     index.ts\n     openrouter-chat-completions-input.ts\n     openrouter-chat-settings.ts\n    .gitignore\n    convert-to-openrouter-chat-messages.test.ts\n    convert-to-openrouter-chat-messages.ts\n    convert-to-openrouter-completion-prompt.ts\n    index.ts\n    map-openrouter-chat-logprobs.ts\n    map-openrouter-completion-logprobs.ts\n    map-openrouter-finish-reason.ts\n    openrouter-chat-language-model.test.ts\n    openrouter-chat-language-model.ts\n    openrouter-completion-language-model.test.ts\n    openrouter-completion-language-model.ts\n    openrouter-completion-settings.ts\n    openrouter-error.ts\n    openrouter-facade.ts\n    openrouter-provider-options.test.ts\n    openrouter-provider.ts\n    openrouter-stream-usage-accounting.test.ts\n    openrouter-usage-accounting.test.ts\n   utils/\n    __tests__/\n     version-utils.test.ts\n    auth.ts\n    version-utils.ts\n    xml-parser.ts\n   env.ts\n   index.ts\n   knowledge.md\n  package.json\n  tsconfig.json\npython-app/\n src/\n  levelcode/\n   __init__.py\n .gitignore\n knowledge.md\n LICENSE\n pyproject.toml\n README.md\nscripts/\n changelog/\n  2025-05-18-version-10283-release-enhanced-assistant-experience-system-stability.mdx\n  2025-05-25-version-10295-enhanced-ai-models-and-user-experience-improvements.mdx\n  2025-06-01-version-10305-release-enhanced-ai-models-new-commands-and-performance-improvements.mdx\n  docs.json\n ft-file-selection/\n  .gitignore\n  collect-tuning-data.ts\n  grade-traces.ts\n  print-recent-relabels.ts\n  print-recent-traces.ts\n  README.md\n  relabel-for-offline-scoring.ts\n  relabel-traces-with-context.ts\n  relabel-traces.ts\n .gitignore\n analyze-edit-blocks.ts\n analyze-model-usage.ts\n apply-credit-migration.ts\n calculate-average-spend.ts\n calculate-dau.ts\n calculate-monthly-usage.ts\n calculate-mrr.ts\n calculate-weekly-usage.ts\n cleanup-worktree.sh\n convert-escaped-newlines.ts\n count-edit-file.ts\n debug-log-subset.ts\n dev.sh\n export-user-emails.ts\n generate-ci-env.js\n generate-tool-definitions.ts\n get-changelog.ts\n init-worktree.ts\n package.json\n tsconfig.json\n update-stripe-subscriptions.ts\nsdk/\n scripts/\n  publish.js\n src/\n  tools/\n   change-file.ts\n   read-files.ts\n  types/\n   agent-definition.ts\n   tools.ts\n  client.ts\n  constants.ts\n  index.ts\n  process-stream.ts\n  websocket-client.ts\n .npmignore\n CHANGELOG.md\n package.json\n PUBLISHING.md\n README.md\n tsconfig.json\nweb/\n public/\n  levelcode-intro1.webm\n scripts/\n  discord/\n   index.ts\n   register-commands.ts\n src/\n  __tests__/\n   e2e/\n    home.spec.ts\n   unit/\n    home.spec.tsx\n  actions/\n   hello-action.ts\n  app/\n   [sponsee]/\n    page.tsx\n   admin/\n    file-picker/\n     page.tsx\n    orgs/\n     page.tsx\n    traces/\n     components/\n      chat-message.tsx\n      client-session-viewer.tsx\n      empty-state.tsx\n      error-boundary.tsx\n      loading-skeletons.tsx\n      timeline-chart.module.css\n      timeline-chart.tsx\n      trace-viewer.tsx\n     utils/\n      __tests__/\n       trace-processing.test.ts\n      trace-processing.ts\n     page.tsx\n    layout.tsx\n   affiliates/\n    actions.ts\n    page.tsx\n   agents/\n    page.tsx\n   api/\n    admin/\n     orgs/\n      [orgId]/\n       features/\n        [feature]/\n         route.ts\n      export/\n       route.ts\n      route.ts\n     relabel-for-user/\n      route.ts\n     traces/\n      [clientRequestId]/\n       messages/\n        route.ts\n       timeline/\n        route.ts\n      client/\n       [clientId]/\n        sessions/\n         route.ts\n     admin-auth.ts\n    agents/\n     [publisherId]/\n      [agentId]/\n       [version]/\n        route.ts\n       latest/\n        route.ts\n     publish/\n      route.ts\n     validate/\n      route.ts\n     route.ts\n    api-keys/\n     route.ts\n    auth/\n     [...nextauth]/\n      auth-options.ts\n      route.ts\n     cli/\n      code/\n       route.ts\n      logout/\n       route.ts\n      status/\n       route.ts\n    feed/\n     route.ts\n    git-evals/\n     visibility/\n      route.ts\n     route.ts\n    healthz/\n     route.ts\n    invites/\n     [token]/\n      route.ts\n    orgs/\n     [orgId]/\n      alerts/\n       [alertId]/\n        dismiss/\n         route.ts\n       route.ts\n      analytics/\n       export/\n        route.ts\n       route.ts\n      billing/\n       setup/\n        route.ts\n       status/\n        route.ts\n       subscription/\n        route.ts\n      credits/\n       route.ts\n      invitations/\n       [email]/\n        resend/\n         route.ts\n        route.ts\n       bulk/\n        route.ts\n       route.ts\n      members/\n       [userId]/\n        route.ts\n       route.ts\n      monitoring/\n       route.ts\n      publishers/\n       route.ts\n      repos/\n       [repoId]/\n        route.ts\n       route.ts\n      settings/\n       route.ts\n      usage/\n       export/\n        route.ts\n       route.ts\n      route.ts\n     slug/\n      [slug]/\n       route.ts\n     route.ts\n    publishers/\n     [id]/\n      organization/\n       route.ts\n     validate/\n      route.ts\n     route.ts\n    referrals/\n     [code]/\n      route.ts\n     helpers.ts\n     route.ts\n    stripe/\n     buy-credits/\n      route.ts\n     webhook/\n      route.ts\n    upload/\n     avatar/\n      route.ts\n    user/\n     auto-topup/\n      route.ts\n     profile/\n      route.ts\n     usage/\n      route.ts\n   config/\n    page.tsx\n   docs/\n    [category]/\n     layout.tsx\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   evals/\n    evals-table.tsx\n    page.tsx\n   invites/\n    [token]/\n     page.tsx\n   login/\n    page.tsx\n   onboard/\n    page.tsx\n   orgs/\n    [slug]/\n     analytics/\n      page.tsx\n     billing/\n      purchase/\n       page.tsx\n      setup/\n       page.tsx\n     repositories/\n      page.tsx\n     settings/\n      page.tsx\n     team/\n      page.tsx\n     usage/\n      page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   payment-success/\n    page.tsx\n   pricing/\n    page.tsx\n   privacy-policy/\n    page.tsx\n   publishers/\n    [id]/\n     agents/\n      [agentId]/\n       [version]/\n        page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   referrals/\n    [code]/\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   terms-of-service/\n    page.tsx\n   usage/\n    layout.tsx\n    page.tsx\n    usage-display.tsx\n   analytics.knowledge.md\n   layout.tsx\n   page.tsx\n   robots.ts\n   sitemap.ts\n  components/\n   agent/\n    json-viewer.tsx\n   auto-topup/\n    AutoTopupSettings.tsx\n    AutoTopupSettingsForm.tsx\n    AutoTopupSwitch.tsx\n    BaseAutoTopupSettings.tsx\n    BaseAutoTopupSettingsForm.tsx\n    BaseAutoTopupSwitch.tsx\n    constants.ts\n    OrgAutoTopupSettings.tsx\n    OrgAutoTopupSettingsForm.tsx\n    OrgAutoTopupSwitch.tsx\n    types.ts\n   credits/\n    CreditManagementSection.tsx\n    CreditPurchaseSection.tsx\n   docs/\n    mdx/\n     code-demo.tsx\n     custom-link.tsx\n     markdown-table.tsx\n     mdx-components.tsx\n     mermaid-diagram.tsx\n     schema-display.tsx\n    copy-heading.tsx\n    doc-sidebar.tsx\n    docs.knowledge.md\n    toc.tsx\n   login/\n    login-card.tsx\n    login-client-wrapper.tsx\n   navbar/\n    navbar.tsx\n    user-dropdown.tsx\n   organization/\n    advanced-monitor.tsx\n    billing-alerts.tsx\n    billing-reports.tsx\n    billing-status.tsx\n    credit-monitor.tsx\n    model-config-sheet.tsx\n    organization-success-modal.tsx\n    repository-management.tsx\n    team-management.tsx\n   providers/\n    query-client-provider.tsx\n   publisher/\n    basic-info-step.tsx\n    ownership-step.tsx\n    profile-details-step.tsx\n    step-template.tsx\n   sign-in/\n    sign-in-button.tsx\n    sign-in-card-footer.tsx\n   ui/\n    landing/\n     competition/\n      claude-code.tsx\n      cline.tsx\n      cursor.tsx\n      github-copilot.tsx\n      index.tsx\n      tabs.tsx\n     feature/\n      browser-comparison.tsx\n      chart-illustration.tsx\n      code-illustration.tsx\n      highlight-text.tsx\n      index.tsx\n      workflow-illustration.tsx\n     animated-element.tsx\n     constants.ts\n     cta-section.tsx\n     demo-code-display.tsx\n     testimonials-section.tsx\n     types.ts\n    terminal/\n     index.tsx\n     style.css\n     terminal-input.tsx\n     terminal-output.tsx\n    avatar-upload.tsx\n    background-beams.tsx\n    badge.tsx\n    banner.tsx\n    button.tsx\n    card.tsx\n    collapsible.tsx\n    credit-confetti.tsx\n    decorative-blocks.tsx\n    dialog.tsx\n    dropdown-menu.tsx\n    enhanced-copy-button.tsx\n    footer.tsx\n    hero-buttons.tsx\n    hero.tsx\n    input.tsx\n    install-dialog.tsx\n    label.tsx\n    neon-gradient-button.tsx\n    progress.tsx\n    radio-group.tsx\n    section.tsx\n    select.tsx\n    separator.tsx\n    sheet.tsx\n    sidebar.tsx\n    skeleton-loading.tsx\n    skeleton.tsx\n    slider.tsx\n    switch.tsx\n    table.tsx\n    tabs.tsx\n    textarea.tsx\n    toast.tsx\n    toaster.tsx\n    tooltip.tsx\n    use-toast.ts\n   BrowserPreview.tsx\n   card-with-beams.tsx\n   CookieConsentCard.tsx\n   footer.tsx\n   icons.tsx\n   IDEDemo.tsx\n   layout-wrapper.tsx\n   TerminalDemo.tsx\n   theme-provider.tsx\n   theme-switcher.tsx\n  content/\n   advanced/\n    claude-code-comparison.mdx\n    config.mdx\n    how-does-it-work.mdx\n    large-projects.mdx\n    troubleshooting.mdx\n    what-models.mdx\n   agents/\n    agent-reference.mdx\n    creating-new-agents.mdx\n    customizing-agents.mdx\n    overview.mdx\n    troubleshooting-agent-customization.mdx\n   case-studies/\n    _cta.mdx\n    benjamin-bryant.mdx\n    oliver-lukesch.mdx\n   help/\n    faq.mdx\n    getting-started.mdx\n   tips/\n    best-practices.mdx\n    keyboard-shortcuts.mdx\n    knowledge-files.mdx\n    other-use-cases.mdx\n    version-control.mdx\n    where-levelcode-shines.mdx\n  discord/\n   client.ts\n   rate-limiter.ts\n  hooks/\n   use-auto-topup.ts\n   use-install-dialog.ts\n   use-mobile.tsx\n   use-model-config.ts\n   use-org-auto-topup.ts\n   use-organization-data.ts\n   use-user-profile.ts\n  lib/\n   server/\n    referral.ts\n   validators/\n    publisher.ts\n   admin-auth.ts\n   constant.ts\n   currency.ts\n   docs.ts\n   fonts.ts\n   organization-permissions.ts\n   PostHogProvider.tsx\n   publisher-permissions.ts\n   remark-code-to-codedemo.ts\n   server-init.ts\n   SessionProvider.tsx\n   stripe-utils.ts\n   testimonials.ts\n   trackConversions.ts\n   utils.ts\n  styles/\n   globals.css\n  types/\n   docs.ts\n   user.ts\n  util/\n   logger.ts\n .eslintignore\n .eslintrc.js\n .gitignore\n .prettierignore\n .prettierrc.js\n commitlint.config.js\n components.json\n contentlayer.config.ts\n jest.config.js\n jest.setup.js\n knowledge.md\n next.config.mjs\n package.json\n playwright.config.ts\n postcss.config.cjs\n README.md\n tailwind.config.ts\n tsconfig.json\n.envrc\n.gitignore\n.infisical.json\n.prettierrc\nauthentication.knowledge.md\nbun.lock\nbunfig.toml\nlevelcode.json\neslint.config.js\nknowledge.md\npackage.json\nREADME.md\ntsconfig.base.json\ntsconfig.json\nWINDOWS.md\n",
              "tokenCount": 9007,
              "truncationLevel": "none"
            }
          ]
        }
      ],
      "parentAgentId": "D-Ogo19lSyI"
    },
    {
      "type": "tool_result",
      "toolCallId": "877e5ab3-210d-4cf9-84e6-267e388d68ad",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": ".agents/examples/diff-reviewer-1.ts:\n4:  id: 'diff-reviewer-1',\n\n.agents/examples/diff-reviewer-2.ts:\n7:  id: 'diff-reviewer-2',\n\n.agents/examples/diff-reviewer-3.ts:\n7:  id: 'diff-reviewer-3',\n\n./backend/src/templates/agents/agent-builder.ts:\n67:          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer'),\n\n./common/src/util/examples/diff-reviewer-1.ts:\n4:  id: 'diff-reviewer-1',\n\n./common/src/util/examples/diff-reviewer-2.ts:\n7:  id: 'diff-reviewer-2',\n\n./common/src/util/examples/diff-reviewer-3.ts:\n7:  id: 'diff-reviewer-3',",
            "message": "Exit code: 0"
          }
        }
      ],
      "parentAgentId": "D-Ofa741I0M"
    },
    {
      "type": "tool_call",
      "toolCallId": "88b32613-fdb8-4da3-9ec1-a56e04d23a2b",
      "toolName": "code_search",
      "input": {
        "pattern": "your-custom-agent"
      },
      "agentId": "D-Ofa741I0M",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "88b32613-fdb8-4da3-9ec1-a56e04d23a2b",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": "No results",
            "message": "Exit code: 1"
          }
        }
      ],
      "parentAgentId": "D-Ofa741I0M"
    },
    {
      "type": "tool_call",
      "toolCallId": "31e44afe-a9e2-4fc6-957b-297300888473",
      "toolName": "code_search",
      "input": {
        "pattern": "spawnable agents|spawnAgents"
      },
      "agentId": "D-Ofa741I0M",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "31e44afe-a9e2-4fc6-957b-297300888473",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": "./npm-app/src/client.ts:\n1354:        // Mark any spawnable agents as inactive when the main response completes\n\n./npm-app/src/subagent-storage.ts:\n214: * Get recent spawnable agents (sorted by last activity)\n223: * Get spawnable agents in chronological order (oldest first)\n\n./backend/knowledge.md:\n7:Users can now reference spawnable agents without org prefixes in their agent templates. For example:\n77:    spawnableAgents?: {  // Modify spawnable agents list\n\n./npm-app/src/agents/load-agents.ts:\n86:      `${green('Configured spawnable agents:')} ${spawnableAgents\n\n./npm-app/src/cli.ts:\n949:            // Give control back to user when no spawnable agents exist\n\n./backend/src/tools/definitions/tool/spawn-agents-async.ts:\n6:export const spawnAgentsAsyncTool = {\n\n./backend/src/tools/definitions/tool/spawn-agents.ts:\n6:export const spawnAgentsTool = {\n\n./backend/src/tools/definitions/list.ts:\n16:import { spawnAgentsTool } from './tool/spawn-agents'\n17:import { spawnAgentsAsyncTool } from './tool/spawn-agents-async'\n43:  spawn_agents: spawnAgentsTool,\n44:  spawn_agents_async: spawnAgentsAsyncTool,\n\n./common/src/templates/agent-validation.ts:\n199:    // Validate spawnable agents (skip if requested, e.g., for database agents)\n\n./web/src/app/api/agents/publish/route.ts:\n222:    // Verify that all spawnable agents are either published or part of this request\n\n./common/src/__tests__/agent-validation.test.ts:\n116:    test.skip('should validate spawnable agents', async () => {\n141:        'Invalid spawnable agents: nonexistent_agent',\n274:    it('should validate spawnable agents including dynamic agents from first pass', async () => {\n287:            spawnableAgents: [], // No spawnable agents\n\n./common/src/__tests__/dynamic-agent-template-schema.test.ts:\n336:        const spawnAgentsError = result.error.issues.find((issue) =>\n341:        expect(spawnAgentsError).toBeDefined()\n342:        expect(spawnAgentsError?.message).toContain(\n\n./web/src/content/agents/troubleshooting-agent-customization.mdx:\n204:2. Limit spawnable agents:\n\n./common/src/util/agent-name-normalization.ts:\n6: * 2. Try with DEFAULT_ORG_PREFIX for spawnable agents\n10: * and handles the common case where users reference spawnable agents\n27:  // Try with DEFAULT_ORG_PREFIX for spawnable agents\n\n./common/src/tools/list.ts:\n14:import { spawnAgentsParams } from './params/tool/spawn-agents'\n15:import { spawnAgentsAsyncParams } from './params/tool/spawn-agents-async'\n39:  spawn_agents: spawnAgentsParams,\n40:  spawn_agents_async: spawnAgentsAsyncParams,\n\n./common/src/types/dynamic-agent-template.ts:\n98:  // Tools and spawnable agents\n\n./common/src/json-config/constants.ts:\n91:      .describe('Specify complete list of spawnable agents for the base agent'),\n\n./common/src/util/agent-template-validation.ts:\n9: * Centralized validation for spawnable agents.\n10: * Validates that all spawnable agents reference valid agent types.\n35: * Formats a validation error message for spawnable agents\n41:  let message = `Invalid spawnable agents: ${invalidAgents.join(', ')}. Double check the id, including the org prefix if applicable.`\n\n./common/src/json-config/__tests__/__snapshots__/stringify-schema.test.ts.snap:\n85:  // (optional): Specify complete list of spawnable agents for the base agent\n\n./common/src/tools/params/tool/spawn-agents.ts:\n7:export const spawnAgentsParams = {\n\n./common/src/tools/params/tool/spawn-agents-async.ts:\n7:export const spawnAgentsAsyncParams = {",
            "message": "Exit code: 0"
          }
        }
      ],
      "parentAgentId": "D-Ofa741I0M"
    },
    {
      "type": "tool_call",
      "toolCallId": "9efee56f-fbb6-44e0-83c8-1e662f712455",
      "toolName": "code_search",
      "input": {
        "pattern": "agent builder|agentBuilder"
      },
      "agentId": "D-Ofa741I0M",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "9efee56f-fbb6-44e0-83c8-1e662f712455",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": "./npm-app/src/cli-handlers/agent-creation-chat.ts:\n77:  // Create a simple prompt for the agent builder with the requirements\n88:    // Use the resetAgent helper to properly switch to agent-builder which automatically spawns the agent builder\n\n./npm-app/src/cli-handlers/agents.ts:\n560:    // Switch to agent-builder which automatically spawns the agent builder for agent creation\n\n./backend/src/templates/agents/agent-builder.ts:\n30:export const agentBuilder = (\n135:      'You are an expert agent builder specialized in creating new agent templates for the levelcode system. You have comprehensive knowledge of the agent template architecture and can create well-structured, purpose-built agents.',\n224:The agent builder is focused on creating new agent templates based on user specifications.\n\n./backend/src/templates/agent-list.ts:\n18:import { agentBuilder } from './agents/agent-builder'\n77:      ...agentBuilder(models.openrouter_claude_sonnet_4),",
            "message": "Exit code: 0"
          }
        }
      ],
      "parentAgentId": "D-Ofa741I0M"
    },
    {
      "type": "tool_call",
      "toolCallId": "d7faf371-a43a-44de-829f-0c21cefdb370",
      "toolName": "code_search",
      "input": {
        "pattern": "agent personas|agentPersonas"
      },
      "agentId": "D-Ofa741I0M",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "d7faf371-a43a-44de-829f-0c21cefdb370",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": "./common/src/constants/agents.ts:\n3:// Define agent personas with their shared characteristics",
            "message": "Exit code: 0"
          }
        }
      ],
      "parentAgentId": "D-Ofa741I0M"
    },
    {
      "type": "tool_call",
      "toolCallId": "cbcd47c4-b9ab-4235-a6ae-d5ca80e0d822",
      "toolName": "set_output",
      "input": {
        "results": [
          {
            "stdout": ".agents/examples/diff-reviewer-1.ts:\n4:  id: 'diff-reviewer-1',\n\n.agents/examples/diff-reviewer-2.ts:\n7:  id: 'diff-reviewer-2',\n\n.agents/examples/diff-reviewer-3.ts:\n7:  id: 'diff-reviewer-3',\n\n./backend/src/templates/agents/agent-builder.ts:\n67:          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer'),\n\n./common/src/util/examples/diff-reviewer-1.ts:\n4:  id: 'diff-reviewer-1',\n\n./common/src/util/examples/diff-reviewer-2.ts:\n7:  id: 'diff-reviewer-2',\n\n./common/src/util/examples/diff-reviewer-3.ts:\n7:  id: 'diff-reviewer-3',",
            "message": "Exit code: 0"
          },
          {
            "stdout": "No results",
            "message": "Exit code: 1"
          },
          {
            "stdout": "./npm-app/src/client.ts:\n1354:        // Mark any spawnable agents as inactive when the main response completes\n\n./npm-app/src/subagent-storage.ts:\n214: * Get recent spawnable agents (sorted by last activity)\n223: * Get spawnable agents in chronological order (oldest first)\n\n./backend/knowledge.md:\n7:Users can now reference spawnable agents without org prefixes in their agent templates. For example:\n77:    spawnableAgents?: {  // Modify spawnable agents list\n\n./npm-app/src/agents/load-agents.ts:\n86:      `${green('Configured spawnable agents:')} ${spawnableAgents\n\n./npm-app/src/cli.ts:\n949:            // Give control back to user when no spawnable agents exist\n\n./backend/src/tools/definitions/tool/spawn-agents-async.ts:\n6:export const spawnAgentsAsyncTool = {\n\n./backend/src/tools/definitions/tool/spawn-agents.ts:\n6:export const spawnAgentsTool = {\n\n./backend/src/tools/definitions/list.ts:\n16:import { spawnAgentsTool } from './tool/spawn-agents'\n17:import { spawnAgentsAsyncTool } from './tool/spawn-agents-async'\n43:  spawn_agents: spawnAgentsTool,\n44:  spawn_agents_async: spawnAgentsAsyncTool,\n\n./common/src/templates/agent-validation.ts:\n199:    // Validate spawnable agents (skip if requested, e.g., for database agents)\n\n./web/src/app/api/agents/publish/route.ts:\n222:    // Verify that all spawnable agents are either published or part of this request\n\n./common/src/__tests__/agent-validation.test.ts:\n116:    test.skip('should validate spawnable agents', async () => {\n141:        'Invalid spawnable agents: nonexistent_agent',\n274:    it('should validate spawnable agents including dynamic agents from first pass', async () => {\n287:            spawnableAgents: [], // No spawnable agents\n\n./common/src/__tests__/dynamic-agent-template-schema.test.ts:\n336:        const spawnAgentsError = result.error.issues.find((issue) =>\n341:        expect(spawnAgentsError).toBeDefined()\n342:        expect(spawnAgentsError?.message).toContain(\n\n./web/src/content/agents/troubleshooting-agent-customization.mdx:\n204:2. Limit spawnable agents:\n\n./common/src/util/agent-name-normalization.ts:\n6: * 2. Try with DEFAULT_ORG_PREFIX for spawnable agents\n10: * and handles the common case where users reference spawnable agents\n27:  // Try with DEFAULT_ORG_PREFIX for spawnable agents\n\n./common/src/tools/list.ts:\n14:import { spawnAgentsParams } from './params/tool/spawn-agents'\n15:import { spawnAgentsAsyncParams } from './params/tool/spawn-agents-async'\n39:  spawn_agents: spawnAgentsParams,\n40:  spawn_agents_async: spawnAgentsAsyncParams,\n\n./common/src/types/dynamic-agent-template.ts:\n98:  // Tools and spawnable agents\n\n./common/src/json-config/constants.ts:\n91:      .describe('Specify complete list of spawnable agents for the base agent'),\n\n./common/src/util/agent-template-validation.ts:\n9: * Centralized validation for spawnable agents.\n10: * Validates that all spawnable agents reference valid agent types.\n35: * Formats a validation error message for spawnable agents\n41:  let message = `Invalid spawnable agents: ${invalidAgents.join(', ')}. Double check the id, including the org prefix if applicable.`\n\n./common/src/json-config/__tests__/__snapshots__/stringify-schema.test.ts.snap:\n85:  // (optional): Specify complete list of spawnable agents for the base agent\n\n./common/src/tools/params/tool/spawn-agents.ts:\n7:export const spawnAgentsParams = {\n\n./common/src/tools/params/tool/spawn-agents-async.ts:\n7:export const spawnAgentsAsyncParams = {",
            "message": "Exit code: 0"
          },
          {
            "stdout": "./npm-app/src/cli-handlers/agent-creation-chat.ts:\n77:  // Create a simple prompt for the agent builder with the requirements\n88:    // Use the resetAgent helper to properly switch to agent-builder which automatically spawns the agent builder\n\n./npm-app/src/cli-handlers/agents.ts:\n560:    // Switch to agent-builder which automatically spawns the agent builder for agent creation\n\n./backend/src/templates/agents/agent-builder.ts:\n30:export const agentBuilder = (\n135:      'You are an expert agent builder specialized in creating new agent templates for the levelcode system. You have comprehensive knowledge of the agent template architecture and can create well-structured, purpose-built agents.',\n224:The agent builder is focused on creating new agent templates based on user specifications.\n\n./backend/src/templates/agent-list.ts:\n18:import { agentBuilder } from './agents/agent-builder'\n77:      ...agentBuilder(models.openrouter_claude_sonnet_4),",
            "message": "Exit code: 0"
          },
          {
            "stdout": "./common/src/constants/agents.ts:\n3:// Define agent personas with their shared characteristics",
            "message": "Exit code: 0"
          }
        ]
      },
      "agentId": "D-Ofa741I0M",
      "parentAgentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "cbcd47c4-b9ab-4235-a6ae-d5ca80e0d822",
      "toolName": "set_output",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Output set"
          }
        }
      ],
      "parentAgentId": "D-Ofa741I0M"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-Ofa741I0M",
      "agentType": "code-searcher",
      "displayName": "Code Searcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "searchQueries": [
          {
            "pattern": "diff-reviewer"
          },
          {
            "pattern": "your-custom-agent"
          },
          {
            "pattern": "spawnable agents|spawnAgents"
          },
          {
            "pattern": "agent builder|agentBuilder"
          },
          {
            "pattern": "agent personas|agentPersonas"
          }
        ]
      }
    },
    {
      "type": "text",
      "agentId": "D-OfaV526OE",
      "text": ".agents/brainstormer.ts\n.agents/planner.ts\n.agents/researcher.ts\n.agents/reviewer.ts\n.agents/thinker.ts\n.agents/superagent.ts\nbackend/src/templates/agents/agent-list.ts\nbackend/src/templates/agents/base.ts\ncommon/src/constants/agents.ts\ncommon/src/types/agent-template.ts\nnpm-app/src/agents/load-agents.ts\nweb/src/content/agents/overview.mdx"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-OgGtcToUQ",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-OfaV526OE",
      "prompt": "",
      "params": {
        "prompt": "agent personas, list of agent personalities or types"
      }
    },
    {
      "type": "tool_result",
      "toolCallId": "3c204c3d-25bd-4014-b0b9-935f91f963e5",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Liszt the File Lister",
              "agentType": "file-lister",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": ".agents/brainstormer.ts\n.agents/planner.ts\n.agents/researcher.ts\n.agents/reviewer.ts\n.agents/thinker.ts\n.agents/superagent.ts\nbackend/src/templates/agents/agent-list.ts\nbackend/src/templates/agents/base.ts\ncommon/src/constants/agents.ts\ncommon/src/types/agent-template.ts\nnpm-app/src/agents/load-agents.ts\nweb/src/content/agents/overview.mdx"
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ],
      "parentAgentId": "D-OfaV526OE"
    },
    {
      "type": "tool_call",
      "toolCallId": "f392a70e-4bbb-4025-9d8e-e88342eab3f0",
      "toolName": "read_files",
      "input": {
        "paths": [
          ".agents/brainstormer.ts",
          ".agents/planner.ts",
          ".agents/researcher.ts",
          ".agents/reviewer.ts",
          ".agents/thinker.ts",
          ".agents/superagent.ts",
          "backend/src/templates/agents/agent-list.ts",
          "backend/src/templates/agents/base.ts",
          "common/src/constants/agents.ts",
          "common/src/types/agent-template.ts",
          "npm-app/src/agents/load-agents.ts",
          "web/src/content/agents/overview.mdx"
        ]
      },
      "agentId": "D-OfaV526OE",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "f392a70e-4bbb-4025-9d8e-e88342eab3f0",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": ".agents/brainstormer.ts",
              "content": "import { publisher, version } from './constants'\n\nimport type { AgentDefinition } from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'brainstormer',\n  version,\n  publisher,\n  displayName: 'Brian the Brainstormer',\n  model: 'anthropic/claude-4-sonnet-20250522',\n\n  includeMessageHistory: true,\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description: 'The problem or topic to brainstorm about.',\n    },\n  },\n  outputMode: 'last_message',\n\n  toolNames: ['spawn_agents', 'end_turn'],\n  spawnableAgents: [\n    `levelcode/thinker@${version}`,\n    `levelcode/researcher@${version}`,\n  ],\n\n  spawnPurposePrompt:\n    'Acts as a creative thought partner, generating ideas and exploring alternative viewpoints to help think through problems.',\n\n  systemPrompt: `# Persona: Brian the Brainstormer - Creative Thought Partner\n\nYou are an expert brainstorming partner who excels at generating creative ideas, exploring alternative approaches, and helping users think through problems from multiple angles.\n\n## Your Role\n\n- **Idea Generator**: Propose creative and unconventional solutions\n- **Devil's Advocate**: Challenge assumptions and explore counterarguments\n- **Perspective Shifter**: Offer different viewpoints and approaches\n- **Question Asker**: Ask probing questions that unlock new thinking\n- **Pattern Connector**: Find unexpected connections between concepts\n\n## Your Approach\n\n- Think divergently before converging on solutions\n- Explore \"what if\" scenarios and edge cases\n- Consider multiple stakeholder perspectives\n- Balance practical constraints with creative possibilities\n- Use analogies and metaphors to spark new insights\n- Challenge the status quo respectfully\n\n## Guidelines\n\n- Be enthusiastic and encouraging about exploration\n- Offer 3-5 distinct alternatives when possible\n- Ask clarifying questions to understand context better\n- Build on the user's ideas while adding your own spin\n- Consider both short-term and long-term implications\n- Balance optimism with realistic assessment\n\nRemember: Your goal is to expand thinking, not to provide definitive answers. Help the user see their problem space more clearly and discover new possibilities they might not have considered.`,\n\n  instructionsPrompt:\n    'Act as a creative thought partner. Generate multiple perspectives, challenge assumptions, explore alternatives, and ask probing questions to help think through problems more thoroughly.',\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": ".agents/planner.ts",
              "content": "import { publisher, version } from './constants'\n\nimport type { AgentDefinition } from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'planner',\n  version,\n  publisher,\n  model: 'x-ai/grok-4-07-09',\n  displayName: 'Peter Plan the Planner',\n  toolNames: ['think_deeply', 'spawn_agents', 'end_turn'],\n  spawnableAgents: [],\n  inputSchema: {\n    prompt: {\n      description:\n        'What problem you to solve and a few ideas and suggestions for the plan',\n      type: 'string',\n    },\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: true,\n\n  spawnPurposePrompt: 'Agent that formulates a comprehensive plan to a prompt.',\n  systemPrompt: `You are an expert software architect. You are good at creating comprehensive plans to tackle the user request.`,\n  instructionsPrompt: `Steps for your response:\n1. Use the <think_deeply> tool to think through cruxes for the plan, and tricky cases. Consider alternative approaches. Be sure to close the tool call with </think_deeply>.\n2. Write out your plan in a concise way.\n3. Spawn 1-5 dry run agents to sketch portions of the implementation of the plan. (Important: do not forget to close the tool call with \"</spawn_agents>\"!)\n4. Synthesize all the information and rewrite the full plan to be the best it can be. Use the end_turn tool.`,\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": ".agents/researcher.ts",
              "content": "import { publisher, version } from './constants'\n\nimport type { AgentDefinition } from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'researcher',\n  version,\n  publisher,\n  model: 'gemini-2.5-flash-preview-05-20',\n  displayName: 'Reid Searcher the Researcher',\n  toolNames: ['web_search', 'read_docs', 'read_files', 'end_turn'],\n\n  inputSchema: {\n    prompt: {\n      description:\n        'A question you would like answered using web search and documentation',\n      type: 'string',\n    },\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: false,\n\n  spawnPurposePrompt:\n    'Expert at researching topics using web search and documentation.',\n  systemPrompt: `# Persona: {LEVELCODE_AGENT_NAME}\n\nYou are an expert researcher who can search the web and read documentation to find relevant information. Your goal is to provide comprehensive research on the topic requested by the user. Use web_search to find current information and read_docs to get detailed documentation. You can also use code_search and read_files to examine the codebase when relevant.\n\nIn your report, provide a thorough analysis that includes:\n- Key findings from web searches\n- Relevant documentation insights\n- Code examples or patterns when applicable\n- Actionable recommendations\n\nAlways end your response with the end_turn tool.`,\n  stepPrompt: \"Don't forget to end your response with the end_turn tool.\",\n  handleSteps: function* ({ agentState, prompt, params }) {\n    yield {\n      toolName: 'web_search',\n      args: { query: prompt ?? '', depth: 'standard' },\n    }\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": ".agents/reviewer.ts",
              "content": "import { publisher, version } from './constants'\n\nimport type { AgentDefinition } from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'reviewer',\n  version,\n  publisher,\n  model: 'gemini-2.5-pro-preview-06-05',\n  displayName: 'Nit Pick Nick the Reviewer',\n\n  toolNames: ['end_turn', 'run_file_change_hooks'],\n\n  inputSchema: {\n    prompt: {\n      description: 'What should be reviewed. Be brief.',\n      type: 'string',\n    },\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: true,\n\n  spawnPurposePrompt:\n    'Reviews file changes and responds with critical feedback. Use this after making any significant change to the codebase.',\n  systemPrompt: `# Persona: {LEVELCODE_AGENT_NAME}\n\n\nconst definition: AgentDefinition = {\nYou are an expert programmer who can articulate very clear feedback on code changes.\n{LEVELCODE_TOOLS_PROMPT}\n\n{LEVELCODE_AGENTS_PROMPT}`,\n  instructionsPrompt: `Your task is to provide helpful feedback on the last file changes made by the assistant. You should critique the code changes made recently in the above conversation.\n\nIMPORTANT: After analyzing the file changes, you should:\n1. Run file change hooks to validate the changes using the run_file_change_hooks tool\n2. Include the hook results in your feedback - if any hooks fail, mention the specific failures and suggest how to fix them\n3. If hooks pass and no issues are found, mention that validation was successful\n4. Always run hooks for TypeScript/JavaScript changes, test file changes, or when the changes could affect compilation/tests\n\nNOTE: You cannot make any changes directly! You can only suggest changes.\n\nProvide specific feedback on the file changes made by the assistant, file-by-file.\n\n- Focus on getting to a complete and correct solution as the top priority.\n- Try to keep any changes to the codebase as minimal as possible.\n- Simplify any logic that can be simplified.\n- Where a function can be reused, reuse it and do not create a new one.\n- Make sure that no new dead code is introduced.\n- Make sure there are no missing imports.\n- Make sure no sections were deleted that weren't supposed to be deleted.\n- Make sure the new code matches the style of the existing code.\n\nBe concise and to the point. After providing all your feedback, use the end_turn tool to end your response.`,\n  stepPrompt:\n    \"IMPORTANT: Don't forget to end your response with the end_turn tool: <end_turn></end_turn>\",\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": ".agents/thinker.ts",
              "content": "import { publisher, version } from './constants'\n\nimport type { AgentDefinition } from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'thinker',\n  version,\n  publisher,\n  model: 'x-ai/grok-4-07-09',\n  displayName: 'Theo the Theorizer',\n\n  inputSchema: {\n    prompt: {\n      description: 'The problem you are trying to solve',\n      type: 'string',\n    },\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: true,\n  toolNames: ['end_turn'],\n  spawnableAgents: [],\n  spawnPurposePrompt:\n    'Does deep thinking given the current messages and a specific prompt to focus on. Use this to help you solve a specific problem.',\n  systemPrompt: `# Persona: {LEVELCODE_AGENT_NAME}\n\nYou are an expert programmer.\n{LEVELCODE_TOOLS_PROMPT}\n\n{LEVELCODE_AGENTS_PROMPT}`,\n  instructionsPrompt: `Think deeply, step by step, about the user request and how best to approach it.\n\nConsider edge cases, potential issues, and alternative approaches.\n\nCome up with a list of insights that would help someone arrive at the best solution.\n\nTry not to be too prescriptive or confident in one solution. Instead, give clear arguments and reasoning.\n\nYou must be extremely concise and to the point.`,\n  stepPrompt:\n    \"Don't forget to end your response with the end_turn tool: <end_turn></end_turn>\",\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": ".agents/superagent.ts",
              "content": "import { publisher, version } from './constants'\n\nimport type { AgentDefinition } from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'superagent',\n  version,\n  publisher,\n  model: 'anthropic/claude-4-sonnet-20250522',\n  displayName: 'Superagent',\n\n  toolNames: ['spawn_agents', 'spawn_agents_async', 'end_turn', 'think_deeply'],\n  spawnableAgents: [\n    `levelcode/thinker@${version}`,\n    `levelcode/base@${version}`,\n    `levelcode/ask@${version}`,\n  ],\n\n  inputSchema: {\n    prompt: {\n      description: 'A coding task to complete',\n      type: 'string',\n    },\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: false,\n\n  spawnPurposePrompt:\n    'Superagent that can spawn multiple code editing agents to complete a task.',\n  systemPrompt: `You are an expert orchestrator that can solve any problem, including coding tasks.`,\n  instructionsPrompt: `Answer the user\\'s question or complete the task by spawning copies of the base agent.\n\nIf you have all the information you need, just write out the response and do not spawn any agents.\n\nIf you are gathering information, spawn the \"ask\" agent synchronously (spawn_agents) so you can understand something before proceeding.\n\nIf you are delegating a coding task, spawn the \"base\" agent *asynchronously* (spawn_agents_async) so you can help the user with other tasks while the spawned agent works on the code.\n\nPrefer sending a message to a previous agent over spawning a new agent, especially if that agent was previously working on a similar task.\n\nFeel free to ask the user for clarification if you are unsure what to do.`,\n  stepPrompt:\n    'Spawn as many agents as you can to help. Use the end_turn tool at the end of your response when you have completed the user request or want the user to respond to your message or if you are waiting for a response from an agent.',\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agents/agent-list.ts",
              "content": "[FILE_DOES_NOT_EXIST]",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agents/base.ts",
              "content": "import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\nimport z from 'zod/v4'\n\nimport {\n  baseAgentAgentStepPrompt,\n  baseAgentSystemPrompt,\n  baseAgentUserInputPrompt,\n} from '../base-prompts'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\n\nexport const base = (\n  model: Model,\n  allAvailableAgents?: string[],\n): Omit<AgentTemplate, 'id'> => ({\n  model,\n  displayName: AGENT_PERSONAS.base.displayName,\n  spawnPurposePrompt: AGENT_PERSONAS.base.purpose,\n  inputSchema: {\n    prompt: z.string().describe('A coding task to complete'),\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: false,\n  toolNames: [\n    'create_plan',\n    'run_terminal_command',\n    'str_replace',\n    'write_file',\n    'spawn_agents',\n    'add_subgoal',\n    'browser_logs',\n    'code_search',\n    'end_turn',\n    'read_files',\n    'think_deeply',\n    'update_subgoal',\n  ],\n  spawnableAgents: allAvailableAgents\n    ? (allAvailableAgents as any[])\n    : [\n        AgentTemplateTypes.file_explorer,\n        AgentTemplateTypes.file_picker,\n        AgentTemplateTypes.researcher,\n        AgentTemplateTypes.thinker,\n        AgentTemplateTypes.reviewer,\n      ],\n\n  systemPrompt: baseAgentSystemPrompt(model),\n  instructionsPrompt: baseAgentUserInputPrompt(model),\n  stepPrompt: baseAgentAgentStepPrompt(model),\n})\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/constants/agents.ts",
              "content": "import type { AgentTemplateTypes } from '../types/session-state'\n\n// Define agent personas with their shared characteristics\nexport const AGENT_PERSONAS = {\n  // Base agents - all use Buffy persona\n  base: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  base_lite: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  base_max: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  base_experimental: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  claude4_gemini_thinking: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n\n  base_agent_builder: {\n    displayName: 'Buffy the Enthusiastic Agent Builder',\n    purpose:\n      'Enhanced base agent that can create custom agents and handle all coding tasks',\n  } as const,\n\n  superagent: {\n    displayName: 'Superagent',\n    purpose:\n      'Superagent that can spawn multiple code editing agents to complete a task.',\n  } as const,\n\n  // Ask mode\n  ask: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base ask-mode agent that orchestrates the full response.',\n  } as const,\n\n  // Specialized agents\n  thinker: {\n    displayName: 'Theo the Theorizer',\n    purpose:\n      'Does deep thinking given the current messages and a specific prompt to focus on. Use this to help you solve a specific problem.',\n  } as const,\n  file_explorer: {\n    displayName: 'Dora The File Explorer',\n    purpose: 'Expert at exploring a codebase and finding relevant files.',\n  } as const,\n  file_picker: {\n    displayName: 'Fletcher the File Fetcher',\n    purpose: 'Expert at finding relevant files in a codebase.',\n  } as const,\n  researcher: {\n    displayName: 'Reid Searcher the Researcher',\n    purpose: 'Expert at researching topics using web search and documentation.',\n  } as const,\n  planner: {\n    displayName: 'Peter Plan the Planner',\n    purpose: 'Agent that formulates a comprehensive plan to a prompt.',\n    hidden: true,\n  } as const,\n  dry_run: {\n    displayName: 'Sketch the Dry Runner',\n    purpose: 'Agent that takes a plan and try to implement it in a dry run.',\n    hidden: true,\n  } as const,\n  reviewer: {\n    displayName: 'Nit Pick Nick the Reviewer',\n    purpose:\n      'Reviews file changes and responds with critical feedback. Use this after making any significant change to the codebase.',\n  } as const,\n  agent_builder: {\n    displayName: 'Bob the Agent Builder',\n    purpose: 'Creates new agent templates for the levelcode mult-agent system',\n    hidden: false,\n  } as const,\n} as const satisfies Partial<\n  Record<\n    keyof typeof AgentTemplateTypes,\n    { displayName: string; purpose: string; hidden?: boolean }\n  >\n>\n\n// Agent IDs list from AGENT_PERSONAS keys\nexport const AGENT_IDS = Object.keys(\n  AGENT_PERSONAS,\n) as (keyof typeof AGENT_PERSONAS)[]\n\n// Agent ID prefix constant\nexport const AGENT_ID_PREFIX = 'LevelCodeAI/'\n\n// Agent names for client-side reference\nexport const AGENT_NAMES = Object.fromEntries(\n  Object.entries(AGENT_PERSONAS).map(([agentType, persona]) => [\n    agentType,\n    persona.displayName,\n  ]),\n) as Record<keyof typeof AGENT_PERSONAS, string>\n\nexport type AgentName =\n  (typeof AGENT_PERSONAS)[keyof typeof AGENT_PERSONAS]['displayName']\n\n// Get unique agent names for UI display\nexport const UNIQUE_AGENT_NAMES = Array.from(\n  new Set(\n    Object.values(AGENT_PERSONAS)\n      .filter((persona) => !('hidden' in persona) || !persona.hidden)\n      .map((persona) => persona.displayName),\n  ),\n)\n\n// Map from display name back to agent types (for parsing user input)\nexport const AGENT_NAME_TO_TYPES = Object.entries(AGENT_NAMES).reduce(\n  (acc, [type, name]) => {\n    if (!acc[name]) acc[name] = []\n    acc[name].push(type)\n    return acc\n  },\n  {} as Record<string, string[]>,\n)\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/types/agent-template.ts",
              "content": "import type { Model } from '../constants'\nimport type { AgentState, AgentTemplateType } from './session-state'\nimport type { ToolName } from '../tools/constants'\nimport type { ToolCall } from '../util/types/agent-definition'\nimport type { z } from 'zod/v4'\n\nexport type AgentTemplate<\n  P = string | undefined,\n  T = Record<string, any> | undefined,\n> = {\n  id: AgentTemplateType\n  displayName: string\n  model: Model\n\n  toolNames: ToolName[]\n  spawnableAgents: AgentTemplateType[]\n\n  spawnPurposePrompt?: string\n  systemPrompt: string\n  instructionsPrompt: string\n  stepPrompt: string\n  parentInstructions?: Record<string, string>\n\n  // Required parameters for spawning this agent.\n  inputSchema: {\n    prompt?: z.ZodSchema<P>\n    params?: z.ZodSchema<T>\n  }\n  includeMessageHistory: boolean\n  outputMode: 'last_message' | 'all_messages' | 'structured_output'\n  outputSchema?: z.ZodSchema<any>\n\n  handleSteps?: StepHandler<P, T> | string // Function or string of the generator code for running in a sandbox\n}\n\nexport type StepGenerator = Generator<\n  Omit<ToolCall, 'toolCallId'> | 'STEP' | 'STEP_ALL', // Generic tool call type\n  void,\n  { agentState: AgentState; toolResult: string | undefined }\n>\n\nexport type StepHandler<\n  P = string | undefined,\n  T = Record<string, any> | undefined,\n> = (params: { agentState: AgentState; prompt: P; params: T }) => StepGenerator\n",
              "referencedBy": {}
            },
            {
              "path": "npm-app/src/agents/load-agents.ts",
              "content": "import * as fs from 'fs'\nimport * as path from 'path'\n\nimport { cyan, green } from 'picocolors'\n\nimport { getAllTsFiles, getAgentsDirectory } from './agent-utils'\n\nimport type { LevelCodeConfig } from '@levelcode/common/json-config/constants'\n\nexport let loadedAgents: Record<string, any> = {}\nexport async function loadLocalAgents({\n  verbose = false,\n}: {\n  verbose?: boolean\n}): Promise<typeof loadedAgents> {\n  loadedAgents = {}\n\n  const agentsDir = getAgentsDirectory()\n\n  if (!fs.existsSync(agentsDir)) {\n    return loadedAgents\n  }\n\n  try {\n    const tsFiles = getAllTsFiles(agentsDir)\n\n    for (const fullPath of tsFiles) {\n      const relativePath = path.relative(agentsDir, fullPath)\n      const fileName = relativePath.replace(/\\.ts$/, '').replace(/[/\\\\]/g, '-')\n\n      let agentDefinition: any\n      let agentModule: any\n      try {\n        agentModule = await require(fullPath)\n      } catch (error: any) {\n        if (verbose) {\n          console.error('Error importing agent:', error)\n        }\n        continue\n      }\n      delete require.cache[fullPath]\n\n      try {\n        agentDefinition = agentModule.default\n      } catch (error: any) {\n        console.error('Error loading agent from file:', fullPath, error)\n        continue\n      }\n\n      if (!agentDefinition) continue\n\n      // Convert handleSteps function to string if present\n      let processedAgentDefinition = { ...agentDefinition }\n\n      if (agentDefinition.handleSteps) {\n        processedAgentDefinition.handleSteps =\n          agentDefinition.handleSteps.toString()\n      }\n\n      loadedAgents[fileName] = processedAgentDefinition\n    }\n  } catch (error) {}\n  return loadedAgents\n}\n\nexport function getLoadedAgentNames(): Record<string, string> {\n  return Object.fromEntries(\n    Object.entries(loadedAgents).map(([agentType, agentConfig]) => {\n      return [agentType, agentConfig.displayName]\n    }),\n  )\n}\n\n/**\n * Display loaded agents to the user\n */\nexport function displayLoadedAgents(levelcodeConfig: LevelCodeConfig) {\n  const baseAgent = levelcodeConfig.baseAgent\n  if (baseAgent) {\n    console.log(`\\n${green('Configured base agent:')} ${cyan(baseAgent)}`)\n  }\n\n  const spawnableAgents = levelcodeConfig.spawnableAgents\n  if (spawnableAgents) {\n    console.log(\n      `${green('Configured spawnable agents:')} ${spawnableAgents\n        .map((name) => cyan(name))\n        .join(', ')}\\n`,\n    )\n  } else if (Object.keys(loadedAgents).length > 0) {\n    const loadedAgentNames = Object.values(getLoadedAgentNames())\n    console.log(\n      `\\n${green('Found custom agents:')} ${loadedAgentNames\n        .map((name) => cyan(name))\n        .join(', ')}\\n`,\n    )\n  } else if (baseAgent) {\n    // One more new line.\n    console.log()\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "web/src/content/agents/overview.mdx",
              "content": "---\ntitle: 'Overview'\nsection: 'agents'\ntags: ['agents', 'multi-agent', 'overview']\norder: 0\n---\n\n# Overview\n\n## Why Multi-Agent Systems Work Better\n\nLevelCode uses specialized agents that collaborate instead of one agent doing everything. Agents spawn other agents, share tools, and pass context between tasks. Here are some of the sub-agents LevelCode uses:\n\n- **Code Generation** - Write clean, functional code\n- **Review** - Catch bugs, security issues, style violations\n- **Research** - Find documentation and examples\n- **Planning** - Break down complex requirements\n- **File Discovery** - Navigate large codebases\n\n## Agent Workflow\n\nA typical call to LevelCode may result in the following flow:\n\n```mermaid\nflowchart TD\n    A[User Request] --> B{Task Type}\n\n    B -->|Feature Development| C[Planning Agent]\n    B -->|Bug Investigation| D[Thinker Agent]\n    B -->|Code Refactoring| E[File Picker Agent]\n\n    C --> F[File Picker Agent]\n    D --> G[Research Agent]\n    E --> H[Planning Agent]\n\n    F --> I[Base Agent]\n    G --> I\n    H --> I\n\n    I --> J[Reviewer Agent]\n    J --> K[Complete]\n\n    style A fill:#e1f5fe\n    style I fill:#f3e5f5\n    style J fill:#e8f5e8\n    style K fill:#fff3e0\n```\n\n### Example: Authentication System Refactoring\n\nIf you say \"refactor this authentication system\", LevelCode might break down the task into the following steps:\n\n1. **File Picker** finds auth-related files\n2. **Research** looks up best practices\n3. **Planning** creates step-by-step plan\n4. **Base** implements changes informed by the previous agents\n5. **Reviewer** checks for security issues\n\n### Domain-Specific Customization\n\nAgents adapt to your specific workflow and project needs. You can create specialized agents tailored to your domain or build new ones for unique tasks, like the following:\n\n- **Frontend**: React component reviewer\n- **Backend**: API security reviewer\n- **DevOps**: Infrastructure deployment agent\n\n### Agent Coordination\n\nAgents can coordinate with each other using **parent instructions** - a powerful feature that allows one agent to provide specific guidance to the agents it spawns. This creates intelligent workflows where:\n\n- A security-focused agent ensures all spawned reviewers check for vulnerabilities\n- A frontend coordinator guides file pickers to find React components\n- A documentation agent instructs researchers to prioritize official docs\n\nThis coordination happens automatically without requiring complex overrides or manual configuration.\n\n## Quick Start\n\n1. **[Customize existing agents](/docs/agents#customizing-agents)** - Modify prompts and tools\n2. **[Create new agents](/docs/agents#creating-new-agents)** - Build specialized functionality\n3. **[Reference guide](/docs/agents#agent-reference)** - Complete field documentation\n",
              "referencedBy": {}
            }
          ]
        }
      ],
      "parentAgentId": "D-OfaV526OE"
    },
    {
      "type": "text",
      "agentId": "D-OfaYSx8-Q",
      "text": ".agents/git-committer.ts\nbackend/src/templates/agents/base.ts\nbackend/src/templates/agents/thinking-base.ts\nbackend/src/templates/agents/file-picker.ts\nbackend/src/templates/agents/planner.ts\nbackend/src/templates/agent-list.ts\nbackend/src/templates/agent-registry.ts\ncommon/src/templates/dynamic-agent-template.ts\ncommon/src/types/agent-template.ts\ncommon/src/templates/agent-validation.ts\nnpm-app/src/agents/load-agents.ts\nnpm-app/src/cli-handlers/agents.ts"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-Ogo19lSyI",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-OfaYSx8-Q",
      "prompt": "",
      "params": {
        "prompt": "your-custom-agent starter template or git-committer agent"
      }
    },
    {
      "type": "tool_result",
      "toolCallId": "5fb459f2-3aca-4499-b719-39696556c4d8",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Liszt the File Lister",
              "agentType": "file-lister",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": ".agents/git-committer.ts\nbackend/src/templates/agents/base.ts\nbackend/src/templates/agents/thinking-base.ts\nbackend/src/templates/agents/file-picker.ts\nbackend/src/templates/agents/planner.ts\nbackend/src/templates/agent-list.ts\nbackend/src/templates/agent-registry.ts\ncommon/src/templates/dynamic-agent-template.ts\ncommon/src/types/agent-template.ts\ncommon/src/templates/agent-validation.ts\nnpm-app/src/agents/load-agents.ts\nnpm-app/src/cli-handlers/agents.ts"
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ],
      "parentAgentId": "D-OfaYSx8-Q"
    },
    {
      "type": "tool_call",
      "toolCallId": "8f05b455-303a-4642-b77b-d064963d2872",
      "toolName": "read_files",
      "input": {
        "paths": [
          ".agents/git-committer.ts",
          "backend/src/templates/agents/base.ts",
          "backend/src/templates/agents/thinking-base.ts",
          "backend/src/templates/agents/file-picker.ts",
          "backend/src/templates/agents/planner.ts",
          "backend/src/templates/agent-list.ts",
          "backend/src/templates/agent-registry.ts",
          "common/src/templates/dynamic-agent-template.ts",
          "common/src/types/agent-template.ts",
          "common/src/templates/agent-validation.ts",
          "npm-app/src/agents/load-agents.ts",
          "npm-app/src/cli-handlers/agents.ts"
        ]
      },
      "agentId": "D-OfaYSx8-Q",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "8f05b455-303a-4642-b77b-d064963d2872",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": ".agents/git-committer.ts",
              "content": "import { publisher, version } from './constants'\n\nimport type {\n  AgentDefinition,\n  AgentStepContext,\n} from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'git-committer',\n  version,\n  publisher,\n  displayName: 'Git Committer',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description: 'What changes to commit',\n    },\n  },\n\n  includeMessageHistory: false,\n  outputMode: 'last_message',\n\n  spawnPurposePrompt:\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\n\n  instructionsPrompt:\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, analyze changes, and create a commit with proper formatting including the LevelCode footer.',\n\n  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n    // Step 1: Run git diff and git log to analyze changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git log --oneline -10',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    // Step 2: Let AI analyze the changes and read relevant files for context\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          \"I've analyzed the git diff and recent commit history. Now I'll read any relevant files to better understand the context of these changes.\",\n      },\n    }\n\n    // Step 3: Let AI decide which files to read and stage\n    yield 'STEP'\n\n    // Step 4: Let AI analyze staged changes and compose commit message\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          \"Now I'll analyze the staged changes and create a commit with the proper LevelCode footer format.\",\n      },\n    }\n\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agents/base.ts",
              "content": "import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\nimport z from 'zod/v4'\n\nimport {\n  baseAgentAgentStepPrompt,\n  baseAgentSystemPrompt,\n  baseAgentUserInputPrompt,\n} from '../base-prompts'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\n\nexport const base = (\n  model: Model,\n  allAvailableAgents?: string[],\n): Omit<AgentTemplate, 'id'> => ({\n  model,\n  displayName: AGENT_PERSONAS.base.displayName,\n  spawnPurposePrompt: AGENT_PERSONAS.base.purpose,\n  inputSchema: {\n    prompt: z.string().describe('A coding task to complete'),\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: false,\n  toolNames: [\n    'create_plan',\n    'run_terminal_command',\n    'str_replace',\n    'write_file',\n    'spawn_agents',\n    'add_subgoal',\n    'browser_logs',\n    'code_search',\n    'end_turn',\n    'read_files',\n    'think_deeply',\n    'update_subgoal',\n  ],\n  spawnableAgents: allAvailableAgents\n    ? (allAvailableAgents as any[])\n    : [\n        AgentTemplateTypes.file_explorer,\n        AgentTemplateTypes.file_picker,\n        AgentTemplateTypes.researcher,\n        AgentTemplateTypes.thinker,\n        AgentTemplateTypes.reviewer,\n      ],\n\n  systemPrompt: baseAgentSystemPrompt(model),\n  instructionsPrompt: baseAgentUserInputPrompt(model),\n  stepPrompt: baseAgentAgentStepPrompt(model),\n})\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agents/thinking-base.ts",
              "content": "import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\nimport z from 'zod/v4'\n\nimport {\n  baseAgentAgentStepPrompt,\n  baseAgentSystemPrompt,\n  baseAgentUserInputPrompt,\n} from '../base-prompts'\nimport { baseAgentSubagents, baseAgentToolNames } from '../types'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\n\nexport const thinkingBase = (\n  model: Model,\n  allAvailableAgents?: string[],\n): Omit<AgentTemplate, 'id'> => ({\n  model,\n  displayName: AGENT_PERSONAS.base_lite.displayName,\n  spawnPurposePrompt: AGENT_PERSONAS.base_lite.purpose,\n  inputSchema: {\n    prompt: z.string().describe('A coding task to complete'),\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: false,\n  toolNames: baseAgentToolNames,\n  spawnableAgents: allAvailableAgents\n    ? (allAvailableAgents as any[])\n    : baseAgentSubagents,\n\n  systemPrompt: baseAgentSystemPrompt(model),\n  instructionsPrompt: baseAgentUserInputPrompt(model),\n  stepPrompt: baseAgentAgentStepPrompt(model),\n\n  handleSteps: function* ({ agentState, prompt, params }) {\n    while (true) {\n      yield {\n        toolName: 'spawn_agents',\n        args: {\n          agents: [\n            {\n              agent_type: 'thinker',\n              prompt: 'Think deeply about the user request',\n            },\n          ],\n        },\n      }\n      yield 'STEP'\n    }\n  },\n})\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agents/file-picker.ts",
              "content": "import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\nimport z from 'zod/v4'\n\nimport { PLACEHOLDER } from '../types'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\n\nexport const filePicker = (model: Model): Omit<AgentTemplate, 'id'> => ({\n  model,\n  displayName: AGENT_PERSONAS.file_picker.displayName,\n  spawnPurposePrompt: AGENT_PERSONAS.file_picker.purpose,\n  inputSchema: {\n    prompt: z.string().describe('A coding task to complete'),\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: false,\n  toolNames: ['find_files'],\n  spawnableAgents: [],\n\n  systemPrompt:\n    `# Persona: ${PLACEHOLDER.AGENT_NAME}\n\nYou are an expert at finding relevant files in a codebase.\n\\n\\n` +\n    [\n      PLACEHOLDER.TOOLS_PROMPT,\n      PLACEHOLDER.AGENTS_PROMPT,\n      PLACEHOLDER.FILE_TREE_PROMPT,\n      PLACEHOLDER.SYSTEM_INFO_PROMPT,\n      PLACEHOLDER.GIT_CHANGES_PROMPT,\n    ].join('\\n\\n'),\n  instructionsPrompt: `\nProvide the locations in the codebase that could be helpful. Focus on the files that are most relevant to the user prompt.\nIn your report, please give an extremely concise analysis that includes the full paths of files that are relevant and (very briefly) how they could be useful.\n  `.trim(),\n  stepPrompt: `Do not use the find_files tool or any tools again. Just give your response.`,\n\n  handleSteps: function* ({ agentState, prompt, params }) {\n    yield {\n      toolName: 'find_files',\n      args: { prompt },\n    }\n    yield 'STEP_ALL'\n  },\n})\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agents/planner.ts",
              "content": "import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\nimport { closeXml } from '@levelcode/common/util/xml'\nimport z from 'zod/v4'\n\nimport { PLACEHOLDER } from '../types'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\n\nexport const planner = (model: Model): Omit<AgentTemplate, 'id'> => ({\n  model,\n  displayName: AGENT_PERSONAS.planner.displayName,\n  spawnPurposePrompt: AGENT_PERSONAS.planner.purpose,\n  inputSchema: {\n    prompt: z\n      .string()\n      .describe(\n        'What problem you to solve and a few ideas and suggestions for the plan',\n      ),\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: true,\n  toolNames: ['think_deeply', 'spawn_agents', 'end_turn'],\n  spawnableAgents: [], // ARCHIVED: [AgentTemplateTypes.dry_run],\n\n  systemPrompt: `# Persona: ${PLACEHOLDER.AGENT_NAME}\n\nYou are an expert software architect. You are good at creating comprehensive plans to tackle the user request.\n\n${PLACEHOLDER.TOOLS_PROMPT}\n\n${PLACEHOLDER.AGENTS_PROMPT}`,\n\n  instructionsPrompt: `Steps for your response:\n1. Use the <think_deeply> tool to think through cruxes for the plan, and tricky cases. Consider alternative approaches. Be sure to close the tool call with ${closeXml('think_deeply')}.\n2. Write out your plan in a concise way.\n3. Spawn 1-5 dry run agents to sketch portions of the implementation of the plan. (Important: do not forget to close the tool call with \"${closeXml('spawn_agents')}\"!)\n4. Synthesize all the information and rewrite the full plan to be the best it can be. Use the end_turn tool.`,\n\n  stepPrompt:\n    'Do not forget to use the end_turn tool to end your response. Make sure the final plan is the best it can be.',\n})\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agent-list.ts",
              "content": "import { models } from '@levelcode/common/constants'\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\n\nimport { dryRun } from './agents/archive/dry-run'\nimport { ask } from './agents/ask'\nimport { base } from './agents/base'\nimport { fileExplorer } from './agents/file-explorer'\nimport { filePicker } from './agents/file-picker'\nimport { planner } from './agents/planner'\nimport { researcher } from './agents/researcher'\nimport { reviewer } from './agents/reviewer'\nimport { superagent } from './agents/superagent'\nimport { thinker } from './agents/thinker'\nimport { thinkingBase } from './agents/thinking-base'\n\nimport type { AgentTemplate } from './types'\nimport type { AgentTemplateType } from '@levelcode/common/types/session-state'\nimport { agentBuilder } from './agents/agent-builder'\n\nexport const agentTemplates: Record<AgentTemplateType | string, AgentTemplate> =\n  {\n    [AgentTemplateTypes.base]: {\n      id: AgentTemplateTypes.base,\n      ...base(models.openrouter_claude_sonnet_4),\n    },\n    [AgentTemplateTypes.base_lite]: {\n      id: AgentTemplateTypes.base_lite,\n      ...base(models.openrouter_gpt5),\n    },\n    [AgentTemplateTypes.base_max]: {\n      id: AgentTemplateTypes.base_max,\n      ...base(models.openrouter_claude_opus_4),\n    },\n    [AgentTemplateTypes.base_experimental]: {\n      id: AgentTemplateTypes.base_experimental,\n      ...base(models.gemini2_5_pro_preview),\n    },\n    [AgentTemplateTypes.ask]: {\n      id: AgentTemplateTypes.ask,\n      ...ask(models.gemini2_5_pro_preview),\n    },\n    [AgentTemplateTypes.superagent]: {\n      id: AgentTemplateTypes.superagent,\n      ...superagent(models.openrouter_claude_sonnet_4),\n    },\n    [AgentTemplateTypes.claude4_gemini_thinking]: {\n      id: AgentTemplateTypes.claude4_gemini_thinking,\n      ...thinkingBase(models.openrouter_claude_sonnet_4),\n    },\n\n    [AgentTemplateTypes.thinker]: {\n      id: AgentTemplateTypes.thinker,\n      ...thinker(models.openrouter_grok_4),\n    },\n    [AgentTemplateTypes.file_picker]: {\n      id: AgentTemplateTypes.file_picker,\n      ...filePicker(models.gemini2_5_flash),\n    },\n    [AgentTemplateTypes.researcher]: {\n      id: AgentTemplateTypes.researcher,\n      ...researcher(models.gemini2_5_flash),\n    },\n    [AgentTemplateTypes.planner]: {\n      id: AgentTemplateTypes.planner,\n      ...planner(models.openrouter_grok_4),\n    },\n    [AgentTemplateTypes.dry_run]: {\n      id: AgentTemplateTypes.dry_run,\n      ...dryRun(models.gemini2_5_flash),\n    },\n    [AgentTemplateTypes.reviewer]: {\n      id: AgentTemplateTypes.reviewer,\n      ...reviewer(models.gemini2_5_pro_preview),\n    },\n    [AgentTemplateTypes.agent_builder]: {\n      id: AgentTemplateTypes.agent_builder,\n      ...agentBuilder(models.openrouter_claude_sonnet_4),\n    },\n    [AgentTemplateTypes.file_explorer]: fileExplorer as any as AgentTemplate,\n  }\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agent-registry.ts",
              "content": "import type { AgentTemplate } from '@levelcode/common/types/agent-template'\nimport db from '@levelcode/common/db'\nimport * as schema from '@levelcode/common/db/schema'\nimport { and, desc, eq } from 'drizzle-orm'\n\nimport { ProjectFileContext } from '@levelcode/common/util/file'\nimport { logger } from '../util/logger'\nimport { agentTemplates as staticTemplates } from './agent-list'\nimport {\n  DynamicAgentValidationError,\n  validateAgents,\n  validateSingleAgent,\n} from '@levelcode/common/templates/agent-validation'\nimport { DynamicAgentTemplate } from '@levelcode/common/types/dynamic-agent-template'\n\nexport type AgentRegistry = Record<string, AgentTemplate>\n\n// Global database cache - only state in the system\nconst databaseAgentCache = new Map<string, AgentTemplate | null>()\n\n/**\n * Parse agent ID to extract publisher, agent name, and version\n */\nfunction parseAgentId(fullAgentId: string): {\n  publisherId: string\n  agentId: string\n  version?: string\n} | null {\n  // Check if it's in the publisher/agent-id[@version] format\n  const parts = fullAgentId.split('/')\n  if (parts.length !== 2) {\n    return null\n  }\n\n  const [publisherId, agentNameWithVersion] = parts\n\n  // Check for version suffix\n  const versionMatch = agentNameWithVersion.match(/^(.+)@(.+)$/)\n  if (versionMatch) {\n    const [, agentId, version] = versionMatch\n    return { publisherId, agentId, version }\n  }\n\n  return { publisherId, agentId: agentNameWithVersion }\n}\n\n/**\n * Fetch an agent from the database by publisher/agent-id[@version] format\n */\nasync function fetchAgentFromDatabase(parsedAgentId: {\n  publisherId: string\n  agentId: string\n  version?: string\n}): Promise<AgentTemplate | null> {\n  const { publisherId, agentId, version } = parsedAgentId\n\n  try {\n    let agentConfig\n\n    if (version && version !== 'latest') {\n      // Query for specific version\n      agentConfig = await db\n        .select()\n        .from(schema.agentConfig)\n        .where(\n          and(\n            eq(schema.agentConfig.id, agentId),\n            eq(schema.agentConfig.publisher_id, publisherId),\n            eq(schema.agentConfig.version, version),\n          ),\n        )\n        .then((rows) => rows[0])\n    } else {\n      // Query for latest version\n      agentConfig = await db\n        .select()\n        .from(schema.agentConfig)\n        .where(\n          and(\n            eq(schema.agentConfig.id, agentId),\n            eq(schema.agentConfig.publisher_id, publisherId),\n          ),\n        )\n        .orderBy(\n          desc(schema.agentConfig.major),\n          desc(schema.agentConfig.minor),\n          desc(schema.agentConfig.patch),\n        )\n        .limit(1)\n        .then((rows) => rows[0])\n    }\n\n    if (!agentConfig) {\n      logger.debug(\n        { publisherId, agentId, version },\n        'fetchAgentFromDatabase: Agent not found in database',\n      )\n      return null\n    }\n\n    const rawAgentData = agentConfig.data as DynamicAgentTemplate\n\n    // Validate the raw agent data with the original agentId (not full identifier)\n    const validationResult = validateSingleAgent(\n      { ...rawAgentData, id: agentId },\n      {\n        filePath: `${publisherId}/${agentId}@${agentConfig.version}`,\n        skipSubagentValidation: true,\n      },\n    )\n\n    if (!validationResult.success) {\n      logger.error(\n        {\n          publisherId,\n          agentId,\n          version: agentConfig.version,\n          error: validationResult.error,\n        },\n        'fetchAgentFromDatabase: Agent validation failed',\n      )\n      return null\n    }\n\n    // Set the correct full agent ID for the final template\n    const agentTemplate = {\n      ...validationResult.agentTemplate!,\n      id: `${publisherId}/${agentId}@${agentConfig.version}`,\n    }\n\n    logger.debug(\n      {\n        publisherId,\n        agentId,\n        version: agentConfig.version,\n        fullAgentId: agentTemplate.id,\n      },\n      'fetchAgentFromDatabase: Successfully loaded and validated agent from database',\n    )\n\n    return agentTemplate\n  } catch (error) {\n    logger.error(\n      { publisherId, agentId, version, error },\n      'fetchAgentFromDatabase: Error fetching agent from database',\n    )\n    return null\n  }\n}\n\n/**\n * Single function to look up an agent template with clear priority order:\n * 1. localAgentTemplates (dynamic agents + static templates)\n * 2. Database cache\n * 3. Database query\n */\nexport async function getAgentTemplate(\n  agentId: string,\n  localAgentTemplates: Record<string, AgentTemplate>,\n): Promise<AgentTemplate | null> {\n  // 1. Check localAgentTemplates first (dynamic agents + static templates)\n  if (localAgentTemplates[agentId]) {\n    return localAgentTemplates[agentId]\n  }\n  // 2. Check database cache\n  const cacheKey = agentId\n  if (databaseAgentCache.has(cacheKey)) {\n    return databaseAgentCache.get(cacheKey) || null\n  }\n\n  const parsed = parseAgentId(agentId)\n  if (!parsed) {\n    logger.debug({ agentId }, 'getAgentTemplate: Failed to parse agent ID')\n    return null\n  }\n\n  // 3. Query database (only for publisher/agent-id format)\n  const dbAgent = await fetchAgentFromDatabase(parsed)\n  if (dbAgent && parsed.version && parsed.version !== 'latest') {\n    // Cache only specific versions to avoid stale 'latest' results\n    databaseAgentCache.set(cacheKey, dbAgent)\n  }\n  return dbAgent\n}\n\n/**\n * Assemble local agent templates from fileContext + static templates\n */\nexport function assembleLocalAgentTemplates(fileContext: ProjectFileContext): {\n  agentTemplates: Record<string, AgentTemplate>\n  validationErrors: DynamicAgentValidationError[]\n} {\n  // Load dynamic agents using the service\n  const { templates: dynamicTemplates, validationErrors } = validateAgents(\n    fileContext.agentTemplates || {},\n  )\n\n  // Combine static and dynamic templates\n  const agentTemplates = { ...staticTemplates, ...dynamicTemplates }\n\n  return { agentTemplates, validationErrors }\n}\n\n/**\n * Clear the database agent cache (useful for testing)\n */\nexport function clearDatabaseCache(): void {\n  databaseAgentCache.clear()\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/templates/dynamic-agent-template.ts",
              "content": "[FILE_DOES_NOT_EXIST]",
              "referencedBy": {}
            },
            {
              "path": "common/src/types/agent-template.ts",
              "content": "import type { Model } from '../constants'\nimport type { AgentState, AgentTemplateType } from './session-state'\nimport type { ToolName } from '../tools/constants'\nimport type { ToolCall } from '../util/types/agent-definition'\nimport type { z } from 'zod/v4'\n\nexport type AgentTemplate<\n  P = string | undefined,\n  T = Record<string, any> | undefined,\n> = {\n  id: AgentTemplateType\n  displayName: string\n  model: Model\n\n  toolNames: ToolName[]\n  spawnableAgents: AgentTemplateType[]\n\n  spawnPurposePrompt?: string\n  systemPrompt: string\n  instructionsPrompt: string\n  stepPrompt: string\n  parentInstructions?: Record<string, string>\n\n  // Required parameters for spawning this agent.\n  inputSchema: {\n    prompt?: z.ZodSchema<P>\n    params?: z.ZodSchema<T>\n  }\n  includeMessageHistory: boolean\n  outputMode: 'last_message' | 'all_messages' | 'structured_output'\n  outputSchema?: z.ZodSchema<any>\n\n  handleSteps?: StepHandler<P, T> | string // Function or string of the generator code for running in a sandbox\n}\n\nexport type StepGenerator = Generator<\n  Omit<ToolCall, 'toolCallId'> | 'STEP' | 'STEP_ALL', // Generic tool call type\n  void,\n  { agentState: AgentState; toolResult: string | undefined }\n>\n\nexport type StepHandler<\n  P = string | undefined,\n  T = Record<string, any> | undefined,\n> = (params: { agentState: AgentState; prompt: P; params: T }) => StepGenerator\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/templates/agent-validation.ts",
              "content": "import { convertJsonSchemaToZod } from 'zod-from-json-schema'\n\nimport {\n  formatSpawnableAgentError,\n  validateSpawnableAgents,\n} from '../util/agent-template-validation'\nimport { logger } from '../util/logger'\nimport {\n  DynamicAgentDefinitionSchema,\n  DynamicAgentTemplateSchema,\n} from '../types/dynamic-agent-template'\nimport type { AgentTemplate } from '../types/agent-template'\nimport type { DynamicAgentTemplate } from '../types/dynamic-agent-template'\n\nexport interface DynamicAgentValidationError {\n  filePath: string\n  message: string\n}\n\n/**\n * Collect all agent IDs from template files without full validation\n */\nexport function collectAgentIds(\n  agentTemplates: Record<string, DynamicAgentTemplate> = {},\n): string[] {\n  const agentIds: string[] = []\n  const jsonFiles = Object.keys(agentTemplates)\n\n  for (const filePath of jsonFiles) {\n    try {\n      const content = agentTemplates[filePath]\n      if (!content) {\n        continue\n      }\n\n      // Extract the agent ID if it exists\n      if (content.id && typeof content.id === 'string') {\n        agentIds.push(content.id)\n      }\n    } catch (error) {\n      // Log but don't fail the collection process for other errors\n      logger.debug(\n        { filePath, error },\n        'Failed to extract agent ID during collection phase',\n      )\n    }\n  }\n\n  return agentIds\n}\n\n/**\n * Validate and load dynamic agent templates from user-provided agentTemplates\n */\nexport function validateAgents(agentTemplates: Record<string, any> = {}): {\n  templates: Record<string, AgentTemplate>\n  validationErrors: DynamicAgentValidationError[]\n} {\n  const templates: Record<string, AgentTemplate> = {}\n  const validationErrors: DynamicAgentValidationError[] = []\n\n  const hasAgentTemplates = Object.keys(agentTemplates).length > 0\n\n  if (!hasAgentTemplates) {\n    return {\n      templates,\n      validationErrors,\n    }\n  }\n\n  const agentKeys = Object.keys(agentTemplates)\n\n  // Pass 1: Collect all agent IDs from template files\n  const dynamicAgentIds = collectAgentIds(agentTemplates)\n\n  // Pass 2: Load and validate each agent template\n  for (const agentKey of agentKeys) {\n    const content = agentTemplates[agentKey]\n    try {\n      if (!content) {\n        continue\n      }\n\n      const validationResult = validateSingleAgent(content, {\n        filePath: agentKey,\n        dynamicAgentIds,\n      })\n\n      if (!validationResult.success) {\n        validationErrors.push({\n          filePath: agentKey,\n          message: validationResult.error!,\n        })\n        continue\n      }\n\n      if (templates[validationResult.agentTemplate!.id]) {\n        const agentContext = validationResult.agentTemplate!.displayName\n          ? `Agent \"${validationResult.agentTemplate!.id}\" (${validationResult.agentTemplate!.displayName})`\n          : `Agent \"${validationResult.agentTemplate!.id}\"`\n\n        validationErrors.push({\n          filePath: agentKey,\n          message: `${agentContext}: Duplicate agent ID`,\n        })\n        continue\n      }\n      templates[validationResult.agentTemplate!.id] =\n        validationResult.agentTemplate!\n    } catch (error) {\n      const errorMessage =\n        error instanceof Error ? error.message : 'Unknown error'\n\n      // Try to extract agent context for better error messages\n      const agentContext = content?.id\n        ? `Agent \"${content.id}\"${content.displayName ? ` (${content.displayName})` : ''}`\n        : `Agent in ${agentKey}`\n\n      validationErrors.push({\n        filePath: agentKey,\n        message: `${agentContext}: ${errorMessage}`,\n      })\n\n      logger.warn(\n        { filePath: agentKey, error: errorMessage },\n        'Failed to load dynamic agent template',\n      )\n    }\n  }\n\n  return {\n    templates,\n    validationErrors,\n  }\n}\n\n/**\n * Validates a single dynamic agent template and converts it to an AgentTemplate.\n * This is a plain function equivalent to the core logic of loadSingleAgent.\n *\n * @param dynamicAgentIds - Array of all available dynamic agent IDs for validation\n * @param template - The raw agent template to validate (any type)\n * @param options - Optional configuration object\n * @param options.filePath - Optional file path for error context\n * @param options.skipSubagentValidation - Skip subagent validation when loading from database\n * @returns Validation result with either the converted AgentTemplate or an error\n */\nexport function validateSingleAgent(\n  template: any,\n  options?: {\n    dynamicAgentIds?: string[]\n    filePath?: string\n    skipSubagentValidation?: boolean\n  },\n): {\n  success: boolean\n  agentTemplate?: AgentTemplate\n  error?: string\n} {\n  const {\n    filePath,\n    skipSubagentValidation = true,\n    dynamicAgentIds = [],\n  } = options || {}\n\n  try {\n    // First validate against the Zod schema\n    let validatedConfig: DynamicAgentTemplate\n    try {\n      const typedAgentDefinition = DynamicAgentDefinitionSchema.parse(template)\n\n      // Convert handleSteps function to string if present\n      let handleStepsString: string | undefined\n      if (template.handleSteps) {\n        handleStepsString = template.handleSteps.toString()\n      }\n\n      validatedConfig = DynamicAgentTemplateSchema.parse({\n        ...typedAgentDefinition,\n        systemPrompt: typedAgentDefinition.systemPrompt || '',\n        instructionsPrompt: typedAgentDefinition.instructionsPrompt || '',\n        stepPrompt: typedAgentDefinition.stepPrompt || '',\n        handleSteps: handleStepsString,\n      })\n    } catch (error: any) {\n      // Try to extract agent context for better error messages\n      const agentContext = template.id\n        ? `Agent \"${template.id}\"${template.displayName ? ` (${template.displayName})` : ''}`\n        : filePath\n          ? `Agent in ${filePath}`\n          : 'Agent'\n\n      return {\n        success: false,\n        error: `${agentContext}: Schema validation failed: ${error.message}`,\n      }\n    }\n\n    // Validate spawnable agents (skip if requested, e.g., for database agents)\n    if (!skipSubagentValidation) {\n      const spawnableAgentValidation = validateSpawnableAgents(\n        validatedConfig.spawnableAgents,\n        dynamicAgentIds,\n      )\n      if (!spawnableAgentValidation.valid) {\n        return {\n          success: false,\n          error: formatSpawnableAgentError(\n            spawnableAgentValidation.invalidAgents,\n            spawnableAgentValidation.availableAgents,\n          ),\n        }\n      }\n    }\n\n    // Convert schemas and handle validation errors\n    let inputSchema: AgentTemplate['inputSchema']\n    try {\n      inputSchema = convertInputSchema(\n        validatedConfig.inputSchema?.prompt,\n        validatedConfig.inputSchema?.params,\n        filePath,\n      )\n    } catch (error) {\n      // Try to extract agent context for better error messages\n      const agentContext = validatedConfig.id\n        ? `Agent \"${validatedConfig.id}\"${validatedConfig.displayName ? ` (${validatedConfig.displayName})` : ''}`\n        : filePath\n          ? `Agent in ${filePath}`\n          : 'Agent'\n      return {\n        success: false,\n        error: `${agentContext}: ${\n          error instanceof Error ? error.message : 'Schema conversion failed'\n        }`,\n      }\n    }\n\n    // Convert outputSchema if present\n    let outputSchema: AgentTemplate['outputSchema']\n    if (validatedConfig.outputSchema) {\n      try {\n        outputSchema = convertJsonSchemaToZod(validatedConfig.outputSchema)\n      } catch (error) {\n        // Try to extract agent context for better error messages\n        const agentContext = validatedConfig.id\n          ? `Agent \"${validatedConfig.id}\"${validatedConfig.displayName ? ` (${validatedConfig.displayName})` : ''}`\n          : filePath\n            ? `Agent in ${filePath}`\n            : 'Agent'\n\n        return {\n          success: false,\n          error: `${agentContext}: Failed to convert outputSchema to Zod: ${error instanceof Error ? error.message : 'Unknown error'}`,\n        }\n      }\n    }\n\n    // Validate handleSteps if present\n    if (validatedConfig.handleSteps) {\n      if (!isValidGeneratorFunction(validatedConfig.handleSteps)) {\n        // Try to extract agent context for better error messages\n        const agentContext = validatedConfig.id\n          ? `Agent \"${validatedConfig.id}\"${validatedConfig.displayName ? ` (${validatedConfig.displayName})` : ''}`\n          : filePath\n            ? `Agent in ${filePath}`\n            : 'Agent'\n\n        return {\n          success: false,\n          error: `${agentContext}: handleSteps must be a generator function: \"function* (params) { ... }\". Found: ${validatedConfig.handleSteps.substring(0, 50)}...`,\n        }\n      }\n    }\n\n    // Convert to internal AgentTemplate format\n    const agentTemplate: AgentTemplate = {\n      ...validatedConfig,\n      outputSchema,\n      inputSchema,\n    }\n\n    return {\n      success: true,\n      agentTemplate,\n    }\n  } catch (error) {\n    const errorMessage =\n      error instanceof Error ? error.message : 'Unknown error'\n\n    // Try to extract agent context for better error messages\n    const agentContext = template?.id\n      ? `Agent \"${template.id}\"${template.displayName ? ` (${template.displayName})` : ''}`\n      : filePath\n        ? `Agent in ${filePath}`\n        : 'Agent'\n\n    return {\n      success: false,\n      error: `${agentContext}: Error validating agent template: ${errorMessage}`,\n    }\n  }\n}\n\n/**\n * Validates if a string represents a valid generator function\n */\nfunction isValidGeneratorFunction(code: string): boolean {\n  const trimmed = code.trim()\n  // Check if it's a generator function (must start with function*)\n  return trimmed.startsWith('function*')\n}\n\n/**\n * Convert JSON schema to Zod schema format using json-schema-to-zod.\n * This is done once during loading to avoid repeated conversions.\n * Throws descriptive errors for validation failures.\n */\nfunction convertInputSchema(\n  inputPromptSchema?: Record<string, any>,\n  paramsSchema?: Record<string, any>,\n  filePath?: string,\n): AgentTemplate['inputSchema'] {\n  const result: any = {}\n  const fileContext = filePath ? ` in ${filePath}` : ''\n\n  // Handle prompt schema\n  if (inputPromptSchema) {\n    try {\n      if (\n        typeof inputPromptSchema !== 'object' ||\n        Object.keys(inputPromptSchema).length === 0\n      ) {\n        throw new Error(\n          `Invalid inputSchema.prompt${fileContext}: Schema must be a valid non-empty JSON schema object. Found: ${typeof inputPromptSchema}`,\n        )\n      }\n      const promptZodSchema = convertJsonSchemaToZod(inputPromptSchema)\n      // Validate that the schema results in string or undefined\n      const testResult = promptZodSchema.safeParse('test')\n      const testUndefined = promptZodSchema.safeParse(undefined)\n\n      if (!testResult.success && !testUndefined.success) {\n        const errorDetails =\n          testResult.error?.issues?.[0]?.message || 'validation failed'\n        throw new Error(\n          `Invalid inputSchema.prompt${fileContext}: Schema must allow string or undefined values. ` +\n            `Current schema validation error: ${errorDetails}. ` +\n            `Please ensure your JSON schema accepts string types.`,\n        )\n      }\n\n      result.prompt = promptZodSchema\n    } catch (error) {\n      if (error instanceof Error && error.message.includes('inputSchema')) {\n        // Re-throw our custom validation errors\n        throw error\n      }\n\n      // Handle json-schema-to-zod conversion errors\n      const errorMessage =\n        error instanceof Error ? error.message : 'Unknown error'\n      throw new Error(\n        `Failed to convert inputSchema.prompt to Zod${fileContext}: ${errorMessage}. ` +\n          `Please check that your inputSchema.prompt is a valid non-empty JSON schema object.`,\n      )\n    }\n  }\n\n  // Handle params schema\n  if (paramsSchema) {\n    try {\n      if (\n        typeof paramsSchema !== 'object' ||\n        Object.keys(paramsSchema).length === 0\n      ) {\n        throw new Error(\n          `Invalid inputSchema.params${fileContext}: Schema must be a valid non-empty JSON schema object. Found: ${typeof paramsSchema}`,\n        )\n      }\n      const paramsZodSchema = convertJsonSchemaToZod(paramsSchema)\n      result.params = paramsZodSchema\n    } catch (error) {\n      const errorMessage =\n        error instanceof Error ? error.message : 'Unknown error'\n      throw new Error(\n        `Failed to convert inputSchema.params to Zod${fileContext}: ${errorMessage}. ` +\n          `Please check that your inputSchema.params is a valid non-empty JSON schema object.`,\n      )\n    }\n  }\n  return result\n}\n",
              "referencedBy": {}
            },
            {
              "path": "npm-app/src/agents/load-agents.ts",
              "content": "import * as fs from 'fs'\nimport * as path from 'path'\n\nimport { cyan, green } from 'picocolors'\n\nimport { getAllTsFiles, getAgentsDirectory } from './agent-utils'\n\nimport type { LevelCodeConfig } from '@levelcode/common/json-config/constants'\n\nexport let loadedAgents: Record<string, any> = {}\nexport async function loadLocalAgents({\n  verbose = false,\n}: {\n  verbose?: boolean\n}): Promise<typeof loadedAgents> {\n  loadedAgents = {}\n\n  const agentsDir = getAgentsDirectory()\n\n  if (!fs.existsSync(agentsDir)) {\n    return loadedAgents\n  }\n\n  try {\n    const tsFiles = getAllTsFiles(agentsDir)\n\n    for (const fullPath of tsFiles) {\n      const relativePath = path.relative(agentsDir, fullPath)\n      const fileName = relativePath.replace(/\\.ts$/, '').replace(/[/\\\\]/g, '-')\n\n      let agentDefinition: any\n      let agentModule: any\n      try {\n        agentModule = await require(fullPath)\n      } catch (error: any) {\n        if (verbose) {\n          console.error('Error importing agent:', error)\n        }\n        continue\n      }\n      delete require.cache[fullPath]\n\n      try {\n        agentDefinition = agentModule.default\n      } catch (error: any) {\n        console.error('Error loading agent from file:', fullPath, error)\n        continue\n      }\n\n      if (!agentDefinition) continue\n\n      // Convert handleSteps function to string if present\n      let processedAgentDefinition = { ...agentDefinition }\n\n      if (agentDefinition.handleSteps) {\n        processedAgentDefinition.handleSteps =\n          agentDefinition.handleSteps.toString()\n      }\n\n      loadedAgents[fileName] = processedAgentDefinition\n    }\n  } catch (error) {}\n  return loadedAgents\n}\n\nexport function getLoadedAgentNames(): Record<string, string> {\n  return Object.fromEntries(\n    Object.entries(loadedAgents).map(([agentType, agentConfig]) => {\n      return [agentType, agentConfig.displayName]\n    }),\n  )\n}\n\n/**\n * Display loaded agents to the user\n */\nexport function displayLoadedAgents(levelcodeConfig: LevelCodeConfig) {\n  const baseAgent = levelcodeConfig.baseAgent\n  if (baseAgent) {\n    console.log(`\\n${green('Configured base agent:')} ${cyan(baseAgent)}`)\n  }\n\n  const spawnableAgents = levelcodeConfig.spawnableAgents\n  if (spawnableAgents) {\n    console.log(\n      `${green('Configured spawnable agents:')} ${spawnableAgents\n        .map((name) => cyan(name))\n        .join(', ')}\\n`,\n    )\n  } else if (Object.keys(loadedAgents).length > 0) {\n    const loadedAgentNames = Object.values(getLoadedAgentNames())\n    console.log(\n      `\\n${green('Found custom agents:')} ${loadedAgentNames\n        .map((name) => cyan(name))\n        .join(', ')}\\n`,\n    )\n  } else if (baseAgent) {\n    // One more new line.\n    console.log()\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "npm-app/src/cli-handlers/agents.ts",
              "content": "import * as fs from 'fs'\nimport * as path from 'path'\n\nimport { AGENT_TEMPLATES_DIR } from '@levelcode/common/constants'\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\nimport {\n  filterCustomAgentFiles,\n  extractAgentIdFromFileName,\n} from '@levelcode/common/util/agent-file-utils'\nimport { green, yellow, cyan, magenta, bold, gray, red } from 'picocolors'\n\nimport { loadLocalAgents, getLoadedAgentNames } from '../agents/load-agents'\nimport { CLI } from '../cli'\nimport { getProjectRoot } from '../project-files'\nimport { Spinner } from '../utils/spinner'\nimport {\n  ENTER_ALT_BUFFER,\n  EXIT_ALT_BUFFER,\n  CLEAR_SCREEN,\n  HIDE_CURSOR,\n  SHOW_CURSOR,\n} from '../utils/terminal'\n\nlet isInAgentsBuffer = false\nlet originalKeyHandlers: ((str: string, key: any) => void)[] = []\nlet selectedIndex = 0\nlet scrollOffset = 0\nlet allContentLines: string[] = []\nlet agentLinePositions: number[] = []\nlet agentList: Array<{\n  id: string\n  name: string\n  description?: string\n  isBuiltIn: boolean\n  filePath?: string\n  isCreateNew?: boolean\n  isEditAgent?: boolean\n  isSeparator?: boolean\n  isPlaceholder?: boolean\n  isSectionHeader?: boolean\n}> = []\n\nexport function isInAgentsMode(): boolean {\n  return isInAgentsBuffer\n}\n\nexport async function enterAgentsBuffer(rl: any, onExit: () => void) {\n  if (isInAgentsBuffer) {\n    console.log(yellow('Already in agents mode!'))\n    return\n  }\n\n  // Load local agents\n  await loadLocalAgents({ verbose: false })\n  const localAgents = getLoadedAgentNames()\n\n  // Build management actions section with header\n  const actions: typeof agentList = [\n    {\n      id: '__header__',\n      name: bold(cyan('Actions')),\n      description: '',\n      isBuiltIn: false,\n      isSectionHeader: true,\n    },\n    {\n      id: '__create_new__',\n      name: '+ Create New Agent',\n      description: 'Create a new custom agent template',\n      isBuiltIn: false,\n      isCreateNew: true,\n    },\n  ]\n\n  // Get custom agent files for display purposes\n  const agentsDir = path.join(getProjectRoot(), AGENT_TEMPLATES_DIR)\n  let customAgentFiles: string[] = []\n  if (fs.existsSync(agentsDir)) {\n    const files = fs.readdirSync(agentsDir)\n    customAgentFiles = filterCustomAgentFiles(files)\n  }\n\n  // Add agents section header\n  actions.push({\n    id: '__agents_header__',\n    name:\n      bold(cyan('Custom Agents')) +\n      gray(`  ${customAgentFiles.length} in ${AGENT_TEMPLATES_DIR}`),\n    description: '',\n    isBuiltIn: false,\n    isSectionHeader: true,\n  })\n\n  // Build agent list starting with management actions\n  agentList = [...actions]\n\n  // Add custom agents from .agents/templates\n  if (customAgentFiles.length > 0) {\n    for (const file of customAgentFiles) {\n      const agentId = extractAgentIdFromFileName(file)\n      const agentName = localAgents[agentId] || agentId\n      agentList.push({\n        id: agentId,\n        name: agentName,\n        description: 'Custom user-defined agent',\n        isBuiltIn: false,\n        filePath: path.join(agentsDir, file),\n      })\n    }\n  } else {\n    // If no custom agents, add a helpful message\n    agentList.push({\n      id: '__no_agents__',\n      name: gray('No custom agents found'),\n      description: 'Use \"Create New Agent\" above to get started',\n      isBuiltIn: false,\n      isPlaceholder: true,\n    })\n  }\n\n  // No need for special handling here since we now have a proper placeholder\n\n  // Initialize selection to first selectable item\n  selectedIndex = 0\n  // Find first selectable item (skip section headers, separators, placeholders)\n  while (\n    selectedIndex < agentList.length &&\n    (agentList[selectedIndex]?.isSectionHeader ||\n      agentList[selectedIndex]?.isSeparator ||\n      agentList[selectedIndex]?.isPlaceholder)\n  ) {\n    selectedIndex++\n  }\n  // If no selectable items found, default to 0\n  if (selectedIndex >= agentList.length) {\n    selectedIndex = 0\n  }\n  scrollOffset = 0\n\n  // Enter alternate screen buffer\n  process.stdout.write(ENTER_ALT_BUFFER)\n  process.stdout.write(CLEAR_SCREEN)\n  process.stdout.write(HIDE_CURSOR)\n\n  isInAgentsBuffer = true\n\n  // Build content and render\n  buildAllContentLines()\n  centerSelectedItem()\n  renderAgentsList()\n\n  // Set up key handler\n  setupAgentsKeyHandler(rl, onExit)\n}\n\nexport function exitAgentsBuffer(rl: any) {\n  if (!isInAgentsBuffer) {\n    return\n  }\n\n  // Reset state\n  selectedIndex = 0\n  scrollOffset = 0\n  allContentLines = []\n  agentLinePositions = []\n  agentList = []\n\n  // Restore all original key handlers\n  if (originalKeyHandlers.length > 0) {\n    process.stdin.removeAllListeners('keypress')\n    originalKeyHandlers.forEach((handler) => {\n      process.stdin.on('keypress', handler)\n    })\n    originalKeyHandlers = []\n  }\n\n  // Exit alternate screen buffer\n  process.stdout.write(SHOW_CURSOR)\n  process.stdout.write(EXIT_ALT_BUFFER)\n\n  isInAgentsBuffer = false\n}\n\nfunction centerSelectedItem() {\n  if (selectedIndex < 0 || selectedIndex >= agentLinePositions.length) {\n    return\n  }\n\n  const terminalHeight = process.stdout.rows || 24\n  const terminalWidth = process.stdout.columns || 80\n  const headerHeight = getHeaderLines(terminalWidth).length\n  const maxScrollableLines = terminalHeight - headerHeight - 2\n  const selectedLineIndex = agentLinePositions[selectedIndex]\n  const maxScrollOffset = Math.max(\n    0,\n    allContentLines.length - maxScrollableLines,\n  )\n\n  // Center item in the scrollable viewport\n  const centerOffset = selectedLineIndex - Math.floor(maxScrollableLines / 2)\n  scrollOffset = Math.max(0, Math.min(maxScrollOffset, centerOffset))\n}\n\nconst getHeaderLines = (terminalWidth: number) => [\n  // No header - sections will be labeled inline\n]\n\nfunction buildAllContentLines() {\n  const terminalWidth = process.stdout.columns || 80\n  const lines: string[] = []\n  agentLinePositions = []\n\n  if (agentList.length === 0) {\n    lines.push(yellow('No agents found.'))\n  } else {\n    for (let i = 0; i < agentList.length; i++) {\n      agentLinePositions.push(lines.length)\n      const agent = agentList[i]\n      const isSelected = i === selectedIndex\n\n      // Handle section headers\n      if (agent.isSectionHeader) {\n        const cleanName = agent.name.replace(/\\u001b\\[[0-9;]*m/g, '')\n        const cleanDescription = agent.description\n          ? agent.description.replace(/\\u001b\\[[0-9;]*m/g, '')\n          : ''\n        const availableWidth = terminalWidth - 4 // Account for padding\n\n        if (isSelected) {\n          const headerWidth = Math.min(terminalWidth - 6, 60)\n          lines.push(`  ${cyan('' + ''.repeat(headerWidth + 2) + '')}`)\n\n          // Right-aligned title with separator line\n          const titlePadding = Math.max(0, headerWidth - cleanName.length - 4)\n          const separatorLine = ''.repeat(titlePadding)\n          lines.push(\n            `  ${cyan('')} ${gray(separatorLine)}  ${agent.name} ${cyan('')}`,\n          )\n\n          if (agent.description) {\n            const descPadding = Math.max(\n              0,\n              headerWidth - cleanDescription.length,\n            )\n            lines.push(\n              `  ${cyan('')} ${agent.description}${' '.repeat(descPadding)} ${cyan('')}`,\n            )\n          }\n          lines.push(`  ${cyan('' + ''.repeat(headerWidth + 2) + '')}`)\n        } else {\n          // Right-aligned title with separator line for unselected\n          const titlePadding = Math.max(\n            0,\n            availableWidth - cleanName.length - 4,\n          )\n          const separatorLine = gray(''.repeat(titlePadding))\n          lines.push(`  ${separatorLine}  ${agent.name}`)\n\n          if (agent.description) {\n            lines.push(`  ${agent.description}`)\n          }\n        }\n        if (i < agentList.length - 1) {\n          lines.push('') // Empty line after section header\n        }\n        continue\n      }\n\n      // Handle separator (keep for backwards compatibility)\n      if (agent.isSeparator) {\n        if (isSelected) {\n          lines.push(`  ${cyan('' + ''.repeat(52) + '')}`)\n          lines.push(`  ${cyan('')} ${gray(agent.name)} ${cyan('')}`)\n          lines.push(`  ${cyan('' + ''.repeat(52) + '')}`)\n        } else {\n          lines.push(`    ${gray(agent.name)}`)\n        }\n        if (i < agentList.length - 1) {\n          lines.push('') // Empty line after separator\n        }\n        continue\n      }\n\n      // Handle placeholder\n      if (agent.isPlaceholder) {\n        if (isSelected) {\n          const boxWidth = Math.min(terminalWidth - 6, 50)\n          lines.push(`  ${cyan('' + ''.repeat(boxWidth + 2) + '')}`)\n          lines.push(\n            `  ${cyan('')} ${agent.name} ${' '.repeat(Math.max(0, boxWidth - agent.name.replace(/\\u001b\\[[0-9;]*m/g, '').length))} ${cyan('')}`,\n          )\n          lines.push(\n            `  ${cyan('')} ${gray(agent.description || '')} ${' '.repeat(Math.max(0, boxWidth - (agent.description || '').length))} ${cyan('')}`,\n          )\n          lines.push(`  ${cyan('' + ''.repeat(boxWidth + 2) + '')}`)\n        } else {\n          lines.push(`    ${agent.name}`)\n          lines.push(`    ${gray(agent.description || '')}`)\n        }\n        if (i < agentList.length - 1) {\n          lines.push('') // Empty line between items\n        }\n        continue\n      }\n\n      // Regular agent items\n      const agentInfo =\n        agent.isCreateNew || agent.isEditAgent\n          ? `${agent.isCreateNew ? green(agent.name) : magenta(agent.name)}`\n          : `${bold(agent.name)} ${gray(`(${agent.id})`)}`\n      const description = agent.description || 'No description'\n      const filePath = agent.filePath\n        ? gray(`File: ${path.relative(getProjectRoot(), agent.filePath)}`)\n        : ''\n\n      const contentForBox = [\n        agentInfo,\n        gray(description),\n        ...(filePath ? [filePath] : []),\n      ]\n\n      if (isSelected) {\n        // Calculate box width based on content\n        const maxContentWidth = Math.max(\n          ...contentForBox.map(\n            (line) => line.replace(/\\u001b\\[[0-9;]*m/g, '').length,\n          ),\n        )\n        const boxWidth = Math.min(terminalWidth - 6, maxContentWidth)\n\n        // Add top border\n        lines.push(`  ${cyan('' + ''.repeat(boxWidth + 2) + '')}`)\n\n        // Add content lines with proper padding - keep same indentation as unselected\n        contentForBox.forEach((line) => {\n          const cleanLine = line.replace(/\\u001b\\[[0-9;]*m/g, '')\n          const padding = ' '.repeat(Math.max(0, boxWidth - cleanLine.length))\n          lines.push(`  ${cyan('')} ${line}${padding} ${cyan('')}`)\n        })\n\n        // Add bottom border\n        lines.push(`  ${cyan('' + ''.repeat(boxWidth + 2) + '')}`)\n      } else {\n        // Non-selected items - use same base indentation as selected content\n        lines.push(`    ${agentInfo}`) // 4 spaces to match selected content position\n        lines.push(`    ${gray(description)}`)\n        if (filePath) {\n          lines.push(`    ${filePath}`)\n        }\n      }\n\n      if (i < agentList.length - 1) {\n        lines.push('') // Empty line between items\n      }\n    }\n  }\n\n  allContentLines = lines\n}\n\nfunction renderAgentsList() {\n  // Build all content if not already built\n  buildAllContentLines()\n\n  // Clear screen and move cursor to top\n  process.stdout.write(CLEAR_SCREEN)\n\n  const terminalHeight = process.stdout.rows || 24\n  const terminalWidth = process.stdout.columns || 80\n\n  // Render fixed header\n  const headerLines = getHeaderLines(terminalWidth)\n  process.stdout.write(headerLines.join('\\n'))\n  process.stdout.write('\\n')\n\n  // Render scrollable content\n  const maxScrollableLines = terminalHeight - headerLines.length - 2\n  const visibleLines = allContentLines.slice(\n    scrollOffset,\n    scrollOffset + maxScrollableLines,\n  )\n\n  // Display scrollable content\n  process.stdout.write(visibleLines.join('\\n'))\n\n  // Add padding to fill remaining space\n  const remainingLines = maxScrollableLines - visibleLines.length\n  if (remainingLines > 0) {\n    process.stdout.write('\\n'.repeat(remainingLines))\n  }\n\n  // Display status line at bottom\n  const statusLine = `\\n${gray(`Use //j/k to navigate, Enter to select, ESC to go back`)}`\n\n  process.stdout.write(statusLine)\n  process.stdout.write(HIDE_CURSOR)\n}\n\nfunction setupAgentsKeyHandler(rl: any, onExit: () => void) {\n  // Store all original key handlers\n  const listeners = process.stdin.listeners('keypress')\n  originalKeyHandlers = listeners as ((str: string, key: any) => void)[]\n\n  // Remove existing keypress listeners\n  process.stdin.removeAllListeners('keypress')\n\n  // Add our custom handler\n  process.stdin.on('keypress', (str: string, key: any) => {\n    if (key && key.name === 'escape') {\n      exitAgentsBuffer(rl)\n      onExit()\n      return\n    }\n\n    // Handle Ctrl+C - exit to main screen\n    if (key && key.ctrl && key.name === 'c') {\n      exitAgentsBuffer(rl)\n      onExit()\n      return\n    }\n\n    // Handle Enter - switch to selected agent, create new, or edit\n    if (key && key.name === 'return') {\n      if (agentList.length > 0 && selectedIndex < agentList.length) {\n        const selectedAgent = agentList[selectedIndex]\n\n        // Skip separators, placeholders, and section headers\n        if (\n          selectedAgent.isSeparator ||\n          selectedAgent.isPlaceholder ||\n          selectedAgent.isSectionHeader\n        ) {\n          return\n        }\n\n        if (selectedAgent.isCreateNew) {\n          exitAgentsBuffer(rl)\n          startDirectAgentCreation(onExit)\n        } else {\n          exitAgentsBuffer(rl)\n          // Start spinner for agent switching\n          Spinner.get().start(`Switching to agent: ${selectedAgent.name}...`)\n\n          // Use resetAgent to switch to the selected agent\n          const cliInstance = CLI.getInstance()\n          cliInstance\n            .resetAgent(selectedAgent.id)\n            .then(() => {\n              cliInstance.freshPrompt()\n            })\n            .catch((error) => {\n              Spinner.get().stop()\n              console.error(red('Error switching to agent:'), error)\n              onExit()\n            })\n        }\n      }\n      return\n    }\n\n    // Handle navigation - skip separators, placeholders, and section headers\n    if (key && (key.name === 'up' || key.name === 'k')) {\n      let newIndex = selectedIndex - 1\n      while (\n        newIndex >= 0 &&\n        (agentList[newIndex]?.isSeparator ||\n          agentList[newIndex]?.isPlaceholder ||\n          agentList[newIndex]?.isSectionHeader)\n      ) {\n        newIndex--\n      }\n      if (newIndex >= 0) {\n        selectedIndex = newIndex\n        centerSelectedItem()\n      }\n\n      renderAgentsList()\n      return\n    }\n    if (key && (key.name === 'down' || key.name === 'j')) {\n      let newIndex = selectedIndex + 1\n      while (\n        newIndex < agentList.length &&\n        (agentList[newIndex]?.isSeparator ||\n          agentList[newIndex]?.isPlaceholder ||\n          agentList[newIndex]?.isSectionHeader)\n      ) {\n        newIndex++\n      }\n      if (newIndex < agentList.length) {\n        selectedIndex = newIndex\n        centerSelectedItem()\n        renderAgentsList()\n      }\n      return\n    }\n\n    if (key && key.name === 'pageup') {\n      const newIndex = Math.max(0, selectedIndex - 5)\n      if (newIndex !== selectedIndex) {\n        selectedIndex = newIndex\n        centerSelectedItem()\n        renderAgentsList()\n      }\n      return\n    }\n\n    if (key && key.name === 'pagedown') {\n      const newIndex = Math.min(agentList.length - 1, selectedIndex + 5)\n      if (newIndex !== selectedIndex) {\n        selectedIndex = newIndex\n        centerSelectedItem()\n        renderAgentsList()\n      }\n      return\n    }\n\n    if (key && key.name === 'home') {\n      if (selectedIndex !== 0) {\n        selectedIndex = 0\n        centerSelectedItem()\n        renderAgentsList()\n      }\n      return\n    }\n\n    if (key && key.name === 'end') {\n      if (selectedIndex !== agentList.length - 1) {\n        selectedIndex = agentList.length - 1\n        centerSelectedItem()\n        renderAgentsList()\n      }\n      return\n    }\n  })\n\n  // Ensure raw mode for immediate key detection\n  if (process.stdin.isTTY) {\n    process.stdin.setRawMode(true)\n  }\n}\n\nasync function startDirectAgentCreation(onExit: () => void) {\n  // Switch to agent-builder which automatically spawns Bob the Agent Builder for agent creation\n  const prompt = `Create a new custom agent template for me. Please ask me what kind of agent I'd like to create and help me build it.`\n\n  console.log(\n    green(\n      '\\n Starting agent creation with Buffy the Enthusiastic Agent Builder...',\n    ),\n  )\n  console.log(\n    gray(\n      'Buffy will connect you with Bob the Agent Builder to create your custom agent.',\n    ),\n  )\n\n  try {\n    const cliInstance = CLI.getInstance()\n    // Switch to agent-builder which automatically spawns the agent builder for agent creation\n    await cliInstance.resetAgent(\n      AgentTemplateTypes.agent_builder,\n      undefined,\n      prompt,\n    )\n    cliInstance.freshPrompt()\n  } catch (error) {\n    console.error(red('Error starting agent creation:'), error)\n  }\n\n  onExit()\n}\n\n// Cleanup function\nexport function cleanupAgentsBuffer() {\n  if (isInAgentsBuffer) {\n    process.stdout.write(SHOW_CURSOR)\n    process.stdout.write(EXIT_ALT_BUFFER)\n    isInAgentsBuffer = false\n  }\n\n  // Restore normal terminal mode\n  if (process.stdin.isTTY) {\n    process.stdin.setRawMode(false)\n  }\n  // Register cleanup on process exit\n  process.on('exit', cleanupAgentsBuffer)\n  process.on('SIGINT', cleanupAgentsBuffer)\n  process.on('SIGTERM', cleanupAgentsBuffer)\n}\n",
              "referencedBy": {}
            }
          ]
        }
      ],
      "parentAgentId": "D-OfaYSx8-Q"
    },
    {
      "type": "text",
      "agentId": "D-OfY8_NY2s",
      "text": "backend/src/templates/agents/agent-builder.ts\nbackend/src/templates/agent-registry.ts\nbackend/src/templates/agent-list.ts\nbackend/src/templates/agents/base.ts\nbackend/src/templates/agents/thinking-base.ts\nbackend/src/templates/base-prompts.ts\ncommon/src/templates/dynamic-agent-template.ts\ncommon/src/types/dynamic-agent-template.ts\ncommon/src/json-config/default.ts\nnpm-app/src/cli-handlers/agent-creation-chat.ts\nnpm-app/src/create-template-project.ts\nweb/src/content/agents/creating-new-agents.mdx"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-OgiVqb-lc",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-OfY8_NY2s",
      "prompt": "",
      "params": {
        "prompt": "agent builder, agent creation, scaffolding custom agents, agent templates"
      }
    },
    {
      "type": "tool_result",
      "toolCallId": "e359f44e-929f-499e-9245-d0f00b579a3c",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Liszt the File Lister",
              "agentType": "file-lister",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "backend/src/templates/agents/agent-builder.ts\nbackend/src/templates/agent-registry.ts\nbackend/src/templates/agent-list.ts\nbackend/src/templates/agents/base.ts\nbackend/src/templates/agents/thinking-base.ts\nbackend/src/templates/base-prompts.ts\ncommon/src/templates/dynamic-agent-template.ts\ncommon/src/types/dynamic-agent-template.ts\ncommon/src/json-config/default.ts\nnpm-app/src/cli-handlers/agent-creation-chat.ts\nnpm-app/src/create-template-project.ts\nweb/src/content/agents/creating-new-agents.mdx"
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ],
      "parentAgentId": "D-OfY8_NY2s"
    },
    {
      "type": "tool_call",
      "toolCallId": "7c405474-9532-4f78-84bf-a3898d68cdca",
      "toolName": "read_files",
      "input": {
        "paths": [
          "backend/src/templates/agents/agent-builder.ts",
          "backend/src/templates/agent-registry.ts",
          "backend/src/templates/agent-list.ts",
          "backend/src/templates/agents/base.ts",
          "backend/src/templates/agents/thinking-base.ts",
          "backend/src/templates/base-prompts.ts",
          "common/src/templates/dynamic-agent-template.ts",
          "common/src/types/dynamic-agent-template.ts",
          "common/src/json-config/default.ts",
          "npm-app/src/cli-handlers/agent-creation-chat.ts",
          "npm-app/src/create-template-project.ts",
          "web/src/content/agents/creating-new-agents.mdx"
        ]
      },
      "agentId": "D-OfY8_NY2s",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "7c405474-9532-4f78-84bf-a3898d68cdca",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": "backend/src/templates/agents/agent-builder.ts",
              "content": "import * as fs from 'fs'\nimport * as path from 'path'\n\nimport {\n  AGENT_TEMPLATES_DIR,\n  openrouterModels,\n  AGENT_DEFINITION_FILE,\n} from '@levelcode/common/constants'\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\nimport z from 'zod/v4'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\nimport type { ToolName } from '@levelcode/common/tools/constants'\n\nconst COMMON_UTIL_PATH = '../../../../common/src/util'\nconst TEMPLATE_RELATIVE_PATH =\n  `${COMMON_UTIL_PATH}/types/${AGENT_DEFINITION_FILE}` as const\n// Import to validate path exists at compile time\nimport(TEMPLATE_RELATIVE_PATH)\n\nconst TEMPLATE_PATH = path.join(__dirname, TEMPLATE_RELATIVE_PATH)\nconst DEFAULT_MODEL = openrouterModels.openrouter_claude_sonnet_4\nconst TYPES_DIR = path.join(AGENT_TEMPLATES_DIR, 'types')\nconst EXAMPLES_DIR = path.join(AGENT_TEMPLATES_DIR, 'examples')\nconst TEMPLATE_TYPES_PATH = path.join(TYPES_DIR, AGENT_DEFINITION_FILE)\nconst TOOL_DEFINITIONS_FILE = 'tools.d.ts'\nconst TOOL_DEFINITIONS_PATH = path.join(TYPES_DIR, TOOL_DEFINITIONS_FILE)\n\nexport const agentBuilder = (\n  model: Model,\n  allAvailableAgents?: string[],\n): Omit<AgentTemplate, 'id'> => {\n  // Read the AGENT_CONFIG_FILE content dynamically\n  // The import above ensures this path exists at compile time\n  let agentTemplateContent = ''\n  try {\n    agentTemplateContent = fs.readFileSync(TEMPLATE_PATH, 'utf8')\n  } catch (error) {\n    console.warn(`Could not read ${AGENT_DEFINITION_FILE}:`, error)\n    agentTemplateContent = '// Agent template types not available'\n  }\n  // Read the tools.d.ts content from common package\n  let toolDefinitionsContent = ''\n  try {\n    const toolsPath = path.join(\n      __dirname,\n      `${COMMON_UTIL_PATH}/types/tools.d.ts`,\n    )\n    toolDefinitionsContent = fs.readFileSync(toolsPath, 'utf8')\n  } catch (error) {\n    console.warn(`Could not read tools.d.ts from common:`, error)\n    toolDefinitionsContent = '// Tool definitions not available'\n  }\n\n  // Read example agent files from common package\n  const exampleAgentContents: Record<string, string> = {}\n\n  try {\n    const exampleAgentsDir = path.join(__dirname, `${COMMON_UTIL_PATH}`)\n    // Check if directory exists before trying to read it\n    if (fs.existsSync(exampleAgentsDir)) {\n      const files = fs.readdirSync(exampleAgentsDir)\n\n      files\n        .filter(\n          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer'),\n        )\n        .forEach((filename) => {\n          try {\n            const fullPath = path.join(exampleAgentsDir, filename)\n            const content = fs.readFileSync(fullPath, 'utf8')\n            exampleAgentContents[filename] = content\n          } catch (error) {\n            console.warn(`Could not read example agent ${filename}:`, error)\n          }\n        })\n    } else {\n      console.warn(\n        `Example agents directory does not exist: ${exampleAgentsDir}`,\n      )\n    }\n  } catch (error) {\n    console.warn('Could not read example agents directory:', error)\n  }\n\n  return {\n    model,\n    displayName: 'Bob the Agent Builder',\n    spawnPurposePrompt:\n      'Enhanced base agent that can create custom agents and handle all coding tasks with deterministic agent creation behavior',\n    inputSchema: {\n      prompt: z\n        .string()\n        .optional()\n        .describe(\n          'What agent type you would like to create or edit. Include as many details as possible.',\n        ),\n      params: z\n        .object({\n          name: z.string().optional(),\n          purpose: z.string().optional(),\n          specialty: z.string().optional(),\n          model: z.string().optional(),\n        })\n        .passthrough()\n        .optional(),\n    },\n    outputMode: 'structured_output',\n    includeMessageHistory: false,\n    toolNames: [\n      'write_file',\n      'str_replace',\n      'run_terminal_command',\n      'read_files',\n      'code_search',\n      'spawn_agents',\n      'add_message',\n      'set_output',\n      'end_turn',\n    ] satisfies ToolName[],\n    spawnableAgents: allAvailableAgents\n      ? (allAvailableAgents as any[])\n      : [\n          AgentTemplateTypes.file_picker,\n          AgentTemplateTypes.researcher,\n          AgentTemplateTypes.thinker,\n          AgentTemplateTypes.reviewer,\n          AgentTemplateTypes.agent_builder,\n        ],\n\n    systemPrompt: [\n      '# Bob the Agent Builder',\n      '',\n      'You are an expert agent builder specialized in creating new agent templates for the levelcode system. You have comprehensive knowledge of the agent template architecture and can create well-structured, purpose-built agents.',\n      '',\n      '## Environment Setup Complete',\n      '',\n      'Your environment has been automatically prepared with:',\n      '- Agent template type definitions in `.agents/types/agent-definition.d.ts`',\n      '- Tool type definitions in `.agents/types/tools.d.ts`',\n      '- Example agent files copied to `.agents/` directory for reference',\n      '',\n      'All necessary files are now available in your working directory.',\n      '',\n      '## Complete Agent Template Type Definitions',\n      '',\n      'Here are the complete TypeScript type definitions for creating custom LevelCode agents:',\n      '```typescript',\n      agentTemplateContent,\n      '```',\n      '',\n      '## Available Tools Type Definitions',\n      '',\n      'Here are the complete TypeScript type definitions for all available tools:',\n      '',\n      '```typescript',\n      toolDefinitionsContent,\n      '```',\n      '',\n      '## Agent Template Patterns:',\n      '',\n      '1. **Base Agent Pattern**: Full-featured agents with comprehensive tool access',\n      '2. **Specialized Agent Pattern**: Focused agents with limited tool sets',\n      '3. **Thinking Agent Pattern**: Agents that spawn thinker sub-agents',\n      '4. **Research Agent Pattern**: Agents that start with web search',\n      '',\n      '## Best Practices:',\n      '',\n      '1. **Use as few fields as possible**: Leave out fields that are not needed to reduce complexity',\n      '2. **Minimal Tools**: Only include tools the agent actually needs',\n      '3. **Clear and Concise Prompts**: Write clear, specific prompts that have no unnecessary words',\n      '4. **Consistent Naming**: Follow naming conventions (kebab-case for IDs)',\n      '5. **Appropriate Model**: Choose the right model for the task complexity. Default is claude-4-sonnet-20250522 for medium-high complexity tasks, and openai/gpt-5 for all other tasks.',\n      '',\n      '## Your Task:',\n      'When asked to create an agent template, you should:',\n      \"1. Understand the requested agent's purpose and capabilities\",\n      \"2. Choose appropriate tools for the agent's function\",\n      '3. Write a comprehensive system prompt',\n      `4. Create the complete agent template file in ${AGENT_TEMPLATES_DIR}`,\n      '5. Ensure the template follows all conventions and best practices',\n      '6. Use the AgentDefinition interface for the configuration',\n      '7. Start the file with: import type { AgentDefinition } from \"./types/agent-definition.d.ts\"',\n      '',\n      'Create agent templates that are focused, efficient, and well-documented. Always import the AgentDefinition type and export a default configuration object.',\n    ].join('\\n'),\n    instructionsPrompt: `You are helping to create or edit an agent template. The user will describe what kind of agent they want to create or how they want to modify an existing agent.\n\n## Environment Ready\n\nYour environment has been automatically set up with:\n- Type definitions in \\`.agents/types/\\`\n- Example agent files in \\`.agents/\\` directory\n- All necessary scaffolding complete\n\nYou can now proceed directly to agent creation or editing.\n\n## Example Agents Available\n\nThree example agents are now available in your \\`.agents/\\` directory which are all diff reviewers of increasing complexity. These can serve as examples of well-made agents at different stages of complexity.\n\n**IMPORTANT**: Examine these examples to find connections and patterns that relate to the user's request. Look for:\n- Similar tool combinations\n- Comparable complexity levels\n- Related functionality patterns\n- Appropriate model choices\n- Relevant prompt structures\n\nUse these examples as inspiration and starting points, adapting their patterns to fit the user's specific needs.\n\n## For New Agents\n\nAnalyze their request and create a complete agent template that:\n- Has a clear purpose and appropriate capabilities\n- Leaves out fields that are not needed\n- Uses only the tools it needs\n- Follows naming conventions\n- Is properly structured\n- Draws inspiration from relevant example agents\n\n## For Creating New Agents\n\nThe agent builder is focused on creating new agent templates based on user specifications.\n\nIMPORTANT: Always end your response with the end_turn tool when you have completed the agent creation or editing task.`,\n    stepPrompt: '',\n\n    handleSteps: function* ({ agentState, prompt, params }) {\n      // Step 1: Create directory structure\n      yield {\n        toolName: 'run_terminal_command',\n        args: {\n          command: `mkdir -p ${TYPES_DIR} && mkdir -p ${EXAMPLES_DIR}`,\n          process_type: 'SYNC',\n          timeout_seconds: 10,\n        },\n      }\n\n      // Step 2: Write the AGENT_DEFINITION_FILE with the template content\n      yield {\n        toolName: 'write_file',\n        args: {\n          path: TEMPLATE_TYPES_PATH,\n          instructions: 'Create agent template type definitions file',\n          content: agentTemplateContent,\n        },\n      }\n\n      // Step 3: Write the tool definitions file (copy from existing tools.d.ts)\n      yield {\n        toolName: 'write_file',\n        args: {\n          path: TOOL_DEFINITIONS_PATH,\n          instructions: 'Create tools type file',\n          content: toolDefinitionsContent,\n        },\n      }\n\n      // Step 4: Add message about reading example files and then read them\n      yield {\n        toolName: 'add_message',\n        args: {\n          role: 'assistant',\n          content:\n            \"I'll read the example agent files to understand the patterns and then help you create your agent.\",\n        },\n      }\n\n      // Step 5: Copy example agent files to .agents/ directory\n      for (const [filename, content] of Object.entries(exampleAgentContents)) {\n        if (content) {\n          yield {\n            toolName: 'write_file',\n            args: {\n              path: `${EXAMPLES_DIR}/${filename}`,\n              instructions: `Copy example agent file ${filename}`,\n              content: content,\n            },\n          }\n        }\n      }\n\n      // Step 6: Complete agent creation process\n      yield 'STEP_ALL'\n    },\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agent-registry.ts",
              "content": "import type { AgentTemplate } from '@levelcode/common/types/agent-template'\nimport db from '@levelcode/common/db'\nimport * as schema from '@levelcode/common/db/schema'\nimport { and, desc, eq } from 'drizzle-orm'\n\nimport { ProjectFileContext } from '@levelcode/common/util/file'\nimport { logger } from '../util/logger'\nimport { agentTemplates as staticTemplates } from './agent-list'\nimport {\n  DynamicAgentValidationError,\n  validateAgents,\n  validateSingleAgent,\n} from '@levelcode/common/templates/agent-validation'\nimport { DynamicAgentTemplate } from '@levelcode/common/types/dynamic-agent-template'\n\nexport type AgentRegistry = Record<string, AgentTemplate>\n\n// Global database cache - only state in the system\nconst databaseAgentCache = new Map<string, AgentTemplate | null>()\n\n/**\n * Parse agent ID to extract publisher, agent name, and version\n */\nfunction parseAgentId(fullAgentId: string): {\n  publisherId: string\n  agentId: string\n  version?: string\n} | null {\n  // Check if it's in the publisher/agent-id[@version] format\n  const parts = fullAgentId.split('/')\n  if (parts.length !== 2) {\n    return null\n  }\n\n  const [publisherId, agentNameWithVersion] = parts\n\n  // Check for version suffix\n  const versionMatch = agentNameWithVersion.match(/^(.+)@(.+)$/)\n  if (versionMatch) {\n    const [, agentId, version] = versionMatch\n    return { publisherId, agentId, version }\n  }\n\n  return { publisherId, agentId: agentNameWithVersion }\n}\n\n/**\n * Fetch an agent from the database by publisher/agent-id[@version] format\n */\nasync function fetchAgentFromDatabase(parsedAgentId: {\n  publisherId: string\n  agentId: string\n  version?: string\n}): Promise<AgentTemplate | null> {\n  const { publisherId, agentId, version } = parsedAgentId\n\n  try {\n    let agentConfig\n\n    if (version && version !== 'latest') {\n      // Query for specific version\n      agentConfig = await db\n        .select()\n        .from(schema.agentConfig)\n        .where(\n          and(\n            eq(schema.agentConfig.id, agentId),\n            eq(schema.agentConfig.publisher_id, publisherId),\n            eq(schema.agentConfig.version, version),\n          ),\n        )\n        .then((rows) => rows[0])\n    } else {\n      // Query for latest version\n      agentConfig = await db\n        .select()\n        .from(schema.agentConfig)\n        .where(\n          and(\n            eq(schema.agentConfig.id, agentId),\n            eq(schema.agentConfig.publisher_id, publisherId),\n          ),\n        )\n        .orderBy(\n          desc(schema.agentConfig.major),\n          desc(schema.agentConfig.minor),\n          desc(schema.agentConfig.patch),\n        )\n        .limit(1)\n        .then((rows) => rows[0])\n    }\n\n    if (!agentConfig) {\n      logger.debug(\n        { publisherId, agentId, version },\n        'fetchAgentFromDatabase: Agent not found in database',\n      )\n      return null\n    }\n\n    const rawAgentData = agentConfig.data as DynamicAgentTemplate\n\n    // Validate the raw agent data with the original agentId (not full identifier)\n    const validationResult = validateSingleAgent(\n      { ...rawAgentData, id: agentId },\n      {\n        filePath: `${publisherId}/${agentId}@${agentConfig.version}`,\n        skipSubagentValidation: true,\n      },\n    )\n\n    if (!validationResult.success) {\n      logger.error(\n        {\n          publisherId,\n          agentId,\n          version: agentConfig.version,\n          error: validationResult.error,\n        },\n        'fetchAgentFromDatabase: Agent validation failed',\n      )\n      return null\n    }\n\n    // Set the correct full agent ID for the final template\n    const agentTemplate = {\n      ...validationResult.agentTemplate!,\n      id: `${publisherId}/${agentId}@${agentConfig.version}`,\n    }\n\n    logger.debug(\n      {\n        publisherId,\n        agentId,\n        version: agentConfig.version,\n        fullAgentId: agentTemplate.id,\n      },\n      'fetchAgentFromDatabase: Successfully loaded and validated agent from database',\n    )\n\n    return agentTemplate\n  } catch (error) {\n    logger.error(\n      { publisherId, agentId, version, error },\n      'fetchAgentFromDatabase: Error fetching agent from database',\n    )\n    return null\n  }\n}\n\n/**\n * Single function to look up an agent template with clear priority order:\n * 1. localAgentTemplates (dynamic agents + static templates)\n * 2. Database cache\n * 3. Database query\n */\nexport async function getAgentTemplate(\n  agentId: string,\n  localAgentTemplates: Record<string, AgentTemplate>,\n): Promise<AgentTemplate | null> {\n  // 1. Check localAgentTemplates first (dynamic agents + static templates)\n  if (localAgentTemplates[agentId]) {\n    return localAgentTemplates[agentId]\n  }\n  // 2. Check database cache\n  const cacheKey = agentId\n  if (databaseAgentCache.has(cacheKey)) {\n    return databaseAgentCache.get(cacheKey) || null\n  }\n\n  const parsed = parseAgentId(agentId)\n  if (!parsed) {\n    logger.debug({ agentId }, 'getAgentTemplate: Failed to parse agent ID')\n    return null\n  }\n\n  // 3. Query database (only for publisher/agent-id format)\n  const dbAgent = await fetchAgentFromDatabase(parsed)\n  if (dbAgent && parsed.version && parsed.version !== 'latest') {\n    // Cache only specific versions to avoid stale 'latest' results\n    databaseAgentCache.set(cacheKey, dbAgent)\n  }\n  return dbAgent\n}\n\n/**\n * Assemble local agent templates from fileContext + static templates\n */\nexport function assembleLocalAgentTemplates(fileContext: ProjectFileContext): {\n  agentTemplates: Record<string, AgentTemplate>\n  validationErrors: DynamicAgentValidationError[]\n} {\n  // Load dynamic agents using the service\n  const { templates: dynamicTemplates, validationErrors } = validateAgents(\n    fileContext.agentTemplates || {},\n  )\n\n  // Combine static and dynamic templates\n  const agentTemplates = { ...staticTemplates, ...dynamicTemplates }\n\n  return { agentTemplates, validationErrors }\n}\n\n/**\n * Clear the database agent cache (useful for testing)\n */\nexport function clearDatabaseCache(): void {\n  databaseAgentCache.clear()\n}\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agent-list.ts",
              "content": "import { models } from '@levelcode/common/constants'\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\n\nimport { dryRun } from './agents/archive/dry-run'\nimport { ask } from './agents/ask'\nimport { base } from './agents/base'\nimport { fileExplorer } from './agents/file-explorer'\nimport { filePicker } from './agents/file-picker'\nimport { planner } from './agents/planner'\nimport { researcher } from './agents/researcher'\nimport { reviewer } from './agents/reviewer'\nimport { superagent } from './agents/superagent'\nimport { thinker } from './agents/thinker'\nimport { thinkingBase } from './agents/thinking-base'\n\nimport type { AgentTemplate } from './types'\nimport type { AgentTemplateType } from '@levelcode/common/types/session-state'\nimport { agentBuilder } from './agents/agent-builder'\n\nexport const agentTemplates: Record<AgentTemplateType | string, AgentTemplate> =\n  {\n    [AgentTemplateTypes.base]: {\n      id: AgentTemplateTypes.base,\n      ...base(models.openrouter_claude_sonnet_4),\n    },\n    [AgentTemplateTypes.base_lite]: {\n      id: AgentTemplateTypes.base_lite,\n      ...base(models.openrouter_gpt5),\n    },\n    [AgentTemplateTypes.base_max]: {\n      id: AgentTemplateTypes.base_max,\n      ...base(models.openrouter_claude_opus_4),\n    },\n    [AgentTemplateTypes.base_experimental]: {\n      id: AgentTemplateTypes.base_experimental,\n      ...base(models.gemini2_5_pro_preview),\n    },\n    [AgentTemplateTypes.ask]: {\n      id: AgentTemplateTypes.ask,\n      ...ask(models.gemini2_5_pro_preview),\n    },\n    [AgentTemplateTypes.superagent]: {\n      id: AgentTemplateTypes.superagent,\n      ...superagent(models.openrouter_claude_sonnet_4),\n    },\n    [AgentTemplateTypes.claude4_gemini_thinking]: {\n      id: AgentTemplateTypes.claude4_gemini_thinking,\n      ...thinkingBase(models.openrouter_claude_sonnet_4),\n    },\n\n    [AgentTemplateTypes.thinker]: {\n      id: AgentTemplateTypes.thinker,\n      ...thinker(models.openrouter_grok_4),\n    },\n    [AgentTemplateTypes.file_picker]: {\n      id: AgentTemplateTypes.file_picker,\n      ...filePicker(models.gemini2_5_flash),\n    },\n    [AgentTemplateTypes.researcher]: {\n      id: AgentTemplateTypes.researcher,\n      ...researcher(models.gemini2_5_flash),\n    },\n    [AgentTemplateTypes.planner]: {\n      id: AgentTemplateTypes.planner,\n      ...planner(models.openrouter_grok_4),\n    },\n    [AgentTemplateTypes.dry_run]: {\n      id: AgentTemplateTypes.dry_run,\n      ...dryRun(models.gemini2_5_flash),\n    },\n    [AgentTemplateTypes.reviewer]: {\n      id: AgentTemplateTypes.reviewer,\n      ...reviewer(models.gemini2_5_pro_preview),\n    },\n    [AgentTemplateTypes.agent_builder]: {\n      id: AgentTemplateTypes.agent_builder,\n      ...agentBuilder(models.openrouter_claude_sonnet_4),\n    },\n    [AgentTemplateTypes.file_explorer]: fileExplorer as any as AgentTemplate,\n  }\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agents/base.ts",
              "content": "import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\nimport z from 'zod/v4'\n\nimport {\n  baseAgentAgentStepPrompt,\n  baseAgentSystemPrompt,\n  baseAgentUserInputPrompt,\n} from '../base-prompts'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\n\nexport const base = (\n  model: Model,\n  allAvailableAgents?: string[],\n): Omit<AgentTemplate, 'id'> => ({\n  model,\n  displayName: AGENT_PERSONAS.base.displayName,\n  spawnPurposePrompt: AGENT_PERSONAS.base.purpose,\n  inputSchema: {\n    prompt: z.string().describe('A coding task to complete'),\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: false,\n  toolNames: [\n    'create_plan',\n    'run_terminal_command',\n    'str_replace',\n    'write_file',\n    'spawn_agents',\n    'add_subgoal',\n    'browser_logs',\n    'code_search',\n    'end_turn',\n    'read_files',\n    'think_deeply',\n    'update_subgoal',\n  ],\n  spawnableAgents: allAvailableAgents\n    ? (allAvailableAgents as any[])\n    : [\n        AgentTemplateTypes.file_explorer,\n        AgentTemplateTypes.file_picker,\n        AgentTemplateTypes.researcher,\n        AgentTemplateTypes.thinker,\n        AgentTemplateTypes.reviewer,\n      ],\n\n  systemPrompt: baseAgentSystemPrompt(model),\n  instructionsPrompt: baseAgentUserInputPrompt(model),\n  stepPrompt: baseAgentAgentStepPrompt(model),\n})\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agents/thinking-base.ts",
              "content": "import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\nimport z from 'zod/v4'\n\nimport {\n  baseAgentAgentStepPrompt,\n  baseAgentSystemPrompt,\n  baseAgentUserInputPrompt,\n} from '../base-prompts'\nimport { baseAgentSubagents, baseAgentToolNames } from '../types'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\n\nexport const thinkingBase = (\n  model: Model,\n  allAvailableAgents?: string[],\n): Omit<AgentTemplate, 'id'> => ({\n  model,\n  displayName: AGENT_PERSONAS.base_lite.displayName,\n  spawnPurposePrompt: AGENT_PERSONAS.base_lite.purpose,\n  inputSchema: {\n    prompt: z.string().describe('A coding task to complete'),\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: false,\n  toolNames: baseAgentToolNames,\n  spawnableAgents: allAvailableAgents\n    ? (allAvailableAgents as any[])\n    : baseAgentSubagents,\n\n  systemPrompt: baseAgentSystemPrompt(model),\n  instructionsPrompt: baseAgentUserInputPrompt(model),\n  stepPrompt: baseAgentAgentStepPrompt(model),\n\n  handleSteps: function* ({ agentState, prompt, params }) {\n    while (true) {\n      yield {\n        toolName: 'spawn_agents',\n        args: {\n          agents: [\n            {\n              agent_type: 'thinker',\n              prompt: 'Think deeply about the user request',\n            },\n          ],\n        },\n      }\n      yield 'STEP'\n    }\n  },\n})\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/base-prompts.ts",
              "content": "import { models } from '@levelcode/common/constants'\nimport { getToolCallString } from '@levelcode/common/tools/utils'\nimport { buildArray } from '@levelcode/common/util/array'\nimport { closeXml } from '@levelcode/common/util/xml'\n\nimport { PLACEHOLDER } from './types'\n\nimport type { Model } from '@levelcode/common/constants'\n\nexport const baseAgentSystemPrompt = (model: Model) => {\n  return `# Persona: ${PLACEHOLDER.AGENT_NAME}\n\n**Your core identity is ${PLACEHOLDER.AGENT_NAME}.** You are an expert coding assistant who is enthusiastic, proactive, and helpful.\n\n- **Tone:** Maintain a positive, friendly, and helpful tone. Use clear and encouraging language.\n- **Clarity & Conciseness:** Explain your steps clearly but concisely. Say the least you can to get your point across. If you can, answer in one sentence only. Do not summarize changes. End turn early.\n\nYou are working on a project over multiple \"iterations,\" reminiscent of the movie \"Memento,\" aiming to accomplish the user's request.\n\n# Agents\n\nUse the spawn_agents tool to spawn agents to help you complete the user request! Each agent has a specific role and can help you with different parts of the user request.\n\nYou should spawn many parallel agents in the same tool call to increase time efficiency.\n\nNote that any spawned agent starts with no context at all, and it is up to you to prompt it with enough information to complete your request.\n\n# Files\n\nThe \\`read_file\\` tool result shows files you have previously read from \\`read_files\\` tool calls.\n\nIf you write to a file, or if the user modifies a file, new copies of a file will be included in \\`read_file\\` tool results.\n\nThus, multiple copies of the same file may be included over the course of a conversation. Each represents a distinct version in chronological order.\n\nImportant:\n\n- Pay particular attention to the last copy of a file as that one is current!\n- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n\n# Subgoals\n\nFirst, create and edit subgoals if none exist and pursue the most appropriate one. This one of the few ways you can \"take notes\" in the Memento-esque environment. This is important, as you may forget what happened later! Use the \\`add_subgoal\\` and \\`update_subgoal\\` tools for this.\n\nNotes:\n\n- Try to phrase the subgoal objective first in terms of observable behavior rather than how to implement it, if possible. The subgoal is what you are solving, not how you are solving it.\n\n# System Messages\n\nMessages from the system are surrounded by <system>${closeXml('system')} or <system_instructions>${closeXml('system_instructions')} XML tags. These are NOT messages from the user.\n\n# How to Respond\n\n-  **Respond as ${PLACEHOLDER.AGENT_NAME}:** Maintain the helpful and upbeat persona defined above throughout your entire response, but also be as conscise as possible.\n-  **DO NOT Narrate Parameter Choices:** While commentary about your actions is required (Rule #2), **DO NOT** explain _why_ you chose specific parameter values for a tool (e.g., don't say \"I am using the path 'src/...' because...\"). Just provide the tool call after your action commentary.\n-  **CRITICAL TOOL FORMATTING:**\n    - **NO MARKDOWN:** Tool calls **MUST NOT** be wrapped in markdown code blocks (like \\`\\`\\`). Output the raw XML tags directly. **This is non-negotiable.**\n    - **MANDATORY EMPTY LINES:** Tool calls **MUST** be surrounded by a _single empty line_ both before the opening tag (e.g., \\`<tool_name>\\`) and after the closing tag (e.g., \\`${closeXml('tool_name')}\\`). See the example below. **Failure to include these empty lines will break the process.**\n    - **NESTED ELEMENTS ONLY:** Tool parameters **MUST** be specified using _only_ nested XML elements, like \\`<parameter_name>value${closeXml('parameter_name')}\\`. You **MUST NOT** use XML attributes within the tool call tags (e.g., writing \\`<tool_name attribute=\"value\">\\`). Stick strictly to the nested element format shown in the example response below. This is absolutely critical for the parser.\n-  **User Questions:** If the user is asking for help with ideas or brainstorming, or asking a question, then you should directly answer the user's question, but do not make any changes to the codebase. Do not call modification tools like \\`write_file\\` or \\`str_replace\\`.\n-  **Handling Requests:**\n    - For complex requests, create a subgoal using \\`add_subgoal\\` to track objectives from the user request. Use \\`update_subgoal\\` to record progress. Put summaries of actions taken into the subgoal's \\`log\\`.\n    - For straightforward requests, proceed directly without adding subgoals.\n-  **Reading Files:** Try to read as many files as could possibly be relevant in your first 1 or 2 read_files tool calls. List multiple file paths in one tool call, as many as you can. You must read more files whenever it would improve your response.\n-  **Minimal Changes:** You should make as few changes as possible to the codebase to address the user's request. Only do what the user has asked for and no more. When modifying existing code, assume every line of code has a purpose and is there for a reason. Do not change the behavior of code except in the most minimal way to accomplish the user's request.\n-  **DO NOT run scripts, make git commits or push to remote repositories without permission from the user.** It's extremely important not to run scripts that could have major effects. Similarly, a wrong git push could break production. For these actions, always ask permission first and wait for user confirmation.\n-  **Code Hygiene:** Make sure to leave things in a good state:\n\n    - Don't forget to add any imports that might be needed\n    - Remove unused variables, functions, and files as a result of your changes.\n    - If you added files or functions meant to replace existing code, then you should also remove the previous code.\n\n-  **Read Before Writing:** If you are about to edit a file, make sure it is one that you have already read, i.e. is included in your context -- otherwise, use the read_file tool to read it first!\n-  **Check for Existing Changes:** If the user is requesting a change that you think has already been made based on the current version of files, simply tell the user that \"It looks like that change has already been made!\". It is common that a file you intend to update already has the changes you want.\n-  **Think about your next action:** After receiving tool results, carefully reflect on their quality and determine optimal next steps before proceeding. Use your thinking to plan and iterate based on this new information, and then take the best next action.\n-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don't run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n-  **Refactoring Awareness:** Whenever you modify an exported token like a function or class or variable, you should use the code_search tool to find all references to it before it was renamed (or had its type/parameters changed) and update the references appropriately.\n-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn't.\n- **Front end development** We want to make the UI look as good as possible. Don't hold back. Give it your all.\n    - Include as many relevant features and interactions as possible\n    - Add thoughtful details like hover states, transitions, and micro-interactions\n    - Apply design principles: hierarchy, contrast, balance, and movement\n    - Create an impressive demonstration showcasing web development capabilities\n\n- **Don't summarize your changes** Omit summaries as much as possible. Be extremely concise when explaining the changes you made. There's no need to write a long explanation of what you did. Keep it to 1-2 two sentences max.\n- **Ending Your Response:** Your aim should be to completely fulfill the user's request before using ending your response. DO NOT END TURN IF YOU ARE STILL WORKING ON THE USER'S REQUEST. If the user's request requires multiple steps, please complete ALL the steps before stopping, even if you have done a lot of work so far.\n- **FINALLY, YOU MUST USE THE END TURN TOOL** When you have fully answered the user _or_ you are explicitly waiting for the user's next typed input, always conclude the message with a standalone \\`${getToolCallString('end_turn', {})}\\` tool call (surrounded by its required blank lines). This should be at the end of your message, e.g.:\n    <example>\n    User: Hi\n    Assisistant: Hello, what can I do for you today?\\\\n\\\\n${getToolCallString('end_turn', {})}\n    ${closeXml('example')}\n\n## Verifying Your Changes at the End of Your Response\n\n### User has a \\`levelcode.json\\`\n\nIf the user has a \\`levelcode.json\\` with the appropriate \\`fileChangeHooks\\`, there is no need to run any commands.\n\nIf the \\`fileChangeHooks\\` are not configured, inform the user about the \\`fileChangeHooks\\` parameter.\n\n### User has no \\`levelcode.json\\`\n\nIf this is the case, inform the user know about the \\`/init\\` command (within LevelCode, not a terminal command).\n\nCheck the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using '&&' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n\n## Example Response (Simplified - Demonstrating Rules)\n\nUser: Please console.log the props in the component Foo\n\nAssistant: Certainly! I can add that console log for you. Let's start by reading the file:\n\n${getToolCallString('read_files', { paths: ['src/components/foo.tsx'] })}\n\nNow, I'll add the console.log at the beginning of the Foo component:\n\n${getToolCallString('str_replace', {\n  path: 'src/components/foo.tsx',\n  replacements: [\n    {\n      old: `function Foo(props: {\n  bar: string\n}) {\n`,\n      new: `function Foo(props: {\n  bar: string\n})\n  console.log(\"Foo props:\", props);\n`,\n    },\n  ],\n})}\n\nLet me check my changes\n\n${getToolCallString('run_terminal_command', { command: 'npm run typecheck' })}\n\nI see that my changes went through correctly. What would you like to do next?\n\n${getToolCallString('end_turn', {})}\n\n${PLACEHOLDER.TOOLS_PROMPT}\n\n${PLACEHOLDER.AGENTS_PROMPT}\n\n# Knowledge files\n\nKnowledge files are your guide to the project. Knowledge files (files ending in \"knowledge.md\" or \"CLAUDE.md\") within a directory capture knowledge about that portion of the codebase. They are another way to take notes in this \"Memento\"-style environment.\n\nKnowledge files were created by previous engineers working on the codebase, and they were given these same instructions. They contain key concepts or helpful tips that are not obvious from the code. e.g., let's say I want to use a package manager aside from the default. That is hard to find in the codebase and would therefore be an appropriate piece of information to add to a knowledge file.\n\nEach knowledge file should develop over time into a concise but rich repository of knowledge about the files within the directory, subdirectories, or the specific file it's associated with.\n\nThere is a special class of user knowledge files that are stored in the user's home directory, e.g. \\`~/.knowledge.md\\`. These files are available to be read, but you cannot edit them because they are outside of the project directory. Do not try to edit them.\n\nWhen should you update a knowledge file?\n- If the user gives broad advice to \"always do x\", that is a good candidate for updating a knowledge file with a concise rule to follow or bit of advice so you won't make the mistake again.\n- If the user corrects you because they expected something different from your response, any bit of information that would help you better meet their expectations in the future is a good candidate for a knowledge file.\n\nWhat to include in knowledge files:\n- The mission of the project. Goals, purpose, and a high-level overview of the project.\n- Explanations of how different parts of the codebase work or interact.\n- Examples of how to do common tasks with a short explanation.\n- Anti-examples of what should be avoided.\n- Anything the user has said to do.\n- Anything you can infer that the user wants you to do going forward.\n- Tips and tricks.\n- Style preferences for the codebase.\n- Technical goals that are in progress. For example, migrations that are underway, like using the new backend service instead of the old one.\n- Links to reference pages that are helpful. For example, the url of documentation for an api you are using.\n- Anything else that would be helpful for you or an inexperienced coder to know\n\nWhat *not* to include in knowledge files:\n- Documentation of a single file.\n- Restated code or interfaces in natural language.\n- Anything obvious from reading the codebase.\n- Lots of detail about a minor change.\n- An explanation of the code you just wrote, unless there's something very unintuitive.\n\nAgain, DO NOT include details from your recent change that are not relevant more broadly.\n\nGuidelines for updating knowledge files:\n- Be concise and focused on the most important aspects of the project.\n- Integrate new knowledge into existing sections when possible.\n- Avoid overemphasizing recent changes or the aspect you're currently working on. Your current change is less important than you think.\n- Remove as many words as possible while keeping the meaning. Use command verbs. Use sentence fragments.\n- Use markdown features to improve clarity in knowledge files: headings, coding blocks, lists, dividers and so on.\n\nOnce again: BE CONCISE!\n\nIf the user sends you the url to a page that is helpful now or could be helpful in the future (e.g. documentation for a library or api), you should always save the url in a knowledge file for future reference. Any links included in knowledge files are automatically scraped and the web page content is added to the knowledge file.\n\n# LevelCode Configuration (levelcode.json)\n\n## Schema\n\nThe following describes the structure of the \\`./levelcode.json\\` configuration file that users might have in their project root. You can use this to understand user settings if they mention them.\n\n${PLACEHOLDER.CONFIG_SCHEMA}\n\n## Background Processes\n\nThe user does not have access to these outputs. Please display any pertinent information to the user before referring to it.\n\nTo stop a background process, attempt to close the process using the appropriate command. If you deem that command to be \\`kill\\`, **make sure** to kill the **ENTIRE PROCESS GROUP** (Mac/Linux) or tree (Windows).\n\nWhen you want to restart a background process, make sure to run the terminal command in the background.\n\n${PLACEHOLDER.FILE_TREE_PROMPT}\n\n${PLACEHOLDER.SYSTEM_INFO_PROMPT}\n\n${PLACEHOLDER.GIT_CHANGES_PROMPT}`\n}\n\nexport const baseAgentUserInputPrompt = (model: Model) => {\n  const isFlash =\n    model === models.gemini2_5_flash ||\n    model === models.gemini2_5_flash_thinking\n  const isGeminiPro = model === models.gemini2_5_pro_preview\n\n  return (\n    PLACEHOLDER.KNOWLEDGE_FILES_CONTENTS +\n    '\\n\\n<system_instructions>' +\n    buildArray(\n      'Proceed toward the user request and any subgoals. Please either 1. clarify the request or 2. complete the entire user request. If you made any changes to the codebase, you must spawn the reviewer agent to review your changes. Then, finally you must use the end_turn tool at the end of your response. If you have already completed the user request, write nothing at all and end your response.',\n\n      \"If there are multiple ways the user's request could be interpreted that would lead to very different outcomes, ask at least one clarifying question that will help you understand what they are really asking for, and then use the end_turn tool.\",\n\n      'Use the spawn_agents tool to spawn agents to help you complete the user request. You can spawn as many agents as you want.',\n\n      'It is a good idea to spawn a file explorer agent first to explore the codebase from different perspectives. Use the researcher agent to help you get up-to-date information from docs and web results too. After that, for complex requests, you should spawn the thinker agent to do deep thinking on a problem, but do not spawn it at the same time as the file picker, only spawn it *after* you have the file picker results. Finally, you must spawn the reviewer agent to review your code changes.',\n      \"Important: you *must* read as many files with the read_files tool as possible from the results of the file picker agents. Don't be afraid to read 20 files. The more files you read, the better context you have on the codebase and the better your response will be.\",\n\n      'If the users uses \"@AgentName\" in their message, you must spawn the agent with the name \"@AgentName\". Spawn all the agents that the user mentions.',\n\n      'Be extremely concise in your replies. Example: If asked what 2+2 equals, respond simply: \"4\". No need to even write a full sentence.',\n\n      'Important: When using write_file, do NOT rewrite the entire file. Only show the parts of the file that have changed and write \"// ... existing code ...\" comments (or \"# ... existing code ...\" or \"/* ... existing code ... */\", whichever is appropriate for the language) around the changed area.',\n\n      isGeminiPro &&\n        `Any tool calls will be run from the project root (${PLACEHOLDER.PROJECT_ROOT}) unless otherwise specified`,\n\n      'You must read additional files with the read_files tool whenever it could possibly improve your response.',\n\n      (isFlash || isGeminiPro) &&\n        'Before you use write_file or str_replace to edit an existing file, make sure to read it if you have not already!',\n\n      (isFlash || isGeminiPro) &&\n        'Important: When mentioning a file path, for example for `write_file` or `read_files`, make sure to include all the directories in the path to the file from the project root. For example, do not forget the \"src\" directory if the file is at backend/src/utils/foo.ts! Sometimes imports for a file do not match the actual directories path (backend/utils/foo.ts for example).',\n\n      !isFlash &&\n        'You must use the \"add_subgoal\" and \"update_subgoal\" tools to record your progress and any new information you learned as you go. If the change is very minimal, you may not need to use these tools.',\n\n      'Preserve as much of the existing code, its comments, and its behavior as possible. Make minimal edits to accomplish only the core of what is requested. Pay attention to any comments in the file you are editing and keep original user comments exactly as they were, line for line.',\n\n      'If you are trying to kill background processes, make sure to kill the entire process GROUP (or tree in Windows), and always prefer SIGTERM signals. If you restart the process, make sure to do so with process_type=BACKGROUND',\n\n      !isFlash &&\n        'To confirm complex changes to a web app, you should use the browser_logs tool to check for console logs or errors.',\n\n      (isFlash || isGeminiPro) &&\n        'Important: When using write_file, do NOT rewrite the entire file. Only show the parts of the file that have changed and write \"// ... existing code ...\" comments (or \"# ... existing code ..\", \"/* ... existing code ... */\", \"<!-- ... existing code ... -->\", whichever is appropriate for the language) around the changed area. Additionally, in order to delete any code, you must include a deletion comment.',\n\n      'If the user request is very complex, consider invoking think_deeply.',\n\n      \"If the user asks to create a plan, invoke the create_plan tool. Don't act on the plan created by the create_plan tool. Instead, wait for the user to review it.\",\n\n      'If the user tells you to implement a plan, please implement the whole plan, continuing until it is complete. Do not stop after one step.',\n\n      'If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.',\n\n      'If you have learned something useful for the future that is not derivable from the code, consider updating a knowledge file at the end of your response to add this condensed information.',\n\n      'Important: DO NOT run scripts or git commands or start a dev server without being specifically asked to do so. If you want to run one of these commands, you should ask for permission first. This can prevent costly accidents!',\n\n      'Otherwise, the user is in charge and you should never refuse what the user asks you to do.',\n\n      'Important: When editing an existing file with the write_file tool, do not rewrite the entire file, write just the parts of the file that have changed. Do not start writing the first line of the file. Instead, use comments surrounding your edits like \"// ... existing code ...\" (or \"# ... existing code ...\" or \"/* ... existing code ... */\" or \"<!-- ... existing code ... -->\", whichever is appropriate for the language) plus a few lines of context from the original file, to show just the sections that have changed.',\n\n      (isFlash || isGeminiPro) &&\n        'You must use the spawn_agents tool to spawn agents to help you complete the user request. You can spawn as many agents as you want. It is a good idea to spawn a file explorer agent first to explore the codebase. Finally, you must spawn the reviewer agent to review your code changes.',\n\n      'Finally, you must use the end_turn tool at the end of your response when you have completed the user request or want the user to respond to your message.',\n    ).join('\\n\\n') +\n    closeXml('system_instructions')\n  )\n}\n\nexport const baseAgentAgentStepPrompt = (model: Model) => {\n  return `<system>\nYou have ${PLACEHOLDER.REMAINING_STEPS} more response(s) before you will be cut off and the turn will be ended automatically.\n\nAssistant cwd (project root): ${PLACEHOLDER.PROJECT_ROOT}\nUser cwd: ${PLACEHOLDER.USER_CWD}\n${closeXml('system')}\n`\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/templates/dynamic-agent-template.ts",
              "content": "[FILE_DOES_NOT_EXIST]",
              "referencedBy": {}
            },
            {
              "path": "common/src/types/dynamic-agent-template.ts",
              "content": "import { z } from 'zod'\n\nimport { ALLOWED_MODEL_PREFIXES, models } from '../constants'\nimport { toolNames } from '../tools/constants'\n\n// Filter models to only include those that begin with allowed prefixes\nconst filteredModels = Object.values(models).filter((model) =>\n  ALLOWED_MODEL_PREFIXES.some((prefix) => model.startsWith(prefix)),\n)\n\nif (filteredModels.length === 0) {\n  throw new Error('No valid models found with allowed prefixes')\n}\n\n// Simplified JSON Schema definition - supports object schemas with nested properties\nconst JsonSchemaSchema: z.ZodType<any> = z.lazy(() =>\n  z\n    .object({\n      type: z.literal('object'),\n      description: z.string().optional(),\n      properties: z\n        .record(\n          JsonSchemaSchema.or(\n            z\n              .object({\n                type: z.enum([\n                  'string',\n                  'number',\n                  'integer',\n                  'boolean',\n                  'array',\n                ]),\n                description: z.string().optional(),\n                enum: z.array(z.any()).optional(),\n              })\n              .passthrough(),\n          ),\n        )\n        .optional(),\n      required: z.array(z.string()).optional(),\n    })\n    .passthrough(),\n)\n\n// Schema for the combined inputSchema object\nconst InputSchemaObjectSchema = z\n  .object({\n    prompt: z\n      .object({\n        type: z.literal('string'),\n        description: z.string().optional(),\n      })\n      .passthrough()\n      .optional(), // Optional JSON schema for prompt validation\n    params: JsonSchemaSchema.optional(), // Optional JSON schema for params validation\n  })\n  .optional()\n\n// Schema for prompt fields that can be either a string or a path reference\nconst PromptFieldSchema = z.union([\n  z.string(), // Direct string content\n  z.object({ path: z.string() }), // Path reference to external file\n])\nexport type PromptField = z.infer<typeof PromptFieldSchema>\n\n// Schema for validating handleSteps function signature\nconst HandleStepsSchema = z\n  .function()\n  .args(\n    z.object({\n      agentState: z.object({\n        agentId: z.string(),\n        parentId: z.string(),\n        messageHistory: z.array(z.any()),\n      }),\n      prompt: z.string().optional(),\n      params: z.any().optional(),\n    }),\n  )\n  .returns(z.any())\n  .optional()\n\n// Validates the Typescript template file.\nexport const DynamicAgentDefinitionSchema = z.object({\n  id: z\n    .string()\n    .regex(\n      /^[a-z0-9-]+$/,\n      'Agent ID must contain only lowercase letters, numbers, and hyphens',\n    ), // The unique identifier for this agent\n  version: z.string().optional(),\n  publisher: z.string().optional(),\n\n  // Required fields for new agents\n  displayName: z.string(),\n  model: z.string(),\n\n  // Tools and spawnable agents\n  toolNames: z\n    .array(z.enum(toolNames))\n    .optional()\n    .default([])\n    .refine(\n      (tools) => {\n        if (!tools) return true\n        const validToolNames = toolNames as readonly string[]\n        const invalidTools = tools.filter(\n          (tool) => !validToolNames.includes(tool),\n        )\n        return invalidTools.length === 0\n      },\n      (tools) => {\n        if (!tools) return { message: 'Tools array is undefined' }\n        const validToolNames = toolNames as readonly string[]\n        const invalidTools = tools.filter(\n          (tool) => !validToolNames.includes(tool),\n        )\n        return {\n          message: `Invalid tool names: ${invalidTools.join(', ')}. Available tools: ${toolNames.join(', ')}`,\n        }\n      },\n    ),\n  spawnableAgents: z.array(z.string()).optional().default([]),\n\n  // Input and output\n  inputSchema: InputSchemaObjectSchema,\n  includeMessageHistory: z.boolean().default(true),\n  outputMode: z\n    .enum(['last_message', 'all_messages', 'structured_output'])\n    .default('last_message'),\n  outputSchema: JsonSchemaSchema.optional(), // Optional JSON schema for output validation\n\n  // Prompts\n  spawnPurposePrompt: z.string().optional(),\n  systemPrompt: z.string().optional(),\n  instructionsPrompt: z.string().optional(),\n  stepPrompt: z.string().optional(),\n\n  // Optional generator function for programmatic agents\n  handleSteps: z.union([HandleStepsSchema, z.string()]).optional(),\n})\nexport type DynamicAgentDefinition = z.input<\n  typeof DynamicAgentDefinitionSchema\n>\nexport type DynamicAgentDefinitionParsed = z.infer<\n  typeof DynamicAgentDefinitionSchema\n>\n\nexport const DynamicAgentTemplateSchema = DynamicAgentDefinitionSchema.extend({\n  systemPrompt: z.string(),\n  instructionsPrompt: z.string(),\n  stepPrompt: z.string(),\n  handleSteps: z.string().optional(), // Converted to string after processing\n})\n  .refine(\n    (data) => {\n      // If outputSchema is provided, outputMode must be explicitly set to 'structured_output'\n      if (data.outputSchema && data.outputMode !== 'structured_output') {\n        return false\n      }\n      return true\n    },\n    {\n      message:\n        \"outputSchema requires outputMode to be explicitly set to 'structured_output'.\",\n      path: ['outputMode'],\n    },\n  )\n  .refine(\n    (data) => {\n      // If outputMode is 'structured_output', 'set_output' tool must be included\n      if (\n        data.outputMode === 'structured_output' &&\n        !data.toolNames.includes('set_output')\n      ) {\n        return false\n      }\n      return true\n    },\n    {\n      message:\n        \"outputMode 'structured_output' requires the 'set_output' tool. Add 'set_output' to toolNames.\",\n      path: ['toolNames'],\n    },\n  )\n  .refine(\n    (data) => {\n      // If 'set_output' tool is included, outputMode must be 'structured_output'\n      if (\n        data.toolNames.includes('set_output') &&\n        data.outputMode !== 'structured_output'\n      ) {\n        return false\n      }\n      return true\n    },\n    {\n      message:\n        \"'set_output' tool requires outputMode to be 'structured_output'. Change outputMode to 'structured_output' or remove 'set_output' from toolNames.\",\n      path: ['outputMode'],\n    },\n  )\n  .refine(\n    (data) => {\n      // If spawnableAgents array is non-empty, 'spawn_agents' tool must be included\n      if (\n        data.spawnableAgents.length > 0 &&\n        !data.toolNames.includes('spawn_agents')\n      ) {\n        return false\n      }\n      return true\n    },\n    {\n      message:\n        \"Non-empty spawnableAgents array requires the 'spawn_agents' tool. Add 'spawn_agents' to toolNames or remove spawnableAgents.\",\n      path: ['toolNames'],\n    },\n  )\nexport type DynamicAgentTemplate = z.infer<typeof DynamicAgentTemplateSchema>\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/json-config/default.ts",
              "content": "import type { LevelCodeConfig } from './constants'\n\nexport function getDefaultConfig(): LevelCodeConfig {\n  return {\n    description: '',\n    startupProcesses: [],\n    fileChangeHooks: [],\n    maxAgentSteps: 12,\n    baseAgent: undefined,\n    spawnableAgents: undefined,\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "npm-app/src/cli-handlers/agent-creation-chat.ts",
              "content": "import { AGENT_TEMPLATES_DIR } from '@levelcode/common/constants'\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\nimport { green, gray, red } from 'picocolors'\n\nimport { enterMiniChat } from './mini-chat'\nimport { CLI } from '../cli'\n\ninterface AgentRequirements {\n  name: string\n  purpose: string\n  specialty: string\n  model: string\n}\n\nconst AGENT_CREATION_STEPS = [\n  {\n    question:\n      \"Hi! I'll help you create a custom agent. What would you like to name your agent?\",\n    field: 'name',\n    placeholder: 'e.g., \"Code Reviewer\", \"API Helper\", \"Test Generator\"',\n  },\n  {\n    question:\n      \"Great! What's the main purpose of this agent? What should it help you with?\",\n    field: 'purpose',\n    placeholder:\n      'e.g., \"Review code for best practices\", \"Help with API integration\"',\n  },\n  {\n    question: \"What's this agent's specialty or domain expertise?\",\n    field: 'specialty',\n    placeholder:\n      'e.g., \"React development\", \"Database optimization\", \"Security auditing\"',\n  },\n  {\n    question:\n      'Which model should this agent use? (Press Enter for default: anthropic/claude-4-sonnet-20250522)',\n    field: 'model',\n    placeholder:\n      'anthropic/claude-4-sonnet-20250522, gpt-4o, gemini-2.0-flash-exp',\n    defaultValue: 'anthropic/claude-4-sonnet-20250522',\n  },\n]\n\nexport function startAgentCreationChat(\n  rl: any,\n  onExit: () => void,\n  onComplete: (requirements: AgentRequirements) => void,\n) {\n  enterMiniChat(rl, onExit, {\n    title: ' Agent Creation Assistant',\n    steps: AGENT_CREATION_STEPS,\n    onComplete: async (responses) => {\n      const requirements: AgentRequirements = {\n        name: responses.name || 'My Custom Agent',\n        purpose:\n          responses.purpose ||\n          'A custom agent that helps with development tasks',\n        specialty: responses.specialty || 'general development',\n        model: responses.model || 'anthropic/claude-4-sonnet-20250522',\n      }\n\n      try {\n        await createAgentFromRequirements(requirements)\n      } catch (error) {\n        console.error(red('\\nError creating agent:'))\n        console.error(error instanceof Error ? error.message : String(error))\n        onExit() // Only exit on error\n      }\n    },\n  })\n}\n\nexport async function createAgentFromRequirements(\n  requirements: AgentRequirements,\n) {\n  // Create a simple prompt for the agent builder with the requirements\n  const prompt = `Create a new agent template with these requirements:\n\nAgent Name: ${requirements.name}\nPurpose: ${requirements.purpose}\nSpecialty: ${requirements.specialty}\nModel: ${requirements.model}\n\nPlease create a complete TypeScript agent template file in the ${AGENT_TEMPLATES_DIR} directory with proper types and a comprehensive system prompt.`\n\n  try {\n    // Use the resetAgent helper to properly switch to agent-builder which automatically spawns the agent builder\n    const cliInstance = CLI.getInstance()\n    await cliInstance.resetAgent(\n      AgentTemplateTypes.agent_builder,\n      {\n        name: requirements.name,\n        purpose: requirements.purpose,\n        specialty: requirements.specialty,\n        model: requirements.model,\n      },\n      prompt,\n    )\n\n    console.log(\n      green(\n        `\\n Agent created! Check the ${AGENT_TEMPLATES_DIR} directory for your new agent.`,\n      ),\n    )\n    console.log(\n      gray(\n        'Continue adjusting your agent here, or type \"/agents\" to switch agents and test it out.',\n      ),\n    )\n\n    cliInstance.freshPrompt()\n  } catch (error) {\n    console.error(red('\\nError during agent creation:'))\n    console.error(\n      'Error message:',\n      error instanceof Error ? error.message : String(error),\n    )\n    throw error\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "npm-app/src/create-template-project.ts",
              "content": "import { execSync } from 'child_process'\nimport * as fs from 'fs'\nimport * as os from 'os'\nimport { join } from 'path'\n\nimport { green } from 'picocolors'\n\nimport { logger } from './utils/logger'\n\nexport async function createTemplateProject(\n  template: string,\n  projectDir: string,\n  projectName: string = template,\n) {\n  console.log(\n    `Creating project from ${template} template in ${projectDir}/${projectName}`,\n  )\n\n  // Validate template name contains only alphanumeric chars, dash and underscore\n  if (!/^[a-zA-Z0-9-_]+$/.test(template)) {\n    console.error(\n      'Template name can only contain letters, numbers, dash and underscore',\n    )\n    logger.error(\n      {\n        errorMessage:\n          'Template name can only contain letters, numbers, dash and underscore',\n        template,\n      },\n      'Invalid template name',\n    )\n    process.exit(1)\n  }\n\n  // Validate project name\n  if (!/^[a-zA-Z0-9-_]+$/.test(projectName)) {\n    console.error(\n      'Project name can only contain letters, numbers, dash and underscore',\n    )\n    logger.error(\n      {\n        errorMessage:\n          'Project name can only contain letters, numbers, dash and underscore',\n        projectName,\n      },\n      'Invalid project name',\n    )\n    process.exit(1)\n  }\n\n  const projectPath = join(projectDir, projectName)\n\n  // Check if directory already exists\n  if (fs.existsSync(projectPath)) {\n    console.error(`Directory ${projectPath} already exists`)\n    logger.error(\n      {\n        errorMessage: `Directory ${projectPath} already exists`,\n        projectPath,\n      },\n      'Directory already exists',\n    )\n    process.exit(1)\n  }\n\n  try {\n    console.log('\\nDownloading template...')\n    // Clone the community repo to a temp directory\n    const tempDir = fs.mkdtempSync(join(os.tmpdir(), 'levelcode-starter-'))\n    execSync(\n      'git clone --depth 1 https://github.com/LevelCodeAI/levelcode-community.git .',\n      {\n        cwd: tempDir,\n        stdio: 'pipe',\n      },\n    )\n\n    // Check if template exists in starter-templates or showcase directory\n    const starterTemplateDir = join(tempDir, 'starter-templates', template)\n    const showcaseDir = join(tempDir, 'showcase', template)\n    let templateDir: string\n\n    if (fs.existsSync(starterTemplateDir)) {\n      templateDir = starterTemplateDir\n    } else if (fs.existsSync(showcaseDir)) {\n      templateDir = showcaseDir\n    } else {\n      console.error(\n        `Template ${template} not found in starter-templates/ or showcase/`,\n      )\n      logger.error(\n        {\n          errorMessage: `Template ${template} not found in starter-templates/ or showcase/`,\n          template,\n        },\n        'Template not found',\n      )\n      fs.rmSync(tempDir, { recursive: true, force: true })\n      process.exit(1)\n    }\n\n    // Create parent directory if it doesn't exist\n    if (projectDir) {\n      fs.mkdirSync(projectDir, { recursive: true })\n    }\n\n    // Copy template to new directory\n    fs.mkdirSync(projectPath)\n    fs.cpSync(templateDir, projectPath, { recursive: true })\n\n    // Remove .git directory if it exists\n    const gitDir = join(projectPath, '.git')\n    if (fs.existsSync(gitDir)) {\n      fs.rmSync(gitDir, { recursive: true, force: true })\n    }\n\n    // Initialize new git repo\n    console.log('\\nInitializing git repo...')\n    execSync('git init', { cwd: projectPath, stdio: 'pipe' })\n\n    // Clean up temp directory\n    fs.rmSync(tempDir, { recursive: true, force: true })\n\n    // Install dependencies\n    if (fs.existsSync(join(projectPath, 'package-lock.json'))) {\n      console.log('\\nInstalling dependencies...')\n      execSync('npm install', { cwd: projectPath, stdio: 'inherit' })\n    }\n\n    console.log(green(`\\nSuccessfully created new project in ${projectPath}\\n`))\n\n    // Change into the new project directory and run levelcode\n    process.chdir(projectPath)\n    console.log('Starting LevelCode in the new project...\\n')\n    console.log('--------------------------------\\n')\n    execSync('levelcode', { stdio: 'inherit' })\n  } catch (error) {\n    logger.error(\n      {\n        errorMessage: error instanceof Error ? error.message : String(error),\n        errorStack: error instanceof Error ? error.stack : undefined,\n        template,\n        projectDir,\n        projectName,\n      },\n      'Failed to initialize project',\n    )\n    console.error('Failed to initialize project:', error)\n    process.exit(1)\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "web/src/content/agents/creating-new-agents.mdx",
              "content": "---\ntitle: 'Creating New Agents'\nsection: 'advanced'\ntags: ['customization', 'agent templates', 'agents']\norder: 2\n---\n\n# Creating New Agents\n\nCreate specialized agents from scratch using JSON templates.\n\n**Types:**\n\n- **LLM-based** - Use prompts and language models\n- **Programmatic** (coming soon) - Use JavaScript/TypeScript code\n\n## Basic Structure\n\nNew agents need `\"override\": false` and these required fields:\n\n```json\n{\n  \"id\": \"my-custom-agent\",\n  \"version\": \"1.0.0\",\n  \"override\": false,\n\n  \"displayName\": \"My Custom Agent\",\n  \"purpose\": \"A specialized agent for my workflow\",\n  \"model\": \"anthropic/claude-4-sonnet-20250522\",\n  \"outputMode\": \"last_message\",\n  \"includeMessageHistory\": true,\n  \"toolNames\": [\"read_files\", \"write_file\", \"end_turn\"],\n  \"spawnableAgents\": [\"researcher\"],\n\n  \"inputSchema\": {\n    \"prompt\": {\n      \"type\": \"string\",\n      \"description\": \"What documentation to create or update\"\n    }\n  },\n\n  \"parentInstructions\": {\n    \"researcher\": \"When you need to understand API patterns or find code examples for documentation, spawn my-custom-agent to gather information about our repository's best practices.\"\n  },\n\n  \"systemPrompt\": {\n    \"path\": \"./system.md\"\n  },\n  \"instructionsPrompt\": \"Create comprehensive documentation based on the user's request. Research existing code and patterns first.\"\n  \"stepPrompt\": \"Continue working on the documentation. Use end_turn when complete.\"\n}\n```\n\n**.agents/templates/doc-writer-system.md**\n\n```markdown\n# Documentation Writer\n\nCreate clear, comprehensive documentation for codebases.\n\n## Guidelines\n\n- Research codebase first\n- Use clear, concise language\n- Include practical examples\n- Test examples for accuracy\n```\n\n## More Domain-Specific Examples\n\n### API Documentation Agent\n\nSpecialized for documenting REST APIs and GraphQL schemas:\n\n**.agents/templates/api-documenter.json**\n\n```json\n{\n  \"id\": \"api-documenter\",\n  \"version\": \"1.0.0\",\n  \"override\": false,\n\n  \"displayName\": \"API Documentation Specialist\"\n  \"purpose\": \"Creates comprehensive API documentation with examples and schemas\",\n  \"model\": \"anthropic/claude-4-sonnet-20250522\",\n  \"outputMode\": \"last_message\",\n  \"includeMessageHistory\": true,\n\n  \"toolNames\": [\"read_files\", \"code_search\", \"write_file\", \"spawn_agents\", \"end_turn\"],\n  \"spawnableAgents\": [\"researcher\"],\n\n  \"inputSchema\": {\n    \"prompt\": {\n      \"type\": \"string\",\n      \"description\": \"What API endpoints or schemas to document\"\n    }\n  },\n\n  \"systemPrompt\": \"You are an API documentation specialist. Create clear, comprehensive documentation for REST APIs and GraphQL schemas with examples, request/response formats, and error codes.\",\n  \"instructionsPrompt\": \"Analyze the specified API endpoints and create detailed documentation including examples, parameters, and response schemas.\"\n  \"stepPrompt\": \"Continue documenting the API. Include practical examples and edge cases. Use end_turn when complete.\"\n}\n```\n\n### Database Migration Agent\n\nSpecialized for creating and reviewing database migrations:\n\n**.agents/templates/migration-specialist.json**\n\n```json\n{\n  \"id\": \"migration-specialist\",\n  \"version\": \"1.0.0\",\n  \"override\": false,\n\n  \"displayName\": \"Database Migration Specialist\"\n  \"purpose\": \"Creates safe, reversible database migrations with proper indexing\",\n  \"model\": \"anthropic/claude-4-sonnet-20250522\",\n  \"outputMode\": \"last_message\",\n  \"includeMessageHistory\": true,\n\n  \"toolNames\": [\"read_files\", \"write_file\", \"code_search\", \"run_terminal_command\", \"end_turn\"],\n  \"spawnableAgents\": [\"reviewer\"],\n\n  \"parentInstructions\": {\n    \"reviewer\": \"When database migrations are created or modified, spawn migration-specialist to review for data loss risks, locking issues, rollback procedures, and performance impact.\"\n  },\n\n  \"systemPrompt\": {\n    \"path\": \"./migration-guidelines.md\"\n  },\n  \"instructionsPrompt\": \"Create a database migration for the requested schema changes. Ensure it's reversible and includes proper indexing.\"\n  \"stepPrompt\": \"Continue working on the migration. Test it if possible and spawn a reviewer to check for issues.\"\n}\n```\n\n**.agents/templates/migration-guidelines.md**\n\n```markdown\n# Database Migration Guidelines\n\n## Safety First\n\n- Always create reversible migrations (up and down)\n- Test migrations on a copy of production data\n- Add indexes for new foreign keys\n- Use transactions where supported\n\n## Performance Considerations\n\n- Avoid locking tables during peak hours\n- Use `ADD COLUMN` with defaults carefully\n- Consider batching large data changes\n- Monitor migration execution time\n\n## Best Practices\n\n- Include descriptive migration names\n- Add comments explaining complex changes\n- Validate data integrity after migration\n- Keep migrations atomic and focused\n```\n\n## Parent Instructions\n\nParent instructions allow your agent to provide specific guidance to other agents when spawning them. This creates a hierarchical coordination system without requiring full agent overrides.\n\n### When to Use Parent Instructions\n\n- **Workflow Coordination**: Ensure spawned agents follow specific patterns\n- **Domain Expertise**: Share specialized knowledge with sub-agents\n- **Context Preservation**: Pass important context from parent to child agents\n- **Quality Control**: Add specific validation requirements\n\n### Real-World Examples\n\n#### Frontend Development Coordinator\n\n```json\n{\n  \"id\": \"frontend-coordinator\",\n  \"version\": \"1.0.0\",\n  \"override\": false,\n  \"displayName\": \"Frontend Development Coordinator\"\n  \"purpose\": \"Coordinates frontend development with React best practices\",\n  \"model\": \"anthropic/claude-4-sonnet-20250522\",\n  \"outputMode\": \"last_message\",\n  \"includeMessageHistory\": true,\n  \"toolNames\": [\"read_files\", \"write_file\", \"code_search\", \"spawn_agents\", \"end_turn\"],\n  \"spawnableAgents\": [\"reviewer\", \"researcher\", \"file_picker\"],\n  \"inputSchema\": {\n    \"prompt\": {\n      \"type\": \"string\",\n      \"description\": \"Frontend development task to coordinate\"\n    }\n  },\n  \"parentInstructions\": {\n    \"reviewer\": \"Spawn frontend-coordinator when you are looking at changes to React components or hooks to ensure proper hook usage, component composition, accessibility, and performance.\",\n    \"researcher\": \"Need React patterns or component library info? Spawn frontend-coordinator to research official React docs and modern frontend practices.\",\n    \"file_picker\": \"To understand the React codebase structure, spawn frontend-coordinator to find components, hooks, styles, and configuration files.\"\n  },\n  \"systemPrompt\": \"You are a frontend development coordinator specializing in React best practices. Guide development workflows and ensure code quality.\",\n  \"instructionsPrompt\": \"Coordinate the frontend development task, spawning appropriate agents as needed.\"\n  \"stepPrompt\": \"Continue coordinating the frontend development workflow. Use end_turn when complete.\"\n}\n```\n\n#### API Development Specialist\n\n```json\n{\n  \"id\": \"api-specialist\",\n  \"version\": \"1.0.0\",\n  \"override\": false,\n  \"displayName\": \"API Development Specialist\"\n  \"purpose\": \"Specialized for REST API development and documentation\",\n  \"model\": \"anthropic/claude-4-sonnet-20250522\",\n  \"outputMode\": \"last_message\",\n  \"includeMessageHistory\": true,\n  \"toolNames\": [\"read_files\", \"write_file\", \"code_search\", \"spawn_agents\", \"run_terminal_command\", \"end_turn\"],\n  \"spawnableAgents\": [\"reviewer\", \"researcher\", \"file_picker\"],\n  \"inputSchema\": {\n    \"prompt\": {\n      \"type\": \"string\",\n      \"description\": \"API development or documentation task\"\n    }\n  },\n  \"parentInstructions\": {\n    \"reviewer\": \"When API endpoints are created or modified, spawn api-specialist to review HTTP methods, status codes, error handling, and OpenAPI compliance.\",\n    \"researcher\": \"For API design patterns or authentication strategies, spawn api-specialist to research industry standards and best practices.\",\n    \"file_picker\": \"Understanding API structure requires spawning api-specialist to locate route definitions, middleware, controllers, and schema files.\"\n  },\n  \"systemPrompt\": \"You are an API development specialist focused on creating robust, well-documented REST APIs following industry standards.\",\n  \"instructionsPrompt\": \"Handle the API development task, ensuring proper design patterns and documentation.\"\n  \"stepPrompt\": \"Continue working on the API development task. Use end_turn when complete.\"\n}\n```\n\n#### DevOps Automation Agent\n\n```json\n{\n  \"id\": \"devops-automator\",\n  \"version\": \"1.0.0\",\n  \"override\": false,\n  \"displayName\": \"DevOps Automation Specialist\"\n  \"purpose\": \"Handles infrastructure and deployment automation\",\n  \"model\": \"anthropic/claude-4-sonnet-20250522\",\n  \"outputMode\": \"last_message\",\n  \"includeMessageHistory\": true,\n  \"toolNames\": [\"read_files\", \"write_file\", \"code_search\", \"spawn_agents\", \"run_terminal_command\", \"end_turn\"],\n  \"spawnableAgents\": [\"reviewer\", \"researcher\", \"file_picker\"],\n  \"inputSchema\": {\n    \"prompt\": {\n      \"type\": \"string\",\n      \"description\": \"Infrastructure or deployment automation task\"\n    }\n  },\n  \"parentInstructions\": {\n    \"reviewer\": \"Infrastructure code changes should be sent to devops-automator for review, security, resource optimization, deployment safety, and secrets management.\",\n    \"researcher\": \"Cloud best practices or CI/CD patterns needed? Spawn devops-automator to apply container orchestration and disaster recovery best practices.\",\n    \"file_picker\": \"Spawn devops-automator when infrastructure setup understanding is needed - it excels at finding Docker files, CI/CD configs, and deployment scripts.\"\n  },\n  \"systemPrompt\": \"You are a DevOps automation specialist focused on secure, scalable infrastructure and deployment pipelines.\",\n  \"instructionsPrompt\": \"Handle the infrastructure or deployment automation task with security and reliability in mind.\"\n  \"stepPrompt\": \"Continue working on the DevOps automation task. Use end_turn when complete.\"\n}\n```\n\n### Best Practices for Parent Instructions\n\n1. **Stay Focused**: Each instruction should relate to the target agent's core purpose.\n2. **Avoid Conflicts**: Consider how multiple parent instructions might interact. Each instruction across all your agents are added to the parent agent.\n3. **Test Thoroughly**: Verify instructions work across different scenarios. Start LevelCode with the option `--agent <agent-id>` to talk with a specific agent to debug.\n\n## Programmatic Agents\n\n**Coming Soon** - Use JavaScript/TypeScript for complex orchestration logic.\n\n## Best Practices\n\n1. **Start small** - Begin with simple agents before complex ones\n2. **Experiment** - Try different tool/prompt combinations\n3. **Share** - Version control your `.agents/` directory\n4. **Iterate** - Improve based on usage\n5. **Leverage `parentInstructions`** - Coordinate agent behavior effectively\n",
              "referencedBy": {}
            }
          ]
        }
      ],
      "parentAgentId": "D-OfY8_NY2s"
    },
    {
      "type": "text",
      "agentId": "D-OfaV526OE",
      "text": "Here's a concise report of the locations in the codebase that define agent personalities or types:\n\n*   `.agents/brainstormer.ts`, `.agents/planner.ts`, `.agents/researcher.ts`, `.agents/reviewer.ts`, `.agents/thinker.ts`, `.agents/superagent.ts`: These files define the persona, instructions, and capabilities of different agent types. They are useful as a central location for understanding specific agent behaviors.\n*   `common/src/constants/agents.ts`: This file contains the `AGENT_PERSONAS` constant, which provides display names and purposes for different base and specialized agents. It's helpful for understanding the high-level categorization and naming of agents.\n*   `common/src/types/agent-template.ts`: This file defines the `AgentTemplate` type, which outlines the structure of agent definitions, including fields like `displayName`, `systemPrompt`, `inputSchema`, and `toolNames`.\n*   `npm-app/src/agents/load-agents.ts`: This file is responsible for loading local agent definitions, and could be useful for understanding how agents are managed.\n*   `web/src/content/agents/overview.mdx`: Documentation summarizing agent design and purpose.\n"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-OfaV526OE",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "prompt": "agent personas, list of agent personalities or types"
      }
    },
    {
      "type": "text",
      "agentId": "D-OfY_tExks",
      "text": ".agents/examples/diff-reviewer-1.ts\n.agents/examples/diff-reviewer-2.ts\n.agents/examples/diff-reviewer-3.ts\ncommon/src/util/examples/diff-reviewer-1.ts\ncommon/src/util/examples/diff-reviewer-2.ts\ncommon/src/util/examples/diff-reviewer-3.ts\nbackend/src/templates/agents/reviewer.ts\nbackend/src/templates/agents/thinker.ts\nbackend/src/templates/agents/planner.ts\nbackend/src/system-prompt/agent-instructions.md\nbackend/src/templates/prompts.ts\ncommon/src/constants/agents.ts"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-OgbZG1Kis",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-OfY_tExks",
      "prompt": "",
      "params": {
        "prompt": "diff-reviewer agent examples and configurations"
      }
    },
    {
      "type": "tool_result",
      "toolCallId": "d5d9bf34-0e52-49e8-97f8-330da68aa9a2",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Liszt the File Lister",
              "agentType": "file-lister",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": ".agents/examples/diff-reviewer-1.ts\n.agents/examples/diff-reviewer-2.ts\n.agents/examples/diff-reviewer-3.ts\ncommon/src/util/examples/diff-reviewer-1.ts\ncommon/src/util/examples/diff-reviewer-2.ts\ncommon/src/util/examples/diff-reviewer-3.ts\nbackend/src/templates/agents/reviewer.ts\nbackend/src/templates/agents/thinker.ts\nbackend/src/templates/agents/planner.ts\nbackend/src/system-prompt/agent-instructions.md\nbackend/src/templates/prompts.ts\ncommon/src/constants/agents.ts"
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ],
      "parentAgentId": "D-OfY_tExks"
    },
    {
      "type": "tool_call",
      "toolCallId": "3a890855-cfa7-43ef-97f7-d6ee3b29cb7e",
      "toolName": "read_files",
      "input": {
        "paths": [
          ".agents/examples/diff-reviewer-1.ts",
          ".agents/examples/diff-reviewer-2.ts",
          ".agents/examples/diff-reviewer-3.ts",
          "common/src/util/examples/diff-reviewer-1.ts",
          "common/src/util/examples/diff-reviewer-2.ts",
          "common/src/util/examples/diff-reviewer-3.ts",
          "backend/src/templates/agents/reviewer.ts",
          "backend/src/templates/agents/thinker.ts",
          "backend/src/templates/agents/planner.ts",
          "backend/src/system-prompt/agent-instructions.md",
          "backend/src/templates/prompts.ts",
          "common/src/constants/agents.ts"
        ]
      },
      "agentId": "D-OfY_tExks",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "3a890855-cfa7-43ef-97f7-d6ee3b29cb7e",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": ".agents/examples/diff-reviewer-1.ts",
              "content": "import type { AgentDefinition } from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-1',\n\n  displayName: 'Diff Reviewer (Level 1)',\n  model: 'openai/gpt-5',\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements`,\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": ".agents/examples/diff-reviewer-2.ts",
              "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-2',\n  displayName: 'Diff Reviewer (Level 2)',\n  model: 'openai/gpt-5',\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n    // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 2: Let AI run the rest of the steps!\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": ".agents/examples/diff-reviewer-3.ts",
              "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-3',\n\n  displayName: 'Diff Reviewer (Level 3)',\n  model: 'openai/gpt-5',\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  outputMode: 'last_message',\n\n  toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\n  spawnableAgents: ['james/file-explorer@0.1.3'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Review the changes and suggest improvements.\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n    // Step 1: Get list of changed files from git diff --name-only\n    const { toolResult: gitDiffFilesResult } = yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff --name-only',\n      },\n    }\n\n    // Then, extract file paths from the result\n    const changedFiles = (gitDiffFilesResult || '')\n      .split('\\n')\n      .map((line) => line.trim())\n      .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\n\n    // Step 2: Read the files\n    if (changedFiles.length > 0) {\n      yield {\n        toolName: 'read_files',\n        args: {\n          paths: changedFiles,\n        },\n      }\n    }\n\n    // Step 3: Run full git diff to see the actual changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 4: Put words in the AI's mouth to get it to spawn the file explorer.\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          'Now I will spawn a file explorer to find any missing codebase context.',\n      },\n    }\n\n    yield 'STEP'\n\n    // Step 5: Put words in the AI's mouth to review the changes.\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content: 'Here is my comprehensive review of the changes.',\n      },\n    }\n\n    // Step 6: Let AI review the changes in a final step. (The last message is also the agent's output.)\n    yield 'STEP'\n  },\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/examples/diff-reviewer-1.ts",
              "content": "import type { AgentDefinition } from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-1',\n\n  displayName: 'Diff Reviewer (Level 1)',\n  model: 'openai/gpt-5',\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements`,\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/examples/diff-reviewer-2.ts",
              "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-2',\n  displayName: 'Diff Reviewer (Level 2)',\n  model: 'openai/gpt-5',\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n    // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 2: Let AI run the rest of the steps!\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/examples/diff-reviewer-3.ts",
              "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-3',\n\n  displayName: 'Diff Reviewer (Level 3)',\n  model: 'openai/gpt-5',\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  outputMode: 'last_message',\n\n  toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\n  spawnableAgents: ['james/file-explorer@0.1.3'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Review the changes and suggest improvements.\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n    // Step 1: Get list of changed files from git diff --name-only\n    const { toolResult: gitDiffFilesResult } = yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff --name-only',\n      },\n    }\n\n    // Then, extract file paths from the result\n    const changedFiles = (gitDiffFilesResult || '')\n      .split('\\n')\n      .map((line) => line.trim())\n      .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\n\n    // Step 2: Read the files\n    if (changedFiles.length > 0) {\n      yield {\n        toolName: 'read_files',\n        args: {\n          paths: changedFiles,\n        },\n      }\n    }\n\n    // Step 3: Run full git diff to see the actual changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 4: Put words in the AI's mouth to get it to spawn the file explorer.\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          'Now I will spawn a file explorer to find any missing codebase context.',\n      },\n    }\n\n    yield 'STEP'\n\n    // Step 5: Put words in the AI's mouth to review the changes.\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content: 'Here is my comprehensive review of the changes.',\n      },\n    }\n\n    // Step 6: Let AI review the changes in a final step. (The last message is also the agent's output.)\n    yield 'STEP'\n  },\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agents/reviewer.ts",
              "content": "import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\nimport { closeXml } from '@levelcode/common/util/xml'\nimport z from 'zod/v4'\n\nimport { PLACEHOLDER } from '../types'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\n\nexport const reviewer = (model: Model): Omit<AgentTemplate, 'id'> => ({\n  model,\n  displayName: AGENT_PERSONAS.reviewer.displayName,\n  spawnPurposePrompt: AGENT_PERSONAS.reviewer.purpose,\n  inputSchema: {\n    prompt: z.string().describe('What should be reviewed. Be brief.'),\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: true,\n  toolNames: ['end_turn', 'run_file_change_hooks'],\n  spawnableAgents: [],\n\n  systemPrompt: `# Persona: ${PLACEHOLDER.AGENT_NAME}\n\nYou are an expert programmer who can articulate very clear feedback on code changes.\n\n${PLACEHOLDER.TOOLS_PROMPT}\n\n${PLACEHOLDER.AGENTS_PROMPT}`,\n\n  instructionsPrompt: `Your task is to provide helpful feedback on the last file changes made by the assistant. You should critique the code changes made recently in the above conversation.\n\nIMPORTANT: After analyzing the file changes, you should:\n1. Run file change hooks to validate the changes using the run_file_change_hooks tool\n2. Include the hook results in your feedback - if any hooks fail, mention the specific failures and suggest how to fix them\n3. If hooks pass and no issues are found, mention that validation was successful\n4. Always run hooks for TypeScript/JavaScript changes, test file changes, or when the changes could affect compilation/tests\n\nNOTE: You cannot make any changes directly! You can only suggest changes.\n\nProvide specific feedback on the file changes made by the assistant, file-by-file.\n\n- Focus on getting to a complete and correct solution as the top priority.\n- Try to keep any changes to the codebase as minimal as possible.\n- Simplify any logic that can be simplified.\n- Where a function can be reused, reuse it and do not create a new one.\n- Make sure that no new dead code is introduced.\n- Make sure there are no missing imports.\n- Make sure no sections were deleted that weren't supposed to be deleted.\n- Make sure the new code matches the style of the existing code.\n\nBe concise and to the point. After providing all your feedback, use the end_turn tool to end your response.`,\n\n  stepPrompt: `IMPORTANT: Don't forget to end your response with the end_turn tool: <end_turn>${closeXml('end_turn')}`,\n})\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agents/thinker.ts",
              "content": "import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\nimport { closeXml } from '@levelcode/common/util/xml'\nimport z from 'zod/v4'\n\nimport { PLACEHOLDER } from '../types'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\n\nexport const thinker = (model: Model): Omit<AgentTemplate, 'id'> => ({\n  model,\n  displayName: AGENT_PERSONAS.thinker.displayName,\n  spawnPurposePrompt: AGENT_PERSONAS.thinker.purpose,\n  inputSchema: {\n    prompt: z.string().describe('The problem you are trying to solve'),\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: true,\n  toolNames: ['end_turn'],\n  spawnableAgents: [],\n\n  systemPrompt: `# Persona: ${PLACEHOLDER.AGENT_NAME}\n\nYou are an expert programmer.\n\n${PLACEHOLDER.TOOLS_PROMPT}\n\n${PLACEHOLDER.AGENTS_PROMPT}`,\n\n  instructionsPrompt: `\nThink deeply, step by step, about the user request and how best to approach it.\n\nConsider edge cases, potential issues, and alternative approaches.\n\nCome up with a list of insights that would help someone arrive at the best solution.\n\nTry not to be too prescriptive or confident in one solution. Instead, give clear arguments and reasoning.\n\nYou must be extremely concise and to the point.\n`.trim(),\n\n  stepPrompt: `Don't forget to end your response with the end_turn tool: <end_turn>${closeXml('end_turn')}`,\n})\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agents/planner.ts",
              "content": "import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\nimport { closeXml } from '@levelcode/common/util/xml'\nimport z from 'zod/v4'\n\nimport { PLACEHOLDER } from '../types'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\n\nexport const planner = (model: Model): Omit<AgentTemplate, 'id'> => ({\n  model,\n  displayName: AGENT_PERSONAS.planner.displayName,\n  spawnPurposePrompt: AGENT_PERSONAS.planner.purpose,\n  inputSchema: {\n    prompt: z\n      .string()\n      .describe(\n        'What problem you to solve and a few ideas and suggestions for the plan',\n      ),\n  },\n  outputMode: 'last_message',\n  includeMessageHistory: true,\n  toolNames: ['think_deeply', 'spawn_agents', 'end_turn'],\n  spawnableAgents: [], // ARCHIVED: [AgentTemplateTypes.dry_run],\n\n  systemPrompt: `# Persona: ${PLACEHOLDER.AGENT_NAME}\n\nYou are an expert software architect. You are good at creating comprehensive plans to tackle the user request.\n\n${PLACEHOLDER.TOOLS_PROMPT}\n\n${PLACEHOLDER.AGENTS_PROMPT}`,\n\n  instructionsPrompt: `Steps for your response:\n1. Use the <think_deeply> tool to think through cruxes for the plan, and tricky cases. Consider alternative approaches. Be sure to close the tool call with ${closeXml('think_deeply')}.\n2. Write out your plan in a concise way.\n3. Spawn 1-5 dry run agents to sketch portions of the implementation of the plan. (Important: do not forget to close the tool call with \"${closeXml('spawn_agents')}\"!)\n4. Synthesize all the information and rewrite the full plan to be the best it can be. Use the end_turn tool.`,\n\n  stepPrompt:\n    'Do not forget to use the end_turn tool to end your response. Make sure the final plan is the best it can be.',\n})\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/system-prompt/agent-instructions.md",
              "content": "# Persona: Buffy - The Enthusiastic Coding Assistant\n\n**Your core identity is Buffy.** Buffy is an expert coding assistant who is enthusiastic, proactive, and helpful.\n\n- **Tone:** Maintain a positive, friendly, and helpful tone. Use clear and encouraging language.\n- **Clarity & Conciseness:** Explain your steps clearly but concisely. Say the least you can to get your point across. If you can, answer in one sentence only. Do not summarize changes. End turn early.\n\nYou are working on a project over multiple \"iterations,\" reminiscent of the movie \"Memento,\" aiming to accomplish the user's request.\n\n# Files\n\nThe <read_file> tool result shows files you have previously read from <read_files> tool calls.\n\nIf you write to a file, or if the user modifies a file, new copies of a file will be included in <read_file> tool results.\n\nThus, multiple copies of the same file may be included over the course of a conversation. Each represents a distinct version in chronological order.\n\nImportant:\n\n- Pay particular attention to the last copy of a file as that one is current!\n- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n\n# Subgoals\n\nFirst, create and edit subgoals if none exist and pursue the most appropriate one. This one of the few ways you can \"take notes\" in the Memento-esque environment. This is important, as you may forget what happened later! Use the <add_subgoal> and <update_subgoal> tools for this.\n\nThe following is a mock example of the subgoal schema:\n<subgoal>\n<id>1</id>\n<objective>Fix the tests</objective>\n<status>COMPLETE</status>\n<plan>Run them, find the error, fix it</plan>\n<log>Ran the tests and traced the error to component foo.</log>\n<log>Modified the foo component to fix the error</log>\n</subgoal>\n\nNotes:\n\n- Try to phrase the subgoal objective first in terms of observable behavior rather than how to implement it, if possible. The subgoal is what you are solving, not how you are solving it.\n\n# System Messages\n\nMessages from the system are surrounded by <system></system> or <system_instructions></system_instructions> XML tags. These are NOT messages from the user.\n\n# How to Respond\n\n- **Respond as Buffy:** Maintain the helpful and upbeat persona defined above throughout your entire response, but also be as conscise as possible.\n- **DO NOT Narrate Parameter Choices:** While commentary about your actions is required (Rule #2), **DO NOT** explain _why_ you chose specific parameter values for a tool (e.g., don't say \"I am using the path 'src/...' because...\"). Just provide the tool call after your action commentary.\n- **CRITICAL TOOL FORMATTING:**\n  - **NO MARKDOWN:** Tool calls **MUST NOT** be wrapped in markdown code blocks (like \\`\\`\\`). Output the raw XML tags directly. **This is non-negotiable.**\n  - **MANDATORY EMPTY LINES:** Tool calls **MUST** be surrounded by a _single empty line_ both before the opening tag (e.g., `<tool_name>`) and after the closing tag (e.g., `</tool_name>`). See the example below. **Failure to include these empty lines will break the process.**\n  - **NESTED ELEMENTS ONLY:** Tool parameters **MUST** be specified using _only_ nested XML elements, like `<parameter_name>value</parameter_name>`. You **MUST NOT** use XML attributes within the tool call tags (e.g., writing `<tool_name attribute=\"value\">`). Stick strictly to the nested element format shown in the example response below. This is absolutely critical for the parser.\n- **User Questions:** If the user is asking for help with ideas or brainstorming, or asking a question, then you should directly answer the user's question, but do not make any changes to the codebase. Do not call modification tools like `write_file`.\n- **Handling Requests:**\n  - For complex requests, create a subgoal using <add_subgoal> to track objectives from the user request. Use <update_subgoal> to record progress. Put summaries of actions taken into the subgoal's <log>.\n  - For straightforward requests, proceed directly without adding subgoals.\n- **Reading Files:** Try to read as many files as could possibly be relevant in your first 1 or 2 read_files tool calls. List multiple file paths in one tool call, as many as you can. You must read more files whenever it would improve your response.\n- **Minimal Changes:** You should make as few changes as possible to the codebase to address the user's request. Only do what the user has asked for and no more. When modifying existing code, assume every line of code has a purpose and is there for a reason. Do not change the behavior of code except in the most minimal way to accomplish the user's request.\n- **DO NOT run scripts, make git commits or push to remote repositories without permission from the user.** It's extremely important not to run scripts that could have major effects. Similarly, a wrong git push could break production. For these actions, always ask permission first and wait for user confirmation.\n- **Code Hygiene:** Make sure to leave things in a good state:\n\n  - Don't forget to add any imports that might be needed\n  - Remove unused variables, functions, and files as a result of your changes.\n  - If you added files or functions meant to replace existing code, then you should also remove the previous code.\n\n- **Read Before Writing:** If you are about to edit a file, make sure it is one that you have already read, i.e. is included in your context -- otherwise, use the read_file tool to read it first!\n- **Check for Existing Changes:** If the user is requesting a change that you think has already been made based on the current version of files, simply tell the user that \"It looks like that change has already been made!\". It is common that a file you intend to update already has the changes you want.\n- **Think about your next action:** After receiving tool results, carefully reflect on their quality and determine optimal next steps before proceeding. Use your thinking to plan and iterate based on this new information, and then take the best next action.\n- **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don't run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n- **Refactoring Awareness:** Whenever you modify an exported token like a function or class or variable, you should use the code_search tool to find all references to it before it was renamed (or had its type/parameters changed) and update the references appropriately.\n- **Testing:** If you create a unit test, you should run it using `run_terminal_command` to see if it passes, and fix it if it doesn't.\n- **Front end development** We want to make the UI look as good as possible. Don't hold back. Give it your all.\n\n  - Include as many relevant features and interactions as possible\n  - Add thoughtful details like hover states, transitions, and micro-interactions\n  - Apply design principles: hierarchy, contrast, balance, and movement\n  - Create an impressive demonstration showcasing web development capabilities\n\n- **Don't summarize your changes** Omit summaries as much as possible. Be extremely concise when explaining the changes you made. There's no need to write a long explanation of what you did. Keep it to 1-2 two sentences max.\n- **Ending Your Response:** Your aim should be to completely fulfill the user's request before using ending your response. DO NOT END TURN IF YOU ARE STILL WORKING ON THE USER'S REQUEST. If the user's request requires multiple steps, please complete ALL the steps before stopping, even if you have done a lot of work so far.\n- **FINALLY, YOU MUST USE THE END TURN TOOL** When you have fully answered the user _or_ you are explicitly waiting for the user's next typed input, always conclude the message with a standalone `<end_turn></end_turn>` tool call (surrounded by its required blank lines). This should be at the end of your message, e.g.:\n  <example>\n  User: Hi\n  Assisistant: Hello, what can I do for you today?\\n\\n<end_turn></end_turn>\n  </example>\n\n## Verifying Your Changes at the End of Your Response\n\n### User has a `levelcode.json`\n\nIf the user has a `levelcode.json` with the appropriate `fileChangeHooks`, there is no need to run any commands.\n\nIf the `fileChangeHooks` are not configured, inform the user about the `fileChangeHooks` parameter.\n\n### User has no `levelcode.json`\n\nIf this is the case, inform the user know about the `/init` command (within LevelCode, not a terminal command).\n\nCheck the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using '&&' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n\n## Example Response (Simplified - Demonstrating Rules)\n\nUser: Please console.log the props in the component Foo\n\nAssistant: Certainly! I can add that console log for you. Let's start by reading the file:\n\n<read_files>\n<paths>src/components/foo.tsx</paths>\n</read_files>\n\nNow, I'll add the console.log at the beginning of the Foo component:\n\n<write_file>\n<path>src/components/foo.tsx</path>\n<content>\n// ... existing code ...\nfunction Foo(props: {\nbar: string\n}) {\nconsole.log(\"Foo props:\", props);\n// ... rest of the function ...\n}\n// ... existing code ...\n</content>\n</write_file>\n\nLet me check my changes\n\n<run_terminal_command>\n<command>npm run typecheck</command>\n</run_terminal_command>\n\nI see that my changes went through correctly. What would you like to do next?\n\n<end_turn></end_turn>\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/prompts.ts",
              "content": "import { schemaToJsonStr } from '@levelcode/common/util/zod-schema'\nimport type { AgentTemplate } from '@levelcode/common/types/agent-template'\nimport type { AgentTemplateType } from '@levelcode/common/types/session-state'\nimport { getAgentTemplate } from './agent-registry'\n\nexport async function buildSpawnableAgentsDescription(\n  spawnableAgents: AgentTemplateType[],\n  agentTemplates: Record<string, AgentTemplate>,\n): Promise<string> {\n  if (spawnableAgents.length === 0) {\n    return ''\n  }\n\n  const subAgentTypesAndTemplates = await Promise.all(\n    spawnableAgents.map(async (agentType) => {\n      return [\n        agentType,\n        await getAgentTemplate(agentType, agentTemplates),\n      ] as const\n    }),\n  )\n\n  const agentsDescription = subAgentTypesAndTemplates\n    .map(([agentType, agentTemplate]) => {\n      if (!agentTemplate) {\n        // Fallback for unknown agents\n        return `- ${agentType}: Dynamic agent (description not available)\nprompt: {\"description\": \"A coding task to complete\", \"type\": \"string\"}\nparams: None`\n      }\n      const { inputSchema } = agentTemplate\n      if (!inputSchema) {\n        return `- ${agentType}: ${agentTemplate.spawnPurposePrompt}\nprompt: None\nparams: None`\n      }\n      const { prompt, params } = inputSchema\n      return `- ${agentType}: ${agentTemplate.spawnPurposePrompt}\nprompt: ${schemaToJsonStr(prompt)}\nparams: ${schemaToJsonStr(params)}`\n    })\n    .filter(Boolean)\n    .join('\\n\\n')\n\n  return `\\n\\n## Spawnable Agents\n\nUse the spawn_agents tool to spawn agents to help you complete the user request. Here are the available agents by their agent_type:\n\n${agentsDescription}`\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/constants/agents.ts",
              "content": "import type { AgentTemplateTypes } from '../types/session-state'\n\n// Define agent personas with their shared characteristics\nexport const AGENT_PERSONAS = {\n  // Base agents - all use Buffy persona\n  base: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  base_lite: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  base_max: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  base_experimental: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  claude4_gemini_thinking: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n\n  base_agent_builder: {\n    displayName: 'Buffy the Enthusiastic Agent Builder',\n    purpose:\n      'Enhanced base agent that can create custom agents and handle all coding tasks',\n  } as const,\n\n  superagent: {\n    displayName: 'Superagent',\n    purpose:\n      'Superagent that can spawn multiple code editing agents to complete a task.',\n  } as const,\n\n  // Ask mode\n  ask: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base ask-mode agent that orchestrates the full response.',\n  } as const,\n\n  // Specialized agents\n  thinker: {\n    displayName: 'Theo the Theorizer',\n    purpose:\n      'Does deep thinking given the current messages and a specific prompt to focus on. Use this to help you solve a specific problem.',\n  } as const,\n  file_explorer: {\n    displayName: 'Dora The File Explorer',\n    purpose: 'Expert at exploring a codebase and finding relevant files.',\n  } as const,\n  file_picker: {\n    displayName: 'Fletcher the File Fetcher',\n    purpose: 'Expert at finding relevant files in a codebase.',\n  } as const,\n  researcher: {\n    displayName: 'Reid Searcher the Researcher',\n    purpose: 'Expert at researching topics using web search and documentation.',\n  } as const,\n  planner: {\n    displayName: 'Peter Plan the Planner',\n    purpose: 'Agent that formulates a comprehensive plan to a prompt.',\n    hidden: true,\n  } as const,\n  dry_run: {\n    displayName: 'Sketch the Dry Runner',\n    purpose: 'Agent that takes a plan and try to implement it in a dry run.',\n    hidden: true,\n  } as const,\n  reviewer: {\n    displayName: 'Nit Pick Nick the Reviewer',\n    purpose:\n      'Reviews file changes and responds with critical feedback. Use this after making any significant change to the codebase.',\n  } as const,\n  agent_builder: {\n    displayName: 'Bob the Agent Builder',\n    purpose: 'Creates new agent templates for the levelcode mult-agent system',\n    hidden: false,\n  } as const,\n} as const satisfies Partial<\n  Record<\n    keyof typeof AgentTemplateTypes,\n    { displayName: string; purpose: string; hidden?: boolean }\n  >\n>\n\n// Agent IDs list from AGENT_PERSONAS keys\nexport const AGENT_IDS = Object.keys(\n  AGENT_PERSONAS,\n) as (keyof typeof AGENT_PERSONAS)[]\n\n// Agent ID prefix constant\nexport const AGENT_ID_PREFIX = 'LevelCodeAI/'\n\n// Agent names for client-side reference\nexport const AGENT_NAMES = Object.fromEntries(\n  Object.entries(AGENT_PERSONAS).map(([agentType, persona]) => [\n    agentType,\n    persona.displayName,\n  ]),\n) as Record<keyof typeof AGENT_PERSONAS, string>\n\nexport type AgentName =\n  (typeof AGENT_PERSONAS)[keyof typeof AGENT_PERSONAS]['displayName']\n\n// Get unique agent names for UI display\nexport const UNIQUE_AGENT_NAMES = Array.from(\n  new Set(\n    Object.values(AGENT_PERSONAS)\n      .filter((persona) => !('hidden' in persona) || !persona.hidden)\n      .map((persona) => persona.displayName),\n  ),\n)\n\n// Map from display name back to agent types (for parsing user input)\nexport const AGENT_NAME_TO_TYPES = Object.entries(AGENT_NAMES).reduce(\n  (acc, [type, name]) => {\n    if (!acc[name]) acc[name] = []\n    acc[name].push(type)\n    return acc\n  },\n  {} as Record<string, string[]>,\n)\n",
              "referencedBy": {}
            }
          ]
        }
      ],
      "parentAgentId": "D-OfY_tExks"
    },
    {
      "type": "text",
      "agentId": "D-OfaYSx8-Q",
      "text": "Okay, here's a concise report on the locations in the codebase that could be helpful for creating a custom agent from a starter template, or understanding the existing `git-committer` agent:\n\n*   `.agents/git-committer.ts`: This is the definition of the `git-committer` agent. It shows the structure of an agent definition, including its `id`, `inputSchema`, `systemPrompt`, `instructionsPrompt`, and `handleSteps`. Crucially it shows the tools and steps this agent uses.\n*   `backend/src/templates/agents/base.ts`: This file provides the base template for creating agents. It defines the core structure, including the input schema, output mode, and available tools.\n*   `backend/src/templates/agent-list.ts`: This file defines a list of available static agentTemplates providing a way to reference existing, simple (non-dynamic) agents.\n*   `common/src/types/agent-template.ts`: This file defines the `AgentTemplate` type, which is the structure that all agent definitions must adhere to. It specifies the required and optional properties of an agent.\n*   `npm-app/src/cli-handlers/agents.ts`: This file contains the logic for displaying and selecting agents within the CLI. You likely do not require this information.\n"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-OfaYSx8-Q",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "prompt": "your-custom-agent starter template or git-committer agent"
      }
    },
    {
      "type": "text",
      "agentId": "D-OfY8_NY2s",
      "text": "Here's a short report of the locations in the codebase that could be helpful, focusing on the most relevant files:\n\n*   **`backend/src/templates/agents/agent-builder.ts`**: This file contains the `agentBuilder` function, which is responsible for creating new agent templates. It reads agent template types, tool definitions, and example agent files, providing a good starting point for understanding the agent creation process.\n*   **`backend/src/templates/agent-registry.ts`**: This file manages the agent registry, fetching agents from the database and assembling local agent templates. It is useful for understanding how agents are stored and retrieved.\n*   **`npm-app/src/cli-handlers/agent-creation-chat.ts`**: This file contains the `startAgentCreationChat` function, which guides users through the agent creation process via a CLI chat interface. It showcases how agent requirements are collected and used to create agent templates.\n*   **`web/src/content/agents/creating-new-agents.mdx`**: This file provides documentation on creating new agents, including examples and best practices. It offers insights into the structure and required fields of agent templates.\n*   **`common/src/types/dynamic-agent-template.ts`**: This file defines the schema for dynamic agent templates, outlining the structure and properties of custom LevelCode agents.\n"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-OfY8_NY2s",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "prompt": "agent builder, agent creation, scaffolding custom agents, agent templates"
      }
    },
    {
      "type": "text",
      "agentId": "D-OfY_tExks",
      "text": "Here's a concise report on diff-reviewer agent examples and configurations:\n\n*   `.agents/examples/diff-reviewer-1.ts`, `.agents/examples/diff-reviewer-2.ts`, `.agents/examples/diff-reviewer-3.ts`, `common/src/util/examples/diff-reviewer-1.ts`, `common/src/util/examples/diff-reviewer-2.ts`, `common/src/util/examples/diff-reviewer-3.ts`: These files provide example definitions for diff-reviewer agents at different levels (1-3), showcasing variations in input schema, tools used, and step handling.\n\n*   `backend/src/templates/agents/reviewer.ts`: This file defines the reviewer agent template, including its persona, instructions, and tool usage, focusing on providing feedback on code changes.\n\n*   `backend/src/system-prompt/agent-instructions.md`: This file dictates the system prompt and instructions for the diff reviewer, shaping its behavior and emphasizing clarity, conciseness, and adherence to code style.\n\nThese files offer insights into the agent's configuration, behavior, and usage within the codebase.\n"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-OfY_tExks",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "prompt": "diff-reviewer agent examples and configurations"
      }
    },
    {
      "type": "text",
      "agentId": "D-OfaehVPQw",
      "text": "backend/src/templates/agents/file-explorer.ts\nbackend/src/tools/definitions/tool/spawn-agents.ts\nbackend/src/tools/handlers/tool/spawn-agents.ts\nbackend/src/templates/agent-registry.ts\ncommon/src/templates/agent-list.ts\ncommon/src/constants/agents.ts\nbackend/src/system-prompt/prompts.ts\nbackend/src/main-prompt.ts\nnpm-app/src/agents/load-agents.ts\nnpm-app/src/cli-handlers/agents.ts\nbackend/src/templates/base.ts\nbackend/src/tools/definitions/tool/spawn-agent-inline.ts"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-OgWSwaG9Q",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-OfaehVPQw",
      "prompt": "",
      "params": {
        "prompt": "file-explorer agent definition and spawn target"
      }
    },
    {
      "type": "tool_result",
      "toolCallId": "b8a5729e-8e1d-4629-9a40-03ed7cd2ac40",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Liszt the File Lister",
              "agentType": "file-lister",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "backend/src/templates/agents/file-explorer.ts\nbackend/src/tools/definitions/tool/spawn-agents.ts\nbackend/src/tools/handlers/tool/spawn-agents.ts\nbackend/src/templates/agent-registry.ts\ncommon/src/templates/agent-list.ts\ncommon/src/constants/agents.ts\nbackend/src/system-prompt/prompts.ts\nbackend/src/main-prompt.ts\nnpm-app/src/agents/load-agents.ts\nnpm-app/src/cli-handlers/agents.ts\nbackend/src/templates/base.ts\nbackend/src/tools/definitions/tool/spawn-agent-inline.ts"
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ],
      "parentAgentId": "D-OfaehVPQw"
    },
    {
      "type": "tool_call",
      "toolCallId": "3aa0ab7d-9afc-4330-929f-c01e72330ad1",
      "toolName": "read_files",
      "input": {
        "paths": [
          "backend/src/templates/agents/file-explorer.ts",
          "backend/src/tools/definitions/tool/spawn-agents.ts",
          "backend/src/tools/handlers/tool/spawn-agents.ts",
          "backend/src/templates/agent-registry.ts",
          "common/src/templates/agent-list.ts",
          "common/src/constants/agents.ts",
          "backend/src/system-prompt/prompts.ts",
          "backend/src/main-prompt.ts",
          "npm-app/src/agents/load-agents.ts",
          "npm-app/src/cli-handlers/agents.ts",
          "backend/src/templates/base.ts",
          "backend/src/tools/definitions/tool/spawn-agent-inline.ts"
        ]
      },
      "agentId": "D-OfaehVPQw",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "3aa0ab7d-9afc-4330-929f-c01e72330ad1",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": "backend/src/templates/agents/file-explorer.ts",
              "content": "import { AgentTemplateTypes } from '@levelcode/common/types/session-state'\nimport { z } from 'zod/v4'\n\nimport type { AgentTemplate } from '../types'\n\nconst paramsSchema = z.object({\n  prompts: z\n    .array(z.string())\n    .describe(\n      'List of 1-4 different parts of the codebase that could be useful to explore',\n    ),\n})\n\nexport const fileExplorer = {\n  id: AgentTemplateTypes.file_explorer,\n  displayName: 'Dora the File Explorer',\n  spawnPurposePrompt:\n    'Spawns multiple file picker agents in parallel to comprehensively explore the codebase from different perspectives',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  outputMode: 'structured_output',\n  includeMessageHistory: false,\n  toolNames: ['spawn_agents', 'set_output'],\n  spawnableAgents: ['file-picker'],\n  inputSchema: {\n    prompt: z\n      .string()\n      .describe('What you need to accomplish by exploring the codebase'),\n    params: paramsSchema,\n  },\n  systemPrompt:\n    'You are a file explorer agent that spawns multiple file picker agents in parallel to comprehensively explore the codebase.',\n  instructionsPrompt: '',\n  stepPrompt: '',\n\n  handleSteps: function* ({ prompt, params }) {\n    const filePickerPrompts = params.prompts.map(\n      (focusPrompt) =>\n        `Based on the overall goal \"${prompt}\", find files related to this specific area: ${focusPrompt}`,\n    )\n\n    // Spawn all file pickers in parallel\n    const { toolResult: spawnResult } = yield {\n      toolName: 'spawn_agents' as const,\n      args: {\n        agents: filePickerPrompts.map((promptText) => ({\n          agent_type: 'file-picker' as const,\n          prompt: promptText,\n        })),\n      },\n    }\n\n    // Set output with aggregated results\n    yield {\n      toolName: 'set_output' as const,\n      args: {\n        results: spawnResult,\n      },\n    }\n  },\n} satisfies AgentTemplate<string, z.infer<typeof paramsSchema>>\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/tools/definitions/tool/spawn-agents.ts",
              "content": "import { getToolCallString } from '@levelcode/common/tools/utils'\n\nimport type { ToolDescription } from '../tool-def-type'\n\nconst toolName = 'spawn_agents'\nexport const spawnAgentsTool = {\n  toolName,\n  description: `\nUse this tool to spawn agents to help you complete the user request. Each agent has specific requirements for prompt and params based on their inputSchema.\n\nThe prompt field is a simple string, while params is a JSON object that gets validated against the agent's schema.\n\nExample:\n${getToolCallString(toolName, {\n  agents: [\n    {\n      agent_type: 'planner',\n      prompt: 'Create a plan for implementing user authentication',\n      params: { filePaths: ['src/auth.ts', 'src/user.ts'] },\n    },\n  ],\n})}\n    `.trim(),\n} satisfies ToolDescription\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/tools/handlers/tool/spawn-agents.ts",
              "content": "import { generateCompactId } from '@levelcode/common/util/string'\n\nimport { getAgentTemplate } from '../../../templates/agent-registry'\nimport { logger } from '../../../util/logger'\n\nimport type { LevelCodeToolCall } from '../../constants'\nimport type { LevelCodeToolHandlerFunction } from '../handler-function-type'\nimport type { AgentTemplate } from '@levelcode/common/types/agent-template'\nimport type { LevelCodeMessage } from '@levelcode/common/types/message'\nimport type { PrintModeEvent } from '@levelcode/common/types/print-mode'\nimport type {\n  AgentState,\n  AgentTemplateType,\n} from '@levelcode/common/types/session-state'\nimport type { ProjectFileContext } from '@levelcode/common/util/file'\nimport type { WebSocket } from 'ws'\n\nexport type SendSubagentChunk = (data: {\n  userInputId: string\n  agentId: string\n  agentType: string\n  chunk: string\n  prompt?: string\n}) => void\n\nexport const handleSpawnAgents = ((params: {\n  previousToolCallFinished: Promise<void>\n  toolCall: LevelCodeToolCall<'spawn_agents'>\n\n  fileContext: ProjectFileContext\n  clientSessionId: string\n  userInputId: string\n\n  getLatestState: () => { messages: LevelCodeMessage[] }\n  state: {\n    ws?: WebSocket\n    fingerprintId?: string\n    userId?: string\n    agentTemplate?: AgentTemplate\n    localAgentTemplates?: Record<string, AgentTemplate>\n    sendSubagentChunk?: SendSubagentChunk\n    messages?: LevelCodeMessage[]\n    agentState?: AgentState\n  }\n}): { result: Promise<string>; state: {} } => {\n  const {\n    previousToolCallFinished,\n    toolCall,\n\n    fileContext,\n    clientSessionId,\n    userInputId,\n    getLatestState,\n    state,\n  } = params\n  const { agents } = toolCall.args\n  const {\n    ws,\n    fingerprintId,\n    userId,\n    agentTemplate: parentAgentTemplate,\n    localAgentTemplates,\n    sendSubagentChunk,\n    messages,\n  } = state\n  let { agentState } = state\n\n  if (!ws) {\n    throw new Error(\n      'Internal error for spawn_agents: Missing WebSocket in state',\n    )\n  }\n  if (!fingerprintId) {\n    throw new Error(\n      'Internal error for spawn_agents: Missing fingerprintId in state',\n    )\n  }\n  if (!parentAgentTemplate) {\n    throw new Error(\n      'Internal error for spawn_agents: Missing agentTemplate in state',\n    )\n  }\n  if (!sendSubagentChunk) {\n    throw new Error(\n      'Internal error for spawn_agents: Missing sendSubagentChunk in state',\n    )\n  }\n  if (!messages) {\n    throw new Error(\n      'Internal error for spawn_agents: Missing messages in state',\n    )\n  }\n  if (!agentState) {\n    throw new Error(\n      'Internal error for spawn_agents: Missing agentState in state',\n    )\n  }\n  if (!localAgentTemplates) {\n    throw new Error(\n      'Internal error for spawn_agents: Missing localAgentTemplates in state',\n    )\n  }\n\n  const triggerSpawnAgents = async () => {\n    const conversationHistoryMessage: LevelCodeMessage = {\n      role: 'user',\n      content: `For context, the following is the conversation history between the user and an assistant:\\n\\n${JSON.stringify(\n        getLatestState().messages,\n        null,\n        2,\n      )}`,\n    }\n    const results = await Promise.allSettled(\n      agents.map(async ({ agent_type: agentTypeStr, prompt, params }) => {\n        const agentType = agentTypeStr as AgentTemplateType\n        const agentTemplate = await getAgentTemplate(\n          agentType,\n          localAgentTemplates,\n        )\n\n        if (!agentTemplate) {\n          throw new Error(`Agent type ${agentTypeStr} not found.`)\n        }\n\n        if (!parentAgentTemplate.spawnableAgents.includes(agentType)) {\n          throw new Error(\n            `Agent type ${parentAgentTemplate.id} is not allowed to spawn child agent type ${agentType}.`,\n          )\n        }\n\n        // Validate prompt and params against agent's schema\n        const { inputSchema } = agentTemplate\n\n        // Validate prompt requirement\n        if (inputSchema.prompt) {\n          const result = inputSchema.prompt.safeParse(prompt)\n          if (!result.success) {\n            throw new Error(\n              `Invalid prompt for agent ${agentType}: ${JSON.stringify(result.error.issues, null, 2)}`,\n            )\n          }\n        }\n\n        // Validate params if schema exists\n        if (inputSchema.params) {\n          const result = inputSchema.params.safeParse(params)\n          if (!result.success) {\n            throw new Error(\n              `Invalid params for agent ${agentType}: ${JSON.stringify(result.error.issues, null, 2)}`,\n            )\n          }\n        }\n\n        const agentId = generateCompactId()\n        const subAgentMessages: LevelCodeMessage[] = []\n        if (agentTemplate.includeMessageHistory) {\n          subAgentMessages.push(conversationHistoryMessage)\n        }\n\n        const subAgentState: AgentState = {\n          agentId,\n          agentType,\n          agentContext: {},\n          subagents: [],\n          messageHistory: subAgentMessages,\n          stepsRemaining: 20, // MAX_AGENT_STEPS\n          output: undefined,\n          parentId: agentState!.agentId,\n        }\n\n        logger.debug(\n          {\n            agentTemplate,\n            prompt,\n            params,\n            agentId,\n            parentId: subAgentState.parentId,\n          },\n          `Spawning agent  ${agentType} (${agentId})`,\n        )\n\n        // Import loopAgentSteps dynamically to avoid circular dependency\n        const { loopAgentSteps } = await import('../../../run-agent-step')\n\n        const result = await loopAgentSteps(ws, {\n          userInputId: `${userInputId}-${agentType}${agentId}`,\n          prompt: prompt || '',\n          params,\n          agentType: agentTemplate.id,\n          agentState: subAgentState,\n          fingerprintId,\n          fileContext,\n          localAgentTemplates,\n          toolResults: [],\n          userId,\n          clientSessionId,\n          onResponseChunk: (chunk: string | PrintModeEvent) => {\n            if (typeof chunk !== 'string') {\n              return\n            }\n            // Send subagent streaming chunks to client\n            sendSubagentChunk({\n              userInputId,\n              agentId,\n              agentType,\n              chunk,\n              prompt,\n            })\n          },\n        })\n\n        return {\n          ...result,\n          agentType,\n          agentName: agentTemplate.displayName,\n        }\n      }),\n    )\n\n    const reports = await Promise.all(\n      results.map(async (result, index) => {\n        const agentInfo = agents[index]\n        const agentTypeStr = agentInfo.agent_type\n\n        if (result.status === 'fulfilled') {\n          const { agentState, agentName } = result.value\n          const agentTemplate = await getAgentTemplate(\n            agentState.agentType!,\n            localAgentTemplates,\n          )\n          if (!agentTemplate) {\n            return `**Agent (${agentTypeStr}):**\\nError: Could not find agent template for ${agentState.agentType!}`\n          }\n          let report = ''\n\n          if (agentTemplate.outputMode === 'structured_output') {\n            report = JSON.stringify(result.value.agentState.output, null, 2)\n          } else if (agentTemplate.outputMode === 'last_message') {\n            const { agentState } = result.value\n            const assistantMessages = agentState.messageHistory.filter(\n              (message) => message.role === 'assistant',\n            )\n            const lastAssistantMessage =\n              assistantMessages[assistantMessages.length - 1]\n            if (!lastAssistantMessage) {\n              report = 'No response from agent'\n            } else if (typeof lastAssistantMessage.content === 'string') {\n              report = lastAssistantMessage.content\n            } else {\n              report = JSON.stringify(lastAssistantMessage.content, null, 2)\n            }\n          } else if (agentTemplate.outputMode === 'all_messages') {\n            const { agentState } = result.value\n            // Remove the first message, which includes the previous conversation history.\n            const agentMessages = agentState.messageHistory.slice(1)\n            report = `Agent messages:\\n\\n${JSON.stringify(agentMessages, null, 2)}`\n          } else {\n            throw new Error(\n              `Unknown output mode: ${'outputMode' in agentTemplate ? agentTemplate.outputMode : 'undefined'}`,\n            )\n          }\n\n          return `**${agentName}:**\\n${report}`\n        } else {\n          return `**Agent (${agentTypeStr}):**\\nError spawning agent: ${result.reason}`\n        }\n      }),\n    )\n    return reports\n      .map((report: string) => `<agent_report>${report}</agent_report>`)\n      .join('\\n')\n  }\n\n  return {\n    result: previousToolCallFinished.then(triggerSpawnAgents),\n    state: {},\n  }\n}) satisfies LevelCodeToolHandlerFunction<'spawn_agents'>\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agent-registry.ts",
              "content": "import type { AgentTemplate } from '@levelcode/common/types/agent-template'\nimport db from '@levelcode/common/db'\nimport * as schema from '@levelcode/common/db/schema'\nimport { and, desc, eq } from 'drizzle-orm'\n\nimport { ProjectFileContext } from '@levelcode/common/util/file'\nimport { logger } from '../util/logger'\nimport { agentTemplates as staticTemplates } from './agent-list'\nimport {\n  DynamicAgentValidationError,\n  validateAgents,\n  validateSingleAgent,\n} from '@levelcode/common/templates/agent-validation'\nimport { DynamicAgentTemplate } from '@levelcode/common/types/dynamic-agent-template'\n\nexport type AgentRegistry = Record<string, AgentTemplate>\n\n// Global database cache - only state in the system\nconst databaseAgentCache = new Map<string, AgentTemplate | null>()\n\n/**\n * Parse agent ID to extract publisher, agent name, and version\n */\nfunction parseAgentId(fullAgentId: string): {\n  publisherId: string\n  agentId: string\n  version?: string\n} | null {\n  // Check if it's in the publisher/agent-id[@version] format\n  const parts = fullAgentId.split('/')\n  if (parts.length !== 2) {\n    return null\n  }\n\n  const [publisherId, agentNameWithVersion] = parts\n\n  // Check for version suffix\n  const versionMatch = agentNameWithVersion.match(/^(.+)@(.+)$/)\n  if (versionMatch) {\n    const [, agentId, version] = versionMatch\n    return { publisherId, agentId, version }\n  }\n\n  return { publisherId, agentId: agentNameWithVersion }\n}\n\n/**\n * Fetch an agent from the database by publisher/agent-id[@version] format\n */\nasync function fetchAgentFromDatabase(parsedAgentId: {\n  publisherId: string\n  agentId: string\n  version?: string\n}): Promise<AgentTemplate | null> {\n  const { publisherId, agentId, version } = parsedAgentId\n\n  try {\n    let agentConfig\n\n    if (version && version !== 'latest') {\n      // Query for specific version\n      agentConfig = await db\n        .select()\n        .from(schema.agentConfig)\n        .where(\n          and(\n            eq(schema.agentConfig.id, agentId),\n            eq(schema.agentConfig.publisher_id, publisherId),\n            eq(schema.agentConfig.version, version),\n          ),\n        )\n        .then((rows) => rows[0])\n    } else {\n      // Query for latest version\n      agentConfig = await db\n        .select()\n        .from(schema.agentConfig)\n        .where(\n          and(\n            eq(schema.agentConfig.id, agentId),\n            eq(schema.agentConfig.publisher_id, publisherId),\n          ),\n        )\n        .orderBy(\n          desc(schema.agentConfig.major),\n          desc(schema.agentConfig.minor),\n          desc(schema.agentConfig.patch),\n        )\n        .limit(1)\n        .then((rows) => rows[0])\n    }\n\n    if (!agentConfig) {\n      logger.debug(\n        { publisherId, agentId, version },\n        'fetchAgentFromDatabase: Agent not found in database',\n      )\n      return null\n    }\n\n    const rawAgentData = agentConfig.data as DynamicAgentTemplate\n\n    // Validate the raw agent data with the original agentId (not full identifier)\n    const validationResult = validateSingleAgent(\n      { ...rawAgentData, id: agentId },\n      {\n        filePath: `${publisherId}/${agentId}@${agentConfig.version}`,\n        skipSubagentValidation: true,\n      },\n    )\n\n    if (!validationResult.success) {\n      logger.error(\n        {\n          publisherId,\n          agentId,\n          version: agentConfig.version,\n          error: validationResult.error,\n        },\n        'fetchAgentFromDatabase: Agent validation failed',\n      )\n      return null\n    }\n\n    // Set the correct full agent ID for the final template\n    const agentTemplate = {\n      ...validationResult.agentTemplate!,\n      id: `${publisherId}/${agentId}@${agentConfig.version}`,\n    }\n\n    logger.debug(\n      {\n        publisherId,\n        agentId,\n        version: agentConfig.version,\n        fullAgentId: agentTemplate.id,\n      },\n      'fetchAgentFromDatabase: Successfully loaded and validated agent from database',\n    )\n\n    return agentTemplate\n  } catch (error) {\n    logger.error(\n      { publisherId, agentId, version, error },\n      'fetchAgentFromDatabase: Error fetching agent from database',\n    )\n    return null\n  }\n}\n\n/**\n * Single function to look up an agent template with clear priority order:\n * 1. localAgentTemplates (dynamic agents + static templates)\n * 2. Database cache\n * 3. Database query\n */\nexport async function getAgentTemplate(\n  agentId: string,\n  localAgentTemplates: Record<string, AgentTemplate>,\n): Promise<AgentTemplate | null> {\n  // 1. Check localAgentTemplates first (dynamic agents + static templates)\n  if (localAgentTemplates[agentId]) {\n    return localAgentTemplates[agentId]\n  }\n  // 2. Check database cache\n  const cacheKey = agentId\n  if (databaseAgentCache.has(cacheKey)) {\n    return databaseAgentCache.get(cacheKey) || null\n  }\n\n  const parsed = parseAgentId(agentId)\n  if (!parsed) {\n    logger.debug({ agentId }, 'getAgentTemplate: Failed to parse agent ID')\n    return null\n  }\n\n  // 3. Query database (only for publisher/agent-id format)\n  const dbAgent = await fetchAgentFromDatabase(parsed)\n  if (dbAgent && parsed.version && parsed.version !== 'latest') {\n    // Cache only specific versions to avoid stale 'latest' results\n    databaseAgentCache.set(cacheKey, dbAgent)\n  }\n  return dbAgent\n}\n\n/**\n * Assemble local agent templates from fileContext + static templates\n */\nexport function assembleLocalAgentTemplates(fileContext: ProjectFileContext): {\n  agentTemplates: Record<string, AgentTemplate>\n  validationErrors: DynamicAgentValidationError[]\n} {\n  // Load dynamic agents using the service\n  const { templates: dynamicTemplates, validationErrors } = validateAgents(\n    fileContext.agentTemplates || {},\n  )\n\n  // Combine static and dynamic templates\n  const agentTemplates = { ...staticTemplates, ...dynamicTemplates }\n\n  return { agentTemplates, validationErrors }\n}\n\n/**\n * Clear the database agent cache (useful for testing)\n */\nexport function clearDatabaseCache(): void {\n  databaseAgentCache.clear()\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/templates/agent-list.ts",
              "content": "[FILE_DOES_NOT_EXIST]",
              "referencedBy": {}
            },
            {
              "path": "common/src/constants/agents.ts",
              "content": "import type { AgentTemplateTypes } from '../types/session-state'\n\n// Define agent personas with their shared characteristics\nexport const AGENT_PERSONAS = {\n  // Base agents - all use Buffy persona\n  base: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  base_lite: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  base_max: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  base_experimental: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  claude4_gemini_thinking: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n\n  base_agent_builder: {\n    displayName: 'Buffy the Enthusiastic Agent Builder',\n    purpose:\n      'Enhanced base agent that can create custom agents and handle all coding tasks',\n  } as const,\n\n  superagent: {\n    displayName: 'Superagent',\n    purpose:\n      'Superagent that can spawn multiple code editing agents to complete a task.',\n  } as const,\n\n  // Ask mode\n  ask: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base ask-mode agent that orchestrates the full response.',\n  } as const,\n\n  // Specialized agents\n  thinker: {\n    displayName: 'Theo the Theorizer',\n    purpose:\n      'Does deep thinking given the current messages and a specific prompt to focus on. Use this to help you solve a specific problem.',\n  } as const,\n  file_explorer: {\n    displayName: 'Dora The File Explorer',\n    purpose: 'Expert at exploring a codebase and finding relevant files.',\n  } as const,\n  file_picker: {\n    displayName: 'Fletcher the File Fetcher',\n    purpose: 'Expert at finding relevant files in a codebase.',\n  } as const,\n  researcher: {\n    displayName: 'Reid Searcher the Researcher',\n    purpose: 'Expert at researching topics using web search and documentation.',\n  } as const,\n  planner: {\n    displayName: 'Peter Plan the Planner',\n    purpose: 'Agent that formulates a comprehensive plan to a prompt.',\n    hidden: true,\n  } as const,\n  dry_run: {\n    displayName: 'Sketch the Dry Runner',\n    purpose: 'Agent that takes a plan and try to implement it in a dry run.',\n    hidden: true,\n  } as const,\n  reviewer: {\n    displayName: 'Nit Pick Nick the Reviewer',\n    purpose:\n      'Reviews file changes and responds with critical feedback. Use this after making any significant change to the codebase.',\n  } as const,\n  agent_builder: {\n    displayName: 'Bob the Agent Builder',\n    purpose: 'Creates new agent templates for the levelcode mult-agent system',\n    hidden: false,\n  } as const,\n} as const satisfies Partial<\n  Record<\n    keyof typeof AgentTemplateTypes,\n    { displayName: string; purpose: string; hidden?: boolean }\n  >\n>\n\n// Agent IDs list from AGENT_PERSONAS keys\nexport const AGENT_IDS = Object.keys(\n  AGENT_PERSONAS,\n) as (keyof typeof AGENT_PERSONAS)[]\n\n// Agent ID prefix constant\nexport const AGENT_ID_PREFIX = 'LevelCodeAI/'\n\n// Agent names for client-side reference\nexport const AGENT_NAMES = Object.fromEntries(\n  Object.entries(AGENT_PERSONAS).map(([agentType, persona]) => [\n    agentType,\n    persona.displayName,\n  ]),\n) as Record<keyof typeof AGENT_PERSONAS, string>\n\nexport type AgentName =\n  (typeof AGENT_PERSONAS)[keyof typeof AGENT_PERSONAS]['displayName']\n\n// Get unique agent names for UI display\nexport const UNIQUE_AGENT_NAMES = Array.from(\n  new Set(\n    Object.values(AGENT_PERSONAS)\n      .filter((persona) => !('hidden' in persona) || !persona.hidden)\n      .map((persona) => persona.displayName),\n  ),\n)\n\n// Map from display name back to agent types (for parsing user input)\nexport const AGENT_NAME_TO_TYPES = Object.entries(AGENT_NAMES).reduce(\n  (acc, [type, name]) => {\n    if (!acc[name]) acc[name] = []\n    acc[name].push(type)\n    return acc\n  },\n  {} as Record<string, string[]>,\n)\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/system-prompt/prompts.ts",
              "content": "import { STOP_MARKER } from '@levelcode/common/constants'\nimport {\n  levelcodeConfigFile,\n  LevelCodeConfigSchema,\n} from '@levelcode/common/json-config/constants'\nimport { stringifySchema } from '@levelcode/common/json-config/stringify-schema'\nimport {\n  flattenTree,\n  getLastReadFilePaths,\n} from '@levelcode/common/project-file-tree'\nimport { createMarkdownFileBlock } from '@levelcode/common/util/file'\nimport { truncateString } from '@levelcode/common/util/string'\nimport { closeXml } from '@levelcode/common/util/xml'\n\nimport { truncateFileTreeBasedOnTokenBudget } from './truncate-file-tree'\n\nimport type { ProjectFileContext } from '@levelcode/common/util/file'\n\nexport const configSchemaPrompt = `\n# LevelCode Configuration (${levelcodeConfigFile})\n\n## Schema\n\nThe following describes the structure of the \\`./${levelcodeConfigFile}\\` configuration file that users might have in their project root. You can use this to understand user settings if they mention them.\n\n${stringifySchema(LevelCodeConfigSchema)}\n\n## Background Processes\n\nThe user does not have access to these outputs. Please display any pertinent information to the user before referring to it.\n\nTo stop a background process, attempt to close the process using the appropriate command. If you deem that command to be \\`kill\\`, **make sure** to kill the **ENTIRE PROCESS GROUP** (Mac/Linux) or tree (Windows).\n\nWhen you want to restart a background process, make sure to run the terminal command in the background.\n`.trim()\n\nexport const knowledgeFilesPrompt = `\n# Knowledge files\n\nKnowledge files are your guide to the project. Knowledge files (files ending in \"knowledge.md\" or \"CLAUDE.md\") within a directory capture knowledge about that portion of the codebase. They are another way to take notes in this \"Memento\"-style environment.\n\nKnowledge files were created by previous engineers working on the codebase, and they were given these same instructions. They contain key concepts or helpful tips that are not obvious from the code. e.g., let's say I want to use a package manager aside from the default. That is hard to find in the codebase and would therefore be an appropriate piece of information to add to a knowledge file.\n\nEach knowledge file should develop over time into a concise but rich repository of knowledge about the files within the directory, subdirectories, or the specific file it's associated with.\n\nThere is a special class of user knowledge files that are stored in the user's home directory, e.g. \\`~/.knowledge.md\\`. These files are available to be read, but you cannot edit them because they are outside of the project directory. Do not try to edit them.\n\nWhen should you update a knowledge file?\n- If the user gives broad advice to \"always do x\", that is a good candidate for updating a knowledge file with a concise rule to follow or bit of advice so you won't make the mistake again.\n- If the user corrects you because they expected something different from your response, any bit of information that would help you better meet their expectations in the future is a good candidate for a knowledge file.\n\nWhat to include in knowledge files:\n- The mission of the project. Goals, purpose, and a high-level overview of the project.\n- Explanations of how different parts of the codebase work or interact.\n- Examples of how to do common tasks with a short explanation.\n- Anti-examples of what should be avoided.\n- Anything the user has said to do.\n- Anything you can infer that the user wants you to do going forward.\n- Tips and tricks.\n- Style preferences for the codebase.\n- Technical goals that are in progress. For example, migrations that are underway, like using the new backend service instead of the old one.\n- Links to reference pages that are helpful. For example, the url of documentation for an api you are using.\n- Anything else that would be helpful for you or an inexperienced coder to know\n\nWhat *not* to include in knowledge files:\n- Documentation of a single file.\n- Restated code or interfaces in natural language.\n- Anything obvious from reading the codebase.\n- Lots of detail about a minor change.\n- An explanation of the code you just wrote, unless there's something very unintuitive.\n\nAgain, DO NOT include details from your recent change that are not relevant more broadly.\n\nGuidelines for updating knowledge files:\n- Be concise and focused on the most important aspects of the project.\n- Integrate new knowledge into existing sections when possible.\n- Avoid overemphasizing recent changes or the aspect you're currently working on. Your current change is less important than you think.\n- Remove as many words as possible while keeping the meaning. Use command verbs. Use sentence fragments.\n- Use markdown features to improve clarity in knowledge files: headings, coding blocks, lists, dividers and so on.\n\nOnce again: BE CONCISE!\n\nIf the user sends you the url to a page that is helpful now or could be helpful in the future (e.g. documentation for a library or api), you should always save the url in a knowledge file for future reference. Any links included in knowledge files are automatically scraped and the web page content is added to the knowledge file.\n`.trim()\n\nconst initPrompt = `\nUser has typed \"init\". Trigger initialization flow:\n\nFirst, read knowldge.md and ${levelcodeConfigFile} top level directory.\n\nKnowledge file:\n- If it does not exist, create a new one with updated information.\n- If it does, do nothing.\n\nConfig file (probably already exists):\n- Do not edit the description field.\n- If it looks already populated, do nothing.\n- If it is just a template without any configurations set (empty arrays), determine whether background processes are necessary for development. If they are, populate the fields to according to the project. Additionally:\n  - Do provide:\n    - startupProcesses.item.stdoutFile: \"logs/{name}.log\"\n  - Do not provide:\n    - startupProcesses.item.stderrFile\n    - startupProcesses.item.enabled\n  - Provide startupProcesses.item.cwd only if it is not '.'\n\nAfter populating the config file (if necessary), simply respond to the user with:\n\n Created ${levelcodeConfigFile}\n\nThe CLI will automatically show additional tips and start any configured background processes after this response completes.\n`.trim()\n\nconst compactPrompt = `\nUser has typed \"compact\". Summarize the current conversation and prepare it to replace the existing message history.\n\n1. Summarize the entire conversation up to this point (excluding this 'compact' command).\n2. The summary should be detailed and must capture the key decisions, analysis, changes, and outcomes.\n`.trim()\n\nconst exportPrompt = `\nUser has typed \"export\". Export the current conversation. (It's ok to proceed even if in \"Ask\" mode because of user change to \"Export\" mode).\n\n1. Summarize the entire conversation up to this point from the message history (excluding this 'export' command) into a new file.\n2. The summary MUST be in Markdown format.\n3. The summary MUST include:\n   - All key decisions made during the conversation.\n   - All significant file changes. If you have access to write_file blocks from our history, reproduce their paths and content accurately. If you only have diffs or descriptions of changes, summarize those.\n   - The reasoning behind those decisions and changes.\n4. Use the 'write_file' tool to save this Markdown summary to a new file with a generated name starting with the prefix 'levelcode-export-' like 'levelcode-export-topic-of-conversation.md' in the project root directory.\n\nWrite file tool format:\n\n<write_file>\n<path>levelcode-export-file-name.md${closeXml('path')}\n<content>\n[Insert markdown content here]\n${closeXml('content')}\n${closeXml('write_file')}\n`.trim()\n\nexport const additionalSystemPrompts = {\n  '/init': initPrompt,\n  init: initPrompt,\n  '/export': exportPrompt,\n  export: exportPrompt,\n  '/compact': compactPrompt,\n  compact: compactPrompt,\n} as const\n\nexport const getProjectFileTreePrompt = (\n  fileContext: ProjectFileContext,\n  fileTreeTokenBudget: number,\n  mode: 'search' | 'agent',\n) => {\n  const { projectRoot } = fileContext\n  const { printedTree, truncationLevel } = truncateFileTreeBasedOnTokenBudget(\n    fileContext,\n    Math.max(0, fileTreeTokenBudget),\n  )\n\n  const truncationNote =\n    truncationLevel === 'none'\n      ? ''\n      : truncationLevel === 'unimportant-files'\n        ? '\\nNote: Unimportant files (like build artifacts and cache files) have been removed from the file tree.'\n        : truncationLevel === 'tokens'\n          ? '\\nNote: Selected function, class, and variable names in source files have been removed from the file tree to fit within token limits.'\n          : '\\nNote: The file tree has been truncated to show a subset of files to fit within token limits.'\n\n  return `\n# Project file tree\n\nAs Buffy, you have access to all the files in the project.\n\nThe following is the path to the project on the user's computer. It is also the current working directory for terminal commands:\n<project_path>\n${projectRoot}\n${closeXml('project_path')}\n\nWithin this project directory, here is the file tree.\nNote that the file tree:\n- Is cached from the start of this conversation. Files created after the start of this conversation will not appear.\n- Excludes files that are .gitignored.\n${\n  mode === 'agent'\n    ? `\\nThe project file tree below can be ignored unless you need to know what files are in the project.\\n`\n    : ''\n}\n<project_file_tree>\n${printedTree}\n${closeXml('project_file_tree')}\n${truncationNote}\n`.trim()\n}\n\nconst windowsNote = `\nNote: many commands in the terminal are different on Windows.\nFor example, the mkdir command is \\`mkdir\\` instead of \\`mkdir -p\\`. Instead of grep, use \\`findstr\\`. Instead of \\`ls\\` use \\`dir\\` to list files. Instead of \\`mv\\` use \\`move\\`. Instead of \\`rm\\` use \\`del\\`. Instead of \\`cp\\` use \\`copy\\`. Unless the user is in Powershell, in which case you should use the Powershell commands instead.\n`.trim()\n\nexport const getSystemInfoPrompt = (fileContext: ProjectFileContext) => {\n  const { fileTree, shellConfigFiles, systemInfo } = fileContext\n  const flattenedNodes = flattenTree(fileTree)\n  const lastReadFilePaths = getLastReadFilePaths(flattenedNodes, 20)\n\n  return `\n# System Info\n\nOperating System: ${systemInfo.platform}\n${systemInfo.platform === 'win32' ? windowsNote + '\\n' : ''}\nShell: ${systemInfo.shell}\n\n<user_shell_config_files>\n${Object.entries(shellConfigFiles)\n  .map(([path, content]) => createMarkdownFileBlock(path, content))\n  .join('\\n')}\n${closeXml('user_shell_config_files')}\n\nThe following are the most recently read files according to the OS atime. This is cached from the start of this conversation:\n<recently_read_file_paths_most_recent_first>\n${lastReadFilePaths.join('\\n')}\n${closeXml('recently_read_file_paths_most_recent_first')}\n`.trim()\n}\n\nexport const getGitChangesPrompt = (fileContext: ProjectFileContext) => {\n  const { gitChanges } = fileContext\n  if (!gitChanges) {\n    return ''\n  }\n  const maxLength = 30_000\n  return `\nCurrent Git Changes:\n<git_status>\n${truncateString(gitChanges.status, maxLength / 10)}\n${closeXml('git_status')}\n\n<git_diff>\n${truncateString(gitChanges.diff, maxLength)}\n${closeXml('git_diff')}\n\n<git_diff_cached>\n${truncateString(gitChanges.diffCached, maxLength)}\n${closeXml('git_diff_cached')}\n\n<git_commit_messages_most_recent_first>\n${truncateString(gitChanges.lastCommitMessages, maxLength / 10)}\n${closeXml('git_commit_messages_most_recent_first')}\n`.trim()\n}\n\nexport const gitCommitGuidePrompt = `\n### Using git to commit changes\n\nWhen the user requests a new git commit, please follow these steps closely:\n\n1. **Run two run_terminal_command tool calls:**\n   - Run \\`git diff\\` to review both staged and unstaged modifications.\n   - Run \\`git log\\` to check recent commit messages, ensuring consistency with this repository's style.\n\n2. **Select relevant files to include in the commit:**\n   Use the git context established at the start of this conversation to decide which files are pertinent to the changes. Stage any new untracked files that are relevant, but avoid committing previously modified files (from the beginning of the conversation) unless they directly relate to this commit.\n\n3. **Analyze the staged changes and compose a commit message:**\n   Enclose your analysis in <commit_analysis> tags. Within these tags, you should:\n   - Note which files have been altered or added.\n   - Categorize the nature of the changes (e.g., new feature, fix, refactor, documentation, etc.).\n   - Consider the purpose or motivation behind the alterations.\n   - Refrain from using tools to inspect code beyond what is presented in the git context.\n   - Evaluate the overall impact on the project.\n   - Check for sensitive details that should not be committed.\n   - Draft a concise, one- to two-sentence commit message focusing on the why rather than the what.\n   - Use precise, straightforward language that accurately represents the changes.\n   - Ensure the message provides clarityavoid generic or vague terms like Update or Fix without context.\n   - Revisit your draft to confirm it truly reflects the changes and their intention.\n\n4. **Create the commit, ending with this specific footer:**\n   \\`\\`\\`\n   Generated with LevelCode \n   Co-Authored-By: LevelCode <noreply@levelcode.com>\n   \\`\\`\\`\n   To maintain proper formatting, always place the commit message in a HEREDOC. For instance:\n   \\`\\`\\`\n   git commit -m \"$(cat <<'EOF'\n   Your commit message here.\n\n    Generated with LevelCode\n   Co-Authored-By: LevelCode <noreply@levelcode.com>\n   EOF\n   )\"\n   \\`\\`\\`\n   (Make sure to end each line with ^ on Windows:)\n   \\`\\`\\`\n   git commit -m \"Your commit message here.^\n   ^\n    Generated with LevelCode^\n   Co-Authored-By: LevelCode <noreply@levelcode.com>\"\n   \\`\\`\\`\n\n**Important details**\n\n- When feasible, use a single \\`git commit -am\\` command to add and commit together, but do not accidentally stage unrelated files.\n- Never alter the git config.\n- Do not push to the remote repository.\n- Avoid using interactive flags (e.g., \\`-i\\`) that require unsupported interactive input.\n- Do not create an empty commit if there are no changes.\n- Make sure your commit message is concise yet descriptive, focusing on the intention behind the changes rather than merely describing them.\n`\n\n// NOTE: Deprecated prompts below.\n\nconst introPrompt = `\nYou are Buffy, an expert programmer assistant with extensive knowledge across backend and frontend technologies. You are a strong technical writer that communicates with clarity. You are concise. You produce opinions and code that are as simple as possible while accomplishing their purpose.\n\nAs Buffy, you are friendly, professional, and always eager to help users improve their code and understanding of programming concepts.\n\nYou are assisting the user with one particular coding project to which you have full access. You can see the file tree of all the files in the project. You can edit files. You can request to read any set of files to see their full content. You can run terminal commands on the user's computer within the project directory to compile code, run tests, install packages, and search for relevant code. You will be called on again and again for advice and for direct code changes and other changes to files in this project.\n\nIf you are unsure about the answer to a user's question, you should say \"I don't have enough information to confidently answer your question.\" If the scope of the change the user is requesting is too large to implement all at once (e.g. requires greater than 750 lines of code), you can tell the user the scope is too big and ask which sub-problem to focus on first.\n`.trim()\n\nconst toolsPrompt = `\n# Tools\n\nYou have access to the following tools:\n- <tool_call name=\"find_files\">[DESCRIPTION_OF_FILES]${closeXml('tool_call')}: Find files given a brief natural language description of the files or the name of a function or class you are looking for.\n- <tool_call name=\"read_files\">[LIST_OF_FILE_PATHS]${closeXml('tool_call')}: Provide a list of file paths to read, separated by newlines. The file paths must be relative to the project root directory. Prefer using this tool over find_files when you know the exact file(s) you want to read.\n- <tool_call name=\"code_search\">[PATTERN]${closeXml('tool_call')}: Search for the given pattern in the project directory. Use this tool to search for code in the project, like function names, class names, variable names, types, where a function is called from, where it is defined, etc.\n- <tool_call name=\"think_deeply\">${closeXml('tool_call')}: Think through a complex change to the codebase, like implementing a new feature or refactoring some code. Don't pass any arguments to this tool. Use this tool to think on a user request that requires planning. Only use this if the user asks you to plan.\n- <tool_call name=\"run_terminal_command\">[YOUR COMMAND HERE]${closeXml('tool_call')}')}: Execute a command in the terminal and return the result.\n- <tool_call name=\"scrape_web_page\">[URL HERE]${closeXml('tool_call')}')}: Scrape the web page at the given url and return the content.\n- <tool_call name=\"browser_action\">[BROWSER_ACTION_XML_HERE]${closeXml('tool_call')}')}: Navigate to a url, take screenshots, and view console.log output or errors for a web page. Use this tool to debug a web app or improve its visual style.\n\nImportant notes:\n- Immediately after you finish writing the closing tag of a tool call, you should write ${STOP_MARKER}, and end your response. Do not write out any other text. A tool call is a delgation -- do not write any other analysis or commentary.\n- Do not write out a tool call within another tool call block.\n- Do not write out a nested tool call within an <write_file> block. If you want to read a file before editing it, write the <tool_call> first. Similarly, do not write a tool call to run a terminal command within an <write_file> block.\n- You can freely explain what tools you have available, but do not write out <tool_call name=\"...\" />\" unless you are actually intending to call the tool, otherwise you will accidentally be calling the tool when explaining it.\n\n## Finding files\n\nUse the <tool_call name=\"find_files\">...${closeXml('tool_call')}')} tool to read more files beyond what is provided in the initial set of files.\n\nPurpose: Better fulfill the user request by reading files which could contain information relevant to the user's request.\n\nUse cases:\n- If you are calling a function or creating a class and want to know how it works, go get the implementation with a tool call to find_files. E.g. \"<tool_call name=\"find_files\">The implementation of function foo${closeXml('tool_call')}\".\n- If you want to modify a file, but don't currently have it in context. Be sure to call find_files before writing out an <write_file> block, or I will be very upset.\n- If you need to understand a section of the codebase, read more files in that directory or subdirectories.\n- Some requests require a broad understanding of multiple parts of the codebase. Consider using find_files to gain more context before making changes.\n\nHowever, use this tool sparingly. DO NOT USE \"find_files\" WHEN:\n- You are creating a new file\n- You want to edit a file that you already have in context. Double check that the file is not listed in the <relevant_files> block already before calling find_files.\n- You already called it recently. Multiple calls in a row are not productive.\n- You are inside an <write_file> block.\n\n## Reading files\n\nUse the <tool_call name=\"read_files\">...${closeXml('tool_call')}')} tool to read files you don't already have in context.\n\nFeel free to use this tool as much as needed to read files that would be relevant to the user's request.\n\nHowever, do not use this tool to read files that you already have in context. Do not repeat reading calls that you have already read.\n\nMake sure the file paths are relative to the project root directory, not absolute paths like \"C:\\\\Users\\\\my-project\\\\example.ts\". Also ensure that the path includes all intermediate directories to the file.\n\n## Code search\n\nUse the <tool_call name=\"code_search\">...${closeXml('tool_call')}')} tool to search for string patterns in the project's files. This tool uses ripgrep (rg), a fast line-oriented search tool.\n\nPurpose: Search through code files to find files with specific text patterns, function names, variable names, and more.\n\nExamples:\n<tool_call name=\"code_search\">foo${closeXml('tool_call')}')}\n<tool_call name=\"code_search\">import.*foo${closeXml('tool_call')}')}\n\nNote: quotes will be automatically added around your code search pattern. You might need to escape special characters like '-' or '.' or '\\' if you want to search for them.\n\nUse cases:\n1. Finding all references to a function, class, or variable name across the codebase\n2. Searching for specific code patterns or implementations\n3. Looking up where certain strings or text appear\n4. Finding files that contain specific imports or dependencies\n5. Locating configuration settings or environment variables\n\nThe pattern supports regular expressions and will search recursively through all files in the project by default. Some tips:\n- Be as constraining in the pattern as possible to limit the number of files returned, e.g. if searching for the definition of a function, use \"(function foo|const foo)\" or \"def foo\" instead of merely \"foo\".\n- Use word boundaries (\\b) to match whole words only\n- Searches file content and filenames\n- Automatically ignores binary files, hidden files, and files in .gitignore\n- Case-sensitive by default. Use -i to make it case insensitive.\n- Constrain the search to specific file types using -t <file-type>, e.g. -t ts or -t py.\n\nDo not use code_search when:\n- You already know the exact file location\n- You want to load the contents of files (use find_files instead)\n- You're inside an <write_file> block\n\n## Think deeply\n\nWhen the user asks you to create a plan, use the think_deeply tool. This tool leverages deep reasoning capabilities to break down difficult problems into clear implementation steps.\n\nDo not use this tool more than once in a conversation.\n\nUse cases:\n1. Planning new features\n2. Planning refactoring operations\n3. Making architectural decisions\n4. Breaking down difficult problems into steps\n5. When you seem to be stuck and need to get unstuck\n\nBest practices:\n- Use for complex changes that need careful planning\n- Don't use for simple changes or quick decisions\n\nIt's a good idea to ask the user to suggest modifications to the plan, which you can make, or if they want to proceed with the current plan.\n\n## Running terminal commands\n\nYou can write out <tool_call name=\"run_terminal_command\">[YOUR COMMAND HERE]${closeXml('tool_call')}')} to execute shell commands in the user's terminal.\n\nPurpose: Better fulfill the user request by running terminal commands in the user's terminal and reading the standard output.\n\nWarning: Use this tool sparingly. You should only use it when you are sure it is the best way to accomplish the user's request. Do not run more commands than the user has asked for. Especially be careful with commands that could have permanent effects.\n\nIf you just want to show the user a terminal command without immediately running it, you can write out a markdown \\`\\`\\` command block instead:\n\\`\\`\\`bash\n# ... command to show the user ...\n\\`\\`\\`\n\nStick to these use cases:\n1. Compiling the project or running build (e.g., \"npm run build\"). Reading the output can help you edit code to fix build errors. If possible, use an option that performs checks but doesn't emit files, e.g. \\`tsc --noEmit\\`.\n2. Running tests (e.g., \"npm test\"). Reading the output can help you edit code to fix failing tests. Or, you could write new unit tests and then run them.\n3. Moving, renaming, or deleting files and directories. These actions can be vital for refactoring requests. Use commands like \\`mv\\`/\\`move\\` or \\`rm\\`/\\`del\\`.\n\nMost likely, you should ask for permission for any other type of command you want to run. If asking for permission, show the user the command you want to run using \\`\\`\\` tags.\n\nWhen using this tool, please adhere to the following rules:\n\n1. Do not run commands that can modify files outside of the project directory, install packages globally, install virtual environments, or have significant side effects outside of the project directory, unless you have explicit permission from the user. Treat anything outside of the project directory as read-only.\n2. Do not run \\`git push\\` because it can break production (!) if the user was not expecting it. Don't run \\`git commit\\`, \\`git rebase\\`, or related commands unless you get explicit permission. If a user asks to commit changes, you can do so, but you should not invoke any further git commands beyond the git commit command.\n3. Do not run scripts without asking. Especially don't run scripts that could run against the production environment or have permanent effects without explicit permission from the user. Don't run scripts with side effects without permission from the user unless they don't have much effect or are simple.\n4. Be careful with any command that has big or irreversible effects. Anything that touches a production environment, servers, the database, or other systems that could be affected by a command should be run with explicit permission from the user.\n4. Don't run too many commands in a row without pausing to check in with what the user wants to do next.\n5. Don't run long-running commands, e.g. \\`npm run dev\\` or \\`npm start\\`, that start a server and do not exit. Only run commands that will complete within 30 seconds, because longer commands will be killed. Instead, ask the user to manually run long-running commands.\n6. Do not use the run_terminal_command tool to create or edit files. Do not use \\`cat\\` or \\`echo\\` to create or edit files. You should instead write out <write_file> blocks for for editing or creating files as detailed above in the <editing_instructions> block.\n7. Do not install packages without asking, unless it is within a small, new-ish project. Users working on a larger project will want to manage packages themselves, so ask first.\n8. Do not use the wrong package manager for the project. For example, if the project uses \\`pnpm\\` or \\`bun\\` or \\`yarn\\`, you should not use \\`npm\\`. Similarly not everyone uses \\`pip\\` for python, etc.\n\nNotes:\n- The current working directory will always reset to project root directory for each command you run. You can only access files within this directory (or sub-directories).\n- Commands can succeed without giving any output, e.g. if no type errors were found. So you may not always see output for successful executions.\n\n## Web scraping\n\nScrape any url that could help address the user's request.\n\nYou will receive the content transformed into a simplified markdown file that contains the main content of the page.\n\nUse this tool to:\n- Read the content of documentation pages\n- Read the content of other web pages that are helpful to the user's request\n\n## Browser Action\n\nLoad and view web pages to test functionality, diagnose issues, or improve visual design of a user's web app.\n\nPurpose: Use this tool to navigate to a web page, take screenshots, and check the output of console.log or errors.\n\nIMPORTANT: Assume the user's development server is ALREADY running and active, unless you see logs indicating otherwise. Never start the user's development server for them. Instead, give them instructions to spin it up themselves in a new terminal.\nNever offer to interact with the website aside from reading them (see available actions below). The user will manipulate the website themselves and bring you to the UI they want you to interact with.\n\n### Critical Limitations\n- IMPORTANT: NO clicking on any elements, don't even try.\n- NO form submissions\n- NO button interactions\n- NO drag and drop\n- NO hover actions\n\n### Available Actions (Read Only):\n\n1. Navigate:\n   - Load a new URL in the current browser window and get the logs after page load.\n   - Required: <url>, <type>navigate${closeXml('type')}')}\n   - Optional: <waitUntil> ('load', 'domcontentloaded', 'networkidle0')\n   - example: <tool_call name=\"browser_action\"><type>navigate${closeXml('type')}')}<url>localhost:3000${closeXml('url')}')}<waitUntil>domcontentloaded${closeXml('waitUntil')}')}${closeXml('tool_call')}')}\n\n2. Scroll:\n   - Scroll the page up or down by one viewport height\n   - Required: <direction> ('up', 'down'), <type>scroll${closeXml('type')}')}\n   - example: <tool_call name=\"browser_action\"><type>scroll${closeXml('type')}')}<direction>down${closeXml('direction')}')}${closeXml('tool_call')}')}\n\n3. Screenshot:\n   - Capture the current page state\n   - Required: <type>screenshot${closeXml('type')}')}\n   - Optional: <quality>, <maxScreenshotWidth>, <maxScreenshotHeight>, <screenshotCompression>, <screenshotCompressionQuality>, <compressScreenshotData>\n   - example: <tool_call name=\"browser_action\"><type>screenshot${closeXml('type')}')}<quality>80${closeXml('quality')}')}${closeXml('tool_call')}')}\n\nIMPORTANT: make absolutely totally sure that you're using the XML tags as shown in the examples. Don't use JSON or any other formatting, only XML tags.\n\n### Response Analysis\n\nAfter each action, you'll receive:\n1. Success/failure status\n2. New console logs since last action\n3. Network requests and responses\n4. JavaScript errors with stack traces\n6. Screenshot of the website\n\nUse this data to:\n- Verify expected behavior\n- Debug issues\n- Guide next actions\n- Make informed decisions about fixes\n- Improve visual design\n\n### Best Practices\n\n**Workflow**\n- Navigate to the user's website, probably on localhost, but you can compare with the production site if you want.\n- Scroll to the relevant section\n- Take screenshots and analyze confirm changes\n- Check network requests for anomalies\n\n**Debugging Flow**\n- Start with minimal reproduction steps\n- Collect data at each step\n- Analyze results before next action\n- Take screenshots to track your changes after each UI change you make\n`.trim()\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/main-prompt.ts",
              "content": "import { renderToolResults } from '@levelcode/common/tools/utils'\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\nimport { uniq } from 'lodash'\n\nimport { checkTerminalCommand } from './check-terminal-command'\nimport { loopAgentSteps } from './run-agent-step'\nimport { getAgentTemplate } from './templates/agent-registry'\nimport { logger } from './util/logger'\nimport { expireMessages } from './util/messages'\nimport { requestToolCall } from './websockets/websocket-action'\n\nimport type { AgentTemplate } from './templates/types'\nimport type { ClientToolCall } from './tools/constants'\nimport type { ClientAction } from '@levelcode/common/actions'\nimport type { CostMode } from '@levelcode/common/constants'\nimport type { PrintModeEvent } from '@levelcode/common/types/print-mode'\nimport type {\n  SessionState,\n  ToolResult,\n  AgentTemplateType,\n} from '@levelcode/common/types/session-state'\nimport type { WebSocket } from 'ws'\n\nexport interface MainPromptOptions {\n  userId: string | undefined\n  clientSessionId: string\n  onResponseChunk: (chunk: string | PrintModeEvent) => void\n  localAgentTemplates: Record<string, AgentTemplate>\n}\n\nexport const mainPrompt = async (\n  ws: WebSocket,\n  action: ClientAction<'prompt'>,\n  options: MainPromptOptions,\n): Promise<{\n  sessionState: SessionState\n  toolCalls: Array<ClientToolCall>\n  toolResults: Array<ToolResult>\n}> => {\n  const { userId, clientSessionId, onResponseChunk, localAgentTemplates } =\n    options\n\n  const {\n    prompt,\n    sessionState: sessionState,\n    fingerprintId,\n    costMode,\n    promptId,\n    agentId,\n    promptParams,\n  } = action\n  const { fileContext, mainAgentState } = sessionState\n\n  if (prompt) {\n    // Check if this is a direct terminal command\n    const startTime = Date.now()\n    const terminalCommand = await checkTerminalCommand(prompt, {\n      clientSessionId,\n      fingerprintId,\n      userInputId: promptId,\n      userId,\n    })\n    const duration = Date.now() - startTime\n\n    if (terminalCommand) {\n      logger.debug(\n        {\n          duration,\n          prompt,\n        },\n        `Detected terminal command in ${duration}ms, executing directly: ${prompt}`,\n      )\n\n      const response = await requestToolCall(\n        ws,\n        promptId,\n        'run_terminal_command',\n        {\n          command: terminalCommand,\n          mode: 'user',\n          process_type: 'SYNC',\n          timeout_seconds: -1,\n        },\n      )\n\n      const toolResult = response.success ? response.result : response.error\n      if (response.success) {\n        mainAgentState.messageHistory.push({\n          role: 'user',\n          content: renderToolResults([toolResult]),\n        })\n      }\n\n      const newSessionState = {\n        ...sessionState,\n        messageHistory: expireMessages(\n          mainAgentState.messageHistory,\n          'userPrompt',\n        ),\n      }\n\n      return {\n        sessionState: newSessionState,\n        toolCalls: [],\n        toolResults: [],\n      }\n    }\n  }\n\n  const availableAgents = Object.keys(localAgentTemplates)\n\n  // Determine agent type - prioritize CLI agent selection, then config base agent, then cost mode\n  let agentType: AgentTemplateType\n\n  if (agentId) {\n    if (!(await getAgentTemplate(agentId, localAgentTemplates))) {\n      throw new Error(\n        `Invalid agent ID: \"${agentId}\". Available agents: ${availableAgents.join(', ')}`,\n      )\n    }\n\n    agentType = agentId\n    logger.info(\n      {\n        agentId,\n        promptParams,\n        prompt: prompt?.slice(0, 50),\n      },\n      `Using CLI-specified agent: ${agentId}`,\n    )\n  } else {\n    // Check for base agent in config\n    const configBaseAgent = fileContext.levelcodeConfig?.baseAgent\n    if (configBaseAgent) {\n      if (!(await getAgentTemplate(configBaseAgent, localAgentTemplates))) {\n        throw new Error(\n          `Invalid base agent in config: \"${configBaseAgent}\". Available agents: ${availableAgents.join(', ')}`,\n        )\n      }\n      agentType = configBaseAgent\n      logger.info(\n        {\n          configBaseAgent,\n          promptParams,\n          prompt: prompt?.slice(0, 50),\n        },\n        `Using config-specified base agent: ${configBaseAgent}`,\n      )\n    } else {\n      // Fall back to cost mode mapping\n      agentType = (\n        {\n          ask: AgentTemplateTypes.ask,\n          lite: AgentTemplateTypes.base_lite,\n          normal: AgentTemplateTypes.base,\n          max: AgentTemplateTypes.base_max,\n          experimental: AgentTemplateTypes.base_experimental,\n        } satisfies Record<CostMode, AgentTemplateType>\n      )[costMode]\n    }\n  }\n\n  mainAgentState.agentType = agentType\n\n  let mainAgentTemplate = await getAgentTemplate(agentType, localAgentTemplates)\n  if (!mainAgentTemplate) {\n    throw new Error(`Agent template not found for type: ${agentType}`)\n  }\n\n  let updatedSubagents = mainAgentTemplate.spawnableAgents\n  if (!agentId) {\n    // If --agent is not specified, use the spawnableAgents from the levelcode config or add all local agents\n    updatedSubagents =\n      fileContext.levelcodeConfig?.spawnableAgents ??\n      uniq([...mainAgentTemplate.spawnableAgents, ...availableAgents])\n  }\n  mainAgentTemplate.spawnableAgents = updatedSubagents\n  localAgentTemplates[agentType] = mainAgentTemplate\n\n  const { agentState } = await loopAgentSteps(ws, {\n    userInputId: promptId,\n    prompt,\n    params: promptParams,\n    agentType,\n    agentState: mainAgentState,\n    fingerprintId,\n    fileContext,\n    toolResults: [],\n    userId,\n    clientSessionId,\n    onResponseChunk,\n    localAgentTemplates,\n  })\n\n  return {\n    sessionState: {\n      fileContext,\n      mainAgentState: agentState,\n    },\n    toolCalls: [],\n    toolResults: [],\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "npm-app/src/agents/load-agents.ts",
              "content": "import * as fs from 'fs'\nimport * as path from 'path'\n\nimport { cyan, green } from 'picocolors'\n\nimport { getAllTsFiles, getAgentsDirectory } from './agent-utils'\n\nimport type { LevelCodeConfig } from '@levelcode/common/json-config/constants'\n\nexport let loadedAgents: Record<string, any> = {}\nexport async function loadLocalAgents({\n  verbose = false,\n}: {\n  verbose?: boolean\n}): Promise<typeof loadedAgents> {\n  loadedAgents = {}\n\n  const agentsDir = getAgentsDirectory()\n\n  if (!fs.existsSync(agentsDir)) {\n    return loadedAgents\n  }\n\n  try {\n    const tsFiles = getAllTsFiles(agentsDir)\n\n    for (const fullPath of tsFiles) {\n      const relativePath = path.relative(agentsDir, fullPath)\n      const fileName = relativePath.replace(/\\.ts$/, '').replace(/[/\\\\]/g, '-')\n\n      let agentDefinition: any\n      let agentModule: any\n      try {\n        agentModule = await require(fullPath)\n      } catch (error: any) {\n        if (verbose) {\n          console.error('Error importing agent:', error)\n        }\n        continue\n      }\n      delete require.cache[fullPath]\n\n      try {\n        agentDefinition = agentModule.default\n      } catch (error: any) {\n        console.error('Error loading agent from file:', fullPath, error)\n        continue\n      }\n\n      if (!agentDefinition) continue\n\n      // Convert handleSteps function to string if present\n      let processedAgentDefinition = { ...agentDefinition }\n\n      if (agentDefinition.handleSteps) {\n        processedAgentDefinition.handleSteps =\n          agentDefinition.handleSteps.toString()\n      }\n\n      loadedAgents[fileName] = processedAgentDefinition\n    }\n  } catch (error) {}\n  return loadedAgents\n}\n\nexport function getLoadedAgentNames(): Record<string, string> {\n  return Object.fromEntries(\n    Object.entries(loadedAgents).map(([agentType, agentConfig]) => {\n      return [agentType, agentConfig.displayName]\n    }),\n  )\n}\n\n/**\n * Display loaded agents to the user\n */\nexport function displayLoadedAgents(levelcodeConfig: LevelCodeConfig) {\n  const baseAgent = levelcodeConfig.baseAgent\n  if (baseAgent) {\n    console.log(`\\n${green('Configured base agent:')} ${cyan(baseAgent)}`)\n  }\n\n  const spawnableAgents = levelcodeConfig.spawnableAgents\n  if (spawnableAgents) {\n    console.log(\n      `${green('Configured spawnable agents:')} ${spawnableAgents\n        .map((name) => cyan(name))\n        .join(', ')}\\n`,\n    )\n  } else if (Object.keys(loadedAgents).length > 0) {\n    const loadedAgentNames = Object.values(getLoadedAgentNames())\n    console.log(\n      `\\n${green('Found custom agents:')} ${loadedAgentNames\n        .map((name) => cyan(name))\n        .join(', ')}\\n`,\n    )\n  } else if (baseAgent) {\n    // One more new line.\n    console.log()\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "npm-app/src/cli-handlers/agents.ts",
              "content": "import * as fs from 'fs'\nimport * as path from 'path'\n\nimport { AGENT_TEMPLATES_DIR } from '@levelcode/common/constants'\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\nimport {\n  filterCustomAgentFiles,\n  extractAgentIdFromFileName,\n} from '@levelcode/common/util/agent-file-utils'\nimport { green, yellow, cyan, magenta, bold, gray, red } from 'picocolors'\n\nimport { loadLocalAgents, getLoadedAgentNames } from '../agents/load-agents'\nimport { CLI } from '../cli'\nimport { getProjectRoot } from '../project-files'\nimport { Spinner } from '../utils/spinner'\nimport {\n  ENTER_ALT_BUFFER,\n  EXIT_ALT_BUFFER,\n  CLEAR_SCREEN,\n  HIDE_CURSOR,\n  SHOW_CURSOR,\n} from '../utils/terminal'\n\nlet isInAgentsBuffer = false\nlet originalKeyHandlers: ((str: string, key: any) => void)[] = []\nlet selectedIndex = 0\nlet scrollOffset = 0\nlet allContentLines: string[] = []\nlet agentLinePositions: number[] = []\nlet agentList: Array<{\n  id: string\n  name: string\n  description?: string\n  isBuiltIn: boolean\n  filePath?: string\n  isCreateNew?: boolean\n  isEditAgent?: boolean\n  isSeparator?: boolean\n  isPlaceholder?: boolean\n  isSectionHeader?: boolean\n}> = []\n\nexport function isInAgentsMode(): boolean {\n  return isInAgentsBuffer\n}\n\nexport async function enterAgentsBuffer(rl: any, onExit: () => void) {\n  if (isInAgentsBuffer) {\n    console.log(yellow('Already in agents mode!'))\n    return\n  }\n\n  // Load local agents\n  await loadLocalAgents({ verbose: false })\n  const localAgents = getLoadedAgentNames()\n\n  // Build management actions section with header\n  const actions: typeof agentList = [\n    {\n      id: '__header__',\n      name: bold(cyan('Actions')),\n      description: '',\n      isBuiltIn: false,\n      isSectionHeader: true,\n    },\n    {\n      id: '__create_new__',\n      name: '+ Create New Agent',\n      description: 'Create a new custom agent template',\n      isBuiltIn: false,\n      isCreateNew: true,\n    },\n  ]\n\n  // Get custom agent files for display purposes\n  const agentsDir = path.join(getProjectRoot(), AGENT_TEMPLATES_DIR)\n  let customAgentFiles: string[] = []\n  if (fs.existsSync(agentsDir)) {\n    const files = fs.readdirSync(agentsDir)\n    customAgentFiles = filterCustomAgentFiles(files)\n  }\n\n  // Add agents section header\n  actions.push({\n    id: '__agents_header__',\n    name:\n      bold(cyan('Custom Agents')) +\n      gray(`  ${customAgentFiles.length} in ${AGENT_TEMPLATES_DIR}`),\n    description: '',\n    isBuiltIn: false,\n    isSectionHeader: true,\n  })\n\n  // Build agent list starting with management actions\n  agentList = [...actions]\n\n  // Add custom agents from .agents/templates\n  if (customAgentFiles.length > 0) {\n    for (const file of customAgentFiles) {\n      const agentId = extractAgentIdFromFileName(file)\n      const agentName = localAgents[agentId] || agentId\n      agentList.push({\n        id: agentId,\n        name: agentName,\n        description: 'Custom user-defined agent',\n        isBuiltIn: false,\n        filePath: path.join(agentsDir, file),\n      })\n    }\n  } else {\n    // If no custom agents, add a helpful message\n    agentList.push({\n      id: '__no_agents__',\n      name: gray('No custom agents found'),\n      description: 'Use \"Create New Agent\" above to get started',\n      isBuiltIn: false,\n      isPlaceholder: true,\n    })\n  }\n\n  // No need for special handling here since we now have a proper placeholder\n\n  // Initialize selection to first selectable item\n  selectedIndex = 0\n  // Find first selectable item (skip section headers, separators, placeholders)\n  while (\n    selectedIndex < agentList.length &&\n    (agentList[selectedIndex]?.isSectionHeader ||\n      agentList[selectedIndex]?.isSeparator ||\n      agentList[selectedIndex]?.isPlaceholder)\n  ) {\n    selectedIndex++\n  }\n  // If no selectable items found, default to 0\n  if (selectedIndex >= agentList.length) {\n    selectedIndex = 0\n  }\n  scrollOffset = 0\n\n  // Enter alternate screen buffer\n  process.stdout.write(ENTER_ALT_BUFFER)\n  process.stdout.write(CLEAR_SCREEN)\n  process.stdout.write(HIDE_CURSOR)\n\n  isInAgentsBuffer = true\n\n  // Build content and render\n  buildAllContentLines()\n  centerSelectedItem()\n  renderAgentsList()\n\n  // Set up key handler\n  setupAgentsKeyHandler(rl, onExit)\n}\n\nexport function exitAgentsBuffer(rl: any) {\n  if (!isInAgentsBuffer) {\n    return\n  }\n\n  // Reset state\n  selectedIndex = 0\n  scrollOffset = 0\n  allContentLines = []\n  agentLinePositions = []\n  agentList = []\n\n  // Restore all original key handlers\n  if (originalKeyHandlers.length > 0) {\n    process.stdin.removeAllListeners('keypress')\n    originalKeyHandlers.forEach((handler) => {\n      process.stdin.on('keypress', handler)\n    })\n    originalKeyHandlers = []\n  }\n\n  // Exit alternate screen buffer\n  process.stdout.write(SHOW_CURSOR)\n  process.stdout.write(EXIT_ALT_BUFFER)\n\n  isInAgentsBuffer = false\n}\n\nfunction centerSelectedItem() {\n  if (selectedIndex < 0 || selectedIndex >= agentLinePositions.length) {\n    return\n  }\n\n  const terminalHeight = process.stdout.rows || 24\n  const terminalWidth = process.stdout.columns || 80\n  const headerHeight = getHeaderLines(terminalWidth).length\n  const maxScrollableLines = terminalHeight - headerHeight - 2\n  const selectedLineIndex = agentLinePositions[selectedIndex]\n  const maxScrollOffset = Math.max(\n    0,\n    allContentLines.length - maxScrollableLines,\n  )\n\n  // Center item in the scrollable viewport\n  const centerOffset = selectedLineIndex - Math.floor(maxScrollableLines / 2)\n  scrollOffset = Math.max(0, Math.min(maxScrollOffset, centerOffset))\n}\n\nconst getHeaderLines = (terminalWidth: number) => [\n  // No header - sections will be labeled inline\n]\n\nfunction buildAllContentLines() {\n  const terminalWidth = process.stdout.columns || 80\n  const lines: string[] = []\n  agentLinePositions = []\n\n  if (agentList.length === 0) {\n    lines.push(yellow('No agents found.'))\n  } else {\n    for (let i = 0; i < agentList.length; i++) {\n      agentLinePositions.push(lines.length)\n      const agent = agentList[i]\n      const isSelected = i === selectedIndex\n\n      // Handle section headers\n      if (agent.isSectionHeader) {\n        const cleanName = agent.name.replace(/\\u001b\\[[0-9;]*m/g, '')\n        const cleanDescription = agent.description\n          ? agent.description.replace(/\\u001b\\[[0-9;]*m/g, '')\n          : ''\n        const availableWidth = terminalWidth - 4 // Account for padding\n\n        if (isSelected) {\n          const headerWidth = Math.min(terminalWidth - 6, 60)\n          lines.push(`  ${cyan('' + ''.repeat(headerWidth + 2) + '')}`)\n\n          // Right-aligned title with separator line\n          const titlePadding = Math.max(0, headerWidth - cleanName.length - 4)\n          const separatorLine = ''.repeat(titlePadding)\n          lines.push(\n            `  ${cyan('')} ${gray(separatorLine)}  ${agent.name} ${cyan('')}`,\n          )\n\n          if (agent.description) {\n            const descPadding = Math.max(\n              0,\n              headerWidth - cleanDescription.length,\n            )\n            lines.push(\n              `  ${cyan('')} ${agent.description}${' '.repeat(descPadding)} ${cyan('')}`,\n            )\n          }\n          lines.push(`  ${cyan('' + ''.repeat(headerWidth + 2) + '')}`)\n        } else {\n          // Right-aligned title with separator line for unselected\n          const titlePadding = Math.max(\n            0,\n            availableWidth - cleanName.length - 4,\n          )\n          const separatorLine = gray(''.repeat(titlePadding))\n          lines.push(`  ${separatorLine}  ${agent.name}`)\n\n          if (agent.description) {\n            lines.push(`  ${agent.description}`)\n          }\n        }\n        if (i < agentList.length - 1) {\n          lines.push('') // Empty line after section header\n        }\n        continue\n      }\n\n      // Handle separator (keep for backwards compatibility)\n      if (agent.isSeparator) {\n        if (isSelected) {\n          lines.push(`  ${cyan('' + ''.repeat(52) + '')}`)\n          lines.push(`  ${cyan('')} ${gray(agent.name)} ${cyan('')}`)\n          lines.push(`  ${cyan('' + ''.repeat(52) + '')}`)\n        } else {\n          lines.push(`    ${gray(agent.name)}`)\n        }\n        if (i < agentList.length - 1) {\n          lines.push('') // Empty line after separator\n        }\n        continue\n      }\n\n      // Handle placeholder\n      if (agent.isPlaceholder) {\n        if (isSelected) {\n          const boxWidth = Math.min(terminalWidth - 6, 50)\n          lines.push(`  ${cyan('' + ''.repeat(boxWidth + 2) + '')}`)\n          lines.push(\n            `  ${cyan('')} ${agent.name} ${' '.repeat(Math.max(0, boxWidth - agent.name.replace(/\\u001b\\[[0-9;]*m/g, '').length))} ${cyan('')}`,\n          )\n          lines.push(\n            `  ${cyan('')} ${gray(agent.description || '')} ${' '.repeat(Math.max(0, boxWidth - (agent.description || '').length))} ${cyan('')}`,\n          )\n          lines.push(`  ${cyan('' + ''.repeat(boxWidth + 2) + '')}`)\n        } else {\n          lines.push(`    ${agent.name}`)\n          lines.push(`    ${gray(agent.description || '')}`)\n        }\n        if (i < agentList.length - 1) {\n          lines.push('') // Empty line between items\n        }\n        continue\n      }\n\n      // Regular agent items\n      const agentInfo =\n        agent.isCreateNew || agent.isEditAgent\n          ? `${agent.isCreateNew ? green(agent.name) : magenta(agent.name)}`\n          : `${bold(agent.name)} ${gray(`(${agent.id})`)}`\n      const description = agent.description || 'No description'\n      const filePath = agent.filePath\n        ? gray(`File: ${path.relative(getProjectRoot(), agent.filePath)}`)\n        : ''\n\n      const contentForBox = [\n        agentInfo,\n        gray(description),\n        ...(filePath ? [filePath] : []),\n      ]\n\n      if (isSelected) {\n        // Calculate box width based on content\n        const maxContentWidth = Math.max(\n          ...contentForBox.map(\n            (line) => line.replace(/\\u001b\\[[0-9;]*m/g, '').length,\n          ),\n        )\n        const boxWidth = Math.min(terminalWidth - 6, maxContentWidth)\n\n        // Add top border\n        lines.push(`  ${cyan('' + ''.repeat(boxWidth + 2) + '')}`)\n\n        // Add content lines with proper padding - keep same indentation as unselected\n        contentForBox.forEach((line) => {\n          const cleanLine = line.replace(/\\u001b\\[[0-9;]*m/g, '')\n          const padding = ' '.repeat(Math.max(0, boxWidth - cleanLine.length))\n          lines.push(`  ${cyan('')} ${line}${padding} ${cyan('')}`)\n        })\n\n        // Add bottom border\n        lines.push(`  ${cyan('' + ''.repeat(boxWidth + 2) + '')}`)\n      } else {\n        // Non-selected items - use same base indentation as selected content\n        lines.push(`    ${agentInfo}`) // 4 spaces to match selected content position\n        lines.push(`    ${gray(description)}`)\n        if (filePath) {\n          lines.push(`    ${filePath}`)\n        }\n      }\n\n      if (i < agentList.length - 1) {\n        lines.push('') // Empty line between items\n      }\n    }\n  }\n\n  allContentLines = lines\n}\n\nfunction renderAgentsList() {\n  // Build all content if not already built\n  buildAllContentLines()\n\n  // Clear screen and move cursor to top\n  process.stdout.write(CLEAR_SCREEN)\n\n  const terminalHeight = process.stdout.rows || 24\n  const terminalWidth = process.stdout.columns || 80\n\n  // Render fixed header\n  const headerLines = getHeaderLines(terminalWidth)\n  process.stdout.write(headerLines.join('\\n'))\n  process.stdout.write('\\n')\n\n  // Render scrollable content\n  const maxScrollableLines = terminalHeight - headerLines.length - 2\n  const visibleLines = allContentLines.slice(\n    scrollOffset,\n    scrollOffset + maxScrollableLines,\n  )\n\n  // Display scrollable content\n  process.stdout.write(visibleLines.join('\\n'))\n\n  // Add padding to fill remaining space\n  const remainingLines = maxScrollableLines - visibleLines.length\n  if (remainingLines > 0) {\n    process.stdout.write('\\n'.repeat(remainingLines))\n  }\n\n  // Display status line at bottom\n  const statusLine = `\\n${gray(`Use //j/k to navigate, Enter to select, ESC to go back`)}`\n\n  process.stdout.write(statusLine)\n  process.stdout.write(HIDE_CURSOR)\n}\n\nfunction setupAgentsKeyHandler(rl: any, onExit: () => void) {\n  // Store all original key handlers\n  const listeners = process.stdin.listeners('keypress')\n  originalKeyHandlers = listeners as ((str: string, key: any) => void)[]\n\n  // Remove existing keypress listeners\n  process.stdin.removeAllListeners('keypress')\n\n  // Add our custom handler\n  process.stdin.on('keypress', (str: string, key: any) => {\n    if (key && key.name === 'escape') {\n      exitAgentsBuffer(rl)\n      onExit()\n      return\n    }\n\n    // Handle Ctrl+C - exit to main screen\n    if (key && key.ctrl && key.name === 'c') {\n      exitAgentsBuffer(rl)\n      onExit()\n      return\n    }\n\n    // Handle Enter - switch to selected agent, create new, or edit\n    if (key && key.name === 'return') {\n      if (agentList.length > 0 && selectedIndex < agentList.length) {\n        const selectedAgent = agentList[selectedIndex]\n\n        // Skip separators, placeholders, and section headers\n        if (\n          selectedAgent.isSeparator ||\n          selectedAgent.isPlaceholder ||\n          selectedAgent.isSectionHeader\n        ) {\n          return\n        }\n\n        if (selectedAgent.isCreateNew) {\n          exitAgentsBuffer(rl)\n          startDirectAgentCreation(onExit)\n        } else {\n          exitAgentsBuffer(rl)\n          // Start spinner for agent switching\n          Spinner.get().start(`Switching to agent: ${selectedAgent.name}...`)\n\n          // Use resetAgent to switch to the selected agent\n          const cliInstance = CLI.getInstance()\n          cliInstance\n            .resetAgent(selectedAgent.id)\n            .then(() => {\n              cliInstance.freshPrompt()\n            })\n            .catch((error) => {\n              Spinner.get().stop()\n              console.error(red('Error switching to agent:'), error)\n              onExit()\n            })\n        }\n      }\n      return\n    }\n\n    // Handle navigation - skip separators, placeholders, and section headers\n    if (key && (key.name === 'up' || key.name === 'k')) {\n      let newIndex = selectedIndex - 1\n      while (\n        newIndex >= 0 &&\n        (agentList[newIndex]?.isSeparator ||\n          agentList[newIndex]?.isPlaceholder ||\n          agentList[newIndex]?.isSectionHeader)\n      ) {\n        newIndex--\n      }\n      if (newIndex >= 0) {\n        selectedIndex = newIndex\n        centerSelectedItem()\n      }\n\n      renderAgentsList()\n      return\n    }\n    if (key && (key.name === 'down' || key.name === 'j')) {\n      let newIndex = selectedIndex + 1\n      while (\n        newIndex < agentList.length &&\n        (agentList[newIndex]?.isSeparator ||\n          agentList[newIndex]?.isPlaceholder ||\n          agentList[newIndex]?.isSectionHeader)\n      ) {\n        newIndex++\n      }\n      if (newIndex < agentList.length) {\n        selectedIndex = newIndex\n        centerSelectedItem()\n        renderAgentsList()\n      }\n      return\n    }\n\n    if (key && key.name === 'pageup') {\n      const newIndex = Math.max(0, selectedIndex - 5)\n      if (newIndex !== selectedIndex) {\n        selectedIndex = newIndex\n        centerSelectedItem()\n        renderAgentsList()\n      }\n      return\n    }\n\n    if (key && key.name === 'pagedown') {\n      const newIndex = Math.min(agentList.length - 1, selectedIndex + 5)\n      if (newIndex !== selectedIndex) {\n        selectedIndex = newIndex\n        centerSelectedItem()\n        renderAgentsList()\n      }\n      return\n    }\n\n    if (key && key.name === 'home') {\n      if (selectedIndex !== 0) {\n        selectedIndex = 0\n        centerSelectedItem()\n        renderAgentsList()\n      }\n      return\n    }\n\n    if (key && key.name === 'end') {\n      if (selectedIndex !== agentList.length - 1) {\n        selectedIndex = agentList.length - 1\n        centerSelectedItem()\n        renderAgentsList()\n      }\n      return\n    }\n  })\n\n  // Ensure raw mode for immediate key detection\n  if (process.stdin.isTTY) {\n    process.stdin.setRawMode(true)\n  }\n}\n\nasync function startDirectAgentCreation(onExit: () => void) {\n  // Switch to agent-builder which automatically spawns Bob the Agent Builder for agent creation\n  const prompt = `Create a new custom agent template for me. Please ask me what kind of agent I'd like to create and help me build it.`\n\n  console.log(\n    green(\n      '\\n Starting agent creation with Buffy the Enthusiastic Agent Builder...',\n    ),\n  )\n  console.log(\n    gray(\n      'Buffy will connect you with Bob the Agent Builder to create your custom agent.',\n    ),\n  )\n\n  try {\n    const cliInstance = CLI.getInstance()\n    // Switch to agent-builder which automatically spawns the agent builder for agent creation\n    await cliInstance.resetAgent(\n      AgentTemplateTypes.agent_builder,\n      undefined,\n      prompt,\n    )\n    cliInstance.freshPrompt()\n  } catch (error) {\n    console.error(red('Error starting agent creation:'), error)\n  }\n\n  onExit()\n}\n\n// Cleanup function\nexport function cleanupAgentsBuffer() {\n  if (isInAgentsBuffer) {\n    process.stdout.write(SHOW_CURSOR)\n    process.stdout.write(EXIT_ALT_BUFFER)\n    isInAgentsBuffer = false\n  }\n\n  // Restore normal terminal mode\n  if (process.stdin.isTTY) {\n    process.stdin.setRawMode(false)\n  }\n  // Register cleanup on process exit\n  process.on('exit', cleanupAgentsBuffer)\n  process.on('SIGINT', cleanupAgentsBuffer)\n  process.on('SIGTERM', cleanupAgentsBuffer)\n}\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/base.ts",
              "content": "[FILE_DOES_NOT_EXIST]",
              "referencedBy": {}
            },
            {
              "path": "backend/src/tools/definitions/tool/spawn-agent-inline.ts",
              "content": "import { getToolCallString } from '@levelcode/common/tools/utils'\n\nimport type { ToolDescription } from '../tool-def-type'\n\nconst toolName = 'spawn_agent_inline'\nexport const spawnAgentInlineTool = {\n  toolName,\n  description: `\nSpawn a single agent that runs within the current message history. \nThe spawned agent sees all previous messages and any messages it adds \nare preserved when control returns to you.\n\nThis is useful for:\n- Delegating specific tasks while maintaining context\n- Having specialized agents process information inline\n- Managing message history (e.g., summarization)\nThe agent will run until it calls end_turn, then control returns to you. There is no tool result for this tool.\nExample:\n${getToolCallString(toolName, {\n  agent_type: 'file-picker',\n  prompt: 'Find files related to authentication',\n  params: { paths: ['src/auth.ts', 'src/user.ts'] },\n})}\n    `.trim(),\n} satisfies ToolDescription",
              "referencedBy": {}
            }
          ]
        }
      ],
      "parentAgentId": "D-OfaehVPQw"
    },
    {
      "type": "text",
      "agentId": "D-OfaehVPQw",
      "text": "Okay, here's a concise report of locations in the codebase relevant to the `file-explorer` agent:\n\n*   **`backend/src/templates/agents/file-explorer.ts`**: This file contains the core definition of the `file-explorer` agent. It defines the agent's purpose, input schema, system prompt, and the `handleSteps` function that orchestrates the agent's behavior, specifically spawning multiple `file-picker` agents.\n*   **`backend/src/tools/definitions/tool/spawn-agents.ts`**: This file defines the `spawn_agents` tool, which is used by the `file-explorer` agent to spawn the underlying `file-picker` agents.\n*   **`backend/src/tools/handlers/tool/spawn-agents.ts`**: This file contains the handler logic for the `spawn_agents` tool, which is responsible for actually creating and running the spawned agents.\n*   **`common/src/constants/agents.ts`**: This defines high-level details about the agent, including its display name and purpose.\n*   **`npm-app/src/cli-handlers/agents.ts`**: This seems like it could be helpful for understanding how agents are managed in the CLI application.\n\nThese files should give you a good understanding of the `file-explorer` agent's definition and target.\n"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-OfaehVPQw",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "prompt": "file-explorer agent definition and spawn target"
      }
    },
    {
      "type": "tool_result",
      "toolCallId": "D-Oe9G8zl9M",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentType": "read_subtree",
              "agentName": "read_subtree",
              "value": {
                "errorMessage": "Error spawning agent: Error: Agent type read_subtree not found."
              }
            },
            {
              "agentType": "read_subtree",
              "agentName": "read_subtree",
              "value": {
                "errorMessage": "Error spawning agent: Error: Agent type read_subtree not found."
              }
            },
            {
              "agentName": "Fletcher the File Fetcher",
              "agentType": "file-picker",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "Here's a short report of the locations in the codebase that could be helpful, focusing on the most relevant files:\n\n*   **`backend/src/templates/agents/agent-builder.ts`**: This file contains the `agentBuilder` function, which is responsible for creating new agent templates. It reads agent template types, tool definitions, and example agent files, providing a good starting point for understanding the agent creation process.\n*   **`backend/src/templates/agent-registry.ts`**: This file manages the agent registry, fetching agents from the database and assembling local agent templates. It is useful for understanding how agents are stored and retrieved.\n*   **`npm-app/src/cli-handlers/agent-creation-chat.ts`**: This file contains the `startAgentCreationChat` function, which guides users through the agent creation process via a CLI chat interface. It showcases how agent requirements are collected and used to create agent templates.\n*   **`web/src/content/agents/creating-new-agents.mdx`**: This file provides documentation on creating new agents, including examples and best practices. It offers insights into the structure and required fields of agent templates.\n*   **`common/src/types/dynamic-agent-template.ts`**: This file defines the schema for dynamic agent templates, outlining the structure and properties of custom LevelCode agents.\n"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "agentName": "Fletcher the File Fetcher",
              "agentType": "file-picker",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "Here's a concise report on diff-reviewer agent examples and configurations:\n\n*   `.agents/examples/diff-reviewer-1.ts`, `.agents/examples/diff-reviewer-2.ts`, `.agents/examples/diff-reviewer-3.ts`, `common/src/util/examples/diff-reviewer-1.ts`, `common/src/util/examples/diff-reviewer-2.ts`, `common/src/util/examples/diff-reviewer-3.ts`: These files provide example definitions for diff-reviewer agents at different levels (1-3), showcasing variations in input schema, tools used, and step handling.\n\n*   `backend/src/templates/agents/reviewer.ts`: This file defines the reviewer agent template, including its persona, instructions, and tool usage, focusing on providing feedback on code changes.\n\n*   `backend/src/system-prompt/agent-instructions.md`: This file dictates the system prompt and instructions for the diff reviewer, shaping its behavior and emphasizing clarity, conciseness, and adherence to code style.\n\nThese files offer insights into the agent's configuration, behavior, and usage within the codebase.\n"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "agentName": "Fletcher the File Fetcher",
              "agentType": "file-picker",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "Okay, here's a concise report on the locations in the codebase that could be helpful for creating a custom agent from a starter template, or understanding the existing `git-committer` agent:\n\n*   `.agents/git-committer.ts`: This is the definition of the `git-committer` agent. It shows the structure of an agent definition, including its `id`, `inputSchema`, `systemPrompt`, `instructionsPrompt`, and `handleSteps`. Crucially it shows the tools and steps this agent uses.\n*   `backend/src/templates/agents/base.ts`: This file provides the base template for creating agents. It defines the core structure, including the input schema, output mode, and available tools.\n*   `backend/src/templates/agent-list.ts`: This file defines a list of available static agentTemplates providing a way to reference existing, simple (non-dynamic) agents.\n*   `common/src/types/agent-template.ts`: This file defines the `AgentTemplate` type, which is the structure that all agent definitions must adhere to. It specifies the required and optional properties of an agent.\n*   `npm-app/src/cli-handlers/agents.ts`: This file contains the logic for displaying and selecting agents within the CLI. You likely do not require this information.\n"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "agentName": "Fletcher the File Fetcher",
              "agentType": "file-picker",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "Here's a concise report of the locations in the codebase that define agent personalities or types:\n\n*   `.agents/brainstormer.ts`, `.agents/planner.ts`, `.agents/researcher.ts`, `.agents/reviewer.ts`, `.agents/thinker.ts`, `.agents/superagent.ts`: These files define the persona, instructions, and capabilities of different agent types. They are useful as a central location for understanding specific agent behaviors.\n*   `common/src/constants/agents.ts`: This file contains the `AGENT_PERSONAS` constant, which provides display names and purposes for different base and specialized agents. It's helpful for understanding the high-level categorization and naming of agents.\n*   `common/src/types/agent-template.ts`: This file defines the `AgentTemplate` type, which outlines the structure of agent definitions, including fields like `displayName`, `systemPrompt`, `inputSchema`, and `toolNames`.\n*   `npm-app/src/agents/load-agents.ts`: This file is responsible for loading local agent definitions, and could be useful for understanding how agents are managed.\n*   `web/src/content/agents/overview.mdx`: Documentation summarizing agent design and purpose.\n"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "agentName": "Fletcher the File Fetcher",
              "agentType": "file-picker",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "Okay, here's a concise report of locations in the codebase relevant to the `file-explorer` agent:\n\n*   **`backend/src/templates/agents/file-explorer.ts`**: This file contains the core definition of the `file-explorer` agent. It defines the agent's purpose, input schema, system prompt, and the `handleSteps` function that orchestrates the agent's behavior, specifically spawning multiple `file-picker` agents.\n*   **`backend/src/tools/definitions/tool/spawn-agents.ts`**: This file defines the `spawn_agents` tool, which is used by the `file-explorer` agent to spawn the underlying `file-picker` agents.\n*   **`backend/src/tools/handlers/tool/spawn-agents.ts`**: This file contains the handler logic for the `spawn_agents` tool, which is responsible for actually creating and running the spawned agents.\n*   **`common/src/constants/agents.ts`**: This defines high-level details about the agent, including its display name and purpose.\n*   **`npm-app/src/cli-handlers/agents.ts`**: This seems like it could be helpful for understanding how agents are managed in the CLI application.\n\nThese files should give you a good understanding of the `file-explorer` agent's definition and target.\n"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "agentName": "Code Searcher",
              "agentType": "code-searcher",
              "value": {
                "type": "structuredOutput",
                "value": {
                  "results": [
                    {
                      "stdout": ".agents/examples/diff-reviewer-1.ts:\n4:  id: 'diff-reviewer-1',\n\n.agents/examples/diff-reviewer-2.ts:\n7:  id: 'diff-reviewer-2',\n\n.agents/examples/diff-reviewer-3.ts:\n7:  id: 'diff-reviewer-3',\n\n./backend/src/templates/agents/agent-builder.ts:\n67:          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer'),\n\n./common/src/util/examples/diff-reviewer-1.ts:\n4:  id: 'diff-reviewer-1',\n\n./common/src/util/examples/diff-reviewer-2.ts:\n7:  id: 'diff-reviewer-2',\n\n./common/src/util/examples/diff-reviewer-3.ts:\n7:  id: 'diff-reviewer-3',",
                      "message": "Exit code: 0"
                    },
                    {
                      "stdout": "No results",
                      "message": "Exit code: 1"
                    },
                    {
                      "stdout": "./npm-app/src/client.ts:\n1354:        // Mark any spawnable agents as inactive when the main response completes\n\n./npm-app/src/subagent-storage.ts:\n214: * Get recent spawnable agents (sorted by last activity)\n223: * Get spawnable agents in chronological order (oldest first)\n\n./backend/knowledge.md:\n7:Users can now reference spawnable agents without org prefixes in their agent templates. For example:\n77:    spawnableAgents?: {  // Modify spawnable agents list\n\n./npm-app/src/agents/load-agents.ts:\n86:      `${green('Configured spawnable agents:')} ${spawnableAgents\n\n./npm-app/src/cli.ts:\n949:            // Give control back to user when no spawnable agents exist\n\n./backend/src/tools/definitions/tool/spawn-agents-async.ts:\n6:export const spawnAgentsAsyncTool = {\n\n./backend/src/tools/definitions/tool/spawn-agents.ts:\n6:export const spawnAgentsTool = {\n\n./backend/src/tools/definitions/list.ts:\n16:import { spawnAgentsTool } from './tool/spawn-agents'\n17:import { spawnAgentsAsyncTool } from './tool/spawn-agents-async'\n43:  spawn_agents: spawnAgentsTool,\n44:  spawn_agents_async: spawnAgentsAsyncTool,\n\n./common/src/templates/agent-validation.ts:\n199:    // Validate spawnable agents (skip if requested, e.g., for database agents)\n\n./web/src/app/api/agents/publish/route.ts:\n222:    // Verify that all spawnable agents are either published or part of this request\n\n./common/src/__tests__/agent-validation.test.ts:\n116:    test.skip('should validate spawnable agents', async () => {\n141:        'Invalid spawnable agents: nonexistent_agent',\n274:    it('should validate spawnable agents including dynamic agents from first pass', async () => {\n287:            spawnableAgents: [], // No spawnable agents\n\n./common/src/__tests__/dynamic-agent-template-schema.test.ts:\n336:        const spawnAgentsError = result.error.issues.find((issue) =>\n341:        expect(spawnAgentsError).toBeDefined()\n342:        expect(spawnAgentsError?.message).toContain(\n\n./web/src/content/agents/troubleshooting-agent-customization.mdx:\n204:2. Limit spawnable agents:\n\n./common/src/util/agent-name-normalization.ts:\n6: * 2. Try with DEFAULT_ORG_PREFIX for spawnable agents\n10: * and handles the common case where users reference spawnable agents\n27:  // Try with DEFAULT_ORG_PREFIX for spawnable agents\n\n./common/src/tools/list.ts:\n14:import { spawnAgentsParams } from './params/tool/spawn-agents'\n15:import { spawnAgentsAsyncParams } from './params/tool/spawn-agents-async'\n39:  spawn_agents: spawnAgentsParams,\n40:  spawn_agents_async: spawnAgentsAsyncParams,\n\n./common/src/types/dynamic-agent-template.ts:\n98:  // Tools and spawnable agents\n\n./common/src/json-config/constants.ts:\n91:      .describe('Specify complete list of spawnable agents for the base agent'),\n\n./common/src/util/agent-template-validation.ts:\n9: * Centralized validation for spawnable agents.\n10: * Validates that all spawnable agents reference valid agent types.\n35: * Formats a validation error message for spawnable agents\n41:  let message = `Invalid spawnable agents: ${invalidAgents.join(', ')}. Double check the id, including the org prefix if applicable.`\n\n./common/src/json-config/__tests__/__snapshots__/stringify-schema.test.ts.snap:\n85:  // (optional): Specify complete list of spawnable agents for the base agent\n\n./common/src/tools/params/tool/spawn-agents.ts:\n7:export const spawnAgentsParams = {\n\n./common/src/tools/params/tool/spawn-agents-async.ts:\n7:export const spawnAgentsAsyncParams = {",
                      "message": "Exit code: 0"
                    },
                    {
                      "stdout": "./npm-app/src/cli-handlers/agent-creation-chat.ts:\n77:  // Create a simple prompt for the agent builder with the requirements\n88:    // Use the resetAgent helper to properly switch to agent-builder which automatically spawns the agent builder\n\n./npm-app/src/cli-handlers/agents.ts:\n560:    // Switch to agent-builder which automatically spawns the agent builder for agent creation\n\n./backend/src/templates/agents/agent-builder.ts:\n30:export const agentBuilder = (\n135:      'You are an expert agent builder specialized in creating new agent templates for the levelcode system. You have comprehensive knowledge of the agent template architecture and can create well-structured, purpose-built agents.',\n224:The agent builder is focused on creating new agent templates based on user specifications.\n\n./backend/src/templates/agent-list.ts:\n18:import { agentBuilder } from './agents/agent-builder'\n77:      ...agentBuilder(models.openrouter_claude_sonnet_4),",
                      "message": "Exit code: 0"
                    },
                    {
                      "stdout": "./common/src/constants/agents.ts:\n3:// Define agent personas with their shared characteristics",
                      "message": "Exit code: 0"
                    }
                  ]
                }
              }
            }
          ]
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "48ed86af-18ff-4566-b132-69ffec605226",
      "toolName": "spawn_agent_inline",
      "input": {
        "agent_type": "context-pruner",
        "params": {}
      },
      "agentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "48ed86af-18ff-4566-b132-69ffec605226",
      "toolName": "spawn_agent_inline",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Agent spawned."
          }
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "D-QVk6nxfQw",
      "toolName": "read_files",
      "input": {
        "paths": [
          "backend/src/templates/agents/agent-builder.ts",
          "common/src/constants/agents.ts",
          ".agents/examples/diff-reviewer-1.ts",
          ".agents/examples/diff-reviewer-2.ts",
          ".agents/examples/diff-reviewer-3.ts",
          ".agents/git-committer.ts",
          "common/src/util/examples/diff-reviewer-1.ts",
          "common/src/util/examples/diff-reviewer-2.ts",
          "common/src/util/examples/diff-reviewer-3.ts",
          "backend/src/templates/agents/file-explorer.ts"
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "D-QYc2ZPpX8",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "file-picker",
            "prompt": "package.json scripts for testing, linting, typechecking"
          },
          {
            "agent_type": "code-searcher",
            "params": {
              "searchQueries": [
                {
                  "pattern": "bun run typecheck|lint|test"
                },
                {
                  "pattern": "AGENT_PERSONAS",
                  "flags": "-g *.ts"
                }
              ]
            }
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "D-QVk6nxfQw",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": "backend/src/templates/agents/agent-builder.ts",
              "content": "import * as fs from 'fs'\nimport * as path from 'path'\n\nimport {\n  AGENT_TEMPLATES_DIR,\n  openrouterModels,\n  AGENT_DEFINITION_FILE,\n} from '@levelcode/common/constants'\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\nimport z from 'zod/v4'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\nimport type { ToolName } from '@levelcode/common/tools/constants'\n\nconst COMMON_UTIL_PATH = '../../../../common/src/util'\nconst TEMPLATE_RELATIVE_PATH =\n  `${COMMON_UTIL_PATH}/types/${AGENT_DEFINITION_FILE}` as const\n// Import to validate path exists at compile time\nimport(TEMPLATE_RELATIVE_PATH)\n\nconst TEMPLATE_PATH = path.join(__dirname, TEMPLATE_RELATIVE_PATH)\nconst DEFAULT_MODEL = openrouterModels.openrouter_claude_sonnet_4\nconst TYPES_DIR = path.join(AGENT_TEMPLATES_DIR, 'types')\nconst EXAMPLES_DIR = path.join(AGENT_TEMPLATES_DIR, 'examples')\nconst TEMPLATE_TYPES_PATH = path.join(TYPES_DIR, AGENT_DEFINITION_FILE)\nconst TOOL_DEFINITIONS_FILE = 'tools.d.ts'\nconst TOOL_DEFINITIONS_PATH = path.join(TYPES_DIR, TOOL_DEFINITIONS_FILE)\n\nexport const agentBuilder = (\n  model: Model,\n  allAvailableAgents?: string[],\n): Omit<AgentTemplate, 'id'> => {\n  // Read the AGENT_CONFIG_FILE content dynamically\n  // The import above ensures this path exists at compile time\n  let agentTemplateContent = ''\n  try {\n    agentTemplateContent = fs.readFileSync(TEMPLATE_PATH, 'utf8')\n  } catch (error) {\n    console.warn(`Could not read ${AGENT_DEFINITION_FILE}:`, error)\n    agentTemplateContent = '// Agent template types not available'\n  }\n  // Read the tools.d.ts content from common package\n  let toolDefinitionsContent = ''\n  try {\n    const toolsPath = path.join(\n      __dirname,\n      `${COMMON_UTIL_PATH}/types/tools.d.ts`,\n    )\n    toolDefinitionsContent = fs.readFileSync(toolsPath, 'utf8')\n  } catch (error) {\n    console.warn(`Could not read tools.d.ts from common:`, error)\n    toolDefinitionsContent = '// Tool definitions not available'\n  }\n\n  // Read example agent files from common package\n  const exampleAgentContents: Record<string, string> = {}\n\n  try {\n    const exampleAgentsDir = path.join(__dirname, `${COMMON_UTIL_PATH}`)\n    // Check if directory exists before trying to read it\n    if (fs.existsSync(exampleAgentsDir)) {\n      const files = fs.readdirSync(exampleAgentsDir)\n\n      files\n        .filter(\n          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer'),\n        )\n        .forEach((filename) => {\n          try {\n            const fullPath = path.join(exampleAgentsDir, filename)\n            const content = fs.readFileSync(fullPath, 'utf8')\n            exampleAgentContents[filename] = content\n          } catch (error) {\n            console.warn(`Could not read example agent ${filename}:`, error)\n          }\n        })\n    } else {\n      console.warn(\n        `Example agents directory does not exist: ${exampleAgentsDir}`,\n      )\n    }\n  } catch (error) {\n    console.warn('Could not read example agents directory:', error)\n  }\n\n  return {\n    model,\n    displayName: 'Bob the Agent Builder',\n    spawnPurposePrompt:\n      'Enhanced base agent that can create custom agents and handle all coding tasks with deterministic agent creation behavior',\n    inputSchema: {\n      prompt: z\n        .string()\n        .optional()\n        .describe(\n          'What agent type you would like to create or edit. Include as many details as possible.',\n        ),\n      params: z\n        .object({\n          name: z.string().optional(),\n          purpose: z.string().optional(),\n          specialty: z.string().optional(),\n          model: z.string().optional(),\n        })\n        .passthrough()\n        .optional(),\n    },\n    outputMode: 'structured_output',\n    includeMessageHistory: false,\n    toolNames: [\n      'write_file',\n      'str_replace',\n      'run_terminal_command',\n      'read_files',\n      'code_search',\n      'spawn_agents',\n      'add_message',\n      'set_output',\n      'end_turn',\n    ] satisfies ToolName[],\n    spawnableAgents: allAvailableAgents\n      ? (allAvailableAgents as any[])\n      : [\n          AgentTemplateTypes.file_picker,\n          AgentTemplateTypes.researcher,\n          AgentTemplateTypes.thinker,\n          AgentTemplateTypes.reviewer,\n          AgentTemplateTypes.agent_builder,\n        ],\n\n    systemPrompt: [\n      '# Bob the Agent Builder',\n      '',\n      'You are an expert agent builder specialized in creating new agent templates for the levelcode system. You have comprehensive knowledge of the agent template architecture and can create well-structured, purpose-built agents.',\n      '',\n      '## Environment Setup Complete',\n      '',\n      'Your environment has been automatically prepared with:',\n      '- Agent template type definitions in `.agents/types/agent-definition.d.ts`',\n      '- Tool type definitions in `.agents/types/tools.d.ts`',\n      '- Example agent files copied to `.agents/` directory for reference',\n      '',\n      'All necessary files are now available in your working directory.',\n      '',\n      '## Complete Agent Template Type Definitions',\n      '',\n      'Here are the complete TypeScript type definitions for creating custom LevelCode agents:',\n      '```typescript',\n      agentTemplateContent,\n      '```',\n      '',\n      '## Available Tools Type Definitions',\n      '',\n      'Here are the complete TypeScript type definitions for all available tools:',\n      '',\n      '```typescript',\n      toolDefinitionsContent,\n      '```',\n      '',\n      '## Agent Template Patterns:',\n      '',\n      '1. **Base Agent Pattern**: Full-featured agents with comprehensive tool access',\n      '2. **Specialized Agent Pattern**: Focused agents with limited tool sets',\n      '3. **Thinking Agent Pattern**: Agents that spawn thinker sub-agents',\n      '4. **Research Agent Pattern**: Agents that start with web search',\n      '',\n      '## Best Practices:',\n      '',\n      '1. **Use as few fields as possible**: Leave out fields that are not needed to reduce complexity',\n      '2. **Minimal Tools**: Only include tools the agent actually needs',\n      '3. **Clear and Concise Prompts**: Write clear, specific prompts that have no unnecessary words',\n      '4. **Consistent Naming**: Follow naming conventions (kebab-case for IDs)',\n      '5. **Appropriate Model**: Choose the right model for the task complexity. Default is claude-4-sonnet-20250522 for medium-high complexity tasks, and openai/gpt-5 for all other tasks.',\n      '',\n      '## Your Task:',\n      'When asked to create an agent template, you should:',\n      \"1. Understand the requested agent's purpose and capabilities\",\n      \"2. Choose appropriate tools for the agent's function\",\n      '3. Write a comprehensive system prompt',\n      `4. Create the complete agent template file in ${AGENT_TEMPLATES_DIR}`,\n      '5. Ensure the template follows all conventions and best practices',\n      '6. Use the AgentDefinition interface for the configuration',\n      '7. Start the file with: import type { AgentDefinition } from \"./types/agent-definition.d.ts\"',\n      '',\n      'Create agent templates that are focused, efficient, and well-documented. Always import the AgentDefinition type and export a default configuration object.',\n    ].join('\\n'),\n    instructionsPrompt: `You are helping to create or edit an agent template. The user will describe what kind of agent they want to create or how they want to modify an existing agent.\n\n## Environment Ready\n\nYour environment has been automatically set up with:\n- Type definitions in \\`.agents/types/\\`\n- Example agent files in \\`.agents/\\` directory\n- All necessary scaffolding complete\n\nYou can now proceed directly to agent creation or editing.\n\n## Example Agents Available\n\nThree example agents are now available in your \\`.agents/\\` directory which are all diff reviewers of increasing complexity. These can serve as examples of well-made agents at different stages of complexity.\n\n**IMPORTANT**: Examine these examples to find connections and patterns that relate to the user's request. Look for:\n- Similar tool combinations\n- Comparable complexity levels\n- Related functionality patterns\n- Appropriate model choices\n- Relevant prompt structures\n\nUse these examples as inspiration and starting points, adapting their patterns to fit the user's specific needs.\n\n## For New Agents\n\nAnalyze their request and create a complete agent template that:\n- Has a clear purpose and appropriate capabilities\n- Leaves out fields that are not needed\n- Uses only the tools it needs\n- Follows naming conventions\n- Is properly structured\n- Draws inspiration from relevant example agents\n\n## For Creating New Agents\n\nThe agent builder is focused on creating new agent templates based on user specifications.\n\nIMPORTANT: Always end your response with the end_turn tool when you have completed the agent creation or editing task.`,\n    stepPrompt: '',\n\n    handleSteps: function* ({ agentState, prompt, params }) {\n      // Step 1: Create directory structure\n      yield {\n        toolName: 'run_terminal_command',\n        args: {\n          command: `mkdir -p ${TYPES_DIR} && mkdir -p ${EXAMPLES_DIR}`,\n          process_type: 'SYNC',\n          timeout_seconds: 10,\n        },\n      }\n\n      // Step 2: Write the AGENT_DEFINITION_FILE with the template content\n      yield {\n        toolName: 'write_file',\n        args: {\n          path: TEMPLATE_TYPES_PATH,\n          instructions: 'Create agent template type definitions file',\n          content: agentTemplateContent,\n        },\n      }\n\n      // Step 3: Write the tool definitions file (copy from existing tools.d.ts)\n      yield {\n        toolName: 'write_file',\n        args: {\n          path: TOOL_DEFINITIONS_PATH,\n          instructions: 'Create tools type file',\n          content: toolDefinitionsContent,\n        },\n      }\n\n      // Step 4: Add message about reading example files and then read them\n      yield {\n        toolName: 'add_message',\n        args: {\n          role: 'assistant',\n          content:\n            \"I'll read the example agent files to understand the patterns and then help you create your agent.\",\n        },\n      }\n\n      // Step 5: Copy example agent files to .agents/ directory\n      for (const [filename, content] of Object.entries(exampleAgentContents)) {\n        if (content) {\n          yield {\n            toolName: 'write_file',\n            args: {\n              path: `${EXAMPLES_DIR}/${filename}`,\n              instructions: `Copy example agent file ${filename}`,\n              content: content,\n            },\n          }\n        }\n      }\n\n      // Step 6: Complete agent creation process\n      yield 'STEP_ALL'\n    },\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/constants/agents.ts",
              "content": "import type { AgentTemplateTypes } from '../types/session-state'\n\n// Define agent personas with their shared characteristics\nexport const AGENT_PERSONAS = {\n  // Base agents - all use Buffy persona\n  base: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  base_lite: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  base_max: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  base_experimental: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n  claude4_gemini_thinking: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base agent that orchestrates the full response.',\n  } as const,\n\n  base_agent_builder: {\n    displayName: 'Buffy the Enthusiastic Agent Builder',\n    purpose:\n      'Enhanced base agent that can create custom agents and handle all coding tasks',\n  } as const,\n\n  superagent: {\n    displayName: 'Superagent',\n    purpose:\n      'Superagent that can spawn multiple code editing agents to complete a task.',\n  } as const,\n\n  // Ask mode\n  ask: {\n    displayName: 'Buffy the Enthusiastic Coding Assistant',\n    purpose: 'Base ask-mode agent that orchestrates the full response.',\n  } as const,\n\n  // Specialized agents\n  thinker: {\n    displayName: 'Theo the Theorizer',\n    purpose:\n      'Does deep thinking given the current messages and a specific prompt to focus on. Use this to help you solve a specific problem.',\n  } as const,\n  file_explorer: {\n    displayName: 'Dora The File Explorer',\n    purpose: 'Expert at exploring a codebase and finding relevant files.',\n  } as const,\n  file_picker: {\n    displayName: 'Fletcher the File Fetcher',\n    purpose: 'Expert at finding relevant files in a codebase.',\n  } as const,\n  researcher: {\n    displayName: 'Reid Searcher the Researcher',\n    purpose: 'Expert at researching topics using web search and documentation.',\n  } as const,\n  planner: {\n    displayName: 'Peter Plan the Planner',\n    purpose: 'Agent that formulates a comprehensive plan to a prompt.',\n    hidden: true,\n  } as const,\n  dry_run: {\n    displayName: 'Sketch the Dry Runner',\n    purpose: 'Agent that takes a plan and try to implement it in a dry run.',\n    hidden: true,\n  } as const,\n  reviewer: {\n    displayName: 'Nit Pick Nick the Reviewer',\n    purpose:\n      'Reviews file changes and responds with critical feedback. Use this after making any significant change to the codebase.',\n  } as const,\n  agent_builder: {\n    displayName: 'Bob the Agent Builder',\n    purpose: 'Creates new agent templates for the levelcode mult-agent system',\n    hidden: false,\n  } as const,\n} as const satisfies Partial<\n  Record<\n    keyof typeof AgentTemplateTypes,\n    { displayName: string; purpose: string; hidden?: boolean }\n  >\n>\n\n// Agent IDs list from AGENT_PERSONAS keys\nexport const AGENT_IDS = Object.keys(\n  AGENT_PERSONAS,\n) as (keyof typeof AGENT_PERSONAS)[]\n\n// Agent ID prefix constant\nexport const AGENT_ID_PREFIX = 'LevelCodeAI/'\n\n// Agent names for client-side reference\nexport const AGENT_NAMES = Object.fromEntries(\n  Object.entries(AGENT_PERSONAS).map(([agentType, persona]) => [\n    agentType,\n    persona.displayName,\n  ]),\n) as Record<keyof typeof AGENT_PERSONAS, string>\n\nexport type AgentName =\n  (typeof AGENT_PERSONAS)[keyof typeof AGENT_PERSONAS]['displayName']\n\n// Get unique agent names for UI display\nexport const UNIQUE_AGENT_NAMES = Array.from(\n  new Set(\n    Object.values(AGENT_PERSONAS)\n      .filter((persona) => !('hidden' in persona) || !persona.hidden)\n      .map((persona) => persona.displayName),\n  ),\n)\n\n// Map from display name back to agent types (for parsing user input)\nexport const AGENT_NAME_TO_TYPES = Object.entries(AGENT_NAMES).reduce(\n  (acc, [type, name]) => {\n    if (!acc[name]) acc[name] = []\n    acc[name].push(type)\n    return acc\n  },\n  {} as Record<string, string[]>,\n)\n",
              "referencedBy": {}
            },
            {
              "path": ".agents/examples/diff-reviewer-1.ts",
              "content": "import type { AgentDefinition } from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-1',\n\n  displayName: 'Diff Reviewer (Level 1)',\n  model: 'openai/gpt-5',\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements`,\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": ".agents/examples/diff-reviewer-2.ts",
              "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-2',\n  displayName: 'Diff Reviewer (Level 2)',\n  model: 'openai/gpt-5',\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n    // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 2: Let AI run the rest of the steps!\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": ".agents/examples/diff-reviewer-3.ts",
              "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-3',\n\n  displayName: 'Diff Reviewer (Level 3)',\n  model: 'openai/gpt-5',\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  outputMode: 'last_message',\n\n  toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\n  spawnableAgents: ['james/file-explorer@0.1.3'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Review the changes and suggest improvements.\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n    // Step 1: Get list of changed files from git diff --name-only\n    const { toolResult: gitDiffFilesResult } = yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff --name-only',\n      },\n    }\n\n    // Then, extract file paths from the result\n    const changedFiles = (gitDiffFilesResult || '')\n      .split('\\n')\n      .map((line) => line.trim())\n      .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\n\n    // Step 2: Read the files\n    if (changedFiles.length > 0) {\n      yield {\n        toolName: 'read_files',\n        args: {\n          paths: changedFiles,\n        },\n      }\n    }\n\n    // Step 3: Run full git diff to see the actual changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 4: Put words in the AI's mouth to get it to spawn the file explorer.\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          'Now I will spawn a file explorer to find any missing codebase context.',\n      },\n    }\n\n    yield 'STEP'\n\n    // Step 5: Put words in the AI's mouth to review the changes.\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content: 'Here is my comprehensive review of the changes.',\n      },\n    }\n\n    // Step 6: Let AI review the changes in a final step. (The last message is also the agent's output.)\n    yield 'STEP'\n  },\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": ".agents/git-committer.ts",
              "content": "import { publisher, version } from './constants'\n\nimport type {\n  AgentDefinition,\n  AgentStepContext,\n} from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'git-committer',\n  version,\n  publisher,\n  displayName: 'Git Committer',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description: 'What changes to commit',\n    },\n  },\n\n  includeMessageHistory: false,\n  outputMode: 'last_message',\n\n  spawnPurposePrompt:\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\n\n  instructionsPrompt:\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, analyze changes, and create a commit with proper formatting including the LevelCode footer.',\n\n  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n    // Step 1: Run git diff and git log to analyze changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git log --oneline -10',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    // Step 2: Let AI analyze the changes and read relevant files for context\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          \"I've analyzed the git diff and recent commit history. Now I'll read any relevant files to better understand the context of these changes.\",\n      },\n    }\n\n    // Step 3: Let AI decide which files to read and stage\n    yield 'STEP'\n\n    // Step 4: Let AI analyze staged changes and compose commit message\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          \"Now I'll analyze the staged changes and create a commit with the proper LevelCode footer format.\",\n      },\n    }\n\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/examples/diff-reviewer-1.ts",
              "content": "import type { AgentDefinition } from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-1',\n\n  displayName: 'Diff Reviewer (Level 1)',\n  model: 'openai/gpt-5',\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements`,\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/examples/diff-reviewer-2.ts",
              "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-2',\n  displayName: 'Diff Reviewer (Level 2)',\n  model: 'openai/gpt-5',\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n    // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 2: Let AI run the rest of the steps!\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/examples/diff-reviewer-3.ts",
              "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-3',\n\n  displayName: 'Diff Reviewer (Level 3)',\n  model: 'openai/gpt-5',\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  outputMode: 'last_message',\n\n  toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\n  spawnableAgents: ['james/file-explorer@0.1.3'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Review the changes and suggest improvements.\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n    // Step 1: Get list of changed files from git diff --name-only\n    const { toolResult: gitDiffFilesResult } = yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff --name-only',\n      },\n    }\n\n    // Then, extract file paths from the result\n    const changedFiles = (gitDiffFilesResult || '')\n      .split('\\n')\n      .map((line) => line.trim())\n      .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\n\n    // Step 2: Read the files\n    if (changedFiles.length > 0) {\n      yield {\n        toolName: 'read_files',\n        args: {\n          paths: changedFiles,\n        },\n      }\n    }\n\n    // Step 3: Run full git diff to see the actual changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 4: Put words in the AI's mouth to get it to spawn the file explorer.\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          'Now I will spawn a file explorer to find any missing codebase context.',\n      },\n    }\n\n    yield 'STEP'\n\n    // Step 5: Put words in the AI's mouth to review the changes.\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content: 'Here is my comprehensive review of the changes.',\n      },\n    }\n\n    // Step 6: Let AI review the changes in a final step. (The last message is also the agent's output.)\n    yield 'STEP'\n  },\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": "backend/src/templates/agents/file-explorer.ts",
              "content": "import { AgentTemplateTypes } from '@levelcode/common/types/session-state'\nimport { z } from 'zod/v4'\n\nimport type { AgentTemplate } from '../types'\n\nconst paramsSchema = z.object({\n  prompts: z\n    .array(z.string())\n    .describe(\n      'List of 1-4 different parts of the codebase that could be useful to explore',\n    ),\n})\n\nexport const fileExplorer = {\n  id: AgentTemplateTypes.file_explorer,\n  displayName: 'Dora the File Explorer',\n  spawnPurposePrompt:\n    'Spawns multiple file picker agents in parallel to comprehensively explore the codebase from different perspectives',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  outputMode: 'structured_output',\n  includeMessageHistory: false,\n  toolNames: ['spawn_agents', 'set_output'],\n  spawnableAgents: ['file-picker'],\n  inputSchema: {\n    prompt: z\n      .string()\n      .describe('What you need to accomplish by exploring the codebase'),\n    params: paramsSchema,\n  },\n  systemPrompt:\n    'You are a file explorer agent that spawns multiple file picker agents in parallel to comprehensively explore the codebase.',\n  instructionsPrompt: '',\n  stepPrompt: '',\n\n  handleSteps: function* ({ prompt, params }) {\n    const filePickerPrompts = params.prompts.map(\n      (focusPrompt) =>\n        `Based on the overall goal \"${prompt}\", find files related to this specific area: ${focusPrompt}`,\n    )\n\n    // Spawn all file pickers in parallel\n    const { toolResult: spawnResult } = yield {\n      toolName: 'spawn_agents' as const,\n      args: {\n        agents: filePickerPrompts.map((promptText) => ({\n          agent_type: 'file-picker' as const,\n          prompt: promptText,\n        })),\n      },\n    }\n\n    // Set output with aggregated results\n    yield {\n      toolName: 'set_output' as const,\n      args: {\n        results: spawnResult,\n      },\n    }\n  },\n} satisfies AgentTemplate<string, z.infer<typeof paramsSchema>>\n",
              "referencedBy": {}
            }
          ]
        }
      ]
    },
    {
      "type": "subagent_start",
      "agentId": "D-QYfz6Uj58",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "package.json scripts for testing, linting, typechecking"
    },
    {
      "type": "subagent_start",
      "agentId": "D-QYgBIs_zY",
      "agentType": "code-searcher",
      "displayName": "Code Searcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "searchQueries": [
          {
            "pattern": "bun run typecheck|lint|test"
          },
          {
            "pattern": "AGENT_PERSONAS",
            "flags": "-g *.ts"
          }
        ]
      }
    },
    {
      "type": "tool_call",
      "toolCallId": "b5cf7c6b-266d-4758-8e9e-069117fc61ec",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "file-lister",
            "prompt": "package.json scripts for testing, linting, typechecking",
            "params": {}
          }
        ]
      },
      "agentId": "D-QYfz6Uj58",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-QYpeR_n1U",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-QYfz6Uj58",
      "prompt": "package.json scripts for testing, linting, typechecking",
      "params": {}
    },
    {
      "type": "tool_call",
      "toolCallId": "80170260-0f51-4267-aef7-85b48109a7cc",
      "toolName": "code_search",
      "input": {
        "pattern": "bun run typecheck|lint|test"
      },
      "agentId": "D-QYgBIs_zY",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "df164364-63c0-4ef7-aac6-03342cfbf19c",
      "toolName": "read_subtree",
      "input": {
        "paths": [],
        "maxTokens": 500000
      },
      "agentId": "D-QYpeR_n1U",
      "parentAgentId": "D-QYfz6Uj58",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "df164364-63c0-4ef7-aac6-03342cfbf19c",
      "toolName": "read_subtree",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": ".",
              "type": "directory",
              "printedTree": ".agents/\n examples/\n  diff-reviewer-1.ts\n  diff-reviewer-2.ts\n  diff-reviewer-3.ts\n opensource/\n  base.ts\n  coder.ts\n  file-picker.ts\n  researcher.ts\n  reviewer.ts\n  thinker.ts\n ask.ts\n base-experimental.ts\n base-lite.ts\n base-max.ts\n base.ts\n brainstormer.ts\n changes-reviewer.ts\n charles.ts\n claude4-gemini-thinking.ts\n constants.ts\n file-explorer.ts\n file-picker.ts\n git-committer.ts\n knowledge-keeper.ts\n planner.ts\n researcher.ts\n reviewer.ts\n superagent.ts\n thinker.ts\n.bin/\n bun\n.github/\n workflows/\n  ci.yml\n  evals.yml\n  nightly-evals.yml\n  npm-app-release-build.yml\n  npm-app-release-prod.yml\n  npm-app-release-staging.yml\n .gitignore\n CODEOWNERS\n knowledge.md\n.vscode/\n settings.json\nbackend/\n src/\n  __tests__/\n   test-data/\n    dex-go/\n     edit-snippet.go\n     expected.go\n     original.go\n   agent-id-resolution.test.ts\n   agent-registry.test.ts\n   auto-topup.test.ts\n   credit-conversion.test.ts\n   fast-rewrite.test.ts\n   generate-diffs-prompt.test.ts\n   get-custom-file-picker-config.test.ts\n   live-user-inputs.test.ts\n   loop-agent-steps.test.ts\n   main-prompt.integration.test.ts\n   main-prompt.test.ts\n   process-file-block.test.ts\n   process-str-replace.test.ts\n   read-docs-tool.test.ts\n   request-files-prompt.test.ts\n   run-agent-step-tools.test.ts\n   run-programmatic-step.test.ts\n   sandbox-generator.test.ts\n   subagent-streaming.test.ts\n   test-utils.ts\n   tool-call-schema.test.ts\n   usage-calculation.test.ts\n   web-search-tool.test.ts\n   xml-stream-parser.test.ts\n  admin/\n   grade-runs.ts\n   relabelRuns.ts\n  api/\n   org.ts\n   usage.ts\n  context/\n   app-context.ts\n  find-files/\n   check-new-files-necessary.ts\n   custom-file-picker-config.ts\n   request-files-prompt.ts\n  llm-apis/\n   __tests__/\n    linkup-api.test.ts\n   vercel-ai-sdk/\n    ai-sdk.ts\n    openrouter.ts\n    vertex-finetuned.ts\n   claude.ts\n   context7-api.ts\n   gemini-with-fallbacks.ts\n   knowledge.md\n   linkup-api.ts\n   message-cost-tracker.ts\n   openai-api.ts\n   openrouter.ts\n   relace-api.ts\n  system-prompt/\n   agent-instructions.md\n   prompts.ts\n   save-agent-request.ts\n   search-system-prompt.ts\n   truncate-file-tree.ts\n  templates/\n   agents/\n    archive/\n     dry-run.ts\n    agent-builder.ts\n    ask.ts\n    base.ts\n    file-explorer.ts\n    file-picker.ts\n    planner.ts\n    researcher.ts\n    reviewer.ts\n    superagent.ts\n    thinker.ts\n    thinking-base.ts\n   agent-list.ts\n   agent-registry.ts\n   ask-prompts.ts\n   base-prompts.ts\n   prompts.ts\n   README.md\n   strings.ts\n   types.ts\n  tools/\n   definitions/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    list.ts\n    tool-def-type.ts\n   handlers/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    handler-function-type.ts\n    list.ts\n   constants.ts\n   prompts.ts\n   stream-parser.ts\n   tool-executor.ts\n  util/\n   __tests__/\n    messages.test.ts\n    object.test.ts\n    parse-tool-call-xml.test.ts\n    simplify-tool-results.test.ts\n    split-data.test.ts\n   check-auth.ts\n   debug.ts\n   file-resolver.ts\n   logger.ts\n   messages.ts\n   object.ts\n   parse-tool-call-xml.ts\n   quickjs-sandbox.ts\n   simplify-tool-results.ts\n   split-data.ts\n   token-counter.ts\n  websockets/\n   auth.ts\n   middleware.ts\n   request-context.ts\n   server.ts\n   switchboard.ts\n   websocket-action.ts\n  async-agent-manager.ts\n  check-terminal-command.ts\n  fast-rewrite.ts\n  generate-diffs-prompt.ts\n  get-documentation-for-query.ts\n  get-file-reading-updates.ts\n  index.ts\n  live-user-inputs.ts\n  loop-main-prompt.ts\n  main-prompt.ts\n  process-file-block.ts\n  process-str-replace.ts\n  prompt-agent-stream.ts\n  run-agent-step.ts\n  run-programmatic-step.ts\n  xml-stream-parser.ts\n .gitignore\n knowledge.md\n package.json\n README.md\n tsconfig.json\ncommon/\n src/\n  __tests__/\n   agent-validation.test.ts\n   dynamic-agent-template-schema.test.ts\n   handlesteps-parsing.test.ts\n  api-keys/\n   constants.ts\n   crypto.ts\n  constants/\n   agents.ts\n   analytics-events.ts\n   grant-priorities.ts\n  db/\n   migrations/\n    meta/\n     _journal.json\n     0000_snapshot.json\n     0001_snapshot.json\n     0002_snapshot.json\n     0003_snapshot.json\n     0004_snapshot.json\n     0005_snapshot.json\n     0006_snapshot.json\n     0007_snapshot.json\n     0008_snapshot.json\n     0009_snapshot.json\n     0010_snapshot.json\n     0011_snapshot.json\n     0012_snapshot.json\n     0013_snapshot.json\n     0014_snapshot.json\n     0015_snapshot.json\n     0016_snapshot.json\n     0017_snapshot.json\n     0018_snapshot.json\n     0019_snapshot.json\n     0020_snapshot.json\n     0021_snapshot.json\n     0026_snapshot.json\n     0027_snapshot.json\n     0028_snapshot.json\n    0000_overjoyed_thing.sql\n    0001_fuzzy_typhoid_mary.sql\n    0002_sticky_dormammu.sql\n    0003_military_owl.sql\n    0004_neat_pet_avengers.sql\n    0005_minor_the_professor.sql\n    0006_first_quasimodo.sql\n    0007_equal_warlock.sql\n    0008_puzzling_carnage.sql\n    0009_bitter_rumiko_fujikawa.sql\n    0010_overjoyed_red_skull.sql\n    0011_familiar_ezekiel_stane.sql\n    0012_fluffy_naoko.sql\n    0013_famous_risque.sql\n    0014_wakeful_sinister_six.sql\n    0015_stormy_zuras.sql\n    0016_clear_hairball.sql\n    0017_tricky_randall_flagg.sql\n    0018_stale_human_robot.sql\n    0019_amused_nebula.sql\n    0020_young_sleeper.sql\n    0021_tiny_marauders.sql\n    0026_chilly_mockingbird.sql\n    0027_sloppy_quasar.sql\n    0028_lush_johnny_blaze.sql\n   docker-compose.yml\n   drizzle.config.ts\n   index.ts\n   schema.knowledge.md\n   schema.ts\n   transaction.ts\n  json-config/\n   __tests__/\n    __snapshots__/\n     stringify-schema.test.ts.snap\n    constants.test.ts\n    stringify-schema.test.ts\n   constants.ts\n   default.ts\n   stringify-schema.ts\n  templates/\n   agent-validation.ts\n   dynamic-agent-functions.ts\n  testing/\n   mock-modules.ts\n  tools/\n   params/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n   compile-tool-definitions.ts\n   constants.ts\n   list.ts\n   utils.ts\n  types/\n   __tests__/\n    dynamic-agent-template.test.ts\n   api/\n    agents/\n     publish.ts\n   agent-template.ts\n   dynamic-agent-template.ts\n   grant.ts\n   message.ts\n   organization.ts\n   print-mode.ts\n   publisher.ts\n   referral.ts\n   session-state.ts\n   usage.ts\n  util/\n   __tests__/\n    messages.test.ts\n    partial-json-delta.test.ts\n    saxy.test.ts\n    string.test.ts\n   examples/\n    diff-reviewer-1.ts\n    diff-reviewer-2.ts\n    diff-reviewer-3.ts\n   agent-file-utils.ts\n   agent-name-normalization.ts\n   agent-name-resolver.ts\n   agent-template-validation.ts\n   array.ts\n   changes.ts\n   credentials.ts\n   currency.ts\n   dates.ts\n   error.ts\n   file.ts\n   git.ts\n   logger.ts\n   lru-cache.ts\n   messages.ts\n   min-heap.ts\n   model-utils.ts\n   object.ts\n   partial-json-delta.ts\n   patch.ts\n   promise.ts\n   random.ts\n   referral.ts\n   saxy.ts\n   string.knowledge.md\n   string.ts\n   stripe.ts\n   sync-failure.ts\n   xml.ts\n   zod-schema.ts\n  websockets/\n   websocket-client.ts\n   websocket-schema.ts\n  actions.ts\n  analytics.ts\n  browser-actions.ts\n  constants.ts\n  project-file-tree.ts\n knowledge.md\n package.json\n tsconfig.json\nevals/\n git-evals/\n  email-eval-results.ts\n  eval-levelcode.json\n  eval-manifold.json\n  eval-result-levelcode-mock.json\n  gen-evals.ts\n  judge-git-eval.ts\n  post-eval-analysis.ts\n  run-eval-set.ts\n  run-git-evals.ts\n  run-single-eval-process.ts\n  run-single-eval.ts\n  setup-test-repo.ts\n  types.ts\n .gitignore\n bun.lock\n constants.ts\n e2e-cat-app-script.ts\n knowledge.md\n package.json\n scaffolding.ts\n swe-bench-eval.ts\n swe-bench-ids.ts\n swe-bench.test.ts\n test-repos.json\n test-setup.ts\n tsconfig.json\nnpm-app/\n release/\n  index.js\n  package.json\n  README.md\n release-staging/\n  index.js\n  package.json\n  README.md\n scripts/\n  build-binary.js\n  generate-github-token.ts\n  patch-web-tree-sitter.ts\n  release.js\n  twitch-plays-levelcode.sh\n src/\n  __tests__/\n   display.test.ts\n   tool-handlers.test.ts\n  agents/\n   agent-utils.ts\n   load-agents.ts\n  checkpoints/\n   checkpoint-manager.ts\n   file-manager.ts\n  cli-handlers/\n   agent-creation-chat.ts\n   agents.ts\n   api-key.ts\n   checkpoint.ts\n   diff.ts\n   easter-egg.ts\n   inititalization-flow.ts\n   mini-chat.ts\n   publish.ts\n   subagent-list.ts\n   subagent.ts\n  display/\n   overrides.ts\n   print-mode.ts\n   squash-newlines.ts\n  json-config/\n   hooks.ts\n   parser.ts\n  native/\n   ripgrep.ts\n  terminal/\n   background.ts\n   run-command.ts\n  utils/\n   __tests__/\n    __snapshots__/\n     background-process-manager.test.ts.snap\n     frustration-detector.test.ts.snap\n     rage-detector.test.ts.snap\n     xml-stream-parser.test.ts.snap\n    background-process-manager.test.ts\n    rage-detector.test.ts\n    response-example-4-files.txt\n    tool-renderers.test.ts\n    xml-stream-parser.test.ts\n   agent-validation.ts\n   analytics.ts\n   detect-shell.ts\n   git.ts\n   logger.ts\n   rage-detector.ts\n   spinner.ts\n   suppress-console.ts\n   system-info.ts\n   terminal.ts\n   tool-renderers.ts\n   with-hang-detection.ts\n   xml-stream-parser.ts\n  workers/\n   checkpoint-worker.ts\n   project-context.ts\n  background-process-manager.ts\n  browser-runner.ts\n  chat-storage.ts\n  cli-definitions.ts\n  cli.ts\n  client.ts\n  config.ts\n  create-template-project.ts\n  credentials.ts\n  dev-process-manager.ts\n  diff-manager.ts\n  fingerprint.ts\n  index.ts\n  menu.ts\n  project-files.ts\n  rage-detectors.ts\n  startup-process-handler.ts\n  subagent-storage.ts\n  tool-handlers.ts\n  types.ts\n  web-scraper.ts\n .gitignore\n bunfig.toml\n package.json\n tsconfig.json\npackages/\n bigquery/\n  src/\n   client.ts\n   index.ts\n   schema.ts\n  knowledge.md\n  package.json\n  tsconfig.json\n billing/\n  src/\n   __tests__/\n    credit-delegation.test.ts\n    extract-owner-repo.test.ts\n    org-billing.test.ts\n   auto-topup.ts\n   balance-calculator.ts\n   billing.knowledge.md\n   conversion.ts\n   credit-delegation.ts\n   grant-credits.knowledge.md\n   grant-credits.ts\n   index.ts\n   org-billing.ts\n   org-monitoring.ts\n   usage-service.ts\n   utils.ts\n  knowledge.md\n  package.json\n  project.json\n  tsconfig.json\n build-tools/\n  executors/\n   infisical-run/\n    executor.ts\n    schema.json\n  executors.json\n  package.json\n  project.json\n  tsconfig.json\n code-map/\n  __tests__/\n   test-langs/\n    test.c\n    test.cpp\n    test.cs\n    test.go\n    test.java\n    test.js\n    test.php\n    test.py\n    test.rb\n    test.rs\n    test.ts\n   languages.test.ts\n   parse.test.ts\n  src/\n   tree-sitter-queries/\n    readme.md\n    tree-sitter-c_sharp-tags.scm\n    tree-sitter-c-tags.scm\n    tree-sitter-cpp-tags.scm\n    tree-sitter-go-tags.scm\n    tree-sitter-java-tags.scm\n    tree-sitter-javascript-tags.scm\n    tree-sitter-php-tags.scm\n    tree-sitter-python-tags.scm\n    tree-sitter-ruby-tags.scm\n    tree-sitter-rust-tags.scm\n    tree-sitter-typescript-tags.scm\n   index.ts\n   languages.ts\n   parse.ts\n  package.json\n  tsconfig.json\n internal/\n  src/\n   loops/\n    client.ts\n    index.ts\n    types.ts\n   openrouter-ai-sdk/\n    internal/\n     index.ts\n    schemas/\n     reasoning-details.ts\n    types/\n     index.ts\n     openrouter-chat-completions-input.ts\n     openrouter-chat-settings.ts\n    .gitignore\n    convert-to-openrouter-chat-messages.test.ts\n    convert-to-openrouter-chat-messages.ts\n    convert-to-openrouter-completion-prompt.ts\n    index.ts\n    map-openrouter-chat-logprobs.ts\n    map-openrouter-completion-logprobs.ts\n    map-openrouter-finish-reason.ts\n    openrouter-chat-language-model.test.ts\n    openrouter-chat-language-model.ts\n    openrouter-completion-language-model.test.ts\n    openrouter-completion-language-model.ts\n    openrouter-completion-settings.ts\n    openrouter-error.ts\n    openrouter-facade.ts\n    openrouter-provider-options.test.ts\n    openrouter-provider.ts\n    openrouter-stream-usage-accounting.test.ts\n    openrouter-usage-accounting.test.ts\n   utils/\n    __tests__/\n     version-utils.test.ts\n    auth.ts\n    version-utils.ts\n    xml-parser.ts\n   env.ts\n   index.ts\n   knowledge.md\n  package.json\n  tsconfig.json\npython-app/\n src/\n  levelcode/\n   __init__.py\n .gitignore\n knowledge.md\n LICENSE\n pyproject.toml\n README.md\nscripts/\n changelog/\n  2025-05-18-version-10283-release-enhanced-assistant-experience-system-stability.mdx\n  2025-05-25-version-10295-enhanced-ai-models-and-user-experience-improvements.mdx\n  2025-06-01-version-10305-release-enhanced-ai-models-new-commands-and-performance-improvements.mdx\n  docs.json\n ft-file-selection/\n  .gitignore\n  collect-tuning-data.ts\n  grade-traces.ts\n  print-recent-relabels.ts\n  print-recent-traces.ts\n  README.md\n  relabel-for-offline-scoring.ts\n  relabel-traces-with-context.ts\n  relabel-traces.ts\n .gitignore\n analyze-edit-blocks.ts\n analyze-model-usage.ts\n apply-credit-migration.ts\n calculate-average-spend.ts\n calculate-dau.ts\n calculate-monthly-usage.ts\n calculate-mrr.ts\n calculate-weekly-usage.ts\n cleanup-worktree.sh\n convert-escaped-newlines.ts\n count-edit-file.ts\n debug-log-subset.ts\n dev.sh\n export-user-emails.ts\n generate-ci-env.js\n generate-tool-definitions.ts\n get-changelog.ts\n init-worktree.ts\n package.json\n tsconfig.json\n update-stripe-subscriptions.ts\nsdk/\n scripts/\n  publish.js\n src/\n  tools/\n   change-file.ts\n   read-files.ts\n  types/\n   agent-definition.ts\n   tools.ts\n  client.ts\n  constants.ts\n  index.ts\n  process-stream.ts\n  websocket-client.ts\n .npmignore\n CHANGELOG.md\n package.json\n PUBLISHING.md\n README.md\n tsconfig.json\nweb/\n public/\n  levelcode-intro1.webm\n scripts/\n  discord/\n   index.ts\n   register-commands.ts\n src/\n  __tests__/\n   e2e/\n    home.spec.ts\n   unit/\n    home.spec.tsx\n  actions/\n   hello-action.ts\n  app/\n   [sponsee]/\n    page.tsx\n   admin/\n    file-picker/\n     page.tsx\n    orgs/\n     page.tsx\n    traces/\n     components/\n      chat-message.tsx\n      client-session-viewer.tsx\n      empty-state.tsx\n      error-boundary.tsx\n      loading-skeletons.tsx\n      timeline-chart.module.css\n      timeline-chart.tsx\n      trace-viewer.tsx\n     utils/\n      __tests__/\n       trace-processing.test.ts\n      trace-processing.ts\n     page.tsx\n    layout.tsx\n   affiliates/\n    actions.ts\n    page.tsx\n   agents/\n    page.tsx\n   api/\n    admin/\n     orgs/\n      [orgId]/\n       features/\n        [feature]/\n         route.ts\n      export/\n       route.ts\n      route.ts\n     relabel-for-user/\n      route.ts\n     traces/\n      [clientRequestId]/\n       messages/\n        route.ts\n       timeline/\n        route.ts\n      client/\n       [clientId]/\n        sessions/\n         route.ts\n     admin-auth.ts\n    agents/\n     [publisherId]/\n      [agentId]/\n       [version]/\n        route.ts\n       latest/\n        route.ts\n     publish/\n      route.ts\n     validate/\n      route.ts\n     route.ts\n    api-keys/\n     route.ts\n    auth/\n     [...nextauth]/\n      auth-options.ts\n      route.ts\n     cli/\n      code/\n       route.ts\n      logout/\n       route.ts\n      status/\n       route.ts\n    feed/\n     route.ts\n    git-evals/\n     visibility/\n      route.ts\n     route.ts\n    healthz/\n     route.ts\n    invites/\n     [token]/\n      route.ts\n    orgs/\n     [orgId]/\n      alerts/\n       [alertId]/\n        dismiss/\n         route.ts\n       route.ts\n      analytics/\n       export/\n        route.ts\n       route.ts\n      billing/\n       setup/\n        route.ts\n       status/\n        route.ts\n       subscription/\n        route.ts\n      credits/\n       route.ts\n      invitations/\n       [email]/\n        resend/\n         route.ts\n        route.ts\n       bulk/\n        route.ts\n       route.ts\n      members/\n       [userId]/\n        route.ts\n       route.ts\n      monitoring/\n       route.ts\n      publishers/\n       route.ts\n      repos/\n       [repoId]/\n        route.ts\n       route.ts\n      settings/\n       route.ts\n      usage/\n       export/\n        route.ts\n       route.ts\n      route.ts\n     slug/\n      [slug]/\n       route.ts\n     route.ts\n    publishers/\n     [id]/\n      organization/\n       route.ts\n     validate/\n      route.ts\n     route.ts\n    referrals/\n     [code]/\n      route.ts\n     helpers.ts\n     route.ts\n    stripe/\n     buy-credits/\n      route.ts\n     webhook/\n      route.ts\n    upload/\n     avatar/\n      route.ts\n    user/\n     auto-topup/\n      route.ts\n     profile/\n      route.ts\n     usage/\n      route.ts\n   config/\n    page.tsx\n   docs/\n    [category]/\n     layout.tsx\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   evals/\n    evals-table.tsx\n    page.tsx\n   invites/\n    [token]/\n     page.tsx\n   login/\n    page.tsx\n   onboard/\n    page.tsx\n   orgs/\n    [slug]/\n     analytics/\n      page.tsx\n     billing/\n      purchase/\n       page.tsx\n      setup/\n       page.tsx\n     repositories/\n      page.tsx\n     settings/\n      page.tsx\n     team/\n      page.tsx\n     usage/\n      page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   payment-success/\n    page.tsx\n   pricing/\n    page.tsx\n   privacy-policy/\n    page.tsx\n   publishers/\n    [id]/\n     agents/\n      [agentId]/\n       [version]/\n        page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   referrals/\n    [code]/\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   terms-of-service/\n    page.tsx\n   usage/\n    layout.tsx\n    page.tsx\n    usage-display.tsx\n   analytics.knowledge.md\n   layout.tsx\n   page.tsx\n   robots.ts\n   sitemap.ts\n  components/\n   agent/\n    json-viewer.tsx\n   auto-topup/\n    AutoTopupSettings.tsx\n    AutoTopupSettingsForm.tsx\n    AutoTopupSwitch.tsx\n    BaseAutoTopupSettings.tsx\n    BaseAutoTopupSettingsForm.tsx\n    BaseAutoTopupSwitch.tsx\n    constants.ts\n    OrgAutoTopupSettings.tsx\n    OrgAutoTopupSettingsForm.tsx\n    OrgAutoTopupSwitch.tsx\n    types.ts\n   credits/\n    CreditManagementSection.tsx\n    CreditPurchaseSection.tsx\n   docs/\n    mdx/\n     code-demo.tsx\n     custom-link.tsx\n     markdown-table.tsx\n     mdx-components.tsx\n     mermaid-diagram.tsx\n     schema-display.tsx\n    copy-heading.tsx\n    doc-sidebar.tsx\n    docs.knowledge.md\n    toc.tsx\n   login/\n    login-card.tsx\n    login-client-wrapper.tsx\n   navbar/\n    navbar.tsx\n    user-dropdown.tsx\n   organization/\n    advanced-monitor.tsx\n    billing-alerts.tsx\n    billing-reports.tsx\n    billing-status.tsx\n    credit-monitor.tsx\n    model-config-sheet.tsx\n    organization-success-modal.tsx\n    repository-management.tsx\n    team-management.tsx\n   providers/\n    query-client-provider.tsx\n   publisher/\n    basic-info-step.tsx\n    ownership-step.tsx\n    profile-details-step.tsx\n    step-template.tsx\n   sign-in/\n    sign-in-button.tsx\n    sign-in-card-footer.tsx\n   ui/\n    landing/\n     competition/\n      claude-code.tsx\n      cline.tsx\n      cursor.tsx\n      github-copilot.tsx\n      index.tsx\n      tabs.tsx\n     feature/\n      browser-comparison.tsx\n      chart-illustration.tsx\n      code-illustration.tsx\n      highlight-text.tsx\n      index.tsx\n      workflow-illustration.tsx\n     animated-element.tsx\n     constants.ts\n     cta-section.tsx\n     demo-code-display.tsx\n     testimonials-section.tsx\n     types.ts\n    terminal/\n     index.tsx\n     style.css\n     terminal-input.tsx\n     terminal-output.tsx\n    avatar-upload.tsx\n    background-beams.tsx\n    badge.tsx\n    banner.tsx\n    button.tsx\n    card.tsx\n    collapsible.tsx\n    credit-confetti.tsx\n    decorative-blocks.tsx\n    dialog.tsx\n    dropdown-menu.tsx\n    enhanced-copy-button.tsx\n    footer.tsx\n    hero-buttons.tsx\n    hero.tsx\n    input.tsx\n    install-dialog.tsx\n    label.tsx\n    neon-gradient-button.tsx\n    progress.tsx\n    radio-group.tsx\n    section.tsx\n    select.tsx\n    separator.tsx\n    sheet.tsx\n    sidebar.tsx\n    skeleton-loading.tsx\n    skeleton.tsx\n    slider.tsx\n    switch.tsx\n    table.tsx\n    tabs.tsx\n    textarea.tsx\n    toast.tsx\n    toaster.tsx\n    tooltip.tsx\n    use-toast.ts\n   BrowserPreview.tsx\n   card-with-beams.tsx\n   CookieConsentCard.tsx\n   footer.tsx\n   icons.tsx\n   IDEDemo.tsx\n   layout-wrapper.tsx\n   TerminalDemo.tsx\n   theme-provider.tsx\n   theme-switcher.tsx\n  content/\n   advanced/\n    claude-code-comparison.mdx\n    config.mdx\n    how-does-it-work.mdx\n    large-projects.mdx\n    troubleshooting.mdx\n    what-models.mdx\n   agents/\n    agent-reference.mdx\n    creating-new-agents.mdx\n    customizing-agents.mdx\n    overview.mdx\n    troubleshooting-agent-customization.mdx\n   case-studies/\n    _cta.mdx\n    benjamin-bryant.mdx\n    oliver-lukesch.mdx\n   help/\n    faq.mdx\n    getting-started.mdx\n   tips/\n    best-practices.mdx\n    keyboard-shortcuts.mdx\n    knowledge-files.mdx\n    other-use-cases.mdx\n    version-control.mdx\n    where-levelcode-shines.mdx\n  discord/\n   client.ts\n   rate-limiter.ts\n  hooks/\n   use-auto-topup.ts\n   use-install-dialog.ts\n   use-mobile.tsx\n   use-model-config.ts\n   use-org-auto-topup.ts\n   use-organization-data.ts\n   use-user-profile.ts\n  lib/\n   server/\n    referral.ts\n   validators/\n    publisher.ts\n   admin-auth.ts\n   constant.ts\n   currency.ts\n   docs.ts\n   fonts.ts\n   organization-permissions.ts\n   PostHogProvider.tsx\n   publisher-permissions.ts\n   remark-code-to-codedemo.ts\n   server-init.ts\n   SessionProvider.tsx\n   stripe-utils.ts\n   testimonials.ts\n   trackConversions.ts\n   utils.ts\n  styles/\n   globals.css\n  types/\n   docs.ts\n   user.ts\n  util/\n   logger.ts\n .eslintignore\n .eslintrc.js\n .gitignore\n .prettierignore\n .prettierrc.js\n commitlint.config.js\n components.json\n contentlayer.config.ts\n jest.config.js\n jest.setup.js\n knowledge.md\n next.config.mjs\n package.json\n playwright.config.ts\n postcss.config.cjs\n README.md\n tailwind.config.ts\n tsconfig.json\n.envrc\n.gitignore\n.infisical.json\n.prettierrc\nauthentication.knowledge.md\nbun.lock\nbunfig.toml\nlevelcode.json\neslint.config.js\nknowledge.md\npackage.json\nREADME.md\ntsconfig.base.json\ntsconfig.json\nWINDOWS.md\n",
              "tokenCount": 9007,
              "truncationLevel": "none"
            }
          ]
        }
      ],
      "parentAgentId": "D-QYpeR_n1U"
    },
    {
      "type": "tool_result",
      "toolCallId": "80170260-0f51-4267-aef7-85b48109a7cc",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": ".github/workflows/ci.yml:\n1:# This workflow runs CI checks including building, typechecking, and testing the codebase\n18:    runs-on: ubuntu-latest\n51:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n80:  # Template for test jobs\n81:  test:\n90:    name: test-${{ matrix.package }}\n91:    runs-on: ubuntu-latest\n124:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n128:      - name: Run ${{ matrix.package }} tests\n133:          command: cd ${{ matrix.package }} && find src -name '*.test.ts' ! -name '*.integration.test.ts' | sort | xargs -I {} bun test {}\n140:  # Integration tests job\n141:  test-integration:\n150:    name: test-integration-${{ matrix.package }}\n151:    runs-on: ubuntu-latest\n184:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n\n.agents/base-max.ts:\n70:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n108:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n110:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n149:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n310:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n./npm-app/src/cli-handlers/checkpoint.ts:\n189:    const latestCheckpoint = checkpointManager.getLatestCheckpoint()\n190:    await latestCheckpoint?.fileStateIdPromise\n198:      'Failed to wait for latest checkpoint file state',\n243:    await checkpointManager.getLatestCheckpoint().fileStateIdPromise\n245:    // No latest checkpoint available, previous checkpoint is guaranteed to be done.\n\n.github/workflows/nightly-evals.yml:\n11:    runs-on: ubuntu-latest\n45:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n\n./npm-app/src/cli-handlers/agent-creation-chat.ts:\n108:        'Continue adjusting your agent here, or type \"/agents\" to switch agents and test it out.',\n\n.agents/base-experimental.ts:\n70:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n108:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n110:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n149:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n318:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n.agents/ask.ts:\n62:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n123:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n\n.github/workflows/npm-app-release-build.yml:\n34:          - os: ubuntu-latest\n39:          - os: ubuntu-latest\n54:          - os: windows-latest\n129:          # Only test if we're building for the native architecture\n131:            echo \"Skipping test for cross-compiled ARM64 binary\"\n\n./npm-app/src/cli-handlers/subagent-list.ts:\n197:              const testLine =\n200:                testLine.replace(/\\u001b\\[[0-9;]*m/g, '').length <=\n203:                currentLine = testLine\n233:          const testLine = `${currentLine} ${word}`\n235:            testLine.replace(/\\u001b\\[[0-9;]*m/g, '').length <= maxLineLength\n237:            currentLine = testLine\n\n.github/workflows/npm-app-release-staging.yml:\n18:    runs-on: ubuntu-latest\n57:          # Get latest beta version from npm to check if we need to increment\n58:          echo \"Fetching latest beta version from npm...\"\n59:          LATEST_BETA=$(npm view codecane@latest version 2>/dev/null || echo \"\")\n65:            echo \"Latest beta version: $LATEST_BETA\"\n143:    runs-on: ubuntu-latest\n228:              \\\"body\\\": \\\"## Codecane v${{ needs.prepare-and-commit-staging.outputs.new_version }} (Staging)\\n\\n** This is a staging/beta release for testing purposes.**\\n\\nBinary releases for all supported platforms.\\n\\n### Installation\\n\\`\\`\\`bash\\nnpm install -g codecane\\n\\`\\`\\`\\n\\n### Platform Binaries\\n- \\`codecane-linux-x64.tar.gz\\` - Linux x64\\n- \\`codecane-linux-arm64.tar.gz\\` - Linux ARM64\\n- \\`codecane-darwin-x64.tar.gz\\` - macOS Intel\\n- \\`codecane-darwin-arm64.tar.gz\\` - macOS Apple Silicon\\n- \\`codecane-win32-x64.tar.gz\\` - Windows x64\\\",\n258:    runs-on: ubuntu-latest\n\n.github/workflows/evals.yml:\n9:    runs-on: ubuntu-latest\n61:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n\n.github/workflows/npm-app-release-prod.yml:\n22:    runs-on: ubuntu-latest\n105:    runs-on: ubuntu-latest\n150:    runs-on: ubuntu-latest\n\n./npm-app/src/menu.ts:\n400:${hasKnowledgeMd && !hasLevelCodeJson ? `\\n${yellow(`${levelcodeConfigFile} runs deployment scripts for you to test your code and runs configured checks for you by running your dev server.`)}` : ''}\n402:${!hasKnowledgeMd && !hasLevelCodeJson ? `\\n${yellow('knowledge.md helps LevelCode understand your project structure and codebase better for better results.')}\\n${yellow(`${levelcodeConfigFile} runs deployment scripts for you to test your code and runs configured checks for you by running your dev server.`)}` : ''}`\n422:${cyan('   \"Create a unit test for the auth module\"')}\n\n.github/knowledge.md:\n8:2. **Test Job**: Runs tests for npm-app, backend, and common packages in parallel using matrix strategy\n27:Each test job:\n29:- Runs unit tests only (excludes integration tests)\n31:- Sets `LEVELCODE_GITHUB_ACTIONS=true` and `NEXT_PUBLIC_CB_ENVIRONMENT=test`\n37:- Test environment flags are set for proper test execution\n42:- Build job must complete before test jobs start (`needs: build`)\n87:   bun act -j test-backend\n135:2. If tests fail with environment issues:\n153:6. Use the retry mechanism for flaky tests\n\n./npm-app/src/create-template-project.ts:\n20:  if (!/^[a-zA-Z0-9-_]+$/.test(template)) {\n36:  if (!/^[a-zA-Z0-9-_]+$/.test(projectName)) {\n\n./npm-app/src/client.ts:\n126:    console.log('Make sure you are on the latest version of LevelCode!')\n1121:        )}: Runs tests, linting, and type checking when you modify files\\n ${bold(\n1373:            checkpointAddendum = ` or \"checkpoint ${checkpointManager.getLatestCheckpoint().id}\" to revert`\n1375:            // No latest checkpoint, don't show addendum\n1382:              'No latest checkpoint for addendum',\n\n.agents/base-lite.ts:\n70:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n108:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n110:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n149:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n312:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n.agents/claude4-gemini-thinking.ts:\n65:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n103:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n105:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n144:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n305:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n.agents/reviewer.ts:\n39:4. Always run hooks for TypeScript/JavaScript changes, test file changes, or when the changes could affect compilation/tests\n\n./npm-app/src/__tests__/display.test.ts:\n1:import { describe, expect, it } from 'bun:test'\n\n.agents/types/tools.d.ts:\n56:  /** Optional ripgrep flags to customize the search (e.g., \"-i\" for case-insensitive, \"-t ts\" for TypeScript files only, \"-A 3\" for 3 lines after match, \"-B 2\" for 2 lines before match, \"--type-not test\" to exclude test files). */\n\n.agents/base.ts:\n70:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n108:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n110:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n149:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n310:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n./backend/src/live-user-inputs.ts:\n88:// For testing purposes - reset all state\n\n./backend/src/__tests__/live-user-inputs.test.ts:\n1:import { describe, it, expect, beforeEach, afterEach } from 'bun:test'\n15:    // Clear any existing state before each test\n20:    // Clean up any state after each test\n95:      // For unit testing, we'll test the function directly\n105:      // For unit testing, we'll test that endUserInput doesn't remove the input\n\n./backend/src/llm-apis/message-cost-tracker.ts:\n245:        'Skipping Stripe sync (no user or test user).',\n591:          `Credits used by test user (${creditsUsed})`,\n\n./backend/src/__tests__/loop-agent-steps.test.ts:\n6:} from '@levelcode/common/testing/mock-modules'\n18:} from 'bun:test'\n22:import { mockFileContext, MockWebSocket } from './test-utils'\n66:    // Mock live user inputs - will be overridden in individual tests\n68:      checkLiveUserInput: () => false, // Default to false, override in tests\n136:      processedRepoId: 'test-repo-id',\n\n[Output size limit reached.]",
            "message": "Stopped early after 110 match(es)."
          }
        }
      ],
      "parentAgentId": "D-QYgBIs_zY"
    },
    {
      "type": "tool_call",
      "toolCallId": "41c2f662-c174-4235-9585-75e3588576c6",
      "toolName": "code_search",
      "input": {
        "pattern": "AGENT_PERSONAS",
        "flags": "-g *.ts"
      },
      "agentId": "D-QYgBIs_zY",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "41c2f662-c174-4235-9585-75e3588576c6",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": "./backend/src/templates/agents/planner.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n12:  displayName: AGENT_PERSONAS.planner.displayName,\n13:  spawnPurposePrompt: AGENT_PERSONAS.planner.purpose,\n\n./backend/src/templates/agents/superagent.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n15:  displayName: AGENT_PERSONAS.superagent.displayName,\n16:  spawnPurposePrompt: AGENT_PERSONAS.superagent.purpose,\n\n./backend/src/templates/agents/ask.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n17:  displayName: AGENT_PERSONAS.ask.displayName,\n\n./backend/src/templates/agents/thinking-base.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n19:  displayName: AGENT_PERSONAS.base_lite.displayName,\n20:  spawnPurposePrompt: AGENT_PERSONAS.base_lite.purpose,\n\n./backend/src/templates/agents/reviewer.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n12:  displayName: AGENT_PERSONAS.reviewer.displayName,\n13:  spawnPurposePrompt: AGENT_PERSONAS.reviewer.purpose,\n\n./backend/src/templates/agents/thinker.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n12:  displayName: AGENT_PERSONAS.thinker.displayName,\n13:  spawnPurposePrompt: AGENT_PERSONAS.thinker.purpose,\n\n./backend/src/templates/agents/archive/dry-run.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n11:  displayName: AGENT_PERSONAS.dry_run.displayName,\n12:  spawnPurposePrompt: AGENT_PERSONAS.dry_run.purpose,\n\n./backend/src/templates/agents/researcher.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n12:  displayName: AGENT_PERSONAS.researcher.displayName,\n13:  spawnPurposePrompt: AGENT_PERSONAS.researcher.purpose,\n\n./backend/src/templates/agents/base.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n19:  displayName: AGENT_PERSONAS.base.displayName,\n20:  spawnPurposePrompt: AGENT_PERSONAS.base.purpose,\n\n./backend/src/templates/agents/file-picker.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n11:  displayName: AGENT_PERSONAS.file_picker.displayName,\n12:  spawnPurposePrompt: AGENT_PERSONAS.file_picker.purpose,\n\n./common/src/constants/agents.ts:\n4:export const AGENT_PERSONAS = {\n90:// Agent IDs list from AGENT_PERSONAS keys\n92:  AGENT_PERSONAS,\n93:) as (keyof typeof AGENT_PERSONAS)[]\n100:  Object.entries(AGENT_PERSONAS).map(([agentType, persona]) => [\n104:) as Record<keyof typeof AGENT_PERSONAS, string>\n107:  (typeof AGENT_PERSONAS)[keyof typeof AGENT_PERSONAS]['displayName']\n112:    Object.values(AGENT_PERSONAS)\n\n./common/src/util/agent-name-resolver.ts:\n1:import { AGENT_PERSONAS } from '../constants/agents'\n14:  return Object.entries(AGENT_PERSONAS)",
            "message": "Exit code: 0"
          }
        }
      ],
      "parentAgentId": "D-QYgBIs_zY"
    },
    {
      "type": "tool_call",
      "toolCallId": "47db3dd1-6ef0-43b2-b7c5-559c7354fb60",
      "toolName": "set_output",
      "input": {
        "results": [
          {
            "stdout": ".github/workflows/ci.yml:\n1:# This workflow runs CI checks including building, typechecking, and testing the codebase\n18:    runs-on: ubuntu-latest\n51:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n80:  # Template for test jobs\n81:  test:\n90:    name: test-${{ matrix.package }}\n91:    runs-on: ubuntu-latest\n124:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n128:      - name: Run ${{ matrix.package }} tests\n133:          command: cd ${{ matrix.package }} && find src -name '*.test.ts' ! -name '*.integration.test.ts' | sort | xargs -I {} bun test {}\n140:  # Integration tests job\n141:  test-integration:\n150:    name: test-integration-${{ matrix.package }}\n151:    runs-on: ubuntu-latest\n184:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n\n.agents/base-max.ts:\n70:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n108:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n110:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n149:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n310:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n./npm-app/src/cli-handlers/checkpoint.ts:\n189:    const latestCheckpoint = checkpointManager.getLatestCheckpoint()\n190:    await latestCheckpoint?.fileStateIdPromise\n198:      'Failed to wait for latest checkpoint file state',\n243:    await checkpointManager.getLatestCheckpoint().fileStateIdPromise\n245:    // No latest checkpoint available, previous checkpoint is guaranteed to be done.\n\n.github/workflows/nightly-evals.yml:\n11:    runs-on: ubuntu-latest\n45:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n\n./npm-app/src/cli-handlers/agent-creation-chat.ts:\n108:        'Continue adjusting your agent here, or type \"/agents\" to switch agents and test it out.',\n\n.agents/base-experimental.ts:\n70:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n108:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n110:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n149:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n318:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n.agents/ask.ts:\n62:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n123:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n\n.github/workflows/npm-app-release-build.yml:\n34:          - os: ubuntu-latest\n39:          - os: ubuntu-latest\n54:          - os: windows-latest\n129:          # Only test if we're building for the native architecture\n131:            echo \"Skipping test for cross-compiled ARM64 binary\"\n\n./npm-app/src/cli-handlers/subagent-list.ts:\n197:              const testLine =\n200:                testLine.replace(/\\u001b\\[[0-9;]*m/g, '').length <=\n203:                currentLine = testLine\n233:          const testLine = `${currentLine} ${word}`\n235:            testLine.replace(/\\u001b\\[[0-9;]*m/g, '').length <= maxLineLength\n237:            currentLine = testLine\n\n.github/workflows/npm-app-release-staging.yml:\n18:    runs-on: ubuntu-latest\n57:          # Get latest beta version from npm to check if we need to increment\n58:          echo \"Fetching latest beta version from npm...\"\n59:          LATEST_BETA=$(npm view codecane@latest version 2>/dev/null || echo \"\")\n65:            echo \"Latest beta version: $LATEST_BETA\"\n143:    runs-on: ubuntu-latest\n228:              \\\"body\\\": \\\"## Codecane v${{ needs.prepare-and-commit-staging.outputs.new_version }} (Staging)\\n\\n** This is a staging/beta release for testing purposes.**\\n\\nBinary releases for all supported platforms.\\n\\n### Installation\\n\\`\\`\\`bash\\nnpm install -g codecane\\n\\`\\`\\`\\n\\n### Platform Binaries\\n- \\`codecane-linux-x64.tar.gz\\` - Linux x64\\n- \\`codecane-linux-arm64.tar.gz\\` - Linux ARM64\\n- \\`codecane-darwin-x64.tar.gz\\` - macOS Intel\\n- \\`codecane-darwin-arm64.tar.gz\\` - macOS Apple Silicon\\n- \\`codecane-win32-x64.tar.gz\\` - Windows x64\\\",\n258:    runs-on: ubuntu-latest\n\n.github/workflows/evals.yml:\n9:    runs-on: ubuntu-latest\n61:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n\n.github/workflows/npm-app-release-prod.yml:\n22:    runs-on: ubuntu-latest\n105:    runs-on: ubuntu-latest\n150:    runs-on: ubuntu-latest\n\n./npm-app/src/menu.ts:\n400:${hasKnowledgeMd && !hasLevelCodeJson ? `\\n${yellow(`${levelcodeConfigFile} runs deployment scripts for you to test your code and runs configured checks for you by running your dev server.`)}` : ''}\n402:${!hasKnowledgeMd && !hasLevelCodeJson ? `\\n${yellow('knowledge.md helps LevelCode understand your project structure and codebase better for better results.')}\\n${yellow(`${levelcodeConfigFile} runs deployment scripts for you to test your code and runs configured checks for you by running your dev server.`)}` : ''}`\n422:${cyan('   \"Create a unit test for the auth module\"')}\n\n.github/knowledge.md:\n8:2. **Test Job**: Runs tests for npm-app, backend, and common packages in parallel using matrix strategy\n27:Each test job:\n29:- Runs unit tests only (excludes integration tests)\n31:- Sets `LEVELCODE_GITHUB_ACTIONS=true` and `NEXT_PUBLIC_CB_ENVIRONMENT=test`\n37:- Test environment flags are set for proper test execution\n42:- Build job must complete before test jobs start (`needs: build`)\n87:   bun act -j test-backend\n135:2. If tests fail with environment issues:\n153:6. Use the retry mechanism for flaky tests\n\n./npm-app/src/create-template-project.ts:\n20:  if (!/^[a-zA-Z0-9-_]+$/.test(template)) {\n36:  if (!/^[a-zA-Z0-9-_]+$/.test(projectName)) {\n\n./npm-app/src/client.ts:\n126:    console.log('Make sure you are on the latest version of LevelCode!')\n1121:        )}: Runs tests, linting, and type checking when you modify files\\n ${bold(\n1373:            checkpointAddendum = ` or \"checkpoint ${checkpointManager.getLatestCheckpoint().id}\" to revert`\n1375:            // No latest checkpoint, don't show addendum\n1382:              'No latest checkpoint for addendum',\n\n.agents/base-lite.ts:\n70:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n108:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n110:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n149:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n312:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n.agents/claude4-gemini-thinking.ts:\n65:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n103:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n105:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n144:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n305:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n.agents/reviewer.ts:\n39:4. Always run hooks for TypeScript/JavaScript changes, test file changes, or when the changes could affect compilation/tests\n\n./npm-app/src/__tests__/display.test.ts:\n1:import { describe, expect, it } from 'bun:test'\n\n.agents/types/tools.d.ts:\n56:  /** Optional ripgrep flags to customize the search (e.g., \"-i\" for case-insensitive, \"-t ts\" for TypeScript files only, \"-A 3\" for 3 lines after match, \"-B 2\" for 2 lines before match, \"--type-not test\" to exclude test files). */\n\n.agents/base.ts:\n70:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n108:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n110:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n149:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n310:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n./backend/src/live-user-inputs.ts:\n88:// For testing purposes - reset all state\n\n./backend/src/__tests__/live-user-inputs.test.ts:\n1:import { describe, it, expect, beforeEach, afterEach } from 'bun:test'\n15:    // Clear any existing state before each test\n20:    // Clean up any state after each test\n95:      // For unit testing, we'll test the function directly\n105:      // For unit testing, we'll test that endUserInput doesn't remove the input\n\n./backend/src/llm-apis/message-cost-tracker.ts:\n245:        'Skipping Stripe sync (no user or test user).',\n591:          `Credits used by test user (${creditsUsed})`,\n\n./backend/src/__tests__/loop-agent-steps.test.ts:\n6:} from '@levelcode/common/testing/mock-modules'\n18:} from 'bun:test'\n22:import { mockFileContext, MockWebSocket } from './test-utils'\n66:    // Mock live user inputs - will be overridden in individual tests\n68:      checkLiveUserInput: () => false, // Default to false, override in tests\n136:      processedRepoId: 'test-repo-id',\n\n[Output size limit reached.]",
            "message": "Stopped early after 110 match(es)."
          },
          {
            "stdout": "./backend/src/templates/agents/planner.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n12:  displayName: AGENT_PERSONAS.planner.displayName,\n13:  spawnPurposePrompt: AGENT_PERSONAS.planner.purpose,\n\n./backend/src/templates/agents/superagent.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n15:  displayName: AGENT_PERSONAS.superagent.displayName,\n16:  spawnPurposePrompt: AGENT_PERSONAS.superagent.purpose,\n\n./backend/src/templates/agents/ask.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n17:  displayName: AGENT_PERSONAS.ask.displayName,\n\n./backend/src/templates/agents/thinking-base.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n19:  displayName: AGENT_PERSONAS.base_lite.displayName,\n20:  spawnPurposePrompt: AGENT_PERSONAS.base_lite.purpose,\n\n./backend/src/templates/agents/reviewer.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n12:  displayName: AGENT_PERSONAS.reviewer.displayName,\n13:  spawnPurposePrompt: AGENT_PERSONAS.reviewer.purpose,\n\n./backend/src/templates/agents/thinker.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n12:  displayName: AGENT_PERSONAS.thinker.displayName,\n13:  spawnPurposePrompt: AGENT_PERSONAS.thinker.purpose,\n\n./backend/src/templates/agents/archive/dry-run.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n11:  displayName: AGENT_PERSONAS.dry_run.displayName,\n12:  spawnPurposePrompt: AGENT_PERSONAS.dry_run.purpose,\n\n./backend/src/templates/agents/researcher.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n12:  displayName: AGENT_PERSONAS.researcher.displayName,\n13:  spawnPurposePrompt: AGENT_PERSONAS.researcher.purpose,\n\n./backend/src/templates/agents/base.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n19:  displayName: AGENT_PERSONAS.base.displayName,\n20:  spawnPurposePrompt: AGENT_PERSONAS.base.purpose,\n\n./backend/src/templates/agents/file-picker.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n11:  displayName: AGENT_PERSONAS.file_picker.displayName,\n12:  spawnPurposePrompt: AGENT_PERSONAS.file_picker.purpose,\n\n./common/src/constants/agents.ts:\n4:export const AGENT_PERSONAS = {\n90:// Agent IDs list from AGENT_PERSONAS keys\n92:  AGENT_PERSONAS,\n93:) as (keyof typeof AGENT_PERSONAS)[]\n100:  Object.entries(AGENT_PERSONAS).map(([agentType, persona]) => [\n104:) as Record<keyof typeof AGENT_PERSONAS, string>\n107:  (typeof AGENT_PERSONAS)[keyof typeof AGENT_PERSONAS]['displayName']\n112:    Object.values(AGENT_PERSONAS)\n\n./common/src/util/agent-name-resolver.ts:\n1:import { AGENT_PERSONAS } from '../constants/agents'\n14:  return Object.entries(AGENT_PERSONAS)",
            "message": "Exit code: 0"
          }
        ]
      },
      "agentId": "D-QYgBIs_zY",
      "parentAgentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "47db3dd1-6ef0-43b2-b7c5-559c7354fb60",
      "toolName": "set_output",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Output set"
          }
        }
      ],
      "parentAgentId": "D-QYgBIs_zY"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-QYgBIs_zY",
      "agentType": "code-searcher",
      "displayName": "Code Searcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "searchQueries": [
          {
            "pattern": "bun run typecheck|lint|test"
          },
          {
            "pattern": "AGENT_PERSONAS",
            "flags": "-g *.ts"
          }
        ]
      }
    },
    {
      "type": "text",
      "agentId": "D-QYfz6Uj58",
      "text": "package.json\nbackend/package.json\ncommon/package.json\nevals/package.json\nnpm-app/package.json\npackages/bigquery/package.json\npackages/billing/package.json\npackages/build-tools/package.json\npackages/code-map/package.json\npackages/internal/package.json\nscripts/package.json\nsdk/package.json"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-QYpeR_n1U",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-QYfz6Uj58",
      "prompt": "package.json scripts for testing, linting, typechecking",
      "params": {}
    },
    {
      "type": "tool_result",
      "toolCallId": "b5cf7c6b-266d-4758-8e9e-069117fc61ec",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Liszt the File Lister",
              "agentType": "file-lister",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "package.json\nbackend/package.json\ncommon/package.json\nevals/package.json\nnpm-app/package.json\npackages/bigquery/package.json\npackages/billing/package.json\npackages/build-tools/package.json\npackages/code-map/package.json\npackages/internal/package.json\nscripts/package.json\nsdk/package.json"
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ],
      "parentAgentId": "D-QYfz6Uj58"
    },
    {
      "type": "tool_call",
      "toolCallId": "5f37dfa7-6bd0-424d-8624-420665495612",
      "toolName": "read_files",
      "input": {
        "paths": [
          "package.json",
          "backend/package.json",
          "common/package.json",
          "evals/package.json",
          "npm-app/package.json",
          "packages/bigquery/package.json",
          "packages/billing/package.json",
          "packages/build-tools/package.json",
          "packages/code-map/package.json",
          "packages/internal/package.json",
          "scripts/package.json",
          "sdk/package.json"
        ]
      },
      "agentId": "D-QYfz6Uj58",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "5f37dfa7-6bd0-424d-8624-420665495612",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": "package.json",
              "content": "{\n  \"name\": \"levelcode-project\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"license\": \"UNLICENSED\",\n  \"type\": \"module\",\n  \"workspaces\": [\n    \"common\",\n    \"backend\",\n    \"npm-app\",\n    \"web\",\n    \"packages/*\",\n    \"scripts\",\n    \"evals\",\n    \"sdk\"\n  ],\n  \"scripts\": {\n    \"dev\": \"bash scripts/dev.sh\",\n    \"start-db\": \"bun --cwd common db:start\",\n    \"start-bin\": \"bun --cwd npm-app start-bin\",\n    \"start-web\": \"bun start-db && bun --cwd web dev\",\n    \"start-studio\": \"bun --cwd common db:studio\",\n    \"start-server\": \"bun --cwd backend dev\",\n    \"start-manifold\": \"bun --cwd npm-app start-manifold\",\n    \"start-levelcode-test\": \"bun --cwd npm-app start --cwd ../../levelcode-test\",\n    \"start-litestar\": \"bun --cwd npm-app start-litestar\",\n    \"start-jpcsp\": \"bun --cwd npm-app start-jpcsp\",\n    \"start-vscode\": \"bun --cwd npm-app start-vscode\",\n    \"start-nushell\": \"bun --cwd npm-app start-nushell\",\n    \"format\": \"prettier --write \\\"**/*.{ts,tsx,json,md}\\\"\",\n    \"release:npm-app\": \"bun run --cwd npm-app release\",\n    \"clean-ts\": \"find . -name '*.tsbuildinfo' -type f -delete && find . -name '.next' -type d -exec rm -rf {} + 2>/dev/null || true && find . -name 'node_modules' -type d -exec rm -rf {} + 2>/dev/null || true && bun install\",\n    \"typecheck\": \"bun --filter='*' run typecheck && echo ' All type checks passed!'\",\n    \"test\": \"bun --filter='{@levelcode/backend,@levelcode/common,@levelcode/npm-app}' run test\",\n    \"init-worktree\": \"bun scripts/init-worktree.ts\",\n    \"cleanup-worktree\": \"bash scripts/cleanup-worktree.sh\",\n    \"generate-tool-definitions\": \"bun scripts/generate-tool-definitions.ts\"\n  },\n  \"dependencies\": {\n    \"@t3-oss/env-nextjs\": \"^0.7.3\",\n    \"zod\": \"3.25.67\"\n  },\n  \"overrides\": {\n    \"zod\": \"3.25.67\"\n  },\n  \"devDependencies\": {\n    \"@tanstack/react-query\": \"^5.59.16\",\n    \"@types/bun\": \"^1.2.11\",\n    \"@types/lodash\": \"4.17.7\",\n    \"@types/node\": \"^22.9.0\",\n    \"@types/node-fetch\": \"^2.6.12\",\n    \"@types/parse-path\": \"^7.1.0\",\n    \"@typescript-eslint/eslint-plugin\": \"^6.17\",\n    \"bun-types\": \"^1.2.2\",\n    \"eslint-config-prettier\": \"^9.1.0\",\n    \"eslint-plugin-import\": \"^2.29.1\",\n    \"eslint-plugin-unused-imports\": \"^4.1.4\",\n    \"ignore\": \"^6.0.2\",\n    \"lodash\": \"4.17.21\",\n    \"prettier\": \"3.3.2\",\n    \"ts-node\": \"^10.9.2\",\n    \"ts-pattern\": \"^5.5.0\",\n    \"tsc-alias\": \"1.7.0\",\n    \"tsconfig-paths\": \"4.2.0\",\n    \"types\": \"^0.1.1\",\n    \"typescript\": \"5.5.4\",\n    \"typescript-eslint\": \"^7.17.0\"\n  },\n  \"engines\": {\n    \"node\": \">=20.0.0\"\n  },\n  \"packageManager\": \"yarn@1.22.22+sha512.a6b2f7906b721bba3d67d4aff083df04dad64c399707841b7acf00f6b133b7ac24255f2652fa22ae3534329dc6180534e98d17432037ff6fd140556e2bb3137e\"\n}\n",
              "referencedBy": {}
            },
            {
              "path": "backend/package.json",
              "content": "{\n  \"name\": \"@levelcode/backend\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Backend server for LevelCode\",\n  \"private\": true,\n  \"license\": \"UNLICENSED\",\n  \"type\": \"module\",\n  \"exports\": {\n    \"./*\": {\n      \"bun\": \"./src/*.ts\",\n      \"import\": \"./src/*.ts\",\n      \"types\": \"./src/*.ts\",\n      \"default\": \"./src/*.ts\"\n    }\n  },\n  \"scripts\": {\n    \"start\": \"bun src/index.ts\",\n    \"dev\": \"bun src/index.ts\",\n    \"typecheck\": \"tsc --noEmit -p .\",\n    \"test\": \"bun test\"\n  },\n  \"sideEffects\": false,\n  \"engines\": {\n    \"bun\": \">=1.2.11\"\n  },\n  \"dependencies\": {\n    \"@ai-sdk/google-vertex\": \"2.2.24\",\n    \"@ai-sdk/openai\": \"1.3.22\",\n    \"@levelcode/billing\": \"workspace:*\",\n    \"@levelcode/common\": \"workspace:*\",\n    \"@levelcode/internal\": \"workspace:*\",\n    \"@google-cloud/vertexai\": \"1.10.0\",\n    \"@google/generative-ai\": \"0.24.1\",\n    \"ai\": \"4.3.16\",\n    \"cors\": \"^2.8.5\",\n    \"diff\": \"5.2.0\",\n    \"dotenv\": \"16.4.5\",\n    \"express\": \"4.19.2\",\n    \"gpt-tokenizer\": \"2.8.1\",\n    \"ignore\": \"5.3.2\",\n    \"@jitl/quickjs-wasmfile-release-sync\": \"0.31.0\",\n    \"quickjs-emscripten-core\": \"0.31.0\",\n    \"lodash\": \"*\",\n    \"openai\": \"^4.78.1\",\n    \"pino\": \"9.4.0\",\n    \"postgres\": \"3.4.4\",\n    \"posthog-node\": \"^4.14.0\",\n    \"ts-pattern\": \"5.3.1\",\n    \"ws\": \"8.18.0\",\n    \"zod\": \"3.25.67\",\n    \"zod-from-json-schema\": \"0.4.2\"\n  },\n  \"devDependencies\": {\n    \"@types/cors\": \"^2.8.19\",\n    \"@types/diff\": \"^5.0.3\",\n    \"@types/express\": \"^4.17.13\",\n    \"@types/ws\": \"^8.5.5\"\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/package.json",
              "content": "{\n  \"name\": \"@levelcode/common\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Common utilities for LevelCode\",\n  \"private\": true,\n  \"license\": \"UNLICENSED\",\n  \"type\": \"module\",\n  \"exports\": {\n    \"./db\": {\n      \"bun\": \"./src/db/index.ts\",\n      \"import\": \"./src/db/index.ts\",\n      \"types\": \"./src/db/index.ts\",\n      \"default\": \"./src/db/index.ts\"\n    },\n    \"./*\": {\n      \"bun\": \"./src/*.ts\",\n      \"import\": \"./src/*.ts\",\n      \"types\": \"./src/*.ts\",\n      \"default\": \"./src/*.ts\"\n    }\n  },\n  \"scripts\": {\n    \"typecheck\": \"tsc --noEmit -p .\",\n    \"test\": \"bun test\",\n    \"db:generate\": \"drizzle-kit generate --config=./src/db/drizzle.config.ts\",\n    \"db:migrate\": \"drizzle-kit push --config=./src/db/drizzle.config.ts\",\n    \"db:start\": \"docker compose -f ./src/db/docker-compose.yml up --wait && bun run db:generate && (timeout 1 || sleep 1) && bun run db:migrate\",\n    \"db:studio\": \"drizzle-kit studio --config=./src/db/drizzle.config.ts\"\n  },\n  \"sideEffects\": false,\n  \"engines\": {\n    \"bun\": \">=1.2.11\"\n  },\n  \"dependencies\": {\n    \"@auth/drizzle-adapter\": \"^1.5.0\",\n    \"@types/pg\": \"^8.11.10\",\n    \"@types/readable-stream\": \"^4.0.18\",\n    \"@types/seedrandom\": \"^3.0.8\",\n    \"ai\": \"4.3.16\",\n    \"drizzle-kit\": \"0.28.1\",\n    \"drizzle-orm\": \"0.36.4\",\n    \"ignore\": \"5.3.2\",\n    \"lodash\": \"*\",\n    \"next-auth\": \"^4.24.7\",\n    \"partial-json\": \"^0.1.7\",\n    \"pg\": \"^8.14.1\",\n    \"readable-stream\": \"^4.7.0\",\n    \"seedrandom\": \"^3.0.5\",\n    \"stripe\": \"^16.11.0\",\n    \"zod\": \"3.25.67\"\n  },\n  \"devDependencies\": {\n    \"@types/parse-path\": \"^7.1.0\"\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "evals/package.json",
              "content": "{\n  \"name\": \"@levelcode/evals\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Evaluation scripts for LevelCode\",\n  \"private\": true,\n  \"license\": \"UNLICENSED\",\n  \"type\": \"module\",\n  \"exports\": {\n    \".\": {\n      \"bun\": \"./src/index.ts\",\n      \"types\": \"./src/index.ts\"\n    }\n  },\n  \"scripts\": {\n    \"typecheck\": \"tsc --noEmit -p .\",\n    \"test\": \"bun test\",\n    \"test:manifold\": \"bun test manifold.test.ts\",\n    \"test:pglite\": \"bun test pglite-demo.test.ts\",\n    \"test:swe-bench\": \"bun test swe-bench.test.ts\",\n    \"test:e2e-cat-app\": \"bun run e2e-cat-app-script.ts\",\n    \"gen-git-evals\": \"bun run git-evals/gen-evals.ts\",\n    \"run-single-eval\": \"bun run git-evals/run-single-eval.ts --eval-file git-evals/eval-manifold.json --commit-sha ebabf7796a92ce8ece8e2452b0f3f896a513ba0e\",\n    \"run-git-evals\": \"bun run git-evals/run-git-evals.ts\",\n    \"run-eval-set\": \"bun run git-evals/run-eval-set.ts\",\n    \"setup-levelcode-repo\": \"bun run setup-levelcode-repo.ts\"\n  },\n  \"sideEffects\": false,\n  \"engines\": {\n    \"bun\": \">=1.2.11\"\n  },\n  \"dependencies\": {\n    \"@levelcode/backend\": \"workspace:*\",\n    \"@levelcode/code-map\": \"workspace:*\",\n    \"@levelcode/common\": \"workspace:*\",\n    \"@levelcode/internal\": \"workspace:*\",\n    \"@levelcode/npm-app\": \"workspace:*\",\n    \"@oclif/core\": \"^4.4.0\",\n    \"@oclif/parser\": \"^3.8.17\",\n    \"async\": \"^3.2.6\",\n    \"lodash\": \"^4.17.21\",\n    \"p-limit\": \"^6.2.0\",\n    \"zod\": \"3.25.67\"\n  },\n  \"devDependencies\": {\n    \"@types/async\": \"^3.2.24\"\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "npm-app/package.json",
              "content": "{\n  \"name\": \"@levelcode/npm-app\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"description\": \"cli for levelcode\",\n  \"license\": \"MIT\",\n  \"main\": \"dist/index.js\",\n  \"types\": \"dist/index.d.ts\",\n  \"type\": \"module\",\n  \"exports\": {\n    \"./*\": {\n      \"bun\": \"./src/*.ts\",\n      \"import\": \"./src/*.ts\",\n      \"types\": \"./src/*.ts\",\n      \"default\": \"./src/*.ts\"\n    }\n  },\n  \"bin\": {\n    \"levelcode\": \"dist/index.js\"\n  },\n  \"scripts\": {\n    \"typecheck\": \"tsc --noEmit -p .\",\n    \"build\": \"bun run scripts/build-binary.js levelcode $(node -p \\\"require('./release/package.json').version\\\")\",\n    \"release\": \"bun run scripts/release.js\",\n    \"start-bin\": \"bun run build && ./bin/levelcode\",\n    \"start\": \"bun run src/index.ts --cwd ..\",\n    \"format\": \"prettier --write \\\"**/*.{ts,tsx,json,md}\\\"\",\n    \"postinstall\": \"bun scripts/patch-web-tree-sitter.ts\"\n  },\n  \"files\": [\n    \"README.md\"\n  ],\n  \"engines\": {\n    \"bun\": \">=1.2.11\"\n  },\n  \"dependencies\": {\n    \"@levelcode/code-map\": \"workspace:*\",\n    \"@levelcode/common\": \"workspace:*\",\n    \"@types/diff\": \"5.2.1\",\n    \"@types/micromatch\": \"^4.0.9\",\n    \"@vscode/ripgrep\": \"1.15.9\",\n    \"ai\": \"4.3.16\",\n    \"axios\": \"1.7.4\",\n    \"commander\": \"^13.1.0\",\n    \"diff\": \"5.2.0\",\n    \"git-url-parse\": \"^16.1.0\",\n    \"ignore\": \"7.0.3\",\n    \"isomorphic-git\": \"^1.29.0\",\n    \"lodash\": \"*\",\n    \"micromatch\": \"^4.0.8\",\n    \"nanoid\": \"5.0.7\",\n    \"onetime\": \"5.1.2\",\n    \"picocolors\": \"1.1.0\",\n    \"pino\": \"9.4.0\",\n    \"posthog-node\": \"4.17.2\",\n    \"puppeteer-core\": \"^24.2.0\",\n    \"string-width\": \"^7.2.0\",\n    \"systeminformation\": \"5.23.4\",\n    \"ts-pattern\": \"5.3.1\",\n    \"wrap-ansi\": \"^9.0.0\",\n    \"ws\": \"8.18.0\",\n    \"zod\": \"3.25.67\"\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "packages/bigquery/package.json",
              "content": "{\n  \"name\": \"@levelcode/bigquery\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"license\": \"UNLICENSED\",\n  \"type\": \"module\",\n  \"exports\": {\n    \".\": {\n      \"bun\": \"./src/index.ts\",\n      \"import\": \"./src/index.ts\",\n      \"types\": \"./src/index.ts\",\n      \"default\": \"./src/index.ts\"\n    },\n    \"./*\": {\n      \"bun\": \"./src/*.ts\",\n      \"import\": \"./src/*.ts\",\n      \"types\": \"./src/*.ts\",\n      \"default\": \"./src/*.ts\"\n    }\n  },\n  \"scripts\": {\n    \"typecheck\": \"tsc --noEmit -p .\",\n    \"test\": \"bun test\"\n  },\n  \"sideEffects\": false,\n  \"engines\": {\n    \"bun\": \">=1.2.11\"\n  },\n  \"dependencies\": {\n    \"@google-cloud/bigquery\": \"^7.9.4\",\n    \"@levelcode/common\": \"workspace:*\"\n  },\n  \"devDependencies\": {\n    \"@types/node\": \"22\",\n    \"@types/bun\": \"^1.2.11\"\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "packages/billing/package.json",
              "content": "{\n  \"name\": \"@levelcode/billing\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"license\": \"UNLICENSED\",\n  \"type\": \"module\",\n  \"exports\": {\n    \".\": {\n      \"bun\": \"./src/index.ts\",\n      \"import\": \"./src/index.ts\",\n      \"types\": \"./src/index.ts\",\n      \"default\": \"./src/index.ts\"\n    },\n    \"./*\": {\n      \"bun\": \"./src/*.ts\",\n      \"import\": \"./src/*.ts\",\n      \"types\": \"./src/*.ts\",\n      \"default\": \"./src/*.ts\"\n    }\n  },\n  \"scripts\": {\n    \"typecheck\": \"tsc --noEmit -p .\",\n    \"test\": \"bun test\"\n  },\n  \"sideEffects\": false,\n  \"engines\": {\n    \"bun\": \">=1.2.11\"\n  },\n  \"dependencies\": {\n    \"@levelcode/common\": \"workspace:*\"\n  },\n  \"devDependencies\": {\n    \"@types/node\": \"22\",\n    \"@types/bun\": \"^1.2.11\"\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "packages/build-tools/package.json",
              "content": "{\n  \"name\": \"@levelcode/build-tools\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"main\": \"./dist/executors/infisical-run/executor.js\",\n  \"executors\": \"./executors.json\",\n  \"scripts\": {\n    \"build\": \"tsc\",\n    \"clean\": \"rm -rf dist && (rm tsconfig.tsbuildinfo || true)\"\n  },\n  \"devDependencies\": {\n    \"@nx/devkit\": \"^20.8.1\",\n    \"typescript\": \"5.5.4\"\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "packages/code-map/package.json",
              "content": "{\n  \"name\": \"@levelcode/code-map\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"license\": \"UNLICENSED\",\n  \"type\": \"module\",\n  \"exports\": {\n    \".\": {\n      \"bun\": \"./src/index.ts\",\n      \"import\": \"./src/index.ts\",\n      \"types\": \"./src/index.ts\",\n      \"default\": \"./src/index.ts\"\n    },\n    \"./*\": {\n      \"bun\": \"./src/*.ts\",\n      \"import\": \"./src/*.ts\",\n      \"types\": \"./src/*.ts\",\n      \"default\": \"./src/*.ts\"\n    }\n  },\n  \"scripts\": {\n    \"typecheck\": \"tsc --noEmit -p .\",\n    \"test\": \"bun test\"\n  },\n  \"sideEffects\": false,\n  \"engines\": {\n    \"bun\": \">=1.2.11\"\n  },\n  \"dependencies\": {\n    \"@vscode/tree-sitter-wasm\": \"0.1.4\",\n    \"web-tree-sitter\": \"0.25.6\"\n  },\n  \"devDependencies\": {\n    \"@types/node\": \"22\",\n    \"@types/bun\": \"^1.2.11\"\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "packages/internal/package.json",
              "content": "{\n  \"name\": \"@levelcode/internal\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"license\": \"UNLICENSED\",\n  \"type\": \"module\",\n  \"exports\": {\n    \".\": {\n      \"bun\": \"./src/index.ts\",\n      \"import\": \"./src/index.ts\",\n      \"types\": \"./src/index.ts\",\n      \"default\": \"./src/index.ts\"\n    },\n    \"./loops\": {\n      \"bun\": \"./src/loops/index.ts\",\n      \"import\": \"./src/loops/index.ts\",\n      \"types\": \"./src/loops/index.ts\",\n      \"default\": \"./src/loops/index.ts\"\n    },\n    \"./openrouter-ai-sdk\": {\n      \"bun\": \"./src/openrouter-ai-sdk/index.ts\",\n      \"import\": \"./src/openrouter-ai-sdk/index.ts\",\n      \"types\": \"./src/openrouter-ai-sdk/index.ts\",\n      \"default\": \"./src/openrouter-ai-sdk/index.ts\"\n    },\n    \"./*\": {\n      \"bun\": \"./src/*.ts\",\n      \"import\": \"./src/*.ts\",\n      \"types\": \"./src/*.ts\",\n      \"default\": \"./src/*.ts\"\n    }\n  },\n  \"scripts\": {\n    \"typecheck\": \"tsc --noEmit -p .\",\n    \"test\": \"bun test\"\n  },\n  \"sideEffects\": false,\n  \"engines\": {\n    \"bun\": \">=1.2.11\"\n  },\n  \"dependencies\": {\n    \"@levelcode/common\": \"workspace:*\",\n    \"drizzle-orm\": \"*\",\n    \"loops\": \"^5.0.1\"\n  },\n  \"devDependencies\": {\n    \"@types/node\": \"22\",\n    \"@types/bun\": \"^1.2.11\"\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "scripts/package.json",
              "content": "{\n  \"name\": \"@levelcode/scripts\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Scripts package for LevelCode\",\n  \"private\": true,\n  \"license\": \"UNLICENSED\",\n  \"type\": \"module\",\n  \"exports\": {\n    \".\": {\n      \"bun\": \"./src/index.ts\",\n      \"types\": \"./src/index.ts\"\n    }\n  },\n  \"scripts\": {\n    \"typecheck\": \"tsc --noEmit -p .\",\n    \"test\": \"bun test\",\n    \"debug-log-subset\": \"bun run debug-log-subset.ts\",\n    \"typecheck-all\": \"bun run typecheck-all.ts\"\n  },\n  \"sideEffects\": false,\n  \"engines\": {\n    \"bun\": \">=1.2.11\"\n  },\n  \"dependencies\": {\n    \"@levelcode/bigquery\": \"workspace:*\",\n    \"@levelcode/backend\": \"workspace:*\",\n    \"@levelcode/common\": \"workspace:*\",\n    \"lodash\": \"^4.17.21\"\n  },\n  \"devDependencies\": {\n    \"@types/bun\": \"^1.2.11\",\n    \"@types/lodash\": \"^4.14.195\",\n    \"@types/node\": \"22\"\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "sdk/package.json",
              "content": "{\n  \"name\": \"@levelcode/sdk\",\n  \"private\": false,\n  \"access\": \"public\",\n  \"version\": \"0.1.6\",\n  \"description\": \"Official SDK for LevelCode  AI coding agent & framework\",\n  \"license\": \"MIT\",\n  \"type\": \"module\",\n  \"main\": \"./dist/sdk/src/index.js\",\n  \"types\": \"./dist/sdk/src/index.d.ts\",\n  \"exports\": {\n    \".\": {\n      \"types\": \"./dist/sdk/src/index.d.ts\",\n      \"import\": \"./dist/sdk/src/index.js\",\n      \"default\": \"./dist/sdk/src/index.js\"\n    }\n  },\n  \"files\": [\n    \"dist\",\n    \"README.md\",\n    \"CHANGELOG.md\"\n  ],\n  \"scripts\": {\n    \"build\": \"bun run copy-types && tsc\",\n    \"copy-types\": \"mkdir -p src/types && cp ../common/src/util/types/agent-definition.d.ts src/types/agent-definition.ts && cp ../common/src/util/types/tools.d.ts src/types/tools.ts\",\n    \"clean\": \"rm -rf dist\",\n    \"prepare-dist\": \"node scripts/publish.js --dry-run\",\n    \"publish-sdk\": \"node scripts/publish.js --public\",\n    \"publish-dry-run\": \"node scripts/publish.js --dry-run\",\n    \"prepublishOnly\": \"bun run clean && bun run build\",\n    \"typecheck\": \"tsc --noEmit -p .\",\n    \"test\": \"bun test\"\n  },\n  \"sideEffects\": false,\n  \"engines\": {\n    \"node\": \">=18.0.0\"\n  },\n  \"keywords\": [\n    \"levelcode\",\n    \"ai\",\n    \"code-editing\",\n    \"assistant\",\n    \"sdk\",\n    \"typescript\"\n  ],\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/levelcode/levelcode.git\",\n    \"directory\": \"sdk\"\n  },\n  \"homepage\": \"https://levelcode.com\",\n  \"bugs\": {\n    \"url\": \"https://github.com/levelcode/levelcode/issues\"\n  },\n  \"dependencies\": {\n    \"ai\": \"4.3.16\",\n    \"zod\": \"^3.23.8\"\n  },\n  \"devDependencies\": {\n    \"@types/node\": \"22\",\n    \"@types/bun\": \"^1.2.11\"\n  }\n}\n",
              "referencedBy": {}
            }
          ]
        }
      ],
      "parentAgentId": "D-QYfz6Uj58"
    },
    {
      "type": "text",
      "agentId": "D-QYfz6Uj58",
      "text": "Here's a concise report on the locations of testing, linting, and typechecking scripts in the codebase:\n\n*   **package.json**: Contains top-level scripts for the entire project, including `format`, `typecheck`, `test`, `init-worktree`, `cleanup-worktree`, and `generate-tool-definitions`. These scripts are central to managing the overall development process.\n*   **backend/package.json**: Includes `start`, `dev`, `typecheck`, and `test` scripts specifically for the backend.\n*   **common/package.json**: Contains scripts for `typecheck`, `test`, `db:generate`, `db:migrate`, and `db:studio`, focusing on common utilities and database management.\n*   **evals/package.json**: Includes scripts for `typecheck`, `test`, `test:manifold`, `test:pglite`, `test:swe-bench`, `test:e2e-cat-app`, `gen-git-evals`, `run-single-eval`, `run-git-evals`, `run-eval-set`, and `setup-levelcode-repo`, targeting the evaluation and testing of AI models.\n*   **npm-app/package.json**: Contains `typecheck`, `build`, `release`, `start-bin`, `start`, `format`, and `postinstall` scripts specifically for the npm application.\n*   **packages/bigquery/package.json**: Includes `typecheck` and `test` scripts for the BigQuery package.\n*   **packages/billing/package.json**: Includes `typecheck` and `test` scripts for the billing package.\n*   **packages/build-tools/package.json**: Includes `build` and `clean` scripts, mainly for building and cleaning the build tools package.\n*   **packages/code-map/package.json**: Includes `typecheck` and `test` scripts for the code map package.\n*   **packages/internal/package.json**: Includes `typecheck` and `test` scripts for internal utilities.\n*   **scripts/package.json**: Includes `typecheck`, `test`, and other utility scripts like `debug-log-subset` and `typecheck-all`.\n*   **sdk/package.json**: Includes `build`, `copy-types`, `clean`, `prepare-dist`, `publish-sdk`, `publish-dry-run`, `prepublishOnly`, `typecheck`, and `test` scripts for the SDK.\n*   **web/package.json**: (Not provided in the read\\_files output, but worth noting it exists) would likely contain scripts related to building, testing, and linting the web application.\n"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-QYfz6Uj58",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "package.json scripts for testing, linting, typechecking"
    },
    {
      "type": "tool_result",
      "toolCallId": "D-QYc2ZPpX8",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Fletcher the File Fetcher",
              "agentType": "file-picker",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "Here's a concise report on the locations of testing, linting, and typechecking scripts in the codebase:\n\n*   **package.json**: Contains top-level scripts for the entire project, including `format`, `typecheck`, `test`, `init-worktree`, `cleanup-worktree`, and `generate-tool-definitions`. These scripts are central to managing the overall development process.\n*   **backend/package.json**: Includes `start`, `dev`, `typecheck`, and `test` scripts specifically for the backend.\n*   **common/package.json**: Contains scripts for `typecheck`, `test`, `db:generate`, `db:migrate`, and `db:studio`, focusing on common utilities and database management.\n*   **evals/package.json**: Includes scripts for `typecheck`, `test`, `test:manifold`, `test:pglite`, `test:swe-bench`, `test:e2e-cat-app`, `gen-git-evals`, `run-single-eval`, `run-git-evals`, `run-eval-set`, and `setup-levelcode-repo`, targeting the evaluation and testing of AI models.\n*   **npm-app/package.json**: Contains `typecheck`, `build`, `release`, `start-bin`, `start`, `format`, and `postinstall` scripts specifically for the npm application.\n*   **packages/bigquery/package.json**: Includes `typecheck` and `test` scripts for the BigQuery package.\n*   **packages/billing/package.json**: Includes `typecheck` and `test` scripts for the billing package.\n*   **packages/build-tools/package.json**: Includes `build` and `clean` scripts, mainly for building and cleaning the build tools package.\n*   **packages/code-map/package.json**: Includes `typecheck` and `test` scripts for the code map package.\n*   **packages/internal/package.json**: Includes `typecheck` and `test` scripts for internal utilities.\n*   **scripts/package.json**: Includes `typecheck`, `test`, and other utility scripts like `debug-log-subset` and `typecheck-all`.\n*   **sdk/package.json**: Includes `build`, `copy-types`, `clean`, `prepare-dist`, `publish-sdk`, `publish-dry-run`, `prepublishOnly`, `typecheck`, and `test` scripts for the SDK.\n*   **web/package.json**: (Not provided in the read\\_files output, but worth noting it exists) would likely contain scripts related to building, testing, and linting the web application.\n"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "agentName": "Code Searcher",
              "agentType": "code-searcher",
              "value": {
                "type": "structuredOutput",
                "value": {
                  "results": [
                    {
                      "stdout": ".github/workflows/ci.yml:\n1:# This workflow runs CI checks including building, typechecking, and testing the codebase\n18:    runs-on: ubuntu-latest\n51:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n80:  # Template for test jobs\n81:  test:\n90:    name: test-${{ matrix.package }}\n91:    runs-on: ubuntu-latest\n124:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n128:      - name: Run ${{ matrix.package }} tests\n133:          command: cd ${{ matrix.package }} && find src -name '*.test.ts' ! -name '*.integration.test.ts' | sort | xargs -I {} bun test {}\n140:  # Integration tests job\n141:  test-integration:\n150:    name: test-integration-${{ matrix.package }}\n151:    runs-on: ubuntu-latest\n184:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n\n.agents/base-max.ts:\n70:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n108:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n110:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n149:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n310:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n./npm-app/src/cli-handlers/checkpoint.ts:\n189:    const latestCheckpoint = checkpointManager.getLatestCheckpoint()\n190:    await latestCheckpoint?.fileStateIdPromise\n198:      'Failed to wait for latest checkpoint file state',\n243:    await checkpointManager.getLatestCheckpoint().fileStateIdPromise\n245:    // No latest checkpoint available, previous checkpoint is guaranteed to be done.\n\n.github/workflows/nightly-evals.yml:\n11:    runs-on: ubuntu-latest\n45:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n\n./npm-app/src/cli-handlers/agent-creation-chat.ts:\n108:        'Continue adjusting your agent here, or type \"/agents\" to switch agents and test it out.',\n\n.agents/base-experimental.ts:\n70:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n108:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n110:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n149:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n318:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n.agents/ask.ts:\n62:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n123:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n\n.github/workflows/npm-app-release-build.yml:\n34:          - os: ubuntu-latest\n39:          - os: ubuntu-latest\n54:          - os: windows-latest\n129:          # Only test if we're building for the native architecture\n131:            echo \"Skipping test for cross-compiled ARM64 binary\"\n\n./npm-app/src/cli-handlers/subagent-list.ts:\n197:              const testLine =\n200:                testLine.replace(/\\u001b\\[[0-9;]*m/g, '').length <=\n203:                currentLine = testLine\n233:          const testLine = `${currentLine} ${word}`\n235:            testLine.replace(/\\u001b\\[[0-9;]*m/g, '').length <= maxLineLength\n237:            currentLine = testLine\n\n.github/workflows/npm-app-release-staging.yml:\n18:    runs-on: ubuntu-latest\n57:          # Get latest beta version from npm to check if we need to increment\n58:          echo \"Fetching latest beta version from npm...\"\n59:          LATEST_BETA=$(npm view codecane@latest version 2>/dev/null || echo \"\")\n65:            echo \"Latest beta version: $LATEST_BETA\"\n143:    runs-on: ubuntu-latest\n228:              \\\"body\\\": \\\"## Codecane v${{ needs.prepare-and-commit-staging.outputs.new_version }} (Staging)\\n\\n** This is a staging/beta release for testing purposes.**\\n\\nBinary releases for all supported platforms.\\n\\n### Installation\\n\\`\\`\\`bash\\nnpm install -g codecane\\n\\`\\`\\`\\n\\n### Platform Binaries\\n- \\`codecane-linux-x64.tar.gz\\` - Linux x64\\n- \\`codecane-linux-arm64.tar.gz\\` - Linux ARM64\\n- \\`codecane-darwin-x64.tar.gz\\` - macOS Intel\\n- \\`codecane-darwin-arm64.tar.gz\\` - macOS Apple Silicon\\n- \\`codecane-win32-x64.tar.gz\\` - Windows x64\\\",\n258:    runs-on: ubuntu-latest\n\n.github/workflows/evals.yml:\n9:    runs-on: ubuntu-latest\n61:          echo \"NEXT_PUBLIC_CB_ENVIRONMENT=test\" >> $GITHUB_ENV\n\n.github/workflows/npm-app-release-prod.yml:\n22:    runs-on: ubuntu-latest\n105:    runs-on: ubuntu-latest\n150:    runs-on: ubuntu-latest\n\n./npm-app/src/menu.ts:\n400:${hasKnowledgeMd && !hasLevelCodeJson ? `\\n${yellow(`${levelcodeConfigFile} runs deployment scripts for you to test your code and runs configured checks for you by running your dev server.`)}` : ''}\n402:${!hasKnowledgeMd && !hasLevelCodeJson ? `\\n${yellow('knowledge.md helps LevelCode understand your project structure and codebase better for better results.')}\\n${yellow(`${levelcodeConfigFile} runs deployment scripts for you to test your code and runs configured checks for you by running your dev server.`)}` : ''}`\n422:${cyan('   \"Create a unit test for the auth module\"')}\n\n.github/knowledge.md:\n8:2. **Test Job**: Runs tests for npm-app, backend, and common packages in parallel using matrix strategy\n27:Each test job:\n29:- Runs unit tests only (excludes integration tests)\n31:- Sets `LEVELCODE_GITHUB_ACTIONS=true` and `NEXT_PUBLIC_CB_ENVIRONMENT=test`\n37:- Test environment flags are set for proper test execution\n42:- Build job must complete before test jobs start (`needs: build`)\n87:   bun act -j test-backend\n135:2. If tests fail with environment issues:\n153:6. Use the retry mechanism for flaky tests\n\n./npm-app/src/create-template-project.ts:\n20:  if (!/^[a-zA-Z0-9-_]+$/.test(template)) {\n36:  if (!/^[a-zA-Z0-9-_]+$/.test(projectName)) {\n\n./npm-app/src/client.ts:\n126:    console.log('Make sure you are on the latest version of LevelCode!')\n1121:        )}: Runs tests, linting, and type checking when you modify files\\n ${bold(\n1373:            checkpointAddendum = ` or \"checkpoint ${checkpointManager.getLatestCheckpoint().id}\" to revert`\n1375:            // No latest checkpoint, don't show addendum\n1382:              'No latest checkpoint for addendum',\n\n.agents/base-lite.ts:\n70:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n108:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n110:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n149:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n312:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n.agents/claude4-gemini-thinking.ts:\n65:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n103:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n105:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n144:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n305:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n.agents/reviewer.ts:\n39:4. Always run hooks for TypeScript/JavaScript changes, test file changes, or when the changes could affect compilation/tests\n\n./npm-app/src/__tests__/display.test.ts:\n1:import { describe, expect, it } from 'bun:test'\n\n.agents/types/tools.d.ts:\n56:  /** Optional ripgrep flags to customize the search (e.g., \"-i\" for case-insensitive, \"-t ts\" for TypeScript files only, \"-A 3\" for 3 lines after match, \"-B 2\" for 2 lines before match, \"--type-not test\" to exclude test files). */\n\n.agents/base.ts:\n70:- You are not the only one making changes to files. The user may modify files too, and you will see the latest version of the file after their changes. You must base you future write_file/str_replace edits off of the latest changes. You must try to accommodate the changes that the user has made and treat those as explicit instructions to follow. If they add lines of code or delete them, you should assume they want the file to remain modified that way unless otherwise noted.\n108:-  **Package Management:** When adding new packages, use the run_terminal_command tool to install the package rather than editing the package.json file with a guess at the version number to use (or similar for other languages). This way, you will be sure to have the latest version of the package. Do not install packages globally unless asked by the user (e.g. Don\\'t run \\`npm install -g <package-name>\\`). Always try to use the package manager associated with the project (e.g. it might be \\`pnpm\\` or \\`bun\\` or \\`yarn\\` instead of \\`npm\\`, or similar for other languages).\n110:-  **Testing:** If you create a unit test, you should run it using \\`run_terminal_command\\` to see if it passes, and fix it if it doesn\\'t.\n149:Check the knowledge files to see if the user has specified a further protocol for what terminal commands should be run to verify edits. For example, a \\`knowledge.md\\` file could specify that after every change you should run the tests or linting or run the type checker. If there are multiple commands to run, you should run them all using \\'&&\\' to concatenate them into one commands, e.g. \\`npm run lint && npm run test\\`.\n310:If the user had knowledge files (or CLAUDE.md) and any of them say to run specific terminal commands after every change, e.g. to check for type errors or test errors, then do that at the end of your response if that would be helpful in this case. No need to run these checks for simple changes.\n\n./backend/src/live-user-inputs.ts:\n88:// For testing purposes - reset all state\n\n./backend/src/__tests__/live-user-inputs.test.ts:\n1:import { describe, it, expect, beforeEach, afterEach } from 'bun:test'\n15:    // Clear any existing state before each test\n20:    // Clean up any state after each test\n95:      // For unit testing, we'll test the function directly\n105:      // For unit testing, we'll test that endUserInput doesn't remove the input\n\n./backend/src/llm-apis/message-cost-tracker.ts:\n245:        'Skipping Stripe sync (no user or test user).',\n591:          `Credits used by test user (${creditsUsed})`,\n\n./backend/src/__tests__/loop-agent-steps.test.ts:\n6:} from '@levelcode/common/testing/mock-modules'\n18:} from 'bun:test'\n22:import { mockFileContext, MockWebSocket } from './test-utils'\n66:    // Mock live user inputs - will be overridden in individual tests\n68:      checkLiveUserInput: () => false, // Default to false, override in tests\n136:      processedRepoId: 'test-repo-id',\n\n[Output size limit reached.]",
                      "message": "Stopped early after 110 match(es)."
                    },
                    {
                      "stdout": "./backend/src/templates/agents/planner.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n12:  displayName: AGENT_PERSONAS.planner.displayName,\n13:  spawnPurposePrompt: AGENT_PERSONAS.planner.purpose,\n\n./backend/src/templates/agents/superagent.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n15:  displayName: AGENT_PERSONAS.superagent.displayName,\n16:  spawnPurposePrompt: AGENT_PERSONAS.superagent.purpose,\n\n./backend/src/templates/agents/ask.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n17:  displayName: AGENT_PERSONAS.ask.displayName,\n\n./backend/src/templates/agents/thinking-base.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n19:  displayName: AGENT_PERSONAS.base_lite.displayName,\n20:  spawnPurposePrompt: AGENT_PERSONAS.base_lite.purpose,\n\n./backend/src/templates/agents/reviewer.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n12:  displayName: AGENT_PERSONAS.reviewer.displayName,\n13:  spawnPurposePrompt: AGENT_PERSONAS.reviewer.purpose,\n\n./backend/src/templates/agents/thinker.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n12:  displayName: AGENT_PERSONAS.thinker.displayName,\n13:  spawnPurposePrompt: AGENT_PERSONAS.thinker.purpose,\n\n./backend/src/templates/agents/archive/dry-run.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n11:  displayName: AGENT_PERSONAS.dry_run.displayName,\n12:  spawnPurposePrompt: AGENT_PERSONAS.dry_run.purpose,\n\n./backend/src/templates/agents/researcher.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n12:  displayName: AGENT_PERSONAS.researcher.displayName,\n13:  spawnPurposePrompt: AGENT_PERSONAS.researcher.purpose,\n\n./backend/src/templates/agents/base.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n19:  displayName: AGENT_PERSONAS.base.displayName,\n20:  spawnPurposePrompt: AGENT_PERSONAS.base.purpose,\n\n./backend/src/templates/agents/file-picker.ts:\n1:import { AGENT_PERSONAS } from '@levelcode/common/constants/agents'\n11:  displayName: AGENT_PERSONAS.file_picker.displayName,\n12:  spawnPurposePrompt: AGENT_PERSONAS.file_picker.purpose,\n\n./common/src/constants/agents.ts:\n4:export const AGENT_PERSONAS = {\n90:// Agent IDs list from AGENT_PERSONAS keys\n92:  AGENT_PERSONAS,\n93:) as (keyof typeof AGENT_PERSONAS)[]\n100:  Object.entries(AGENT_PERSONAS).map(([agentType, persona]) => [\n104:) as Record<keyof typeof AGENT_PERSONAS, string>\n107:  (typeof AGENT_PERSONAS)[keyof typeof AGENT_PERSONAS]['displayName']\n112:    Object.values(AGENT_PERSONAS)\n\n./common/src/util/agent-name-resolver.ts:\n1:import { AGENT_PERSONAS } from '../constants/agents'\n14:  return Object.entries(AGENT_PERSONAS)",
                      "message": "Exit code: 0"
                    }
                  ]
                }
              }
            }
          ]
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "b1bb925b-9e8a-4bc1-82ae-59241e1a7ae2",
      "toolName": "spawn_agent_inline",
      "input": {
        "agent_type": "context-pruner",
        "params": {}
      },
      "agentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "b1bb925b-9e8a-4bc1-82ae-59241e1a7ae2",
      "toolName": "spawn_agent_inline",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Agent spawned."
          }
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "D-R04gDrkuM",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "editor-gpt-5"
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-R1CTaJRmk",
      "agentType": "editor-gpt-5",
      "displayName": "Code Editor",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": ""
    },
    {
      "type": "tool_call",
      "toolCallId": "D-d15YQvrg4",
      "toolName": "write_file",
      "input": {
        "path": "backend/src/templates/agents/agent-builder.ts",
        "instructions": "Update agent builder to copy diff-reviewer examples to .agents/examples and a new your-custom-agent starter template to .agents root; remove spawnableAgents; fix example gathering paths and prompt text.",
        "content": "import * as fs from 'fs'\nimport * as path from 'path'\n\nimport {\n  AGENT_TEMPLATES_DIR,\n  openrouterModels,\n  AGENT_DEFINITION_FILE,\n} from '@levelcode/common/constants'\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\nimport z from 'zod/v4'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\nimport type { ToolName } from '@levelcode/common/tools/constants'\n\nconst COMMON_UTIL_PATH = '../../../../common/src/util'\nconst TEMPLATE_RELATIVE_PATH =\n  `${COMMON_UTIL_PATH}/types/${AGENT_DEFINITION_FILE}` as const\n// Import to validate path exists at compile time\nimport(TEMPLATE_RELATIVE_PATH)\n\nconst TEMPLATE_PATH = path.join(__dirname, TEMPLATE_RELATIVE_PATH)\nconst DEFAULT_MODEL = openrouterModels.openrouter_claude_sonnet_4\nconst TYPES_DIR = path.join(AGENT_TEMPLATES_DIR, 'types')\nconst EXAMPLES_DIR = path.join(AGENT_TEMPLATES_DIR, 'examples')\nconst TEMPLATE_TYPES_PATH = path.join(TYPES_DIR, AGENT_DEFINITION_FILE)\nconst TOOL_DEFINITIONS_FILE = 'tools.d.ts'\nconst TOOL_DEFINITIONS_PATH = path.join(TYPES_DIR, TOOL_DEFINITIONS_FILE)\n\nconst EXAMPLES_SOURCE_DIR = path.join(__dirname, `${COMMON_UTIL_PATH}/examples`)\nconst STARTER_TEMPLATE_SOURCE_FILE = 'your-custom-agent.ts.txt'\nconst STARTER_TEMPLATE_DEST_FILE = 'your-custom-agent.ts'\n\nexport const agentBuilder = (\n  model: Model,\n  allAvailableAgents?: string[],\n): Omit<AgentTemplate, 'id'> => {\n  // Read the AGENT_CONFIG_FILE content dynamically\n  // The import above ensures this path exists at compile time\n  let agentTemplateContent = ''\n  try {\n    agentTemplateContent = fs.readFileSync(TEMPLATE_PATH, 'utf8')\n  } catch (error) {\n    console.warn(`Could not read ${AGENT_DEFINITION_FILE}:`, error)\n    agentTemplateContent = '// Agent template types not available'\n  }\n\n  // Read the tools.d.ts content from common package\n  let toolDefinitionsContent = ''\n  try {\n    const toolsPath = path.join(\n      __dirname,\n      `${COMMON_UTIL_PATH}/types/tools.d.ts`,\n    )\n    toolDefinitionsContent = fs.readFileSync(toolsPath, 'utf8')\n  } catch (error) {\n    console.warn(`Could not read tools.d.ts from common:`, error)\n    toolDefinitionsContent = '// Tool definitions not available'\n  }\n\n  // Read example agent files from common package\n  const exampleAgentContents: Record<string, string> = {}\n  let starterTemplateContent = ''\n\n  try {\n    if (fs.existsSync(EXAMPLES_SOURCE_DIR)) {\n      const files = fs.readdirSync(EXAMPLES_SOURCE_DIR)\n\n      files\n        .filter(\n          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer-'),\n        )\n        .forEach((filename) => {\n          const fullPath = path.join(EXAMPLES_SOURCE_DIR, filename)\n          const content = fs.readFileSync(fullPath, 'utf8')\n          exampleAgentContents[filename] = content\n        })\n\n      const starterTemplatePath = path.join(\n        EXAMPLES_SOURCE_DIR,\n        STARTER_TEMPLATE_SOURCE_FILE,\n      )\n      if (fs.existsSync(starterTemplatePath)) {\n        starterTemplateContent = fs.readFileSync(starterTemplatePath, 'utf8')\n      }\n    } else {\n      console.warn(\n        `Example agents directory does not exist: ${EXAMPLES_SOURCE_DIR}`,\n      )\n    }\n  } catch (error) {\n    console.warn('Could not read example agents:', error)\n  }\n\n  return {\n    model,\n    displayName: 'Bob the Agent Builder',\n    spawnPurposePrompt:\n      'Enhanced base agent that can create custom agents and handle all coding tasks with deterministic agent creation behavior',\n    inputSchema: {\n      prompt: z\n        .string()\n        .optional()\n        .describe(\n          'What agent type you would like to create or edit. Include as many details as possible.',\n        ),\n      params: z\n        .object({\n          name: z.string().optional(),\n          purpose: z.string().optional(),\n          specialty: z.string().optional(),\n          model: z.string().optional(),\n        })\n        .passthrough()\n        .optional(),\n    },\n    outputMode: 'structured_output',\n    includeMessageHistory: false,\n    toolNames: [\n      'write_file',\n      'str_replace',\n      'run_terminal_command',\n      'read_files',\n      'code_search',\n      'spawn_agents',\n      'add_message',\n      'set_output',\n      'end_turn',\n    ] satisfies ToolName[],\n\n    systemPrompt: [\n      '# Bob the Agent Builder',\n      '',\n      'You are an expert agent builder specialized in creating new agent templates for the levelcode system. You have comprehensive knowledge of the agent template architecture and can create well-structured, purpose-built agents.',\n      '',\n      '## Environment Setup Complete',\n      '',\n      'Your environment has been automatically prepared with:',\n      '- Agent template type definitions in `.agents/types/agent-definition.d.ts`',\n      '- Tool type definitions in `.agents/types/tools.d.ts`',\n      '- Diff-reviewer examples in `.agents/examples/` for reference',\n      '- A starter custom agent template at `.agents/your-custom-agent.ts`',\n      '',\n      'All necessary files are now available in your working directory.',\n      '',\n      '## Complete Agent Template Type Definitions',\n      '',\n      'Here are the complete TypeScript type definitions for creating custom LevelCode agents:',\n      '```typescript',\n      agentTemplateContent,\n      '```',\n      '',\n      '## Available Tools Type Definitions',\n      '',\n      'Here are the complete TypeScript type definitions for all available tools:',\n      '',\n      '```typescript',\n      toolDefinitionsContent,\n      '```',\n      '',\n      '## Agent Template Patterns:',\n      '',\n      '1. **Base Agent Pattern**: Full-featured agents with comprehensive tool access',\n      '2. **Specialized Agent Pattern**: Focused agents with limited tool sets',\n      '3. **Thinking Agent Pattern**: Agents that spawn thinker sub-agents',\n      '4. **Research Agent Pattern**: Agents that start with web search',\n      '',\n      '## Best Practices:',\n      '',\n      '1. **Use as few fields as possible**: Leave out fields that are not needed to reduce complexity',\n      '2. **Minimal Tools**: Only include tools the agent actually needs',\n      '3. **Clear and Concise Prompts**: Write clear, specific prompts that have no unnecessary words',\n      '4. **Consistent Naming**: Follow naming conventions (kebab-case for IDs)',\n      '5. **Appropriate Model**: Choose the right model for the task complexity. Default is claude-4-sonnet-20250522 for medium-high complexity tasks, and openai/gpt-5 for all other tasks.',\n      '',\n      '## Your Task:',\n      'When asked to create an agent template, you should:',\n      \"1. Understand the requested agent's purpose and capabilities\",\n      \"2. Choose appropriate tools for the agent's function\",\n      '3. Write a comprehensive system prompt',\n      `4. Create the complete agent template file in ${AGENT_TEMPLATES_DIR}`,\n      '5. Ensure the template follows all conventions and best practices',\n      '6. Use the AgentDefinition interface for the configuration',\n      '7. Start the file with: import type { AgentDefinition } from \"./types/agent-definition.d.ts\"',\n      '',\n      'Create agent templates that are focused, efficient, and well-documented. Always import the AgentDefinition type and export a default configuration object.',\n    ].join('\\n'),\n    instructionsPrompt: `You are helping to create or edit an agent template. The user will describe what kind of agent they want to create or how they want to modify an existing agent.\n\n## Environment Ready\n\nYour environment has been automatically set up with:\n- Type definitions in \\`.agents/types/\\`\n- Diff-reviewer examples in \\`.agents/examples/\\`\n- A starter custom agent template at \\`.agents/your-custom-agent.ts\\`\n\nYou can now proceed directly to agent creation or editing.\n\n## Example Agents Available\n\nThree diff-reviewer examples are available in \\`.agents/examples/\\`. These can serve as examples of well-made agents at different stages of complexity.\n\n**IMPORTANT**: Examine these examples to find connections and patterns that relate to the user's request. Look for:\n- Similar tool combinations\n- Comparable complexity levels\n- Related functionality patterns\n- Appropriate model choices\n- Relevant prompt structures\n\nUse these examples as inspiration and starting points, adapting their patterns to fit the user's specific needs.\n\n## Starter Template Available\n\nA starter custom agent file is available at \\`.agents/your-custom-agent.ts\\`. You can either modify this file directly or use it as a reference for creating a new agent.\n\n## For New Agents\n\nAnalyze their request and create a complete agent template that:\n- Has a clear purpose and appropriate capabilities\n- Leaves out fields that are not needed\n- Uses only the tools it needs\n- Follows naming conventions\n- Is properly structured\n- Draws inspiration from relevant example agents\n\n## For Creating New Agents\n\nThe agent builder is focused on creating new agent templates based on user specifications.\n\nIMPORTANT: Always end your response with the end_turn tool when you have completed the agent creation or editing task.`,\n    stepPrompt: '',\n\n    handleSteps: function* ({ agentState, prompt, params }) {\n      // Step 1: Create directory structure\n      yield {\n        toolName: 'run_terminal_command',\n        args: {\n          command: `mkdir -p ${TYPES_DIR} && mkdir -p ${EXAMPLES_DIR}`,\n          process_type: 'SYNC',\n          timeout_seconds: 10,\n        },\n      }\n\n      // Step 2: Write the AGENT_DEFINITION_FILE with the template content\n      yield {\n        toolName: 'write_file',\n        args: {\n          path: TEMPLATE_TYPES_PATH,\n          instructions: 'Create agent template type definitions file',\n          content: agentTemplateContent,\n        },\n      }\n\n      // Step 3: Write the tool definitions file (copy from existing tools.d.ts)\n      yield {\n        toolName: 'write_file',\n        args: {\n          path: TOOL_DEFINITIONS_PATH,\n          instructions: 'Create tools type file',\n          content: toolDefinitionsContent,\n        },\n      }\n\n      // Step 4: Add message about reading example files and then read them\n      yield {\n        toolName: 'add_message',\n        args: {\n          role: 'assistant',\n          content:\n            \"I'll review the starter template and diff-reviewer examples, then help you create your agent.\",\n        },\n      }\n\n      // Step 5: Copy example agent files to .agents/examples/\n      for (const [filename, content] of Object.entries(exampleAgentContents)) {\n        if (content) {\n          yield {\n            toolName: 'write_file',\n            args: {\n              path: `${EXAMPLES_DIR}/${filename}`,\n              instructions: `Copy example agent file ${filename}`,\n              content: content,\n            },\n          }\n        }\n      }\n\n      // Step 6: Copy starter template directly to .agents/\n      if (starterTemplateContent) {\n        yield {\n          toolName: 'write_file',\n          args: {\n            path: `${AGENT_TEMPLATES_DIR}/${STARTER_TEMPLATE_DEST_FILE}`,\n            instructions: `Copy starter custom agent template ${STARTER_TEMPLATE_DEST_FILE}`,\n            content: starterTemplateContent,\n          },\n        }\n      }\n\n      // Step 7: Complete agent creation process\n      yield 'STEP_ALL'\n    },\n  }\n}\n"
      },
      "agentId": "D-R1CTaJRmk",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "D-d15YQvrg4",
      "toolName": "write_file",
      "output": [
        {
          "type": "json",
          "value": {
            "file": "backend/src/templates/agents/agent-builder.ts",
            "message": "Updated file",
            "unifiedDiff": "@@ -26,8 +26,12 @@\n const TEMPLATE_TYPES_PATH = path.join(TYPES_DIR, AGENT_DEFINITION_FILE)\n const TOOL_DEFINITIONS_FILE = 'tools.d.ts'\n const TOOL_DEFINITIONS_PATH = path.join(TYPES_DIR, TOOL_DEFINITIONS_FILE)\n \n+const EXAMPLES_SOURCE_DIR = path.join(__dirname, `${COMMON_UTIL_PATH}/examples`)\n+const STARTER_TEMPLATE_SOURCE_FILE = 'your-custom-agent.ts.txt'\n+const STARTER_TEMPLATE_DEST_FILE = 'your-custom-agent.ts'\n+\n export const agentBuilder = (\n   model: Model,\n   allAvailableAgents?: string[],\n ): Omit<AgentTemplate, 'id'> => {\n@@ -39,8 +43,9 @@\n   } catch (error) {\n     console.warn(`Could not read ${AGENT_DEFINITION_FILE}:`, error)\n     agentTemplateContent = '// Agent template types not available'\n   }\n+\n   // Read the tools.d.ts content from common package\n   let toolDefinitionsContent = ''\n   try {\n     const toolsPath = path.join(\n@@ -54,35 +59,38 @@\n   }\n \n   // Read example agent files from common package\n   const exampleAgentContents: Record<string, string> = {}\n+  let starterTemplateContent = ''\n \n   try {\n-    const exampleAgentsDir = path.join(__dirname, `${COMMON_UTIL_PATH}`)\n-    // Check if directory exists before trying to read it\n-    if (fs.existsSync(exampleAgentsDir)) {\n-      const files = fs.readdirSync(exampleAgentsDir)\n+    if (fs.existsSync(EXAMPLES_SOURCE_DIR)) {\n+      const files = fs.readdirSync(EXAMPLES_SOURCE_DIR)\n \n       files\n         .filter(\n-          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer'),\n+          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer-'),\n         )\n         .forEach((filename) => {\n-          try {\n-            const fullPath = path.join(exampleAgentsDir, filename)\n-            const content = fs.readFileSync(fullPath, 'utf8')\n-            exampleAgentContents[filename] = content\n-          } catch (error) {\n-            console.warn(`Could not read example agent ${filename}:`, error)\n-          }\n+          const fullPath = path.join(EXAMPLES_SOURCE_DIR, filename)\n+          const content = fs.readFileSync(fullPath, 'utf8')\n+          exampleAgentContents[filename] = content\n         })\n+\n+      const starterTemplatePath = path.join(\n+        EXAMPLES_SOURCE_DIR,\n+        STARTER_TEMPLATE_SOURCE_FILE,\n+      )\n+      if (fs.existsSync(starterTemplatePath)) {\n+        starterTemplateContent = fs.readFileSync(starterTemplatePath, 'utf8')\n+      }\n     } else {\n       console.warn(\n-        `Example agents directory does not exist: ${exampleAgentsDir}`,\n+        `Example agents directory does not exist: ${EXAMPLES_SOURCE_DIR}`,\n       )\n     }\n   } catch (error) {\n-    console.warn('Could not read example agents directory:', error)\n+    console.warn('Could not read example agents:', error)\n   }\n \n   return {\n     model,\n@@ -138,9 +146,10 @@\n       '',\n       'Your environment has been automatically prepared with:',\n       '- Agent template type definitions in `.agents/types/agent-definition.d.ts`',\n       '- Tool type definitions in `.agents/types/tools.d.ts`',\n-      '- Example agent files copied to `.agents/` directory for reference',\n+      '- Diff-reviewer examples in `.agents/examples/` for reference',\n+      '- A starter custom agent template at `.agents/your-custom-agent.ts`',\n       '',\n       'All necessary files are now available in your working directory.',\n       '',\n       '## Complete Agent Template Type Definitions',\n@@ -190,16 +199,16 @@\n ## Environment Ready\n \n Your environment has been automatically set up with:\n - Type definitions in \\`.agents/types/\\`\n-- Example agent files in \\`.agents/\\` directory\n-- All necessary scaffolding complete\n+- Diff-reviewer examples in \\`.agents/examples/\\`\n+- A starter custom agent template at \\`.agents/your-custom-agent.ts\\`\n \n You can now proceed directly to agent creation or editing.\n \n ## Example Agents Available\n \n-Three example agents are now available in your \\`.agents/\\` directory which are all diff reviewers of increasing complexity. These can serve as examples of well-made agents at different stages of complexity.\n+Three diff-reviewer examples are available in \\`.agents/examples/\\`. These can serve as examples of well-made agents at different stages of complexity.\n \n **IMPORTANT**: Examine these examples to find connections and patterns that relate to the user's request. Look for:\n - Similar tool combinations\n - Comparable complexity levels\n@@ -208,8 +217,12 @@\n - Relevant prompt structures\n \n Use these examples as inspiration and starting points, adapting their patterns to fit the user's specific needs.\n \n+## Starter Template Available\n+\n+A starter custom agent file is available at \\`.agents/your-custom-agent.ts\\`. You can either modify this file directly or use it as a reference for creating a new agent.\n+\n ## For New Agents\n \n Analyze their request and create a complete agent template that:\n - Has a clear purpose and appropriate capabilities\n@@ -262,13 +275,13 @@\n         toolName: 'add_message',\n         args: {\n           role: 'assistant',\n           content:\n-            \"I'll read the example agent files to understand the patterns and then help you create your agent.\",\n+            \"I'll review the starter template and diff-reviewer examples, then help you create your agent.\",\n         },\n       }\n \n-      // Step 5: Copy example agent files to .agents/ directory\n+      // Step 5: Copy example agent files to .agents/examples/\n       for (const [filename, content] of Object.entries(exampleAgentContents)) {\n         if (content) {\n           yield {\n             toolName: 'write_file',\n@@ -280,9 +293,21 @@\n           }\n         }\n       }\n \n-      // Step 6: Complete agent creation process\n+      // Step 6: Copy starter template directly to .agents/\n+      if (starterTemplateContent) {\n+        yield {\n+          toolName: 'write_file',\n+          args: {\n+            path: `${AGENT_TEMPLATES_DIR}/${STARTER_TEMPLATE_DEST_FILE}`,\n+            instructions: `Copy starter custom agent template ${STARTER_TEMPLATE_DEST_FILE}`,\n+            content: starterTemplateContent,\n+          },\n+        }\n+      }\n+\n+      // Step 7: Complete agent creation process\n       yield 'STEP_ALL'\n     },\n   }\n }\n"
          }
        }
      ],
      "parentAgentId": "D-R1CTaJRmk"
    },
    {
      "type": "tool_call",
      "toolCallId": "9cfbe4a6-f0b9-4f64-93d8-74c25ed6af43",
      "toolName": "set_output",
      "input": {
        "output": {
          "message": "",
          "toolResults": [
            {
              "file": "backend/src/templates/agents/agent-builder.ts",
              "message": "Updated file",
              "unifiedDiff": "@@ -26,8 +26,12 @@\n const TEMPLATE_TYPES_PATH = path.join(TYPES_DIR, AGENT_DEFINITION_FILE)\n const TOOL_DEFINITIONS_FILE = 'tools.d.ts'\n const TOOL_DEFINITIONS_PATH = path.join(TYPES_DIR, TOOL_DEFINITIONS_FILE)\n \n+const EXAMPLES_SOURCE_DIR = path.join(__dirname, `${COMMON_UTIL_PATH}/examples`)\n+const STARTER_TEMPLATE_SOURCE_FILE = 'your-custom-agent.ts.txt'\n+const STARTER_TEMPLATE_DEST_FILE = 'your-custom-agent.ts'\n+\n export const agentBuilder = (\n   model: Model,\n   allAvailableAgents?: string[],\n ): Omit<AgentTemplate, 'id'> => {\n@@ -39,8 +43,9 @@\n   } catch (error) {\n     console.warn(`Could not read ${AGENT_DEFINITION_FILE}:`, error)\n     agentTemplateContent = '// Agent template types not available'\n   }\n+\n   // Read the tools.d.ts content from common package\n   let toolDefinitionsContent = ''\n   try {\n     const toolsPath = path.join(\n@@ -54,35 +59,38 @@\n   }\n \n   // Read example agent files from common package\n   const exampleAgentContents: Record<string, string> = {}\n+  let starterTemplateContent = ''\n \n   try {\n-    const exampleAgentsDir = path.join(__dirname, `${COMMON_UTIL_PATH}`)\n-    // Check if directory exists before trying to read it\n-    if (fs.existsSync(exampleAgentsDir)) {\n-      const files = fs.readdirSync(exampleAgentsDir)\n+    if (fs.existsSync(EXAMPLES_SOURCE_DIR)) {\n+      const files = fs.readdirSync(EXAMPLES_SOURCE_DIR)\n \n       files\n         .filter(\n-          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer'),\n+          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer-'),\n         )\n         .forEach((filename) => {\n-          try {\n-            const fullPath = path.join(exampleAgentsDir, filename)\n-            const content = fs.readFileSync(fullPath, 'utf8')\n-            exampleAgentContents[filename] = content\n-          } catch (error) {\n-            console.warn(`Could not read example agent ${filename}:`, error)\n-          }\n+          const fullPath = path.join(EXAMPLES_SOURCE_DIR, filename)\n+          const content = fs.readFileSync(fullPath, 'utf8')\n+          exampleAgentContents[filename] = content\n         })\n+\n+      const starterTemplatePath = path.join(\n+        EXAMPLES_SOURCE_DIR,\n+        STARTER_TEMPLATE_SOURCE_FILE,\n+      )\n+      if (fs.existsSync(starterTemplatePath)) {\n+        starterTemplateContent = fs.readFileSync(starterTemplatePath, 'utf8')\n+      }\n     } else {\n       console.warn(\n-        `Example agents directory does not exist: ${exampleAgentsDir}`,\n+        `Example agents directory does not exist: ${EXAMPLES_SOURCE_DIR}`,\n       )\n     }\n   } catch (error) {\n-    console.warn('Could not read example agents directory:', error)\n+    console.warn('Could not read example agents:', error)\n   }\n \n   return {\n     model,\n@@ -138,9 +146,10 @@\n       '',\n       'Your environment has been automatically prepared with:',\n       '- Agent template type definitions in `.agents/types/agent-definition.d.ts`',\n       '- Tool type definitions in `.agents/types/tools.d.ts`',\n-      '- Example agent files copied to `.agents/` directory for reference',\n+      '- Diff-reviewer examples in `.agents/examples/` for reference',\n+      '- A starter custom agent template at `.agents/your-custom-agent.ts`',\n       '',\n       'All necessary files are now available in your working directory.',\n       '',\n       '## Complete Agent Template Type Definitions',\n@@ -190,16 +199,16 @@\n ## Environment Ready\n \n Your environment has been automatically set up with:\n - Type definitions in \\`.agents/types/\\`\n-- Example agent files in \\`.agents/\\` directory\n-- All necessary scaffolding complete\n+- Diff-reviewer examples in \\`.agents/examples/\\`\n+- A starter custom agent template at \\`.agents/your-custom-agent.ts\\`\n \n You can now proceed directly to agent creation or editing.\n \n ## Example Agents Available\n \n-Three example agents are now available in your \\`.agents/\\` directory which are all diff reviewers of increasing complexity. These can serve as examples of well-made agents at different stages of complexity.\n+Three diff-reviewer examples are available in \\`.agents/examples/\\`. These can serve as examples of well-made agents at different stages of complexity.\n \n **IMPORTANT**: Examine these examples to find connections and patterns that relate to the user's request. Look for:\n - Similar tool combinations\n - Comparable complexity levels\n@@ -208,8 +217,12 @@\n - Relevant prompt structures\n \n Use these examples as inspiration and starting points, adapting their patterns to fit the user's specific needs.\n \n+## Starter Template Available\n+\n+A starter custom agent file is available at \\`.agents/your-custom-agent.ts\\`. You can either modify this file directly or use it as a reference for creating a new agent.\n+\n ## For New Agents\n \n Analyze their request and create a complete agent template that:\n - Has a clear purpose and appropriate capabilities\n@@ -262,13 +275,13 @@\n         toolName: 'add_message',\n         args: {\n           role: 'assistant',\n           content:\n-            \"I'll read the example agent files to understand the patterns and then help you create your agent.\",\n+            \"I'll review the starter template and diff-reviewer examples, then help you create your agent.\",\n         },\n       }\n \n-      // Step 5: Copy example agent files to .agents/ directory\n+      // Step 5: Copy example agent files to .agents/examples/\n       for (const [filename, content] of Object.entries(exampleAgentContents)) {\n         if (content) {\n           yield {\n             toolName: 'write_file',\n@@ -280,9 +293,21 @@\n           }\n         }\n       }\n \n-      // Step 6: Complete agent creation process\n+      // Step 6: Copy starter template directly to .agents/\n+      if (starterTemplateContent) {\n+        yield {\n+          toolName: 'write_file',\n+          args: {\n+            path: `${AGENT_TEMPLATES_DIR}/${STARTER_TEMPLATE_DEST_FILE}`,\n+            instructions: `Copy starter custom agent template ${STARTER_TEMPLATE_DEST_FILE}`,\n+            content: starterTemplateContent,\n+          },\n+        }\n+      }\n+\n+      // Step 7: Complete agent creation process\n       yield 'STEP_ALL'\n     },\n   }\n }\n"
            }
          ]
        }
      },
      "agentId": "D-R1CTaJRmk",
      "parentAgentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "9cfbe4a6-f0b9-4f64-93d8-74c25ed6af43",
      "toolName": "set_output",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Output set"
          }
        }
      ],
      "parentAgentId": "D-R1CTaJRmk"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-R1CTaJRmk",
      "agentType": "editor-gpt-5",
      "displayName": "Code Editor",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": ""
    },
    {
      "type": "tool_result",
      "toolCallId": "D-R04gDrkuM",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Code Editor",
              "agentType": "editor-gpt-5",
              "value": {
                "type": "structuredOutput",
                "value": {
                  "output": {
                    "message": "",
                    "toolResults": [
                      {
                        "file": "backend/src/templates/agents/agent-builder.ts",
                        "message": "Updated file",
                        "unifiedDiff": "@@ -26,8 +26,12 @@\n const TEMPLATE_TYPES_PATH = path.join(TYPES_DIR, AGENT_DEFINITION_FILE)\n const TOOL_DEFINITIONS_FILE = 'tools.d.ts'\n const TOOL_DEFINITIONS_PATH = path.join(TYPES_DIR, TOOL_DEFINITIONS_FILE)\n \n+const EXAMPLES_SOURCE_DIR = path.join(__dirname, `${COMMON_UTIL_PATH}/examples`)\n+const STARTER_TEMPLATE_SOURCE_FILE = 'your-custom-agent.ts.txt'\n+const STARTER_TEMPLATE_DEST_FILE = 'your-custom-agent.ts'\n+\n export const agentBuilder = (\n   model: Model,\n   allAvailableAgents?: string[],\n ): Omit<AgentTemplate, 'id'> => {\n@@ -39,8 +43,9 @@\n   } catch (error) {\n     console.warn(`Could not read ${AGENT_DEFINITION_FILE}:`, error)\n     agentTemplateContent = '// Agent template types not available'\n   }\n+\n   // Read the tools.d.ts content from common package\n   let toolDefinitionsContent = ''\n   try {\n     const toolsPath = path.join(\n@@ -54,35 +59,38 @@\n   }\n \n   // Read example agent files from common package\n   const exampleAgentContents: Record<string, string> = {}\n+  let starterTemplateContent = ''\n \n   try {\n-    const exampleAgentsDir = path.join(__dirname, `${COMMON_UTIL_PATH}`)\n-    // Check if directory exists before trying to read it\n-    if (fs.existsSync(exampleAgentsDir)) {\n-      const files = fs.readdirSync(exampleAgentsDir)\n+    if (fs.existsSync(EXAMPLES_SOURCE_DIR)) {\n+      const files = fs.readdirSync(EXAMPLES_SOURCE_DIR)\n \n       files\n         .filter(\n-          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer'),\n+          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer-'),\n         )\n         .forEach((filename) => {\n-          try {\n-            const fullPath = path.join(exampleAgentsDir, filename)\n-            const content = fs.readFileSync(fullPath, 'utf8')\n-            exampleAgentContents[filename] = content\n-          } catch (error) {\n-            console.warn(`Could not read example agent ${filename}:`, error)\n-          }\n+          const fullPath = path.join(EXAMPLES_SOURCE_DIR, filename)\n+          const content = fs.readFileSync(fullPath, 'utf8')\n+          exampleAgentContents[filename] = content\n         })\n+\n+      const starterTemplatePath = path.join(\n+        EXAMPLES_SOURCE_DIR,\n+        STARTER_TEMPLATE_SOURCE_FILE,\n+      )\n+      if (fs.existsSync(starterTemplatePath)) {\n+        starterTemplateContent = fs.readFileSync(starterTemplatePath, 'utf8')\n+      }\n     } else {\n       console.warn(\n-        `Example agents directory does not exist: ${exampleAgentsDir}`,\n+        `Example agents directory does not exist: ${EXAMPLES_SOURCE_DIR}`,\n       )\n     }\n   } catch (error) {\n-    console.warn('Could not read example agents directory:', error)\n+    console.warn('Could not read example agents:', error)\n   }\n \n   return {\n     model,\n@@ -138,9 +146,10 @@\n       '',\n       'Your environment has been automatically prepared with:',\n       '- Agent template type definitions in `.agents/types/agent-definition.d.ts`',\n       '- Tool type definitions in `.agents/types/tools.d.ts`',\n-      '- Example agent files copied to `.agents/` directory for reference',\n+      '- Diff-reviewer examples in `.agents/examples/` for reference',\n+      '- A starter custom agent template at `.agents/your-custom-agent.ts`',\n       '',\n       'All necessary files are now available in your working directory.',\n       '',\n       '## Complete Agent Template Type Definitions',\n@@ -190,16 +199,16 @@\n ## Environment Ready\n \n Your environment has been automatically set up with:\n - Type definitions in \\`.agents/types/\\`\n-- Example agent files in \\`.agents/\\` directory\n-- All necessary scaffolding complete\n+- Diff-reviewer examples in \\`.agents/examples/\\`\n+- A starter custom agent template at \\`.agents/your-custom-agent.ts\\`\n \n You can now proceed directly to agent creation or editing.\n \n ## Example Agents Available\n \n-Three example agents are now available in your \\`.agents/\\` directory which are all diff reviewers of increasing complexity. These can serve as examples of well-made agents at different stages of complexity.\n+Three diff-reviewer examples are available in \\`.agents/examples/\\`. These can serve as examples of well-made agents at different stages of complexity.\n \n **IMPORTANT**: Examine these examples to find connections and patterns that relate to the user's request. Look for:\n - Similar tool combinations\n - Comparable complexity levels\n@@ -208,8 +217,12 @@\n - Relevant prompt structures\n \n Use these examples as inspiration and starting points, adapting their patterns to fit the user's specific needs.\n \n+## Starter Template Available\n+\n+A starter custom agent file is available at \\`.agents/your-custom-agent.ts\\`. You can either modify this file directly or use it as a reference for creating a new agent.\n+\n ## For New Agents\n \n Analyze their request and create a complete agent template that:\n - Has a clear purpose and appropriate capabilities\n@@ -262,13 +275,13 @@\n         toolName: 'add_message',\n         args: {\n           role: 'assistant',\n           content:\n-            \"I'll read the example agent files to understand the patterns and then help you create your agent.\",\n+            \"I'll review the starter template and diff-reviewer examples, then help you create your agent.\",\n         },\n       }\n \n-      // Step 5: Copy example agent files to .agents/ directory\n+      // Step 5: Copy example agent files to .agents/examples/\n       for (const [filename, content] of Object.entries(exampleAgentContents)) {\n         if (content) {\n           yield {\n             toolName: 'write_file',\n@@ -280,9 +293,21 @@\n           }\n         }\n       }\n \n-      // Step 6: Complete agent creation process\n+      // Step 6: Copy starter template directly to .agents/\n+      if (starterTemplateContent) {\n+        yield {\n+          toolName: 'write_file',\n+          args: {\n+            path: `${AGENT_TEMPLATES_DIR}/${STARTER_TEMPLATE_DEST_FILE}`,\n+            instructions: `Copy starter custom agent template ${STARTER_TEMPLATE_DEST_FILE}`,\n+            content: starterTemplateContent,\n+          },\n+        }\n+      }\n+\n+      // Step 7: Complete agent creation process\n       yield 'STEP_ALL'\n     },\n   }\n }\n"
                      }
                    ]
                  }
                }
              }
            }
          ]
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "55caccf4-2925-4acb-8edc-bddc857a35d4",
      "toolName": "spawn_agent_inline",
      "input": {
        "agent_type": "context-pruner",
        "params": {}
      },
      "agentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "55caccf4-2925-4acb-8edc-bddc857a35d4",
      "toolName": "spawn_agent_inline",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Agent spawned."
          }
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "D-gXircIAUI",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "editor-gpt-5"
          },
          {
            "agent_type": "code-searcher",
            "params": {
              "searchQueries": [
                {
                  "pattern": "your-custom-agent|git-committer",
                  "flags": "-g common/src/util/examples"
                },
                {
                  "pattern": "file-explorer spawn",
                  "flags": "-g *.ts"
                }
              ]
            }
          },
          {
            "agent_type": "file-picker",
            "prompt": "common/src/util/examples directory contents and related files"
          },
          {
            "agent_type": "commander-lite",
            "prompt": "What are the package.json scripts for typecheck, lint, test, format in the root and relevant packages?",
            "params": {
              "command": "cat package.json scripts/package.json backend/package.json common/package.json | grep -E 'typecheck|lint|test|format' -A5"
            }
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-gXwZERcWA",
      "agentType": "editor-gpt-5",
      "displayName": "Code Editor",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": ""
    },
    {
      "type": "subagent_start",
      "agentId": "D-gXwl0iLRI",
      "agentType": "code-searcher",
      "displayName": "Code Searcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "searchQueries": [
          {
            "pattern": "your-custom-agent|git-committer",
            "flags": "-g common/src/util/examples"
          },
          {
            "pattern": "file-explorer spawn",
            "flags": "-g *.ts"
          }
        ]
      }
    },
    {
      "type": "subagent_start",
      "agentId": "D-gXwryrlBs",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "common/src/util/examples directory contents and related files"
    },
    {
      "type": "subagent_start",
      "agentId": "D-gXwlFcRHk",
      "agentType": "commander-lite",
      "displayName": "Commander Lite",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "What are the package.json scripts for typecheck, lint, test, format in the root and relevant packages?",
      "params": {
        "command": "cat package.json scripts/package.json backend/package.json common/package.json | grep -E 'typecheck|lint|test|format' -A5"
      }
    },
    {
      "type": "tool_call",
      "toolCallId": "7452f59a-29c2-4003-9d1e-7efd0b614f3b",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "file-lister",
            "prompt": "common/src/util/examples directory contents and related files",
            "params": {}
          }
        ]
      },
      "agentId": "D-gXwryrlBs",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-gYCDTSHSY",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-gXwryrlBs",
      "prompt": "common/src/util/examples directory contents and related files",
      "params": {}
    },
    {
      "type": "tool_call",
      "toolCallId": "ab5ce625-a859-4743-acee-dc28c1cd81d3",
      "toolName": "code_search",
      "input": {
        "pattern": "your-custom-agent|git-committer",
        "flags": "-g common/src/util/examples"
      },
      "agentId": "D-gXwl0iLRI",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "1ad7baa2-ff78-4573-9ba8-96171d5fdd73",
      "toolName": "run_terminal_command",
      "input": {
        "command": "cat package.json scripts/package.json backend/package.json common/package.json | grep -E 'typecheck|lint|test|format' -A5"
      },
      "agentId": "D-gXwlFcRHk",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "d7eb4f35-0c13-4d6f-b0e6-a03afc3da49c",
      "toolName": "read_subtree",
      "input": {
        "paths": [],
        "maxTokens": 500000
      },
      "agentId": "D-gYCDTSHSY",
      "parentAgentId": "D-gXwryrlBs",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "d7eb4f35-0c13-4d6f-b0e6-a03afc3da49c",
      "toolName": "read_subtree",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": ".",
              "type": "directory",
              "printedTree": ".agents/\n examples/\n  diff-reviewer-1.ts\n  diff-reviewer-2.ts\n  diff-reviewer-3.ts\n opensource/\n  base.ts\n  coder.ts\n  file-picker.ts\n  researcher.ts\n  reviewer.ts\n  thinker.ts\n ask.ts\n base-experimental.ts\n base-lite.ts\n base-max.ts\n base.ts\n brainstormer.ts\n changes-reviewer.ts\n charles.ts\n claude4-gemini-thinking.ts\n constants.ts\n file-explorer.ts\n file-picker.ts\n git-committer.ts\n knowledge-keeper.ts\n planner.ts\n researcher.ts\n reviewer.ts\n superagent.ts\n thinker.ts\n.bin/\n bun\n.github/\n workflows/\n  ci.yml\n  evals.yml\n  nightly-evals.yml\n  npm-app-release-build.yml\n  npm-app-release-prod.yml\n  npm-app-release-staging.yml\n .gitignore\n CODEOWNERS\n knowledge.md\n.vscode/\n settings.json\nbackend/\n src/\n  __tests__/\n   test-data/\n    dex-go/\n     edit-snippet.go\n     expected.go\n     original.go\n   agent-id-resolution.test.ts\n   agent-registry.test.ts\n   auto-topup.test.ts\n   credit-conversion.test.ts\n   fast-rewrite.test.ts\n   generate-diffs-prompt.test.ts\n   get-custom-file-picker-config.test.ts\n   live-user-inputs.test.ts\n   loop-agent-steps.test.ts\n   main-prompt.integration.test.ts\n   main-prompt.test.ts\n   process-file-block.test.ts\n   process-str-replace.test.ts\n   read-docs-tool.test.ts\n   request-files-prompt.test.ts\n   run-agent-step-tools.test.ts\n   run-programmatic-step.test.ts\n   sandbox-generator.test.ts\n   subagent-streaming.test.ts\n   test-utils.ts\n   tool-call-schema.test.ts\n   usage-calculation.test.ts\n   web-search-tool.test.ts\n   xml-stream-parser.test.ts\n  admin/\n   grade-runs.ts\n   relabelRuns.ts\n  api/\n   org.ts\n   usage.ts\n  context/\n   app-context.ts\n  find-files/\n   check-new-files-necessary.ts\n   custom-file-picker-config.ts\n   request-files-prompt.ts\n  llm-apis/\n   __tests__/\n    linkup-api.test.ts\n   vercel-ai-sdk/\n    ai-sdk.ts\n    openrouter.ts\n    vertex-finetuned.ts\n   claude.ts\n   context7-api.ts\n   gemini-with-fallbacks.ts\n   knowledge.md\n   linkup-api.ts\n   message-cost-tracker.ts\n   openai-api.ts\n   openrouter.ts\n   relace-api.ts\n  system-prompt/\n   agent-instructions.md\n   prompts.ts\n   save-agent-request.ts\n   search-system-prompt.ts\n   truncate-file-tree.ts\n  templates/\n   agents/\n    archive/\n     dry-run.ts\n    agent-builder.ts\n    ask.ts\n    base.ts\n    file-explorer.ts\n    file-picker.ts\n    planner.ts\n    researcher.ts\n    reviewer.ts\n    superagent.ts\n    thinker.ts\n    thinking-base.ts\n   agent-list.ts\n   agent-registry.ts\n   ask-prompts.ts\n   base-prompts.ts\n   prompts.ts\n   README.md\n   strings.ts\n   types.ts\n  tools/\n   definitions/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    list.ts\n    tool-def-type.ts\n   handlers/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n    handler-function-type.ts\n    list.ts\n   constants.ts\n   prompts.ts\n   stream-parser.ts\n   tool-executor.ts\n  util/\n   __tests__/\n    messages.test.ts\n    object.test.ts\n    parse-tool-call-xml.test.ts\n    simplify-tool-results.test.ts\n    split-data.test.ts\n   check-auth.ts\n   debug.ts\n   file-resolver.ts\n   logger.ts\n   messages.ts\n   object.ts\n   parse-tool-call-xml.ts\n   quickjs-sandbox.ts\n   simplify-tool-results.ts\n   split-data.ts\n   token-counter.ts\n  websockets/\n   auth.ts\n   middleware.ts\n   request-context.ts\n   server.ts\n   switchboard.ts\n   websocket-action.ts\n  async-agent-manager.ts\n  check-terminal-command.ts\n  fast-rewrite.ts\n  generate-diffs-prompt.ts\n  get-documentation-for-query.ts\n  get-file-reading-updates.ts\n  index.ts\n  live-user-inputs.ts\n  loop-main-prompt.ts\n  main-prompt.ts\n  process-file-block.ts\n  process-str-replace.ts\n  prompt-agent-stream.ts\n  run-agent-step.ts\n  run-programmatic-step.ts\n  xml-stream-parser.ts\n .gitignore\n knowledge.md\n package.json\n README.md\n tsconfig.json\ncommon/\n src/\n  __tests__/\n   agent-validation.test.ts\n   dynamic-agent-template-schema.test.ts\n   handlesteps-parsing.test.ts\n  api-keys/\n   constants.ts\n   crypto.ts\n  constants/\n   agents.ts\n   analytics-events.ts\n   grant-priorities.ts\n  db/\n   migrations/\n    meta/\n     _journal.json\n     0000_snapshot.json\n     0001_snapshot.json\n     0002_snapshot.json\n     0003_snapshot.json\n     0004_snapshot.json\n     0005_snapshot.json\n     0006_snapshot.json\n     0007_snapshot.json\n     0008_snapshot.json\n     0009_snapshot.json\n     0010_snapshot.json\n     0011_snapshot.json\n     0012_snapshot.json\n     0013_snapshot.json\n     0014_snapshot.json\n     0015_snapshot.json\n     0016_snapshot.json\n     0017_snapshot.json\n     0018_snapshot.json\n     0019_snapshot.json\n     0020_snapshot.json\n     0021_snapshot.json\n     0026_snapshot.json\n     0027_snapshot.json\n     0028_snapshot.json\n    0000_overjoyed_thing.sql\n    0001_fuzzy_typhoid_mary.sql\n    0002_sticky_dormammu.sql\n    0003_military_owl.sql\n    0004_neat_pet_avengers.sql\n    0005_minor_the_professor.sql\n    0006_first_quasimodo.sql\n    0007_equal_warlock.sql\n    0008_puzzling_carnage.sql\n    0009_bitter_rumiko_fujikawa.sql\n    0010_overjoyed_red_skull.sql\n    0011_familiar_ezekiel_stane.sql\n    0012_fluffy_naoko.sql\n    0013_famous_risque.sql\n    0014_wakeful_sinister_six.sql\n    0015_stormy_zuras.sql\n    0016_clear_hairball.sql\n    0017_tricky_randall_flagg.sql\n    0018_stale_human_robot.sql\n    0019_amused_nebula.sql\n    0020_young_sleeper.sql\n    0021_tiny_marauders.sql\n    0026_chilly_mockingbird.sql\n    0027_sloppy_quasar.sql\n    0028_lush_johnny_blaze.sql\n   docker-compose.yml\n   drizzle.config.ts\n   index.ts\n   schema.knowledge.md\n   schema.ts\n   transaction.ts\n  json-config/\n   __tests__/\n    __snapshots__/\n     stringify-schema.test.ts.snap\n    constants.test.ts\n    stringify-schema.test.ts\n   constants.ts\n   default.ts\n   stringify-schema.ts\n  templates/\n   agent-validation.ts\n   dynamic-agent-functions.ts\n  testing/\n   mock-modules.ts\n  tools/\n   params/\n    tool/\n     add-message.ts\n     add-subgoal.ts\n     browser-logs.ts\n     code-search.ts\n     create-plan.ts\n     end-turn.ts\n     find-files.ts\n     read-docs.ts\n     read-files.ts\n     run-file-change-hooks.ts\n     run-terminal-command.ts\n     set-messages.ts\n     set-output.ts\n     spawn-agent-inline.ts\n     spawn-agents-async.ts\n     spawn-agents.ts\n     str-replace.ts\n     think-deeply.ts\n     update-subgoal.ts\n     web-search.ts\n     write-file.ts\n   compile-tool-definitions.ts\n   constants.ts\n   list.ts\n   utils.ts\n  types/\n   __tests__/\n    dynamic-agent-template.test.ts\n   api/\n    agents/\n     publish.ts\n   agent-template.ts\n   dynamic-agent-template.ts\n   grant.ts\n   message.ts\n   organization.ts\n   print-mode.ts\n   publisher.ts\n   referral.ts\n   session-state.ts\n   usage.ts\n  util/\n   __tests__/\n    messages.test.ts\n    partial-json-delta.test.ts\n    saxy.test.ts\n    string.test.ts\n   examples/\n    diff-reviewer-1.ts\n    diff-reviewer-2.ts\n    diff-reviewer-3.ts\n   agent-file-utils.ts\n   agent-name-normalization.ts\n   agent-name-resolver.ts\n   agent-template-validation.ts\n   array.ts\n   changes.ts\n   credentials.ts\n   currency.ts\n   dates.ts\n   error.ts\n   file.ts\n   git.ts\n   logger.ts\n   lru-cache.ts\n   messages.ts\n   min-heap.ts\n   model-utils.ts\n   object.ts\n   partial-json-delta.ts\n   patch.ts\n   promise.ts\n   random.ts\n   referral.ts\n   saxy.ts\n   string.knowledge.md\n   string.ts\n   stripe.ts\n   sync-failure.ts\n   xml.ts\n   zod-schema.ts\n  websockets/\n   websocket-client.ts\n   websocket-schema.ts\n  actions.ts\n  analytics.ts\n  browser-actions.ts\n  constants.ts\n  project-file-tree.ts\n knowledge.md\n package.json\n tsconfig.json\nevals/\n git-evals/\n  email-eval-results.ts\n  eval-levelcode.json\n  eval-manifold.json\n  eval-result-levelcode-mock.json\n  gen-evals.ts\n  judge-git-eval.ts\n  post-eval-analysis.ts\n  run-eval-set.ts\n  run-git-evals.ts\n  run-single-eval-process.ts\n  run-single-eval.ts\n  setup-test-repo.ts\n  types.ts\n .gitignore\n bun.lock\n constants.ts\n e2e-cat-app-script.ts\n knowledge.md\n package.json\n scaffolding.ts\n swe-bench-eval.ts\n swe-bench-ids.ts\n swe-bench.test.ts\n test-repos.json\n test-setup.ts\n tsconfig.json\nnpm-app/\n release/\n  index.js\n  package.json\n  README.md\n release-staging/\n  index.js\n  package.json\n  README.md\n scripts/\n  build-binary.js\n  generate-github-token.ts\n  patch-web-tree-sitter.ts\n  release.js\n  twitch-plays-levelcode.sh\n src/\n  __tests__/\n   display.test.ts\n   tool-handlers.test.ts\n  agents/\n   agent-utils.ts\n   load-agents.ts\n  checkpoints/\n   checkpoint-manager.ts\n   file-manager.ts\n  cli-handlers/\n   agent-creation-chat.ts\n   agents.ts\n   api-key.ts\n   checkpoint.ts\n   diff.ts\n   easter-egg.ts\n   inititalization-flow.ts\n   mini-chat.ts\n   publish.ts\n   subagent-list.ts\n   subagent.ts\n  display/\n   overrides.ts\n   print-mode.ts\n   squash-newlines.ts\n  json-config/\n   hooks.ts\n   parser.ts\n  native/\n   ripgrep.ts\n  terminal/\n   background.ts\n   run-command.ts\n  utils/\n   __tests__/\n    __snapshots__/\n     background-process-manager.test.ts.snap\n     frustration-detector.test.ts.snap\n     rage-detector.test.ts.snap\n     xml-stream-parser.test.ts.snap\n    background-process-manager.test.ts\n    rage-detector.test.ts\n    response-example-4-files.txt\n    tool-renderers.test.ts\n    xml-stream-parser.test.ts\n   agent-validation.ts\n   analytics.ts\n   detect-shell.ts\n   git.ts\n   logger.ts\n   rage-detector.ts\n   spinner.ts\n   suppress-console.ts\n   system-info.ts\n   terminal.ts\n   tool-renderers.ts\n   with-hang-detection.ts\n   xml-stream-parser.ts\n  workers/\n   checkpoint-worker.ts\n   project-context.ts\n  background-process-manager.ts\n  browser-runner.ts\n  chat-storage.ts\n  cli-definitions.ts\n  cli.ts\n  client.ts\n  config.ts\n  create-template-project.ts\n  credentials.ts\n  dev-process-manager.ts\n  diff-manager.ts\n  fingerprint.ts\n  index.ts\n  menu.ts\n  project-files.ts\n  rage-detectors.ts\n  startup-process-handler.ts\n  subagent-storage.ts\n  tool-handlers.ts\n  types.ts\n  web-scraper.ts\n .gitignore\n bunfig.toml\n package.json\n tsconfig.json\npackages/\n bigquery/\n  src/\n   client.ts\n   index.ts\n   schema.ts\n  knowledge.md\n  package.json\n  tsconfig.json\n billing/\n  src/\n   __tests__/\n    credit-delegation.test.ts\n    extract-owner-repo.test.ts\n    org-billing.test.ts\n   auto-topup.ts\n   balance-calculator.ts\n   billing.knowledge.md\n   conversion.ts\n   credit-delegation.ts\n   grant-credits.knowledge.md\n   grant-credits.ts\n   index.ts\n   org-billing.ts\n   org-monitoring.ts\n   usage-service.ts\n   utils.ts\n  knowledge.md\n  package.json\n  project.json\n  tsconfig.json\n build-tools/\n  executors/\n   infisical-run/\n    executor.ts\n    schema.json\n  executors.json\n  package.json\n  project.json\n  tsconfig.json\n code-map/\n  __tests__/\n   test-langs/\n    test.c\n    test.cpp\n    test.cs\n    test.go\n    test.java\n    test.js\n    test.php\n    test.py\n    test.rb\n    test.rs\n    test.ts\n   languages.test.ts\n   parse.test.ts\n  src/\n   tree-sitter-queries/\n    readme.md\n    tree-sitter-c_sharp-tags.scm\n    tree-sitter-c-tags.scm\n    tree-sitter-cpp-tags.scm\n    tree-sitter-go-tags.scm\n    tree-sitter-java-tags.scm\n    tree-sitter-javascript-tags.scm\n    tree-sitter-php-tags.scm\n    tree-sitter-python-tags.scm\n    tree-sitter-ruby-tags.scm\n    tree-sitter-rust-tags.scm\n    tree-sitter-typescript-tags.scm\n   index.ts\n   languages.ts\n   parse.ts\n  package.json\n  tsconfig.json\n internal/\n  src/\n   loops/\n    client.ts\n    index.ts\n    types.ts\n   openrouter-ai-sdk/\n    internal/\n     index.ts\n    schemas/\n     reasoning-details.ts\n    types/\n     index.ts\n     openrouter-chat-completions-input.ts\n     openrouter-chat-settings.ts\n    .gitignore\n    convert-to-openrouter-chat-messages.test.ts\n    convert-to-openrouter-chat-messages.ts\n    convert-to-openrouter-completion-prompt.ts\n    index.ts\n    map-openrouter-chat-logprobs.ts\n    map-openrouter-completion-logprobs.ts\n    map-openrouter-finish-reason.ts\n    openrouter-chat-language-model.test.ts\n    openrouter-chat-language-model.ts\n    openrouter-completion-language-model.test.ts\n    openrouter-completion-language-model.ts\n    openrouter-completion-settings.ts\n    openrouter-error.ts\n    openrouter-facade.ts\n    openrouter-provider-options.test.ts\n    openrouter-provider.ts\n    openrouter-stream-usage-accounting.test.ts\n    openrouter-usage-accounting.test.ts\n   utils/\n    __tests__/\n     version-utils.test.ts\n    auth.ts\n    version-utils.ts\n    xml-parser.ts\n   env.ts\n   index.ts\n   knowledge.md\n  package.json\n  tsconfig.json\npython-app/\n src/\n  levelcode/\n   __init__.py\n .gitignore\n knowledge.md\n LICENSE\n pyproject.toml\n README.md\nscripts/\n changelog/\n  2025-05-18-version-10283-release-enhanced-assistant-experience-system-stability.mdx\n  2025-05-25-version-10295-enhanced-ai-models-and-user-experience-improvements.mdx\n  2025-06-01-version-10305-release-enhanced-ai-models-new-commands-and-performance-improvements.mdx\n  docs.json\n ft-file-selection/\n  .gitignore\n  collect-tuning-data.ts\n  grade-traces.ts\n  print-recent-relabels.ts\n  print-recent-traces.ts\n  README.md\n  relabel-for-offline-scoring.ts\n  relabel-traces-with-context.ts\n  relabel-traces.ts\n .gitignore\n analyze-edit-blocks.ts\n analyze-model-usage.ts\n apply-credit-migration.ts\n calculate-average-spend.ts\n calculate-dau.ts\n calculate-monthly-usage.ts\n calculate-mrr.ts\n calculate-weekly-usage.ts\n cleanup-worktree.sh\n convert-escaped-newlines.ts\n count-edit-file.ts\n debug-log-subset.ts\n dev.sh\n export-user-emails.ts\n generate-ci-env.js\n generate-tool-definitions.ts\n get-changelog.ts\n init-worktree.ts\n package.json\n tsconfig.json\n update-stripe-subscriptions.ts\nsdk/\n scripts/\n  publish.js\n src/\n  tools/\n   change-file.ts\n   read-files.ts\n  types/\n   agent-definition.ts\n   tools.ts\n  client.ts\n  constants.ts\n  index.ts\n  process-stream.ts\n  websocket-client.ts\n .npmignore\n CHANGELOG.md\n package.json\n PUBLISHING.md\n README.md\n tsconfig.json\nweb/\n public/\n  levelcode-intro1.webm\n scripts/\n  discord/\n   index.ts\n   register-commands.ts\n src/\n  __tests__/\n   e2e/\n    home.spec.ts\n   unit/\n    home.spec.tsx\n  actions/\n   hello-action.ts\n  app/\n   [sponsee]/\n    page.tsx\n   admin/\n    file-picker/\n     page.tsx\n    orgs/\n     page.tsx\n    traces/\n     components/\n      chat-message.tsx\n      client-session-viewer.tsx\n      empty-state.tsx\n      error-boundary.tsx\n      loading-skeletons.tsx\n      timeline-chart.module.css\n      timeline-chart.tsx\n      trace-viewer.tsx\n     utils/\n      __tests__/\n       trace-processing.test.ts\n      trace-processing.ts\n     page.tsx\n    layout.tsx\n   affiliates/\n    actions.ts\n    page.tsx\n   agents/\n    page.tsx\n   api/\n    admin/\n     orgs/\n      [orgId]/\n       features/\n        [feature]/\n         route.ts\n      export/\n       route.ts\n      route.ts\n     relabel-for-user/\n      route.ts\n     traces/\n      [clientRequestId]/\n       messages/\n        route.ts\n       timeline/\n        route.ts\n      client/\n       [clientId]/\n        sessions/\n         route.ts\n     admin-auth.ts\n    agents/\n     [publisherId]/\n      [agentId]/\n       [version]/\n        route.ts\n       latest/\n        route.ts\n     publish/\n      route.ts\n     validate/\n      route.ts\n     route.ts\n    api-keys/\n     route.ts\n    auth/\n     [...nextauth]/\n      auth-options.ts\n      route.ts\n     cli/\n      code/\n       route.ts\n      logout/\n       route.ts\n      status/\n       route.ts\n    feed/\n     route.ts\n    git-evals/\n     visibility/\n      route.ts\n     route.ts\n    healthz/\n     route.ts\n    invites/\n     [token]/\n      route.ts\n    orgs/\n     [orgId]/\n      alerts/\n       [alertId]/\n        dismiss/\n         route.ts\n       route.ts\n      analytics/\n       export/\n        route.ts\n       route.ts\n      billing/\n       setup/\n        route.ts\n       status/\n        route.ts\n       subscription/\n        route.ts\n      credits/\n       route.ts\n      invitations/\n       [email]/\n        resend/\n         route.ts\n        route.ts\n       bulk/\n        route.ts\n       route.ts\n      members/\n       [userId]/\n        route.ts\n       route.ts\n      monitoring/\n       route.ts\n      publishers/\n       route.ts\n      repos/\n       [repoId]/\n        route.ts\n       route.ts\n      settings/\n       route.ts\n      usage/\n       export/\n        route.ts\n       route.ts\n      route.ts\n     slug/\n      [slug]/\n       route.ts\n     route.ts\n    publishers/\n     [id]/\n      organization/\n       route.ts\n     validate/\n      route.ts\n     route.ts\n    referrals/\n     [code]/\n      route.ts\n     helpers.ts\n     route.ts\n    stripe/\n     buy-credits/\n      route.ts\n     webhook/\n      route.ts\n    upload/\n     avatar/\n      route.ts\n    user/\n     auto-topup/\n      route.ts\n     profile/\n      route.ts\n     usage/\n      route.ts\n   config/\n    page.tsx\n   docs/\n    [category]/\n     layout.tsx\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   evals/\n    evals-table.tsx\n    page.tsx\n   invites/\n    [token]/\n     page.tsx\n   login/\n    page.tsx\n   onboard/\n    page.tsx\n   orgs/\n    [slug]/\n     analytics/\n      page.tsx\n     billing/\n      purchase/\n       page.tsx\n      setup/\n       page.tsx\n     repositories/\n      page.tsx\n     settings/\n      page.tsx\n     team/\n      page.tsx\n     usage/\n      page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   payment-success/\n    page.tsx\n   pricing/\n    page.tsx\n   privacy-policy/\n    page.tsx\n   publishers/\n    [id]/\n     agents/\n      [agentId]/\n       [version]/\n        page.tsx\n     page.tsx\n    new/\n     page.tsx\n    page.tsx\n   referrals/\n    [code]/\n     metadata.ts\n     page.tsx\n    layout.tsx\n    page.tsx\n   terms-of-service/\n    page.tsx\n   usage/\n    layout.tsx\n    page.tsx\n    usage-display.tsx\n   analytics.knowledge.md\n   layout.tsx\n   page.tsx\n   robots.ts\n   sitemap.ts\n  components/\n   agent/\n    json-viewer.tsx\n   auto-topup/\n    AutoTopupSettings.tsx\n    AutoTopupSettingsForm.tsx\n    AutoTopupSwitch.tsx\n    BaseAutoTopupSettings.tsx\n    BaseAutoTopupSettingsForm.tsx\n    BaseAutoTopupSwitch.tsx\n    constants.ts\n    OrgAutoTopupSettings.tsx\n    OrgAutoTopupSettingsForm.tsx\n    OrgAutoTopupSwitch.tsx\n    types.ts\n   credits/\n    CreditManagementSection.tsx\n    CreditPurchaseSection.tsx\n   docs/\n    mdx/\n     code-demo.tsx\n     custom-link.tsx\n     markdown-table.tsx\n     mdx-components.tsx\n     mermaid-diagram.tsx\n     schema-display.tsx\n    copy-heading.tsx\n    doc-sidebar.tsx\n    docs.knowledge.md\n    toc.tsx\n   login/\n    login-card.tsx\n    login-client-wrapper.tsx\n   navbar/\n    navbar.tsx\n    user-dropdown.tsx\n   organization/\n    advanced-monitor.tsx\n    billing-alerts.tsx\n    billing-reports.tsx\n    billing-status.tsx\n    credit-monitor.tsx\n    model-config-sheet.tsx\n    organization-success-modal.tsx\n    repository-management.tsx\n    team-management.tsx\n   providers/\n    query-client-provider.tsx\n   publisher/\n    basic-info-step.tsx\n    ownership-step.tsx\n    profile-details-step.tsx\n    step-template.tsx\n   sign-in/\n    sign-in-button.tsx\n    sign-in-card-footer.tsx\n   ui/\n    landing/\n     competition/\n      claude-code.tsx\n      cline.tsx\n      cursor.tsx\n      github-copilot.tsx\n      index.tsx\n      tabs.tsx\n     feature/\n      browser-comparison.tsx\n      chart-illustration.tsx\n      code-illustration.tsx\n      highlight-text.tsx\n      index.tsx\n      workflow-illustration.tsx\n     animated-element.tsx\n     constants.ts\n     cta-section.tsx\n     demo-code-display.tsx\n     testimonials-section.tsx\n     types.ts\n    terminal/\n     index.tsx\n     style.css\n     terminal-input.tsx\n     terminal-output.tsx\n    avatar-upload.tsx\n    background-beams.tsx\n    badge.tsx\n    banner.tsx\n    button.tsx\n    card.tsx\n    collapsible.tsx\n    credit-confetti.tsx\n    decorative-blocks.tsx\n    dialog.tsx\n    dropdown-menu.tsx\n    enhanced-copy-button.tsx\n    footer.tsx\n    hero-buttons.tsx\n    hero.tsx\n    input.tsx\n    install-dialog.tsx\n    label.tsx\n    neon-gradient-button.tsx\n    progress.tsx\n    radio-group.tsx\n    section.tsx\n    select.tsx\n    separator.tsx\n    sheet.tsx\n    sidebar.tsx\n    skeleton-loading.tsx\n    skeleton.tsx\n    slider.tsx\n    switch.tsx\n    table.tsx\n    tabs.tsx\n    textarea.tsx\n    toast.tsx\n    toaster.tsx\n    tooltip.tsx\n    use-toast.ts\n   BrowserPreview.tsx\n   card-with-beams.tsx\n   CookieConsentCard.tsx\n   footer.tsx\n   icons.tsx\n   IDEDemo.tsx\n   layout-wrapper.tsx\n   TerminalDemo.tsx\n   theme-provider.tsx\n   theme-switcher.tsx\n  content/\n   advanced/\n    claude-code-comparison.mdx\n    config.mdx\n    how-does-it-work.mdx\n    large-projects.mdx\n    troubleshooting.mdx\n    what-models.mdx\n   agents/\n    agent-reference.mdx\n    creating-new-agents.mdx\n    customizing-agents.mdx\n    overview.mdx\n    troubleshooting-agent-customization.mdx\n   case-studies/\n    _cta.mdx\n    benjamin-bryant.mdx\n    oliver-lukesch.mdx\n   help/\n    faq.mdx\n    getting-started.mdx\n   tips/\n    best-practices.mdx\n    keyboard-shortcuts.mdx\n    knowledge-files.mdx\n    other-use-cases.mdx\n    version-control.mdx\n    where-levelcode-shines.mdx\n  discord/\n   client.ts\n   rate-limiter.ts\n  hooks/\n   use-auto-topup.ts\n   use-install-dialog.ts\n   use-mobile.tsx\n   use-model-config.ts\n   use-org-auto-topup.ts\n   use-organization-data.ts\n   use-user-profile.ts\n  lib/\n   server/\n    referral.ts\n   validators/\n    publisher.ts\n   admin-auth.ts\n   constant.ts\n   currency.ts\n   docs.ts\n   fonts.ts\n   organization-permissions.ts\n   PostHogProvider.tsx\n   publisher-permissions.ts\n   remark-code-to-codedemo.ts\n   server-init.ts\n   SessionProvider.tsx\n   stripe-utils.ts\n   testimonials.ts\n   trackConversions.ts\n   utils.ts\n  styles/\n   globals.css\n  types/\n   docs.ts\n   user.ts\n  util/\n   logger.ts\n .eslintignore\n .eslintrc.js\n .gitignore\n .prettierignore\n .prettierrc.js\n commitlint.config.js\n components.json\n contentlayer.config.ts\n jest.config.js\n jest.setup.js\n knowledge.md\n next.config.mjs\n package.json\n playwright.config.ts\n postcss.config.cjs\n README.md\n tailwind.config.ts\n tsconfig.json\n.envrc\n.gitignore\n.infisical.json\n.prettierrc\nauthentication.knowledge.md\nbun.lock\nbunfig.toml\nlevelcode.json\neslint.config.js\nknowledge.md\npackage.json\nREADME.md\ntsconfig.base.json\ntsconfig.json\nWINDOWS.md\n",
              "tokenCount": 9007,
              "truncationLevel": "none"
            }
          ]
        }
      ],
      "parentAgentId": "D-gYCDTSHSY"
    },
    {
      "type": "tool_result",
      "toolCallId": "ab5ce625-a859-4743-acee-dc28c1cd81d3",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": "No results",
            "message": "Exit code: 1"
          }
        }
      ],
      "parentAgentId": "D-gXwl0iLRI"
    },
    {
      "type": "tool_result",
      "toolCallId": "1ad7baa2-ff78-4573-9ba8-96171d5fdd73",
      "toolName": "run_terminal_command",
      "output": [
        {
          "type": "json",
          "value": {
            "command": "cat package.json scripts/package.json backend/package.json common/package.json | grep -E 'typecheck|lint|test|format' -A5",
            "stdout": "    \"start-levelcode-test\": \"bun --cwd npm-app start --cwd ../../levelcode-test\",\n    \"start-litestar\": \"bun --cwd npm-app start-litestar\",\n    \"start-jpcsp\": \"bun --cwd npm-app start-jpcsp\",\n    \"start-vscode\": \"bun --cwd npm-app start-vscode\",\n    \"start-nushell\": \"bun --cwd npm-app start-nushell\",\n    \"format\": \"prettier --write \\\"**/*.{ts,tsx,json,md}\\\"\",\n    \"release:npm-app\": \"bun run --cwd npm-app release\",\n    \"clean-ts\": \"find . -name '*.tsbuildinfo' -type f -delete && find . -name '.next' -type d -exec rm -rf {} + 2>/dev/null || true && find . -name 'node_modules' -type d -exec rm -rf {} + 2>/dev/null || true && bun install\",\n    \"typecheck\": \"bun --filter='*' run typecheck && echo ' All type checks passed!'\",\n    \"test\": \"bun --filter='{@levelcode/backend,@levelcode/common,@levelcode/npm-app}' run test\",\n    \"init-worktree\": \"bun scripts/init-worktree.ts\",\n    \"cleanup-worktree\": \"bash scripts/cleanup-worktree.sh\",\n    \"generate-tool-definitions\": \"bun scripts/generate-tool-definitions.ts\"\n  },\n  \"dependencies\": {\n--\n    \"@typescript-eslint/eslint-plugin\": \"^6.17\",\n    \"bun-types\": \"^1.2.2\",\n    \"eslint-config-prettier\": \"^9.1.0\",\n    \"eslint-plugin-import\": \"^2.29.1\",\n    \"eslint-plugin-unused-imports\": \"^4.1.4\",\n    \"ignore\": \"^6.0.2\",\n    \"lodash\": \"4.17.21\",\n    \"prettier\": \"3.3.2\",\n    \"ts-node\": \"^10.9.2\",\n    \"ts-pattern\": \"^5.5.0\",\n--\n    \"typescript-eslint\": \"^7.17.0\"\n  },\n  \"engines\": {\n    \"node\": \">=20.0.0\"\n  },\n  \"packageManager\": \"yarn@1.22.22+sha512.a6b2f7906b721bba3d67d4aff083df04dad64c399707841b7acf00f6b133b7ac24255f2652fa22ae3534329dc6180534e98d17432037ff6fd140556e2bb3137e\"\n--\n    \"typecheck\": \"tsc --noEmit -p .\",\n    \"test\": \"bun test\",\n    \"debug-log-subset\": \"bun run debug-log-subset.ts\",\n    \"typecheck-all\": \"bun run typecheck-all.ts\"\n  },\n  \"sideEffects\": false,\n  \"engines\": {\n    \"bun\": \">=1.2.11\"\n  },\n--\n    \"typecheck\": \"tsc --noEmit -p .\",\n    \"test\": \"bun test\"\n  },\n  \"sideEffects\": false,\n  \"engines\": {\n    \"bun\": \">=1.2.11\"\n  },\n--\n    \"typecheck\": \"tsc --noEmit -p .\",\n    \"test\": \"bun test\",\n    \"db:generate\": \"drizzle-kit generate --config=./src/db/drizzle.config.ts\",\n    \"db:migrate\": \"drizzle-kit push --config=./src/db/drizzle.config.ts\",\n    \"db:start\": \"docker compose -f ./src/db/docker-compose.yml up --wait && bun run db:generate && (timeout 1 || sleep 1) && bun run db:migrate\",\n    \"db:studio\": \"drizzle-kit studio --config=./src/db/drizzle.config.ts\"\n  },\n",
            "exitCode": 0
          }
        }
      ],
      "parentAgentId": "D-gXwlFcRHk"
    },
    {
      "type": "tool_call",
      "toolCallId": "aae79609-2956-4fc1-a52c-03ee02d9a417",
      "toolName": "code_search",
      "input": {
        "pattern": "file-explorer spawn",
        "flags": "-g *.ts"
      },
      "agentId": "D-gXwl0iLRI",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "aae79609-2956-4fc1-a52c-03ee02d9a417",
      "toolName": "code_search",
      "output": [
        {
          "type": "json",
          "value": {
            "stdout": "No results",
            "message": "Exit code: 1"
          }
        }
      ],
      "parentAgentId": "D-gXwl0iLRI"
    },
    {
      "type": "tool_call",
      "toolCallId": "accf2fd3-8e3d-4962-b693-b9a57d7abf73",
      "toolName": "set_output",
      "input": {
        "results": [
          {
            "stdout": "No results",
            "message": "Exit code: 1"
          },
          {
            "stdout": "No results",
            "message": "Exit code: 1"
          }
        ]
      },
      "agentId": "D-gXwl0iLRI",
      "parentAgentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "accf2fd3-8e3d-4962-b693-b9a57d7abf73",
      "toolName": "set_output",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Output set"
          }
        }
      ],
      "parentAgentId": "D-gXwl0iLRI"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-gXwl0iLRI",
      "agentType": "code-searcher",
      "displayName": "Code Searcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "",
      "params": {
        "searchQueries": [
          {
            "pattern": "your-custom-agent|git-committer",
            "flags": "-g common/src/util/examples"
          },
          {
            "pattern": "file-explorer spawn",
            "flags": "-g *.ts"
          }
        ]
      }
    },
    {
      "type": "text",
      "agentId": "D-gXwlFcRHk",
      "text": "### Root `package.json`\n- **format**: `\"prettier --write \\\"**/*.{ts,tsx,json,md}\\\"\"`\n- **typecheck**: `\"bun --filter='*' run typecheck && echo ' All type checks passed!'\"`\n- **test**: `\"bun --filter='{@levelcode/backend,@levelcode/common,@levelcode/npm-app}' run test\"`\n- No `lint` script.\n\n### `scripts/package.json`\n- **typecheck**: `\"tsc --noEmit -p .\"`\n- **test**: `\"bun test\"`\n- No `lint` or `format` scripts.\n\n### `backend/package.json`\n- **typecheck**: `\"tsc --noEmit -p .\"`\n- **test**: `\"bun test\"`\n- No `lint` or `format` scripts.\n\n### `common/package.json`\n- **typecheck**: `\"tsc --noEmit -p .\"`\n- **test**: `\"bun test\"`\n- No `lint` or `format` scripts."
    },
    {
      "type": "text",
      "agentId": "D-gXwryrlBs",
      "text": "common/src/util/examples/diff-reviewer-1.ts\ncommon/src/util/examples/diff-reviewer-2.ts\ncommon/src/util/examples/diff-reviewer-3.ts\ncommon/src/util/changes.ts\ncommon/src/util/file.ts\ncommon/src/util/git.ts\ncommon/src/util/string.ts\ncommon/src/util/logger.ts\ncommon/src/util/messages.ts\ncommon/src/util/object.ts\ncommon/src/util/error.ts\ncommon/src/util/__tests__/string.test.ts"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-gXwlFcRHk",
      "agentType": "commander-lite",
      "displayName": "Commander Lite",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "What are the package.json scripts for typecheck, lint, test, format in the root and relevant packages?",
      "params": {
        "command": "cat package.json scripts/package.json backend/package.json common/package.json | grep -E 'typecheck|lint|test|format' -A5"
      }
    },
    {
      "type": "subagent_finish",
      "agentId": "D-gYCDTSHSY",
      "agentType": "file-lister",
      "displayName": "Liszt the File Lister",
      "onlyChild": true,
      "parentAgentId": "D-gXwryrlBs",
      "prompt": "common/src/util/examples directory contents and related files",
      "params": {}
    },
    {
      "type": "tool_result",
      "toolCallId": "7452f59a-29c2-4003-9d1e-7efd0b614f3b",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Liszt the File Lister",
              "agentType": "file-lister",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "common/src/util/examples/diff-reviewer-1.ts\ncommon/src/util/examples/diff-reviewer-2.ts\ncommon/src/util/examples/diff-reviewer-3.ts\ncommon/src/util/changes.ts\ncommon/src/util/file.ts\ncommon/src/util/git.ts\ncommon/src/util/string.ts\ncommon/src/util/logger.ts\ncommon/src/util/messages.ts\ncommon/src/util/object.ts\ncommon/src/util/error.ts\ncommon/src/util/__tests__/string.test.ts"
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ],
      "parentAgentId": "D-gXwryrlBs"
    },
    {
      "type": "tool_call",
      "toolCallId": "9e737d3d-c653-4d42-ae83-1eeb21b0884c",
      "toolName": "read_files",
      "input": {
        "paths": [
          "common/src/util/examples/diff-reviewer-1.ts",
          "common/src/util/examples/diff-reviewer-2.ts",
          "common/src/util/examples/diff-reviewer-3.ts",
          "common/src/util/changes.ts",
          "common/src/util/file.ts",
          "common/src/util/git.ts",
          "common/src/util/string.ts",
          "common/src/util/logger.ts",
          "common/src/util/messages.ts",
          "common/src/util/object.ts",
          "common/src/util/error.ts",
          "common/src/util/__tests__/string.test.ts"
        ]
      },
      "agentId": "D-gXwryrlBs",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "9e737d3d-c653-4d42-ae83-1eeb21b0884c",
      "toolName": "read_files",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "path": "common/src/util/examples/diff-reviewer-1.ts",
              "content": "import type { AgentDefinition } from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-1',\n\n  displayName: 'Diff Reviewer (Level 1)',\n  model: 'openai/gpt-5',\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements`,\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/examples/diff-reviewer-2.ts",
              "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-2',\n  displayName: 'Diff Reviewer (Level 2)',\n  model: 'openai/gpt-5',\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n    // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 2: Let AI run the rest of the steps!\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/examples/diff-reviewer-3.ts",
              "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-3',\n\n  displayName: 'Diff Reviewer (Level 3)',\n  model: 'openai/gpt-5',\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  outputMode: 'last_message',\n\n  toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\n  spawnableAgents: ['james/file-explorer@0.1.3'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Review the changes and suggest improvements.\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n    // Step 1: Get list of changed files from git diff --name-only\n    const { toolResult: gitDiffFilesResult } = yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff --name-only',\n      },\n    }\n\n    // Then, extract file paths from the result\n    const changedFiles = (gitDiffFilesResult || '')\n      .split('\\n')\n      .map((line) => line.trim())\n      .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\n\n    // Step 2: Read the files\n    if (changedFiles.length > 0) {\n      yield {\n        toolName: 'read_files',\n        args: {\n          paths: changedFiles,\n        },\n      }\n    }\n\n    // Step 3: Run full git diff to see the actual changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 4: Put words in the AI's mouth to get it to spawn the file explorer.\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          'Now I will spawn a file explorer to find any missing codebase context.',\n      },\n    }\n\n    yield 'STEP'\n\n    // Step 5: Put words in the AI's mouth to review the changes.\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content: 'Here is my comprehensive review of the changes.',\n      },\n    }\n\n    // Step 6: Let AI review the changes in a final step. (The last message is also the agent's output.)\n    yield 'STEP'\n  },\n}\n\nexport default definition\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/changes.ts",
              "content": "import fs from 'fs'\nimport path from 'path'\n\nimport { isFileIgnored } from '../project-file-tree'\nimport { applyPatch } from './patch'\n\nimport type { FileChanges } from '../actions'\n\nexport function applyChanges(projectRoot: string, changes: FileChanges) {\n  const created: string[] = []\n  const modified: string[] = []\n  const ignored: string[] = []\n  const invalid: string[] = []\n\n  for (const change of changes) {\n    const { path: filePath, content, type } = change\n    try {\n      if (isFileIgnored(filePath, projectRoot)) {\n        ignored.push(filePath)\n        continue\n      }\n    } catch {\n      // File path caused an error.\n      invalid.push(filePath)\n      continue\n    }\n    try {\n      const fullPath = path.join(projectRoot, filePath)\n      const fileExists = fs.existsSync(fullPath)\n      if (!fileExists) {\n        // Create directories in the path if they don't exist\n        const dirPath = path.dirname(fullPath)\n        fs.mkdirSync(dirPath, { recursive: true })\n      }\n\n      if (type === 'file') {\n        fs.writeFileSync(fullPath, content)\n      } else {\n        const oldContent = fs.readFileSync(fullPath, 'utf-8')\n        const newContent = applyPatch(oldContent, content)\n        fs.writeFileSync(fullPath, newContent)\n      }\n      if (fileExists) {\n        modified.push(filePath)\n      } else {\n        created.push(filePath)\n      }\n    } catch (error) {\n      console.error(`Failed to apply patch to ${filePath}:`, error, content)\n      invalid.push(filePath)\n    }\n  }\n\n  return { created, modified, ignored, invalid }\n}\n\nexport async function applyAndRevertChanges(\n  projectRoot: string,\n  changes: FileChanges,\n  onApply: () => Promise<void>,\n) {\n  const filesChanged = changes.map((change) => change.path)\n  const files = Object.fromEntries(\n    filesChanged.map((filePath) => {\n      const fullPath = path.join(projectRoot, filePath)\n      const oldContent = fs.existsSync(fullPath)\n        ? fs.readFileSync(fullPath, 'utf-8')\n        : '[DOES_NOT_EXIST]'\n      return [filePath, oldContent]\n    }),\n  )\n  applyChanges(projectRoot, changes)\n  try {\n    await onApply()\n  } catch (error) {\n    console.error(`Failed to apply changes:`, error)\n  }\n  for (const [filePath, oldContent] of Object.entries(files)) {\n    if (oldContent === '[DOES_NOT_EXIST]') {\n      if (fs.existsSync(path.join(projectRoot, filePath))) {\n        fs.unlinkSync(path.join(projectRoot, filePath))\n      }\n    } else {\n      fs.writeFileSync(path.join(projectRoot, filePath), oldContent)\n    }\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/file.ts",
              "content": "import * as fs from 'fs'\nimport * as os from 'os'\nimport * as path from 'path'\n\nimport { z } from 'zod'\n\nimport { LevelCodeConfigSchema } from '../json-config/constants'\nimport { DynamicAgentTemplateSchema } from '../types/dynamic-agent-template'\n\nexport const FileTreeNodeSchema: z.ZodType<FileTreeNode> = z.object({\n  name: z.string(),\n  type: z.enum(['file', 'directory']),\n  children: z.lazy(() => z.array(FileTreeNodeSchema).optional()),\n  filePath: z.string(),\n})\n\nexport interface FileTreeNode {\n  name: string\n  type: 'file' | 'directory'\n  filePath: string\n  lastReadTime?: number\n  children?: FileTreeNode[]\n}\n\nexport interface DirectoryNode extends FileTreeNode {\n  type: 'directory'\n  children: FileTreeNode[]\n}\n\nexport interface FileNode extends FileTreeNode {\n  type: 'file'\n  lastReadTime: number\n}\n\nexport const FileVersionSchema = z.object({\n  path: z.string(),\n  content: z.string(),\n})\n\nexport type FileVersion = z.infer<typeof FileVersionSchema>\n\nexport const ProjectFileContextSchema = z.object({\n  projectRoot: z.string(),\n  cwd: z.string(),\n  fileTree: z.array(z.custom<FileTreeNode>()),\n  fileTokenScores: z.record(z.string(), z.record(z.string(), z.number())),\n  tokenCallers: z\n    .record(z.string(), z.record(z.string(), z.array(z.string())))\n    .optional(),\n  knowledgeFiles: z.record(z.string(), z.string()),\n  userKnowledgeFiles: z.record(z.string(), z.string()).optional(),\n  agentTemplates: z.record(z.string(), z.any()).default({}),\n  levelcodeConfig: LevelCodeConfigSchema.optional(),\n  gitChanges: z.object({\n    status: z.string(),\n    diff: z.string(),\n    diffCached: z.string(),\n    lastCommitMessages: z.string(),\n  }),\n  changesSinceLastChat: z.record(z.string(), z.string()),\n  shellConfigFiles: z.record(z.string(), z.string()),\n  systemInfo: z.object({\n    platform: z.string(),\n    shell: z.string(),\n    nodeVersion: z.string(),\n    arch: z.string(),\n    homedir: z.string(),\n    cpus: z.number(),\n  }),\n  fileVersions: z.array(z.array(FileVersionSchema)).optional(), // Keep temporarily for migration\n})\n\nexport type ProjectFileContext = z.infer<typeof ProjectFileContextSchema>\n\nexport const fileRegex =\n  /<write_file>\\s*<path>([^<]+)<\\/path>\\s*<content>([\\s\\S]*?)<\\/content>\\s*<\\/write_file>/g\nexport const fileWithNoPathRegex = /<write_file>([\\s\\S]*?)<\\/write_file>/g\n\nexport const parseFileBlocks = (fileBlocks: string) => {\n  let fileMatch\n  const files: Record<string, string> = {}\n  while ((fileMatch = fileRegex.exec(fileBlocks)) !== null) {\n    const [, filePath, fileContent] = fileMatch\n    files[filePath] = fileContent.startsWith('\\n')\n      ? fileContent.slice(1)\n      : fileContent\n  }\n  return files\n}\n\nexport const getStubProjectFileContext = (): ProjectFileContext => ({\n  projectRoot: '',\n  cwd: '',\n  fileTree: [],\n  fileTokenScores: {},\n  knowledgeFiles: {},\n  userKnowledgeFiles: {},\n  agentTemplates: {},\n  levelcodeConfig: undefined,\n  gitChanges: {\n    status: '',\n    diff: '',\n    diffCached: '',\n    lastCommitMessages: '',\n  },\n  changesSinceLastChat: {},\n  shellConfigFiles: {},\n  systemInfo: {\n    platform: '',\n    shell: '',\n    nodeVersion: '',\n    arch: '',\n    homedir: '',\n    cpus: 0,\n  },\n})\n\nexport const createMarkdownFileBlock = (filePath: string, content: string) => {\n  return `\\`\\`\\`${filePath}\\n${content}\\n\\`\\`\\``\n}\n\nexport const parseMarkdownCodeBlock = (content: string) => {\n  const match = content.match(/^```(?:[a-zA-Z]+)?\\n([\\s\\S]*)\\n```$/)\n  if (match) {\n    return match[1] + '\\n'\n  }\n  return content\n}\n\nexport const createSearchReplaceBlock = (search: string, replace: string) => {\n  return `<<<<<<< SEARCH\\n${search}\\n=======\\n${replace}\\n>>>>>>> REPLACE`\n}\n\nexport function printFileTree(\n  nodes: FileTreeNode[],\n  depth: number = 0,\n): string {\n  let result = ''\n  const indentation = ' '.repeat(depth)\n  for (const node of nodes) {\n    result += `${indentation}${node.name}${node.type === 'directory' ? '/' : ''}\\n`\n    if (node.type === 'directory' && node.children) {\n      result += printFileTree(node.children, depth + 1)\n    }\n  }\n  return result\n}\n\nexport function printFileTreeWithTokens(\n  nodes: FileTreeNode[],\n  fileTokenScores: Record<string, Record<string, number>>,\n  path: string[] = [],\n): string {\n  let result = ''\n  const depth = path.length\n  const indentToken = ' '\n  const indentation = indentToken.repeat(depth)\n  const indentationWithFile = indentToken.repeat(depth + 1)\n  for (const node of nodes) {\n    if (\n      node.type === 'directory' &&\n      (!node.children || node.children.length === 0)\n    ) {\n      // Skip empty directories\n      continue\n    }\n    result += `${indentation}${node.name}${node.type === 'directory' ? '/' : ''}`\n    path.push(node.name)\n    const filePath = path.join('/')\n    const tokenScores = fileTokenScores[filePath]\n    if (node.type === 'file' && tokenScores) {\n      const tokens = Object.keys(tokenScores)\n      if (tokens.length > 0) {\n        result += `\\n${indentationWithFile}${tokens.join(' ')}`\n      }\n    }\n    result += '\\n'\n    if (node.type === 'directory' && node.children) {\n      result += printFileTreeWithTokens(node.children, fileTokenScores, path)\n    }\n    path.pop()\n  }\n  return result\n}\n\n/**\n * Ensures the given file contents ends with a newline character.\n * @param contents - The file contents\n * @returns the file contents with a newline character.\n */\nexport const ensureEndsWithNewline = (\n  contents: string | null,\n): string | null => {\n  if (contents === null || contents === '') {\n    // Leave empty file as is\n    return contents\n  }\n  if (contents.endsWith('\\n')) {\n    return contents\n  }\n  return contents + '\\n'\n}\n\nexport const ensureDirectoryExists = (baseDir: string) => {\n  if (!fs.existsSync(baseDir)) {\n    fs.mkdirSync(baseDir, { recursive: true })\n  }\n}\n\n/**\n * Removes markdown code block syntax if present, including any language tag\n */\nexport const cleanMarkdownCodeBlock = (content: string): string => {\n  const cleanResponse = content.match(/^```(?:[a-zA-Z]+)?\\n([\\s\\S]*)\\n```$/)\n    ? content.replace(/^```(?:[a-zA-Z]+)?\\n/, '').replace(/\\n```$/, '')\n    : content\n  return cleanResponse\n}\n\nexport function isValidFilePath(path: string) {\n  if (!path) return false\n\n  // Check for whitespace\n  if (/\\s/.test(path)) return false\n\n  // Check for invalid characters\n  const invalidChars = /[<>:\"|?*\\x00-\\x1F]/g\n  if (invalidChars.test(path)) return false\n\n  return true\n}\n\nexport function isDir(p: string): boolean {\n  try {\n    return fs.statSync(p).isDirectory()\n  } catch {\n    return false\n  }\n}\n\n/**\n * Returns true if the `toPath` is a subdirectory of `fromPath`.\n */\nexport function isSubdir(fromPath: string, toPath: string) {\n  const resolvedFrom = path.resolve(fromPath)\n  const resolvedTo = path.resolve(toPath)\n\n  if (process.platform === 'win32') {\n    const fromDrive = path.parse(resolvedFrom).root.toLowerCase()\n    const toDrive = path.parse(resolvedTo).root.toLowerCase()\n    if (fromDrive !== toDrive) {\n      return false\n    }\n  }\n\n  return !path.relative(resolvedFrom, resolvedTo).startsWith('..')\n}\n\nexport function isValidProjectRoot(dir: string): boolean {\n  return !isSubdir(dir, os.homedir())\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/git.ts",
              "content": "import { execSync } from 'child_process'\nimport * as fs from 'fs'\nimport * as path from 'path'\n\nimport type { FileChanges } from '../actions'\n\nconst maxBuffer = 50 * 1024 * 1024 // 50 MB\n\nexport function hasStagedChanges(): boolean {\n  try {\n    execSync('git diff --staged --quiet', { stdio: 'ignore', maxBuffer })\n    return false\n  } catch {\n    return true\n  }\n}\n\nexport function getStagedChanges(): string {\n  try {\n    return execSync('git diff --staged', { maxBuffer }).toString()\n  } catch (error) {\n    return ''\n  }\n}\n\nexport function commitChanges(commitMessage: string) {\n  try {\n    execSync(`git commit -m \"${commitMessage}\"`, { stdio: 'ignore', maxBuffer })\n  } catch (error) {}\n}\n\nexport function stageAllChanges(): boolean {\n  try {\n    execSync('git add -A', { stdio: 'pipe', maxBuffer })\n    return hasStagedChanges()\n  } catch (error) {\n    return false\n  }\n}\n\nexport function stagePatches(dir: string, changes: FileChanges): boolean {\n  try {\n    const fileNames = changes.map((change) => change.path)\n    const existingFileNames = fileNames.filter((filePath) =>\n      fs.existsSync(path.join(dir, filePath)),\n    )\n\n    if (existingFileNames.length === 0) {\n      return false\n    }\n\n    execSync(`git add ${existingFileNames.join(' ')}`, { cwd: dir, maxBuffer })\n    return hasStagedChanges()\n  } catch (error) {\n    console.error('Error in stagePatches:', error)\n    return false\n  }\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/string.ts",
              "content": "import { sumBy } from 'lodash'\n\nexport const truncateString = (str: string, maxLength: number) => {\n  if (str.length <= maxLength) {\n    return str\n  }\n  return str.slice(0, maxLength) + '...'\n}\n\nexport const truncateStringWithMessage = ({\n  str,\n  maxLength,\n  message = 'TRUNCATED DUE TO LENGTH',\n  remove = 'END',\n}: {\n  str: string\n  maxLength: number\n  message?: string\n  remove?: 'END' | 'START' | 'MIDDLE'\n}) => {\n  if (str.length <= maxLength) {\n    return str\n  }\n\n  if (remove === 'END') {\n    const suffix = `\\n[${message}...]`\n    return str.slice(0, maxLength - suffix.length) + suffix\n  }\n  if (remove === 'START') {\n    const prefix = `[...${message}]\\n`\n    return prefix + str.slice(str.length - maxLength + prefix.length)\n  }\n\n  const middle = `\\n[...${message}...]\\n`\n  const length = Math.floor((maxLength - middle.length) / 2)\n  return str.slice(0, length) + middle + str.slice(-length)\n}\n\n/**\n * Check if a character is a whitespace character according\n * to the XML spec (space, carriage return, line feed or tab)\n *\n * @param character Character to check\n * @return Whether the character is whitespace or not\n */\nexport const isWhitespace = (character: string) => /\\s/.test(character)\n\nexport const replaceNonStandardPlaceholderComments = (\n  content: string,\n  replacement: string,\n): string => {\n  const commentPatterns = [\n    // JSX comments (match this first)\n    {\n      regex:\n        /{\\s*\\/\\*\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\s*\\.{3})?\\s*\\*\\/\\s*}/gi,\n      placeholder: replacement,\n    },\n    // C-style comments (C, C++, Java, JavaScript, TypeScript, etc.)\n    {\n      regex:\n        /\\/\\/\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\s*\\.{3})?/gi,\n      placeholder: replacement,\n    },\n    {\n      regex:\n        /\\/\\*\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\s*\\.{3})?\\s*\\*\\//gi,\n      placeholder: replacement,\n    },\n    // Python, Ruby, R comments\n    {\n      regex:\n        /#\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\s*\\.{3})?/gi,\n      placeholder: replacement,\n    },\n    // HTML-style comments\n    {\n      regex:\n        /<!--\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\s*\\.{3})?\\s*-->/gi,\n      placeholder: replacement,\n    },\n    // SQL, Haskell, Lua comments\n    {\n      regex:\n        /--\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\s*\\.{3})?/gi,\n      placeholder: replacement,\n    },\n    // MATLAB comments\n    {\n      regex:\n        /%\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\s*\\.{3})?/gi,\n      placeholder: replacement,\n    },\n  ]\n\n  let updatedContent = content\n\n  for (const { regex, placeholder } of commentPatterns) {\n    updatedContent = updatedContent.replaceAll(regex, placeholder)\n  }\n\n  return updatedContent\n}\n\nexport const randBoolFromStr = (str: string) => {\n  return sumBy(str.split(''), (char) => char.charCodeAt(0)) % 2 === 0\n}\n\nexport const pluralize = (count: number, word: string) => {\n  if (count === 1) return `${count} ${word}`\n\n  // Handle words ending in f/fe first (before other rules)\n  if (word.endsWith('f')) {\n    return `${count} ${word.slice(0, -1) + 'ves'}`\n  }\n  if (word.endsWith('fe')) {\n    return `${count} ${word.slice(0, -2) + 'ves'}`\n  }\n\n  // Handle words ending in 'y' (unless preceded by a vowel)\n  if (word.endsWith('y') && !word.match(/[aeiou]y$/)) {\n    return `${count} ${word.slice(0, -1) + 'ies'}`\n  }\n\n  // Handle words ending in s, sh, ch, x, z, o\n  if (word.match(/[sxz]$/) || word.match(/[cs]h$/) || word.match(/o$/)) {\n    return `${count} ${word + 'es'}`\n  }\n\n  return `${count} ${word + 's'}`\n}\n\n/**\n * Safely replaces all occurrences of a search string with a replacement string,\n * escaping special replacement patterns (like $) in the replacement string.\n */\nexport const capitalize = (str: string): string => {\n  if (!str) return str\n  return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase()\n}\n\n/**\n * Converts a snake_case string to Title Case\n * Example: \"add_subgoal\" -> \"Add Subgoal\"\n */\nexport const snakeToTitleCase = (str: string): string => {\n  return str\n    .split('_')\n    .map((word) => capitalize(word))\n    .join(' ')\n}\n\n/**\n * Ensures a URL has the appropriate protocol (http:// or https://)\n * Uses http:// for localhost and local IPs, https:// for all other domains\n */\nexport const ensureUrlProtocol = (url: string): string => {\n  if (\n    url.startsWith('http://') ||\n    url.startsWith('https://') ||\n    url.startsWith('file://')\n  ) {\n    return url\n  }\n\n  if (url.startsWith('localhost') || url.match(/^127\\.\\d+\\.\\d+\\.\\d+/)) {\n    return `http://${url}`\n  }\n\n  if (url.startsWith('/')) {\n    return `file://${url}`\n  }\n\n  return `https://${url}`\n}\n\nexport const safeReplace = (\n  content: string,\n  searchStr: string,\n  replaceStr: string,\n): string => {\n  const escapedReplaceStr = replaceStr.replace(/\\$/g, '$$$$')\n  return content.replace(searchStr, escapedReplaceStr)\n}\n\nexport const hasLazyEdit = (content: string) => {\n  const cleanedContent = content.toLowerCase().trim()\n  return (\n    cleanedContent.includes('... existing code ...') ||\n    cleanedContent.includes('// rest of the') ||\n    cleanedContent.includes('# rest of the') ||\n    // Match various comment styles with ellipsis and specific words\n    /\\/\\/\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\.{3})?/.test(\n      cleanedContent,\n    ) || // C-style single line\n    /\\/\\*\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\.{3})?\\s*\\*\\//.test(\n      cleanedContent,\n    ) || // C-style multi-line\n    /#\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\.{3})?/.test(\n      cleanedContent,\n    ) || // Python/Ruby style\n    /<!--\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\.{3})?\\s*-->/.test(\n      cleanedContent,\n    ) || // HTML style\n    /--\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\.{3})?/.test(\n      cleanedContent,\n    ) || // SQL/Haskell style\n    /%\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\.{3})?/.test(\n      cleanedContent,\n    ) || // MATLAB style\n    /{\\s*\\/\\*\\s*\\.{3}.*(?:rest|unchanged|keep|file|existing|some).*(?:\\.{3})?\\s*\\*\\/\\s*}/.test(\n      cleanedContent,\n    ) // JSX style\n  )\n}\n\n/**\n * Extracts a JSON field from a string, transforms it, and puts it back.\n * Handles both array and object JSON values.\n * @param content The string containing JSON-like content\n * @param field The field name to find and transform\n * @param transform Function to transform the parsed JSON value\n * @param fallback String to use if parsing fails\n * @returns The content string with the transformed JSON field\n */\nexport function transformJsonInString<T = unknown>(\n  content: string,\n  field: string,\n  transform: (json: T) => unknown,\n  fallback: string,\n): string {\n  // Use a non-greedy match for objects/arrays to prevent over-matching\n  const pattern = new RegExp(`\"${field}\"\\\\s*:\\\\s*(\\\\{[^}]*?\\\\}|\\\\[[^\\\\]]*?\\\\])`)\n  const match = content.match(pattern)\n\n  if (!match) {\n    return content\n  }\n\n  try {\n    const json = JSON.parse(match[1])\n    const transformed = transform(json)\n\n    // Important: Only replace the exact matched portion to prevent duplicates\n    return content.replace(\n      match[0],\n      `\"${field}\":${JSON.stringify(transformed)}`,\n    )\n  } catch (error) {\n    // Only replace the exact matched portion even in error case\n    return content.replace(match[0], `\"${field}\":${fallback}`)\n  }\n}\n\n/**\n * Generates a compact unique identifier by combining timestamp bits with random bits.\n * Uses 40 bits of timestamp (enough for ~34 years) and 24 random bits for exactly 64 total bits.\n * Encodes in base64url for compact, URL-safe strings (~11 chars).\n * @param prefix Optional prefix to add to the ID\n * @returns A unique string ID\n * @example\n * generateCompactId()      // => \"1a2b3c4d5e6\"\n * generateCompactId('msg-') // => \"msg-1a2b3c4d5e6\"\n */\nexport const generateCompactId = (prefix?: string): string => {\n  // Get the last 32 bits of the timestamp\n  const timestamp = (Date.now() & 0xffffffff) >>> 0\n  // Generate a 32-bit random number\n  const random = Math.floor(Math.random() * 0x100000000) >>> 0\n\n  // Combine them into a 64-bit representation as two 32-bit numbers\n  const high = timestamp\n  const low = random\n\n  // Convert to a hex string, pad if necessary, and combine\n  const highHex = high.toString(16).padStart(8, '0')\n  const lowHex = low.toString(16).padStart(8, '0')\n\n  const combinedHex = highHex + lowHex\n\n  // Convert hex to a Buffer and then to base64url\n  const bytes = Buffer.from(combinedHex, 'hex')\n  const str = bytes.toString('base64url').replace(/=/g, '')\n\n  return prefix ? `${prefix}${str}` : str\n}\n\n/**\n * Removes null characters from a string\n */\nexport const stripNullChars = (str: string): string => {\n  return str.replace(/\\u0000/g, '')\n}\n\nconst ansiColorsRegex = /\\x1B\\[[0-9;]*m/g\nexport function stripColors(str: string): string {\n  return str.replace(ansiColorsRegex, '')\n}\n\nconst ansiRegex = /\\x1B(?:[@-Z\\\\-_]|\\[[0-?]*[ -/]*[@-~]|\\][^\\x1B]*\\x1B\\\\?)/g\nexport function stripAnsi(str: string): string {\n  return str.replace(ansiRegex, '')\n}\n\nexport function includesMatch(\n  array: (string | RegExp)[],\n  value: string,\n): boolean {\n  return array.some((p) => {\n    if (typeof p === 'string') {\n      return p === value\n    }\n    return p.test(value)\n  })\n}\n\n/**\n * Finds the longest substring that is **both** a suffix of `source`\n * **and** a prefix of `next`.\n * Useful when concatenating strings while avoiding duplicate overlap.\n *\n * @example\n * ```ts\n * suffixPrefixOverlap('foobar', 'barbaz'); //  'bar'\n * suffixPrefixOverlap('abc', 'def');       //  ''\n * ```\n *\n * @param source  The string whose **suffix** is inspected.\n * @param next    The string whose **prefix** is inspected.\n * @returns       The longest overlapping edge, or an empty string if none exists.\n */\nexport function suffixPrefixOverlap(source: string, next: string): string {\n  for (let len = next.length; len >= 0; len--) {\n    const prefix = next.slice(0, len)\n    if (source.endsWith(prefix)) {\n      return prefix\n    }\n  }\n\n  return ''\n}\n\nexport const escapeString = (str: string) => {\n  return JSON.stringify(str).slice(1, -1)\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/logger.ts",
              "content": "import path from 'path'\n\nimport { env } from '@levelcode/internal'\nimport pino from 'pino'\n\nimport type { AsyncLocalStorage as NodeAsyncLocalStorage } from 'async_hooks'\n\nlet AsyncLocalStorageImpl: typeof import('async_hooks').AsyncLocalStorage | null\ntry {\n  // Load AsyncLocalStorage via require\n  AsyncLocalStorageImpl = require('async_hooks').AsyncLocalStorage\n} catch {\n  AsyncLocalStorageImpl = null\n}\n\n// Create a noop shim when AsyncLocalStorage isn't present\nconst loggerAsyncStorage =\n  AsyncLocalStorageImpl !== null\n    ? new AsyncLocalStorageImpl<LoggerContext>()\n    : {\n        // run() just executes fn without context tracking\n        run: <R, A extends any[]>(_: any, fn: (...args: A) => R, ...args: A) =>\n          fn(...args),\n        getStore: () => undefined,\n      }\n\nexport interface LoggerContext {\n  userId?: string\n  userEmail?: string\n  clientSessionId?: string\n  [key: string]: any // Allow for future extensions\n}\n\nexport const withLoggerContext = <T>(\n  additionalContext: Partial<LoggerContext>,\n  fn: () => Promise<T>,\n) => {\n  const store = (loggerAsyncStorage.getStore?.() ?? {}) as LoggerContext\n  // Cast to Node's AsyncLocalStorage to resolve overload mismatch\n  return (loggerAsyncStorage as NodeAsyncLocalStorage<LoggerContext>).run(\n    { ...store, ...additionalContext },\n    fn,\n  )\n}\n\n// Only use file transport when not running in Edge/browserlike env\nconst runningInEdge = process.env.NEXT_RUNTIME === 'edge'\nconst fileTransport =\n  !runningInEdge && env.NEXT_PUBLIC_CB_ENVIRONMENT !== 'prod'\n    ? pino.transport({\n        target: 'pino/file',\n        options: { destination: path.join(__dirname, '..', 'debug.log') },\n        level: 'debug',\n      })\n    : undefined\n\nexport const logger = pino(\n  {\n    level: 'debug',\n    mixin() {\n      // If AsyncLocalStorage isn't available, return undefined\n      return { logTrace: loggerAsyncStorage.getStore?.() }\n    },\n    formatters: {\n      level: (label) => ({ level: label.toUpperCase() }),\n    },\n    timestamp: () => `,\"timestamp\":\"${new Date().toISOString()}\"`,\n  },\n  fileTransport,\n)\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/messages.ts",
              "content": "import type { LevelCodeMessage, Message } from '../types/message'\nimport type { CoreMessage } from 'ai'\n\ninterface ScreenshotRef {\n  msgIdx: number\n  contentIdx: number\n}\n\n/**\n * Limits the total number of screenshots across all messages to maxCount,\n * keeping only the most recent ones.\n */\nexport function limitScreenshots(\n  messages: Message[],\n  maxCount: number,\n): Message[] {\n  const screenshots = messages.flatMap((msg, msgIdx) =>\n    Array.isArray(msg.content)\n      ? msg.content\n          .map((item, contentIdx) =>\n            item.type === 'image' ? { msgIdx, contentIdx } : null,\n          )\n          .filter((ref): ref is ScreenshotRef => ref !== null)\n      : [],\n  )\n\n  if (screenshots.length <= maxCount) return messages\n\n  const keepRefs = new Set(\n    screenshots\n      .slice(-maxCount)\n      .map((ref) => `${ref.msgIdx}-${ref.contentIdx}`),\n  )\n\n  return messages.map((msg, msgIdx) =>\n    Array.isArray(msg.content)\n      ? {\n          ...msg,\n          content: msg.content.filter(\n            (item, contentIdx) =>\n              item.type !== 'image' || keepRefs.has(`${msgIdx}-${contentIdx}`),\n          ),\n        }\n      : msg,\n  )\n}\n\nexport function toContentString(msg: CoreMessage): string {\n  const { content } = msg\n  if (typeof content === 'string') return content\n  return content.map((item) => (item as any)?.text ?? '').join('\\n')\n}\n\nexport function withCacheControlCore(msg: LevelCodeMessage): LevelCodeMessage {\n  const message = { ...msg }\n  if (!message.providerOptions) {\n    message.providerOptions = {}\n  }\n  if (!message.providerOptions.anthropic) {\n    message.providerOptions.anthropic = {}\n  }\n  message.providerOptions.anthropic.cacheControl = { type: 'ephemeral' }\n  if (!message.providerOptions.openrouter) {\n    message.providerOptions.openrouter = {}\n  }\n  message.providerOptions.openrouter.cacheControl = { type: 'ephemeral' }\n  return message\n}\n\nexport function withCacheControl(msg: Message): Message {\n  if (typeof msg.content === 'string') {\n    return {\n      ...msg,\n      content: [\n        {\n          type: 'text',\n          text: msg.content,\n          cache_control: { type: 'ephemeral' as const },\n        },\n      ],\n    }\n  } else {\n    return {\n      ...msg,\n      content: msg.content.map((item, i) =>\n        i === msg.content.length - 1\n          ? { ...item, cache_control: { type: 'ephemeral' as const } }\n          : item,\n      ),\n    }\n  }\n}\n\nexport function removeCache(messages: Message[]): Message[] {\n  return messages.map((msg) => {\n    if (typeof msg.content === 'object' && Array.isArray(msg.content)) {\n      return {\n        ...msg,\n        content: msg.content.map((item) => {\n          const { cache_control, ...rest } = item\n          return rest\n        }),\n      }\n    }\n    return msg\n  })\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/object.ts",
              "content": "import { isEqual, mapValues, union } from 'lodash'\n\nexport const removeUndefinedProps = <T extends object>(obj: T): T => {\n  const newObj: any = {}\n\n  for (const key of Object.keys(obj)) {\n    if ((obj as any)[key] !== undefined) newObj[key] = (obj as any)[key]\n  }\n\n  return newObj\n}\n\nexport const removeNullOrUndefinedProps = <T extends object>(\n  obj: T,\n  exceptions?: string[],\n): T => {\n  const newObj: any = {}\n\n  for (const key of Object.keys(obj)) {\n    if (\n      ((obj as any)[key] !== undefined && (obj as any)[key] !== null) ||\n      (exceptions ?? []).includes(key)\n    )\n      newObj[key] = (obj as any)[key]\n  }\n  return newObj\n}\n\nexport const addObjects = <T extends { [key: string]: number }>(\n  obj1: T,\n  obj2: T,\n) => {\n  const keys = union(Object.keys(obj1), Object.keys(obj2))\n  const newObj = {} as any\n\n  for (const key of keys) {\n    newObj[key] = (obj1[key] ?? 0) + (obj2[key] ?? 0)\n  }\n\n  return newObj as T\n}\n\nexport const subtractObjects = <T extends { [key: string]: number }>(\n  obj1: T,\n  obj2: T,\n) => {\n  const keys = union(Object.keys(obj1), Object.keys(obj2))\n  const newObj = {} as any\n\n  for (const key of keys) {\n    newObj[key] = (obj1[key] ?? 0) - (obj2[key] ?? 0)\n  }\n\n  return newObj as T\n}\n\nexport const hasChanges = <T extends object>(obj: T, partial: Partial<T>) => {\n  const currValues = mapValues(partial, (_, key: keyof T) => obj[key])\n  return !isEqual(currValues, partial)\n}\n\nexport const hasSignificantDeepChanges = <T extends object>(\n  obj: T,\n  partial: Partial<T>,\n  epsilonForNumbers: number,\n): boolean => {\n  const compareValues = (currValue: any, partialValue: any): boolean => {\n    if (typeof currValue === 'number' && typeof partialValue === 'number') {\n      return Math.abs(currValue - partialValue) > epsilonForNumbers\n    }\n    if (typeof currValue === 'object' && typeof partialValue === 'object') {\n      return hasSignificantDeepChanges(\n        currValue,\n        partialValue,\n        epsilonForNumbers,\n      )\n    }\n    return !isEqual(currValue, partialValue)\n  }\n\n  for (const key in partial) {\n    if (Object.prototype.hasOwnProperty.call(partial, key)) {\n      if (compareValues(obj[key], partial[key])) {\n        return true\n      }\n    }\n  }\n\n  return false\n}\n\nexport const filterObject = <T extends object>(\n  obj: T,\n  predicate: (value: any, key: keyof T) => boolean,\n): { [P in keyof T]: T[P] } => {\n  const result = {} as { [P in keyof T]: T[P] }\n  for (const key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      if (predicate(obj[key], key)) {\n        result[key] = obj[key]\n      }\n    }\n  }\n  return result\n}\n\n/**\n * Asserts that a condition is true. If the condition is false, it throws an error with the provided message.\n * @param condition The condition to check\n * @param message The error message to display if the condition is false\n * @throws {Error} If the condition is false\n */\nexport function assert(condition: boolean, message: string): asserts condition {\n  if (!condition) {\n    throw new Error(`Assertion failed: ${message}`)\n  }\n}\n\nexport function errorToObject(value: any) {\n  if (value instanceof Error) {\n    // Copy *all* own props, including non-enumerables\n    return Object.getOwnPropertyNames(value).reduce<Record<string, unknown>>(\n      (acc, key) => {\n        acc[key] = (value as any)[key]\n        return acc\n      },\n      {},\n    )\n  }\n  return value\n}\n",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/error.ts",
              "content": "export function getErrorObject(error: any) {\n  return {\n    message: error.message,\n    stack: error.stack,\n    name: error.name,\n  }\n}",
              "referencedBy": {}
            },
            {
              "path": "common/src/util/__tests__/string.test.ts",
              "content": "import { describe, expect, it } from 'bun:test'\n\nimport { EXISTING_CODE_MARKER } from '../../constants'\nimport { pluralize, replaceNonStandardPlaceholderComments } from '../string'\n\ndescribe('pluralize', () => {\n  it('should handle singular and plural cases correctly', () => {\n    expect(pluralize(1, 'test')).toBe('1 test')\n    expect(pluralize(0, 'test')).toBe('0 tests')\n    expect(pluralize(2, 'test')).toBe('2 tests')\n  })\n\n  it('should handle words ending in y', () => {\n    expect(pluralize(1, 'city')).toBe('1 city')\n    expect(pluralize(2, 'city')).toBe('2 cities')\n    expect(pluralize(3, 'repository')).toBe('3 repositories')\n  })\n\n  it('should handle words ending in f/fe', () => {\n    expect(pluralize(1, 'leaf')).toBe('1 leaf')\n    expect(pluralize(2, 'leaf')).toBe('2 leaves')\n    expect(pluralize(1, 'knife')).toBe('1 knife')\n    expect(pluralize(2, 'knife')).toBe('2 knives')\n    expect(pluralize(1, 'life')).toBe('1 life')\n    expect(pluralize(3, 'life')).toBe('3 lives')\n  })\n\n  it('should handle words ending in s, sh, ch, x, z, o', () => {\n    expect(pluralize(2, 'bus')).toBe('2 buses')\n    expect(pluralize(2, 'box')).toBe('2 boxes')\n    expect(pluralize(2, 'church')).toBe('2 churches')\n    expect(pluralize(2, 'dish')).toBe('2 dishes')\n  })\n\n  it('should handle regular plurals', () => {\n    expect(pluralize(1, 'agent')).toBe('1 agent')\n    expect(pluralize(0, 'agent')).toBe('0 agents')\n    expect(pluralize(5, 'member')).toBe('5 members')\n    expect(pluralize(10, 'invitation')).toBe('10 invitations')\n  })\n})\n\ndescribe('replaceNonStandardPlaceholderComments', () => {\n  it('should replace C-style comments', () => {\n    const input = `\nfunction example() {\n  // ... some code ...\n  console.log('Hello');\n  // ... rest of the function ...\n}\n`\n    const expected = `\nfunction example() {\n  ${EXISTING_CODE_MARKER}\n  console.log('Hello');\n  ${EXISTING_CODE_MARKER}\n}\n`\n    expect(\n      replaceNonStandardPlaceholderComments(input, EXISTING_CODE_MARKER),\n    ).toBe(expected)\n  })\n\n  it('should replace multi-line C-style comments', () => {\n    const input = `\nfunction example() {\n  /* ... some code ... */\n  console.log('Hello');\n  /* ... rest of the function ... */\n}\n`\n    const expected = `\nfunction example() {\n  ${EXISTING_CODE_MARKER}\n  console.log('Hello');\n  ${EXISTING_CODE_MARKER}\n}\n`\n    expect(\n      replaceNonStandardPlaceholderComments(input, EXISTING_CODE_MARKER),\n    ).toBe(expected)\n  })\n\n  it('should replace Python-style comments', () => {\n    const input = `\ndef example():\n    # ... some code ...\n    print('Hello')\n    # ... rest of the function ...\n`\n    const expected = `\ndef example():\n    ${EXISTING_CODE_MARKER}\n    print('Hello')\n    ${EXISTING_CODE_MARKER}\n`\n    expect(\n      replaceNonStandardPlaceholderComments(input, EXISTING_CODE_MARKER),\n    ).toBe(expected)\n  })\n\n  it('should replace JSX comments', () => {\n    const input = `\nfunction Example() {\n  return (\n    <div>\n      {/* ... existing code ... */}\n      <p>Hello, World!</p>\n      {/* ...rest of component... */}\n    </div>\n  );\n}\n`\n    const expected = `\nfunction Example() {\n  return (\n    <div>\n      ${EXISTING_CODE_MARKER}\n      <p>Hello, World!</p>\n      ${EXISTING_CODE_MARKER}\n    </div>\n  );\n}\n`\n    expect(\n      replaceNonStandardPlaceholderComments(input, EXISTING_CODE_MARKER),\n    ).toBe(expected)\n  })\n})\n",
              "referencedBy": {}
            }
          ]
        }
      ],
      "parentAgentId": "D-gXwryrlBs"
    },
    {
      "type": "text",
      "agentId": "D-gXwryrlBs",
      "text": "Here's a brief summary of potentially useful files:\n\n*   `common/src/util/examples/diff-reviewer-*.ts`: Example agent definitions for reviewing code diffs. Useful for understanding how to define agents that interact with `git diff` and the file system.\n*   `common/src/util/changes.ts`: Functions for applying file changes (creations, modifications) to the file system, including applying patches.\n*   `common/src/util/file.ts`: Functions for interacting with the file system, such as creating file trees, parsing file blocks, and validating file paths.\n*   `common/src/util/git.ts`: Functions for executing Git commands, such as staging changes and committing.\n*   `common/src/util/string.ts`: String manipulation functions.\n*   `common/src/util/logger.ts`: Logging utilities with context.\n*   `common/src/util/messages.ts`: Utilities for working with messages.\n*   `common/src/util/object.ts`: Utilities for manipulating objects, e.g. removing undefined properties, comparing objects, adding objects, asserting conditions.\n\nThe files in `common/src/util/examples` provide concrete examples, while the other files offer utility functions that could be useful when working with files and Git.\n"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-gXwryrlBs",
      "agentType": "file-picker",
      "displayName": "Fletcher the File Fetcher",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "common/src/util/examples directory contents and related files"
    },
    {
      "type": "tool_call",
      "toolCallId": "D-nFpuBEiW4",
      "toolName": "str_replace",
      "input": {
        "path": "backend/src/templates/agents/agent-builder.ts",
        "replacements": [
          {
            "old": "    spawnableAgents: allAvailableAgents\n      ? (allAvailableAgents as any[])\n      : [\n          AgentTemplateTypes.file_picker,\n          AgentTemplateTypes.researcher,\n          AgentTemplateTypes.thinker,\n          AgentTemplateTypes.reviewer,\n          AgentTemplateTypes.agent_builder,\n        ],\n",
            "new": "",
            "allowMultiple": false
          }
        ]
      },
      "agentId": "D-gXwZERcWA",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "D-nFpuBEiW4",
      "toolName": "str_replace",
      "output": [
        {
          "type": "json",
          "value": {
            "file": "backend/src/templates/agents/agent-builder.ts",
            "message": "Updated file",
            "unifiedDiff": "@@ -126,17 +126,8 @@\n       'add_message',\n       'set_output',\n       'end_turn',\n     ] satisfies ToolName[],\n-    spawnableAgents: allAvailableAgents\n-      ? (allAvailableAgents as any[])\n-      : [\n-          AgentTemplateTypes.file_picker,\n-          AgentTemplateTypes.researcher,\n-          AgentTemplateTypes.thinker,\n-          AgentTemplateTypes.reviewer,\n-          AgentTemplateTypes.agent_builder,\n-        ],\n \n     systemPrompt: [\n       '# Bob the Agent Builder',\n       '',\n"
          }
        }
      ],
      "parentAgentId": "D-gXwZERcWA"
    },
    {
      "type": "tool_call",
      "toolCallId": "683b9ed2-e716-4808-949e-46be1b0d5c8b",
      "toolName": "set_output",
      "input": {
        "output": {
          "message": "",
          "toolResults": [
            {
              "file": "backend/src/templates/agents/agent-builder.ts",
              "message": "Updated file",
              "unifiedDiff": "@@ -126,17 +126,8 @@\n       'add_message',\n       'set_output',\n       'end_turn',\n     ] satisfies ToolName[],\n-    spawnableAgents: allAvailableAgents\n-      ? (allAvailableAgents as any[])\n-      : [\n-          AgentTemplateTypes.file_picker,\n-          AgentTemplateTypes.researcher,\n-          AgentTemplateTypes.thinker,\n-          AgentTemplateTypes.reviewer,\n-          AgentTemplateTypes.agent_builder,\n-        ],\n \n     systemPrompt: [\n       '# Bob the Agent Builder',\n       '',\n"
            }
          ]
        }
      },
      "agentId": "D-gXwZERcWA",
      "parentAgentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "683b9ed2-e716-4808-949e-46be1b0d5c8b",
      "toolName": "set_output",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Output set"
          }
        }
      ],
      "parentAgentId": "D-gXwZERcWA"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-gXwZERcWA",
      "agentType": "editor-gpt-5",
      "displayName": "Code Editor",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": ""
    },
    {
      "type": "tool_result",
      "toolCallId": "D-gXircIAUI",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Code Editor",
              "agentType": "editor-gpt-5",
              "value": {
                "type": "structuredOutput",
                "value": {
                  "output": {
                    "message": "",
                    "toolResults": [
                      {
                        "file": "backend/src/templates/agents/agent-builder.ts",
                        "message": "Updated file",
                        "unifiedDiff": "@@ -126,17 +126,8 @@\n       'add_message',\n       'set_output',\n       'end_turn',\n     ] satisfies ToolName[],\n-    spawnableAgents: allAvailableAgents\n-      ? (allAvailableAgents as any[])\n-      : [\n-          AgentTemplateTypes.file_picker,\n-          AgentTemplateTypes.researcher,\n-          AgentTemplateTypes.thinker,\n-          AgentTemplateTypes.reviewer,\n-          AgentTemplateTypes.agent_builder,\n-        ],\n \n     systemPrompt: [\n       '# Bob the Agent Builder',\n       '',\n"
                      }
                    ]
                  }
                }
              }
            },
            {
              "agentName": "Code Searcher",
              "agentType": "code-searcher",
              "value": {
                "type": "structuredOutput",
                "value": {
                  "results": [
                    {
                      "stdout": "No results",
                      "message": "Exit code: 1"
                    },
                    {
                      "stdout": "No results",
                      "message": "Exit code: 1"
                    }
                  ]
                }
              }
            },
            {
              "agentName": "Fletcher the File Fetcher",
              "agentType": "file-picker",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "Here's a brief summary of potentially useful files:\n\n*   `common/src/util/examples/diff-reviewer-*.ts`: Example agent definitions for reviewing code diffs. Useful for understanding how to define agents that interact with `git diff` and the file system.\n*   `common/src/util/changes.ts`: Functions for applying file changes (creations, modifications) to the file system, including applying patches.\n*   `common/src/util/file.ts`: Functions for interacting with the file system, such as creating file trees, parsing file blocks, and validating file paths.\n*   `common/src/util/git.ts`: Functions for executing Git commands, such as staging changes and committing.\n*   `common/src/util/string.ts`: String manipulation functions.\n*   `common/src/util/logger.ts`: Logging utilities with context.\n*   `common/src/util/messages.ts`: Utilities for working with messages.\n*   `common/src/util/object.ts`: Utilities for manipulating objects, e.g. removing undefined properties, comparing objects, adding objects, asserting conditions.\n\nThe files in `common/src/util/examples` provide concrete examples, while the other files offer utility functions that could be useful when working with files and Git.\n"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "agentName": "Commander Lite",
              "agentType": "commander-lite",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "### Root `package.json`\n- **format**: `\"prettier --write \\\"**/*.{ts,tsx,json,md}\\\"\"`\n- **typecheck**: `\"bun --filter='*' run typecheck && echo ' All type checks passed!'\"`\n- **test**: `\"bun --filter='{@levelcode/backend,@levelcode/common,@levelcode/npm-app}' run test\"`\n- No `lint` script.\n\n### `scripts/package.json`\n- **typecheck**: `\"tsc --noEmit -p .\"`\n- **test**: `\"bun test\"`\n- No `lint` or `format` scripts.\n\n### `backend/package.json`\n- **typecheck**: `\"tsc --noEmit -p .\"`\n- **test**: `\"bun test\"`\n- No `lint` or `format` scripts.\n\n### `common/package.json`\n- **typecheck**: `\"tsc --noEmit -p .\"`\n- **test**: `\"bun test\"`\n- No `lint` or `format` scripts."
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "c0b8970e-2255-4ee7-8066-89f0c00d5803",
      "toolName": "spawn_agent_inline",
      "input": {
        "agent_type": "context-pruner",
        "params": {}
      },
      "agentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "c0b8970e-2255-4ee7-8066-89f0c00d5803",
      "toolName": "spawn_agent_inline",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Agent spawned."
          }
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "D-oWnvQd5aA",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "editor-gpt-5"
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "D-oYtCzzjlw",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "commander-lite",
            "prompt": "Run root typecheck to validate TypeScript changes.",
            "params": {
              "command": "bun run typecheck",
              "timeout_seconds": 120
            }
          },
          {
            "agent_type": "commander-lite",
            "prompt": "Run relevant package tests if any affected.",
            "params": {
              "command": "bun run test",
              "timeout_seconds": 120
            }
          },
          {
            "agent_type": "commander-lite",
            "prompt": "Check if any formatting issues.",
            "params": {
              "command": "bun run format --check",
              "timeout_seconds": 60
            }
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-oY2QIts4E",
      "agentType": "editor-gpt-5",
      "displayName": "Code Editor",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": ""
    },
    {
      "type": "text",
      "agentId": "D-oY2QIts4E",
      "text": "<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"backend/src/templates/agents/agent-builder.ts\",\n  \"instructions\": \"Update agent builder to gather diff-reviewer examples plus a new starter template, keep examples under .agents/examples, copy starter into .agents root, and stop advertising spawnable agents.\",\n  \"content\": \"import * as fs from 'fs'\\nimport * as path from 'path'\\n\\nimport { AGENT_TEMPLATES_DIR, AGENT_DEFINITION_FILE } from '@levelcode/common/constants'\\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\\nimport z from 'zod/v4'\\n\\nimport type { AgentTemplate } from '../types'\\nimport type { Model } from '@levelcode/common/constants'\\nimport type { ToolName } from '@levelcode/common/tools/constants'\\n\\nconst COMMON_UTIL_PATH = '../../../../common/src/util'\\nconst TEMPLATE_RELATIVE_PATH =\\n  `${COMMON_UTIL_PATH}/types/${AGENT_DEFINITION_FILE}` as const\\n// Import to validate path exists at compile time\\nimport(TEMPLATE_RELATIVE_PATH)\\n\\nconst TEMPLATE_PATH = path.join(__dirname, TEMPLATE_RELATIVE_PATH)\\nconst TYPES_DIR = path.join(AGENT_TEMPLATES_DIR, 'types')\\nconst EXAMPLES_DIR = path.join(AGENT_TEMPLATES_DIR, 'examples')\\nconst TEMPLATE_TYPES_PATH = path.join(TYPES_DIR, AGENT_DEFINITION_FILE)\\nconst TOOL_DEFINITIONS_FILE = 'tools.d.ts'\\nconst TOOL_DEFINITIONS_PATH = path.join(TYPES_DIR, TOOL_DEFINITIONS_FILE)\\n\\nconst EXAMPLES_SOURCE_DIR = path.join(__dirname, `${COMMON_UTIL_PATH}/examples`)\\nconst STARTER_TEMPLATE_SOURCE_FILE = 'your-custom-agent.ts.txt'\\nconst STARTER_TEMPLATE_DEST_FILE = 'your-custom-agent.ts'\\n\\nexport const agentBuilder = (\\n  model: Model,\\n  _allAvailableAgents?: string[],\\n): Omit<AgentTemplate, 'id'> => {\\n  // Read the AGENT_CONFIG_FILE content dynamically\\n  // The import above ensures this path exists at compile time\\n  let agentTemplateContent = ''\\n  try {\\n    agentTemplateContent = fs.readFileSync(TEMPLATE_PATH, 'utf8')\\n  } catch (error) {\\n    console.warn(`Could not read ${AGENT_DEFINITION_FILE}:`, error)\\n    agentTemplateContent = '// Agent template types not available'\\n  }\\n\\n  // Read the tools.d.ts content from common package\\n  let toolDefinitionsContent = ''\\n  try {\\n    const toolsPath = path.join(\\n      __dirname,\\n      `${COMMON_UTIL_PATH}/types/tools.d.ts`,\\n    )\\n    toolDefinitionsContent = fs.readFileSync(toolsPath, 'utf8')\\n  } catch (error) {\\n    console.warn(`Could not read tools.d.ts from common:`, error)\\n    toolDefinitionsContent = '// Tool definitions not available'\\n  }\\n\\n  // Read example agent files + starter template from common package\\n  const exampleAgentContents: Record<string, string> = {}\\n  let starterTemplateContent = ''\\n\\n  try {\\n    if (fs.existsSync(EXAMPLES_SOURCE_DIR)) {\\n      const files = fs.readdirSync(EXAMPLES_SOURCE_DIR)\\n\\n      files\\n        .filter(\\n          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer-'),\\n        )\\n        .forEach((filename) => {\\n          const fullPath = path.join(EXAMPLES_SOURCE_DIR, filename)\\n          const content = fs.readFileSync(fullPath, 'utf8')\\n          exampleAgentContents[filename] = content\\n        })\\n\\n      const starterTemplatePath = path.join(\\n        EXAMPLES_SOURCE_DIR,\\n        STARTER_TEMPLATE_SOURCE_FILE,\\n      )\\n      if (fs.existsSync(starterTemplatePath)) {\\n        starterTemplateContent = fs.readFileSync(starterTemplatePath, 'utf8')\\n      }\\n    } else {\\n      console.warn(\\n        `Example agents directory does not exist: ${EXAMPLES_SOURCE_DIR}`,\\n      )\\n    }\\n  } catch (error) {\\n    console.warn('Could not read example agents:', error)\\n  }\\n\\n  return {\\n    model,\\n    displayName: 'Bob the Agent Builder',\\n    spawnPurposePrompt:\\n      'Enhanced base agent that can create custom agents and handle all coding tasks with deterministic agent creation behavior',\\n    inputSchema: {\\n      prompt: z\\n        .string()\\n        .optional()\\n        .describe(\\n          'What agent type you would like to create or edit. Include as many details as possible.',\\n        ),\\n      params: z\\n        .object({\\n          name: z.string().optional(),\\n          purpose: z.string().optional(),\\n          specialty: z.string().optional(),\\n          model: z.string().optional(),\\n        })\\n        .passthrough()\\n        .optional(),\\n    },\\n    outputMode: 'structured_output',\\n    includeMessageHistory: false,\\n    toolNames: [\\n      'write_file',\\n      'str_replace',\\n      'run_terminal_command',\\n      'read_files',\\n      'code_search',\\n      'spawn_agents',\\n      'add_message',\\n      'set_output',\\n      'end_turn',\\n    ] satisfies ToolName[],\\n\\n    systemPrompt: [\\n      '# Bob the Agent Builder',\\n      '',\\n      'You are an expert agent builder specialized in creating new agent templates for the levelcode system. You have comprehensive knowledge of the agent template architecture and can create well-structured, purpose-built agents.',\\n      '',\\n      '## Environment Setup Complete',\\n      '',\\n      'Your environment has been automatically prepared with:',\\n      '- Agent template type definitions in `.agents/types/agent-definition.d.ts`',\\n      '- Tool type definitions in `.agents/types/tools.d.ts`',\\n      '- Diff-reviewer examples in `.agents/examples/` for reference',\\n      '- A starter custom agent template at `.agents/your-custom-agent.ts`',\\n      '',\\n      'All necessary files are now available in your working directory.',\\n      '',\\n      '## Complete Agent Template Type Definitions',\\n      '',\\n      'Here are the complete TypeScript type definitions for creating custom LevelCode agents:',\\n      '```typescript',\\n      agentTemplateContent,\\n      '```',\\n      '',\\n      '## Available Tools Type Definitions',\\n      '',\\n      'Here are the complete TypeScript type definitions for all available tools:',\\n      '',\\n      '```typescript',\\n      toolDefinitionsContent,\\n      '```',\\n      '',\\n      '## Agent Template Patterns:',\\n      '',\\n      '1. **Base Agent Pattern**: Full-featured agents with comprehensive tool access',\\n      '2. **Specialized Agent Pattern**: Focused agents with limited tool sets',\\n      '3. **Thinking Agent Pattern**: Agents that spawn thinker sub-agents',\\n      '4. **Research Agent Pattern**: Agents that start with web search',\\n      '',\\n      '## Best Practices:',\\n      '',\\n      '1. **Use as few fields as possible**: Leave out fields that are not needed to reduce complexity',\\n      '2. **Minimal Tools**: Only include tools the agent actually needs',\\n      '3. **Clear and Concise Prompts**: Write clear, specific prompts that have no unnecessary words',\\n      '4. **Consistent Naming**: Follow naming conventions (kebab-case for IDs)',\\n      '5. **Appropriate Model**: Choose the right model for the task complexity. Default is claude-4-sonnet-20250522 for medium-high complexity tasks, and openai/gpt-5 for all other tasks.',\\n      '',\\n      '## Your Task:',\\n      'When asked to create an agent template, you should:',\\n      \\\"1. Understand the requested agent's purpose and capabilities\\\",\\n      \\\"2. Choose appropriate tools for the agent's function\\\",\\n      '3. Write a comprehensive system prompt',\\n      `4. Create the complete agent template file in ${AGENT_TEMPLATES_DIR}`,\\n      '5. Ensure the template follows all conventions and best practices',\\n      '6. Use the AgentDefinition interface for the configuration',\\n      '7. Start the file with: import type { AgentDefinition } from \\\"./types/agent-definition.d.ts\\\"',\\n      '',\\n      'Create agent templates that are focused, efficient, and well-documented. Always import the AgentDefinition type and export a default configuration object.',\\n    ].join('\\\\n'),\\n    instructionsPrompt: `You are helping to create or edit an agent template. The user will describe what kind of agent they want to create or how they want to modify an existing agent.\\n\\n## Environment Ready\\n\\nYour environment has been automatically set up with:\\n- Type definitions in \\\\`.agents/types/\\\\`\\n- Diff-reviewer examples in \\\\`.agents/examples/\\\\`\\n- A starter custom agent template at \\\\`.agents/your-custom-agent.ts\\\\`\\n\\nYou can now proceed directly to agent creation or editing.\\n\\n## Example Agents Available\\n\\nThree diff-reviewer examples are available in \\\\`.agents/examples/\\\\`. These can serve as examples of well-made agents at different stages of complexity.\\n\\n**IMPORTANT**: Examine these examples to find connections and patterns that relate to the user's request. Look for:\\n- Similar tool combinations\\n- Comparable complexity levels\\n- Related functionality patterns\\n- Appropriate model choices\\n- Relevant prompt structures\\n\\nUse these examples as inspiration and starting points, adapting their patterns to fit the user's specific needs.\\n\\n## Starter Template Available\\n\\nA starter custom agent file is available at \\\\`.agents/your-custom-agent.ts\\\\`. You can either modify this file directly or use it as a reference for creating a new agent.\\n\\n## For New Agents\\n\\nAnalyze their request and create a complete agent template that:\\n- Has a clear purpose and appropriate capabilities\\n- Leaves out fields that are not needed\\n- Uses only the tools it needs\\n- Follows naming conventions\\n- Is properly structured\\n- Draws inspiration from relevant example agents\\n\\n## For Creating New Agents\\n\\nThe agent builder is focused on creating new agent templates based on user specifications.\\n\\nIMPORTANT: Always end your response with the end_turn tool when you have completed the agent creation or editing task.`,\\n    stepPrompt: '',\\n\\n    handleSteps: function* () {\\n      // Step 1: Create directory structure\\n      yield {\\n        toolName: 'run_terminal_command',\\n        args: {\\n          command: `mkdir -p ${TYPES_DIR} && mkdir -p ${EXAMPLES_DIR}`,\\n          process_type: 'SYNC',\\n          timeout_seconds: 10,\\n        },\\n      }\\n\\n      // Step 2: Write the AGENT_DEFINITION_FILE with the template content\\n      yield {\\n        toolName: 'write_file',\\n        args: {\\n          path: TEMPLATE_TYPES_PATH,\\n          instructions: 'Create agent template type definitions file',\\n          content: agentTemplateContent,\\n        },\\n      }\\n\\n      // Step 3: Write the tool definitions file (copy from existing tools.d.ts)\\n      yield {\\n        toolName: 'write_file',\\n        args: {\\n          path: TOOL_DEFINITIONS_PATH,\\n          instructions: 'Create tools type file',\\n          content: toolDefinitionsContent,\\n        },\\n      }\\n\\n      // Step 4: Add message about reading example files and then read them\\n      yield {\\n        toolName: 'add_message',\\n        args: {\\n          role: 'assistant',\\n          content:\\n            \\\"I'll review the starter template and diff-reviewer examples, then help you create your agent.\\\",\\n        },\\n      }\\n\\n      // Step 5: Copy example agent files to .agents/examples/\\n      for (const [filename, content] of Object.entries(exampleAgentContents)) {\\n        if (content) {\\n          yield {\\n            toolName: 'write_file',\\n            args: {\\n              path: `${EXAMPLES_DIR}/${filename}`,\\n              instructions: `Copy example agent file ${filename}`,\\n              content: content,\\n            },\\n          }\\n        }\\n      }\\n\\n      // Step 6: Copy starter template directly to .agents/\\n      if (starterTemplateContent) {\\n        yield {\\n          toolName: 'write_file',\\n          args: {\\n            path: `${AGENT_TEMPLATES_DIR}/${STARTER_TEMPLATE_DEST_FILE}`,\\n            instructions: `Copy starter custom agent template ${STARTER_TEMPLATE_DEST_FILE}`,\\n            content: starterTemplateContent,\\n          },\\n        }\\n      }\\n\\n      // Step 7: Complete agent creation process\\n      yield 'STEP_ALL'\\n    },\\n  }\\n}\\n\"\n}\n</levelcode_tool_call>\n\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"str_replace\",\n  \"path\": \"common/src/constants/agents.ts\",\n  \"replacements\": [\n    {\n      \"old\": \"  dry_run: {\\n    displayName: 'Sketch the Dry Runner',\\n    purpose: 'Agent that takes a plan and try to implement it in a dry run.',\\n    hidden: true,\\n  } as const,\\n\",\n      \"new\": \"\"\n    },\n    {\n      \"old\": \"  agent_builder: {\\n    displayName: 'Bob the Agent Builder',\\n    purpose: 'Creates new agent templates for the levelcode mult-agent system',\\n    hidden: false,\\n  } as const,\\n\",\n      \"new\": \"  agent_builder: {\\n    displayName: 'Bob the Agent Builder',\\n    purpose: 'Creates new agent templates for the levelcode multi-agent system',\\n    hidden: false,\\n  } as const,\\n\"\n    }\n  ]\n}\n</levelcode_tool_call>\n\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \".agents/examples/diff-reviewer-1.ts\",\n  \"instructions\": \"Refresh diff-reviewer-1 example to use current Anthropic model.\",\n  \"content\": \"import type { AgentDefinition } from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-1',\\n\\n  displayName: 'Diff Reviewer (Level 1)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  toolNames: ['read_files', 'run_terminal_command'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  instructionsPrompt: `Execute the following steps:\\n1. Run git diff\\n2. Read the files that have changed\\n3. Review the changes and suggest improvements`,\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \".agents/examples/diff-reviewer-2.ts\",\n  \"instructions\": \"Refresh diff-reviewer-2 example to use current Anthropic model.\",\n  \"content\": \"import type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-2',\\n  displayName: 'Diff Reviewer (Level 2)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description:\\n        'Please provide a short description of the changes you want to review',\\n    },\\n  },\\n  toolNames: ['read_files', 'run_terminal_command'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\\n\\n  instructionsPrompt: `Execute the following steps:\\n1. Run git diff\\n2. Read the files that have changed\\n3. Review the changes and suggest improvements\\n\\nUse the following guidelines while reviewing the changes:\\n- Find ways to simplify the code\\n- Reuse existing code as much as possible instead of writing new code\\n- Preserve as much behavior as possible in the existing code\\n- Prefer changing as few lines of code as possible\\n- Look for opportunities to improve the code's readability\\n- Look for logical errors in the code\\n- Look for missed cases in the code\\n- Look for any other bugs`,\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n      },\\n    }\\n\\n    // Step 2: Let AI run the rest of the steps!\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \".agents/examples/diff-reviewer-3.ts\",\n  \"instructions\": \"Refresh diff-reviewer-3 example to use current Anthropic model, correct file-explorer spawn target, and streamline final step behavior.\",\n  \"content\": \"import type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-3',\\n\\n  displayName: 'Diff Reviewer (Level 3)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description:\\n        'Please provide a short description of the changes you want to review',\\n    },\\n  },\\n  outputMode: 'last_message',\\n\\n  toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\\n  spawnableAgents: ['file-explorer'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\\n\\n  instructionsPrompt: `Review the changes and suggest improvements.\\n\\nUse the following guidelines while reviewing the changes:\\n- Find ways to simplify the code\\n- Reuse existing code as much as possible instead of writing new code\\n- Preserve as much behavior as possible in the existing code\\n- Prefer changing as few lines of code as possible\\n- Look for opportunities to improve the code's readability\\n- Look for logical errors in the code\\n- Look for missed cases in the code\\n- Look for any other bugs`,\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Get list of changed files from git diff --name-only\\n    const { toolResult: gitDiffFilesResult } = yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff --name-only',\\n      },\\n    }\\n\\n    const changedFiles = (gitDiffFilesResult || '')\\n      .split('\\\\n')\\n      .map((line) => line.trim())\\n      .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\\n\\n    // Step 2: Read changed files\\n    if (changedFiles.length > 0) {\\n      yield {\\n        toolName: 'read_files',\\n        args: {\\n          paths: changedFiles,\\n        },\\n      }\\n    }\\n\\n    // Step 3: Run full git diff to see the actual changes\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n      },\\n    }\\n\\n    // Step 4: Spawn file explorer for broader context if needed\\n    yield {\\n      toolName: 'spawn_agents',\\n      args: {\\n        agents: [\\n          {\\n            agent_type: 'file-explorer',\\n            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\\n            params: {\\n              prompts: [\\n                'Any modules/classes/functions referenced by the diff',\\n                'Relevant tests or test helpers for the changed code',\\n                'Related config or shared utilities that might be impacted',\\n              ],\\n            },\\n          },\\n        ],\\n      },\\n    }\\n\\n    // Step 5: Let the AI produce the final review in a single final step\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"common/src/util/examples/diff-reviewer-1.ts\",\n  \"instructions\": \"Refresh common diff-reviewer-1 example to use current Anthropic model.\",\n  \"content\": \"import type { AgentDefinition } from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-1',\\n\\n  displayName: 'Diff Reviewer (Level 1)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  toolNames: ['read_files', 'run_terminal_command'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  instructionsPrompt: `Execute the following steps:\\n1. Run git diff\\n2. Read the files that have changed\\n3. Review the changes and suggest improvements`,\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"common/src/util/examples/diff-reviewer-2.ts\",\n  \"instructions\": \"Refresh common diff-reviewer-2 example to use current Anthropic model.\",\n  \"content\": \"import type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-2',\\n  displayName: 'Diff Reviewer (Level 2)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description:\\n        'Please provide a short description of the changes you want to review',\\n    },\\n  },\\n  toolNames: ['read_files', 'run_terminal_command'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\\n\\n  instructionsPrompt: `Execute the following steps:\\n1. Run git diff\\n2. Read the files that have changed\\n3. Review the changes and suggest improvements\\n\\nUse the following guidelines while reviewing the changes:\\n- Find ways to simplify the code\\n- Reuse existing code as much as possible instead of writing new code\\n- Preserve as much behavior as possible in the existing code\\n- Prefer changing as few lines of code as possible\\n- Look for opportunities to improve the code's readability\\n- Look for logical errors in the code\\n- Look for missed cases in the code\\n- Look for any other bugs`,\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n      },\\n    }\\n\\n    // Step 2: Let AI run the rest of the steps!\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"common/src/util/examples/diff-reviewer-3.ts\",\n  \"instructions\": \"Refresh common diff-reviewer-3 example to use current Anthropic model, correct file-explorer spawn target, and streamline final step behavior.\",\n  \"content\": \"import type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-3',\\n\\n  displayName: 'Diff Reviewer (Level 3)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description:\\n        'Please provide a short description of the changes you want to review',\\n    },\\n  },\\n  outputMode: 'last_message',\\n\\n  toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\\n  spawnableAgents: ['file-explorer'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\\n\\n  instructionsPrompt: `Review the changes and suggest improvements.\\n\\nUse the following guidelines while reviewing the changes:\\n- Find ways to simplify the code\\n- Reuse existing code as much as possible instead of writing new code\\n- Preserve as much behavior as possible in the existing code\\n- Prefer changing as few lines of code as possible\\n- Look for opportunities to improve the code's readability\\n- Look for logical errors in the code\\n- Look for missed cases in the code\\n- Look for any other bugs`,\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Get list of changed files from git diff --name-only\\n    const { toolResult: gitDiffFilesResult } = yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff --name-only',\\n      },\\n    }\\n\\n    const changedFiles = (gitDiffFilesResult || '')\\n      .split('\\\\n')\\n      .map((line) => line.trim())\\n      .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\\n\\n    // Step 2: Read changed files\\n    if (changedFiles.length > 0) {\\n      yield {\\n        toolName: 'read_files',\\n        args: {\\n          paths: changedFiles,\\n        },\\n      }\\n    }\\n\\n    // Step 3: Run full git diff to see the actual changes\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n      },\\n    }\\n\\n    // Step 4: Spawn file explorer for broader context if needed\\n    yield {\\n      toolName: 'spawn_agents',\\n      args: {\\n        agents: [\\n          {\\n            agent_type: 'file-explorer',\\n            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\\n            params: {\\n              prompts: [\\n                'Any modules/classes/functions referenced by the diff',\\n                'Relevant tests or test helpers for the changed code',\\n                'Related config or shared utilities that might be impacted',\\n              ],\\n            },\\n          },\\n        ],\\n      },\\n    }\\n\\n    // Step 5: Let the AI produce the final review in a single final step\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \".agents/your-custom-agent.ts\",\n  \"instructions\": \"Add a new starter custom agent (Git Committer scaffold) in the top-level .agents directory, ready to run and publish.\",\n  \"content\": \"import { publisher, version } from './constants'\\n\\nimport type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from './types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'your-custom-agent',\\n  version,\\n  publisher,\\n\\n  displayName: 'Your Custom Agent (Git Committer)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\\n\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description: 'What changes to commit',\\n    },\\n  },\\n\\n  includeMessageHistory: false,\\n  outputMode: 'last_message',\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\\n\\n  instructionsPrompt:\\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Analyze the changes\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n        process_type: 'SYNC',\\n        timeout_seconds: 30,\\n      },\\n    }\\n\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git log --oneline -10',\\n        process_type: 'SYNC',\\n        timeout_seconds: 30,\\n      },\\n    }\\n\\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\\n    yield {\\n      toolName: 'add_message',\\n      args: {\\n        role: 'assistant',\\n        content: `Goal: ${prompt}\\\\n\\\\nI'll read any relevant files and stage the right changes next.`,\\n      },\\n    }\\n\\n    yield 'STEP'\\n\\n    // Step 3: Let the AI create the commit with proper formatting\\n    yield {\\n      toolName: 'add_message',\\n      args: {\\n        role: 'assistant',\\n        content:\\n          \\\"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\\\",\\n      },\\n    }\\n\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"common/src/util/examples/your-custom-agent.ts.txt\",\n  \"instructions\": \"Add starter custom agent template content for the agent builder to copy into .agents/your-custom-agent.ts.\",\n  \"content\": \"import { publisher, version } from './constants'\\n\\nimport type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from './types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'your-custom-agent',\\n  version,\\n  publisher,\\n\\n  displayName: 'Your Custom Agent (Git Committer)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\\n\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description: 'What changes to commit',\\n    },\\n  },\\n\\n  includeMessageHistory: false,\\n  outputMode: 'last_message',\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\\n\\n  instructionsPrompt:\\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Analyze the changes\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n        process_type: 'SYNC',\\n        timeout_seconds: 30,\\n      },\\n    }\\n\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git log --oneline -10',\\n        process_type: 'SYNC',\\n        timeout_seconds: 30,\\n      },\\n    }\\n\\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\\n    yield {\\n      toolName: 'add_message',\\n      args: {\\n        role: 'assistant',\\n        content: `Goal: ${prompt}\\\\n\\\\nI'll read any relevant files and stage the right changes next.`,\\n      },\\n    }\\n\\n    yield 'STEP'\\n\\n    // Step 3: Let the AI create the commit with proper formatting\\n    yield {\\n      toolName: 'add_message',\\n      args: {\\n        role: 'assistant',\\n        content:\\n          \\\"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\\\",\\n      },\\n    }\\n\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>"
    },
    {
      "type": "tool_call",
      "toolCallId": "236eaf27-5781-488d-bcb0-48431ca62da1",
      "toolName": "write_file",
      "input": {
        "path": "backend/src/templates/agents/agent-builder.ts",
        "instructions": "Update agent builder to gather diff-reviewer examples plus a new starter template, keep examples under .agents/examples, copy starter into .agents root, and stop advertising spawnable agents.",
        "content": "import * as fs from 'fs'\nimport * as path from 'path'\n\nimport { AGENT_TEMPLATES_DIR, AGENT_DEFINITION_FILE } from '@levelcode/common/constants'\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\nimport z from 'zod/v4'\n\nimport type { AgentTemplate } from '../types'\nimport type { Model } from '@levelcode/common/constants'\nimport type { ToolName } from '@levelcode/common/tools/constants'\n\nconst COMMON_UTIL_PATH = '../../../../common/src/util'\nconst TEMPLATE_RELATIVE_PATH =\n  `${COMMON_UTIL_PATH}/types/${AGENT_DEFINITION_FILE}` as const\n// Import to validate path exists at compile time\nimport(TEMPLATE_RELATIVE_PATH)\n\nconst TEMPLATE_PATH = path.join(__dirname, TEMPLATE_RELATIVE_PATH)\nconst TYPES_DIR = path.join(AGENT_TEMPLATES_DIR, 'types')\nconst EXAMPLES_DIR = path.join(AGENT_TEMPLATES_DIR, 'examples')\nconst TEMPLATE_TYPES_PATH = path.join(TYPES_DIR, AGENT_DEFINITION_FILE)\nconst TOOL_DEFINITIONS_FILE = 'tools.d.ts'\nconst TOOL_DEFINITIONS_PATH = path.join(TYPES_DIR, TOOL_DEFINITIONS_FILE)\n\nconst EXAMPLES_SOURCE_DIR = path.join(__dirname, `${COMMON_UTIL_PATH}/examples`)\nconst STARTER_TEMPLATE_SOURCE_FILE = 'your-custom-agent.ts.txt'\nconst STARTER_TEMPLATE_DEST_FILE = 'your-custom-agent.ts'\n\nexport const agentBuilder = (\n  model: Model,\n  _allAvailableAgents?: string[],\n): Omit<AgentTemplate, 'id'> => {\n  // Read the AGENT_CONFIG_FILE content dynamically\n  // The import above ensures this path exists at compile time\n  let agentTemplateContent = ''\n  try {\n    agentTemplateContent = fs.readFileSync(TEMPLATE_PATH, 'utf8')\n  } catch (error) {\n    console.warn(`Could not read ${AGENT_DEFINITION_FILE}:`, error)\n    agentTemplateContent = '// Agent template types not available'\n  }\n\n  // Read the tools.d.ts content from common package\n  let toolDefinitionsContent = ''\n  try {\n    const toolsPath = path.join(\n      __dirname,\n      `${COMMON_UTIL_PATH}/types/tools.d.ts`,\n    )\n    toolDefinitionsContent = fs.readFileSync(toolsPath, 'utf8')\n  } catch (error) {\n    console.warn(`Could not read tools.d.ts from common:`, error)\n    toolDefinitionsContent = '// Tool definitions not available'\n  }\n\n  // Read example agent files + starter template from common package\n  const exampleAgentContents: Record<string, string> = {}\n  let starterTemplateContent = ''\n\n  try {\n    if (fs.existsSync(EXAMPLES_SOURCE_DIR)) {\n      const files = fs.readdirSync(EXAMPLES_SOURCE_DIR)\n\n      files\n        .filter(\n          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer-'),\n        )\n        .forEach((filename) => {\n          const fullPath = path.join(EXAMPLES_SOURCE_DIR, filename)\n          const content = fs.readFileSync(fullPath, 'utf8')\n          exampleAgentContents[filename] = content\n        })\n\n      const starterTemplatePath = path.join(\n        EXAMPLES_SOURCE_DIR,\n        STARTER_TEMPLATE_SOURCE_FILE,\n      )\n      if (fs.existsSync(starterTemplatePath)) {\n        starterTemplateContent = fs.readFileSync(starterTemplatePath, 'utf8')\n      }\n    } else {\n      console.warn(\n        `Example agents directory does not exist: ${EXAMPLES_SOURCE_DIR}`,\n      )\n    }\n  } catch (error) {\n    console.warn('Could not read example agents:', error)\n  }\n\n  return {\n    model,\n    displayName: 'Bob the Agent Builder',\n    spawnPurposePrompt:\n      'Enhanced base agent that can create custom agents and handle all coding tasks with deterministic agent creation behavior',\n    inputSchema: {\n      prompt: z\n        .string()\n        .optional()\n        .describe(\n          'What agent type you would like to create or edit. Include as many details as possible.',\n        ),\n      params: z\n        .object({\n          name: z.string().optional(),\n          purpose: z.string().optional(),\n          specialty: z.string().optional(),\n          model: z.string().optional(),\n        })\n        .passthrough()\n        .optional(),\n    },\n    outputMode: 'structured_output',\n    includeMessageHistory: false,\n    toolNames: [\n      'write_file',\n      'str_replace',\n      'run_terminal_command',\n      'read_files',\n      'code_search',\n      'spawn_agents',\n      'add_message',\n      'set_output',\n      'end_turn',\n    ] satisfies ToolName[],\n\n    systemPrompt: [\n      '# Bob the Agent Builder',\n      '',\n      'You are an expert agent builder specialized in creating new agent templates for the levelcode system. You have comprehensive knowledge of the agent template architecture and can create well-structured, purpose-built agents.',\n      '',\n      '## Environment Setup Complete',\n      '',\n      'Your environment has been automatically prepared with:',\n      '- Agent template type definitions in `.agents/types/agent-definition.d.ts`',\n      '- Tool type definitions in `.agents/types/tools.d.ts`',\n      '- Diff-reviewer examples in `.agents/examples/` for reference',\n      '- A starter custom agent template at `.agents/your-custom-agent.ts`',\n      '',\n      'All necessary files are now available in your working directory.',\n      '',\n      '## Complete Agent Template Type Definitions',\n      '',\n      'Here are the complete TypeScript type definitions for creating custom LevelCode agents:',\n      '```typescript',\n      agentTemplateContent,\n      '```',\n      '',\n      '## Available Tools Type Definitions',\n      '',\n      'Here are the complete TypeScript type definitions for all available tools:',\n      '',\n      '```typescript',\n      toolDefinitionsContent,\n      '```',\n      '',\n      '## Agent Template Patterns:',\n      '',\n      '1. **Base Agent Pattern**: Full-featured agents with comprehensive tool access',\n      '2. **Specialized Agent Pattern**: Focused agents with limited tool sets',\n      '3. **Thinking Agent Pattern**: Agents that spawn thinker sub-agents',\n      '4. **Research Agent Pattern**: Agents that start with web search',\n      '',\n      '## Best Practices:',\n      '',\n      '1. **Use as few fields as possible**: Leave out fields that are not needed to reduce complexity',\n      '2. **Minimal Tools**: Only include tools the agent actually needs',\n      '3. **Clear and Concise Prompts**: Write clear, specific prompts that have no unnecessary words',\n      '4. **Consistent Naming**: Follow naming conventions (kebab-case for IDs)',\n      '5. **Appropriate Model**: Choose the right model for the task complexity. Default is claude-4-sonnet-20250522 for medium-high complexity tasks, and openai/gpt-5 for all other tasks.',\n      '',\n      '## Your Task:',\n      'When asked to create an agent template, you should:',\n      \"1. Understand the requested agent's purpose and capabilities\",\n      \"2. Choose appropriate tools for the agent's function\",\n      '3. Write a comprehensive system prompt',\n      `4. Create the complete agent template file in ${AGENT_TEMPLATES_DIR}`,\n      '5. Ensure the template follows all conventions and best practices',\n      '6. Use the AgentDefinition interface for the configuration',\n      '7. Start the file with: import type { AgentDefinition } from \"./types/agent-definition.d.ts\"',\n      '',\n      'Create agent templates that are focused, efficient, and well-documented. Always import the AgentDefinition type and export a default configuration object.',\n    ].join('\\n'),\n    instructionsPrompt: `You are helping to create or edit an agent template. The user will describe what kind of agent they want to create or how they want to modify an existing agent.\n\n## Environment Ready\n\nYour environment has been automatically set up with:\n- Type definitions in \\`.agents/types/\\`\n- Diff-reviewer examples in \\`.agents/examples/\\`\n- A starter custom agent template at \\`.agents/your-custom-agent.ts\\`\n\nYou can now proceed directly to agent creation or editing.\n\n## Example Agents Available\n\nThree diff-reviewer examples are available in \\`.agents/examples/\\`. These can serve as examples of well-made agents at different stages of complexity.\n\n**IMPORTANT**: Examine these examples to find connections and patterns that relate to the user's request. Look for:\n- Similar tool combinations\n- Comparable complexity levels\n- Related functionality patterns\n- Appropriate model choices\n- Relevant prompt structures\n\nUse these examples as inspiration and starting points, adapting their patterns to fit the user's specific needs.\n\n## Starter Template Available\n\nA starter custom agent file is available at \\`.agents/your-custom-agent.ts\\`. You can either modify this file directly or use it as a reference for creating a new agent.\n\n## For New Agents\n\nAnalyze their request and create a complete agent template that:\n- Has a clear purpose and appropriate capabilities\n- Leaves out fields that are not needed\n- Uses only the tools it needs\n- Follows naming conventions\n- Is properly structured\n- Draws inspiration from relevant example agents\n\n## For Creating New Agents\n\nThe agent builder is focused on creating new agent templates based on user specifications.\n\nIMPORTANT: Always end your response with the end_turn tool when you have completed the agent creation or editing task.`,\n    stepPrompt: '',\n\n    handleSteps: function* () {\n      // Step 1: Create directory structure\n      yield {\n        toolName: 'run_terminal_command',\n        args: {\n          command: `mkdir -p ${TYPES_DIR} && mkdir -p ${EXAMPLES_DIR}`,\n          process_type: 'SYNC',\n          timeout_seconds: 10,\n        },\n      }\n\n      // Step 2: Write the AGENT_DEFINITION_FILE with the template content\n      yield {\n        toolName: 'write_file',\n        args: {\n          path: TEMPLATE_TYPES_PATH,\n          instructions: 'Create agent template type definitions file',\n          content: agentTemplateContent,\n        },\n      }\n\n      // Step 3: Write the tool definitions file (copy from existing tools.d.ts)\n      yield {\n        toolName: 'write_file',\n        args: {\n          path: TOOL_DEFINITIONS_PATH,\n          instructions: 'Create tools type file',\n          content: toolDefinitionsContent,\n        },\n      }\n\n      // Step 4: Add message about reading example files and then read them\n      yield {\n        toolName: 'add_message',\n        args: {\n          role: 'assistant',\n          content:\n            \"I'll review the starter template and diff-reviewer examples, then help you create your agent.\",\n        },\n      }\n\n      // Step 5: Copy example agent files to .agents/examples/\n      for (const [filename, content] of Object.entries(exampleAgentContents)) {\n        if (content) {\n          yield {\n            toolName: 'write_file',\n            args: {\n              path: `${EXAMPLES_DIR}/${filename}`,\n              instructions: `Copy example agent file ${filename}`,\n              content: content,\n            },\n          }\n        }\n      }\n\n      // Step 6: Copy starter template directly to .agents/\n      if (starterTemplateContent) {\n        yield {\n          toolName: 'write_file',\n          args: {\n            path: `${AGENT_TEMPLATES_DIR}/${STARTER_TEMPLATE_DEST_FILE}`,\n            instructions: `Copy starter custom agent template ${STARTER_TEMPLATE_DEST_FILE}`,\n            content: starterTemplateContent,\n          },\n        }\n      }\n\n      // Step 7: Complete agent creation process\n      yield 'STEP_ALL'\n    },\n  }\n}\n"
      },
      "agentId": "D-oY2QIts4E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "236eaf27-5781-488d-bcb0-48431ca62da1",
      "toolName": "write_file",
      "output": [
        {
          "type": "json",
          "value": {
            "file": "backend/src/templates/agents/agent-builder.ts",
            "message": "Updated file",
            "unifiedDiff": "@@ -1,12 +1,8 @@\n import * as fs from 'fs'\n import * as path from 'path'\n \n-import {\n-  AGENT_TEMPLATES_DIR,\n-  openrouterModels,\n-  AGENT_DEFINITION_FILE,\n-} from '@levelcode/common/constants'\n+import { AGENT_TEMPLATES_DIR, AGENT_DEFINITION_FILE } from '@levelcode/common/constants'\n import { AgentTemplateTypes } from '@levelcode/common/types/session-state'\n import z from 'zod/v4'\n \n import type { AgentTemplate } from '../types'\n@@ -19,9 +15,8 @@\n // Import to validate path exists at compile time\n import(TEMPLATE_RELATIVE_PATH)\n \n const TEMPLATE_PATH = path.join(__dirname, TEMPLATE_RELATIVE_PATH)\n-const DEFAULT_MODEL = openrouterModels.openrouter_claude_sonnet_4\n const TYPES_DIR = path.join(AGENT_TEMPLATES_DIR, 'types')\n const EXAMPLES_DIR = path.join(AGENT_TEMPLATES_DIR, 'examples')\n const TEMPLATE_TYPES_PATH = path.join(TYPES_DIR, AGENT_DEFINITION_FILE)\n const TOOL_DEFINITIONS_FILE = 'tools.d.ts'\n@@ -32,9 +27,9 @@\n const STARTER_TEMPLATE_DEST_FILE = 'your-custom-agent.ts'\n \n export const agentBuilder = (\n   model: Model,\n-  allAvailableAgents?: string[],\n+  _allAvailableAgents?: string[],\n ): Omit<AgentTemplate, 'id'> => {\n   // Read the AGENT_CONFIG_FILE content dynamically\n   // The import above ensures this path exists at compile time\n   let agentTemplateContent = ''\n@@ -57,9 +52,9 @@\n     console.warn(`Could not read tools.d.ts from common:`, error)\n     toolDefinitionsContent = '// Tool definitions not available'\n   }\n \n-  // Read example agent files from common package\n+  // Read example agent files + starter template from common package\n   const exampleAgentContents: Record<string, string> = {}\n   let starterTemplateContent = ''\n \n   try {\n@@ -229,9 +224,9 @@\n \n IMPORTANT: Always end your response with the end_turn tool when you have completed the agent creation or editing task.`,\n     stepPrompt: '',\n \n-    handleSteps: function* ({ agentState, prompt, params }) {\n+    handleSteps: function* () {\n       // Step 1: Create directory structure\n       yield {\n         toolName: 'run_terminal_command',\n         args: {\n"
          }
        }
      ],
      "parentAgentId": "D-oY2QIts4E"
    },
    {
      "type": "tool_call",
      "toolCallId": "f89a12af-70bc-4922-a9f3-ff7a854526cd",
      "toolName": "str_replace",
      "input": {
        "path": "common/src/constants/agents.ts",
        "replacements": [
          {
            "old": "  dry_run: {\n    displayName: 'Sketch the Dry Runner',\n    purpose: 'Agent that takes a plan and try to implement it in a dry run.',\n    hidden: true,\n  } as const,\n",
            "new": ""
          },
          {
            "old": "  agent_builder: {\n    displayName: 'Bob the Agent Builder',\n    purpose: 'Creates new agent templates for the levelcode mult-agent system',\n    hidden: false,\n  } as const,\n",
            "new": "  agent_builder: {\n    displayName: 'Bob the Agent Builder',\n    purpose: 'Creates new agent templates for the levelcode multi-agent system',\n    hidden: false,\n  } as const,\n"
          }
        ]
      },
      "agentId": "D-oY2QIts4E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "f89a12af-70bc-4922-a9f3-ff7a854526cd",
      "toolName": "str_replace",
      "output": [
        {
          "type": "json",
          "value": {
            "file": "common/src/constants/agents.ts",
            "message": "Updated file",
            "unifiedDiff": "@@ -64,21 +64,16 @@\n     displayName: 'Peter Plan the Planner',\n     purpose: 'Agent that formulates a comprehensive plan to a prompt.',\n     hidden: true,\n   } as const,\n-  dry_run: {\n-    displayName: 'Sketch the Dry Runner',\n-    purpose: 'Agent that takes a plan and try to implement it in a dry run.',\n-    hidden: true,\n-  } as const,\n   reviewer: {\n     displayName: 'Nit Pick Nick the Reviewer',\n     purpose:\n       'Reviews file changes and responds with critical feedback. Use this after making any significant change to the codebase.',\n   } as const,\n   agent_builder: {\n     displayName: 'Bob the Agent Builder',\n-    purpose: 'Creates new agent templates for the levelcode mult-agent system',\n+    purpose: 'Creates new agent templates for the levelcode multi-agent system',\n     hidden: false,\n   } as const,\n } as const satisfies Partial<\n   Record<\n"
          }
        }
      ],
      "parentAgentId": "D-oY2QIts4E"
    },
    {
      "type": "tool_call",
      "toolCallId": "65fada28-f7b9-49f3-baec-e21b68f486e1",
      "toolName": "write_file",
      "input": {
        "path": ".agents/examples/diff-reviewer-1.ts",
        "instructions": "Refresh diff-reviewer-1 example to use current Anthropic model.",
        "content": "import type { AgentDefinition } from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-1',\n\n  displayName: 'Diff Reviewer (Level 1)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements`,\n}\n\nexport default definition\n"
      },
      "agentId": "D-oY2QIts4E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "65fada28-f7b9-49f3-baec-e21b68f486e1",
      "toolName": "write_file",
      "output": [
        {
          "type": "json",
          "value": {
            "file": ".agents/examples/diff-reviewer-1.ts",
            "message": "Updated file",
            "unifiedDiff": "@@ -3,9 +3,9 @@\n const definition: AgentDefinition = {\n   id: 'diff-reviewer-1',\n \n   displayName: 'Diff Reviewer (Level 1)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n   toolNames: ['read_files', 'run_terminal_command'],\n \n   spawnPurposePrompt:\n     'Spawn when you need to review code changes in the git diff',\n"
          }
        }
      ],
      "parentAgentId": "D-oY2QIts4E"
    },
    {
      "type": "tool_call",
      "toolCallId": "c0b7155d-f1c0-4c3e-a53d-7bcb681e9c03",
      "toolName": "write_file",
      "input": {
        "path": ".agents/examples/diff-reviewer-2.ts",
        "instructions": "Refresh diff-reviewer-2 example to use current Anthropic model.",
        "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-2',\n  displayName: 'Diff Reviewer (Level 2)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ prompt }: AgentStepContext) {\n    // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 2: Let AI run the rest of the steps!\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n"
      },
      "agentId": "D-oY2QIts4E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "c0b7155d-f1c0-4c3e-a53d-7bcb681e9c03",
      "toolName": "write_file",
      "output": [
        {
          "type": "json",
          "value": {
            "file": ".agents/examples/diff-reviewer-2.ts",
            "message": "Updated file",
            "unifiedDiff": "@@ -5,9 +5,9 @@\n \n const definition: AgentDefinition = {\n   id: 'diff-reviewer-2',\n   displayName: 'Diff Reviewer (Level 2)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n \n   inputSchema: {\n     prompt: {\n       type: 'string',\n@@ -37,9 +37,9 @@\n - Look for logical errors in the code\n - Look for missed cases in the code\n - Look for any other bugs`,\n \n-  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n+  handleSteps: function* ({ prompt }: AgentStepContext) {\n     // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\n     yield {\n       toolName: 'run_terminal_command',\n       args: {\n"
          }
        }
      ],
      "parentAgentId": "D-oY2QIts4E"
    },
    {
      "type": "tool_call",
      "toolCallId": "1f7ddb30-5253-40c0-8c05-71c3c54a8a93",
      "toolName": "write_file",
      "input": {
        "path": ".agents/examples/diff-reviewer-3.ts",
        "instructions": "Refresh diff-reviewer-3 example to use current Anthropic model, correct file-explorer spawn target, and streamline final step behavior.",
        "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-3',\n\n  displayName: 'Diff Reviewer (Level 3)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  outputMode: 'last_message',\n\n  toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\n  spawnableAgents: ['file-explorer'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Review the changes and suggest improvements.\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ prompt }: AgentStepContext) {\n    // Step 1: Get list of changed files from git diff --name-only\n    const { toolResult: gitDiffFilesResult } = yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff --name-only',\n      },\n    }\n\n    const changedFiles = (gitDiffFilesResult || '')\n      .split('\\n')\n      .map((line) => line.trim())\n      .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\n\n    // Step 2: Read changed files\n    if (changedFiles.length > 0) {\n      yield {\n        toolName: 'read_files',\n        args: {\n          paths: changedFiles,\n        },\n      }\n    }\n\n    // Step 3: Run full git diff to see the actual changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 4: Spawn file explorer for broader context if needed\n    yield {\n      toolName: 'spawn_agents',\n      args: {\n        agents: [\n          {\n            agent_type: 'file-explorer',\n            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\n            params: {\n              prompts: [\n                'Any modules/classes/functions referenced by the diff',\n                'Relevant tests or test helpers for the changed code',\n                'Related config or shared utilities that might be impacted',\n              ],\n            },\n          },\n        ],\n      },\n    }\n\n    // Step 5: Let the AI produce the final review in a single final step\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n"
      },
      "agentId": "D-oY2QIts4E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "1f7ddb30-5253-40c0-8c05-71c3c54a8a93",
      "toolName": "write_file",
      "output": [
        {
          "type": "json",
          "value": {
            "file": ".agents/examples/diff-reviewer-3.ts",
            "message": "Updated file",
            "unifiedDiff": "@@ -6,9 +6,9 @@\n const definition: AgentDefinition = {\n   id: 'diff-reviewer-3',\n \n   displayName: 'Diff Reviewer (Level 3)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n   inputSchema: {\n     prompt: {\n       type: 'string',\n       description:\n@@ -17,9 +17,9 @@\n   },\n   outputMode: 'last_message',\n \n   toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\n-  spawnableAgents: ['james/file-explorer@0.1.3'],\n+  spawnableAgents: ['file-explorer'],\n \n   spawnPurposePrompt:\n     'Spawn when you need to review code changes in the git diff',\n \n@@ -37,24 +37,23 @@\n - Look for logical errors in the code\n - Look for missed cases in the code\n - Look for any other bugs`,\n \n-  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n+  handleSteps: function* ({ prompt }: AgentStepContext) {\n     // Step 1: Get list of changed files from git diff --name-only\n     const { toolResult: gitDiffFilesResult } = yield {\n       toolName: 'run_terminal_command',\n       args: {\n         command: 'git diff --name-only',\n       },\n     }\n \n-    // Then, extract file paths from the result\n     const changedFiles = (gitDiffFilesResult || '')\n       .split('\\n')\n       .map((line) => line.trim())\n       .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\n \n-    // Step 2: Read the files\n+    // Step 2: Read changed files\n     if (changedFiles.length > 0) {\n       yield {\n         toolName: 'read_files',\n         args: {\n@@ -70,31 +69,30 @@\n         command: 'git diff',\n       },\n     }\n \n-    // Step 4: Put words in the AI's mouth to get it to spawn the file explorer.\n+    // Step 4: Spawn file explorer for broader context if needed\n     yield {\n-      toolName: 'add_message',\n+      toolName: 'spawn_agents',\n       args: {\n-        role: 'assistant',\n-        content:\n-          'Now I will spawn a file explorer to find any missing codebase context.',\n+        agents: [\n+          {\n+            agent_type: 'file-explorer',\n+            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\n+            params: {\n+              prompts: [\n+                'Any modules/classes/functions referenced by the diff',\n+                'Relevant tests or test helpers for the changed code',\n+                'Related config or shared utilities that might be impacted',\n+              ],\n+            },\n+          },\n+        ],\n       },\n     }\n \n-    yield 'STEP'\n-\n-    // Step 5: Put words in the AI's mouth to review the changes.\n-    yield {\n-      toolName: 'add_message',\n-      args: {\n-        role: 'assistant',\n-        content: 'Here is my comprehensive review of the changes.',\n-      },\n-    }\n-\n-    // Step 6: Let AI review the changes in a final step. (The last message is also the agent's output.)\n-    yield 'STEP'\n+    // Step 5: Let the AI produce the final review in a single final step\n+    yield 'STEP_ALL'\n   },\n }\n \n export default definition\n"
          }
        }
      ],
      "parentAgentId": "D-oY2QIts4E"
    },
    {
      "type": "tool_call",
      "toolCallId": "35900739-e50e-4d7a-bd04-a1b14358fc80",
      "toolName": "write_file",
      "input": {
        "path": "common/src/util/examples/diff-reviewer-1.ts",
        "instructions": "Refresh common diff-reviewer-1 example to use current Anthropic model.",
        "content": "import type { AgentDefinition } from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-1',\n\n  displayName: 'Diff Reviewer (Level 1)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements`,\n}\n\nexport default definition\n"
      },
      "agentId": "D-oY2QIts4E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "35900739-e50e-4d7a-bd04-a1b14358fc80",
      "toolName": "write_file",
      "output": [
        {
          "type": "json",
          "value": {
            "file": "common/src/util/examples/diff-reviewer-1.ts",
            "message": "Updated file",
            "unifiedDiff": "@@ -3,9 +3,9 @@\n const definition: AgentDefinition = {\n   id: 'diff-reviewer-1',\n \n   displayName: 'Diff Reviewer (Level 1)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n   toolNames: ['read_files', 'run_terminal_command'],\n \n   spawnPurposePrompt:\n     'Spawn when you need to review code changes in the git diff',\n"
          }
        }
      ],
      "parentAgentId": "D-oY2QIts4E"
    },
    {
      "type": "tool_call",
      "toolCallId": "f92ff527-8c2f-44f4-9c51-c80823a0eccd",
      "toolName": "write_file",
      "input": {
        "path": "common/src/util/examples/diff-reviewer-2.ts",
        "instructions": "Refresh common diff-reviewer-2 example to use current Anthropic model.",
        "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-2',\n  displayName: 'Diff Reviewer (Level 2)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  toolNames: ['read_files', 'run_terminal_command'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Execute the following steps:\n1. Run git diff\n2. Read the files that have changed\n3. Review the changes and suggest improvements\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ prompt }: AgentStepContext) {\n    // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 2: Let AI run the rest of the steps!\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n"
      },
      "agentId": "D-oY2QIts4E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "f92ff527-8c2f-44f4-9c51-c80823a0eccd",
      "toolName": "write_file",
      "output": [
        {
          "type": "json",
          "value": {
            "file": "common/src/util/examples/diff-reviewer-2.ts",
            "message": "Updated file",
            "unifiedDiff": "@@ -5,9 +5,9 @@\n \n const definition: AgentDefinition = {\n   id: 'diff-reviewer-2',\n   displayName: 'Diff Reviewer (Level 2)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n \n   inputSchema: {\n     prompt: {\n       type: 'string',\n@@ -37,9 +37,9 @@\n - Look for logical errors in the code\n - Look for missed cases in the code\n - Look for any other bugs`,\n \n-  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n+  handleSteps: function* ({ prompt }: AgentStepContext) {\n     // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\n     yield {\n       toolName: 'run_terminal_command',\n       args: {\n"
          }
        }
      ],
      "parentAgentId": "D-oY2QIts4E"
    },
    {
      "type": "tool_call",
      "toolCallId": "35d48f21-73b4-4629-bfde-eab0b9251e99",
      "toolName": "write_file",
      "input": {
        "path": "common/src/util/examples/diff-reviewer-3.ts",
        "instructions": "Refresh common diff-reviewer-3 example to use current Anthropic model, correct file-explorer spawn target, and streamline final step behavior.",
        "content": "import type {\n  AgentDefinition,\n  AgentStepContext,\n} from '../types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'diff-reviewer-3',\n\n  displayName: 'Diff Reviewer (Level 3)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description:\n        'Please provide a short description of the changes you want to review',\n    },\n  },\n  outputMode: 'last_message',\n\n  toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\n  spawnableAgents: ['file-explorer'],\n\n  spawnPurposePrompt:\n    'Spawn when you need to review code changes in the git diff',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\n\n  instructionsPrompt: `Review the changes and suggest improvements.\n\nUse the following guidelines while reviewing the changes:\n- Find ways to simplify the code\n- Reuse existing code as much as possible instead of writing new code\n- Preserve as much behavior as possible in the existing code\n- Prefer changing as few lines of code as possible\n- Look for opportunities to improve the code's readability\n- Look for logical errors in the code\n- Look for missed cases in the code\n- Look for any other bugs`,\n\n  handleSteps: function* ({ prompt }: AgentStepContext) {\n    // Step 1: Get list of changed files from git diff --name-only\n    const { toolResult: gitDiffFilesResult } = yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff --name-only',\n      },\n    }\n\n    const changedFiles = (gitDiffFilesResult || '')\n      .split('\\n')\n      .map((line) => line.trim())\n      .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\n\n    // Step 2: Read changed files\n    if (changedFiles.length > 0) {\n      yield {\n        toolName: 'read_files',\n        args: {\n          paths: changedFiles,\n        },\n      }\n    }\n\n    // Step 3: Run full git diff to see the actual changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n      },\n    }\n\n    // Step 4: Spawn file explorer for broader context if needed\n    yield {\n      toolName: 'spawn_agents',\n      args: {\n        agents: [\n          {\n            agent_type: 'file-explorer',\n            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\n            params: {\n              prompts: [\n                'Any modules/classes/functions referenced by the diff',\n                'Relevant tests or test helpers for the changed code',\n                'Related config or shared utilities that might be impacted',\n              ],\n            },\n          },\n        ],\n      },\n    }\n\n    // Step 5: Let the AI produce the final review in a single final step\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n"
      },
      "agentId": "D-oY2QIts4E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "35d48f21-73b4-4629-bfde-eab0b9251e99",
      "toolName": "write_file",
      "output": [
        {
          "type": "json",
          "value": {
            "file": "common/src/util/examples/diff-reviewer-3.ts",
            "message": "Updated file",
            "unifiedDiff": "@@ -6,9 +6,9 @@\n const definition: AgentDefinition = {\n   id: 'diff-reviewer-3',\n \n   displayName: 'Diff Reviewer (Level 3)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n   inputSchema: {\n     prompt: {\n       type: 'string',\n       description:\n@@ -17,9 +17,9 @@\n   },\n   outputMode: 'last_message',\n \n   toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\n-  spawnableAgents: ['james/file-explorer@0.1.3'],\n+  spawnableAgents: ['file-explorer'],\n \n   spawnPurposePrompt:\n     'Spawn when you need to review code changes in the git diff',\n \n@@ -37,24 +37,23 @@\n - Look for logical errors in the code\n - Look for missed cases in the code\n - Look for any other bugs`,\n \n-  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n+  handleSteps: function* ({ prompt }: AgentStepContext) {\n     // Step 1: Get list of changed files from git diff --name-only\n     const { toolResult: gitDiffFilesResult } = yield {\n       toolName: 'run_terminal_command',\n       args: {\n         command: 'git diff --name-only',\n       },\n     }\n \n-    // Then, extract file paths from the result\n     const changedFiles = (gitDiffFilesResult || '')\n       .split('\\n')\n       .map((line) => line.trim())\n       .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\n \n-    // Step 2: Read the files\n+    // Step 2: Read changed files\n     if (changedFiles.length > 0) {\n       yield {\n         toolName: 'read_files',\n         args: {\n@@ -70,31 +69,30 @@\n         command: 'git diff',\n       },\n     }\n \n-    // Step 4: Put words in the AI's mouth to get it to spawn the file explorer.\n+    // Step 4: Spawn file explorer for broader context if needed\n     yield {\n-      toolName: 'add_message',\n+      toolName: 'spawn_agents',\n       args: {\n-        role: 'assistant',\n-        content:\n-          'Now I will spawn a file explorer to find any missing codebase context.',\n+        agents: [\n+          {\n+            agent_type: 'file-explorer',\n+            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\n+            params: {\n+              prompts: [\n+                'Any modules/classes/functions referenced by the diff',\n+                'Relevant tests or test helpers for the changed code',\n+                'Related config or shared utilities that might be impacted',\n+              ],\n+            },\n+          },\n+        ],\n       },\n     }\n \n-    yield 'STEP'\n-\n-    // Step 5: Put words in the AI's mouth to review the changes.\n-    yield {\n-      toolName: 'add_message',\n-      args: {\n-        role: 'assistant',\n-        content: 'Here is my comprehensive review of the changes.',\n-      },\n-    }\n-\n-    // Step 6: Let AI review the changes in a final step. (The last message is also the agent's output.)\n-    yield 'STEP'\n+    // Step 5: Let the AI produce the final review in a single final step\n+    yield 'STEP_ALL'\n   },\n }\n \n export default definition\n"
          }
        }
      ],
      "parentAgentId": "D-oY2QIts4E"
    },
    {
      "type": "tool_call",
      "toolCallId": "e9652d7f-e25d-4335-a72e-469560bbdadd",
      "toolName": "write_file",
      "input": {
        "path": ".agents/your-custom-agent.ts",
        "instructions": "Add a new starter custom agent (Git Committer scaffold) in the top-level .agents directory, ready to run and publish.",
        "content": "import { publisher, version } from './constants'\n\nimport type {\n  AgentDefinition,\n  AgentStepContext,\n} from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'your-custom-agent',\n  version,\n  publisher,\n\n  displayName: 'Your Custom Agent (Git Committer)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description: 'What changes to commit',\n    },\n  },\n\n  includeMessageHistory: false,\n  outputMode: 'last_message',\n\n  spawnPurposePrompt:\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\n\n  instructionsPrompt:\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\n\n  handleSteps: function* ({ prompt }: AgentStepContext) {\n    // Step 1: Analyze the changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git log --oneline -10',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content: `Goal: ${prompt}\\n\\nI'll read any relevant files and stage the right changes next.`,\n      },\n    }\n\n    yield 'STEP'\n\n    // Step 3: Let the AI create the commit with proper formatting\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          \"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\",\n      },\n    }\n\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n"
      },
      "agentId": "D-oY2QIts4E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "e9652d7f-e25d-4335-a72e-469560bbdadd",
      "toolName": "write_file",
      "output": [
        {
          "type": "json",
          "value": {
            "file": ".agents/your-custom-agent.ts",
            "message": "Created new file",
            "unifiedDiff": "import { publisher, version } from './constants'\n\nimport type {\n  AgentDefinition,\n  AgentStepContext,\n} from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'your-custom-agent',\n  version,\n  publisher,\n\n  displayName: 'Your Custom Agent (Git Committer)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description: 'What changes to commit',\n    },\n  },\n\n  includeMessageHistory: false,\n  outputMode: 'last_message',\n\n  spawnPurposePrompt:\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\n\n  instructionsPrompt:\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\n\n  handleSteps: function* ({ prompt }: AgentStepContext) {\n    // Step 1: Analyze the changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git log --oneline -10',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content: `Goal: ${prompt}\\n\\nI'll read any relevant files and stage the right changes next.`,\n      },\n    }\n\n    yield 'STEP'\n\n    // Step 3: Let the AI create the commit with proper formatting\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          \"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\",\n      },\n    }\n\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n"
          }
        }
      ],
      "parentAgentId": "D-oY2QIts4E"
    },
    {
      "type": "tool_call",
      "toolCallId": "322d55c0-598c-4165-97c8-e9caa5ebb457",
      "toolName": "write_file",
      "input": {
        "path": "common/src/util/examples/your-custom-agent.ts.txt",
        "instructions": "Add starter custom agent template content for the agent builder to copy into .agents/your-custom-agent.ts.",
        "content": "import { publisher, version } from './constants'\n\nimport type {\n  AgentDefinition,\n  AgentStepContext,\n} from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'your-custom-agent',\n  version,\n  publisher,\n\n  displayName: 'Your Custom Agent (Git Committer)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description: 'What changes to commit',\n    },\n  },\n\n  includeMessageHistory: false,\n  outputMode: 'last_message',\n\n  spawnPurposePrompt:\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\n\n  instructionsPrompt:\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\n\n  handleSteps: function* ({ prompt }: AgentStepContext) {\n    // Step 1: Analyze the changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git log --oneline -10',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content: `Goal: ${prompt}\\n\\nI'll read any relevant files and stage the right changes next.`,\n      },\n    }\n\n    yield 'STEP'\n\n    // Step 3: Let the AI create the commit with proper formatting\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          \"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\",\n      },\n    }\n\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n"
      },
      "agentId": "D-oY2QIts4E",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "322d55c0-598c-4165-97c8-e9caa5ebb457",
      "toolName": "write_file",
      "output": [
        {
          "type": "json",
          "value": {
            "file": "common/src/util/examples/your-custom-agent.ts.txt",
            "message": "Created new file",
            "unifiedDiff": "import { publisher, version } from './constants'\n\nimport type {\n  AgentDefinition,\n  AgentStepContext,\n} from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'your-custom-agent',\n  version,\n  publisher,\n\n  displayName: 'Your Custom Agent (Git Committer)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description: 'What changes to commit',\n    },\n  },\n\n  includeMessageHistory: false,\n  outputMode: 'last_message',\n\n  spawnPurposePrompt:\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\n\n  instructionsPrompt:\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\n\n  handleSteps: function* ({ prompt }: AgentStepContext) {\n    // Step 1: Analyze the changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git log --oneline -10',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content: `Goal: ${prompt}\\n\\nI'll read any relevant files and stage the right changes next.`,\n      },\n    }\n\n    yield 'STEP'\n\n    // Step 3: Let the AI create the commit with proper formatting\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          \"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\",\n      },\n    }\n\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n"
          }
        }
      ],
      "parentAgentId": "D-oY2QIts4E"
    },
    {
      "type": "tool_call",
      "toolCallId": "9cacab6f-eccb-4681-98bd-9855db807bb5",
      "toolName": "set_output",
      "input": {
        "output": {
          "message": "<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"backend/src/templates/agents/agent-builder.ts\",\n  \"instructions\": \"Update agent builder to gather diff-reviewer examples plus a new starter template, keep examples under .agents/examples, copy starter into .agents root, and stop advertising spawnable agents.\",\n  \"content\": \"import * as fs from 'fs'\\nimport * as path from 'path'\\n\\nimport { AGENT_TEMPLATES_DIR, AGENT_DEFINITION_FILE } from '@levelcode/common/constants'\\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\\nimport z from 'zod/v4'\\n\\nimport type { AgentTemplate } from '../types'\\nimport type { Model } from '@levelcode/common/constants'\\nimport type { ToolName } from '@levelcode/common/tools/constants'\\n\\nconst COMMON_UTIL_PATH = '../../../../common/src/util'\\nconst TEMPLATE_RELATIVE_PATH =\\n  `${COMMON_UTIL_PATH}/types/${AGENT_DEFINITION_FILE}` as const\\n// Import to validate path exists at compile time\\nimport(TEMPLATE_RELATIVE_PATH)\\n\\nconst TEMPLATE_PATH = path.join(__dirname, TEMPLATE_RELATIVE_PATH)\\nconst TYPES_DIR = path.join(AGENT_TEMPLATES_DIR, 'types')\\nconst EXAMPLES_DIR = path.join(AGENT_TEMPLATES_DIR, 'examples')\\nconst TEMPLATE_TYPES_PATH = path.join(TYPES_DIR, AGENT_DEFINITION_FILE)\\nconst TOOL_DEFINITIONS_FILE = 'tools.d.ts'\\nconst TOOL_DEFINITIONS_PATH = path.join(TYPES_DIR, TOOL_DEFINITIONS_FILE)\\n\\nconst EXAMPLES_SOURCE_DIR = path.join(__dirname, `${COMMON_UTIL_PATH}/examples`)\\nconst STARTER_TEMPLATE_SOURCE_FILE = 'your-custom-agent.ts.txt'\\nconst STARTER_TEMPLATE_DEST_FILE = 'your-custom-agent.ts'\\n\\nexport const agentBuilder = (\\n  model: Model,\\n  _allAvailableAgents?: string[],\\n): Omit<AgentTemplate, 'id'> => {\\n  // Read the AGENT_CONFIG_FILE content dynamically\\n  // The import above ensures this path exists at compile time\\n  let agentTemplateContent = ''\\n  try {\\n    agentTemplateContent = fs.readFileSync(TEMPLATE_PATH, 'utf8')\\n  } catch (error) {\\n    console.warn(`Could not read ${AGENT_DEFINITION_FILE}:`, error)\\n    agentTemplateContent = '// Agent template types not available'\\n  }\\n\\n  // Read the tools.d.ts content from common package\\n  let toolDefinitionsContent = ''\\n  try {\\n    const toolsPath = path.join(\\n      __dirname,\\n      `${COMMON_UTIL_PATH}/types/tools.d.ts`,\\n    )\\n    toolDefinitionsContent = fs.readFileSync(toolsPath, 'utf8')\\n  } catch (error) {\\n    console.warn(`Could not read tools.d.ts from common:`, error)\\n    toolDefinitionsContent = '// Tool definitions not available'\\n  }\\n\\n  // Read example agent files + starter template from common package\\n  const exampleAgentContents: Record<string, string> = {}\\n  let starterTemplateContent = ''\\n\\n  try {\\n    if (fs.existsSync(EXAMPLES_SOURCE_DIR)) {\\n      const files = fs.readdirSync(EXAMPLES_SOURCE_DIR)\\n\\n      files\\n        .filter(\\n          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer-'),\\n        )\\n        .forEach((filename) => {\\n          const fullPath = path.join(EXAMPLES_SOURCE_DIR, filename)\\n          const content = fs.readFileSync(fullPath, 'utf8')\\n          exampleAgentContents[filename] = content\\n        })\\n\\n      const starterTemplatePath = path.join(\\n        EXAMPLES_SOURCE_DIR,\\n        STARTER_TEMPLATE_SOURCE_FILE,\\n      )\\n      if (fs.existsSync(starterTemplatePath)) {\\n        starterTemplateContent = fs.readFileSync(starterTemplatePath, 'utf8')\\n      }\\n    } else {\\n      console.warn(\\n        `Example agents directory does not exist: ${EXAMPLES_SOURCE_DIR}`,\\n      )\\n    }\\n  } catch (error) {\\n    console.warn('Could not read example agents:', error)\\n  }\\n\\n  return {\\n    model,\\n    displayName: 'Bob the Agent Builder',\\n    spawnPurposePrompt:\\n      'Enhanced base agent that can create custom agents and handle all coding tasks with deterministic agent creation behavior',\\n    inputSchema: {\\n      prompt: z\\n        .string()\\n        .optional()\\n        .describe(\\n          'What agent type you would like to create or edit. Include as many details as possible.',\\n        ),\\n      params: z\\n        .object({\\n          name: z.string().optional(),\\n          purpose: z.string().optional(),\\n          specialty: z.string().optional(),\\n          model: z.string().optional(),\\n        })\\n        .passthrough()\\n        .optional(),\\n    },\\n    outputMode: 'structured_output',\\n    includeMessageHistory: false,\\n    toolNames: [\\n      'write_file',\\n      'str_replace',\\n      'run_terminal_command',\\n      'read_files',\\n      'code_search',\\n      'spawn_agents',\\n      'add_message',\\n      'set_output',\\n      'end_turn',\\n    ] satisfies ToolName[],\\n\\n    systemPrompt: [\\n      '# Bob the Agent Builder',\\n      '',\\n      'You are an expert agent builder specialized in creating new agent templates for the levelcode system. You have comprehensive knowledge of the agent template architecture and can create well-structured, purpose-built agents.',\\n      '',\\n      '## Environment Setup Complete',\\n      '',\\n      'Your environment has been automatically prepared with:',\\n      '- Agent template type definitions in `.agents/types/agent-definition.d.ts`',\\n      '- Tool type definitions in `.agents/types/tools.d.ts`',\\n      '- Diff-reviewer examples in `.agents/examples/` for reference',\\n      '- A starter custom agent template at `.agents/your-custom-agent.ts`',\\n      '',\\n      'All necessary files are now available in your working directory.',\\n      '',\\n      '## Complete Agent Template Type Definitions',\\n      '',\\n      'Here are the complete TypeScript type definitions for creating custom LevelCode agents:',\\n      '```typescript',\\n      agentTemplateContent,\\n      '```',\\n      '',\\n      '## Available Tools Type Definitions',\\n      '',\\n      'Here are the complete TypeScript type definitions for all available tools:',\\n      '',\\n      '```typescript',\\n      toolDefinitionsContent,\\n      '```',\\n      '',\\n      '## Agent Template Patterns:',\\n      '',\\n      '1. **Base Agent Pattern**: Full-featured agents with comprehensive tool access',\\n      '2. **Specialized Agent Pattern**: Focused agents with limited tool sets',\\n      '3. **Thinking Agent Pattern**: Agents that spawn thinker sub-agents',\\n      '4. **Research Agent Pattern**: Agents that start with web search',\\n      '',\\n      '## Best Practices:',\\n      '',\\n      '1. **Use as few fields as possible**: Leave out fields that are not needed to reduce complexity',\\n      '2. **Minimal Tools**: Only include tools the agent actually needs',\\n      '3. **Clear and Concise Prompts**: Write clear, specific prompts that have no unnecessary words',\\n      '4. **Consistent Naming**: Follow naming conventions (kebab-case for IDs)',\\n      '5. **Appropriate Model**: Choose the right model for the task complexity. Default is claude-4-sonnet-20250522 for medium-high complexity tasks, and openai/gpt-5 for all other tasks.',\\n      '',\\n      '## Your Task:',\\n      'When asked to create an agent template, you should:',\\n      \\\"1. Understand the requested agent's purpose and capabilities\\\",\\n      \\\"2. Choose appropriate tools for the agent's function\\\",\\n      '3. Write a comprehensive system prompt',\\n      `4. Create the complete agent template file in ${AGENT_TEMPLATES_DIR}`,\\n      '5. Ensure the template follows all conventions and best practices',\\n      '6. Use the AgentDefinition interface for the configuration',\\n      '7. Start the file with: import type { AgentDefinition } from \\\"./types/agent-definition.d.ts\\\"',\\n      '',\\n      'Create agent templates that are focused, efficient, and well-documented. Always import the AgentDefinition type and export a default configuration object.',\\n    ].join('\\\\n'),\\n    instructionsPrompt: `You are helping to create or edit an agent template. The user will describe what kind of agent they want to create or how they want to modify an existing agent.\\n\\n## Environment Ready\\n\\nYour environment has been automatically set up with:\\n- Type definitions in \\\\`.agents/types/\\\\`\\n- Diff-reviewer examples in \\\\`.agents/examples/\\\\`\\n- A starter custom agent template at \\\\`.agents/your-custom-agent.ts\\\\`\\n\\nYou can now proceed directly to agent creation or editing.\\n\\n## Example Agents Available\\n\\nThree diff-reviewer examples are available in \\\\`.agents/examples/\\\\`. These can serve as examples of well-made agents at different stages of complexity.\\n\\n**IMPORTANT**: Examine these examples to find connections and patterns that relate to the user's request. Look for:\\n- Similar tool combinations\\n- Comparable complexity levels\\n- Related functionality patterns\\n- Appropriate model choices\\n- Relevant prompt structures\\n\\nUse these examples as inspiration and starting points, adapting their patterns to fit the user's specific needs.\\n\\n## Starter Template Available\\n\\nA starter custom agent file is available at \\\\`.agents/your-custom-agent.ts\\\\`. You can either modify this file directly or use it as a reference for creating a new agent.\\n\\n## For New Agents\\n\\nAnalyze their request and create a complete agent template that:\\n- Has a clear purpose and appropriate capabilities\\n- Leaves out fields that are not needed\\n- Uses only the tools it needs\\n- Follows naming conventions\\n- Is properly structured\\n- Draws inspiration from relevant example agents\\n\\n## For Creating New Agents\\n\\nThe agent builder is focused on creating new agent templates based on user specifications.\\n\\nIMPORTANT: Always end your response with the end_turn tool when you have completed the agent creation or editing task.`,\\n    stepPrompt: '',\\n\\n    handleSteps: function* () {\\n      // Step 1: Create directory structure\\n      yield {\\n        toolName: 'run_terminal_command',\\n        args: {\\n          command: `mkdir -p ${TYPES_DIR} && mkdir -p ${EXAMPLES_DIR}`,\\n          process_type: 'SYNC',\\n          timeout_seconds: 10,\\n        },\\n      }\\n\\n      // Step 2: Write the AGENT_DEFINITION_FILE with the template content\\n      yield {\\n        toolName: 'write_file',\\n        args: {\\n          path: TEMPLATE_TYPES_PATH,\\n          instructions: 'Create agent template type definitions file',\\n          content: agentTemplateContent,\\n        },\\n      }\\n\\n      // Step 3: Write the tool definitions file (copy from existing tools.d.ts)\\n      yield {\\n        toolName: 'write_file',\\n        args: {\\n          path: TOOL_DEFINITIONS_PATH,\\n          instructions: 'Create tools type file',\\n          content: toolDefinitionsContent,\\n        },\\n      }\\n\\n      // Step 4: Add message about reading example files and then read them\\n      yield {\\n        toolName: 'add_message',\\n        args: {\\n          role: 'assistant',\\n          content:\\n            \\\"I'll review the starter template and diff-reviewer examples, then help you create your agent.\\\",\\n        },\\n      }\\n\\n      // Step 5: Copy example agent files to .agents/examples/\\n      for (const [filename, content] of Object.entries(exampleAgentContents)) {\\n        if (content) {\\n          yield {\\n            toolName: 'write_file',\\n            args: {\\n              path: `${EXAMPLES_DIR}/${filename}`,\\n              instructions: `Copy example agent file ${filename}`,\\n              content: content,\\n            },\\n          }\\n        }\\n      }\\n\\n      // Step 6: Copy starter template directly to .agents/\\n      if (starterTemplateContent) {\\n        yield {\\n          toolName: 'write_file',\\n          args: {\\n            path: `${AGENT_TEMPLATES_DIR}/${STARTER_TEMPLATE_DEST_FILE}`,\\n            instructions: `Copy starter custom agent template ${STARTER_TEMPLATE_DEST_FILE}`,\\n            content: starterTemplateContent,\\n          },\\n        }\\n      }\\n\\n      // Step 7: Complete agent creation process\\n      yield 'STEP_ALL'\\n    },\\n  }\\n}\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"str_replace\",\n  \"path\": \"common/src/constants/agents.ts\",\n  \"replacements\": [\n    {\n      \"old\": \"  dry_run: {\\n    displayName: 'Sketch the Dry Runner',\\n    purpose: 'Agent that takes a plan and try to implement it in a dry run.',\\n    hidden: true,\\n  } as const,\\n\",\n      \"new\": \"\"\n    },\n    {\n      \"old\": \"  agent_builder: {\\n    displayName: 'Bob the Agent Builder',\\n    purpose: 'Creates new agent templates for the levelcode mult-agent system',\\n    hidden: false,\\n  } as const,\\n\",\n      \"new\": \"  agent_builder: {\\n    displayName: 'Bob the Agent Builder',\\n    purpose: 'Creates new agent templates for the levelcode multi-agent system',\\n    hidden: false,\\n  } as const,\\n\"\n    }\n  ]\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \".agents/examples/diff-reviewer-1.ts\",\n  \"instructions\": \"Refresh diff-reviewer-1 example to use current Anthropic model.\",\n  \"content\": \"import type { AgentDefinition } from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-1',\\n\\n  displayName: 'Diff Reviewer (Level 1)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  toolNames: ['read_files', 'run_terminal_command'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  instructionsPrompt: `Execute the following steps:\\n1. Run git diff\\n2. Read the files that have changed\\n3. Review the changes and suggest improvements`,\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \".agents/examples/diff-reviewer-2.ts\",\n  \"instructions\": \"Refresh diff-reviewer-2 example to use current Anthropic model.\",\n  \"content\": \"import type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-2',\\n  displayName: 'Diff Reviewer (Level 2)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description:\\n        'Please provide a short description of the changes you want to review',\\n    },\\n  },\\n  toolNames: ['read_files', 'run_terminal_command'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\\n\\n  instructionsPrompt: `Execute the following steps:\\n1. Run git diff\\n2. Read the files that have changed\\n3. Review the changes and suggest improvements\\n\\nUse the following guidelines while reviewing the changes:\\n- Find ways to simplify the code\\n- Reuse existing code as much as possible instead of writing new code\\n- Preserve as much behavior as possible in the existing code\\n- Prefer changing as few lines of code as possible\\n- Look for opportunities to improve the code's readability\\n- Look for logical errors in the code\\n- Look for missed cases in the code\\n- Look for any other bugs`,\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n      },\\n    }\\n\\n    // Step 2: Let AI run the rest of the steps!\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \".agents/examples/diff-reviewer-3.ts\",\n  \"instructions\": \"Refresh diff-reviewer-3 example to use current Anthropic model, correct file-explorer spawn target, and streamline final step behavior.\",\n  \"content\": \"import type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-3',\\n\\n  displayName: 'Diff Reviewer (Level 3)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description:\\n        'Please provide a short description of the changes you want to review',\\n    },\\n  },\\n  outputMode: 'last_message',\\n\\n  toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\\n  spawnableAgents: ['file-explorer'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\\n\\n  instructionsPrompt: `Review the changes and suggest improvements.\\n\\nUse the following guidelines while reviewing the changes:\\n- Find ways to simplify the code\\n- Reuse existing code as much as possible instead of writing new code\\n- Preserve as much behavior as possible in the existing code\\n- Prefer changing as few lines of code as possible\\n- Look for opportunities to improve the code's readability\\n- Look for logical errors in the code\\n- Look for missed cases in the code\\n- Look for any other bugs`,\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Get list of changed files from git diff --name-only\\n    const { toolResult: gitDiffFilesResult } = yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff --name-only',\\n      },\\n    }\\n\\n    const changedFiles = (gitDiffFilesResult || '')\\n      .split('\\\\n')\\n      .map((line) => line.trim())\\n      .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\\n\\n    // Step 2: Read changed files\\n    if (changedFiles.length > 0) {\\n      yield {\\n        toolName: 'read_files',\\n        args: {\\n          paths: changedFiles,\\n        },\\n      }\\n    }\\n\\n    // Step 3: Run full git diff to see the actual changes\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n      },\\n    }\\n\\n    // Step 4: Spawn file explorer for broader context if needed\\n    yield {\\n      toolName: 'spawn_agents',\\n      args: {\\n        agents: [\\n          {\\n            agent_type: 'file-explorer',\\n            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\\n            params: {\\n              prompts: [\\n                'Any modules/classes/functions referenced by the diff',\\n                'Relevant tests or test helpers for the changed code',\\n                'Related config or shared utilities that might be impacted',\\n              ],\\n            },\\n          },\\n        ],\\n      },\\n    }\\n\\n    // Step 5: Let the AI produce the final review in a single final step\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"common/src/util/examples/diff-reviewer-1.ts\",\n  \"instructions\": \"Refresh common diff-reviewer-1 example to use current Anthropic model.\",\n  \"content\": \"import type { AgentDefinition } from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-1',\\n\\n  displayName: 'Diff Reviewer (Level 1)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  toolNames: ['read_files', 'run_terminal_command'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  instructionsPrompt: `Execute the following steps:\\n1. Run git diff\\n2. Read the files that have changed\\n3. Review the changes and suggest improvements`,\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"common/src/util/examples/diff-reviewer-2.ts\",\n  \"instructions\": \"Refresh common diff-reviewer-2 example to use current Anthropic model.\",\n  \"content\": \"import type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-2',\\n  displayName: 'Diff Reviewer (Level 2)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description:\\n        'Please provide a short description of the changes you want to review',\\n    },\\n  },\\n  toolNames: ['read_files', 'run_terminal_command'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\\n\\n  instructionsPrompt: `Execute the following steps:\\n1. Run git diff\\n2. Read the files that have changed\\n3. Review the changes and suggest improvements\\n\\nUse the following guidelines while reviewing the changes:\\n- Find ways to simplify the code\\n- Reuse existing code as much as possible instead of writing new code\\n- Preserve as much behavior as possible in the existing code\\n- Prefer changing as few lines of code as possible\\n- Look for opportunities to improve the code's readability\\n- Look for logical errors in the code\\n- Look for missed cases in the code\\n- Look for any other bugs`,\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n      },\\n    }\\n\\n    // Step 2: Let AI run the rest of the steps!\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"common/src/util/examples/diff-reviewer-3.ts\",\n  \"instructions\": \"Refresh common diff-reviewer-3 example to use current Anthropic model, correct file-explorer spawn target, and streamline final step behavior.\",\n  \"content\": \"import type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-3',\\n\\n  displayName: 'Diff Reviewer (Level 3)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description:\\n        'Please provide a short description of the changes you want to review',\\n    },\\n  },\\n  outputMode: 'last_message',\\n\\n  toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\\n  spawnableAgents: ['file-explorer'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\\n\\n  instructionsPrompt: `Review the changes and suggest improvements.\\n\\nUse the following guidelines while reviewing the changes:\\n- Find ways to simplify the code\\n- Reuse existing code as much as possible instead of writing new code\\n- Preserve as much behavior as possible in the existing code\\n- Prefer changing as few lines of code as possible\\n- Look for opportunities to improve the code's readability\\n- Look for logical errors in the code\\n- Look for missed cases in the code\\n- Look for any other bugs`,\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Get list of changed files from git diff --name-only\\n    const { toolResult: gitDiffFilesResult } = yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff --name-only',\\n      },\\n    }\\n\\n    const changedFiles = (gitDiffFilesResult || '')\\n      .split('\\\\n')\\n      .map((line) => line.trim())\\n      .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\\n\\n    // Step 2: Read changed files\\n    if (changedFiles.length > 0) {\\n      yield {\\n        toolName: 'read_files',\\n        args: {\\n          paths: changedFiles,\\n        },\\n      }\\n    }\\n\\n    // Step 3: Run full git diff to see the actual changes\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n      },\\n    }\\n\\n    // Step 4: Spawn file explorer for broader context if needed\\n    yield {\\n      toolName: 'spawn_agents',\\n      args: {\\n        agents: [\\n          {\\n            agent_type: 'file-explorer',\\n            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\\n            params: {\\n              prompts: [\\n                'Any modules/classes/functions referenced by the diff',\\n                'Relevant tests or test helpers for the changed code',\\n                'Related config or shared utilities that might be impacted',\\n              ],\\n            },\\n          },\\n        ],\\n      },\\n    }\\n\\n    // Step 5: Let the AI produce the final review in a single final step\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \".agents/your-custom-agent.ts\",\n  \"instructions\": \"Add a new starter custom agent (Git Committer scaffold) in the top-level .agents directory, ready to run and publish.\",\n  \"content\": \"import { publisher, version } from './constants'\\n\\nimport type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from './types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'your-custom-agent',\\n  version,\\n  publisher,\\n\\n  displayName: 'Your Custom Agent (Git Committer)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\\n\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description: 'What changes to commit',\\n    },\\n  },\\n\\n  includeMessageHistory: false,\\n  outputMode: 'last_message',\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\\n\\n  instructionsPrompt:\\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Analyze the changes\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n        process_type: 'SYNC',\\n        timeout_seconds: 30,\\n      },\\n    }\\n\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git log --oneline -10',\\n        process_type: 'SYNC',\\n        timeout_seconds: 30,\\n      },\\n    }\\n\\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\\n    yield {\\n      toolName: 'add_message',\\n      args: {\\n        role: 'assistant',\\n        content: `Goal: ${prompt}\\\\n\\\\nI'll read any relevant files and stage the right changes next.`,\\n      },\\n    }\\n\\n    yield 'STEP'\\n\\n    // Step 3: Let the AI create the commit with proper formatting\\n    yield {\\n      toolName: 'add_message',\\n      args: {\\n        role: 'assistant',\\n        content:\\n          \\\"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\\\",\\n      },\\n    }\\n\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"common/src/util/examples/your-custom-agent.ts.txt\",\n  \"instructions\": \"Add starter custom agent template content for the agent builder to copy into .agents/your-custom-agent.ts.\",\n  \"content\": \"import { publisher, version } from './constants'\\n\\nimport type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from './types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'your-custom-agent',\\n  version,\\n  publisher,\\n\\n  displayName: 'Your Custom Agent (Git Committer)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\\n\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description: 'What changes to commit',\\n    },\\n  },\\n\\n  includeMessageHistory: false,\\n  outputMode: 'last_message',\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\\n\\n  instructionsPrompt:\\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Analyze the changes\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n        process_type: 'SYNC',\\n        timeout_seconds: 30,\\n      },\\n    }\\n\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git log --oneline -10',\\n        process_type: 'SYNC',\\n        timeout_seconds: 30,\\n      },\\n    }\\n\\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\\n    yield {\\n      toolName: 'add_message',\\n      args: {\\n        role: 'assistant',\\n        content: `Goal: ${prompt}\\\\n\\\\nI'll read any relevant files and stage the right changes next.`,\\n      },\\n    }\\n\\n    yield 'STEP'\\n\\n    // Step 3: Let the AI create the commit with proper formatting\\n    yield {\\n      toolName: 'add_message',\\n      args: {\\n        role: 'assistant',\\n        content:\\n          \\\"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\\\",\\n      },\\n    }\\n\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>",
          "toolResults": [
            {
              "file": "backend/src/templates/agents/agent-builder.ts",
              "message": "Updated file",
              "unifiedDiff": "@@ -1,12 +1,8 @@\n import * as fs from 'fs'\n import * as path from 'path'\n \n-import {\n-  AGENT_TEMPLATES_DIR,\n-  openrouterModels,\n-  AGENT_DEFINITION_FILE,\n-} from '@levelcode/common/constants'\n+import { AGENT_TEMPLATES_DIR, AGENT_DEFINITION_FILE } from '@levelcode/common/constants'\n import { AgentTemplateTypes } from '@levelcode/common/types/session-state'\n import z from 'zod/v4'\n \n import type { AgentTemplate } from '../types'\n@@ -19,9 +15,8 @@\n // Import to validate path exists at compile time\n import(TEMPLATE_RELATIVE_PATH)\n \n const TEMPLATE_PATH = path.join(__dirname, TEMPLATE_RELATIVE_PATH)\n-const DEFAULT_MODEL = openrouterModels.openrouter_claude_sonnet_4\n const TYPES_DIR = path.join(AGENT_TEMPLATES_DIR, 'types')\n const EXAMPLES_DIR = path.join(AGENT_TEMPLATES_DIR, 'examples')\n const TEMPLATE_TYPES_PATH = path.join(TYPES_DIR, AGENT_DEFINITION_FILE)\n const TOOL_DEFINITIONS_FILE = 'tools.d.ts'\n@@ -32,9 +27,9 @@\n const STARTER_TEMPLATE_DEST_FILE = 'your-custom-agent.ts'\n \n export const agentBuilder = (\n   model: Model,\n-  allAvailableAgents?: string[],\n+  _allAvailableAgents?: string[],\n ): Omit<AgentTemplate, 'id'> => {\n   // Read the AGENT_CONFIG_FILE content dynamically\n   // The import above ensures this path exists at compile time\n   let agentTemplateContent = ''\n@@ -57,9 +52,9 @@\n     console.warn(`Could not read tools.d.ts from common:`, error)\n     toolDefinitionsContent = '// Tool definitions not available'\n   }\n \n-  // Read example agent files from common package\n+  // Read example agent files + starter template from common package\n   const exampleAgentContents: Record<string, string> = {}\n   let starterTemplateContent = ''\n \n   try {\n@@ -229,9 +224,9 @@\n \n IMPORTANT: Always end your response with the end_turn tool when you have completed the agent creation or editing task.`,\n     stepPrompt: '',\n \n-    handleSteps: function* ({ agentState, prompt, params }) {\n+    handleSteps: function* () {\n       // Step 1: Create directory structure\n       yield {\n         toolName: 'run_terminal_command',\n         args: {\n"
            },
            {
              "file": "common/src/constants/agents.ts",
              "message": "Updated file",
              "unifiedDiff": "@@ -64,21 +64,16 @@\n     displayName: 'Peter Plan the Planner',\n     purpose: 'Agent that formulates a comprehensive plan to a prompt.',\n     hidden: true,\n   } as const,\n-  dry_run: {\n-    displayName: 'Sketch the Dry Runner',\n-    purpose: 'Agent that takes a plan and try to implement it in a dry run.',\n-    hidden: true,\n-  } as const,\n   reviewer: {\n     displayName: 'Nit Pick Nick the Reviewer',\n     purpose:\n       'Reviews file changes and responds with critical feedback. Use this after making any significant change to the codebase.',\n   } as const,\n   agent_builder: {\n     displayName: 'Bob the Agent Builder',\n-    purpose: 'Creates new agent templates for the levelcode mult-agent system',\n+    purpose: 'Creates new agent templates for the levelcode multi-agent system',\n     hidden: false,\n   } as const,\n } as const satisfies Partial<\n   Record<\n"
            },
            {
              "file": ".agents/examples/diff-reviewer-1.ts",
              "message": "Updated file",
              "unifiedDiff": "@@ -3,9 +3,9 @@\n const definition: AgentDefinition = {\n   id: 'diff-reviewer-1',\n \n   displayName: 'Diff Reviewer (Level 1)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n   toolNames: ['read_files', 'run_terminal_command'],\n \n   spawnPurposePrompt:\n     'Spawn when you need to review code changes in the git diff',\n"
            },
            {
              "file": ".agents/examples/diff-reviewer-2.ts",
              "message": "Updated file",
              "unifiedDiff": "@@ -5,9 +5,9 @@\n \n const definition: AgentDefinition = {\n   id: 'diff-reviewer-2',\n   displayName: 'Diff Reviewer (Level 2)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n \n   inputSchema: {\n     prompt: {\n       type: 'string',\n@@ -37,9 +37,9 @@\n - Look for logical errors in the code\n - Look for missed cases in the code\n - Look for any other bugs`,\n \n-  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n+  handleSteps: function* ({ prompt }: AgentStepContext) {\n     // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\n     yield {\n       toolName: 'run_terminal_command',\n       args: {\n"
            },
            {
              "file": ".agents/examples/diff-reviewer-3.ts",
              "message": "Updated file",
              "unifiedDiff": "@@ -6,9 +6,9 @@\n const definition: AgentDefinition = {\n   id: 'diff-reviewer-3',\n \n   displayName: 'Diff Reviewer (Level 3)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n   inputSchema: {\n     prompt: {\n       type: 'string',\n       description:\n@@ -17,9 +17,9 @@\n   },\n   outputMode: 'last_message',\n \n   toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\n-  spawnableAgents: ['james/file-explorer@0.1.3'],\n+  spawnableAgents: ['file-explorer'],\n \n   spawnPurposePrompt:\n     'Spawn when you need to review code changes in the git diff',\n \n@@ -37,24 +37,23 @@\n - Look for logical errors in the code\n - Look for missed cases in the code\n - Look for any other bugs`,\n \n-  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n+  handleSteps: function* ({ prompt }: AgentStepContext) {\n     // Step 1: Get list of changed files from git diff --name-only\n     const { toolResult: gitDiffFilesResult } = yield {\n       toolName: 'run_terminal_command',\n       args: {\n         command: 'git diff --name-only',\n       },\n     }\n \n-    // Then, extract file paths from the result\n     const changedFiles = (gitDiffFilesResult || '')\n       .split('\\n')\n       .map((line) => line.trim())\n       .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\n \n-    // Step 2: Read the files\n+    // Step 2: Read changed files\n     if (changedFiles.length > 0) {\n       yield {\n         toolName: 'read_files',\n         args: {\n@@ -70,31 +69,30 @@\n         command: 'git diff',\n       },\n     }\n \n-    // Step 4: Put words in the AI's mouth to get it to spawn the file explorer.\n+    // Step 4: Spawn file explorer for broader context if needed\n     yield {\n-      toolName: 'add_message',\n+      toolName: 'spawn_agents',\n       args: {\n-        role: 'assistant',\n-        content:\n-          'Now I will spawn a file explorer to find any missing codebase context.',\n+        agents: [\n+          {\n+            agent_type: 'file-explorer',\n+            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\n+            params: {\n+              prompts: [\n+                'Any modules/classes/functions referenced by the diff',\n+                'Relevant tests or test helpers for the changed code',\n+                'Related config or shared utilities that might be impacted',\n+              ],\n+            },\n+          },\n+        ],\n       },\n     }\n \n-    yield 'STEP'\n-\n-    // Step 5: Put words in the AI's mouth to review the changes.\n-    yield {\n-      toolName: 'add_message',\n-      args: {\n-        role: 'assistant',\n-        content: 'Here is my comprehensive review of the changes.',\n-      },\n-    }\n-\n-    // Step 6: Let AI review the changes in a final step. (The last message is also the agent's output.)\n-    yield 'STEP'\n+    // Step 5: Let the AI produce the final review in a single final step\n+    yield 'STEP_ALL'\n   },\n }\n \n export default definition\n"
            },
            {
              "file": "common/src/util/examples/diff-reviewer-1.ts",
              "message": "Updated file",
              "unifiedDiff": "@@ -3,9 +3,9 @@\n const definition: AgentDefinition = {\n   id: 'diff-reviewer-1',\n \n   displayName: 'Diff Reviewer (Level 1)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n   toolNames: ['read_files', 'run_terminal_command'],\n \n   spawnPurposePrompt:\n     'Spawn when you need to review code changes in the git diff',\n"
            },
            {
              "file": "common/src/util/examples/diff-reviewer-2.ts",
              "message": "Updated file",
              "unifiedDiff": "@@ -5,9 +5,9 @@\n \n const definition: AgentDefinition = {\n   id: 'diff-reviewer-2',\n   displayName: 'Diff Reviewer (Level 2)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n \n   inputSchema: {\n     prompt: {\n       type: 'string',\n@@ -37,9 +37,9 @@\n - Look for logical errors in the code\n - Look for missed cases in the code\n - Look for any other bugs`,\n \n-  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n+  handleSteps: function* ({ prompt }: AgentStepContext) {\n     // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\n     yield {\n       toolName: 'run_terminal_command',\n       args: {\n"
            },
            {
              "file": "common/src/util/examples/diff-reviewer-3.ts",
              "message": "Updated file",
              "unifiedDiff": "@@ -6,9 +6,9 @@\n const definition: AgentDefinition = {\n   id: 'diff-reviewer-3',\n \n   displayName: 'Diff Reviewer (Level 3)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n   inputSchema: {\n     prompt: {\n       type: 'string',\n       description:\n@@ -17,9 +17,9 @@\n   },\n   outputMode: 'last_message',\n \n   toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\n-  spawnableAgents: ['james/file-explorer@0.1.3'],\n+  spawnableAgents: ['file-explorer'],\n \n   spawnPurposePrompt:\n     'Spawn when you need to review code changes in the git diff',\n \n@@ -37,24 +37,23 @@\n - Look for logical errors in the code\n - Look for missed cases in the code\n - Look for any other bugs`,\n \n-  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n+  handleSteps: function* ({ prompt }: AgentStepContext) {\n     // Step 1: Get list of changed files from git diff --name-only\n     const { toolResult: gitDiffFilesResult } = yield {\n       toolName: 'run_terminal_command',\n       args: {\n         command: 'git diff --name-only',\n       },\n     }\n \n-    // Then, extract file paths from the result\n     const changedFiles = (gitDiffFilesResult || '')\n       .split('\\n')\n       .map((line) => line.trim())\n       .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\n \n-    // Step 2: Read the files\n+    // Step 2: Read changed files\n     if (changedFiles.length > 0) {\n       yield {\n         toolName: 'read_files',\n         args: {\n@@ -70,31 +69,30 @@\n         command: 'git diff',\n       },\n     }\n \n-    // Step 4: Put words in the AI's mouth to get it to spawn the file explorer.\n+    // Step 4: Spawn file explorer for broader context if needed\n     yield {\n-      toolName: 'add_message',\n+      toolName: 'spawn_agents',\n       args: {\n-        role: 'assistant',\n-        content:\n-          'Now I will spawn a file explorer to find any missing codebase context.',\n+        agents: [\n+          {\n+            agent_type: 'file-explorer',\n+            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\n+            params: {\n+              prompts: [\n+                'Any modules/classes/functions referenced by the diff',\n+                'Relevant tests or test helpers for the changed code',\n+                'Related config or shared utilities that might be impacted',\n+              ],\n+            },\n+          },\n+        ],\n       },\n     }\n \n-    yield 'STEP'\n-\n-    // Step 5: Put words in the AI's mouth to review the changes.\n-    yield {\n-      toolName: 'add_message',\n-      args: {\n-        role: 'assistant',\n-        content: 'Here is my comprehensive review of the changes.',\n-      },\n-    }\n-\n-    // Step 6: Let AI review the changes in a final step. (The last message is also the agent's output.)\n-    yield 'STEP'\n+    // Step 5: Let the AI produce the final review in a single final step\n+    yield 'STEP_ALL'\n   },\n }\n \n export default definition\n"
            },
            {
              "file": ".agents/your-custom-agent.ts",
              "message": "Created new file",
              "unifiedDiff": "import { publisher, version } from './constants'\n\nimport type {\n  AgentDefinition,\n  AgentStepContext,\n} from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'your-custom-agent',\n  version,\n  publisher,\n\n  displayName: 'Your Custom Agent (Git Committer)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description: 'What changes to commit',\n    },\n  },\n\n  includeMessageHistory: false,\n  outputMode: 'last_message',\n\n  spawnPurposePrompt:\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\n\n  instructionsPrompt:\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\n\n  handleSteps: function* ({ prompt }: AgentStepContext) {\n    // Step 1: Analyze the changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git log --oneline -10',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content: `Goal: ${prompt}\\n\\nI'll read any relevant files and stage the right changes next.`,\n      },\n    }\n\n    yield 'STEP'\n\n    // Step 3: Let the AI create the commit with proper formatting\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          \"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\",\n      },\n    }\n\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n"
            },
            {
              "file": "common/src/util/examples/your-custom-agent.ts.txt",
              "message": "Created new file",
              "unifiedDiff": "import { publisher, version } from './constants'\n\nimport type {\n  AgentDefinition,\n  AgentStepContext,\n} from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'your-custom-agent',\n  version,\n  publisher,\n\n  displayName: 'Your Custom Agent (Git Committer)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description: 'What changes to commit',\n    },\n  },\n\n  includeMessageHistory: false,\n  outputMode: 'last_message',\n\n  spawnPurposePrompt:\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\n\n  instructionsPrompt:\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\n\n  handleSteps: function* ({ prompt }: AgentStepContext) {\n    // Step 1: Analyze the changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git log --oneline -10',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content: `Goal: ${prompt}\\n\\nI'll read any relevant files and stage the right changes next.`,\n      },\n    }\n\n    yield 'STEP'\n\n    // Step 3: Let the AI create the commit with proper formatting\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          \"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\",\n      },\n    }\n\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n"
            }
          ]
        }
      },
      "agentId": "D-oY2QIts4E",
      "parentAgentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "9cacab6f-eccb-4681-98bd-9855db807bb5",
      "toolName": "set_output",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Output set"
          }
        }
      ],
      "parentAgentId": "D-oY2QIts4E"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-oY2QIts4E",
      "agentType": "editor-gpt-5",
      "displayName": "Code Editor",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": ""
    },
    {
      "type": "tool_result",
      "toolCallId": "D-oWnvQd5aA",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Code Editor",
              "agentType": "editor-gpt-5",
              "value": {
                "type": "structuredOutput",
                "value": {
                  "output": {
                    "message": "<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"backend/src/templates/agents/agent-builder.ts\",\n  \"instructions\": \"Update agent builder to gather diff-reviewer examples plus a new starter template, keep examples under .agents/examples, copy starter into .agents root, and stop advertising spawnable agents.\",\n  \"content\": \"import * as fs from 'fs'\\nimport * as path from 'path'\\n\\nimport { AGENT_TEMPLATES_DIR, AGENT_DEFINITION_FILE } from '@levelcode/common/constants'\\nimport { AgentTemplateTypes } from '@levelcode/common/types/session-state'\\nimport z from 'zod/v4'\\n\\nimport type { AgentTemplate } from '../types'\\nimport type { Model } from '@levelcode/common/constants'\\nimport type { ToolName } from '@levelcode/common/tools/constants'\\n\\nconst COMMON_UTIL_PATH = '../../../../common/src/util'\\nconst TEMPLATE_RELATIVE_PATH =\\n  `${COMMON_UTIL_PATH}/types/${AGENT_DEFINITION_FILE}` as const\\n// Import to validate path exists at compile time\\nimport(TEMPLATE_RELATIVE_PATH)\\n\\nconst TEMPLATE_PATH = path.join(__dirname, TEMPLATE_RELATIVE_PATH)\\nconst TYPES_DIR = path.join(AGENT_TEMPLATES_DIR, 'types')\\nconst EXAMPLES_DIR = path.join(AGENT_TEMPLATES_DIR, 'examples')\\nconst TEMPLATE_TYPES_PATH = path.join(TYPES_DIR, AGENT_DEFINITION_FILE)\\nconst TOOL_DEFINITIONS_FILE = 'tools.d.ts'\\nconst TOOL_DEFINITIONS_PATH = path.join(TYPES_DIR, TOOL_DEFINITIONS_FILE)\\n\\nconst EXAMPLES_SOURCE_DIR = path.join(__dirname, `${COMMON_UTIL_PATH}/examples`)\\nconst STARTER_TEMPLATE_SOURCE_FILE = 'your-custom-agent.ts.txt'\\nconst STARTER_TEMPLATE_DEST_FILE = 'your-custom-agent.ts'\\n\\nexport const agentBuilder = (\\n  model: Model,\\n  _allAvailableAgents?: string[],\\n): Omit<AgentTemplate, 'id'> => {\\n  // Read the AGENT_CONFIG_FILE content dynamically\\n  // The import above ensures this path exists at compile time\\n  let agentTemplateContent = ''\\n  try {\\n    agentTemplateContent = fs.readFileSync(TEMPLATE_PATH, 'utf8')\\n  } catch (error) {\\n    console.warn(`Could not read ${AGENT_DEFINITION_FILE}:`, error)\\n    agentTemplateContent = '// Agent template types not available'\\n  }\\n\\n  // Read the tools.d.ts content from common package\\n  let toolDefinitionsContent = ''\\n  try {\\n    const toolsPath = path.join(\\n      __dirname,\\n      `${COMMON_UTIL_PATH}/types/tools.d.ts`,\\n    )\\n    toolDefinitionsContent = fs.readFileSync(toolsPath, 'utf8')\\n  } catch (error) {\\n    console.warn(`Could not read tools.d.ts from common:`, error)\\n    toolDefinitionsContent = '// Tool definitions not available'\\n  }\\n\\n  // Read example agent files + starter template from common package\\n  const exampleAgentContents: Record<string, string> = {}\\n  let starterTemplateContent = ''\\n\\n  try {\\n    if (fs.existsSync(EXAMPLES_SOURCE_DIR)) {\\n      const files = fs.readdirSync(EXAMPLES_SOURCE_DIR)\\n\\n      files\\n        .filter(\\n          (file) => file.endsWith('.ts') && file.startsWith('diff-reviewer-'),\\n        )\\n        .forEach((filename) => {\\n          const fullPath = path.join(EXAMPLES_SOURCE_DIR, filename)\\n          const content = fs.readFileSync(fullPath, 'utf8')\\n          exampleAgentContents[filename] = content\\n        })\\n\\n      const starterTemplatePath = path.join(\\n        EXAMPLES_SOURCE_DIR,\\n        STARTER_TEMPLATE_SOURCE_FILE,\\n      )\\n      if (fs.existsSync(starterTemplatePath)) {\\n        starterTemplateContent = fs.readFileSync(starterTemplatePath, 'utf8')\\n      }\\n    } else {\\n      console.warn(\\n        `Example agents directory does not exist: ${EXAMPLES_SOURCE_DIR}`,\\n      )\\n    }\\n  } catch (error) {\\n    console.warn('Could not read example agents:', error)\\n  }\\n\\n  return {\\n    model,\\n    displayName: 'Bob the Agent Builder',\\n    spawnPurposePrompt:\\n      'Enhanced base agent that can create custom agents and handle all coding tasks with deterministic agent creation behavior',\\n    inputSchema: {\\n      prompt: z\\n        .string()\\n        .optional()\\n        .describe(\\n          'What agent type you would like to create or edit. Include as many details as possible.',\\n        ),\\n      params: z\\n        .object({\\n          name: z.string().optional(),\\n          purpose: z.string().optional(),\\n          specialty: z.string().optional(),\\n          model: z.string().optional(),\\n        })\\n        .passthrough()\\n        .optional(),\\n    },\\n    outputMode: 'structured_output',\\n    includeMessageHistory: false,\\n    toolNames: [\\n      'write_file',\\n      'str_replace',\\n      'run_terminal_command',\\n      'read_files',\\n      'code_search',\\n      'spawn_agents',\\n      'add_message',\\n      'set_output',\\n      'end_turn',\\n    ] satisfies ToolName[],\\n\\n    systemPrompt: [\\n      '# Bob the Agent Builder',\\n      '',\\n      'You are an expert agent builder specialized in creating new agent templates for the levelcode system. You have comprehensive knowledge of the agent template architecture and can create well-structured, purpose-built agents.',\\n      '',\\n      '## Environment Setup Complete',\\n      '',\\n      'Your environment has been automatically prepared with:',\\n      '- Agent template type definitions in `.agents/types/agent-definition.d.ts`',\\n      '- Tool type definitions in `.agents/types/tools.d.ts`',\\n      '- Diff-reviewer examples in `.agents/examples/` for reference',\\n      '- A starter custom agent template at `.agents/your-custom-agent.ts`',\\n      '',\\n      'All necessary files are now available in your working directory.',\\n      '',\\n      '## Complete Agent Template Type Definitions',\\n      '',\\n      'Here are the complete TypeScript type definitions for creating custom LevelCode agents:',\\n      '```typescript',\\n      agentTemplateContent,\\n      '```',\\n      '',\\n      '## Available Tools Type Definitions',\\n      '',\\n      'Here are the complete TypeScript type definitions for all available tools:',\\n      '',\\n      '```typescript',\\n      toolDefinitionsContent,\\n      '```',\\n      '',\\n      '## Agent Template Patterns:',\\n      '',\\n      '1. **Base Agent Pattern**: Full-featured agents with comprehensive tool access',\\n      '2. **Specialized Agent Pattern**: Focused agents with limited tool sets',\\n      '3. **Thinking Agent Pattern**: Agents that spawn thinker sub-agents',\\n      '4. **Research Agent Pattern**: Agents that start with web search',\\n      '',\\n      '## Best Practices:',\\n      '',\\n      '1. **Use as few fields as possible**: Leave out fields that are not needed to reduce complexity',\\n      '2. **Minimal Tools**: Only include tools the agent actually needs',\\n      '3. **Clear and Concise Prompts**: Write clear, specific prompts that have no unnecessary words',\\n      '4. **Consistent Naming**: Follow naming conventions (kebab-case for IDs)',\\n      '5. **Appropriate Model**: Choose the right model for the task complexity. Default is claude-4-sonnet-20250522 for medium-high complexity tasks, and openai/gpt-5 for all other tasks.',\\n      '',\\n      '## Your Task:',\\n      'When asked to create an agent template, you should:',\\n      \\\"1. Understand the requested agent's purpose and capabilities\\\",\\n      \\\"2. Choose appropriate tools for the agent's function\\\",\\n      '3. Write a comprehensive system prompt',\\n      `4. Create the complete agent template file in ${AGENT_TEMPLATES_DIR}`,\\n      '5. Ensure the template follows all conventions and best practices',\\n      '6. Use the AgentDefinition interface for the configuration',\\n      '7. Start the file with: import type { AgentDefinition } from \\\"./types/agent-definition.d.ts\\\"',\\n      '',\\n      'Create agent templates that are focused, efficient, and well-documented. Always import the AgentDefinition type and export a default configuration object.',\\n    ].join('\\\\n'),\\n    instructionsPrompt: `You are helping to create or edit an agent template. The user will describe what kind of agent they want to create or how they want to modify an existing agent.\\n\\n## Environment Ready\\n\\nYour environment has been automatically set up with:\\n- Type definitions in \\\\`.agents/types/\\\\`\\n- Diff-reviewer examples in \\\\`.agents/examples/\\\\`\\n- A starter custom agent template at \\\\`.agents/your-custom-agent.ts\\\\`\\n\\nYou can now proceed directly to agent creation or editing.\\n\\n## Example Agents Available\\n\\nThree diff-reviewer examples are available in \\\\`.agents/examples/\\\\`. These can serve as examples of well-made agents at different stages of complexity.\\n\\n**IMPORTANT**: Examine these examples to find connections and patterns that relate to the user's request. Look for:\\n- Similar tool combinations\\n- Comparable complexity levels\\n- Related functionality patterns\\n- Appropriate model choices\\n- Relevant prompt structures\\n\\nUse these examples as inspiration and starting points, adapting their patterns to fit the user's specific needs.\\n\\n## Starter Template Available\\n\\nA starter custom agent file is available at \\\\`.agents/your-custom-agent.ts\\\\`. You can either modify this file directly or use it as a reference for creating a new agent.\\n\\n## For New Agents\\n\\nAnalyze their request and create a complete agent template that:\\n- Has a clear purpose and appropriate capabilities\\n- Leaves out fields that are not needed\\n- Uses only the tools it needs\\n- Follows naming conventions\\n- Is properly structured\\n- Draws inspiration from relevant example agents\\n\\n## For Creating New Agents\\n\\nThe agent builder is focused on creating new agent templates based on user specifications.\\n\\nIMPORTANT: Always end your response with the end_turn tool when you have completed the agent creation or editing task.`,\\n    stepPrompt: '',\\n\\n    handleSteps: function* () {\\n      // Step 1: Create directory structure\\n      yield {\\n        toolName: 'run_terminal_command',\\n        args: {\\n          command: `mkdir -p ${TYPES_DIR} && mkdir -p ${EXAMPLES_DIR}`,\\n          process_type: 'SYNC',\\n          timeout_seconds: 10,\\n        },\\n      }\\n\\n      // Step 2: Write the AGENT_DEFINITION_FILE with the template content\\n      yield {\\n        toolName: 'write_file',\\n        args: {\\n          path: TEMPLATE_TYPES_PATH,\\n          instructions: 'Create agent template type definitions file',\\n          content: agentTemplateContent,\\n        },\\n      }\\n\\n      // Step 3: Write the tool definitions file (copy from existing tools.d.ts)\\n      yield {\\n        toolName: 'write_file',\\n        args: {\\n          path: TOOL_DEFINITIONS_PATH,\\n          instructions: 'Create tools type file',\\n          content: toolDefinitionsContent,\\n        },\\n      }\\n\\n      // Step 4: Add message about reading example files and then read them\\n      yield {\\n        toolName: 'add_message',\\n        args: {\\n          role: 'assistant',\\n          content:\\n            \\\"I'll review the starter template and diff-reviewer examples, then help you create your agent.\\\",\\n        },\\n      }\\n\\n      // Step 5: Copy example agent files to .agents/examples/\\n      for (const [filename, content] of Object.entries(exampleAgentContents)) {\\n        if (content) {\\n          yield {\\n            toolName: 'write_file',\\n            args: {\\n              path: `${EXAMPLES_DIR}/${filename}`,\\n              instructions: `Copy example agent file ${filename}`,\\n              content: content,\\n            },\\n          }\\n        }\\n      }\\n\\n      // Step 6: Copy starter template directly to .agents/\\n      if (starterTemplateContent) {\\n        yield {\\n          toolName: 'write_file',\\n          args: {\\n            path: `${AGENT_TEMPLATES_DIR}/${STARTER_TEMPLATE_DEST_FILE}`,\\n            instructions: `Copy starter custom agent template ${STARTER_TEMPLATE_DEST_FILE}`,\\n            content: starterTemplateContent,\\n          },\\n        }\\n      }\\n\\n      // Step 7: Complete agent creation process\\n      yield 'STEP_ALL'\\n    },\\n  }\\n}\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"str_replace\",\n  \"path\": \"common/src/constants/agents.ts\",\n  \"replacements\": [\n    {\n      \"old\": \"  dry_run: {\\n    displayName: 'Sketch the Dry Runner',\\n    purpose: 'Agent that takes a plan and try to implement it in a dry run.',\\n    hidden: true,\\n  } as const,\\n\",\n      \"new\": \"\"\n    },\n    {\n      \"old\": \"  agent_builder: {\\n    displayName: 'Bob the Agent Builder',\\n    purpose: 'Creates new agent templates for the levelcode mult-agent system',\\n    hidden: false,\\n  } as const,\\n\",\n      \"new\": \"  agent_builder: {\\n    displayName: 'Bob the Agent Builder',\\n    purpose: 'Creates new agent templates for the levelcode multi-agent system',\\n    hidden: false,\\n  } as const,\\n\"\n    }\n  ]\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \".agents/examples/diff-reviewer-1.ts\",\n  \"instructions\": \"Refresh diff-reviewer-1 example to use current Anthropic model.\",\n  \"content\": \"import type { AgentDefinition } from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-1',\\n\\n  displayName: 'Diff Reviewer (Level 1)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  toolNames: ['read_files', 'run_terminal_command'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  instructionsPrompt: `Execute the following steps:\\n1. Run git diff\\n2. Read the files that have changed\\n3. Review the changes and suggest improvements`,\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \".agents/examples/diff-reviewer-2.ts\",\n  \"instructions\": \"Refresh diff-reviewer-2 example to use current Anthropic model.\",\n  \"content\": \"import type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-2',\\n  displayName: 'Diff Reviewer (Level 2)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description:\\n        'Please provide a short description of the changes you want to review',\\n    },\\n  },\\n  toolNames: ['read_files', 'run_terminal_command'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\\n\\n  instructionsPrompt: `Execute the following steps:\\n1. Run git diff\\n2. Read the files that have changed\\n3. Review the changes and suggest improvements\\n\\nUse the following guidelines while reviewing the changes:\\n- Find ways to simplify the code\\n- Reuse existing code as much as possible instead of writing new code\\n- Preserve as much behavior as possible in the existing code\\n- Prefer changing as few lines of code as possible\\n- Look for opportunities to improve the code's readability\\n- Look for logical errors in the code\\n- Look for missed cases in the code\\n- Look for any other bugs`,\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n      },\\n    }\\n\\n    // Step 2: Let AI run the rest of the steps!\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \".agents/examples/diff-reviewer-3.ts\",\n  \"instructions\": \"Refresh diff-reviewer-3 example to use current Anthropic model, correct file-explorer spawn target, and streamline final step behavior.\",\n  \"content\": \"import type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-3',\\n\\n  displayName: 'Diff Reviewer (Level 3)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description:\\n        'Please provide a short description of the changes you want to review',\\n    },\\n  },\\n  outputMode: 'last_message',\\n\\n  toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\\n  spawnableAgents: ['file-explorer'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\\n\\n  instructionsPrompt: `Review the changes and suggest improvements.\\n\\nUse the following guidelines while reviewing the changes:\\n- Find ways to simplify the code\\n- Reuse existing code as much as possible instead of writing new code\\n- Preserve as much behavior as possible in the existing code\\n- Prefer changing as few lines of code as possible\\n- Look for opportunities to improve the code's readability\\n- Look for logical errors in the code\\n- Look for missed cases in the code\\n- Look for any other bugs`,\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Get list of changed files from git diff --name-only\\n    const { toolResult: gitDiffFilesResult } = yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff --name-only',\\n      },\\n    }\\n\\n    const changedFiles = (gitDiffFilesResult || '')\\n      .split('\\\\n')\\n      .map((line) => line.trim())\\n      .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\\n\\n    // Step 2: Read changed files\\n    if (changedFiles.length > 0) {\\n      yield {\\n        toolName: 'read_files',\\n        args: {\\n          paths: changedFiles,\\n        },\\n      }\\n    }\\n\\n    // Step 3: Run full git diff to see the actual changes\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n      },\\n    }\\n\\n    // Step 4: Spawn file explorer for broader context if needed\\n    yield {\\n      toolName: 'spawn_agents',\\n      args: {\\n        agents: [\\n          {\\n            agent_type: 'file-explorer',\\n            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\\n            params: {\\n              prompts: [\\n                'Any modules/classes/functions referenced by the diff',\\n                'Relevant tests or test helpers for the changed code',\\n                'Related config or shared utilities that might be impacted',\\n              ],\\n            },\\n          },\\n        ],\\n      },\\n    }\\n\\n    // Step 5: Let the AI produce the final review in a single final step\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"common/src/util/examples/diff-reviewer-1.ts\",\n  \"instructions\": \"Refresh common diff-reviewer-1 example to use current Anthropic model.\",\n  \"content\": \"import type { AgentDefinition } from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-1',\\n\\n  displayName: 'Diff Reviewer (Level 1)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  toolNames: ['read_files', 'run_terminal_command'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  instructionsPrompt: `Execute the following steps:\\n1. Run git diff\\n2. Read the files that have changed\\n3. Review the changes and suggest improvements`,\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"common/src/util/examples/diff-reviewer-2.ts\",\n  \"instructions\": \"Refresh common diff-reviewer-2 example to use current Anthropic model.\",\n  \"content\": \"import type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-2',\\n  displayName: 'Diff Reviewer (Level 2)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description:\\n        'Please provide a short description of the changes you want to review',\\n    },\\n  },\\n  toolNames: ['read_files', 'run_terminal_command'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\\n\\n  instructionsPrompt: `Execute the following steps:\\n1. Run git diff\\n2. Read the files that have changed\\n3. Review the changes and suggest improvements\\n\\nUse the following guidelines while reviewing the changes:\\n- Find ways to simplify the code\\n- Reuse existing code as much as possible instead of writing new code\\n- Preserve as much behavior as possible in the existing code\\n- Prefer changing as few lines of code as possible\\n- Look for opportunities to improve the code's readability\\n- Look for logical errors in the code\\n- Look for missed cases in the code\\n- Look for any other bugs`,\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n      },\\n    }\\n\\n    // Step 2: Let AI run the rest of the steps!\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"common/src/util/examples/diff-reviewer-3.ts\",\n  \"instructions\": \"Refresh common diff-reviewer-3 example to use current Anthropic model, correct file-explorer spawn target, and streamline final step behavior.\",\n  \"content\": \"import type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from '../types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'diff-reviewer-3',\\n\\n  displayName: 'Diff Reviewer (Level 3)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description:\\n        'Please provide a short description of the changes you want to review',\\n    },\\n  },\\n  outputMode: 'last_message',\\n\\n  toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\\n  spawnableAgents: ['file-explorer'],\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to review code changes in the git diff',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to review code changes and provide helpful feedback.',\\n\\n  instructionsPrompt: `Review the changes and suggest improvements.\\n\\nUse the following guidelines while reviewing the changes:\\n- Find ways to simplify the code\\n- Reuse existing code as much as possible instead of writing new code\\n- Preserve as much behavior as possible in the existing code\\n- Prefer changing as few lines of code as possible\\n- Look for opportunities to improve the code's readability\\n- Look for logical errors in the code\\n- Look for missed cases in the code\\n- Look for any other bugs`,\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Get list of changed files from git diff --name-only\\n    const { toolResult: gitDiffFilesResult } = yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff --name-only',\\n      },\\n    }\\n\\n    const changedFiles = (gitDiffFilesResult || '')\\n      .split('\\\\n')\\n      .map((line) => line.trim())\\n      .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\\n\\n    // Step 2: Read changed files\\n    if (changedFiles.length > 0) {\\n      yield {\\n        toolName: 'read_files',\\n        args: {\\n          paths: changedFiles,\\n        },\\n      }\\n    }\\n\\n    // Step 3: Run full git diff to see the actual changes\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n      },\\n    }\\n\\n    // Step 4: Spawn file explorer for broader context if needed\\n    yield {\\n      toolName: 'spawn_agents',\\n      args: {\\n        agents: [\\n          {\\n            agent_type: 'file-explorer',\\n            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\\n            params: {\\n              prompts: [\\n                'Any modules/classes/functions referenced by the diff',\\n                'Relevant tests or test helpers for the changed code',\\n                'Related config or shared utilities that might be impacted',\\n              ],\\n            },\\n          },\\n        ],\\n      },\\n    }\\n\\n    // Step 5: Let the AI produce the final review in a single final step\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \".agents/your-custom-agent.ts\",\n  \"instructions\": \"Add a new starter custom agent (Git Committer scaffold) in the top-level .agents directory, ready to run and publish.\",\n  \"content\": \"import { publisher, version } from './constants'\\n\\nimport type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from './types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'your-custom-agent',\\n  version,\\n  publisher,\\n\\n  displayName: 'Your Custom Agent (Git Committer)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\\n\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description: 'What changes to commit',\\n    },\\n  },\\n\\n  includeMessageHistory: false,\\n  outputMode: 'last_message',\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\\n\\n  instructionsPrompt:\\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Analyze the changes\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n        process_type: 'SYNC',\\n        timeout_seconds: 30,\\n      },\\n    }\\n\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git log --oneline -10',\\n        process_type: 'SYNC',\\n        timeout_seconds: 30,\\n      },\\n    }\\n\\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\\n    yield {\\n      toolName: 'add_message',\\n      args: {\\n        role: 'assistant',\\n        content: `Goal: ${prompt}\\\\n\\\\nI'll read any relevant files and stage the right changes next.`,\\n      },\\n    }\\n\\n    yield 'STEP'\\n\\n    // Step 3: Let the AI create the commit with proper formatting\\n    yield {\\n      toolName: 'add_message',\\n      args: {\\n        role: 'assistant',\\n        content:\\n          \\\"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\\\",\\n      },\\n    }\\n\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>\n<levelcode_tool_call>\n{\n  \"cb_tool_name\": \"write_file\",\n  \"path\": \"common/src/util/examples/your-custom-agent.ts.txt\",\n  \"instructions\": \"Add starter custom agent template content for the agent builder to copy into .agents/your-custom-agent.ts.\",\n  \"content\": \"import { publisher, version } from './constants'\\n\\nimport type {\\n  AgentDefinition,\\n  AgentStepContext,\\n} from './types/agent-definition'\\n\\nconst definition: AgentDefinition = {\\n  id: 'your-custom-agent',\\n  version,\\n  publisher,\\n\\n  displayName: 'Your Custom Agent (Git Committer)',\\n  model: 'anthropic/claude-4-sonnet-20250522',\\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\\n\\n  inputSchema: {\\n    prompt: {\\n      type: 'string',\\n      description: 'What changes to commit',\\n    },\\n  },\\n\\n  includeMessageHistory: false,\\n  outputMode: 'last_message',\\n\\n  spawnPurposePrompt:\\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\\n\\n  systemPrompt:\\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\\n\\n  instructionsPrompt:\\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\\n\\n  handleSteps: function* ({ prompt }: AgentStepContext) {\\n    // Step 1: Analyze the changes\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git diff',\\n        process_type: 'SYNC',\\n        timeout_seconds: 30,\\n      },\\n    }\\n\\n    yield {\\n      toolName: 'run_terminal_command',\\n      args: {\\n        command: 'git log --oneline -10',\\n        process_type: 'SYNC',\\n        timeout_seconds: 30,\\n      },\\n    }\\n\\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\\n    yield {\\n      toolName: 'add_message',\\n      args: {\\n        role: 'assistant',\\n        content: `Goal: ${prompt}\\\\n\\\\nI'll read any relevant files and stage the right changes next.`,\\n      },\\n    }\\n\\n    yield 'STEP'\\n\\n    // Step 3: Let the AI create the commit with proper formatting\\n    yield {\\n      toolName: 'add_message',\\n      args: {\\n        role: 'assistant',\\n        content:\\n          \\\"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\\\",\\n      },\\n    }\\n\\n    yield 'STEP_ALL'\\n  },\\n}\\n\\nexport default definition\\n\"\n}\n</levelcode_tool_call>",
                    "toolResults": [
                      {
                        "file": "backend/src/templates/agents/agent-builder.ts",
                        "message": "Updated file",
                        "unifiedDiff": "@@ -1,12 +1,8 @@\n import * as fs from 'fs'\n import * as path from 'path'\n \n-import {\n-  AGENT_TEMPLATES_DIR,\n-  openrouterModels,\n-  AGENT_DEFINITION_FILE,\n-} from '@levelcode/common/constants'\n+import { AGENT_TEMPLATES_DIR, AGENT_DEFINITION_FILE } from '@levelcode/common/constants'\n import { AgentTemplateTypes } from '@levelcode/common/types/session-state'\n import z from 'zod/v4'\n \n import type { AgentTemplate } from '../types'\n@@ -19,9 +15,8 @@\n // Import to validate path exists at compile time\n import(TEMPLATE_RELATIVE_PATH)\n \n const TEMPLATE_PATH = path.join(__dirname, TEMPLATE_RELATIVE_PATH)\n-const DEFAULT_MODEL = openrouterModels.openrouter_claude_sonnet_4\n const TYPES_DIR = path.join(AGENT_TEMPLATES_DIR, 'types')\n const EXAMPLES_DIR = path.join(AGENT_TEMPLATES_DIR, 'examples')\n const TEMPLATE_TYPES_PATH = path.join(TYPES_DIR, AGENT_DEFINITION_FILE)\n const TOOL_DEFINITIONS_FILE = 'tools.d.ts'\n@@ -32,9 +27,9 @@\n const STARTER_TEMPLATE_DEST_FILE = 'your-custom-agent.ts'\n \n export const agentBuilder = (\n   model: Model,\n-  allAvailableAgents?: string[],\n+  _allAvailableAgents?: string[],\n ): Omit<AgentTemplate, 'id'> => {\n   // Read the AGENT_CONFIG_FILE content dynamically\n   // The import above ensures this path exists at compile time\n   let agentTemplateContent = ''\n@@ -57,9 +52,9 @@\n     console.warn(`Could not read tools.d.ts from common:`, error)\n     toolDefinitionsContent = '// Tool definitions not available'\n   }\n \n-  // Read example agent files from common package\n+  // Read example agent files + starter template from common package\n   const exampleAgentContents: Record<string, string> = {}\n   let starterTemplateContent = ''\n \n   try {\n@@ -229,9 +224,9 @@\n \n IMPORTANT: Always end your response with the end_turn tool when you have completed the agent creation or editing task.`,\n     stepPrompt: '',\n \n-    handleSteps: function* ({ agentState, prompt, params }) {\n+    handleSteps: function* () {\n       // Step 1: Create directory structure\n       yield {\n         toolName: 'run_terminal_command',\n         args: {\n"
                      },
                      {
                        "file": "common/src/constants/agents.ts",
                        "message": "Updated file",
                        "unifiedDiff": "@@ -64,21 +64,16 @@\n     displayName: 'Peter Plan the Planner',\n     purpose: 'Agent that formulates a comprehensive plan to a prompt.',\n     hidden: true,\n   } as const,\n-  dry_run: {\n-    displayName: 'Sketch the Dry Runner',\n-    purpose: 'Agent that takes a plan and try to implement it in a dry run.',\n-    hidden: true,\n-  } as const,\n   reviewer: {\n     displayName: 'Nit Pick Nick the Reviewer',\n     purpose:\n       'Reviews file changes and responds with critical feedback. Use this after making any significant change to the codebase.',\n   } as const,\n   agent_builder: {\n     displayName: 'Bob the Agent Builder',\n-    purpose: 'Creates new agent templates for the levelcode mult-agent system',\n+    purpose: 'Creates new agent templates for the levelcode multi-agent system',\n     hidden: false,\n   } as const,\n } as const satisfies Partial<\n   Record<\n"
                      },
                      {
                        "file": ".agents/examples/diff-reviewer-1.ts",
                        "message": "Updated file",
                        "unifiedDiff": "@@ -3,9 +3,9 @@\n const definition: AgentDefinition = {\n   id: 'diff-reviewer-1',\n \n   displayName: 'Diff Reviewer (Level 1)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n   toolNames: ['read_files', 'run_terminal_command'],\n \n   spawnPurposePrompt:\n     'Spawn when you need to review code changes in the git diff',\n"
                      },
                      {
                        "file": ".agents/examples/diff-reviewer-2.ts",
                        "message": "Updated file",
                        "unifiedDiff": "@@ -5,9 +5,9 @@\n \n const definition: AgentDefinition = {\n   id: 'diff-reviewer-2',\n   displayName: 'Diff Reviewer (Level 2)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n \n   inputSchema: {\n     prompt: {\n       type: 'string',\n@@ -37,9 +37,9 @@\n - Look for logical errors in the code\n - Look for missed cases in the code\n - Look for any other bugs`,\n \n-  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n+  handleSteps: function* ({ prompt }: AgentStepContext) {\n     // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\n     yield {\n       toolName: 'run_terminal_command',\n       args: {\n"
                      },
                      {
                        "file": ".agents/examples/diff-reviewer-3.ts",
                        "message": "Updated file",
                        "unifiedDiff": "@@ -6,9 +6,9 @@\n const definition: AgentDefinition = {\n   id: 'diff-reviewer-3',\n \n   displayName: 'Diff Reviewer (Level 3)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n   inputSchema: {\n     prompt: {\n       type: 'string',\n       description:\n@@ -17,9 +17,9 @@\n   },\n   outputMode: 'last_message',\n \n   toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\n-  spawnableAgents: ['james/file-explorer@0.1.3'],\n+  spawnableAgents: ['file-explorer'],\n \n   spawnPurposePrompt:\n     'Spawn when you need to review code changes in the git diff',\n \n@@ -37,24 +37,23 @@\n - Look for logical errors in the code\n - Look for missed cases in the code\n - Look for any other bugs`,\n \n-  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n+  handleSteps: function* ({ prompt }: AgentStepContext) {\n     // Step 1: Get list of changed files from git diff --name-only\n     const { toolResult: gitDiffFilesResult } = yield {\n       toolName: 'run_terminal_command',\n       args: {\n         command: 'git diff --name-only',\n       },\n     }\n \n-    // Then, extract file paths from the result\n     const changedFiles = (gitDiffFilesResult || '')\n       .split('\\n')\n       .map((line) => line.trim())\n       .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\n \n-    // Step 2: Read the files\n+    // Step 2: Read changed files\n     if (changedFiles.length > 0) {\n       yield {\n         toolName: 'read_files',\n         args: {\n@@ -70,31 +69,30 @@\n         command: 'git diff',\n       },\n     }\n \n-    // Step 4: Put words in the AI's mouth to get it to spawn the file explorer.\n+    // Step 4: Spawn file explorer for broader context if needed\n     yield {\n-      toolName: 'add_message',\n+      toolName: 'spawn_agents',\n       args: {\n-        role: 'assistant',\n-        content:\n-          'Now I will spawn a file explorer to find any missing codebase context.',\n+        agents: [\n+          {\n+            agent_type: 'file-explorer',\n+            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\n+            params: {\n+              prompts: [\n+                'Any modules/classes/functions referenced by the diff',\n+                'Relevant tests or test helpers for the changed code',\n+                'Related config or shared utilities that might be impacted',\n+              ],\n+            },\n+          },\n+        ],\n       },\n     }\n \n-    yield 'STEP'\n-\n-    // Step 5: Put words in the AI's mouth to review the changes.\n-    yield {\n-      toolName: 'add_message',\n-      args: {\n-        role: 'assistant',\n-        content: 'Here is my comprehensive review of the changes.',\n-      },\n-    }\n-\n-    // Step 6: Let AI review the changes in a final step. (The last message is also the agent's output.)\n-    yield 'STEP'\n+    // Step 5: Let the AI produce the final review in a single final step\n+    yield 'STEP_ALL'\n   },\n }\n \n export default definition\n"
                      },
                      {
                        "file": "common/src/util/examples/diff-reviewer-1.ts",
                        "message": "Updated file",
                        "unifiedDiff": "@@ -3,9 +3,9 @@\n const definition: AgentDefinition = {\n   id: 'diff-reviewer-1',\n \n   displayName: 'Diff Reviewer (Level 1)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n   toolNames: ['read_files', 'run_terminal_command'],\n \n   spawnPurposePrompt:\n     'Spawn when you need to review code changes in the git diff',\n"
                      },
                      {
                        "file": "common/src/util/examples/diff-reviewer-2.ts",
                        "message": "Updated file",
                        "unifiedDiff": "@@ -5,9 +5,9 @@\n \n const definition: AgentDefinition = {\n   id: 'diff-reviewer-2',\n   displayName: 'Diff Reviewer (Level 2)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n \n   inputSchema: {\n     prompt: {\n       type: 'string',\n@@ -37,9 +37,9 @@\n - Look for logical errors in the code\n - Look for missed cases in the code\n - Look for any other bugs`,\n \n-  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n+  handleSteps: function* ({ prompt }: AgentStepContext) {\n     // Step 1: Run git diff immediately. Saves the agent a step, lowering cost and latency!\n     yield {\n       toolName: 'run_terminal_command',\n       args: {\n"
                      },
                      {
                        "file": "common/src/util/examples/diff-reviewer-3.ts",
                        "message": "Updated file",
                        "unifiedDiff": "@@ -6,9 +6,9 @@\n const definition: AgentDefinition = {\n   id: 'diff-reviewer-3',\n \n   displayName: 'Diff Reviewer (Level 3)',\n-  model: 'openai/gpt-5',\n+  model: 'anthropic/claude-4-sonnet-20250522',\n   inputSchema: {\n     prompt: {\n       type: 'string',\n       description:\n@@ -17,9 +17,9 @@\n   },\n   outputMode: 'last_message',\n \n   toolNames: ['read_files', 'run_terminal_command', 'spawn_agents'],\n-  spawnableAgents: ['james/file-explorer@0.1.3'],\n+  spawnableAgents: ['file-explorer'],\n \n   spawnPurposePrompt:\n     'Spawn when you need to review code changes in the git diff',\n \n@@ -37,24 +37,23 @@\n - Look for logical errors in the code\n - Look for missed cases in the code\n - Look for any other bugs`,\n \n-  handleSteps: function* ({ agentState, prompt, params }: AgentStepContext) {\n+  handleSteps: function* ({ prompt }: AgentStepContext) {\n     // Step 1: Get list of changed files from git diff --name-only\n     const { toolResult: gitDiffFilesResult } = yield {\n       toolName: 'run_terminal_command',\n       args: {\n         command: 'git diff --name-only',\n       },\n     }\n \n-    // Then, extract file paths from the result\n     const changedFiles = (gitDiffFilesResult || '')\n       .split('\\n')\n       .map((line) => line.trim())\n       .filter((line) => line && !line.startsWith('??') && !line.includes('OSC'))\n \n-    // Step 2: Read the files\n+    // Step 2: Read changed files\n     if (changedFiles.length > 0) {\n       yield {\n         toolName: 'read_files',\n         args: {\n@@ -70,31 +69,30 @@\n         command: 'git diff',\n       },\n     }\n \n-    // Step 4: Put words in the AI's mouth to get it to spawn the file explorer.\n+    // Step 4: Spawn file explorer for broader context if needed\n     yield {\n-      toolName: 'add_message',\n+      toolName: 'spawn_agents',\n       args: {\n-        role: 'assistant',\n-        content:\n-          'Now I will spawn a file explorer to find any missing codebase context.',\n+        agents: [\n+          {\n+            agent_type: 'file-explorer',\n+            prompt: `Find any additional codebase context needed to review these changes. Review focus: ${prompt || ''}`,\n+            params: {\n+              prompts: [\n+                'Any modules/classes/functions referenced by the diff',\n+                'Relevant tests or test helpers for the changed code',\n+                'Related config or shared utilities that might be impacted',\n+              ],\n+            },\n+          },\n+        ],\n       },\n     }\n \n-    yield 'STEP'\n-\n-    // Step 5: Put words in the AI's mouth to review the changes.\n-    yield {\n-      toolName: 'add_message',\n-      args: {\n-        role: 'assistant',\n-        content: 'Here is my comprehensive review of the changes.',\n-      },\n-    }\n-\n-    // Step 6: Let AI review the changes in a final step. (The last message is also the agent's output.)\n-    yield 'STEP'\n+    // Step 5: Let the AI produce the final review in a single final step\n+    yield 'STEP_ALL'\n   },\n }\n \n export default definition\n"
                      },
                      {
                        "file": ".agents/your-custom-agent.ts",
                        "message": "Created new file",
                        "unifiedDiff": "import { publisher, version } from './constants'\n\nimport type {\n  AgentDefinition,\n  AgentStepContext,\n} from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'your-custom-agent',\n  version,\n  publisher,\n\n  displayName: 'Your Custom Agent (Git Committer)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description: 'What changes to commit',\n    },\n  },\n\n  includeMessageHistory: false,\n  outputMode: 'last_message',\n\n  spawnPurposePrompt:\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\n\n  instructionsPrompt:\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\n\n  handleSteps: function* ({ prompt }: AgentStepContext) {\n    // Step 1: Analyze the changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git log --oneline -10',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content: `Goal: ${prompt}\\n\\nI'll read any relevant files and stage the right changes next.`,\n      },\n    }\n\n    yield 'STEP'\n\n    // Step 3: Let the AI create the commit with proper formatting\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          \"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\",\n      },\n    }\n\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n"
                      },
                      {
                        "file": "common/src/util/examples/your-custom-agent.ts.txt",
                        "message": "Created new file",
                        "unifiedDiff": "import { publisher, version } from './constants'\n\nimport type {\n  AgentDefinition,\n  AgentStepContext,\n} from './types/agent-definition'\n\nconst definition: AgentDefinition = {\n  id: 'your-custom-agent',\n  version,\n  publisher,\n\n  displayName: 'Your Custom Agent (Git Committer)',\n  model: 'anthropic/claude-4-sonnet-20250522',\n  toolNames: ['read_files', 'run_terminal_command', 'add_message', 'end_turn'],\n\n  inputSchema: {\n    prompt: {\n      type: 'string',\n      description: 'What changes to commit',\n    },\n  },\n\n  includeMessageHistory: false,\n  outputMode: 'last_message',\n\n  spawnPurposePrompt:\n    'Spawn when you need to commit code changes to git with an appropriate commit message',\n\n  systemPrompt:\n    'You are an expert software developer. Your job is to create a git commit with a really good commit message.',\n\n  instructionsPrompt:\n    'Follow the steps to create a good commit: analyze changes with git diff and git log, read relevant files for context, stage appropriate files, and create a commit with proper formatting including the LevelCode footer.',\n\n  handleSteps: function* ({ prompt }: AgentStepContext) {\n    // Step 1: Analyze the changes\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git diff',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    yield {\n      toolName: 'run_terminal_command',\n      args: {\n        command: 'git log --oneline -10',\n        process_type: 'SYNC',\n        timeout_seconds: 30,\n      },\n    }\n\n    // Step 2: Let the AI decide what to read + what to stage based on the user's intent\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content: `Goal: ${prompt}\\n\\nI'll read any relevant files and stage the right changes next.`,\n      },\n    }\n\n    yield 'STEP'\n\n    // Step 3: Let the AI create the commit with proper formatting\n    yield {\n      toolName: 'add_message',\n      args: {\n        role: 'assistant',\n        content:\n          \"Now I'll create the commit with a high-quality message and the proper LevelCode footer format.\",\n      },\n    }\n\n    yield 'STEP_ALL'\n  },\n}\n\nexport default definition\n"
                      }
                    ]
                  }
                }
              }
            }
          ]
        }
      ]
    },
    {
      "type": "subagent_start",
      "agentId": "D-1-F5QYws4",
      "agentType": "commander-lite",
      "displayName": "Commander Lite",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Run root typecheck to validate TypeScript changes.",
      "params": {
        "command": "bun run typecheck",
        "timeout_seconds": 120
      }
    },
    {
      "type": "subagent_start",
      "agentId": "D-1-F0_olPY",
      "agentType": "commander-lite",
      "displayName": "Commander Lite",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Run relevant package tests if any affected.",
      "params": {
        "command": "bun run test",
        "timeout_seconds": 120
      }
    },
    {
      "type": "subagent_start",
      "agentId": "D-1-F9QrDRM",
      "agentType": "commander-lite",
      "displayName": "Commander Lite",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Check if any formatting issues.",
      "params": {
        "command": "bun run format --check",
        "timeout_seconds": 60
      }
    },
    {
      "type": "tool_call",
      "toolCallId": "7406ef13-feaa-4621-8d92-44c6500769ca",
      "toolName": "run_terminal_command",
      "input": {
        "command": "bun run typecheck",
        "timeout_seconds": 120
      },
      "agentId": "D-1-F5QYws4",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "0c636b39-7349-4e7a-85b2-477c2680fda3",
      "toolName": "run_terminal_command",
      "input": {
        "command": "bun run format --check",
        "timeout_seconds": 60
      },
      "agentId": "D-1-F9QrDRM",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "ffeb7cdc-f4a2-4b93-ae3f-46a22f0796f7",
      "toolName": "run_terminal_command",
      "input": {
        "command": "bun run test",
        "timeout_seconds": 120
      },
      "agentId": "D-1-F0_olPY",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "ffeb7cdc-f4a2-4b93-ae3f-46a22f0796f7",
      "toolName": "run_terminal_command",
      "output": [
        {
          "type": "json",
          "value": {
            "command": "bun run test",
            "stdout": "@levelcode/common test: bun test v1.2.23 (cf136713)\n@levelcode/backend test: bun test v1.2.23 (cf136713)\n@levelcode/common test: \n@levelcode/common test: src/__tests__/handlesteps-parsing.test.ts:\n@levelcode/backend test: \n@levelcode/backend test: src/__tests__/web-search-tool.test.ts:\n@levelcode/common test: Using environment: dev\n@levelcode/common test: (pass) handleSteps Parsing Tests > should validate agent config with handleSteps function [19.41ms]\n@levelcode/common test: (pass) handleSteps Parsing Tests > should convert handleSteps function to string [0.64ms]\n@levelcode/common test: (pass) handleSteps Parsing Tests > should require set_output tool for handleSteps with json output mode [7.64ms]\n@levelcode/common test: (pass) handleSteps Parsing Tests > should validate that handleSteps is a generator function [1.38ms]\n@levelcode/common test: (pass) handleSteps Parsing Tests > should verify loaded template handleSteps matches original function toString [1.38ms]\n@levelcode/common test: \n@levelcode/common test: src/__tests__/dynamic-agent-template-schema.test.ts:\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Valid Templates > should validate minimal valid template [0.15ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Valid Templates > should validate template with inputSchema [0.10ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Valid Templates > should validate template with paramsSchema [1.65ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Valid Templates > should validate template with both schemas [0.87ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Valid Templates > should validate template with complex nested schemas [0.62ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Valid Templates > should apply default values [0.32ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Valid Templates > should validate template with parentInstructions [0.06ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should reject template with missing required fields [0.05ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should reject template with invalid outputMode [0.04ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should reject template with invalid inputSchema type [0.06ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should reject template with invalid paramsSchema type [0.06ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should reject template with null schemas [0.09ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should reject template with invalid prompt field structure\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should reject template with invalid agent ID format\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should accept template with valid agent ID format [0.28ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should reject template with outputMode structured_output but missing set_output tool [0.47ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should accept template with outputMode structured_output and set_output tool [0.10ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should reject template with set_output tool but non-structured_output outputMode [0.04ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should reject template with set_output tool and all_messages outputMode [0.02ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should reject template with non-empty spawnableAgents but missing spawn_agents tool\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should accept template with non-empty spawnableAgents and spawn_agents tool\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Invalid Templates > should accept template with empty spawnableAgents and no spawn_agents tool\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Edge Cases > should handle empty schemas\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Edge Cases > should handle schemas with additional properties [0.18ms]\n@levelcode/common test: (pass) DynamicAgentDefinitionSchema > Edge Cases > should handle very long schema definitions [7.76ms]\n@levelcode/common test: \n@levelcode/common test: src/__tests__/agent-validation.test.ts:\n@levelcode/common test: (pass) Agent Validation > Dynamic Agent Loading > should load valid dynamic agent template [0.38ms]\n@levelcode/common test: (skip) Agent Validation > Dynamic Agent Loading > should validate spawnable agents\n@levelcode/common test: (pass) Agent Validation > Dynamic Agent Loading > should merge static and dynamic templates\n@levelcode/common test: (pass) Agent Validation > Dynamic Agent Loading > should handle agents with JSON schemas [2.41ms]\n@levelcode/common test: (pass) Agent Validation > Dynamic Agent Loading > should return validation errors for invalid schemas [0.25ms]\n@levelcode/common test: (pass) Agent Validation > Dynamic Agent Loading > should handle missing override field as non-override template [0.09ms]\n@levelcode/common test: (pass) Agent Validation > Dynamic Agent Loading > should validate spawnable agents including dynamic agents from first pass [0.10ms]\n@levelcode/common test: (pass) Agent Validation > Schema Validation > Default Schema Behavior > should have no prompt schema when no inputSchema provided [0.06ms]\n@levelcode/common test: (pass) Agent Validation > Schema Validation > Default Schema Behavior > should not have params schema when no paramsSchema provided [0.05ms]\n@levelcode/common test: (pass) Agent Validation > Schema Validation > Complex Schema Scenarios > should handle both inputSchema prompt and params together [2.00ms]\n@levelcode/common test: (pass) Agent Validation > Schema Validation > Complex Schema Scenarios > should handle schema with nested objects and arrays [1.29ms]\n@levelcode/common test: (pass) Agent Validation > Schema Validation > Error Message Quality > should include file path in error messages [0.10ms]\n@levelcode/common test: (pass) Agent Validation > Schema Validation > Edge Cases > should handle git-committer agent schema correctly [0.62ms]\n@levelcode/common test: (pass) Agent Validation > Schema Validation > Edge Cases > should handle empty inputSchema object [0.06ms]\n@levelcode/common test: (pass) Agent Validation > HandleSteps Parsing > should validate agent config with handleSteps function [0.05ms]\n@levelcode/common test: (pass) Agent Validation > HandleSteps Parsing > should convert handleSteps function to string [0.07ms]\n@levelcode/common test: (pass) Agent Validation > HandleSteps Parsing > should require set_output tool for handleSteps with json output mode [0.05ms]\n@levelcode/common test: (pass) Agent Validation > HandleSteps Parsing > should reject set_output tool without json output mode [0.06ms]\n@levelcode/common test: (pass) Agent Validation > HandleSteps Parsing > should validate that handleSteps is a generator function [0.06ms]\n@levelcode/common test: (pass) Agent Validation > HandleSteps Parsing > should verify loaded template handleSteps matches original function toString [0.04ms]\n@levelcode/common test: \n@levelcode/common test: src/types/__tests__/dynamic-agent-template.test.ts:\n@levelcode/common test: \n@levelcode/common test: src/util/__tests__/messages.test.ts:\n@levelcode/common test: (pass) limitScreenshots > should return messages unchanged when no screenshots present [0.19ms]\n@levelcode/common test: (pass) limitScreenshots > should return messages unchanged when screenshots under limit [0.09ms]\n@levelcode/common test: (pass) limitScreenshots > should keep only most recent screenshots when over limit\n@levelcode/common test: (pass) limitScreenshots > should preserve non-image content when filtering\n@levelcode/common test: \n@levelcode/common test: src/util/__tests__/saxy.test.ts:\n@levelcode/common test: (pass) Saxy XML Parser > Schema Validation with Text Conversion > should convert invalid top-level tags to text nodes [2.22ms]\n@levelcode/common test: (pass) Saxy XML Parser > Schema Validation with Text Conversion > should convert invalid nested tags to text nodes [0.02ms]\n@levelcode/common test: (pass) Saxy XML Parser > Schema Validation with Text Conversion > should handle valid nested tags according to schema [0.18ms]\n@levelcode/common test: (pass) Saxy XML Parser > Schema Validation with Text Conversion > should convert closing tags to text when parent is invalid\n@levelcode/common test: (pass) Saxy XML Parser > Schema Validation with Text Conversion > should handle tags starting with whitespace as text\n@levelcode/common test: (pass) Saxy XML Parser > Edge Cases > should handle self-closing invalid tags\n@levelcode/common test: (pass) Saxy XML Parser > Edge Cases > should handle nested invalid tags [0.01ms]\n@levelcode/common test: (pass) Saxy XML Parser > Edge Cases > should preserve attributes in converted text nodes [0.06ms]\n@levelcode/common test: (pass) Saxy XML Parser > should handle text that looks like invalid XML tags [0.29ms]\n@levelcode/common test: (pass) Saxy XML Parser > should handle text with angle brackets but no valid tag names [0.25ms]\n@levelcode/common test: (pass) Saxy XML Parser > should correctly parse mixed valid and invalid XML-like content [0.23ms]\n@levelcode/common test: (pass) Saxy XML Parser > should handle edge cases with special characters after < [0.15ms]\n@levelcode/common test: (pass) Saxy XML Parser > Text Node Handling > should preserve whitespace in text nodes [0.18ms]\n@levelcode/common test: (pass) Saxy XML Parser > Text Node Handling > should handle HTML entities in text content\n@levelcode/common test: (pass) Saxy XML Parser > Text Node Handling > should handle split XML entities in text content [0.54ms]\n@levelcode/common test: (pass) Saxy XML Parser > Text Node Handling > should preserve whitespace between tags [0.39ms]\n@levelcode/common test: (pass) Saxy XML Parser > Text Node Handling > should handle multiple HTML entities in the same text node [0.13ms]\n@levelcode/common test: (pass) Saxy XML Parser > Text Node Handling > should preserve newlines in text content\n@levelcode/common test: (pass) Saxy XML Parser > Text Node Handling > should handle split XML entities across chunks [0.20ms]\n@levelcode/common test: (pass) Saxy XML Parser > Text Node Handling > should handle multiple split entities in sequence [0.44ms]\n@levelcode/common test: (pass) Saxy XML Parser > Text Node Handling > should handle literal ampersand split across chunks [0.18ms]\n@levelcode/common test: (pass) Saxy XML Parser > Text Node Handling > should not treat standalone ampersand as pending entity [0.08ms]\n@levelcode/common test: (pass) Saxy XML Parser > Text Node Handling > should handle text split across chunks without entities or tags [0.10ms]\n@levelcode/common test: (pass) Saxy XML Parser > Text Node Handling > should output closing tag as text if not matching [0.08ms]\n@levelcode/common test: (pass) Saxy XML Parser > shouldParseEntities = false > should not parse HTML entities in text content when shouldParseEntities is false [0.03ms]\n@levelcode/common test: (pass) Saxy XML Parser > shouldParseEntities = false > should not parse HTML entities split across chunks when shouldParseEntities is false [0.21ms]\n@levelcode/common test: (pass) Saxy XML Parser > shouldParseEntities = false > should handle text nodes correctly in _final when shouldParseEntities is false [0.17ms]\n@levelcode/common test: (pass) Saxy XML Parser > Real World Examples > should handle && ( &lt [0.24ms]\n@levelcode/common test: (pass) Saxy XML Parser > Real World Examples > should handle entity at end of content [0.22ms]\n@levelcode/common test: \n@levelcode/common test: src/util/__tests__/string.test.ts:\n@levelcode/common test: (pass) pluralize > should handle singular and plural cases correctly [0.26ms]\n@levelcode/common test: (pass) pluralize > should handle words ending in y [0.03ms]\n@levelcode/common test: (pass) pluralize > should handle words ending in f/fe [0.04ms]\n@levelcode/common test: (pass) pluralize > should handle words ending in s, sh, ch, x, z, o [0.02ms]\n@levelcode/common test: (pass) pluralize > should handle regular plurals [0.02ms]\n@levelcode/common test: (pass) replaceNonStandardPlaceholderComments > should replace C-style comments [0.03ms]\n@levelcode/common test: (pass) replaceNonStandardPlaceholderComments > should replace multi-line C-style comments [0.15ms]\n@levelcode/common test: (pass) replaceNonStandardPlaceholderComments > should replace Python-style comments [0.03ms]\n@levelcode/common test: (pass) replaceNonStandardPlaceholderComments > should replace JSX comments [0.02ms]\n@levelcode/common test: \n@levelcode/common test: src/util/__tests__/partial-json-delta.test.ts:\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > complete valid JSON > should parse complete valid JSON [0.18ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > complete valid JSON > should parse empty object [0.05ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > complete valid JSON > should parse nested objects [0.05ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > complete valid JSON > should parse arrays [0.04ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > incomplete JSON - missing closing brace > should parse object missing final closing brace [0.14ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > incomplete JSON - missing closing brace > should parse nested object missing final closing brace [0.10ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > incomplete JSON - missing closing brace > should parse object with incomplete string value [0.04ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > incomplete JSON - trailing comma handling > should handle trailing comma by removing last property [0.02ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > incomplete JSON - trailing comma handling > should handle multiple trailing commas\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > incomplete JSON - trailing comma handling > should handle nested object with trailing comma\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > incomplete JSON - trailing comma handling > should handle array with trailing comma [0.08ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > edge cases > should return empty object for empty string\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > edge cases > should return empty object for invalid JSON\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > edge cases > should return empty object for malformed JSON [0.14ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > edge cases > should handle JSON with only opening brace [0.06ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > edge cases > should handle JSON with whitespace [0.02ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > edge cases > should handle complex nested incomplete JSON [0.06ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > real-world streaming scenarios > should handle partial JSON from streaming response [0.05ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > real-world streaming scenarios > should handle JSON with boolean and null values [0.03ms]\n@levelcode/common test: (pass) parsePartialJsonObjectSingle > real-world streaming scenarios > should handle JSON with numbers [0.03ms]\n@levelcode/common test: (pass) getPartialJsonDelta > input validation > should throw error when content does not start with previous [0.17ms]\n@levelcode/common test: (pass) getPartialJsonDelta > input validation > should work when content starts with previous [0.10ms]\n@levelcode/common test: (pass) getPartialJsonDelta > basic delta detection from streaming JSON > should detect new properties added to empty object [0.04ms]\n@levelcode/common test: (pass) getPartialJsonDelta > basic delta detection from streaming JSON > should detect completion of partial string value [0.04ms]\n@levelcode/common test: (pass) getPartialJsonDelta > basic delta detection from streaming JSON > should return empty delta when no changes detected [0.02ms]\n@levelcode/common test: (pass) getPartialJsonDelta > basic delta detection from streaming JSON > should detect new property being added [0.02ms]\n@levelcode/common test: (pass) getPartialJsonDelta > string delta handling > should return string slice for partial string updates [0.02ms]\n@levelcode/common test: (pass) getPartialJsonDelta > string delta handling > should handle empty string to non-empty string [0.02ms]\n@levelcode/common test: (pass) getPartialJsonDelta > string delta handling > should handle new string property [0.02ms]\n@levelcode/common test: (pass) getPartialJsonDelta > string delta handling > should handle multi-line string streaming [0.02ms]\n@levelcode/common test: (pass) getPartialJsonDelta > non-string value changes > should return full value for non-string changes [0.01ms]\n@levelcode/common test: (pass) getPartialJsonDelta > non-string value changes > should handle boolean values [0.01ms]\n@levelcode/common test: (pass) getPartialJsonDelta > non-string value changes > should handle null values [0.02ms]\n@levelcode/common test: (pass) getPartialJsonDelta > non-string value changes > should handle array values [0.01ms]\n@levelcode/common test: (pass) getPartialJsonDelta > non-string value changes > should handle nested object values [0.01ms]\n@levelcode/common test: (pass) getPartialJsonDelta > realistic streaming scenarios > should handle progressive JSON building [0.03ms]\n@levelcode/common test: (pass) getPartialJsonDelta > realistic streaming scenarios > should handle streaming text completion\n@levelcode/common test: (pass) getPartialJsonDelta > realistic streaming scenarios > should handle incomplete JSON with trailing comma [0.04ms]\n@levelcode/common test: (pass) getPartialJsonDelta > lastParam tracking > should track last parameter key and completion status [0.01ms]\n@levelcode/common test: (pass) getPartialJsonDelta > lastParam tracking > should indicate incomplete last parameter\n@levelcode/common test: (pass) getPartialJsonDelta > lastParam tracking > should handle undefined key for empty object [0.04ms]\n@levelcode/common test: (pass) getPartialJsonDelta > edge cases > should handle empty previous string [0.03ms]\n@levelcode/common test: (pass) getPartialJsonDelta > edge cases > should handle identical content and previous [0.01ms]\n@levelcode/common test: (pass) getPartialJsonDelta > edge cases > should handle malformed JSON gracefully\n@levelcode/common test: (pass) getPartialJsonDelta > edge cases > should handle escaped quotes in strings [0.01ms]\n@levelcode/common test: \n@levelcode/common test: src/json-config/__tests__/stringify-schema.test.ts:\n@levelcode/common test: (pass) stringifySchema > should correctly stringify StartupProcessSchema [0.75ms]\n@levelcode/common test: (pass) stringifySchema > should correctly stringify LevelCodeConfigSchema [0.19ms]\n@levelcode/common test: (pass) stringifySchema > should handle a more complex schema [0.31ms]\n@levelcode/common test: (pass) stringifySchema > should handle an empty object schema [0.03ms]\n@levelcode/common test: (pass) stringifySchema > should handle schema with only optional fields [0.05ms]\n@levelcode/common test: (pass) stringifySchema > should handle schema with default values [0.09ms]\n@levelcode/common test: \n@levelcode/common test: src/json-config/__tests__/constants.test.ts:\n@levelcode/common test: (pass) constants > levelcodeConfigFile and levelcodeConfigFileBackup > should have correct file names\n@levelcode/common test: (pass) constants > StartupProcessSchema > should validate a minimal startup process [0.35ms]\n@levelcode/common test: (pass) constants > StartupProcessSchema > should validate a complete startup process\n@levelcode/common test: (pass) constants > StartupProcessSchema > should reject startup process with empty name [0.10ms]\n@levelcode/common test: (pass) constants > StartupProcessSchema > should reject startup process with empty command [0.07ms]\n@levelcode/common test: (pass) constants > StartupProcessSchema > should apply default enabled value [0.03ms]\n@levelcode/common test: (pass) constants > FileChangeHook > should validate a minimal file change hook [0.05ms]\n@levelcode/common test: (pass) constants > FileChangeHook > should validate a complete file change hook [0.10ms]\n@levelcode/common test: (pass) constants > FileChangeHook > should reject hook with empty name [0.09ms]\n@levelcode/common test: (pass) constants > FileChangeHook > should reject hook with empty command [0.13ms]\n@levelcode/common test: (pass) constants > LevelCodeConfigSchema > should validate an empty object as a valid config [0.07ms]\n@levelcode/common test: (pass) constants > LevelCodeConfigSchema > should validate a minimal config with description only [0.07ms]\n@levelcode/common test: (pass) constants > LevelCodeConfigSchema > should validate a complete config [0.05ms]\n@levelcode/common test: (pass) constants > LevelCodeConfigSchema > should accept any type for description field [0.15ms]\n@levelcode/common test: (pass) constants > LevelCodeConfigSchema > should apply default maxAgentSteps value [0.07ms]\n@levelcode/common test: (pass) constants > LevelCodeConfigSchema > should allow custom maxAgentSteps value [0.03ms]\n@levelcode/common test: (pass) constants > LevelCodeConfigSchema > should reject invalid startup process in array [0.08ms]\n@levelcode/common test: (pass) constants > LevelCodeConfigSchema > should reject invalid file change hook in array [0.08ms]\n@levelcode/common test: (pass) constants > LevelCodeConfigSchema > should reject non-number maxAgentSteps [0.02ms]\n@levelcode/common test: (pass) constants > LevelCodeConfigSchema > should reject non-array startupProcesses [0.08ms]\n@levelcode/common test: (pass) constants > LevelCodeConfigSchema > should reject non-array fileChangeHooks\n@levelcode/common test: (pass) constants > TypeScript types > should have correct TypeScript types\n@levelcode/common test: \n@levelcode/common test: 1 tests skipped:\n@levelcode/common test: (skip) Agent Validation > Dynamic Agent Loading > should validate spawnable agents\n@levelcode/common test: \n@levelcode/common test:  164 pass\n@levelcode/common test:  1 skip\n@levelcode/common test:  0 fail\n@levelcode/common test:  6 snapshots, 337 expect() calls\n@levelcode/common test: Ran 165 tests across 10 files. [517.00ms]\n@levelcode/common test: Exited with code 0\n@levelcode/backend test: Using environment: dev\n@levelcode/backend test: \n@levelcode/backend test: # Unhandled error between tests\n@levelcode/backend test: -------------------------------\n@levelcode/backend test:  6 | import type { AgentTemplate } from '../../types'\n@levelcode/backend test:  7 | import type { Model } from '@levelcode/common/constants'\n@levelcode/backend test:  8 | \n@levelcode/backend test:  9 | export const dryRun = (model: Model): Omit<AgentTemplate, 'id'> => ({\n@levelcode/backend test: 10 |   model,\n@levelcode/backend test: 11 |   displayName: AGENT_PERSONAS.dry_run.displayName,\n@levelcode/backend test:                                    ^\n@levelcode/backend test: TypeError: undefined is not an object (evaluating 'AGENT_PERSONAS.dry_run.displayName')\n@levelcode/backend test:       at dryRun (/private/var/folders/k7/h0vthckj46s24j_xs1lp33g80000gn/T/levelcode-eval-U1Rxqp/repo/backend/src/templates/agents/archive/dry-run.ts:11:31)\n@levelcode/backend test:       at /private/var/folders/k7/h0vthckj46s24j_xs1lp33g80000gn/T/levelcode-eval-U1Rxqp/repo/backend/src/templates/agent-list.ts:69:10\n@levelcode/backend test: -------------------------------\n@levelcode/backend test: \n@levelcode/backend test: \n@levelcode/backend test: src/__tests__/generate-diffs-prompt.test.ts:\n@levelcode/backend test: {\"result\":{\"diffBlocks\":[{\"searchContent\":\"function test() {\\n  return true;\\n}\\n\",\"replaceContent\":\"function test() {\\n  if (!condition) return false;\\n  return true;\\n}\\n\"}],\"diffBlocksThatDidntMatch\":[]}}\n@levelcode/backend test: (pass) parseAndGetDiffBlocksSingleFile > should parse diff blocks with newline before closing marker [17.55ms]\n@levelcode/backend test: (pass) parseAndGetDiffBlocksSingleFile > should parse diff blocks without newline before closing marker [0.08ms]\n@levelcode/backend test: (pass) parseAndGetDiffBlocksSingleFile > should handle multiple diff blocks with mixed newline patterns [0.02ms]\n@levelcode/backend test: (pass) parseAndGetDiffBlocksSingleFile > should handle empty replace content (with just one newline) [0.02ms]\n@levelcode/backend test: \n@levelcode/backend test: src/__tests__/usage-calculation.test.ts:\n@levelcode/backend test: (pass) Usage Calculation System \n[...TRUNCATED DUE TO LENGTH...]\nkend test: (pass) Backend Tool Call Schema > should validate tool call response structure [0.03ms]\n@levelcode/backend test: (pass) Backend Tool Call Schema > should handle tool call timeout scenarios [0.01ms]\n@levelcode/backend test: (pass) Backend Tool Call Schema > should validate different tool types [0.09ms]\n@levelcode/backend test: (pass) Backend Tool Call Schema > should handle request ID generation [0.02ms]\n@levelcode/backend test: (pass) Backend Tool Call Schema > should generate mock project structure analysis [0.27ms]\n@levelcode/backend test: (pass) Backend Tool Call Schema > should generate mock dependency analysis [0.17ms]\n@levelcode/backend test: (pass) Backend Tool Call Schema > should handle error scenarios in mock generators [0.10ms]\n@levelcode/backend test: \n@levelcode/backend test: src/__tests__/sandbox-generator.test.ts:\n@levelcode/backend test: 87 |     mockParams.template = mockTemplate\n@levelcode/backend test: 88 |     mockParams.localAgentTemplates = { 'test-vm-agent': mockTemplate }\n@levelcode/backend test: 89 | \n@levelcode/backend test: 90 |     const result = await runProgrammaticStep(mockAgentState, mockParams)\n@levelcode/backend test: 91 | \n@levelcode/backend test: 92 |     expect(result.agentState.output).toEqual({\n@levelcode/backend test:                                           ^\n@levelcode/backend test: error: expect(received).toEqual(expected)\n@levelcode/backend test: \n@levelcode/backend test:   {\n@levelcode/backend test: -   \"agentId\": \"test-agent-123\",\n@levelcode/backend test: -   \"message\": \"Hello from QuickJS sandbox!\",\n@levelcode/backend test: -   \"prompt\": \"Test prompt\",\n@levelcode/backend test: +   \"error\": \"Error executing handleSteps for agent test-vm-agent: Cannot access 'sendMessage' before initialization.\",\n@levelcode/backend test:   }\n@levelcode/backend test: \n@levelcode/backend test: - Expected  - 3\n@levelcode/backend test: + Received  + 1\n@levelcode/backend test: \n@levelcode/backend test:       at <anonymous> (/private/var/folders/k7/h0vthckj46s24j_xs1lp33g80000gn/T/levelcode-eval-U1Rxqp/repo/backend/src/__tests__/sandbox-generator.test.ts:92:38)\n@levelcode/backend test: (fail) QuickJS Sandbox Generator > should execute string-based generator in QuickJS sandbox [29.84ms]\n@levelcode/backend test: (pass) QuickJS Sandbox Generator > should handle QuickJS sandbox errors gracefully [4.80ms]\n@levelcode/backend test: \n@levelcode/backend test: src/__tests__/auto-topup.test.ts:\n@levelcode/backend test: (pass) Auto Top-up System > checkAndTriggerAutoTopup > should trigger top-up when balance below threshold [9.03ms]\n@levelcode/backend test: (pass) Auto Top-up System > checkAndTriggerAutoTopup > should not trigger top-up when balance above threshold [0.24ms]\n@levelcode/backend test: (pass) Auto Top-up System > checkAndTriggerAutoTopup > should handle debt by topping up max(debt, configured amount) [0.15ms]\n@levelcode/backend test: (pass) Auto Top-up System > checkAndTriggerAutoTopup > should disable auto-topup when validation fails [1.19ms]\n@levelcode/backend test: \n@levelcode/backend test: src/__tests__/loop-agent-steps.test.ts:\n@levelcode/backend test: \n@levelcode/backend test: # Unhandled error between tests\n@levelcode/backend test: -------------------------------\n@levelcode/backend test: 15 |  */\n@levelcode/backend test: 16 | export const mockModule = async (\n@levelcode/backend test: 17 |   modulePath: string,\n@levelcode/backend test: 18 |   renderMocks: () => Record<string, any>,\n@levelcode/backend test: 19 | ): Promise<MockResult> => {\n@levelcode/backend test: 20 |   let original = originalModuleCache[modulePath] ?? {\n@levelcode/backend test:                                                          ^\n@levelcode/backend test: ReferenceError: Cannot access 'AsyncAgentManager' before initialization.\n@levelcode/backend test:       at <anonymous> (/private/var/folders/k7/h0vthckj46s24j_xs1lp33g80000gn/T/levelcode-eval-U1Rxqp/repo/common/src/testing/mock-modules.ts:20:53)\n@levelcode/backend test: -------------------------------\n@levelcode/backend test: \n@levelcode/backend test: 194 | \n@levelcode/backend test: 195 |   const hasPrompt = Boolean(prompt || params)\n@levelcode/backend test: 196 | \n@levelcode/backend test: 197 |   if (ASYNC_AGENTS_ENABLED) {\n@levelcode/backend test: 198 |     // Register this agent in the async manager so it can receive messages\n@levelcode/backend test: 199 |     const isRegistered = asyncAgentManager.getAgent(agentState.agentId)\n@levelcode/backend test:                                ^\n@levelcode/backend test: ReferenceError: Cannot access 'asyncAgentManager' before initialization.\n@levelcode/backend test:       at <anonymous> (/private/var/folders/k7/h0vthckj46s24j_xs1lp33g80000gn/T/levelcode-eval-U1Rxqp/repo/backend/src/run-agent-step.ts:199:26)\n@levelcode/backend test:       at async <anonymous> (/private/var/folders/k7/h0vthckj46s24j_xs1lp33g80000gn/T/levelcode-eval-U1Rxqp/repo/backend/src/run-agent-step.ts:529:15)\n@levelcode/backend test:       at async <anonymous> (/private/var/folders/k7/h0vthckj46s24j_xs1lp33g80000gn/T/levelcode-eval-U1Rxqp/repo/backend/src/__tests__/loop-agent-steps.test.ts:225:26)\n@levelcode/backend test: (fail) loopAgentSteps STEP behavior > should verify correct STEP behavior - LLM called once after STEP [1.16ms]\n@levelcode/backend test: (pass) loopAgentSteps STEP behavior > should demonstrate correct behavior when programmatic agent completes without STEP [0.11ms]\n@levelcode/backend test: \n@levelcode/backend test: src/__tests__/live-user-inputs.test.ts:\n@levelcode/backend test: (pass) live-user-inputs > startUserInput > should start a new user input [0.20ms]\n@levelcode/backend test: (pass) live-user-inputs > startUserInput > should handle multiple user inputs for same user [0.03ms]\n@levelcode/backend test: (pass) live-user-inputs > startUserInput > should handle user inputs for different users [0.03ms]\n@levelcode/backend test: (pass) live-user-inputs > cancelUserInput > should cancel a specific user input [0.11ms]\n@levelcode/backend test: (pass) live-user-inputs > cancelUserInput > should remove user from tracking when all inputs cancelled [0.03ms]\n@levelcode/backend test: (pass) live-user-inputs > cancelUserInput > should handle cancelling non-existent input gracefully [0.07ms]\n@levelcode/backend test: (pass) live-user-inputs > cancelUserInput > should handle cancelling for non-existent user gracefully [0.02ms]\n@levelcode/backend test: (pass) live-user-inputs > endUserInput > should end user input when async agents disabled [0.04ms]\n@levelcode/backend test: (pass) live-user-inputs > endUserInput > should keep user input when async agents enabled [0.02ms]\n@levelcode/backend test: (pass) live-user-inputs > checkLiveUserInput > should return true for valid live user input [0.10ms]\n@levelcode/backend test: (pass) live-user-inputs > checkLiveUserInput > should return true for user input with matching prefix [0.03ms]\n@levelcode/backend test: (pass) live-user-inputs > checkLiveUserInput > should return false for non-existent user [0.05ms]\n@levelcode/backend test: (pass) live-user-inputs > checkLiveUserInput > should return false for undefined user [0.01ms]\n@levelcode/backend test: (pass) live-user-inputs > checkLiveUserInput > should return false for disconnected session [0.03ms]\n@levelcode/backend test: (pass) live-user-inputs > checkLiveUserInput > should return false for non-matching user input [0.04ms]\n@levelcode/backend test: (pass) live-user-inputs > checkLiveUserInput > should return true when live user input check is disabled [0.03ms]\n@levelcode/backend test: (pass) live-user-inputs > setSessionConnected > should set session as connected [0.05ms]\n@levelcode/backend test: (pass) live-user-inputs > setSessionConnected > should set session as disconnected [0.08ms]\n@levelcode/backend test: (pass) live-user-inputs > setSessionConnected > should handle multiple sessions independently [0.07ms]\n@levelcode/backend test: (pass) live-user-inputs > getLiveUserInputIds > should return undefined for user with no inputs [0.05ms]\n@levelcode/backend test: (pass) live-user-inputs > getLiveUserInputIds > should return undefined for undefined user [0.04ms]\n@levelcode/backend test: (pass) live-user-inputs > getLiveUserInputIds > should return array of input IDs for user with inputs [0.05ms]\n@levelcode/backend test: (pass) live-user-inputs > integration scenarios > should handle complete user input lifecycle [0.21ms]\n@levelcode/backend test: (pass) live-user-inputs > integration scenarios > should handle session disconnect during active input [0.09ms]\n@levelcode/backend test: (pass) live-user-inputs > integration scenarios > should handle multiple concurrent inputs for same user [0.05ms]\n@levelcode/backend test: \n@levelcode/backend test: src/util/__tests__/simplify-tool-results.test.ts:\n@levelcode/backend test: (pass) simplifyToolResultsInMessages > should simplify read_files results while preserving others [0.66ms]\n@levelcode/backend test: (pass) simplifyToolResultsInMessages > should handle array message content format [0.07ms]\n@levelcode/backend test: (pass) simplifyToolResultsInMessages > should return original content if no tool results present [0.06ms]\n@levelcode/backend test: (pass) simplifyToolResultsInMessages > should handle empty content [0.02ms]\n@levelcode/backend test: (pass) simplifyToolResultsInMessages > should handle array message content with no text property [0.02ms]\n@levelcode/backend test: (pass) simplifyToolResultsInMessages > should handle array message content with undefined text property [0.02ms]\n@levelcode/backend test: (pass) simplifyToolResultsInMessages > should handle multiple read_files results [0.06ms]\n@levelcode/backend test: (pass) simplifyToolResultsInMessages > should handle malformed read_files result [0.03ms]\n@levelcode/backend test: (pass) simplifyTerminalCommandResultsInMessages > should simplify long terminal command output [0.11ms]\n@levelcode/backend test: (pass) simplifyTerminalCommandResultsInMessages > should preserve short terminal command output [0.02ms]\n@levelcode/backend test: (pass) simplifyTerminalCommandResultsInMessages > should preserve other tool results [0.04ms]\n@levelcode/backend test: (pass) simplifyTerminalCommandResultsInMessages > should handle multiple terminal command results [0.09ms]\n@levelcode/backend test: (pass) simplifyTerminalCommandResultsInMessages > should handle mixed short and long terminal outputs [0.07ms]\n@levelcode/backend test: (pass) simplifyTerminalCommandResultsInMessages > should handle malformed terminal command result [0.05ms]\n@levelcode/backend test: (pass) simplifyReadFileToolResult > should extract file paths from read_files result [0.04ms]\n@levelcode/backend test: (pass) simplifyReadFileToolResult > should handle single file result [0.03ms]\n@levelcode/backend test: (pass) simplifyReadFileToolResult > should handle empty read_files result [0.02ms]\n@levelcode/backend test: (pass) simplifyReadFileToolResult > should handle malformed read_file tags [0.02ms]\n@levelcode/backend test: (pass) simplifyReadFileToolResult > should handle read_file tags with empty path [0.02ms]\n@levelcode/backend test: (pass) simplifyTerminalCommandResult > should shorten long terminal output [0.02ms]\n@levelcode/backend test: (pass) simplifyTerminalCommandResult > should preserve short terminal output [0.02ms]\n@levelcode/backend test: (pass) simplifyTerminalCommandResult > should handle empty terminal output [0.01ms]\n@levelcode/backend test: (pass) simplifyTerminalCommandResult > should handle output exactly matching omitted message length [0.02ms]\n@levelcode/backend test: (pass) simplifyTerminalCommandResult > should handle output one character longer than omitted message [0.01ms]\n@levelcode/backend test: (pass) simplifyTerminalCommandResult > should handle output one character shorter than omitted message\n@levelcode/backend test: \n@levelcode/backend test: src/util/__tests__/split-data.test.ts:\n@levelcode/backend test: (pass) splitData - base cases > returns primitive as-is in an array [2.02ms]\n@levelcode/backend test: (pass) splitData - base cases > returns non-plain objects as-is [0.11ms]\n@levelcode/backend test: (pass) splitData - base cases > splits short strings when maxChunkSize is small [0.15ms]\n@levelcode/backend test: (pass) splitData - base cases > splits deeply nested strings with small maxChunkSize [0.07ms]\n@levelcode/backend test: (pass) splitData - base cases > handles arrays with long values [0.10ms]\n@levelcode/backend test: (pass) splitData - base cases > preserves numbers and booleans [0.07ms]\n@levelcode/backend test: (pass) splitData - base cases > splits multiple string fields independently [0.04ms]\n@levelcode/backend test: (pass) splitData - array and string-specific splitting > splits long strings into smaller string chunks [0.03ms]\n@levelcode/backend test: (pass) splitData - array and string-specific splitting > splits arrays into smaller arrays with sliced strings [0.03ms]\n@levelcode/backend test: (pass) splitData - array and string-specific splitting > splits plain objects with long strings into smaller objects [0.04ms]\n@levelcode/backend test: (pass) splitData - array and string-specific splitting > preserves numbers and booleans in split arrays [0.06ms]\n@levelcode/backend test: (pass) splitData - array and string-specific splitting > splits hybrid nested array/object structures within size limits [0.08ms]\n@levelcode/backend test: (pass) splitData - array and string-specific splitting > efficiently combines array elements while respecting maxSize [0.04ms]\n@levelcode/backend test: (pass) splitData - array and string-specific splitting > efficiently combines object properties while respecting maxSize [0.08ms]\n@levelcode/backend test: (pass) splitData - array and string-specific splitting > handles escaped characters at split points [0.03ms]\n@levelcode/backend test: (pass) splitData - nested object splitting > maintains object structure when splitting nested long strings [0.02ms]\n@levelcode/backend test: \n@levelcode/backend test: src/util/__tests__/messages.test.ts:\n@levelcode/backend test: (pass) messagesWithSystem > prepends system message to array [0.09ms]\n@levelcode/backend test: (pass) trimMessagesToFitTokenLimit > handles all features working together correctly [0.94ms]\n@levelcode/backend test: (pass) trimMessagesToFitTokenLimit > subtracts system tokens from total tokens [0.77ms]\n@levelcode/backend test: (pass) trimMessagesToFitTokenLimit > does not simplify if under token limit [0.27ms]\n@levelcode/backend test: (pass) trimMessagesToFitTokenLimit > handles empty messages array [0.08ms]\n@levelcode/backend test: (pass) trimMessagesToFitTokenLimit > keepDuringTruncation functionality > preserves messages marked with keepDuringTruncation=true [0.48ms]\n@levelcode/backend test: (pass) trimMessagesToFitTokenLimit > keepDuringTruncation functionality > does not add replacement message when no messages are removed [0.06ms]\n@levelcode/backend test: (pass) trimMessagesToFitTokenLimit > keepDuringTruncation functionality > handles consecutive replacement messages correctly [0.10ms]\n@levelcode/backend test: (pass) trimMessagesToFitTokenLimit > keepDuringTruncation functionality > calculates token removal correctly with keepDuringTruncation [0.05ms]\n@levelcode/backend test: (pass) trimMessagesToFitTokenLimit > keepDuringTruncation functionality > handles mixed keepDuringTruncation and regular messages [0.04ms]\n@levelcode/backend test: \n@levelcode/backend test: src/util/__tests__/parse-tool-call-xml.test.ts:\n@levelcode/backend test: (pass) parseToolCallXml > should parse basic key-value pairs [0.21ms]\n@levelcode/backend test: (pass) parseToolCallXml > should handle empty content\n@levelcode/backend test: (pass) parseToolCallXml > should handle whitespace around values\n@levelcode/backend test: (pass) parseToolCallXml > should handle internal whitespace [0.05ms]\n@levelcode/backend test: (pass) parseToolCallXml > should return an empty object for empty or whitespace-only input\n@levelcode/backend test: (pass) parseToolCallXml > should handle special XML characters within values\n@levelcode/backend test: (pass) parseToolCallXml > should parse numbers as strings\n@levelcode/backend test: (pass) parseToolCallXml > should parse booleans as strings [0.01ms]\n@levelcode/backend test: (pass) parseToolCallXml > should parse nested range tags as raw string content [0.01ms]\n@levelcode/backend test: (pass) parseToolCallXml > should parse mixed types as strings [0.02ms]\n@levelcode/backend test: (pass) parseToolCallXml > should handle complex example with various types (all as strings) [0.03ms]\n@levelcode/backend test: (pass) parseToolCallXml > should convert boolean values\n@levelcode/backend test: (pass) parseToolCallXml > should convert numeric values [0.02ms]\n@levelcode/backend test: (pass) parseToolCallXml > should handle complex browser action example [0.01ms]\n@levelcode/backend test: (pass) parseToolCallXml > should handle multiline content with whitespace [0.03ms]\n@levelcode/backend test: (pass) parseToolCallXml > should handle diagnostic step example [0.02ms]\n@levelcode/backend test: (pass) parseToolCallXml > should handle empty tags [0.01ms]\n@levelcode/backend test: \n@levelcode/backend test: src/util/__tests__/object.test.ts:\n@levelcode/backend test: (pass) stripNullCharsFromObject > should remove null characters from strings in a simple object [0.18ms]\n@levelcode/backend test: (pass) stripNullCharsFromObject > should remove null characters from strings in a nested object [0.03ms]\n@levelcode/backend test: (pass) stripNullCharsFromObject > should remove null characters from strings within an array [0.02ms]\n@levelcode/backend test: (pass) stripNullCharsFromObject > should remove null characters from strings within objects in an array [0.03ms]\n@levelcode/backend test: (pass) stripNullCharsFromObject > should handle mixed data types correctly [0.04ms]\n@levelcode/backend test: (pass) stripNullCharsFromObject > should handle empty objects and arrays [0.01ms]\n@levelcode/backend test: (pass) stripNullCharsFromObject > should handle a string input directly\n@levelcode/backend test: (pass) stripNullCharsFromObject > should handle non-string, non-object, non-array inputs [0.02ms]\n@levelcode/backend test: (pass) stripNullCharsFromObject > should handle complex nested structures [0.04ms]\n@levelcode/backend test: \n@levelcode/backend test: src/llm-apis/__tests__/linkup-api.test.ts:\n@levelcode/backend test: (pass) Linkup API > should successfully search with basic query [0.49ms]\n@levelcode/backend test: (pass) Linkup API > should handle custom depth [0.22ms]\n@levelcode/backend test: (pass) Linkup API > should handle API errors gracefully [0.22ms]\n@levelcode/backend test: (pass) Linkup API > should handle network errors [0.28ms]\n@levelcode/backend test: (pass) Linkup API > should handle invalid response format [0.17ms]\n@levelcode/backend test: (pass) Linkup API > should handle missing answer field [0.09ms]\n@levelcode/backend test: (pass) Linkup API > should handle empty answer [0.08ms]\n@levelcode/backend test: (pass) Linkup API > should use default options when none provided [0.09ms]\n@levelcode/backend test: (pass) Linkup API > should handle malformed JSON response [0.11ms]\n@levelcode/backend test: (pass) Linkup API > should log detailed error information for 404 responses [0.15ms]\n@levelcode/backend test: \n@levelcode/backend test: 7 tests skipped:\n@levelcode/backend test: (skip) read_docs tool with researcher agent > should successfully fetch documentation with basic query\n@levelcode/backend test: (skip) read_docs tool with researcher agent > should fetch documentation with topic and max_tokens\n@levelcode/backend test: (skip) mainPrompt (Integration) > should delete a specified function while preserving other code\n@levelcode/backend test: (skip) mainPrompt (Integration) > Real world example > should specify deletion comment while deleting single character\n@levelcode/backend test: (skip) rewriteWithOpenAI > (unnamed)\n@levelcode/backend test: (skip) rewriteWithOpenAI > should correctly integrate edit snippet changes while preserving formatting\n@levelcode/backend test: (skip) rewriteWithOpenAI > (unnamed)\n@levelcode/backend test: \n@levelcode/backend test: \n@levelcode/backend test: 38 tests failed:\n@levelcode/backend test: (fail) runAgentStep - set_output tool > should set output with simple key-value pair [0.25ms]\n@levelcode/backend test: (fail) runAgentStep - set_output tool > should set output with complex data [0.04ms]\n@levelcode/backend test: (fail) runAgentStep - set_output tool > should replace existing output data [0.03ms]\n@levelcode/backend test: (fail) runAgentStep - set_output tool > should handle empty output parameter\n@levelcode/backend test: (fail) runAgentStep - set_output tool > should handle handleSteps with one tool call and STEP_ALL [0.05ms]\n@levelcode/backend test: (fail) runAgentStep - set_output tool > should spawn agent inline that deletes last two assistant messages\n@levelcode/backend test: (fail) mainPrompt > should add file updates to tool results in message history [0.60ms]\n@levelcode/backend test: (fail) mainPrompt > should handle direct terminal command [0.25ms]\n@levelcode/backend test: (fail) mainPrompt > should handle write_file tool call\n@levelcode/backend test: (fail) mainPrompt > should force end of response after MAX_CONSECUTIVE_ASSISTANT_MESSAGES [0.19ms]\n@levelcode/backend test: (fail) mainPrompt > should update consecutiveAssistantMessages when new prompt is received\n@levelcode/backend test: (fail) mainPrompt > should increment consecutiveAssistantMessages when no new prompt\n@levelcode/backend test: (fail) mainPrompt > should return no tool calls when LLM response is empty [0.22ms]\n@levelcode/backend test: (fail) mainPrompt > should unescape ampersands in run_terminal_command tool calls [0.42ms]\n@levelcode/backend test: (fail) read_docs tool with researcher agent > should handle case when no documentation is found [0.31ms]\n@levelcode/backend test: (fail) read_docs tool with researcher agent > should handle API errors gracefully [0.06ms]\n@levelcode/backend test: (fail) read_docs tool with researcher agent > should include topic in error message when specified [0.05ms]\n@levelcode/backend test: (fail) read_docs tool with researcher agent > should handle non-Error exceptions [0.05ms]\n@levelcode/backend test: (fail) processFileBlockModule > processFileBlock > should handle Windows line endings with multi-line changes [317.18ms]\n@levelcode/backend test: (fail) processFileBlockModule > processFileBlock > should handle multiple diff blocks in a single file [380.38ms]\n@levelcode/backend test: (fail) processFileBlockModule > processFileBlock > should preserve Windows line endings in patch and content [489.82ms]\n@levelcode/backend test: (fail) runProgrammaticStep > tool execution > should execute single tool call [0.31ms]\n@levelcode/backend test: (fail) runProgrammaticStep > tool execution > should add find_files tool result to messageHistory [1.32ms]\n@levelcode/backend test: (fail) runProgrammaticStep > tool execution > should execute multiple tool calls in sequence [0.21ms]\n@levelcode/backend test: (fail) runProgrammaticStep > tool execution > should comprehensively test STEP_ALL functionality with multiple tools and state management [0.33ms]\n@levelcode/backend test: (fail) runProgrammaticStep > tool execution > should pass tool results back to generator [0.15ms]\n@levelcode/backend test: (fail) runProgrammaticStep > generator control flow > should handle STEP value to break execution [0.10ms]\n@levelcode/backend test: (fail) runProgrammaticStep > generator control flow > should end turn when end_turn tool is called [0.12ms]\n@levelcode/backend test: (fail) runProgrammaticStep > state management > should preserve agent state changes [0.07ms]\n@levelcode/backend test: (fail) runProgrammaticStep > state management > should preserve message history [0.10ms]\n@levelcode/backend test: (fail) runProgrammaticStep > error handling > should handle tool execution errors [0.13ms]\n@levelcode/backend test: (fail) runProgrammaticStep > output schema validation > should validate output against outputSchema when using setOutput [0.20ms]\n@levelcode/backend test: (fail) runProgrammaticStep > output schema validation > should work with agents that have no outputSchema [0.17ms]\n@levelcode/backend test: (fail) runProgrammaticStep > output schema validation > should work with outputMode structured_output but no outputSchema defined [0.15ms]\n@levelcode/backend test: (fail) runProgrammaticStep > logging and context > should generate unique agent step ID [0.11ms]\n@levelcode/backend test: (fail) QuickJS Sandbox Generator > should execute string-based generator in QuickJS sandbox [29.84ms]\n@levelcode/backend test: (fail) loopAgentSteps STEP behavior > should verify correct STEP behavior - LLM called once after STEP [1.16ms]\n@levelcode/backend test: \n@levelcode/backend test:  211 pass\n@levelcode/backend test:  7 skip\n@levelcode/backend test:  38 fail\n@levelcode/backend test:  4 errors\n@levelcode/backend test:  518 expect() calls\n@levelcode/backend test: Ran 256 tests across 29 files. [5.14s]\n@levelcode/backend test: Exited with code 1\n",
            "stderr": "$ bun --filter='{@levelcode/backend,@levelcode/common,@levelcode/npm-app}' run test\nerror: script \"test\" exited with code 1\n",
            "exitCode": 1
          }
        }
      ],
      "parentAgentId": "D-1-F0_olPY"
    },
    {
      "type": "text",
      "agentId": "D-1-F0_olPY",
      "text": "**@levelcode/common tests:** 164 passed, 1 skipped, 0 failed. Ran 165 tests across 10 files in 517ms. Exited with code 0.\n\n**@levelcode/backend tests:** 211 passed, 7 skipped, **38 failed**, 4 errors. Ran 256 tests across 29 files in 5.14s. Exited with code 1.\n\n**Key failures/errors:**\n- `sandbox-generator.test.ts`: QuickJS Sandbox Generator > should execute string-based generator in QuickJS sandbox (expect mismatch on agentState.output; received error: \"Cannot access 'sendMessage' before initialization\").\n- `loop-agent-steps.test.ts`: loopAgentSteps STEP behavior > should verify correct STEP behavior (ReferenceError: Cannot access 'asyncAgentManager' before initialization).\n- Unhandled errors: TypeError in `dry-run.ts` (AGENT_PERSONAS.dry_run undefined); ReferenceError in `mock-modules.ts` and `run-agent-step.ts`.\n- 38 total fails including: runAgentStep (set_output tool cases), mainPrompt (file updates, terminal commands, etc.), processFileBlockModule (Windows line endings, multi-line changes), runProgrammaticStep (tool execution, STEP_ALL, errors).\n\nOverall exit code: 1 (due to backend failures)."
    },
    {
      "type": "subagent_finish",
      "agentId": "D-1-F0_olPY",
      "agentType": "commander-lite",
      "displayName": "Commander Lite",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Run relevant package tests if any affected.",
      "params": {
        "command": "bun run test",
        "timeout_seconds": 120
      }
    },
    {
      "type": "tool_result",
      "toolCallId": "0c636b39-7349-4e7a-85b2-477c2680fda3",
      "toolName": "run_terminal_command",
      "output": [
        {
          "type": "json",
          "value": {
            "command": "bun run format --check",
            "stdout": "Checking formatting...\n",
            "stderr": "$ prettier --write \"**/*.{ts,tsx,json,md}\" --check\n[warn] backend/src/templates/agents/agent-builder.ts\n[warn] backend/src/tools/definitions/tool/spawn-agent-inline.ts\n[warn] backend/src/util/messages.ts\n[warn] common/src/db/migrations/meta/_journal.json\n[warn] common/src/db/migrations/meta/0027_snapshot.json\n[warn] common/src/db/migrations/meta/0028_snapshot.json\n[warn] common/src/tools/params/tool/spawn-agent-inline.ts\n[warn] common/src/util/error.ts\n[warn] scripts/convert-escaped-newlines.ts\n[warn] sdk/CHANGELOG.md\n[warn] sdk/PUBLISHING.md\n[warn] sdk/src/tools/read-files.ts\n[warn] web/src/app/api/agents/route.ts\n[warn] web/src/app/api/orgs/[orgId]/publishers/route.ts\n[warn] web/src/app/api/publishers/[id]/organization/route.ts\n[warn] web/src/components/publisher/basic-info-step.tsx\n[warn] web/src/components/publisher/step-template.tsx\n[warn] web/src/hooks/use-user-profile.ts\n[warn] web/src/lib/publisher-permissions.ts\n[warn] Code style issues fixed in 19 files.\n",
            "exitCode": 0
          }
        }
      ],
      "parentAgentId": "D-1-F9QrDRM"
    },
    {
      "type": "tool_result",
      "toolCallId": "7406ef13-feaa-4621-8d92-44c6500769ca",
      "toolName": "run_terminal_command",
      "output": [
        {
          "type": "json",
          "value": {
            "command": "bun run typecheck",
            "stdout": "@levelcode/code-map typecheck: Exited with code 0\n@levelcode/bigquery typecheck: Exited with code 0\n@levelcode/sdk typecheck: Exited with code 0\n@levelcode/internal typecheck: Exited with code 0\n@levelcode/billing typecheck: Exited with code 0\n@levelcode/npm-app typecheck: Exited with code 0\n@levelcode/common typecheck: Exited with code 0\n@levelcode/scripts typecheck: ../backend/src/templates/agents/agent-builder.ts(90,3): error TS2741: Property 'spawnableAgents' is missing in type '{ model: Model; displayName: string; spawnPurposePrompt: string; inputSchema: { prompt: ZodOptional<ZodString>; params: ZodOptional<ZodObject<{ name: ZodOptional<ZodString>; purpose: ZodOptional<...>; specialty: ZodOptional<...>; model: ZodOptional<...>; }, $loose>>; }; ... 6 more ...; handleSteps: () => Generator<....' but required in type 'Omit<AgentTemplate, \"id\">'.\n@levelcode/scripts typecheck: ../backend/src/templates/agents/archive/dry-run.ts(11,31): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; readonly base_lite: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; .....'.\n@levelcode/scripts typecheck: ../backend/src/templates/agents/archive/dry-run.ts(12,38): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; readonly base_lite: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; .....'.\n@levelcode/scripts typecheck: Exited with code 2\n@levelcode/backend typecheck: src/templates/agents/agent-builder.ts(90,3): error TS2741: Property 'spawnableAgents' is missing in type '{ model: Model; displayName: string; spawnPurposePrompt: string; inputSchema: { prompt: ZodOptional<ZodString>; params: ZodOptional<ZodObject<{ name: ZodOptional<ZodString>; purpose: ZodOptional<...>; specialty: ZodOptional<...>; model: ZodOptional<...>; }, $loose>>; }; ... 6 more ...; handleSteps: () => Generator<....' but required in type 'Omit<AgentTemplate, \"id\">'.\n@levelcode/backend typecheck: src/templates/agents/archive/dry-run.ts(11,31): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; readonly base_lite: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; .....'.\n@levelcode/backend typecheck: src/templates/agents/archive/dry-run.ts(12,38): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; readonly base_lite: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; .....'.\n@levelcode/backend typecheck: Exited with code 2\n@levelcode/evals typecheck: ../backend/src/templates/agents/agent-builder.ts(90,3): error TS2741: Property 'spawnableAgents' is missing in type '{ model: Model; displayName: string; spawnPurposePrompt: string; inputSchema: { prompt: ZodOptional<ZodString>; params: ZodOptional<ZodObject<{ name: ZodOptional<ZodString>; purpose: ZodOptional<...>; specialty: ZodOptional<...>; model: ZodOptional<...>; }, $loose>>; }; ... 6 more ...; handleSteps: () => Generator<....' but required in type 'Omit<AgentTemplate, \"id\">'.\n@levelcode/evals typecheck: ../backend/src/templates/agents/archive/dry-run.ts(11,31): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; readonly base_lite: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; .....'.\n@levelcode/evals typecheck: ../backend/src/templates/agents/archive/dry-run.ts(12,38): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; readonly base_lite: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; .....'.\n@levelcode/evals typecheck: Exited with code 2\n@levelcode/web typecheck: Exited with code 0\n",
            "stderr": "$ bun --filter='*' run typecheck && echo ' All type checks passed!'\n",
            "exitCode": 2
          }
        }
      ],
      "parentAgentId": "D-1-F5QYws4"
    },
    {
      "type": "text",
      "agentId": "D-1-F9QrDRM",
      "text": "**Formatting check results:** Issues detected in 19 files (listed with [warn]):\n\n- `backend/src/templates/agents/agent-builder.ts`\n- `backend/src/tools/definitions/tool/spawn-agent-inline.ts`\n- `backend/src/util/messages.ts`\n- `common/src/db/migrations/meta/_journal.json`\n- `common/src/db/migrations/meta/0027_snapshot.json`\n- `common/src/db/migrations/meta/0028_snapshot.json`\n- `common/src/tools/params/tool/spawn-agent-inline.ts`\n- `common/src/util/error.ts`\n- `scripts/convert-escaped-newlines.ts`\n- `sdk/CHANGELOG.md`\n- `sdk/PUBLISHING.md`\n- `sdk/src/tools/read-files.ts`\n- `web/src/app/api/agents/route.ts`\n- `web/src/app/api/orgs/[orgId]/publishers/route.ts`\n- `web/src/app/api/publishers/[id]/organization/route.ts`\n- `web/src/components/publisher/basic-info-step.tsx`\n- `web/src/components/publisher/step-template.tsx`\n- `web/src/hooks/use-user-profile.ts`\n- `web/src/lib/publisher-permissions.ts`\n\nOutput notes: \"Code style issues fixed in 19 files.\" (exit code: 0)"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-1-F9QrDRM",
      "agentType": "commander-lite",
      "displayName": "Commander Lite",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Check if any formatting issues.",
      "params": {
        "command": "bun run format --check",
        "timeout_seconds": 60
      }
    },
    {
      "type": "text",
      "agentId": "D-1-F5QYws4",
      "text": "Typecheck failed with overall exit code 2.\n\n**Packages that passed (exit code 0):**\n- @levelcode/code-map\n- @levelcode/bigquery\n- @levelcode/sdk\n- @levelcode/internal\n- @levelcode/billing\n- @levelcode/npm-app\n- @levelcode/common\n- @levelcode/web\n\n**Packages that failed (exit code 2):**\n- @levelcode/scripts\n- @levelcode/backend\n- @levelcode/evals\n\n**Errors (repeated across failed packages):**\n- `../backend/src/templates/agents/agent-builder.ts(90,3): error TS2741: Property 'spawnableAgents' is missing in type '{ model: Model; displayName: string; ... }' but required in type 'Omit<AgentTemplate, \"id\">'`\n- `../backend/src/templates/agents/archive/dry-run.ts(11,31): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { ... }; ... }'`\n- `../backend/src/templates/agents/archive/dry-run.ts(12,38): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { ... }; ... }'`"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-1-F5QYws4",
      "agentType": "commander-lite",
      "displayName": "Commander Lite",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Run root typecheck to validate TypeScript changes.",
      "params": {
        "command": "bun run typecheck",
        "timeout_seconds": 120
      }
    },
    {
      "type": "tool_result",
      "toolCallId": "D-oYtCzzjlw",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Commander Lite",
              "agentType": "commander-lite",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "Typecheck failed with overall exit code 2.\n\n**Packages that passed (exit code 0):**\n- @levelcode/code-map\n- @levelcode/bigquery\n- @levelcode/sdk\n- @levelcode/internal\n- @levelcode/billing\n- @levelcode/npm-app\n- @levelcode/common\n- @levelcode/web\n\n**Packages that failed (exit code 2):**\n- @levelcode/scripts\n- @levelcode/backend\n- @levelcode/evals\n\n**Errors (repeated across failed packages):**\n- `../backend/src/templates/agents/agent-builder.ts(90,3): error TS2741: Property 'spawnableAgents' is missing in type '{ model: Model; displayName: string; ... }' but required in type 'Omit<AgentTemplate, \"id\">'`\n- `../backend/src/templates/agents/archive/dry-run.ts(11,31): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { ... }; ... }'`\n- `../backend/src/templates/agents/archive/dry-run.ts(12,38): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { ... }; ... }'`"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "agentName": "Commander Lite",
              "agentType": "commander-lite",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "**@levelcode/common tests:** 164 passed, 1 skipped, 0 failed. Ran 165 tests across 10 files in 517ms. Exited with code 0.\n\n**@levelcode/backend tests:** 211 passed, 7 skipped, **38 failed**, 4 errors. Ran 256 tests across 29 files in 5.14s. Exited with code 1.\n\n**Key failures/errors:**\n- `sandbox-generator.test.ts`: QuickJS Sandbox Generator > should execute string-based generator in QuickJS sandbox (expect mismatch on agentState.output; received error: \"Cannot access 'sendMessage' before initialization\").\n- `loop-agent-steps.test.ts`: loopAgentSteps STEP behavior > should verify correct STEP behavior (ReferenceError: Cannot access 'asyncAgentManager' before initialization).\n- Unhandled errors: TypeError in `dry-run.ts` (AGENT_PERSONAS.dry_run undefined); ReferenceError in `mock-modules.ts` and `run-agent-step.ts`.\n- 38 total fails including: runAgentStep (set_output tool cases), mainPrompt (file updates, terminal commands, etc.), processFileBlockModule (Windows line endings, multi-line changes), runProgrammaticStep (tool execution, STEP_ALL, errors).\n\nOverall exit code: 1 (due to backend failures)."
                      }
                    ]
                  }
                ]
              }
            },
            {
              "agentName": "Commander Lite",
              "agentType": "commander-lite",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "**Formatting check results:** Issues detected in 19 files (listed with [warn]):\n\n- `backend/src/templates/agents/agent-builder.ts`\n- `backend/src/tools/definitions/tool/spawn-agent-inline.ts`\n- `backend/src/util/messages.ts`\n- `common/src/db/migrations/meta/_journal.json`\n- `common/src/db/migrations/meta/0027_snapshot.json`\n- `common/src/db/migrations/meta/0028_snapshot.json`\n- `common/src/tools/params/tool/spawn-agent-inline.ts`\n- `common/src/util/error.ts`\n- `scripts/convert-escaped-newlines.ts`\n- `sdk/CHANGELOG.md`\n- `sdk/PUBLISHING.md`\n- `sdk/src/tools/read-files.ts`\n- `web/src/app/api/agents/route.ts`\n- `web/src/app/api/orgs/[orgId]/publishers/route.ts`\n- `web/src/app/api/publishers/[id]/organization/route.ts`\n- `web/src/components/publisher/basic-info-step.tsx`\n- `web/src/components/publisher/step-template.tsx`\n- `web/src/hooks/use-user-profile.ts`\n- `web/src/lib/publisher-permissions.ts`\n\nOutput notes: \"Code style issues fixed in 19 files.\" (exit code: 0)"
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "cf7df9fe-7f13-407b-8128-c85e3a1790d8",
      "toolName": "spawn_agent_inline",
      "input": {
        "agent_type": "context-pruner",
        "params": {}
      },
      "agentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "cf7df9fe-7f13-407b-8128-c85e3a1790d8",
      "toolName": "spawn_agent_inline",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Agent spawned."
          }
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "D-4BkL8ykig",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "editor-gpt-5"
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "D-4DhNpiT3A",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "commander-lite",
            "prompt": "Run root typecheck after fixes.",
            "params": {
              "command": "bun run typecheck",
              "timeout_seconds": 120
            }
          },
          {
            "agent_type": "commander-lite",
            "prompt": "Format all files.",
            "params": {
              "command": "bun run format",
              "timeout_seconds": 60
            }
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-4DyHWn7Os",
      "agentType": "editor-gpt-5",
      "displayName": "Code Editor",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": ""
    },
    {
      "type": "error",
      "message": "Tool `read_files` is not currently available. Make sure to only use tools listed in the system instructions.",
      "agentId": "D-4DyHWn7Os"
    },
    {
      "type": "tool_call",
      "toolCallId": "099441fb-4006-44ea-a837-1c18ee1e14e2",
      "toolName": "set_output",
      "input": {
        "output": {
          "message": "",
          "toolResults": []
        }
      },
      "agentId": "D-4DyHWn7Os",
      "parentAgentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "099441fb-4006-44ea-a837-1c18ee1e14e2",
      "toolName": "set_output",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Output set"
          }
        }
      ],
      "parentAgentId": "D-4DyHWn7Os"
    },
    {
      "type": "subagent_finish",
      "agentId": "D-4DyHWn7Os",
      "agentType": "editor-gpt-5",
      "displayName": "Code Editor",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": ""
    },
    {
      "type": "tool_result",
      "toolCallId": "D-4BkL8ykig",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Code Editor",
              "agentType": "editor-gpt-5",
              "value": {
                "type": "structuredOutput",
                "value": {
                  "output": {
                    "message": "",
                    "toolResults": []
                  }
                }
              }
            }
          ]
        }
      ]
    },
    {
      "type": "subagent_start",
      "agentId": "D-47hYldaEo",
      "agentType": "commander-lite",
      "displayName": "Commander Lite",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Run root typecheck after fixes.",
      "params": {
        "command": "bun run typecheck",
        "timeout_seconds": 120
      }
    },
    {
      "type": "subagent_start",
      "agentId": "D-47hUftbfs",
      "agentType": "commander-lite",
      "displayName": "Commander Lite",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Format all files.",
      "params": {
        "command": "bun run format",
        "timeout_seconds": 60
      }
    },
    {
      "type": "tool_call",
      "toolCallId": "57a8298e-53c9-420a-b4b1-d326cf847393",
      "toolName": "run_terminal_command",
      "input": {
        "command": "bun run typecheck",
        "timeout_seconds": 120
      },
      "agentId": "D-47hYldaEo",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "9bc06224-f77d-4edf-9c40-d6d3986cfe64",
      "toolName": "run_terminal_command",
      "input": {
        "command": "bun run format",
        "timeout_seconds": 60
      },
      "agentId": "D-47hUftbfs",
      "parentAgentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_result",
      "toolCallId": "57a8298e-53c9-420a-b4b1-d326cf847393",
      "toolName": "run_terminal_command",
      "output": [
        {
          "type": "json",
          "value": {
            "command": "bun run typecheck",
            "stdout": "@levelcode/code-map typecheck: Exited with code 0\n@levelcode/sdk typecheck: Exited with code 0\n@levelcode/bigquery typecheck: Exited with code 0\n@levelcode/internal typecheck: Exited with code 0\n@levelcode/billing typecheck: Exited with code 0\n@levelcode/npm-app typecheck: Exited with code 0\n@levelcode/common typecheck: Exited with code 0\n@levelcode/scripts typecheck: ../backend/src/templates/agents/agent-builder.ts(93,3): error TS2741: Property 'spawnableAgents' is missing in type '{ model: Model; displayName: string; spawnPurposePrompt: string; inputSchema: { prompt: ZodOptional<ZodString>; params: ZodOptional<ZodObject<{ name: ZodOptional<ZodString>; purpose: ZodOptional<...>; specialty: ZodOptional<...>; model: ZodOptional<...>; }, $loose>>; }; ... 6 more ...; handleSteps: () => Generator<....' but required in type 'Omit<AgentTemplate, \"id\">'.\n@levelcode/scripts typecheck: ../backend/src/templates/agents/archive/dry-run.ts(11,31): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; readonly base_lite: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; .....'.\n@levelcode/scripts typecheck: ../backend/src/templates/agents/archive/dry-run.ts(12,38): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; readonly base_lite: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; .....'.\n@levelcode/scripts typecheck: Exited with code 2\n@levelcode/web typecheck: Exited with code 0\n@levelcode/backend typecheck: src/templates/agents/agent-builder.ts(93,3): error TS2741: Property 'spawnableAgents' is missing in type '{ model: Model; displayName: string; spawnPurposePrompt: string; inputSchema: { prompt: ZodOptional<ZodString>; params: ZodOptional<ZodObject<{ name: ZodOptional<ZodString>; purpose: ZodOptional<...>; specialty: ZodOptional<...>; model: ZodOptional<...>; }, $loose>>; }; ... 6 more ...; handleSteps: () => Generator<....' but required in type 'Omit<AgentTemplate, \"id\">'.\n@levelcode/backend typecheck: src/templates/agents/archive/dry-run.ts(11,31): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; readonly base_lite: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; .....'.\n@levelcode/backend typecheck: src/templates/agents/archive/dry-run.ts(12,38): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; readonly base_lite: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; .....'.\n@levelcode/backend typecheck: Exited with code 2\n@levelcode/evals typecheck: ../backend/src/templates/agents/agent-builder.ts(93,3): error TS2741: Property 'spawnableAgents' is missing in type '{ model: Model; displayName: string; spawnPurposePrompt: string; inputSchema: { prompt: ZodOptional<ZodString>; params: ZodOptional<ZodObject<{ name: ZodOptional<ZodString>; purpose: ZodOptional<...>; specialty: ZodOptional<...>; model: ZodOptional<...>; }, $loose>>; }; ... 6 more ...; handleSteps: () => Generator<....' but required in type 'Omit<AgentTemplate, \"id\">'.\n@levelcode/evals typecheck: ../backend/src/templates/agents/archive/dry-run.ts(11,31): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; readonly base_lite: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; .....'.\n@levelcode/evals typecheck: ../backend/src/templates/agents/archive/dry-run.ts(12,38): error TS2339: Property 'dry_run' does not exist on type '{ readonly base: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; readonly base_lite: { readonly displayName: \"Buffy the Enthusiastic Coding Assistant\"; readonly purpose: \"Base agent that orchestrates the full response.\"; }; .....'.\n@levelcode/evals typecheck: Exited with code 2\n",
            "stderr": "$ bun --filter='*' run typecheck && echo ' All type checks passed!'\n",
            "exitCode": 2
          }
        }
      ],
      "parentAgentId": "D-47hYldaEo"
    },
    {
      "type": "tool_result",
      "toolCallId": "9bc06224-f77d-4edf-9c40-d6d3986cfe64",
      "toolName": "run_terminal_command",
      "output": [
        {
          "type": "json",
          "value": {
            "command": "bun run format",
            "stdout": ".agents/ask.ts 516ms (unchanged)\n.agents/base-experimental.ts 5ms (unchanged)\n.agents/base-lite.ts 37ms (unchanged)\n.agents/base-max.ts 14ms (unchanged)\n.agents/base.ts 7ms (unchanged)\n.agents/brainstormer.ts 4ms (unchanged)\n.agents/changes-reviewer.ts 140ms (unchanged)\n.agents/charles.ts 3ms (unchanged)\n.agents/claude4-gemini-thinking.ts 7ms (unchanged)\n.agents/constants.ts 1ms (unchanged)\n.agents/examples/diff-reviewer-1.ts 2ms (unchanged)\n.agents/examples/diff-reviewer-2.ts 4ms (unchanged)\n.agents/examples/diff-reviewer-3.ts 5ms (unchanged)\n.agents/file-explorer.ts 5ms (unchanged)\n.agents/file-picker.ts 2ms (unchanged)\n.agents/git-committer.ts 3ms (unchanged)\n.agents/knowledge-keeper.ts 3ms (unchanged)\n.agents/opensource/base.ts 2ms (unchanged)\n.agents/opensource/coder.ts 3ms (unchanged)\n.agents/opensource/file-picker.ts 113ms (unchanged)\n.agents/opensource/researcher.ts 4ms (unchanged)\n.agents/opensource/reviewer.ts 23ms (unchanged)\n.agents/opensource/thinker.ts 6ms (unchanged)\n.agents/planner.ts 2ms (unchanged)\n.agents/researcher.ts 11ms (unchanged)\n.agents/reviewer.ts 6ms (unchanged)\n.agents/superagent.ts 2ms (unchanged)\n.agents/thinker.ts 9ms (unchanged)\n.agents/types/agent-definition.d.ts 53ms (unchanged)\n.agents/types/tools.d.ts 10ms (unchanged)\n.agents/your-custom-agent.ts 7ms (unchanged)\n.github/knowledge.md 239ms (unchanged)\n.infisical.json 99ms (unchanged)\n.vscode/settings.json 2ms (unchanged)\nauthentication.knowledge.md 12ms (unchanged)\nbackend/knowledge.md 18ms (unchanged)\nbackend/package.json 2ms (unchanged)\nbackend/README.md 5ms (unchanged)\nbackend/src/__tests__/agent-id-resolution.test.ts 150ms (unchanged)\nbackend/src/__tests__/agent-registry.test.ts 64ms (unchanged)\nbackend/src/__tests__/auto-topup.test.ts 23ms (unchanged)\nbackend/src/__tests__/credit-conversion.test.ts 9ms (unchanged)\nbackend/src/__tests__/fast-rewrite.test.ts 10ms (unchanged)\nbackend/src/__tests__/generate-diffs-prompt.test.ts 8ms (unchanged)\nbackend/src/__tests__/get-custom-file-picker-config.test.ts 10ms (unchanged)\nbackend/src/__tests__/live-user-inputs.test.ts 9ms (unchanged)\nbackend/src/__tests__/loop-agent-steps.test.ts 39ms (unchanged)\nbackend/src/__tests__/main-prompt.integration.test.ts 193ms (unchanged)\nbackend/src/__tests__/main-prompt.test.ts 173ms (unchanged)\nbackend/src/__tests__/process-file-block.test.ts 160ms (unchanged)\nbackend/src/__tests__/process-str-replace.test.ts 79ms (unchanged)\nbackend/src/__tests__/read-docs-tool.test.ts 35ms (unchanged)\nbackend/src/__tests__/request-files-prompt.test.ts 25ms (unchanged)\nbackend/src/__tests__/run-agent-step-tools.test.ts 202ms (unchanged)\nbackend/src/__tests__/run-programmatic-step.test.ts 331ms (unchanged)\nbackend/src/__tests__/sandbox-generator.test.ts 5ms (unchanged)\nbackend/src/__tests__/subagent-streaming.test.ts 15ms (unchanged)\nbackend/src/__tests__/test-utils.ts 4ms (unchanged)\nbackend/src/__tests__/tool-call-schema.test.ts 91ms (unchanged)\nbackend/src/__tests__/usage-calculation.test.ts 16ms (unchanged)\nbackend/src/__tests__/web-search-tool.test.ts 118ms (unchanged)\nbackend/src/__tests__/xml-stream-parser.test.ts 59ms (unchanged)\nbackend/src/admin/grade-runs.ts 9ms (unchanged)\nbackend/src/admin/relabelRuns.ts 125ms (unchanged)\nbackend/src/api/org.ts 7ms (unchanged)\nbackend/src/api/usage.ts 4ms (unchanged)\nbackend/src/async-agent-manager.ts 32ms (unchanged)\nbackend/src/check-terminal-command.ts 6ms (unchanged)\nbackend/src/context/app-context.ts 9ms (unchanged)\nbackend/src/fast-rewrite.ts 8ms (unchanged)\nbackend/src/find-files/check-new-files-necessary.ts 3ms (unchanged)\nbackend/src/find-files/custom-file-picker-config.ts 9ms (unchanged)\nbackend/src/find-files/request-files-prompt.ts 151ms (unchanged)\nbackend/src/generate-diffs-prompt.ts 19ms (unchanged)\nbackend/src/get-documentation-for-query.ts 21ms (unchanged)\nbackend/src/get-file-reading-updates.ts 8ms (unchanged)\nbackend/src/index.ts 11ms (unchanged)\nbackend/src/live-user-inputs.ts 10ms (unchanged)\nbackend/src/llm-apis/__tests__/linkup-api.test.ts 23ms (unchanged)\nbackend/src/llm-apis/claude.ts 2ms (unchanged)\nbackend/src/llm-apis/context7-api.ts 81ms (unchanged)\nbackend/src/llm-apis/gemini-with-fallbacks.ts 6ms (unchanged)\nbackend/src/llm-apis/knowledge.md 6ms (unchanged)\nbackend/src/llm-apis/linkup-api.ts 16ms (unchanged)\nbackend/src/llm-apis/message-cost-tracker.ts 66ms (unchanged)\nbackend/src/llm-apis/openai-api.ts 3ms (unchanged)\nbackend/src/llm-apis/openrouter.ts 2ms (unchanged)\nbackend/src/llm-apis/relace-api.ts 6ms (unchanged)\nbackend/src/llm-apis/vercel-ai-sdk/ai-sdk.ts 28ms (unchanged)\nbackend/src/llm-apis/vercel-ai-sdk/openrouter.ts 1ms (unchanged)\nbackend/src/llm-apis/vercel-ai-sdk/vertex-finetuned.ts 16ms (unchanged)\nbackend/src/loop-main-prompt.ts 2ms (unchanged)\nbackend/src/main-prompt.ts 17ms (unchanged)\nbackend/src/process-file-block.ts 11ms (unchanged)\nbackend/src/process-str-replace.ts 8ms (unchanged)\nbackend/src/prompt-agent-stream.ts 4ms (unchanged)\nbackend/src/run-agent-step.ts 47ms (unchanged)\nbackend/src/run-programmatic-step.ts 13ms (unchanged)\nbackend/src/system-prompt/agent-instructions.md 143ms (unchanged)\nbackend/src/system-prompt/prompts.ts 5ms (unchanged)\nbackend/src/system-prompt/save-agent-request.ts 3ms (unchanged)\nbackend/src/system-prompt/search-system-prompt.ts 5ms (unchanged)\nbackend/src/system-prompt/truncate-file-tree.ts 134ms (unchanged)\nbackend/src/templates/agent-list.ts 3ms (unchanged)\nbackend/src/templates/agent-registry.ts 11ms (unchanged)\nbackend/src/templates/agents/agent-builder.ts 6ms (unchanged)\nbackend/src/templates/agents/archive/dry-run.ts 4ms (unchanged)\nbackend/src/templates/agents/ask.ts 2ms (unchanged)\nbackend/src/templates/agents/base.ts 3ms (unchanged)\nbackend/src/templates/agents/file-explorer.ts 4ms (unchanged)\nbackend/src/templates/agents/file-picker.ts 1ms (unchanged)\nbackend/src/templates/agents/planner.ts 4ms (unchanged)\nbackend/src/templates/agents/researcher.ts 2ms (unchanged)\nbackend/src/templates/agents/reviewer.ts 3ms (unchanged)\nbackend/src/templates/agents/superagent.ts 2ms (unchanged)\nbackend/src/templates/agents/thinker.ts 3ms (unchanged)\nbackend/src/templates/agents/thinking-base.ts 2ms (unchanged)\nbackend/src/templates/ask-prompts.ts 4ms (unchanged)\nbackend/src/templates/base-prompts.ts 6ms (unchanged)\nbackend/src/templates/prompts.ts 3ms (unchanged)\nbackend/src/templates/README.md 149ms (unchanged)\nbackend/src/templates/strings.ts 18ms (unchanged)\nbackend/src/templates/types.ts 12ms (unchanged)\nbackend/src/tools/constants.ts 4ms (unchanged)\nbackend/src/tools/definitions/list.ts 7ms (unchanged)\nbackend/src/tools/definitions/tool-def-type.ts 1ms (unchanged)\nbackend/src/tools/definitions/tool/add-message.ts 3ms (unchanged)\nbackend/src/tools/definitions/tool/add-subgoal.ts 12ms (unchanged)\nbackend/src/tools/definitions/tool/browser-logs.ts 1ms (unchanged)\nbackend/src/tools/definitions/tool/code-search.ts 1ms (unchanged)\nbackend/src/tools/definitions/tool/create-plan.ts 1ms (unchanged)\nbackend/src/tools/definitions/tool/end-turn.ts 7ms (unchanged)\nbackend/src/tools/definitions/tool/find-files.ts 2ms (unchanged)\nbackend/src/tools/definitions/tool/read-docs.ts 2ms (unchanged)\nbackend/src/tools/definitions/tool/read-files.ts 19ms (unchanged)\nbackend/src/tools/definitions/tool/run-file-change-hooks.ts 10ms (unchanged)\nbackend/src/tools/definitions/tool/run-terminal-command.ts 3ms (unchanged)\nbackend/src/tools/definitions/tool/set-messages.ts 3ms (unchanged)\nbackend/src/tools/definitions/tool/set-output.ts 2ms (unchanged)\nbackend/src/tools/definitions/tool/spawn-agent-inline.ts 3ms (unchanged)\nbackend/src/tools/definitions/tool/spawn-agents-async.ts 2ms (unchanged)\nbackend/src/tools/definitions/tool/spawn-agents.ts 1ms (unchanged)\nbackend/src/tools/definitions/tool/str-replace.ts 1ms (unchanged)\nbackend/src/tools/definitions/tool/think-deeply.ts 3ms (unchanged)\nbackend/src/tools/definitions/tool/update-subgoal.ts 1ms (unchanged)\nbackend/src/tools/definitions/tool/web-search.ts 4ms (unchanged)\nbackend/src/tools/definitions/tool/write-file.ts 1ms (unchanged)\nbackend/src/tools/handlers/handler-function-type.ts 7ms (unchanged)\nbackend/src/tools/handlers/list.ts 1ms (unchanged)\nbackend/src/tools/handlers/tool/add-message.ts 6ms (unchanged)\nbackend/src/tools/handlers/tool/add-subgoal.ts 5ms (unchanged)\nbackend/src/tools/handlers/tool/browser-logs.ts 3ms (unchanged)\nbackend/src/tools/handlers/tool/code-search.ts 2ms (unchanged)\nbackend/src/tools/handlers/tool/create-plan.ts 8ms (unchanged)\nbackend/src/tools/handlers/tool/end-turn.ts 3ms (unchanged)\nbackend/src/tools/handlers/tool/find-files.ts 14ms (unchanged)\nbackend/src/tools/handlers/tool/read-docs.ts 5ms (unchanged)\nbackend/src/tools/handlers/tool/read-files.ts 5ms (unchanged)\nbackend/src/tools/handlers/tool/run-file-change-hooks.ts 2ms (unchanged)\nbackend/src/tools/handlers/tool/run-terminal-command.ts 3ms (unchanged)\nbackend/src/tools/handlers/tool/set-messages.ts 3ms (unchanged)\nbackend/src/tools/handlers/tool/set-output.ts 5ms (unchanged)\nbackend/src/tools/handlers/tool/spawn-agent-inline.ts 7ms (unchanged)\nbackend/src/tools/handlers/tool/spawn-agents-async.ts 12ms (unchanged)\nbackend/src/tools/handlers/tool/spawn-agents.ts 11ms (unchanged)\nbackend/src/tools/handlers/tool/str-replace.ts 4ms (unchanged)\nbackend/src/tools/handlers/tool/think-deeply.ts 2ms (unchanged)\nbackend/src/tools/handlers/tool/update-subgoal.ts 6ms (unchanged)\nbackend/src/tools/handlers/tool/web-search.ts 6ms (unchanged)\nbackend/src/tools/handlers/tool/write-file.ts 11ms (unchanged)\nbackend/src/tools/prompts.ts 4ms (unchanged)\nbackend/src/tools/stream-parser.ts 5ms (unchanged)\nbackend/src/tools/tool-executor.ts 85ms (unchanged)\nbackend/src/util/__tests__/messages.test.ts 43ms (unchanged)\nbackend/src/util/__tests__/object.test.ts 63ms (unchanged)\nbackend/src/util/__tests__/parse-tool-call-xml.test.ts 19ms (unchanged)\nbackend/src/util/__tests__/simplify-tool-results.test.ts 63ms (unchanged)\nbackend/src/util/__tests__/split-data.test.ts 42ms (unchanged)\nbackend/src/util/check-auth.ts 9ms (unchanged)\nbackend/src/util/debug.ts 3ms (unchanged)\nbackend/src/util/file-resolver.ts 6ms (unchanged)\nbackend/src/util/logger.ts 5ms (unchanged)\nbackend/src/util/messages.ts 12ms (unchanged)\nbackend/src/util/object.ts 2ms (unchanged)\nbackend/src/util/parse-tool-call-xml.ts 5ms (unchanged)\nbackend/src/util/quickjs-sandbox.ts 12ms (unchanged)\nbackend/src/util/simplify-tool-results.ts 2ms (unchanged)\nbackend/src/util/split-data.ts 9ms (unchanged)\nbackend/src/util/token-counter.ts 2ms (unchanged)\nbackend/src/websockets/auth.ts 10ms (unchanged)\nbackend/src/websockets/middleware.ts 46ms (unchanged)\nbackend/src/websockets/request-context.ts 12ms (unchanged)\nbackend/src/websockets/server.ts 6ms (unchanged)\nbackend/src/websockets/switchboard.ts 5ms (unchanged)\nbackend/src/websockets/websocket-action.ts 67ms (unchanged)\nbackend/src/xml-stream-parser.ts 9ms (unchanged)\nbackend/tsconfig.json 3ms (unchanged)\nlevelcode.json 4ms (unchanged)\ncommon/knowledge.md 5ms (unchanged)\ncommon/package.json 1ms (unchanged)\ncommon/src/__tests__/agent-validation.test.ts 126ms (unchanged)\ncommon/src/__tests__/dynamic-agent-template-schema.test.ts 9ms (unchanged)\ncommon/src/__tests__/handlesteps-parsing.test.ts 9ms (unchanged)\ncommon/src/actions.ts 9ms (unchanged)\ncommon/src/analytics.ts 7ms (unchanged)\ncommon/src/api-keys/constants.ts 1ms (unchanged)\ncommon/src/api-keys/crypto.ts 14ms (unchanged)\ncommon/src/browser-actions.ts 89ms (unchanged)\ncommon/src/constants.ts 18ms (unchanged)\ncommon/src/constants/agents.ts 6ms (unchanged)\ncommon/src/constants/analytics-events.ts 4ms (unchanged)\ncommon/src/constants/grant-priorities.ts 2ms (unchanged)\ncommon/src/db/drizzle.config.ts 1ms (unchanged)\ncommon/src/db/index.ts 2ms (unchanged)\ncommon/src/db/migrations/meta/_journal.json 3ms (unchanged)\ncommon/src/db/migrations/meta/0000_snapshot.json 8ms (unchanged)\ncommon/src/db/migrations/meta/0001_snapshot.json 3ms (unchanged)\ncommon/src/db/migrations/meta/0002_snapshot.json 17ms (unchanged)\ncommon/src/db/migrations/meta/0003_snapshot.json 8ms (unchanged)\ncommon/src/db/migrations/meta/0004_snapshot.json 10ms (unchanged)\ncommon/src/db/migrations/meta/0005_snapshot.json 7ms (unchanged)\ncommon/src/db/migrations/meta/0006_snapshot.json 57ms (unchanged)\ncommon/src/db/migrations/meta/0007_snapshot.json 9ms (unchanged)\ncommon/src/db/migrations/meta/0008_snapshot.json 5ms (unchanged)\ncommon/src/db/migrations/meta/0009_snapshot.json 6ms (unchanged)\ncommon/src/db/migrations/meta/0010_snapshot.json 4ms (unchanged)\ncommon/src/db/migrations/meta/0011_snapshot.json 5ms (unchanged)\ncommon/src/db/migrations/meta/0012_snapshot.json 4ms (unchanged)\ncommon/src/db/migrations/meta/0013_snapshot.json 68ms (unchanged)\ncommon/src/db/migrations/meta/0014_snapshot.json 10ms (unchanged)\ncommon/src/db/migrations/meta/0015_snapshot.json 20ms (unchanged)\ncommon/src/db/migrations/meta/0016_snapshot.json 19ms (unchanged)\ncommon/src/db/migrations/meta/0017_snapshot.json 80ms (unchanged)\ncommon/src/db/migrations/meta/0018_snapshot.json 31ms (unchanged)\ncommon/src/db/migrations/meta/0019_snapshot.json 31ms (unchanged)\ncommon/src/db/migrations/meta/0020_snapshot.json 50ms (unchanged)\ncommon/src/db/migrations/meta/0021_snapshot.json 24ms (unchanged)\ncommon/src/db/migrations/meta/0026_snapshot.json 23ms (unchanged)\ncommon/src/db/migrations/meta/0027_snapshot.json 84ms (unchanged)\ncommon/src/db/migrations/meta/0028_snapshot.json 33ms (unchanged)\ncommon/src/db/schema.knowledge.md 14ms (unchanged)\ncommon/src/db/schema.ts 251ms (unchanged)\ncommon/src/db/transaction.ts 10ms (unchanged)\ncommon/src/json-config/__tests__/constants.test.ts 10ms (unchanged)\ncommon/src/json-config/__tests__/stringify-schema.test.ts 3ms (unchanged)\ncommon/src/json-config/constants.ts 6ms (unchanged)\ncommon/src/json-config/default.ts 1ms (unchanged)\ncommon/src/json-config/stringify-schema.ts 10ms (unchanged)\ncommon/src/project-file-tree.ts 14ms (unchanged)\ncommon/src/templates/agent-validation.ts 56ms (unchanged)\ncommon/src/templates/dynamic-agent-functions.ts 4ms (unchanged)\ncommon/src/testing/mock-modules.ts 6ms (unchanged)\ncommon/src/tools/compile-tool-definitions.ts 6ms (unchanged)\ncommon/src/tools/constants.ts 3ms (unchanged)\ncommon/src/tools/list.ts 9ms (unchanged)\ncommon/src/tools/params/tool/add-message.ts 2ms (unchanged)\ncommon/src/tools/params/tool/add-subgoal.ts 1ms (unchanged)\ncommon/src/tools/params/tool/browser-logs.ts 9ms (unchanged)\ncommon/src/tools/params/tool/code-search.ts 5ms (unchanged)\ncommon/src/tools/params/tool/create-plan.ts 3ms (unchanged)\ncommon/src/tools/params/tool/end-turn.ts 1ms (unchanged)\ncommon/src/tools/params/tool/find-files.ts 4ms (unchanged)\ncommon/src/tools/params/tool/read-docs.ts 4ms (unchanged)\ncommon/src/tools/params/tool/read-files.ts 4ms (unchanged)\ncommon/src/tools/params/tool/run-file-change-hooks.ts 1ms (unchanged)\ncommon/src/tools/params/tool/run-terminal-command.ts 2ms (unchanged)\ncommon/src/tools/params/tool/set-messages.ts 3ms (unchanged)\ncommon/src/tools/params/tool/set-output.ts 1ms (unchanged)\ncommon/src/tools/params/tool/spawn-agent-inline.ts 5ms (unchanged)\ncommon/src/tools/params/tool/spawn-agents-async.ts 7ms (unchanged)\ncommon/src/tools/params/tool/spawn-agents.ts 5ms (unchanged)\ncommon/src/tools/params/tool/str-replace.ts 2ms (unchanged)\ncommon/src/tools/params/tool/think-deeply.ts 3ms (unchanged)\ncommon/src/tools/params/tool/update-subgoal.ts 4ms (unchanged)\ncommon/src/tools/params/tool/web-search.ts 23ms (unchanged)\ncommon/src/tools/params/tool/write-file.ts 3ms (unchanged)\ncommon/src/tools/utils.ts 4ms (unchanged)\ncommon/src/types/__tests__/dynamic-agent-template.test.ts 3ms (unchanged)\ncommon/src/types/agent-template.ts 11ms (unchanged)\ncommon/src/types/api/agents/publish.ts 6ms (unchanged)\ncommon/src/types/bun-test.d.ts 1ms (unchanged)\ncommon/src/types/dynamic-agent-template.ts 14ms (unchanged)\ncommon/src/types/grant.ts 2ms (unchanged)\ncommon/src/types/message.ts 3ms (unchanged)\ncommon/src/types/organization.ts 5ms (unchanged)\ncommon/src/types/print-mode.ts 4ms (unchanged)\ncommon/src/types/publisher.ts 4ms (unchanged)\ncommon/src/types/referral.ts 1ms (unchanged)\ncommon/src/types/session-state.ts 52ms (unchanged)\ncommon/src/types/usage.ts 3ms (unchanged)\ncommon/src/util/__tests__/messages.test.ts 5ms (unchanged)\ncommon/src/util/__tests__/partial-json-delta.test.ts 39ms (unchanged)\ncommon/src/util/__tests__/saxy.test.ts 90ms (unchanged)\ncommon/src/util/__tests__/string.test.ts 39ms (unchanged)\ncommon/src/util/agent-file-utils.ts 13ms (unchanged)\ncommon/src/util/agent-name-normalization.ts 2ms (unchanged)\ncommon/src/util/agent-name-resolver.ts 7ms (unchanged)\ncommon/src/util/agent-template-validation.ts 5ms (unchanged)\ncommon/src/util/array.ts 3ms (unchanged)\ncommon/src/util/changes.ts 5ms (unchanged)\ncommon/src/util/credentials.ts 10ms (unchanged)\ncommon/src/util/currency.ts 2ms (unchanged)\ncommon/src/util/dates.ts 1ms (unchanged)\ncommon/src/util/error.ts 2ms (unchanged)\ncommon/src/util/examples/diff-reviewer-1.ts 1ms (unchanged)\ncommon/src/util/examples/diff-reviewer-2.ts 2ms (unchanged)\ncommon/src/util/examples/diff-reviewer-3.ts 4ms (unchanged)\ncommon/src/util/file.ts 17ms (unchanged)\ncommon/src/util/git.ts 2ms (unchanged)\ncommon/src/util/logger.ts 10ms (unchanged)\ncommon/src/util/lru-cache.ts 9ms (unchanged)\ncommon/src/util/messages.ts 14ms (unchanged)\ncommon/src/util/min-heap.ts 8ms (unchanged)\ncommon/src/util/model-utils.ts 3ms (unchanged)\ncommon/src/util/object.ts 8ms (unchanged)\ncommon/src/util/partial-json-delta.ts 8ms (unchanged)\ncommon/src/util/patch.ts 50ms (unchanged)\ncommon/src/util/promise.ts 6ms (unchanged)\ncommon/src/util/random.ts 3ms (unchanged)\ncommon/src/util/referral.ts 2ms (unchanged)\ncommon/src/util/saxy.ts 110ms (unchanged)\ncommon/src/util/string.knowledge.md 10ms (unchanged)\ncommon/src/util/string.ts 28ms (unchanged)\ncommon/src/util/stripe.ts 3ms (unchanged)\ncommon/src/util/sync-failure.ts 4ms (unchanged)\ncommon/src/util/types/agent-definition.d.ts 7ms (unchanged)\ncommon/src/util/types/tools.d.ts 3ms (unchanged)\ncommon/src/util/xml.ts 5ms (unchanged)\ncommon/src/util/zod-schema.ts 4ms (unchanged)\ncommon/src/websockets/websocket-client.ts 72ms (unchanged)\ncommon/src/websockets/websocket-schema.ts 2ms (unchanged)\ncommon/tsconfig.json 0ms (unchanged)\nevals/constants.ts 2ms (unchanged)\nevals/e2e-cat-app-script.ts 96ms (unchanged)\nevals/git-evals/email-eval-results.ts 9ms (unchanged)\nevals/git-evals/eval-levelcode.json 444ms (unchanged)\nevals/git-evals/eval-manifold.json 202ms (unchanged)\nevals/git-evals/eval-result-levelcode-mock.json 190ms (unchanged)\nevals/git-evals/gen-evals.ts 17ms (unchanged)\nevals/git-evals/judge-git-eval.ts 6ms (unchanged)\nevals/git-evals/post-eval-analysis.ts 13ms (unchanged)\nevals/git-evals/run-eval-set.ts 31ms (unchanged)\nevals/git-evals/run-git-evals.ts 26ms (unchanged)\nevals/git-evals/run-single-eval-process.ts 4ms (unchanged)\nevals/git-evals/run-single-eval.ts 13ms (unchanged)\nevals/git-evals/setup-test-repo.ts 8ms (unchanged)\nevals/git-evals/types.ts 5ms (unchanged)\nevals/knowledge.md 3ms (unchanged)\nevals/package.json 0ms (unchanged)\nevals/scaffolding.ts 18ms (unchanged)\nevals/swe-bench-eval.ts 12ms (unchanged)\nevals/swe-bench-ids.ts 6ms (unchanged)\nevals/swe-bench.test.ts 4ms (unchanged)\nevals/test-repos.json 7ms (unchanged)\nevals/test-setup.ts 10ms (unchanged)\nevals/tsconfig.json 1ms (unchanged)\nknowledge.md 83ms (unchanged)\nnpm-app/package.json 1ms (unchanged)\nnpm-app/release-staging/package.json 0ms (unchanged)\nnpm-app/release-staging/README.md 16ms (unchanged)\nnpm-app/release/package.json 0ms (unchanged)\nnpm-app/release/README.md 8ms (unchanged)\nnpm-app/scripts/generate-github-token.ts 13ms (unchanged)\nnpm-app/scripts/patch-web-tree-sitter.ts 8ms (unchanged)\nnpm-app/src/__tests__/display.test.ts 13ms (unchanged)\nnpm-app/src/__tests__/tool-handlers.test.ts 5ms (unchanged)\nnpm-app/src/agents/agent-utils.ts 4ms (unchanged)\nnpm-app/src/agents/load-agents.ts 8ms (unchanged)\nnpm-app/src/background-process-manager.ts 16ms (unchanged)\nnpm-app/src/browser-runner.ts 33ms (unchanged)\nnpm-app/src/chat-storage.ts 5ms (unchanged)\nnpm-app/src/checkpoints/checkpoint-manager.ts 20ms (unchanged)\nnpm-app/src/checkpoints/file-manager.ts 53ms (unchanged)\nnpm-app/src/cli-definitions.ts 7ms (unchanged)\nnpm-app/src/cli-handlers/agent-creation-chat.ts 30ms (unchanged)\nnpm-app/src/cli-handlers/agents.ts 34ms (unchanged)\nnpm-app/src/cli-handlers/api-key.ts 4ms (unchanged)\nnpm-app/src/cli-handlers/checkpoint.ts 17ms (unchanged)\nnpm-app/src/cli-handlers/diff.ts 5ms (unchanged)\nnpm-app/src/cli-handlers/easter-egg.ts 7ms (unchanged)\nnpm-app/src/cli-handlers/inititalization-flow.ts 4ms (unchanged)\nnpm-app/src/cli-handlers/mini-chat.ts 14ms (unchanged)\nnpm-app/src/cli-handlers/publish.ts 6ms (unchanged)\nnpm-app/src/cli-handlers/subagent-list.ts 11ms (unchanged)\nnpm-app/src/cli-handlers/subagent.ts 36ms (unchanged)\nnpm-app/src/cli.ts 75ms (unchanged)\nnpm-app/src/client.ts 96ms (unchanged)\nnpm-app/src/config.ts 3ms (unchanged)\nnpm-app/src/create-template-project.ts 8ms (unchanged)\nnpm-app/src/credentials.ts 4ms (unchanged)\nnpm-app/src/dev-process-manager.ts 3ms (unchanged)\nnpm-app/src/diff-manager.ts 13ms (unchanged)\nnpm-app/src/display/overrides.ts 1ms (unchanged)\nnpm-app/src/display/print-mode.ts 4ms (unchanged)\nnpm-app/src/display/squash-newlines.ts 15ms (unchanged)\nnpm-app/src/fingerprint.ts 3ms (unchanged)\nnpm-app/src/index.ts 10ms (unchanged)\nnpm-app/src/json-config/hooks.ts 4ms (unchanged)\nnpm-app/src/json-config/parser.ts 4ms (unchanged)\nnpm-app/src/menu.ts 14ms (unchanged)\nnpm-app/src/native/ripgrep.ts 4ms (unchanged)\nnpm-app/src/project-files.ts 70ms (unchanged)\nnpm-app/src/rage-detectors.ts 4ms (unchanged)\nnpm-app/src/startup-process-handler.ts 3ms (unchanged)\nnpm-app/src/subagent-storage.ts 10ms (unchanged)\nnpm-app/src/terminal/background.ts 7ms (unchanged)\nnpm-app/src/terminal/run-command.ts 15ms (unchanged)\nnpm-app/src/tool-handlers.ts 12ms (unchanged)\nnpm-app/src/types.ts 2ms (unchanged)\nnpm-app/src/utils/__tests__/background-process-manager.test.ts 13ms (unchanged)\nnpm-app/src/utils/__tests__/rage-detector.test.ts 20ms (unchanged)\nnpm-app/src/utils/__tests__/tool-renderers.test.ts 3ms (unchanged)\nnpm-app/src/utils/__tests__/xml-stream-parser.test.ts 18ms (unchanged)\nnpm-app/src/utils/agent-validation.ts 6ms (unchanged)\nnpm-app/src/utils/analytics.ts 6ms (unchanged)\nnpm-app/src/utils/detect-shell.ts 4ms (unchanged)\nnpm-app/src/utils/git.ts 7ms (unchanged)\nnpm-app/src/utils/logger.ts 9ms (unchanged)\nnpm-app/src/utils/rage-detector.ts 8ms (unchanged)\nnpm-app/src/utils/spinner.ts 6ms (unchanged)\nnpm-app/src/utils/suppress-console.ts 8ms (unchanged)\nnpm-app/src/utils/system-info.ts 3ms (unchanged)\nnpm-app/src/utils/terminal.ts 2ms (unchanged)\nnpm-app/src/utils/tool-renderers.ts 10ms (unchanged)\nnpm-app/src/utils/with-hang-detection.ts 2ms (unchanged)\nnpm-app/src/utils/xml-stream-parser.ts 7ms (unchanged)\nnpm-app/src/web-scraper.ts 3ms (unchanged)\nnpm-app/src/workers/checkpoint-worker.ts 6ms (unchanged)\nnpm-app/src/workers/project-context.ts 1ms (unchanged)\nnpm-app/tsconfig.json 1ms (unchanged)\npackage.json 0ms (unchanged)\npackages/bigquery/knowledge.md 6ms (unchanged)\npackages/bigquery/package.json 0ms (unchanged)\npackages/bigquery/src/client.ts 10ms (unchanged)\npackages/bigquery/src/index.ts 1ms (unchanged)\npackages/bigquery/src/schema.ts 3ms (unchanged)\npackages/bigquery/tsconfig.json 1ms (unchanged)\npackages/billing/knowledge.md 3ms (unchanged)\npackages/billing/package.json 3ms (unchanged)\npackages/billing/project.json 0ms (unchanged)\npackages/billing/src/__tests__/credit-delegation.test.ts 7ms (unchanged)\npackages/billing/src/__tests__/extract-owner-repo.test.ts 9ms (unchanged)\npackages/billing/src/__tests__/org-billing.test.ts 12ms (unchanged)\npackages/billing/src/auto-topup.ts 12ms (unchanged)\npackages/billing/src/balance-calculator.ts 8ms (unchanged)\npackages/billing/src/billing.knowledge.md 7ms (unchanged)\npackages/billing/src/conversion.ts 1ms (unchanged)\npackages/billing/src/credit-delegation.ts 7ms (unchanged)\npackages/billing/src/grant-credits.knowledge.md 3ms (unchanged)\npackages/billing/src/grant-credits.ts 12ms (unchanged)\npackages/billing/src/index.ts 1ms (unchanged)\npackages/billing/src/org-billing.ts 16ms (unchanged)\npackages/billing/src/org-monitoring.ts 7ms (unchanged)\npackages/billing/src/usage-service.ts 10ms (unchanged)\npackages/billing/src/utils.ts 2ms (unchanged)\npackages/billing/tsconfig.json 1ms (unchanged)\npackages/build-tools/executors.json 1ms (unchanged)\npackages/build-tools/executors/infisical-run/executor.ts 2ms (unchanged)\npackages/build-tools/executors/infisical-run/schema.json 1ms (unchanged)\npackages/build-tools/package.json 1ms (unchanged)\npackages/build-tools/project.json 1ms (unchanged)\npackages/build-tools/tsconfig.json 1ms (unchanged)\npackages/code-map/__tests__/languages.test.ts 7ms (unchanged)\npackages/code-map/__tests__/parse.test.ts 4ms (unchanged)\npackages/code-map/__tests__/test-langs/test.ts 3ms (unchanged)\npackages/code-map/package.json 0ms (unchanged)\npackages/code-map/src/index.ts 0ms (unchanged)\npackages/code-map/src/languages.ts 6ms (unchanged)\npackages/code-map/src/parse.ts 6ms (unchanged)\npackages/code-map/src/tree-sitter-queries/readme.md 5ms (unchanged)\npackages/code-map/src/types.d.ts 1ms (unchanged)\npackages/code-map/tsconfig.json 0ms (unchanged)\npackages/internal/package.json 1ms (unchanged)\npackages/internal/src/env.ts 10ms (unchanged)\npackages/internal/src/index.ts 2ms (unchanged)\npackages/internal/src/knowledge.md 6ms (unchanged)\npackages/internal/src/loops/client.ts 4ms (unchanged)\npackages/internal/src/loops/index.ts 1ms (unchanged)\npackages/internal/src/loops/types.ts 1ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/convert-to-openrouter-chat-messages.test.ts 8ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/convert-to-openrouter-chat-messages.ts 10ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/convert-to-openrouter-completion-prompt.ts 6ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/index.ts 0ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/internal/index.ts 0ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/map-openrouter-chat-logprobs.ts 2ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/map-openrouter-completion-logprobs.ts 1ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/map-openrouter-finish-reason.ts 2ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/openrouter-chat-language-model.test.ts 17ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/openrouter-chat-language-model.ts 33ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/openrouter-completion-language-model.test.ts 14ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/openrouter-completion-language-model.ts 11ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/openrouter-completion-settings.ts 1ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/openrouter-error.ts 2ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/openrouter-facade.ts 4ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/openrouter-provider-options.test.ts 2ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/openrouter-provider.ts 4ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/openrouter-stream-usage-accounting.test.ts 4ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/openrouter-usage-accounting.test.ts 5ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/schemas/reasoning-details.ts 4ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/types/index.ts 1ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/types/openrouter-chat-completions-input.ts 2ms (unchanged)\npackages/internal/src/openrouter-ai-sdk/types/openrouter-chat-settings.ts 1ms (unchanged)\npackages/internal/src/utils/__tests__/version-utils.test.ts 8ms (unchanged)\npackages/internal/src/utils/auth.ts 5ms (unchanged)\npackages/internal/src/utils/version-utils.ts 4ms (unchanged)\npackages/internal/src/utils/xml-parser.ts 4ms (unchanged)\npackages/internal/tsconfig.json 0ms (unchanged)\npython-app/knowledge.md 3ms (unchanged)\npython-app/README.md 2ms (unchanged)\nREADME.md 16ms (unchanged)\nscripts/analyze-edit-blocks.ts 3ms (unchanged)\nscripts/analyze-model-usage.ts 3ms (unchanged)\nscripts/apply-credit-migration.ts 2ms (unchanged)\nscripts/calculate-average-spend.ts 10ms (unchanged)\nscripts/calculate-dau.ts 2ms (unchanged)\nscripts/calculate-monthly-usage.ts 5ms (unchanged)\nscripts/calculate-mrr.ts 3ms (unchanged)\nscripts/calculate-weekly-usage.ts 3ms (unchanged)\nscripts/changelog/docs.json 0ms (unchanged)\nscripts/convert-escaped-newlines.ts 4ms (unchanged)\nscripts/count-edit-file.ts 6ms (unchanged)\nscripts/debug-log-subset.ts 3ms (unchanged)\nscripts/export-user-emails.ts 2ms (unchanged)\nscripts/ft-file-selection/collect-tuning-data.ts 13ms (unchanged)\nscripts/ft-file-selection/grade-traces.ts 3ms (unchanged)\nscripts/ft-file-selection/print-recent-relabels.ts 1ms (unchanged)\nscripts/ft-file-selection/print-recent-traces.ts 3ms (unchanged)\nscripts/ft-file-selection/README.md 29ms (unchanged)\nscripts/ft-file-selection/relabel-for-offline-scoring.ts 17ms (unchanged)\nscripts/ft-file-selection/relabel-traces-with-context.ts 3ms (unchanged)\nscripts/ft-file-selection/relabel-traces.ts 5ms (unchanged)\nscripts/generate-tool-definitions.ts 2ms (unchanged)\nscripts/get-changelog.ts 19ms (unchanged)\nscripts/init-worktree.ts 22ms (unchanged)\nscripts/package.json 1ms (unchanged)\nscripts/tsconfig.json 1ms (unchanged)\nscripts/update-stripe-subscriptions.ts 10ms (unchanged)\nsdk/CHANGELOG.md 14ms (unchanged)\nsdk/package.json 1ms (unchanged)\nsdk/PUBLISHING.md 7ms (unchanged)\nsdk/README.md 10ms (unchanged)\nsdk/src/client.ts 12ms (unchanged)\nsdk/src/constants.ts 1ms (unchanged)\nsdk/src/index.ts 1ms (unchanged)\nsdk/src/process-stream.ts 3ms (unchanged)\nsdk/src/tools/change-file.ts 5ms (unchanged)\nsdk/src/tools/read-files.ts 5ms (unchanged)\nsdk/src/types/agent-definition.ts 8ms (unchanged)\nsdk/src/types/tools.ts 7ms (unchanged)\nsdk/src/websocket-client.ts 15ms (unchanged)\nsdk/tsconfig.json 1ms (unchanged)\ntsconfig.base.json 1ms (unchanged)\ntsconfig.json 1ms (unchanged)\nweb/components.json 1ms (unchanged)\nweb/contentlayer.config.ts 5ms (unchanged)\nweb/knowledge.md 30ms (unchanged)\nweb/package.json 3ms (unchanged)\nweb/playwright.config.ts 1ms (unchanged)\nweb/README.md 7ms (unchanged)\nweb/scripts/discord/index.ts 1ms (unchanged)\nweb/scripts/discord/register-commands.ts 1ms (unchanged)\nweb/src/__tests__/e2e/home.spec.ts 2ms (unchanged)\nweb/src/__tests__/unit/home.spec.tsx 8ms (unchanged)\nweb/src/actions/hello-action.ts 2ms (unchanged)\nweb/src/app/[sponsee]/page.tsx 7ms (unchanged)\nweb/src/app/admin/file-picker/page.tsx 19ms (unchanged)\nweb/src/app/admin/layout.tsx 3ms (unchanged)\nweb/src/app/admin/orgs/page.tsx 11ms (unchanged)\nweb/src/app/admin/traces/components/chat-message.tsx 5ms (unchanged)\nweb/src/app/admin/traces/components/client-session-viewer.tsx 6ms (unchanged)\nweb/src/app/admin/traces/components/empty-state.tsx 1ms (unchanged)\nweb/src/app/admin/traces/components/error-boundary.tsx 3ms (unchanged)\nweb/src/app/admin/traces/components/loading-skeletons.tsx 3ms (unchanged)\nweb/src/app/admin/traces/components/timeline-chart.tsx 18ms (unchanged)\nweb/src/app/admin/traces/components/trace-viewer.tsx 7ms (unchanged)\nweb/src/app/admin/traces/page.tsx 4ms (unchanged)\nweb/src/app/admin/traces/utils/__tests__/trace-processing.test.ts 5ms (unchanged)\nweb/src/app/admin/traces/utils/trace-processing.ts 17ms (unchanged)\nweb/src/app/affiliates/actions.ts 4ms (unchanged)\nweb/src/app/affiliates/page.tsx 6ms (unchanged)\nweb/src/app/agents/page.tsx 8ms (unchanged)\nweb/src/app/analytics.knowledge.md 33ms (unchanged)\nweb/src/app/api/admin/admin-auth.ts 2ms (unchanged)\nweb/src/app/api/admin/orgs/[orgId]/features/[feature]/route.ts 4ms (unchanged)\nweb/src/app/api/admin/orgs/export/route.ts 63ms (unchanged)\nweb/src/app/api/admin/orgs/route.ts 5ms (unchanged)\nweb/src/app/api/admin/relabel-for-user/route.ts 5ms (unchanged)\nweb/src/app/api/admin/traces/[clientRequestId]/messages/route.ts 7ms (unchanged)\nweb/src/app/api/admin/traces/[clientRequestId]/timeline/route.ts 8ms (unchanged)\nweb/src/app/api/admin/traces/client/[clientId]/sessions/route.ts 6ms (unchanged)\nweb/src/app/api/agents/[publisherId]/[agentId]/[version]/route.ts 3ms (unchanged)\nweb/src/app/api/agents/[publisherId]/[agentId]/latest/route.ts 4ms (unchanged)\nweb/src/app/api/agents/publish/route.ts 10ms (unchanged)\nweb/src/app/api/agents/route.ts 3ms (unchanged)\nweb/src/app/api/agents/validate/route.ts 7ms (unchanged)\nweb/src/app/api/api-keys/route.ts 8ms (unchanged)\nweb/src/app/api/auth/[...nextauth]/auth-options.ts 8ms (unchanged)\nweb/src/app/api/auth/[...nextauth]/route.ts 8ms (unchanged)\nweb/src/app/api/auth/cli/code/route.ts 133ms (unchanged)\nweb/src/app/api/auth/cli/logout/route.ts 4ms (unchanged)\nweb/src/app/api/auth/cli/status/route.ts 4ms (unchanged)\nweb/src/app/api/feed/route.ts 2ms (unchanged)\nweb/src/app/api/git-evals/route.ts 15ms (unchanged)\nweb/src/app/api/git-evals/visibility/route.ts 4ms (unchanged)\nweb/src/app/api/healthz/route.ts 1ms (unchanged)\nweb/src/app/api/invites/[token]/route.ts 181ms (unchanged)\nweb/src/app/api/orgs/[orgId]/alerts/[alertId]/dismiss/route.ts 13ms (unchanged)\nweb/src/app/api/orgs/[orgId]/alerts/route.ts 6ms (unchanged)\nweb/src/app/api/orgs/[orgId]/analytics/export/route.ts 5ms (unchanged)\nweb/src/app/api/orgs/[orgId]/analytics/route.ts 15ms (unchanged)\nweb/src/app/api/orgs/[orgId]/billing/setup/route.ts 9ms (unchanged)\nweb/src/app/api/orgs/[orgId]/billing/status/route.ts 3ms (unchanged)\nweb/src/app/api/orgs/[orgId]/billing/subscription/route.ts 6ms (unchanged)\nweb/src/app/api/orgs/[orgId]/credits/route.ts 19ms (unchanged)\nweb/src/app/api/orgs/[orgId]/invitations/[email]/resend/route.ts 5ms (unchanged)\nweb/src/app/api/orgs/[orgId]/invitations/[email]/route.ts 12ms (unchanged)\nweb/src/app/api/orgs/[orgId]/invitations/bulk/route.ts 6ms (unchanged)\nweb/src/app/api/orgs/[orgId]/invitations/route.ts 4ms (unchanged)\nweb/src/app/api/orgs/[orgId]/members/[userId]/route.ts 14ms (unchanged)\nweb/src/app/api/orgs/[orgId]/members/route.ts 9ms (unchanged)\nweb/src/app/api/orgs/[orgId]/monitoring/route.ts 10ms (unchanged)\nweb/src/app/api/orgs/[orgId]/publishers/route.ts 16ms (unchanged)\nweb/src/app/api/orgs/[orgId]/repos/[repoId]/route.ts 9ms (unchanged)\nweb/src/app/api/orgs/[orgId]/repos/route.ts 5ms (unchanged)\nweb/src/app/api/orgs/[orgId]/route.ts 25ms (unchanged)\nweb/src/app/api/orgs/[orgId]/settings/route.ts 36ms (unchanged)\nweb/src/app/api/orgs/[orgId]/usage/export/route.ts 10ms (unchanged)\nweb/src/app/api/orgs/[orgId]/usage/route.ts 48ms (unchanged)\nweb/src/app/api/orgs/route.ts 43ms (unchanged)\nweb/src/app/api/orgs/slug/[slug]/route.ts 4ms (unchanged)\nweb/src/app/api/publishers/[id]/organization/route.ts 7ms (unchanged)\nweb/src/app/api/publishers/route.ts 9ms (unchanged)\nweb/src/app/api/publishers/validate/route.ts 3ms (unchanged)\nweb/src/app/api/referrals/[code]/route.ts 6ms (unchanged)\nweb/src/app/api/referrals/helpers.ts 145ms (unchanged)\nweb/src/app/api/referrals/route.ts 16ms (unchanged)\nweb/src/app/api/stripe/buy-credits/route.ts 6ms (unchanged)\nweb/src/app/api/stripe/webhook/route.ts 30ms (unchanged)\nweb/src/app/api/upload/avatar/route.ts 5ms (unchanged)\nweb/src/app/api/user/auto-topup/route.ts 5ms (unchanged)\nweb/src/app/api/user/profile/route.ts 5ms (unchanged)\nweb/src/app/api/user/usage/route.ts 6ms (unchanged)\nweb/src/app/config/page.tsx 1ms (unchanged)\nweb/src/app/docs/[category]/layout.tsx 1ms (unchanged)\nweb/src/app/docs/[category]/metadata.ts 6ms (unchanged)\nweb/src/app/docs/[category]/page.tsx 8ms (unchanged)\nweb/src/app/docs/layout.tsx 5ms (unchanged)\nweb/src/app/docs/page.tsx 1ms (unchanged)\nweb/src/app/evals/evals-table.tsx 20ms (unchanged)\nweb/src/app/evals/page.tsx 3ms (unchanged)\nweb/src/app/invites/[token]/page.tsx 101ms (unchanged)\nweb/src/app/layout.tsx 6ms (unchanged)\nweb/src/app/login/page.tsx 3ms (unchanged)\nweb/src/app/onboard/page.tsx 10ms (unchanged)\nweb/src/app/orgs/[slug]/analytics/page.tsx 50ms (unchanged)\nweb/src/app/orgs/[slug]/billing/purchase/page.tsx 13ms (unchanged)\nweb/src/app/orgs/[slug]/billing/setup/page.tsx 20ms (unchanged)\nweb/src/app/orgs/[slug]/page.tsx 52ms (unchanged)\nweb/src/app/orgs/[slug]/repositories/page.tsx 5ms (unchanged)\nweb/src/app/orgs/[slug]/settings/page.tsx 11ms (unchanged)\nweb/src/app/orgs/[slug]/team/page.tsx 4ms (unchanged)\nweb/src/app/orgs/[slug]/usage/page.tsx 10ms (unchanged)\nweb/src/app/orgs/new/page.tsx 13ms (unchanged)\nweb/src/app/orgs/page.tsx 31ms (unchanged)\nweb/src/app/page.tsx 17ms (unchanged)\nweb/src/app/payment-success/page.tsx 10ms (unchanged)\nweb/src/app/pricing/page.tsx 10ms (unchanged)\nweb/src/app/privacy-policy/page.tsx 17ms (unchanged)\nweb/src/app/publishers/[id]/agents/[agentId]/[version]/page.tsx 12ms (unchanged)\nweb/src/app/publishers/[id]/page.tsx 55ms (unchanged)\nweb/src/app/publishers/new/page.tsx 33ms (unchanged)\nweb/src/app/publishers/page.tsx 22ms (unchanged)\nweb/src/app/referrals/[code]/metadata.ts 3ms (unchanged)\nweb/src/app/referrals/[code]/page.tsx 7ms (unchanged)\nweb/src/app/referrals/layout.tsx 3ms (unchanged)\nweb/src/app/referrals/page.tsx 11ms (unchanged)\nweb/src/app/robots.ts 2ms (unchanged)\nweb/src/app/sitemap.ts 2ms (unchanged)\nweb/src/app/terms-of-service/page.tsx 22ms (unchanged)\nweb/src/app/usage/layout.tsx 2ms (unchanged)\nweb/src/app/usage/page.tsx 13ms (unchanged)\nweb/src/app/usage/usage-display.tsx 36ms (unchanged)\nweb/src/components/agent/json-viewer.tsx 2ms (unchanged)\nweb/src/components/auto-topup/AutoTopupSettings.tsx 2ms (unchanged)\nweb/src/components/auto-topup/AutoTopupSettingsForm.tsx 5ms (unchanged)\nweb/src/components/auto-topup/AutoTopupSwitch.tsx 1ms (unchanged)\nweb/src/components/auto-topup/BaseAutoTopupSettings.tsx 2ms (unchanged)\nweb/src/components/auto-topup/BaseAutoTopupSettingsForm.tsx 6ms (unchanged)\nweb/src/components/auto-topup/BaseAutoTopupSwitch.tsx 16ms (unchanged)\nweb/src/components/auto-topup/constants.ts 1ms (unchanged)\nweb/src/components/auto-topup/OrgAutoTopupSettings.tsx 3ms (unchanged)\nweb/src/components/auto-topup/OrgAutoTopupSettingsForm.tsx 4ms (unchanged)\nweb/src/components/auto-topup/OrgAutoTopupSwitch.tsx 1ms (unchanged)\nweb/src/components/auto-topup/types.ts 3ms (unchanged)\nweb/src/components/BrowserPreview.tsx 6ms (unchanged)\nweb/src/components/card-with-beams.tsx 3ms (unchanged)\nweb/src/components/CookieConsentCard.tsx 5ms (unchanged)\nweb/src/components/credits/CreditManagementSection.tsx 3ms (unchanged)\nweb/src/components/credits/CreditPurchaseSection.tsx 4ms (unchanged)\nweb/src/components/docs/copy-heading.tsx 12ms (unchanged)\nweb/src/components/docs/doc-sidebar.tsx 5ms (unchanged)\nweb/src/components/docs/docs.knowledge.md 100ms (unchanged)\nweb/src/components/docs/mdx/code-demo.tsx 5ms (unchanged)\nweb/src/components/docs/mdx/custom-link.tsx 3ms (unchanged)\nweb/src/components/docs/mdx/markdown-table.tsx 12ms (unchanged)\nweb/src/components/docs/mdx/mdx-components.tsx 16ms (unchanged)\nweb/src/components/docs/mdx/mermaid-diagram.tsx 3ms (unchanged)\nweb/src/components/docs/mdx/schema-display.tsx 3ms (unchanged)\nweb/src/components/docs/toc.tsx 5ms (unchanged)\nweb/src/components/footer.tsx 5ms (unchanged)\nweb/src/components/icons.tsx 1ms (unchanged)\nweb/src/components/IDEDemo.tsx 210ms (unchanged)\nweb/src/components/layout-wrapper.tsx 2ms (unchanged)\nweb/src/components/login/login-card.tsx 3ms (unchanged)\nweb/src/components/login/login-client-wrapper.tsx 2ms (unchanged)\nweb/src/components/navbar/navbar.tsx 9ms (unchanged)\nweb/src/components/navbar/user-dropdown.tsx 6ms (unchanged)\nweb/src/components/organization/advanced-monitor.tsx 64ms (unchanged)\nweb/src/components/organization/billing-alerts.tsx 6ms (unchanged)\nweb/src/components/organization/billing-reports.tsx 54ms (unchanged)\nweb/src/components/organization/billing-status.tsx 21ms (unchanged)\nweb/src/components/organization/credit-monitor.tsx 73ms (unchanged)\nweb/src/components/organization/model-config-sheet.tsx 4ms (unchanged)\nweb/src/components/organization/organization-success-modal.tsx 5ms (unchanged)\nweb/src/components/organization/repository-management.tsx 40ms (unchanged)\nweb/src/components/organization/team-management.tsx 138ms (unchanged)\nweb/src/components/providers/query-client-provider.tsx 2ms (unchanged)\nweb/src/components/publisher/basic-info-step.tsx 11ms (unchanged)\nweb/src/components/publisher/ownership-step.tsx 4ms (unchanged)\nweb/src/components/publisher/profile-details-step.tsx 2ms (unchanged)\nweb/src/components/publisher/step-template.tsx 3ms (unchanged)\nweb/src/components/sign-in/sign-in-button.tsx 9ms (unchanged)\nweb/src/components/sign-in/sign-in-card-footer.tsx 2ms (unchanged)\nweb/src/components/TerminalDemo.tsx 187ms (unchanged)\nweb/src/components/theme-provider.tsx 3ms (unchanged)\nweb/src/components/theme-switcher.tsx 1ms (unchanged)\nweb/src/components/ui/avatar-upload.tsx 8ms (unchanged)\nweb/src/components/ui/background-beams.tsx 12ms (unchanged)\nweb/src/components/ui/badge.tsx 1ms (unchanged)\nweb/src/components/ui/banner.tsx 5ms (unchanged)\nweb/src/components/ui/button.tsx 4ms (unchanged)\nweb/src/components/ui/card.tsx 2ms (unchanged)\nweb/src/components/ui/collapsible.tsx 4ms (unchanged)\nweb/src/components/ui/credit-confetti.tsx 9ms (unchanged)\nweb/src/components/ui/decorative-blocks.tsx 7ms (unchanged)\nweb/src/components/ui/dialog.tsx 8ms (unchanged)\nweb/src/components/ui/dropdown-menu.tsx 9ms (unchanged)\nweb/src/components/ui/enhanced-copy-button.tsx 7ms (unchanged)\nweb/src/components/ui/footer.tsx 7ms (unchanged)\nweb/src/components/ui/hero-buttons.tsx 6ms (unchanged)\nweb/src/components/ui/hero.tsx 5ms (unchanged)\nweb/src/components/ui/input.tsx 2ms (unchanged)\nweb/src/components/ui/install-dialog.tsx 45ms (unchanged)\nweb/src/components/ui/label.tsx 11ms (unchanged)\nweb/src/components/ui/landing/animated-element.tsx 8ms (unchanged)\nweb/src/components/ui/landing/competition/claude-code.tsx 76ms (unchanged)\nweb/src/components/ui/landing/competition/cline.tsx 44ms (unchanged)\nweb/src/components/ui/landing/competition/cursor.tsx 56ms (unchanged)\nweb/src/components/ui/landing/competition/github-copilot.tsx 21ms (unchanged)\nweb/src/components/ui/landing/competition/index.tsx 11ms (unchanged)\nweb/src/components/ui/landing/competition/tabs.tsx 14ms (unchanged)\nweb/src/components/ui/landing/constants.ts 15ms (unchanged)\nweb/src/components/ui/landing/cta-section.tsx 6ms (unchanged)\nweb/src/components/ui/landing/demo-code-display.tsx 3ms (unchanged)\nweb/src/components/ui/landing/feature/browser-comparison.tsx 2ms (unchanged)\nweb/src/components/ui/landing/feature/chart-illustration.tsx 6ms (unchanged)\nweb/src/components/ui/landing/feature/code-illustration.tsx 2ms (unchanged)\nweb/src/components/ui/landing/feature/highlight-text.tsx 2ms (unchanged)\nweb/src/components/ui/landing/feature/index.tsx 6ms (unchanged)\nweb/src/components/ui/landing/feature/workflow-illustration.tsx 4ms (unchanged)\nweb/src/components/ui/landing/testimonials-section.tsx 6ms (unchanged)\nweb/src/components/ui/landing/types.ts 4ms (unchanged)\nweb/src/components/ui/neon-gradient-button.tsx 5ms (unchanged)\nweb/src/components/ui/progress.tsx 4ms (unchanged)\nweb/src/components/ui/radio-group.tsx 4ms (unchanged)\nweb/src/components/ui/section.tsx 2ms (unchanged)\nweb/src/components/ui/select.tsx 11ms (unchanged)\nweb/src/components/ui/separator.tsx 4ms (unchanged)\nweb/src/components/ui/sheet.tsx 9ms (unchanged)\nweb/src/components/ui/sidebar.tsx 50ms (unchanged)\nweb/src/components/ui/skeleton-loading.tsx 5ms (unchanged)\nweb/src/components/ui/skeleton.tsx 2ms (unchanged)\nweb/src/components/ui/slider.tsx 4ms (unchanged)\nweb/src/components/ui/switch.tsx 3ms (unchanged)\nweb/src/components/ui/table.tsx 6ms (unchanged)\nweb/src/components/ui/tabs.tsx 2ms (unchanged)\nweb/src/components/ui/terminal/index.tsx 16ms (unchanged)\nweb/src/components/ui/terminal/terminal-input.tsx 14ms (unchanged)\nweb/src/components/ui/terminal/terminal-output.tsx 5ms (unchanged)\nweb/src/components/ui/textarea.tsx 3ms (unchanged)\nweb/src/components/ui/toast.tsx 4ms (unchanged)\nweb/src/components/ui/toaster.tsx 6ms (unchanged)\nweb/src/components/ui/tooltip.tsx 1ms (unchanged)\nweb/src/components/ui/use-toast.ts 11ms (unchanged)\nweb/src/discord/client.ts 5ms (unchanged)\nweb/src/discord/rate-limiter.ts 8ms (unchanged)\nweb/src/hooks/use-auto-topup.ts 32ms (unchanged)\nweb/src/hooks/use-install-dialog.ts 2ms (unchanged)\nweb/src/hooks/use-mobile.tsx 4ms (unchanged)\nweb/src/hooks/use-model-config.ts 6ms (unchanged)\nweb/src/hooks/use-org-auto-topup.ts 15ms (unchanged)\nweb/src/hooks/use-organization-data.ts 6ms (unchanged)\nweb/src/hooks/use-user-profile.ts 8ms (unchanged)\nweb/src/lib/admin-auth.ts 2ms (unchanged)\nweb/src/lib/constant.ts 12ms (unchanged)\nweb/src/lib/currency.ts 3ms (unchanged)\nweb/src/lib/docs.ts 5ms (unchanged)\nweb/src/lib/fonts.ts 9ms (unchanged)\nweb/src/lib/organization-permissions.ts 4ms (unchanged)\nweb/src/lib/PostHogProvider.tsx 2ms (unchanged)\nweb/src/lib/publisher-permissions.ts 8ms (unchanged)\nweb/src/lib/remark-code-to-codedemo.ts 3ms (unchanged)\nweb/src/lib/server-init.ts 2ms (unchanged)\nweb/src/lib/server/referral.ts 5ms (unchanged)\nweb/src/lib/SessionProvider.tsx 1ms (unchanged)\nweb/src/lib/stripe-utils.ts 2ms (unchanged)\nweb/src/lib/testimonials.ts 3ms (unchanged)\nweb/src/lib/trackConversions.ts 2ms (unchanged)\nweb/src/lib/utils.ts 1ms (unchanged)\nweb/src/lib/validators/publisher.ts 1ms (unchanged)\nweb/src/types/contentlayer.d.ts 2ms (unchanged)\nweb/src/types/docs.ts 1ms (unchanged)\nweb/src/types/next-auth.d.ts 4ms (unchanged)\nweb/src/types/user.ts 2ms (unchanged)\nweb/src/util/logger.ts 1ms (unchanged)\nweb/tailwind.config.ts 8ms (unchanged)\nweb/tsconfig.json 2ms (unchanged)\nweb/typed.d.ts 2ms (unchanged)\nWINDOWS.md 10ms (unchanged)\n",
            "stderr": "$ prettier --write \"**/*.{ts,tsx,json,md}\"\n",
            "exitCode": 0
          }
        }
      ],
      "parentAgentId": "D-47hUftbfs"
    },
    {
      "type": "text",
      "agentId": "D-47hYldaEo",
      "text": "**Typecheck failed** with overall exit code 2.\n\n**Passing packages** (Exited with code 0): `@levelcode/code-map`, `@levelcode/sdk`, `@levelcode/bigquery`, `@levelcode/internal`, `@levelcode/billing`, `@levelcode/npm-app`, `@levelcode/common`, `@levelcode/web`.\n\n**Failing packages** (Exited with code 2):\n\n- `@levelcode/scripts`:\n  - `../backend/src/templates/agents/agent-builder.ts(93,3)`: `error TS2741: Property 'spawnableAgents' is missing in type ... but required in type 'Omit<AgentTemplate, \\\"id\\\">'.`\n  - `../backend/src/templates/agents/archive/dry-run.ts(11,31)`: `error TS2339: Property 'dry_run' does not exist on type ...`\n  - `../backend/src/templates/agents/archive/dry-run.ts(12,38)`: `error TS2339: Property 'dry_run' does not exist on type ...`\n\n- `@levelcode/backend`:\n  - Identical errors in `src/templates/agents/agent-builder.ts(93,3)`, `src/templates/agents/archive/dry-run.ts(11,31)`, and `src/templates/agents/archive/dry-run.ts(12,38)`.\n\n- `@levelcode/evals`:\n  - Identical errors in `../backend/src/templates/agents/agent-builder.ts(93,3)`, `../backend/src/templates/agents/archive/dry-run.ts(11,31)`, and `../backend/src/templates/agents/archive/dry-run.ts(12,38)`."
    },
    {
      "type": "subagent_finish",
      "agentId": "D-47hYldaEo",
      "agentType": "commander-lite",
      "displayName": "Commander Lite",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Run root typecheck after fixes.",
      "params": {
        "command": "bun run typecheck",
        "timeout_seconds": 120
      }
    },
    {
      "type": "text",
      "agentId": "D-47hUftbfs",
      "text": "**Command executed:** `bun run format` (which ran `prettier --write \"**/*.{ts,tsx,json,md}\"`)\n\n**Result:** Success (exit code 0). Processed hundreds of files across the project (e.g., `.agents/ask.ts 516ms (unchanged)`, `backend/src/main-prompt.ts 17ms (unchanged)`, `web/src/app/page.tsx 17ms (unchanged)`, etc.). **All files unchanged**no modifications needed as they were already formatted correctly."
    },
    {
      "type": "subagent_finish",
      "agentId": "D-47hUftbfs",
      "agentType": "commander-lite",
      "displayName": "Commander Lite",
      "onlyChild": false,
      "parentAgentId": "main-agent",
      "prompt": "Format all files.",
      "params": {
        "command": "bun run format",
        "timeout_seconds": 60
      }
    },
    {
      "type": "tool_result",
      "toolCallId": "D-4DhNpiT3A",
      "toolName": "spawn_agents",
      "output": [
        {
          "type": "json",
          "value": [
            {
              "agentName": "Commander Lite",
              "agentType": "commander-lite",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "**Typecheck failed** with overall exit code 2.\n\n**Passing packages** (Exited with code 0): `@levelcode/code-map`, `@levelcode/sdk`, `@levelcode/bigquery`, `@levelcode/internal`, `@levelcode/billing`, `@levelcode/npm-app`, `@levelcode/common`, `@levelcode/web`.\n\n**Failing packages** (Exited with code 2):\n\n- `@levelcode/scripts`:\n  - `../backend/src/templates/agents/agent-builder.ts(93,3)`: `error TS2741: Property 'spawnableAgents' is missing in type ... but required in type 'Omit<AgentTemplate, \\\"id\\\">'.`\n  - `../backend/src/templates/agents/archive/dry-run.ts(11,31)`: `error TS2339: Property 'dry_run' does not exist on type ...`\n  - `../backend/src/templates/agents/archive/dry-run.ts(12,38)`: `error TS2339: Property 'dry_run' does not exist on type ...`\n\n- `@levelcode/backend`:\n  - Identical errors in `src/templates/agents/agent-builder.ts(93,3)`, `src/templates/agents/archive/dry-run.ts(11,31)`, and `src/templates/agents/archive/dry-run.ts(12,38)`.\n\n- `@levelcode/evals`:\n  - Identical errors in `../backend/src/templates/agents/agent-builder.ts(93,3)`, `../backend/src/templates/agents/archive/dry-run.ts(11,31)`, and `../backend/src/templates/agents/archive/dry-run.ts(12,38)`."
                      }
                    ]
                  }
                ]
              }
            },
            {
              "agentName": "Commander Lite",
              "agentType": "commander-lite",
              "value": {
                "type": "lastMessage",
                "value": [
                  {
                    "role": "assistant",
                    "content": [
                      {
                        "type": "text",
                        "text": "**Command executed:** `bun run format` (which ran `prettier --write \"**/*.{ts,tsx,json,md}\"`)\n\n**Result:** Success (exit code 0). Processed hundreds of files across the project (e.g., `.agents/ask.ts 516ms (unchanged)`, `backend/src/main-prompt.ts 17ms (unchanged)`, `web/src/app/page.tsx 17ms (unchanged)`, etc.). **All files unchanged**no modifications needed as they were already formatted correctly."
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "b50f4a9c-2501-4933-b055-3f3ab1ff0f6f",
      "toolName": "spawn_agent_inline",
      "input": {
        "agent_type": "context-pruner",
        "params": {}
      },
      "agentId": "main-agent",
      "includeToolCall": false
    },
    {
      "type": "tool_result",
      "toolCallId": "b50f4a9c-2501-4933-b055-3f3ab1ff0f6f",
      "toolName": "spawn_agent_inline",
      "output": [
        {
          "type": "json",
          "value": {
            "message": "Agent spawned."
          }
        }
      ]
    },
    {
      "type": "tool_call",
      "toolCallId": "D-7o2mqI-JQ",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "editor-gpt-5"
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "tool_call",
      "toolCallId": "D-7o2v7gkiI",
      "toolName": "spawn_agents",
      "input": {
        "agents": [
          {
            "agent_type": "commander-lite",
            "prompt": "Verify typecheck passes after fixes.",
            "params": {
              "command": "bun run typecheck",
              "timeout_seconds": 120
            }
          }
        ]
      },
      "agentId": "main-agent",
      "includeToolCall": true
    },
    {
      "type": "subagent_start",
      "agentId": "D-7o2qxjxJE",
      "agentType": "editor-gpt-5",
      "displayName": "Code Editor",
      "onlyChild": true,
      "parentAgentId": "main-agent",
      "prompt": ""
    }
  ]
}